title,viewcount,title,body,body,acceptedanswerid
"How do I UPDATE from a SELECT in SQL Server?","3070912","","<p>In SQL Server, it's possible to <em>insert</em> into a table using a <code>SELECT</code> statement:</p>

<pre><code>INSERT INTO Table (col1, col2, col3)
SELECT col1, col2, col3 
FROM other_table 
WHERE sql = 'cool'
</code></pre>

<p>Is it also possible to <em>update</em> via a <code>SELECT</code>? I have a temporary table containing the values, and would like to update another table using those values. Perhaps something like this:</p>

<pre><code>UPDATE Table SET col1, col2
SELECT col1, col2 
FROM other_table 
WHERE sql = 'cool'
WHERE Table.id = other_table.id
</code></pre>
","<pre><code>UPDATE
    Table_A
SET
    Table_A.col1 = Table_B.col1,
    Table_A.col2 = Table_B.col2
FROM
    Some_Table AS Table_A
    INNER JOIN Other_Table AS Table_B
        ON Table_A.id = Table_B.id
WHERE
    Table_A.col3 = 'cool'
</code></pre>
","2334741"
"How do I perform an IF...THEN in an SQL SELECT?","2782594","","<p>How do I perform an IF...THEN in an SQL SELECT statement?</p>

<p>For example:</p>

<pre><code>SELECT IF(Obsolete = 'N' OR InStock = 'Y' ? 1 : 0) AS Saleable, * FROM Product
</code></pre>
","<p>The <code>CASE</code> statement is the closest to IF in SQL and is supported on all versions of SQL Server</p>

<pre><code>SELECT CAST(
             CASE 
                  WHEN Obsolete = 'N' or InStock = 'Y' 
                     THEN 1 
                  ELSE 0 
             END AS bit) as Saleable, * 
FROM Product
</code></pre>

<p>You only need to do the <code>CAST</code> if you want the result as a boolean value, if you are happy with an <code>int</code>, this works: </p>

<pre><code>SELECT CASE 
            WHEN Obsolete = 'N' or InStock = 'Y' 
               THEN 1 
               ELSE 0 
       END as Saleable, * 
FROM Product
</code></pre>

<p><code>CASE</code> statements can be embedded in other <code>CASE</code> statements and even included in aggregates. </p>

<p>SQL Server Denali (SQL Server 2012) adds the <a href=""http://msdn.microsoft.com/en-us/library/hh213574%28v=sql.110%29.aspx"" rel=""noreferrer"">IIF</a> statement which is also available in <a href=""http://www.techonthenet.com/access/functions/advanced/iif.php"" rel=""noreferrer"">access</a>: (pointed out by <a href=""https://stackoverflow.com/questions/63447/how-do-you-perform-an-if-then-in-an-sql-select/6769805#6769805"">Martin Smith</a>)</p>

<pre><code>SELECT IIF(Obsolete = 'N' or InStock = 'Y', 1, 0) as Saleable, * FROM Product
</code></pre>
","63480"
"SQL Server: CASE WHEN OR THEN ELSE END => the OR is not supported","2270432","","<p>The <code>OR</code> in the <code>WHEN</code> clause of a <code>CASE</code> statement is not supported. How can I do this?</p>

<pre><code>CASE ebv.db_no 
    WHEN 22978 OR 23218 OR 23219 THEN 'WECS 9500' 
    ELSE 'WECS 9520' 
END as wecs_system 
</code></pre>
","<p>That format requires you to use either:</p>

<pre><code>CASE ebv.db_no 
  WHEN 22978 THEN 'WECS 9500' 
  WHEN 23218 THEN 'WECS 9500'  
  WHEN 23219 THEN 'WECS 9500' 
  ELSE 'WECS 9520' 
END as wecs_system 
</code></pre>

<p>Otherwise, use:</p>

<pre><code>CASE  
  WHEN ebv.db_no IN (22978, 23218, 23219) THEN 'WECS 9500' 
  ELSE 'WECS 9520' 
END as wecs_system 
</code></pre>
","5487936"
"Add a column with a default value to an existing table in SQL Server","2217258","","<p>How can a column with a default value be added to an existing table in <a href=""http://en.wikipedia.org/wiki/Microsoft_SQL_Server#Genesis"" rel=""noreferrer"">SQL Server 2000</a> / <a href=""http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2005"" rel=""noreferrer"">SQL Server 2005</a>?</p>
","<pre><code>ALTER TABLE {TABLENAME} 
ADD {COLUMNNAME} {TYPE} {NULL|NOT NULL} 
CONSTRAINT {CONSTRAINT_NAME} DEFAULT {DEFAULT_VALUE}
WITH VALUES
</code></pre>
","92123"
"What is the difference between ""INNER JOIN"" and ""OUTER JOIN""?","1968308","","<p>Also how do <code>LEFT JOIN</code>, <code>RIGHT JOIN</code> and <code>FULL JOIN</code> fit in?</p>
","<p>Assuming you're joining on columns with no duplicates, which is a very common case:</p>

<ul>
<li><p>An inner join of A and B gives the result of A intersect B, i.e. the inner part of a <a href=""http://en.wikipedia.org/wiki/Venn_diagram"" rel=""noreferrer"">Venn diagram</a> intersection.</p></li>
<li><p>An outer join of A and B gives the results of A union B, i.e. the outer parts of a Venn diagram union.</p></li>
</ul>

<p><strong>Examples</strong></p>

<p>Suppose you have two tables, with a single column each, and data as follows:</p>

<pre><code>A    B
-    -
1    3
2    4
3    5
4    6
</code></pre>

<p>Note that (1,2) are unique to A, (3,4) are common, and (5,6) are unique to B.</p>

<p><strong>Inner join</strong></p>

<p>An inner join using either of the equivalent queries gives the intersection of the two tables, i.e. the two rows they have in common.</p>

<pre><code>select * from a INNER JOIN b on a.a = b.b;
select a.*, b.*  from a,b where a.a = b.b;

a | b
--+--
3 | 3
4 | 4
</code></pre>

<p><strong>Left outer join</strong></p>

<p>A left outer join will give all rows in A, plus any common rows in B.</p>

<pre><code>select * from a LEFT OUTER JOIN b on a.a = b.b;
select a.*, b.*  from a,b where a.a = b.b(+);

a |  b
--+-----
1 | null
2 | null
3 |    3
4 |    4
</code></pre>

<p><strong>Right outer join</strong></p>

<p>A right outer join will give all rows in B, plus any common rows in A.</p>

<pre><code>select * from a RIGHT OUTER JOIN b on a.a = b.b;
select a.*, b.*  from a,b where a.a(+) = b.b;

a    |  b
-----+----
3    |  3
4    |  4
null |  5
null |  6
</code></pre>

<p><strong>Full outer join</strong></p>

<p>A full outer join will give you the union of A and B, i.e. all the rows in A and all the rows in B. If something in A doesn't have a corresponding datum in B, then the B portion is null, and vice versa.</p>

<pre><code>select * from a FULL OUTER JOIN b on a.a = b.b;

 a   |  b
-----+-----
   1 | null
   2 | null
   3 |    3
   4 |    4
null |    6
null |    5
</code></pre>
","38578"
"How to return only the Date from a SQL Server DateTime datatype","1931912","","<pre><code>SELECT GETDATE()
</code></pre>

<p>Returns: <code>2008-09-22 15:24:13.790</code></p>

<p>I want that date part without the time part: <code>2008-09-22 00:00:00.000</code></p>

<p>How can I get that?</p>
","<p>On SQL Server 2008 and higher, you should convert to date:</p>

<pre><code>SELECT CONVERT(date, getdate())
</code></pre>

<p>On older versions, you can do the following:</p>

<pre><code>SELECT DATEADD(dd, 0, DATEDIFF(dd, 0, @your_date))
</code></pre>

<p>for example</p>

<pre><code>SELECT DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE()))
</code></pre>

<p>gives me   </p>

<pre><code>2008-09-22 00:00:00.000
</code></pre>

<p>Pros: </p>

<ul>
<li>No varchar&lt;->datetime conversions required</li>
<li>No need to think about locale</li>
</ul>
","113055"
"Insert into ... values ( SELECT ... FROM ... )","1919429","","<p>I am trying to insert into a table using the input from another table. Although this is entirely feasible for many database engines, I always seem to struggle to remember the correct syntax for the SQL engine of the day (<a href=""http://en.wikipedia.org/wiki/MySQL"">MySQL</a>, <a href=""http://en.wikipedia.org/wiki/Oracle_Database"">Oracle</a>, <a href=""http://en.wikipedia.org/wiki/Microsoft_SQL_Server"">SQL Server</a>, <a href=""http://en.wikipedia.org/wiki/IBM_Informix"">Informix</a>, and <a href=""http://en.wikipedia.org/wiki/IBM_DB2"">DB2</a>).</p>

<p>Is there a silver-bullet syntax coming from an SQL standard (for example, <a href=""http://en.wikipedia.org/wiki/SQL-92"">SQL-92</a>) that would allow me to insert the values without worrying about the underlying database?</p>
","<p>Try:</p>

<pre><code>INSERT INTO table1 ( column1 )
SELECT  col1
FROM    table2  
</code></pre>

<p>This is standard ANSI SQL and should work on any DBMS</p>

<p>It definitely works for:</p>

<ul>
<li>Oracle  </li>
<li>MS SQL Server  </li>
<li>MySQL  </li>
<li>Postgres  </li>
<li>SQLite v3  </li>
<li>Teradata</li>
<li>DB2  </li>
<li>Sybase</li>
<li>Vertica</li>
<li>HSQLDB</li>
<li>H2</li>
<li>AWS RedShift</li>
<li>SAP HANA</li>
</ul>
","25971"
"How to import an SQL file using the command line in MySQL?","1814627","","<p>I have a <code>.sql</code> file with an export from phpMyAdmin. I want to import it into a different server using the command line.</p>

<p>I have a <a href=""http://en.wikipedia.org/wiki/Windows_Server_2008"" rel=""noreferrer"">Windows Server 2008</a> R2 installation. I placed the <code>.sql</code> file on the C drive, and I tried this command</p>

<pre><code>database_name &lt; file.sql
</code></pre>

<p>It is not working I get syntax errors.</p>

<ul>
<li>How can I import this file without a problem?</li>
<li>Do I need to create a database first?</li>
</ul>
","<p>Try:</p>

<pre><code>mysql -u username -p database_name &lt; file.sql
</code></pre>

<p>Check <a href=""http://dev.mysql.com/doc/refman/5.0/en/mysql-command-options.html"" rel=""noreferrer"">MySQL Options</a>.</p>

<p><strong>Note-1:</strong> It is better to use the full path of the SQL file <code>file.sql</code>.</p>

<p><strong>Note-2:</strong> Use <code>-R</code> and <code>--triggers</code> to keep the routines and triggers of original database. They are not copied by default.</p>
","17666279"
"Get list of all tables in Oracle?","1732449","","<p>How do I query an Oracle database to display the names of all tables in it?</p>
","<pre><code>SELECT owner, table_name
  FROM dba_tables
</code></pre>

<p>This is assuming that you have access to the <code>DBA_TABLES</code> data dictionary view.  If you do not have those privileges but need them, you can request that the DBA explicitly grants you privileges on that table, or, that the DBA grants you the <code>SELECT ANY DICTIONARY</code> privilege or the <code>SELECT_CATALOG_ROLE</code> role (either of which would allow you to query any data dictionary table).  Of course, you may want to exclude certain schemas like <code>SYS</code> and <code>SYSTEM</code> which have large numbers of Oracle tables that you probably don't care about.</p>

<p>Alternatively, if you do not have access to <code>DBA_TABLES</code>, you can see all the tables that your account has access to through the <code>ALL_TABLES</code> view:</p>

<pre><code>SELECT owner, table_name
  FROM all_tables
</code></pre>

<p>Although, that may be a subset of the tables available in the database (<code>ALL_TABLES</code> shows you the information for all the tables that your user has been granted access to).  </p>

<p>If you are only concerned with the tables that you own, not those that you have access to, you could use <code>USER_TABLES</code>:</p>

<pre><code>SELECT table_name
  FROM user_tables
</code></pre>

<p>Since <code>USER_TABLES</code> only has information about the tables that you own, it does not have an <code>OWNER</code> column – the owner, by definition, is you.</p>

<p>Oracle also has a number of legacy data dictionary views-- <code>TAB</code>, <code>DICT</code>, <code>TABS</code>, and <code>CAT</code> for example-- that could be used.  In general, I would not suggest using these legacy views unless you absolutely need to backport your scripts to Oracle 6.  Oracle has not changed these views in a long time so they often have problems with newer types of objects.  For example, the <code>TAB</code> and <code>CAT</code> views both show information about tables that are in the user's recycle bin while the <code>[DBA|ALL|USER]_TABLES</code> views all filter those out.  <code>CAT</code> also shows information about materialized view logs with a <code>TABLE_TYPE</code> of ""TABLE"" which is unlikely to be what you really want.  <code>DICT</code> combines tables and synonyms and doesn't tell you who owns the object.</p>
","205746"
"Concatenate many rows into a single text string?","1630608","","<p>Consider a database table holding names, with three rows:</p>

<pre><code>Peter
Paul
Mary
</code></pre>

<p>Is there an easy way to turn this into a single string of <code>Peter, Paul, Mary</code>?</p>
","<p>I had a similar issue when I was trying to join two tables with one-to-many relationships. In SQL 2005 I found that <code>XML PATH</code> method can handle the concatenation of the rows very easily.</p>

<p>If there is a table called <code>STUDENTS</code></p>

<pre><code>SubjectID       StudentName
----------      -------------
1               Mary
1               John
1               Sam
2               Alaina
2               Edward
</code></pre>

<p>Result I expected was:</p>

<pre><code>SubjectID       StudentName
----------      -------------
1               Mary, John, Sam
2               Alaina, Edward
</code></pre>

<p>I used the following T-SQL:</p>

<pre><code>Select Main.SubjectID,
       Left(Main.Students,Len(Main.Students)-1) As ""Students""
From
    (
        Select distinct ST2.SubjectID, 
            (
                Select ST1.StudentName + ',' AS [text()]
                From dbo.Students ST1
                Where ST1.SubjectID = ST2.SubjectID
                ORDER BY ST1.SubjectID
                For XML PATH ('')
            ) [Students]
        From dbo.Students ST2
    ) [Main]
</code></pre>

<p>You can do the same thing in a more compact way if you can concat the commas at the beginning and use substring to skip the first one so you don't need to do a subquery:</p>

<pre><code>Select distinct ST2.SubjectID, 
    substring(
        (
            Select ','+ST1.StudentName  AS [text()]
            From dbo.Students ST1
            Where ST1.SubjectID = ST2.SubjectID
            ORDER BY ST1.SubjectID
            For XML PATH ('')
        ), 2, 1000) [Students]
From dbo.Students ST2
</code></pre>
","545672"
"Finding duplicate values in a SQL table","1625572","","<p>It's easy to find duplicates with one field:</p>

<pre><code>SELECT name, COUNT(email) 
FROM users
GROUP BY email
HAVING ( COUNT(email) &gt; 1 )
</code></pre>

<p>So if we have a table</p>

<pre class=""lang-none prettyprint-override""><code>ID   NAME   EMAIL
1    John   asd@asd.com
2    Sam    asd@asd.com
3    Tom    asd@asd.com
4    Bob    bob@asd.com
5    Tom    asd@asd.com
</code></pre>

<p>This query will give us John, Sam, Tom, Tom because they all have the same <code>email</code>.</p>

<p>However, what I want is to get duplicates with the same <code>email</code> <strong>and</strong> <code>name</code>.</p>

<p>That is, I want to get ""Tom"", ""Tom"".</p>

<p>The reason I need this: I made a mistake, and allowed to insert duplicate <code>name</code> and <code>email</code> values. Now I need to remove/change the duplicates, so I need to <em>find</em> them first.</p>
","<pre><code>SELECT
    name, email, COUNT(*)
FROM
    users
GROUP BY
    name, email
HAVING 
    COUNT(*) &gt; 1
</code></pre>

<p>Simply group on both of the columns.</p>

<p>Note: the ANSI standard is to have all non aggregated columns in the GROUP BY.
MySQL allows you to avoid this, but results are unpredictable:</p>

<ul>
<li><a href=""https://stackoverflow.com/q/10894820/27535"">GROUP BY lname ORDER BY showing wrong results</a></li>
<li><a href=""https://stackoverflow.com/questions/6060241/which-is-the-least-expensive-aggregate-function-in-the-absence-of-any/6060414#6060414"">Which is the least expensive aggregate function in the absence of ANY()</a> (see comments in accepted answer)</li>
</ul>

<p>In MySQL you need <code>sql_mode=only_full_group_by</code></p>
","2594855"
"How can I prevent SQL injection in PHP?","1305459","","<p>If user input is inserted without modification into an SQL query, then the application becomes vulnerable to <a href=""https://stackoverflow.com/a/332367/"">SQL injection</a>, like in the following example:</p>

<pre class=""lang-php prettyprint-override""><code>$unsafe_variable = $_POST['user_input']; 

mysql_query(""INSERT INTO `table` (`column`) VALUES ('$unsafe_variable')"");
</code></pre>

<p>That's because the user can input something like <code>value'); DROP TABLE table;--</code>, and the query becomes:</p>

<pre><code>INSERT INTO `table` (`column`) VALUES('value'); DROP TABLE table;--')
</code></pre>

<p>What can be done to prevent this from happening?</p>
","<p><strong>Use prepared statements and parameterized queries.</strong> These are SQL statements that are sent to and parsed by the database server separately from any parameters. This way it is impossible for an attacker to inject malicious SQL.</p>

<p>You basically have two options to achieve this:</p>

<ol>
<li><p>Using <a href=""http://php.net/manual/en/book.pdo.php"" rel=""noreferrer"">PDO</a> (for any supported database driver):</p>

<pre class=""lang-php prettyprint-override""><code>$stmt = $pdo-&gt;prepare('SELECT * FROM employees WHERE name = :name');

$stmt-&gt;execute(array('name' =&gt; $name));

foreach ($stmt as $row) {
    // do something with $row
}
</code></pre></li>
<li><p>Using <a href=""http://php.net/manual/en/book.mysqli.php"" rel=""noreferrer"">MySQLi</a> (for MySQL):</p>

<pre class=""lang-php prettyprint-override""><code>$stmt = $dbConnection-&gt;prepare('SELECT * FROM employees WHERE name = ?');
$stmt-&gt;bind_param('s', $name); // 's' specifies the variable type =&gt; 'string'

$stmt-&gt;execute();

$result = $stmt-&gt;get_result();
while ($row = $result-&gt;fetch_assoc()) {
    // do something with $row
}
</code></pre></li>
</ol>

<p>If you're connecting to a database other than MySQL, there is a driver-specific second option that you can refer to (e.g. <code>pg_prepare()</code> and <code>pg_execute()</code> for PostgreSQL). PDO is the universal option.</p>

<h2>Correctly setting up the connection</h2>

<p>Note that when using <code>PDO</code> to access a MySQL database <em>real</em> prepared statements are <strong>not used by default</strong>. To fix this you have to disable the emulation of prepared statements. An example of creating a connection using PDO is:</p>

<pre class=""lang-php prettyprint-override""><code>$dbConnection = new PDO('mysql:dbname=dbtest;host=127.0.0.1;charset=utf8', 'user', 'pass');

$dbConnection-&gt;setAttribute(PDO::ATTR_EMULATE_PREPARES, false);
$dbConnection-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
</code></pre>

<p>In the above example the error mode isn't strictly necessary, <strong>but it is advised to add it</strong>. This way the script will not stop with a <code>Fatal Error</code> when something goes wrong. And it gives the developer the chance to <code>catch</code> any error(s) which are <code>throw</code>n as <code>PDOException</code>s.</p>

<p>What is <strong>mandatory</strong>, however, is the first <code>setAttribute()</code> line, which tells PDO to disable emulated prepared statements and use <em>real</em> prepared statements. This makes sure the statement and the values aren't parsed by PHP before sending it to the MySQL server (giving a possible attacker no chance to inject malicious SQL).</p>

<p>Although you can set the <code>charset</code> in the options of the constructor, it's important to note that 'older' versions of PHP (&lt; 5.3.6) <a href=""http://php.net/manual/en/ref.pdo-mysql.connection.php"" rel=""noreferrer"">silently ignored the charset parameter</a> in the DSN.</p>

<h2>Explanation</h2>

<p>What happens is that the SQL statement you pass to <code>prepare</code> is parsed and compiled by the database server. By specifying parameters (either a <code>?</code> or a named parameter like <code>:name</code> in the example above) you tell the database engine where you want to filter on. Then when you call <code>execute</code>, the prepared statement is combined with the parameter values you specify. </p>

<p>The important thing here is that the parameter values are combined with the compiled statement, not an SQL string. SQL injection works by tricking the script into including malicious strings when it creates SQL to send to the database. So by sending the actual SQL separately from the parameters, you limit the risk of ending up with something you didn't intend. Any parameters you send when using a prepared statement will just be treated as strings (although the database engine may do some optimization so parameters may end up as numbers too, of course). In the example above, if the <code>$name</code> variable contains <code>'Sarah'; DELETE FROM employees</code> the result would simply be a search for the string <code>""'Sarah'; DELETE FROM employees""</code>, and you will not end up with <a href=""http://xkcd.com/327/"" rel=""noreferrer"">an empty table</a>.</p>

<p>Another benefit of using prepared statements is that if you execute the same statement many times in the same session it will only be parsed and compiled once, giving you some speed gains.</p>

<p>Oh, and since you asked about how to do it for an insert, here's an example (using PDO):</p>

<pre class=""lang-php prettyprint-override""><code>$preparedStatement = $db-&gt;prepare('INSERT INTO table (column) VALUES (:column)');

$preparedStatement-&gt;execute(array('column' =&gt; $unsafeValue));
</code></pre>

<h2>Can prepared statements be used for dynamic queries?</h2>

<p>While you can still use prepared statements for the query parameters, the structure of the dynamic query itself cannot be parametrized and certain query features cannot be parametrized.</p>

<p>For these specific scenarios, the best thing to do is use a whitelist filter that restricts the possible values.</p>

<pre><code>// Value whitelist
// $dir can only be 'DESC' otherwise it will be 'ASC'
if (empty($dir) || $dir !== 'DESC') {
   $dir = 'ASC';
}
</code></pre>
","60496"
"SQL query to select dates between two dates","1211443","","<p>I have a <code>start_date</code> and <code>end_date</code>. I want to get the list of dates in between these two dates. Can anyone help me pointing the mistake in my query.</p>

<pre><code>select Date,TotalAllowance 
from Calculation 
where EmployeeId=1
  and Date between 2011/02/25 and 2011/02/27
</code></pre>

<p>Here <code>Date</code> is a <code>datetime</code> variable.</p>
","<p>you should put those two dates between single quotes like..</p>

<pre><code>select Date, TotalAllowance from Calculation where EmployeeId = 1
             and Date between '2011/02/25' and '2011/02/27'
</code></pre>

<p>or can use</p>

<pre><code>select Date, TotalAllowance from Calculation where EmployeeId = 1
             and Date &gt;= '2011/02/25' and Date &lt;= '2011/02/27'
</code></pre>
","5125106"
"How can I SELECT rows with MAX(Column value), DISTINCT by another column in SQL?","1165270","","<h3>My table is:</h3>

<pre><code>id  home  datetime     player   resource
---|-----|------------|--------|---------
1  | 10  | 04/03/2009 | john   | 399 
2  | 11  | 04/03/2009 | juliet | 244
5  | 12  | 04/03/2009 | borat  | 555
3  | 10  | 03/03/2009 | john   | 300
4  | 11  | 03/03/2009 | juliet | 200
6  | 12  | 03/03/2009 | borat  | 500
7  | 13  | 24/12/2008 | borat  | 600
8  | 13  | 01/01/2009 | borat  | 700
</code></pre>

<p>I need to select each distinct <code>home</code> holding the maximum value of <code>datetime</code>. </p>

<h3>Result would be:</h3>

<pre><code>id  home  datetime     player   resource 
---|-----|------------|--------|---------
1  | 10  | 04/03/2009 | john   | 399
2  | 11  | 04/03/2009 | juliet | 244
5  | 12  | 04/03/2009 | borat  | 555
8  | 13  | 01/01/2009 | borat  | 700
</code></pre>

<p>I have tried:</p>

<pre><code>-- 1 ..by the MySQL manual: 

SELECT DISTINCT
  home,
  id,
  datetime AS dt,
  player,
  resource
FROM topten t1
WHERE datetime = (SELECT
  MAX(t2.datetime)
FROM topten t2
GROUP BY home)
GROUP BY datetime
ORDER BY datetime DESC
</code></pre>

<p>Doesn't work. Result-set has 130 rows although database holds 187. 
Result includes some duplicates of <code>home</code>.</p>

<pre><code>-- 2 ..join

SELECT
  s1.id,
  s1.home,
  s1.datetime,
  s1.player,
  s1.resource
FROM topten s1
JOIN (SELECT
  id,
  MAX(datetime) AS dt
FROM topten
GROUP BY id) AS s2
  ON s1.id = s2.id
ORDER BY datetime 
</code></pre>

<p>Nope. Gives all the records.</p>

<pre><code>-- 3 ..something exotic: 
</code></pre>

<p>With various results.</p>
","<p>You are so close!  All you need to do is select BOTH the home and it's max date time, then join back to the topten table on BOTH fields:</p>

<pre><code>SELECT tt.*
FROM topten tt
INNER JOIN
    (SELECT home, MAX(datetime) AS MaxDateTime
    FROM topten
    GROUP BY home) groupedtt 
ON tt.home = groupedtt.home 
AND tt.datetime = groupedtt.MaxDateTime
</code></pre>
","612268"
"How to convert DateTime to VarChar","1156937","","<p>I am working on a query in Sql Server 2005 where I need to convert a value in <code>DateTime</code> variable into a <code>varchar</code> variable in <code>yyyy-mm-dd</code> format (without time part). How do I do that?</p>
","<p>With Microsoft Sql Server:</p>

<pre><code>--
-- Create test case
--
DECLARE @myDateTime DATETIME
SET @myDateTime = '2008-05-03'

--
-- Convert string
--
SELECT LEFT(CONVERT(VARCHAR, @myDateTime, 120), 10)
</code></pre>
","74469"
"'IF' in 'SELECT' statement - choose output value based on column values","1099150","","<pre><code>SELECT id, amount FROM report
</code></pre>

<p>I need <code>amount</code> to be <code>amount</code> if <code>report.type='P'</code> and <code>-amount</code> if <code>report.type='N'</code>. How do I add this to the above query?</p>
","<pre><code>SELECT id, 
       IF(type = 'P', amount, amount * -1) as amount
FROM report
</code></pre>

<p>See <a href=""http://dev.mysql.com/doc/refman/5.0/en/control-flow-functions.html"" rel=""noreferrer"">http://dev.mysql.com/doc/refman/5.0/en/control-flow-functions.html</a>.</p>

<p>Additionally, you could handle when the condition is null. In the case of a null amount:</p>

<pre><code>SELECT id, 
       IF(type = 'P', IFNULL(amount,0), IFNULL(amount,0) * -1) as amount
FROM report
</code></pre>

<p>The part <code>IFNULL(amount,0)</code> means <em>when amount is not null return amount else return 0</em>.</p>
","5951204"
"How can I do an UPDATE statement with JOIN in SQL?","1094320","","<p>I need to update this table in SQL Server 2005 with data from its 'parent' table, see below:</p>

<p><strong>sale</strong></p>

<pre><code>id (int)
udid (int)
assid (int)
</code></pre>

<p><strong>ud</strong></p>

<pre><code>id  (int)
assid  (int)
</code></pre>

<p><code>sale.assid</code> contains the correct value to update <code>ud.assid</code>. What query will do this? I'm thinking a join but I'm not sure if it's possible.</p>
","<p>Syntax strictly depends on which SQL DBMS you're using. Here are some ways to do it in ANSI/ISO (aka should work on any SQL DBMS), MySQL, SQL Server, and Oracle. Be advised that my suggested ANSI/ISO method will typically be much slower than the other two methods, but if you're using a SQL DBMS other than MySQL, SQL Server, or Oracle, then it may be the only way to go (e.g. if your SQL DBMS doesn't support <code>MERGE</code>):</p>

<p>ANSI/ISO:</p>

<pre><code>update ud 
     set assid = (
          select sale.assid 
          from sale 
          where sale.udid = ud.id
     )
 where exists (
      select * 
      from sale 
      where sale.udid = ud.id
 );
</code></pre>

<p>MySQL:</p>

<pre><code>update ud u
inner join sale s on
    u.id = s.udid
set u.assid = s.assid
</code></pre>

<p>SQL Server:</p>

<pre><code>update u
set u.assid = s.assid
from ud u
    inner join sale s on
        u.id = s.udid
</code></pre>

<p>Oracle:</p>

<pre><code>update
    (select
        u.assid as new_assid,
        s.assid as old_assid
    from ud u
        inner join sale s on
            u.id = s.udid) up
set up.new_assid = up.old_assid
</code></pre>
","1293347"
"How can I get column names from a table in SQL Server?","1072217","","<p>I would like to query the name of all columns of a table. I found how to do this in:</p>

<ul>
<li><a href=""https://stackoverflow.com/q/452464/419956"">Oracle</a></li>
<li><a href=""https://stackoverflow.com/q/193780/419956"">MySQL</a></li>
<li><a href=""https://dba.stackexchange.com/q/22362/5089"">PostgreSQL</a></li>
</ul>

<p>But I need to know: <strong>how can this be done in <em>Microsoft SQL Server</em> (2008 in my case)?</strong></p>
","<p>You can obtain this information and much, much more by querying the <a href=""http://msdn.microsoft.com/en-us/library/aa933204%28SQL.80%29.aspx"" rel=""noreferrer"">Information Schema views</a>.</p>

<p>This sample query: </p>

<pre><code>SELECT *
FROM Northwind.INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = N'Customers'
</code></pre>

<p>Can be made over all these DB objects:  </p>

<ul>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/check-constraints-transact-sql"" rel=""noreferrer"">CHECK_CONSTRAINTS</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/column-domain-usage-transact-sql"" rel=""noreferrer"">COLUMN_DOMAIN_USAGE</a></li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/column-privileges-transact-sql"" rel=""noreferrer"">COLUMN_PRIVILEGES</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/columns-transact-sql"" rel=""noreferrer"">COLUMNS</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/constraint-column-usage-transact-sql"" rel=""noreferrer"">CONSTRAINT_COLUMN_USAGE</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/constraint-table-usage-transact-sql"" rel=""noreferrer"">CONSTRAINT_TABLE_USAGE</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/domain-constraints-transact-sql"" rel=""noreferrer"">DOMAIN_CONSTRAINTS</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/domains-transact-sql"" rel=""noreferrer"">DOMAINS</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/key-column-usage-transact-sql"" rel=""noreferrer"">KEY_COLUMN_USAGE</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/parameters-transact-sql"" rel=""noreferrer"">PARAMETERS</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/referential-constraints-transact-sql"" rel=""noreferrer"">REFERENTIAL_CONSTRAINTS</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/routines-transact-sql"" rel=""noreferrer"">ROUTINES</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/routine-columns-transact-sql"" rel=""noreferrer"">ROUTINE_COLUMNS</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/schemata-transact-sql"" rel=""noreferrer"">SCHEMATA</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/table-constraints-transact-sql"" rel=""noreferrer"">TABLE_CONSTRAINTS</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/table-privileges-transact-sql"" rel=""noreferrer"">TABLE_PRIVILEGES</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/tables-transact-sql"" rel=""noreferrer"">TABLES</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/view-column-usage-transact-sql"" rel=""noreferrer"">VIEW_COLUMN_USAGE</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/view-table-usage-transact-sql"" rel=""noreferrer"">VIEW_TABLE_USAGE</a>  </li>
<li><a href=""https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/views-transact-sql"" rel=""noreferrer"">VIEWS</a>  </li>
</ul>
","1054988"
"NOT IN vs NOT EXISTS","1039601","","<p>Which of these queries is the faster?</p>

<p>NOT EXISTS:</p>

<pre><code>SELECT ProductID, ProductName 
FROM Northwind..Products p
WHERE NOT EXISTS (
    SELECT 1 
    FROM Northwind..[Order Details] od 
    WHERE p.ProductId = od.ProductId)
</code></pre>

<p>Or NOT IN:</p>

<pre><code>SELECT ProductID, ProductName 
FROM Northwind..Products p
WHERE p.ProductID NOT IN (
    SELECT ProductID 
    FROM Northwind..[Order Details])
</code></pre>

<p>The query execution plan says they both do the same thing.  If that is the case, which is the recommended form?</p>

<p>This is based on the NorthWind database.</p>

<p>[Edit]</p>

<p>Just found this helpful article: 
<a href=""http://weblogs.sqlteam.com/mladenp/archive/2007/05/18/60210.aspx"" rel=""noreferrer"">http://weblogs.sqlteam.com/mladenp/archive/2007/05/18/60210.aspx</a></p>

<p>I think I'll stick with NOT EXISTS.</p>
","<p>I always default to <code>NOT EXISTS</code>.</p>

<p>The execution plans may be the same at the moment but if either column is altered in the future to allow <code>NULL</code>s the <code>NOT IN</code> version will need to do more work (even if no <code>NULL</code>s are actually present in the data) and the semantics of <code>NOT IN</code> if <code>NULL</code>s <em>are</em> present are unlikely to be the ones you want anyway.</p>

<p>When neither <code>Products.ProductID</code> or <code>[Order Details].ProductID</code> allow <code>NULL</code>s the <code>NOT IN</code> will be treated identically to the following query.</p>

<pre><code>SELECT ProductID,
       ProductName
FROM   Products p
WHERE  NOT EXISTS (SELECT *
                   FROM   [Order Details] od
                   WHERE  p.ProductId = od.ProductId) 
</code></pre>

<p>The exact plan may vary but for my example data I get the following.</p>

<p><img src=""https://i.stack.imgur.com/lCTsG.png"" alt=""Neither NULL""></p>

<p>A reasonably common misconception seems to be that correlated sub queries are always ""bad"" compared to joins. They certainly can be when they force a nested loops plan (sub query evaluated row by row) but  this plan includes an anti semi join logical operator. Anti semi joins are not restricted to nested loops but can use hash or merge (as in this example) joins too.</p>

<pre><code>/*Not valid syntax but better reflects the plan*/ 
SELECT p.ProductID,
       p.ProductName
FROM   Products p
       LEFT ANTI SEMI JOIN [Order Details] od
         ON p.ProductId = od.ProductId 
</code></pre>

<p>If <code>[Order Details].ProductID</code> is <code>NULL</code>-able the query then becomes</p>

<pre><code>SELECT ProductID,
       ProductName
FROM   Products p
WHERE  NOT EXISTS (SELECT *
                   FROM   [Order Details] od
                   WHERE  p.ProductId = od.ProductId)
       AND NOT EXISTS (SELECT *
                       FROM   [Order Details]
                       WHERE  ProductId IS NULL) 
</code></pre>

<p>The reason for this is that the correct semantics if <code>[Order Details]</code> contains any <code>NULL</code> <code>ProductId</code>s is to return no results. See the extra anti semi join and row count spool to verify this that is added to the plan.</p>

<p><img src=""https://i.stack.imgur.com/mPYhd.png"" alt=""One NULL""></p>

<p>If <code>Products.ProductID</code> is also changed to become <code>NULL</code>-able the query then becomes</p>

<pre><code>SELECT ProductID,
       ProductName
FROM   Products p
WHERE  NOT EXISTS (SELECT *
                   FROM   [Order Details] od
                   WHERE  p.ProductId = od.ProductId)
       AND NOT EXISTS (SELECT *
                       FROM   [Order Details]
                       WHERE  ProductId IS NULL)
       AND NOT EXISTS (SELECT *
                       FROM   (SELECT TOP 1 *
                               FROM   [Order Details]) S
                       WHERE  p.ProductID IS NULL) 
</code></pre>

<p>The reason for that one is because a <code>NULL</code> <code>Products.ProductId</code> should not be returned in the results <strong>except</strong> if the <code>NOT IN</code> sub query were to return no results at all (i.e. the <code>[Order Details]</code> table is empty). In which case it should. In the plan for my sample data this is implemented by adding another anti semi join as below.</p>

<p><img src=""https://i.stack.imgur.com/8XAh1.png"" alt=""Both NULL""></p>

<p>The effect of this is shown in <a href=""http://sqlinthewild.co.za/index.php/2010/02/18/not-exists-vs-not-in/"" rel=""noreferrer"">the blog post already linked by Buckley</a>. In the example there the number of logical reads increase from around 400 to 500,000.</p>

<p>Additionally the fact that a single <code>NULL</code> can reduce the row count to zero makes cardinality estimation very difficult. If SQL Server assumes that this will happen but in fact there were no <code>NULL</code> rows in the data the rest of the execution plan may be catastrophically worse, if this is just part of a larger query, <a href=""https://dba.stackexchange.com/q/117306/3690"">with inappropriate nested loops causing repeated execution of an expensive sub tree for example</a>. </p>

<p>This is not the only possible execution plan for a <code>NOT IN</code> on a <code>NULL</code>-able column however. <a href=""http://bradsruminations.blogspot.co.uk/2011/10/t-sql-tuesday-023-flip-side-of-join.html"" rel=""noreferrer"">This article shows another one</a> for a query against the <code>AdventureWorks2008</code> database.</p>

<p>For the <code>NOT IN</code> on a <code>NOT NULL</code> column or the <code>NOT EXISTS</code> against either a nullable or non nullable column it gives the following plan.</p>

<p><img src=""https://i.stack.imgur.com/nahUD.png"" alt=""Not EXists""></p>

<p>When the column changes to <code>NULL</code>-able the <code>NOT IN</code> plan now looks like</p>

<p><img src=""https://i.stack.imgur.com/8o9PQ.png"" alt=""Not In - Null""></p>

<p>It adds an extra inner join operator to the plan. This apparatus is <a href=""https://dba.stackexchange.com/a/14812/3690"">explained here</a>. It is all there to convert the previous single correlated index seek on <code>Sales.SalesOrderDetail.ProductID = &lt;correlated_product_id&gt;</code> to two seeks per outer row. The additional one is on <code>WHERE Sales.SalesOrderDetail.ProductID IS NULL</code>. </p>

<p>As this is under an anti semi join if that one returns any rows the second seek will not occur. However if <code>Sales.SalesOrderDetail</code> does not contain any <code>NULL</code> <code>ProductID</code>s it will double the number of seek operations required.</p>
","11074428"
"What is the difference between UNION and UNION ALL?","962923","","<p>What is the difference between UNION and UNION ALL?</p>
","<p><code>UNION</code> removes duplicate records (where all columns in the results are the same), <code>UNION ALL</code> does not.</p>

<p>There is a performance hit when using <code>UNION</code> instead of <code>UNION ALL</code>, since the database server must do additional work to remove the duplicate rows, but usually you do not want the duplicates (especially when developing reports).</p>

<h1>UNION Example:</h1>

<pre><code>SELECT 'foo' AS bar UNION SELECT 'foo' AS bar
</code></pre>

<p><strong>Result:</strong> </p>

<pre><code>+-----+
| bar |
+-----+
| foo |
+-----+
1 row in set (0.00 sec)
</code></pre>

<h1>UNION ALL example:</h1>

<pre><code>SELECT 'foo' AS bar UNION ALL SELECT 'foo' AS bar
</code></pre>

<p><strong>Result:</strong></p>

<pre><code>+-----+
| bar |
+-----+
| foo |
| foo |
+-----+
2 rows in set (0.00 sec)
</code></pre>
","49928"
"SQL SELECT WHERE field contains words","942369","","<p>I need a select which would return results like this:</p>

<pre><code>SELECT * FROM MyTable WHERE Column1 CONTAINS 'word1 word2 word3'
</code></pre>

<p>And I need all results, i.e. this includes strings with 'word2 word3 word1' or 'word1 word3 word2' or any other combination of the three.</p>

<p>All words need to be in the result.</p>
","<p>Rather slow, but working method to include <strong>any</strong> of words:</p>

<pre><code>SELECT * FROM mytable
WHERE column1 LIKE '%word1%'
   OR column1 LIKE '%word2%'
   OR column1 LIKE '%word3%'
</code></pre>

<p>If you need <strong>all</strong> words to be present, use this:</p>

<pre><code>SELECT * FROM mytable
WHERE column1 LIKE '%word1%'
  AND column1 LIKE '%word2%'
  AND column1 LIKE '%word3%'
</code></pre>

<p>If you want something faster, you need to look into full text search, and this is very specific for each database type.</p>
","14290878"
"How do I limit the number of rows returned by an Oracle query after ordering?","933138","","<p>Is there a way to make an Oracle query behave like it contains a MySQL <code>limit</code> clause?</p>

<p>In MySQL, I can do this:</p>

<pre><code>select * 
from sometable
order by name
limit 20,10
</code></pre>

<p>to get the 21st to the 30th rows (skip the first 20, give the next 10). The rows are selected after the <code>order by</code>, so it really starts on the 20th name alphabetically.</p>

<p>In Oracle, the only thing people mention is the <code>rownum</code> pseudo-column, but it is evaluated <em>before</em> <code>order by</code>, which means this:</p>

<pre><code>select * 
from sometable
where rownum &lt;= 10
order by name
</code></pre>

<p>will return a random set of ten rows ordered by name, which is not usually what I want. It also doesn't allow for specifying an offset.</p>
","<p>Starting from Oracle 12c R1 (12.1), there <em>is</em> a <a href=""http://www.oracle-base.com/articles/12c/row-limiting-clause-for-top-n-queries-12cr1.php"" rel=""noreferrer"">row limiting clause</a>. It does not use familiar <code>LIMIT</code> syntax, but it can do the job better with more options. You can find the <a href=""http://docs.oracle.com/database/121/SQLRF/statements_10002.htm#BABBADDD"" rel=""noreferrer"">full syntax here</a>.</p>

<p>To answer the original question, here's the query:</p>

<pre><code>SELECT * 
FROM   sometable
ORDER BY name
OFFSET 20 ROWS FETCH NEXT 10 ROWS ONLY;
</code></pre>

<p>(For earlier Oracle versions, please refer to other answers in this question)</p>

<hr>

<h2>Examples:</h2>

<p>Following examples were quoted from <a href=""http://www.oracle-base.com/articles/12c/row-limiting-clause-for-top-n-queries-12cr1.php"" rel=""noreferrer"">linked page</a>, in the hope of preventing link rot.</p>

<h3>Setup</h3>

<pre><code>CREATE TABLE rownum_order_test (
  val  NUMBER
);

INSERT ALL
  INTO rownum_order_test
SELECT level
FROM   dual
CONNECT BY level &lt;= 10;

COMMIT;
</code></pre>

<h3>What's in the table?</h3>

<pre><code>SELECT val
FROM   rownum_order_test
ORDER BY val;

       VAL
----------
         1
         1
         2
         2
         3
         3
         4
         4
         5
         5
         6
         6
         7
         7
         8
         8
         9
         9
        10
        10

20 rows selected.
</code></pre>

<h3>Get first <code>N</code> rows</h3>

<pre><code>SELECT val
FROM   rownum_order_test
ORDER BY val DESC
FETCH FIRST 5 ROWS ONLY;

       VAL
----------
        10
        10
         9
         9
         8

5 rows selected.
</code></pre>

<h3>Get first <code>N</code> rows, if <code>N</code><sup>th</sup> row has ties, get all the tied rows</h3>

<pre><code>SELECT val
FROM   rownum_order_test
ORDER BY val DESC
FETCH FIRST 5 ROWS WITH TIES;

       VAL
----------
        10
        10
         9
         9
         8
         8

6 rows selected.
</code></pre>

<h3>Top <code>x</code>% of rows</h3>

<pre><code>SELECT val
FROM   rownum_order_test
ORDER BY val
FETCH FIRST 20 PERCENT ROWS ONLY;

       VAL
----------
         1
         1
         2
         2

4 rows selected.
</code></pre>

<h3>Using an offset, very useful for pagination</h3>

<pre><code>SELECT val
FROM   rownum_order_test
ORDER BY val
OFFSET 4 ROWS FETCH NEXT 4 ROWS ONLY;

       VAL
----------
         3
         3
         4
         4

4 rows selected.
</code></pre>

<h3>You can combine offset with percentages</h3>

<pre><code>SELECT val
FROM   rownum_order_test
ORDER BY val
OFFSET 4 ROWS FETCH NEXT 20 PERCENT ROWS ONLY;

       VAL
----------
         3
         3
         4
         4

4 rows selected.
</code></pre>
","26051830"
"How to reset AUTO_INCREMENT in MySQL?","885969","","<p>How can I reset the <code>auto_increment</code> of a field? I want it to start counting from <code>1</code> again.</p>
","<p>You can reset the counter with:</p>

<pre><code>ALTER TABLE tablename AUTO_INCREMENT = 1
</code></pre>

<p>For InnoDB you cannot set the <code>auto_increment</code> value lower or equal to the highest current index. (quote from <a href=""http://viralpatel.net/blogs/reseting-mysql-autoincrement-column/"" rel=""noreferrer"">ViralPatel</a>):</p>

<blockquote>
  <p>Note that you cannot reset the counter to a value less than or equal
  to any that have already been used. For MyISAM, if the value is less
  than or equal to the maximum value currently in the AUTO_INCREMENT
  column, the value is reset to the current maximum plus one. For
  InnoDB, if the value is less than the current maximum value in the
  column, no error occurs and the current sequence value is not changed.</p>
</blockquote>

<p>See <em><a href=""https://stackoverflow.com/q/2410689/367456"">How to Reset an MySQL AutoIncrement using a MAX value from another table?</a></em> on how to dynamically get an acceptable value.</p>
","8923132"
"Should I use != or <> for not equal in T-SQL?","820899","","<p>I have seen SQL that uses both <code>!=</code> and <code>&lt;&gt;</code> for <em>not equal</em>. What is the preferred syntax and why?</p>

<p>I like <code>!=</code>, because <code>&lt;&gt;</code> reminds me of Visual Basic.</p>
","<p>Technically they function the same if you’re using SQL&nbsp;Server AKA T-SQL.  If you're using it in stored procedures there is no performance reason to use one over the other. It then comes down to personal preference. I prefer to use &lt;> as it is ANSI compliant.</p>

<p>You can find links to the various ANSI standards at...</p>

<p><a href=""http://en.wikipedia.org/wiki/SQL"" rel=""noreferrer"">http://en.wikipedia.org/wiki/SQL</a></p>
","723317"
"Search text in stored procedure in SQL Server","812831","","<p>I want to search a text from all my database stored procedures. I use the below SQL:</p>

<pre><code>SELECT DISTINCT
       o.name AS Object_Name,
       o.type_desc
  FROM sys.sql_modules m
       INNER JOIN
       sys.objects o
         ON m.object_id = o.object_id
 WHERE m.definition Like '%[ABD]%';
</code></pre>

<p>I want to search for <code>[ABD]</code> in all stored procedures including square brackets, but it's not giving the proper result. How can I change my query to achieve this?</p>
","<p>Escape the square brackets:</p>

<pre><code>...
WHERE m.definition Like '%\[ABD\]%' ESCAPE '\'
</code></pre>

<p>Then the square brackets will be treated as a string literals not as wild cards.</p>
","14704157"
"SQL Inner-join with 3 tables?","811137","","<p>I'm trying to join 3 tables in a view; here is the situation:</p>

<p>I have a table that contains information of students who are applying to live on this College Campus. I have another table that lists the Hall Preferences (3 of them) for each Student. But each of these preferences are merely an ID Number, and the ID Number has a corresponding Hall Name in a third table (did not design this database...).</p>

<p>Pretty much, I have INNER JOIN on the table with their preferences, and their information, the result is something like...</p>

<pre><code> John Doe | 923423 | Incoming Student | 005
</code></pre>

<p>Where 005 would be the HallID. So Now I want to match that HallID to a third table, where this table contains a HallID and HallName.</p>

<p>So pretty much, I want my result to be like...</p>

<pre><code> John Doe | 923423 | Incoming Student | Foley Hall &lt;---(INSTEAD OF 005)
</code></pre>

<p><strong>EDIT</strong> here is what I currently Have</p>

<pre><code>SELECT
  s.StudentID, s.FName, 
  s.LName, s.Gender, s.BirthDate, s.Email, 
  r.HallPref1, r.HallPref2, r.HallPref3
FROM
  dbo.StudentSignUp AS s 
  INNER JOIN RoomSignUp.dbo.Incoming_Applications_Current AS r 
    ON s.StudentID = r.StudentID 
  INNER JOIN HallData.dbo.Halls AS h 
    ON r.HallPref1 = h.HallID
</code></pre>
","<p>You can do the following (I guessed on table fields,etc)</p>

<pre><code>SELECT s.studentname
    , s.studentid
    , s.studentdesc
    , h.hallname
FROM students s
INNER JOIN hallprefs hp
    on s.studentid = hp.studentid
INNER JOIN halls h
    on hp.hallid = h.hallid
</code></pre>

<p>EDIT:</p>

<p>Based on your request for multiple halls you could do it this way. You just join on your Hall table multiple times for each room pref id:</p>

<pre><code>SELECT     s.StudentID
    , s.FName
    , s.LName
    , s.Gender
    , s.BirthDate
    , s.Email
    , r.HallPref1
    , h1.hallName as Pref1HallName
    , r.HallPref2 
    , h2.hallName as Pref2HallName
    , r.HallPref3
    , h3.hallName as Pref3HallName
FROM  dbo.StudentSignUp AS s 
INNER JOIN RoomSignUp.dbo.Incoming_Applications_Current AS r 
    ON s.StudentID = r.StudentID 
INNER JOIN HallData.dbo.Halls AS h1 
    ON r.HallPref1 = h1.HallID
INNER JOIN HallData.dbo.Halls AS h2
    ON r.HallPref2 = h2.HallID
INNER JOIN HallData.dbo.Halls AS h3
    ON r.HallPref3 = h3.HallID
</code></pre>
","10195633"
"How to Delete using INNER JOIN with SQL Server?","800489","","<p>I want to delete using <code>INNER JOIN</code> in SQL Server 2008.</p>

<p>But I get this error,</p>

<blockquote>
  <p>Msg 156, Level 15, State 1, Line 15<br>
  ncorrect syntax near the keyword 'INNER'.</p>
</blockquote>

<p>My code:</p>

<pre><code>DELETE FROM WorkRecord2 
INNER JOIN Employee ON EmployeeRun=EmployeeNo
WHERE Company = '1' AND Date = '2013-05-06'
</code></pre>
","<p>You need to specify what table you are deleting from, here is a version with an alias:</p>

<pre><code>DELETE w
FROM WorkRecord2 w
INNER JOIN Employee e
  ON EmployeeRun=EmployeeNo
WHERE Company = '1' AND Date = '2013-05-06'
</code></pre>
","16481475"
"What's the difference between INNER JOIN, LEFT JOIN, RIGHT JOIN and FULL JOIN?","799062","","<p>What's the difference between <code>INNER JOIN</code>, <code>LEFT JOIN</code>, <code>RIGHT JOIN</code> and <code>FULL JOIN</code> 
in MySQL?</p>
","<p>Reading this original article on <strong>The Code Project</strong> will help you a lot: <a href=""http://www.codeproject.com/KB/database/Visual_SQL_Joins.aspx"" rel=""noreferrer"">Visual Representation of SQL Joins</a>.</p>

<p><img src=""https://i.stack.imgur.com/VQ5XP.png"" alt=""alt text""></p>

<p>Also check this post: <a href=""http://blog.sqlauthority.com/2008/04/22/sql-server-better-performance-left-join-or-not-in/"" rel=""noreferrer"">SQL SERVER – Better Performance – LEFT JOIN or NOT IN?</a>.</p>

<p>Find original one at: <a href=""https://stackoverflow.com/questions/3308122/how-do-i-decide-when-to-use-right-joins-left-joins-or-inner-joins-or-how-to-dete/3308153#3308153"">Difference between JOIN and OUTER JOIN in MySQL</a>.</p>
","6188334"
"Copy tables from one database to another in SQL Server","759195","","<p>I have a database called foo and a database called bar. I have a table in foo called tblFoobar that I want to move (data and all) to database bar from database foo. What is the SQL statement to do this?</p>
","<p>On SQL Server? and on the same database server? Use three part naming.</p>

<pre><code>INSERT INTO bar..tblFoobar( *fieldlist* )
SELECT *fieldlist* FROM foo..tblFoobar
</code></pre>

<p>This just moves the data.  If you want to move the table definition (and other attributes such as permissions and indexes), you'll have to do something else.</p>
","187785"
"How to list the tables in an SQLite database file that was opened with ATTACH?","754741","","<p>What SQL can be used to list the tables, and the rows within those tables in a SQLite database file - once I have attached it with the <code>ATTACH</code> command on the SQLite 3 command line tool?</p>
","<p>The <code>.tables</code>, and <code>.schema</code> ""helper"" functions don't look into ATTACHed databases: they just query the <code>SQLITE_MASTER</code> table for the ""main"" database. Consequently, if you used</p>

<pre><code>ATTACH some_file.db AS my_db;
</code></pre>

<p>then you need to do</p>

<pre><code>SELECT name FROM my_db.sqlite_master WHERE type='table';
</code></pre>

<p>Note that temporary tables don't show up with <code>.tables</code> either: you have to list <code>sqlite_temp_master</code> for that:</p>

<pre><code>SELECT name FROM sqlite_temp_master WHERE type='table';
</code></pre>
","83195"
"Convert INT to VARCHAR SQL","754602","","<p>I am using Sybase and I am doing a select which returns me a column called ""iftype"", but its type is int and I need to convert into varchar. When I try to do the select without the convert function I get this error:</p>

<blockquote>
  <p>Error code 257, SQL state 37000: Implicit conversion from datatype 'VARCHAR' to 'INT' is not allowed.  Use the CONVERT function to run this query.</p>
</blockquote>

<p>I dont know how to implement the function <code>CONVERT</code>. Can anyone help me, please ?</p>
","<p>Use the convert function.</p>

<pre><code>SELECT CONVERT(varchar(10), field_name) FROM table_name
</code></pre>
","19979620"
"Rename column SQL Server 2008","747855","","<p>I am using SQL Server 2008 and Navicat. I need to rename a column in a table using SQL.</p>

<pre><code>ALTER TABLE table_name RENAME COLUMN old_name to new_name;
</code></pre>

<p>This statement doesn't work.</p>
","<p>Use <code>sp_rename</code></p>

<pre><code>EXEC sp_RENAME 'TableName.OldColumnName' , 'NewColumnName', 'COLUMN'
</code></pre>

<p>See: <a href=""http://blog.sqlauthority.com/2008/08/26/sql-server-how-to-rename-a-column-name-or-table-name/"" rel=""noreferrer"">SQL SERVER – How to Rename a Column Name or Table Name</a></p>

<p>Documentation: <a href=""https://docs.microsoft.com/de-de/sql/relational-databases/system-stored-procedures/sp-rename-transact-sql"" rel=""noreferrer""><strong>sp_rename</strong> (Transact-SQL)</a></p>

<p>For your case it would be:</p>

<pre><code>EXEC sp_RENAME 'table_name.old_name', 'new_name', 'COLUMN'
</code></pre>

<p>Remember to use single quotes to enclose your values. </p>
","16296669"
"Get all table names of a particular database by SQL query?","733519","","<p>I am working on application which can deal with multiple database servers like ""MySQL"" and ""MS SQL Server"".</p>

<p>I want to get tables' names of a particular database using a general query which should suitable for all database types. I have tried following:</p>

<pre><code>SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE='BASE TABLE'
</code></pre>

<p>But it is giving table names of all databases of a particular server but I want to get tables names of selected database only. How can I restrict this query to get tables of a particular database?</p>
","<p>Probably due to the way different sql dbms deal with schemas.</p>

<p>Try the following</p>

<p>For SQL Server:</p>

<pre><code>SELECT TABLE_NAME
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_CATALOG='dbName'
</code></pre>

<p>For MySQL:</p>

<pre><code>SELECT TABLE_NAME 
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_SCHEMA='dbName' 
</code></pre>

<p>For Oracle I think the equivalent would be to use <code>DBA_TABLES</code>.</p>
","3914051"
"How do I split a string so I can access item x?","730921","","<p>Using SQL Server, how do I split a string so I can access item x?</p>

<p>Take a string ""Hello John Smith"". How can I split the string by space and access the item at index 1 which should return ""John""?</p>
","<p>You may find the solution in <em><a href=""http://www.codeproject.com/KB/database/SQL_UDF_to_Parse_a_String.aspx"" rel=""noreferrer"">SQL User Defined Function to Parse a Delimited String</a></em> helpful (from <a href=""http://en.wikipedia.org/wiki/The_Code_Project"" rel=""noreferrer"">The Code Project</a>).</p>

<p>You can use this simple logic:</p>

<pre><code>Declare @products varchar(200) = '1|20|3|343|44|6|8765'
Declare @individual varchar(20) = null

WHILE LEN(@products) &gt; 0
BEGIN
    IF PATINDEX('%|%', @products) &gt; 0
    BEGIN
        SET @individual = SUBSTRING(@products,
                                    0,
                                    PATINDEX('%|%', @products))
        SELECT @individual

        SET @products = SUBSTRING(@products,
                                  LEN(@individual + '|') + 1,
                                  LEN(@products))
    END
    ELSE
    BEGIN
        SET @individual = @products
        SET @products = NULL
        SELECT @individual
    END
END
</code></pre>
","2657"
"How to drop a table if it exists in SQL Server?","726453","","<p>The table name is <code>Scores</code>.</p>

<p>Is it correct to do the following?</p>

<pre><code>IF EXISTS(SELECT *
          FROM   dbo.Scores)
  DROP TABLE dbo.Scores 
</code></pre>
","<blockquote>
  <p>Is it correct to do the following?</p>

<pre><code>IF EXISTS(SELECT *
          FROM   dbo.Scores)
  DROP TABLE dbo.Scores
</code></pre>
</blockquote>

<p><strong>No.</strong>  That will drop the table only if it contains any rows (and will raise an error if the table does not exist).</p>

<p><strong>Instead, for a permanent table you can use</strong></p>

<pre><code>IF OBJECT_ID('dbo.Scores', 'U') IS NOT NULL 
  DROP TABLE dbo.Scores; 
</code></pre>

<p><strong>Or, for a temporary table you can use</strong></p>

<pre><code>IF OBJECT_ID('tempdb.dbo.#T', 'U') IS NOT NULL
  DROP TABLE #T; 
</code></pre>

<p>For anyone on SQL Server 2016+ I'll point out <a href=""https://stackoverflow.com/a/33497857/73226"">this answer</a> - which has a better way.</p>
","7887033"
"Convert Month Number to Month Name Function in SQL","724440","","<p>I have months stored in SQL Server as 1,2,3,4,...12. I would like to display them as January,February etc. Is there a function in SQL Server like MonthName(1) = January? I am trying to avoid a CASE statement, if possible.</p>
","<p>A little hacky but should work:</p>

<pre><code>SELECT DATENAME(month, DATEADD(month, @mydate-1, CAST('2008-01-01' AS datetime)))
</code></pre>
","185548"
"How do I (or can I) SELECT DISTINCT on multiple columns?","696462","","<p>I need to retrieve all rows from a table where 2 columns combined are all different. So I want all the sales that do not have any other sales that happened on the same day for the same price. The sales that are unique based on day and price will get updated to an active status.</p>

<p>So I'm thinking:</p>

<pre><code>UPDATE sales
SET status = 'ACTIVE'
WHERE id IN (SELECT DISTINCT (saleprice, saledate), id, count(id)
             FROM sales
             HAVING count = 1)
</code></pre>

<p>But my brain hurts going any farther than that.</p>
","<pre><code>SELECT DISTINCT a,b,c FROM t
</code></pre>

<p>is <em>roughly</em> equivalent to:  </p>

<pre><code>SELECT a,b,c FROM t GROUP BY a,b,c
</code></pre>

<p>It's a good idea to get used to the GROUP BY syntax, as it's more powerful.  </p>

<p>For your query, I'd do it like this:</p>

<pre><code>UPDATE sales
SET status='ACTIVE'
WHERE id IN
(
    SELECT id
    FROM sales S
    INNER JOIN
    (
        SELECT saleprice, saledate
        FROM sales
        GROUP BY saleprice, saledate
        HAVING COUNT(*) = 1 
    ) T
    ON S.saleprice=T.saleprice AND s.saledate=T.saledate
 )
</code></pre>
","54430"
"SQL select only rows with max value on a column","689677","","<p>I have this table for documents (simplified version here):</p>

<pre><code>+------+-------+--------------------------------------+
| id   | rev   | content                              |
+------+-------+--------------------------------------+
| 1    | 1     | ...                                  |
| 2    | 1     | ...                                  |
| 1    | 2     | ...                                  |
| 1    | 3     | ...                                  |
+------+-------+--------------------------------------+
</code></pre>

<p>How do I select one row per id and only the greatest rev?<br>
With the above data, the result should contain two rows: <code>[1, 3, ...]</code> and <code>[2, 1, ..]</code>. I'm using <strong>MySQL</strong>.</p>

<p>Currently I use checks in the <code>while</code> loop to detect and over-write old revs from the resultset. But is this the only method to achieve the result? Isn't there a <strong>SQL</strong> solution?</p>

<p><strong>Update</strong><br>
As the answers suggest, there <em>is</em> a SQL solution, and <a href=""http://sqlfiddle.com/#!9/3d74dc/1"" rel=""noreferrer"">here a sqlfiddle demo</a>. </p>

<p><strong>Update 2</strong><br>
I noticed after adding the above sqlfiddle, the rate at which the question is upvoted has surpassed the upvote rate of the answers. That has not been the intention! The fiddle <em>is</em> based on the answers, especially the accepted answer.</p>
","<h2>At first glance...</h2>

<p>All you need is a <code>GROUP BY</code> clause with the <code>MAX</code> aggregate function:</p>

<pre><code>SELECT id, MAX(rev)
FROM YourTable
GROUP BY id
</code></pre>

<h2>It's never that simple, is it?</h2>

<p>I just noticed you need the <code>content</code> column as well.</p>

<p>This is a very common question in SQL: find the whole data for the row with some max value in a column per some group identifier. I heard that a lot during my career. Actually, it was one the questions I answered in my current job's technical interview. </p>

<p>It is, actually, so common that StackOverflow community has created a single tag just to deal with questions like that: <a href=""/questions/tagged/greatest-n-per-group"" class=""post-tag"" title=""show questions tagged &#39;greatest-n-per-group&#39;"" rel=""tag"">greatest-n-per-group</a>.</p>

<p>Basically, you have two approaches to solve that problem:</p>

<h2>Joining with simple <code>group-identifier, max-value-in-group</code> Sub-query</h2>

<p>In this approach, you first find the <code>group-identifier, max-value-in-group</code> (already solved above) in a sub-query. Then you join your table to the sub-query with equality on both <code>group-identifier</code> and <code>max-value-in-group</code>:</p>

<pre><code>SELECT a.id, a.rev, a.contents
FROM YourTable a
INNER JOIN (
    SELECT id, MAX(rev) rev
    FROM YourTable
    GROUP BY id
) b ON a.id = b.id AND a.rev = b.rev
</code></pre>

<h2>Left Joining with self, tweaking join conditions and filters</h2>

<p>In this approach, you left join the table with itself. Equality, of course, goes in the <code>group-identifier</code>. Then, 2 smart moves: </p>

<ol>
<li>The second join condition is having left side value less than right value</li>
<li>When you do step 1, the row(s) that actually have the max value will have <code>NULL</code> in the right side (it's a <code>LEFT JOIN</code>, remember?). Then, we filter the joined result, showing only the rows where the right side is <code>NULL</code>.</li>
</ol>

<p>So you end up with:</p>

<pre><code>SELECT a.*
FROM YourTable a
LEFT OUTER JOIN YourTable b
    ON a.id = b.id AND a.rev &lt; b.rev
WHERE b.id IS NULL;
</code></pre>

<h2>Conclusion</h2>

<p>Both approaches bring the exact same result. </p>

<p>If you have two rows with <code>max-value-in-group</code> for <code>group-identifier</code>, both rows will be in the result in both approaches.</p>

<p>Both approaches are SQL ANSI compatible, thus, will work with your favorite RDBMS, regardless of its ""flavor"".</p>

<p>Both approaches are also performance friendly, however your mileage may vary (RDBMS, DB Structure, Indexes, etc.). So when you pick one approach over the other, <em>benchmark</em>. And make sure you pick the one which make most of sense to you.</p>
","7745635"
"How to insert a line break in a SQL Server VARCHAR/NVARCHAR string","683603","","<p>I didn't see any similar questions asked on this topic, and I had to research this for something I'm working on right now. Thought I would post the answer for it in case anyone else had the same question.</p>
","<p>I found the answer here: <a href=""http://blog.sqlauthority.com/2007/08/22/sql-server-t-sql-script-to-insert-carriage-return-and-new-line-feed-in-code/"" rel=""noreferrer"">http://blog.sqlauthority.com/2007/08/22/sql-server-t-sql-script-to-insert-carriage-return-and-new-line-feed-in-code/</a></p>

<p>You just concatenate the string and insert a <code>CHAR(13)</code> where you want your line break. </p>

<p>Example:</p>

<pre><code>DECLARE @text NVARCHAR(100)
SET @text = 'This is line 1.' + CHAR(13) + 'This is line 2.'
SELECT @text
</code></pre>

<p>This prints out the following:</p>

<blockquote>
  <p>This is line 1.<br>
  This is line 2.</p>
</blockquote>
","31063"
"Select statement to find duplicates on certain fields","678077","","<p>Can you help me with SQL statements to find duplicates on multiple fields?</p>

<p>For example, in pseudo code:</p>

<pre><code>select count(field1,field2,field3) 
from table 
where the combination of field1, field2, field3 occurs multiple times
</code></pre>

<p>and from the above statement <em>if there are multiple occurrences</em> I would like to select <em>every record except the first one</em>.</p>
","<p>To get the list of fields for which there are multiple records, you can use..</p>

<pre><code>select field1,field2,field3, count(*)
  from table_name
  group by field1,field2,field3
  having count(*) &gt; 1
</code></pre>

<p>Check this link for more information on how to delete the rows.</p>

<p><a href=""http://support.microsoft.com/kb/139444"" rel=""noreferrer"">http://support.microsoft.com/kb/139444</a></p>

<p>Edit : As the other users mentioned, there should be a criterion for deciding how you define ""first rows"" before you use the approach in the link above. Based on that you'll need to use an order by clause and a sub query if needed. If you can post some sample data, it would really help.</p>
","4434161"
"Convert Date format into DD/MMM/YYYY format in SQL Server","668323","","<p>I have a query in sql, I have to get date in a format of <code>dd/mmm/yy</code> </p>

<p>Example: <code>25/jun/2013</code>. </p>

<p>How can I convert it for SQL server?</p>
","<p>I'm not sure there is an exact match for the format you want. But you can get close with <a href=""http://msdn.microsoft.com/en-us/library/ms187928.aspx"" rel=""noreferrer""><code>convert()</code></a> and style <code>106</code>. Then, replace the spaces:</p>

<pre><code>SELECT replace(convert(NVARCHAR, getdate(), 106), ' ', '/')
</code></pre>
","17205494"
"How do I escape a single quote in SQL Server?","658585","","<p>I'm trying to insert some text data into a table in SQL Server 9.</p>

<p>The text includes a single quote.</p>

<p>How do I escape that?</p>

<p>I tried using two single quotes, but it threw me some errors.</p>

<p>eg. <code>insert into my_table values('hi, my name''s tim.');</code></p>
","<p><strong>Single quotes are escaped by doubling them up</strong>, just as you've shown us in your example. The following SQL illustrates this functionality. I tested it on SQL Server 2008:</p>

<pre><code>DECLARE @my_table TABLE (
    [value] VARCHAR(200)
)

INSERT INTO @my_table VALUES ('hi, my name''s tim.')

SELECT * FROM @my_table
</code></pre>

<h3>Results</h3>

<pre><code>value
==================
hi, my name's tim.
</code></pre>
","1586588"
"Get month and year from a datetime in SQL Server 2005","649301","","<p>I need the month+year from the datetime in SQL Server like 'Jan 2008'. I'm grouping the query by month, year. I've searched and found functions like datepart, convert, etc., but none of them seem useful for this. Am I missing something here? Is there a function for this?</p>
","<p>If you mean you want them back as a string, in that format;</p>

<pre><code>SELECT 
  CONVERT(CHAR(4), date_of_birth, 100) + CONVERT(CHAR(4), date_of_birth, 120) 
FROM customers
</code></pre>

<p><a href=""http://msdn.microsoft.com/en-us/library/ms187928.aspx"" rel=""noreferrer"">Here are the other format options</a></p>
","45548"
"How can an SQL query return data from multiple tables","649204","","<p>I would like to know the following:</p>

<ul>
<li>how to get data from multiple tables in my database?</li>
<li>what types of methods are there to do this?</li>
<li>what are joins and unions and how are they different from one another? </li>
<li>When should I use each one compared to the others?</li>
</ul>

<p>I am planning to use this in my (for example - PHP) application, but don't want to run multiple queries against the database, what options do I have to get data from multiple tables in a single query?</p>

<p>Note: I am writing this as I would like to be able to link to a well written guide on the numerous questions that I constantly come across in the PHP queue, so I can link to this for further detail when I post an answer.</p>

<p>The answers cover off the following:</p>

<ol>
<li><a href=""https://stackoverflow.com/questions/12475850/how-can-an-sql-query-return-data-from-multiple-tables/12475851#12475851"">Part 1 - Joins and Unions</a></li>
<li><a href=""https://stackoverflow.com/questions/12475850/how-can-an-sql-query-return-data-from-multiple-tables/12492267#12492267"">Part 2 - Subqueries</a></li>
<li><a href=""https://stackoverflow.com/questions/12475850/how-can-an-sql-query-return-data-from-multiple-tables/12508381#12508381"">Part 3 - Tricks and Efficient Code</a></li>
<li><a href=""https://stackoverflow.com/a/12542115/1450077"">Part 4 - Subqueries in the From Clause</a></li>
<li><a href=""https://stackoverflow.com/a/12586263/1450077"">Part 5 - Mixed Bag of John's Tricks</a></li>
</ol>
","<h1>Part 1 - Joins and Unions</h1>

<p>This answer covers:</p>

<ol>
<li>Part 1

<ul>
<li>Joining two or more tables using an inner join (See the <a href=""http://en.wikipedia.org/wiki/Join_%28SQL%29"" rel=""noreferrer"">wikipedia entry</a> for additional info)</li>
<li>How to use a union query</li>
<li>Left and Right Outer Joins (this <a href=""https://stackoverflow.com/a/4715847/1450077"">stackOverflow answer</a> is excellent to describe types of joins)</li>
<li>Intersect queries (and how to reproduce them if your database doesn't support them) - this is a function of SQL-Server (<a href=""https://stackoverflow.com/questions/148795/what-is-the-standard-sql-query-to-retrieve-the-intersection-of-tables"">see info</a>) and part of the <a href=""https://stackoverflow.com/questions/12443904/creating-query-that-returns-id-if-condition-is-matched-in-rows-from-two-tables/12455505#12455505"">reason I wrote this whole thing</a> in the first place.</li>
</ul></li>
<li>Part 2

<ul>
<li>Subqueries - what they are, where they can be used and what to watch out for</li>
<li>Cartesian joins AKA - Oh, the misery!</li>
</ul></li>
</ol>

<p>There are a number of ways to retrieve data from multiple tables in a database. In this answer, I will be using ANSI-92 join syntax. This may be different to a number of other tutorials out there which use the older ANSI-89 syntax (and if you are used to 89, may seem much less intuitive - but all I can say is to try it) as it is <em>much</em> easier to understand when the queries start getting more complex. Why use it? Is there a performance gain? The <a href=""https://stackoverflow.com/questions/334201/why-isnt-sql-ansi-92-standard-better-adopted-over-ansi-89"">short answer</a> is no, but it <em>is</em> easier to read once you get used to it. It is easier to read queries written by other folks using this syntax.</p>

<p>I am also going to use the concept of a small caryard which has a database to keep track of what cars it has available. The owner has hired you as his IT Computer guy and expects you to be able to drop him the data that he asks for at the drop of a hat.</p>

<p>I have made a number of lookup tables that will be used by the final table. This will give us a reasonable model to work from. To start off, I will be running my queries against an example database that has the following structure. I will try to think of common mistakes that are made when starting out and explain what goes wrong with them - as well as of course showing how to correct them.</p>

<p>The first table is simply a color listing so that we know what colors we have in the car yard.</p>

<pre><code>mysql&gt; create table colors(id int(3) not null auto_increment primary key, 
    -&gt; color varchar(15), paint varchar(10));
Query OK, 0 rows affected (0.01 sec)

mysql&gt; show columns from colors;
+-------+-------------+------+-----+---------+----------------+
| Field | Type        | Null | Key | Default | Extra          |
+-------+-------------+------+-----+---------+----------------+
| id    | int(3)      | NO   | PRI | NULL    | auto_increment |
| color | varchar(15) | YES  |     | NULL    |                |
| paint | varchar(10) | YES  |     | NULL    |                |
+-------+-------------+------+-----+---------+----------------+
3 rows in set (0.01 sec)

mysql&gt; insert into colors (color, paint) values ('Red', 'Metallic'), 
    -&gt; ('Green', 'Gloss'), ('Blue', 'Metallic'), 
    -&gt; ('White' 'Gloss'), ('Black' 'Gloss');
Query OK, 5 rows affected (0.00 sec)
Records: 5  Duplicates: 0  Warnings: 0

mysql&gt; select * from colors;
+----+-------+----------+
| id | color | paint    |
+----+-------+----------+
|  1 | Red   | Metallic |
|  2 | Green | Gloss    |
|  3 | Blue  | Metallic |
|  4 | White | Gloss    |
|  5 | Black | Gloss    |
+----+-------+----------+
5 rows in set (0.00 sec)
</code></pre>

<p>The brands table identifies the different brands of the cars out caryard could possibly sell.</p>

<pre><code>mysql&gt; create table brands (id int(3) not null auto_increment primary key, 
    -&gt; brand varchar(15));
Query OK, 0 rows affected (0.01 sec)

mysql&gt; show columns from brands;
+-------+-------------+------+-----+---------+----------------+
| Field | Type        | Null | Key | Default | Extra          |
+-------+-------------+------+-----+---------+----------------+
| id    | int(3)      | NO   | PRI | NULL    | auto_increment |
| brand | varchar(15) | YES  |     | NULL    |                |
+-------+-------------+------+-----+---------+----------------+
2 rows in set (0.01 sec)

mysql&gt; insert into brands (brand) values ('Ford'), ('Toyota'), 
    -&gt; ('Nissan'), ('Smart'), ('BMW');
Query OK, 5 rows affected (0.00 sec)
Records: 5  Duplicates: 0  Warnings: 0

mysql&gt; select * from brands;
+----+--------+
| id | brand  |
+----+--------+
|  1 | Ford   |
|  2 | Toyota |
|  3 | Nissan |
|  4 | Smart  |
|  5 | BMW    |
+----+--------+
5 rows in set (0.00 sec)
</code></pre>

<p>The model table will cover off different types of cars, it is going to be simpler for this to use different car types rather than actual car models.</p>

<pre><code>mysql&gt; create table models (id int(3) not null auto_increment primary key, 
    -&gt; model varchar(15));
Query OK, 0 rows affected (0.01 sec)

mysql&gt; show columns from models;
+-------+-------------+------+-----+---------+----------------+
| Field | Type        | Null | Key | Default | Extra          |
+-------+-------------+------+-----+---------+----------------+
| id    | int(3)      | NO   | PRI | NULL    | auto_increment |
| model | varchar(15) | YES  |     | NULL    |                |
+-------+-------------+------+-----+---------+----------------+
2 rows in set (0.00 sec)

mysql&gt; insert into models (model) values ('Sports'), ('Sedan'), ('4WD'), ('Luxury');
Query OK, 4 rows affected (0.00 sec)
Records: 4  Duplicates: 0  Warnings: 0

mysql&gt; select * from models;
+----+--------+
| id | model  |
+----+--------+
|  1 | Sports |
|  2 | Sedan  |
|  3 | 4WD    |
|  4 | Luxury |
+----+--------+
4 rows in set (0.00 sec)
</code></pre>

<p>And finally, to tie up all these other tables, the table that ties everything together. The ID field is actually the unique lot number used to identify cars.</p>

<pre><code>mysql&gt; create table cars (id int(3) not null auto_increment primary key, 
    -&gt; color int(3), brand int(3), model int(3));
Query OK, 0 rows affected (0.01 sec)

mysql&gt; show columns from cars;
+-------+--------+------+-----+---------+----------------+
| Field | Type   | Null | Key | Default | Extra          |
+-------+--------+------+-----+---------+----------------+
| id    | int(3) | NO   | PRI | NULL    | auto_increment |
| color | int(3) | YES  |     | NULL    |                |
| brand | int(3) | YES  |     | NULL    |                |
| model | int(3) | YES  |     | NULL    |                |
+-------+--------+------+-----+---------+----------------+
4 rows in set (0.00 sec)

mysql&gt; insert into cars (color, brand, model) values (1,2,1), (3,1,2), (5,3,1), 
    -&gt; (4,4,2), (2,2,3), (3,5,4), (4,1,3), (2,2,1), (5,2,3), (4,5,1);
Query OK, 10 rows affected (0.00 sec)
Records: 10  Duplicates: 0  Warnings: 0

mysql&gt; select * from cars;
+----+-------+-------+-------+
| id | color | brand | model |
+----+-------+-------+-------+
|  1 |     1 |     2 |     1 |
|  2 |     3 |     1 |     2 |
|  3 |     5 |     3 |     1 |
|  4 |     4 |     4 |     2 |
|  5 |     2 |     2 |     3 |
|  6 |     3 |     5 |     4 |
|  7 |     4 |     1 |     3 |
|  8 |     2 |     2 |     1 |
|  9 |     5 |     2 |     3 |
| 10 |     4 |     5 |     1 |
+----+-------+-------+-------+
10 rows in set (0.00 sec)
</code></pre>

<p>This will give us enough data (I hope) to cover off the examples below of different types of joins and also give enough data to make them worthwhile.</p>

<p>So getting into the grit of it, the boss wants to know <em>The IDs of all the sports cars he has</em>.</p>

<p>This is a simple two table join. We have a table that identifies the model and the table with the available stock in it. As you can see, the data in the <code>model</code> column of the <code>cars</code> table relates to the <code>models</code> column of the <code>cars</code> table we have. Now, we know that the models table has an ID of <code>1</code> for <code>Sports</code> so lets write the join.</p>

<pre><code>select
    ID,
    model
from
    cars
        join models
            on model=ID
</code></pre>

<p>So this query looks good right? We have identified the two tables and contain the information we need and use a join that correctly identifies what columns to join on.</p>

<pre><code>ERROR 1052 (23000): Column 'ID' in field list is ambiguous
</code></pre>

<p>Oh noes! An error in our first query! Yes, and it is a plum. You see, the query has indeed got the right columns, but some of them exist in both tables, so the database gets confused about what actual column we mean and where. There are two solutions to solve this. The first is nice and simple, we can use <code>tableName.columnName</code> to tell the database exactly what we mean, like this:</p>

<pre><code>select
    cars.ID,
    models.model
from
    cars
        join models
            on cars.model=models.ID

+----+--------+
| ID | model  |
+----+--------+
|  1 | Sports |
|  3 | Sports |
|  8 | Sports |
| 10 | Sports |
|  2 | Sedan  |
|  4 | Sedan  |
|  5 | 4WD    |
|  7 | 4WD    |
|  9 | 4WD    |
|  6 | Luxury |
+----+--------+
10 rows in set (0.00 sec)
</code></pre>

<p>The other is probably more often used and is called table aliasing. The tables in this example have nice and short simple names, but typing out something like <code>KPI_DAILY_SALES_BY_DEPARTMENT</code> would probably get old quickly, so a simple way is to nickname the table like this:</p>

<pre><code>select
    a.ID,
    b.model
from
    cars a
        join models b
            on a.model=b.ID
</code></pre>

<p>Now, back to the request. As you can see we have the information we need, but we also have information that wasn't asked for, so we need to include a where clause in the statement to only get the Sports cars as was asked. As I prefer the table alias method rather than using the table names over and over, I will stick to it from this point onwards.</p>

<p>Clearly, we need to add a where clause to our query. We can identify Sports cars either by <code>ID=1</code> or <code>model='Sports'</code>. As the ID is indexed and the primary key (and it happens to be less typing), lets use that in our query.</p>

<pre><code>select
    a.ID,
    b.model
from
    cars a
        join models b
            on a.model=b.ID
where
    b.ID=1

+----+--------+
| ID | model  |
+----+--------+
|  1 | Sports |
|  3 | Sports |
|  8 | Sports |
| 10 | Sports |
+----+--------+
4 rows in set (0.00 sec)
</code></pre>

<p>Bingo! The boss is happy. Of course, being a boss and never being happy with what he asked for, he looks at the information, then says <em>I want the colors as well</em>.</p>

<p>Okay, so we have a good part of our query already written, but we need to use a third table which is colors. Now, our main information table <code>cars</code> stores the car color ID and this links back to the colors ID column. So, in a similar manner to the original, we can join a third table:</p>

<pre><code>select
    a.ID,
    b.model
from
    cars a
        join models b
            on a.model=b.ID
        join colors c
            on a.color=c.ID
where
    b.ID=1

+----+--------+
| ID | model  |
+----+--------+
|  1 | Sports |
|  3 | Sports |
|  8 | Sports |
| 10 | Sports |
+----+--------+
4 rows in set (0.00 sec)
</code></pre>

<p>Damn, although the table was correctly joined and the related columns were linked, we forgot to pull in the actual <em>information</em> from the new table that we just linked.</p>

<pre><code>select
    a.ID,
    b.model,
    c.color
from
    cars a
        join models b
            on a.model=b.ID
        join colors c
            on a.color=c.ID
where
    b.ID=1

+----+--------+-------+
| ID | model  | color |
+----+--------+-------+
|  1 | Sports | Red   |
|  8 | Sports | Green |
| 10 | Sports | White |
|  3 | Sports | Black |
+----+--------+-------+
4 rows in set (0.00 sec)
</code></pre>

<p>Right, that's the boss off our back for a moment. Now, to explain some of this in a little more detail. As you can see, the <code>from</code> clause in our statement links our main table (I often use a table that contains information rather than a lookup or dimension table. The query would work just as well with the tables all switched around, but make less sense when we come back to this query to read it in a few months time, so it is often best to try to write a query that will be nice and easy to understand - lay it out intuitively, use nice indenting so that everything is as clear as it can be. If you go on to teach others, try to instill these characteristics in their queries - especially if you will be troubleshooting them.</p>

<p>It is entirely possible to keep linking more and more tables in this manner.</p>

<pre><code>select
    a.ID,
    b.model,
    c.color
from
    cars a
        join models b
            on a.model=b.ID
        join colors c
            on a.color=c.ID
        join brands d
            on a.brand=d.ID
where
    b.ID=1
</code></pre>

<p>While I forgot to include a table where we might want to join more than one column in the <code>join</code> statement, here is an example. If the <code>models</code> table had brand-specific models and therefore also had a column called <code>brand</code> which linked back to the <code>brands</code> table on the <code>ID</code> field, it could be done as this:</p>

<pre><code>select
    a.ID,
    b.model,
    c.color
from
    cars a
        join models b
            on a.model=b.ID
        join colors c
            on a.color=c.ID
        join brands d
            on a.brand=d.ID
            and b.brand=d.ID
where
    b.ID=1
</code></pre>

<p>You can see, the query above not only links the joined tables to the main <code>cars</code> table, but also specifies joins between the already joined tables. If this wasn't done, the result is called a cartesian join - which is dba speak for bad. A cartesian join is one where rows are returned because the information doesn't tell the database how to limit the results, so the query returns <em>all</em> the rows that fit the criteria.</p>

<p>So, to give an example of a cartesian join, lets run the following query:</p>

<pre><code>select
    a.ID,
    b.model
from
    cars a
        join models b

+----+--------+
| ID | model  |
+----+--------+
|  1 | Sports |
|  1 | Sedan  |
|  1 | 4WD    |
|  1 | Luxury |
|  2 | Sports |
|  2 | Sedan  |
|  2 | 4WD    |
|  2 | Luxury |
|  3 | Sports |
|  3 | Sedan  |
|  3 | 4WD    |
|  3 | Luxury |
|  4 | Sports |
|  4 | Sedan  |
|  4 | 4WD    |
|  4 | Luxury |
|  5 | Sports |
|  5 | Sedan  |
|  5 | 4WD    |
|  5 | Luxury |
|  6 | Sports |
|  6 | Sedan  |
|  6 | 4WD    |
|  6 | Luxury |
|  7 | Sports |
|  7 | Sedan  |
|  7 | 4WD    |
|  7 | Luxury |
|  8 | Sports |
|  8 | Sedan  |
|  8 | 4WD    |
|  8 | Luxury |
|  9 | Sports |
|  9 | Sedan  |
|  9 | 4WD    |
|  9 | Luxury |
| 10 | Sports |
| 10 | Sedan  |
| 10 | 4WD    |
| 10 | Luxury |
+----+--------+
40 rows in set (0.00 sec)
</code></pre>

<p>Good god, that's ugly. However, as far as the database is concerned, it is <em>exactly</em> what was asked for. In the query, we asked for for the <code>ID</code> from <code>cars</code> and the <code>model</code> from <code>models</code>. However, because we didn't specify <em>how</em> to join the tables, the database has matched <em>every</em> row from the first table with <em>every</em> row from the second table.</p>

<p>Okay, so the boss is back, and he wants more information again. <em>I want the same list, but also include 4WDs in it</em>.</p>

<p>This however, gives us a great excuse to look at two different ways to accomplish this. We could add another condition to the where clause like this:</p>

<pre><code>select
    a.ID,
    b.model,
    c.color
from
    cars a
        join models b
            on a.model=b.ID
        join colors c
            on a.color=c.ID
        join brands d
            on a.brand=d.ID
where
    b.ID=1
    or b.ID=3
</code></pre>

<p>While the above will work perfectly well, lets look at it differently, this is a great excuse to show how a <code>union</code> query will work.</p>

<p>We know that the following will return all the Sports cars:</p>

<pre><code>select
    a.ID,
    b.model,
    c.color
from
    cars a
        join models b
            on a.model=b.ID
        join colors c
            on a.color=c.ID
        join brands d
            on a.brand=d.ID
where
    b.ID=1
</code></pre>

<p>And the following would return all the 4WDs:</p>

<pre><code>select
    a.ID,
    b.model,
    c.color
from
    cars a
        join models b
            on a.model=b.ID
        join colors c
            on a.color=c.ID
        join brands d
            on a.brand=d.ID
where
    b.ID=3
</code></pre>

<p>So by adding a <code>union all</code> clause between them, the results of the second query will be appended to the results of the first query.</p>

<pre><code>select
    a.ID,
    b.model,
    c.color
from
    cars a
        join models b
            on a.model=b.ID
        join colors c
            on a.color=c.ID
        join brands d
            on a.brand=d.ID
where
    b.ID=1
union all
select
    a.ID,
    b.model,
    c.color
from
    cars a
        join models b
            on a.model=b.ID
        join colors c
            on a.color=c.ID
        join brands d
            on a.brand=d.ID
where
    b.ID=3

+----+--------+-------+
| ID | model  | color |
+----+--------+-------+
|  1 | Sports | Red   |
|  8 | Sports | Green |
| 10 | Sports | White |
|  3 | Sports | Black |
|  5 | 4WD    | Green |
|  7 | 4WD    | White |
|  9 | 4WD    | Black |
+----+--------+-------+
7 rows in set (0.00 sec)
</code></pre>

<p>As you can see, the results of the first query are returned first, followed by the results of the second query.</p>

<p>In this example, it would of course have been much easier to simply use the first query, but <code>union</code> queries can be great for specific cases. They are a great way to return specific results from tables from tables that aren't easily joined together - or for that matter <em>completely</em> unrelated tables. There are a few rules to follow however.</p>

<ul>
<li>The column types from the first query must match the column types from every other query below.</li>
<li>The names of the columns from the first query will be used to identify the entire set of results.</li>
<li>The number of columns in each query must be the same.</li>
</ul>

<p>Now, you might <a href=""https://stackoverflow.com/questions/49925/what-is-the-difference-between-union-and-union-all"">be wondering what the</a> difference is between using <code>union</code> and <code>union all</code>. A <code>union</code> query will remove duplicates, while a <code>union all</code> will not. This does mean that there is a small performance hit when using <code>union</code> over <code>union all</code> but the results may be worth it - I won't speculate on that sort of thing in this though.</p>

<p>On this note, it might be worth noting some additional notes here.</p>

<ul>
<li>If we wanted to order the results, we can use an <code>order by</code> but you can't use the alias anymore. In the query above, appending an <code>order by a.ID</code> would result in an error - as far as the results are concerned, the column is called <code>ID</code> rather than <code>a.ID</code> - even though the same alias has been used in both queries.</li>
<li>We can only have one <code>order by</code> statement, and it must be as the last statement.</li>
</ul>

<p>For the next examples, I am adding a few extra rows to our tables.</p>

<p>I have added <code>Holden</code> to the brands table.
I have also added a row into <code>cars</code> that has the <code>color</code> value of <code>12</code> - which has no reference in the colors table.</p>

<p>Okay, the boss is back again, barking requests out - *I want a count of each brand we carry and the number of cars in it!` - Typical, we just get to an interesting section of our discussion and the boss wants more work.</p>

<p>Rightyo, so the first thing we need to do is get a complete listing of possible brands.</p>

<pre><code>select
    a.brand
from
    brands a

+--------+
| brand  |
+--------+
| Ford   |
| Toyota |
| Nissan |
| Smart  |
| BMW    |
| Holden |
+--------+
6 rows in set (0.00 sec)
</code></pre>

<p>Now, when we join this to our cars table we get the following result:</p>

<pre><code>select
    a.brand
from
    brands a
        join cars b
            on a.ID=b.brand
group by
    a.brand

+--------+
| brand  |
+--------+
| BMW    |
| Ford   |
| Nissan |
| Smart  |
| Toyota |
+--------+
5 rows in set (0.00 sec)
</code></pre>

<p>Which is of course a problem - we aren't seeing any mention of the lovely <code>Holden</code> brand I added.</p>

<p>This is because a join looks for matching rows in <em>both</em> tables. As there is no data in cars that is of type <code>Holden</code> it isn't returned. This is where we can use an <code>outer</code> join. This will return <em>all</em> the results from one table whether they are matched in the other table or not:</p>

<pre><code>select
    a.brand
from
    brands a
        left outer join cars b
            on a.ID=b.brand
group by
    a.brand

+--------+
| brand  |
+--------+
| BMW    |
| Ford   |
| Holden |
| Nissan |
| Smart  |
| Toyota |
+--------+
6 rows in set (0.00 sec)
</code></pre>

<p>Now that we have that, we can add a lovely aggregate function to get a count and get the boss off our backs for a moment.</p>

<pre><code>select
    a.brand,
    count(b.id) as countOfBrand
from
    brands a
        left outer join cars b
            on a.ID=b.brand
group by
    a.brand

+--------+--------------+
| brand  | countOfBrand |
+--------+--------------+
| BMW    |            2 |
| Ford   |            2 |
| Holden |            0 |
| Nissan |            1 |
| Smart  |            1 |
| Toyota |            5 |
+--------+--------------+
6 rows in set (0.00 sec)
</code></pre>

<p>And with that, away the boss skulks.</p>

<p>Now, to explain this in some more detail, outer joins can be of the <code>left</code> or <code>right</code> type. The Left or Right defines which table is <em>fully</em> included. A <code>left outer join</code> will include all the rows from the table on the left, while (you guessed it) a <code>right outer join</code> brings all the results from the table on the right into the results.</p>

<p>Some databases will allow a <code>full outer join</code> which will bring back results (whether matched or not) from <em>both</em> tables, but this isn't supported in all databases.</p>

<p>Now, I probably figure at this point in time, you are wondering whether or not you can merge join types in a query - and the answer is yes, you absolutely can.</p>

<pre><code>select
    b.brand,
    c.color,
    count(a.id) as countOfBrand
from
    cars a
        right outer join brands b
            on b.ID=a.brand
        join colors c
            on a.color=c.ID
group by
    a.brand,
    c.color

+--------+-------+--------------+
| brand  | color | countOfBrand |
+--------+-------+--------------+
| Ford   | Blue  |            1 |
| Ford   | White |            1 |
| Toyota | Black |            1 |
| Toyota | Green |            2 |
| Toyota | Red   |            1 |
| Nissan | Black |            1 |
| Smart  | White |            1 |
| BMW    | Blue  |            1 |
| BMW    | White |            1 |
+--------+-------+--------------+
9 rows in set (0.00 sec)
</code></pre>

<p>So, why is that not the results that were expected? It is because although we have selected the outer join from cars to brands, it wasn't specified in the join to colors - so that particular join will only bring back results that match in both tables.</p>

<p>Here is the query that would work to get the results that we expected:</p>

<pre><code>select
    a.brand,
    c.color,
    count(b.id) as countOfBrand
from
    brands a
        left outer join cars b
            on a.ID=b.brand
        left outer join colors c
            on b.color=c.ID
group by
    a.brand,
    c.color

+--------+-------+--------------+
| brand  | color | countOfBrand |
+--------+-------+--------------+
| BMW    | Blue  |            1 |
| BMW    | White |            1 |
| Ford   | Blue  |            1 |
| Ford   | White |            1 |
| Holden | NULL  |            0 |
| Nissan | Black |            1 |
| Smart  | White |            1 |
| Toyota | NULL  |            1 |
| Toyota | Black |            1 |
| Toyota | Green |            2 |
| Toyota | Red   |            1 |
+--------+-------+--------------+
11 rows in set (0.00 sec)
</code></pre>

<p>As we can see, we have two outer joins in the query and the results are coming through as expected.</p>

<p>Now, how about those other types of joins you ask? What about Intersections?</p>

<p>Well, not all databases support the <code>intersection</code> but pretty much all databases will allow you to create an intersection through a join (or a well structured where statement at the least).</p>

<p>An Intersection is a type of join somewhat similar to a <code>union</code> as described above - but the difference is that it <em>only</em> returns rows of data that are identical (and I do mean identical) between the various individual queries joined by the union. Only rows that are identical in every regard will be returned.</p>

<p>A simple example would be as such:</p>

<pre><code>select
    *
from
    colors
where
    ID&gt;2
intersect
select
    *
from
    colors
where
    id&lt;4
</code></pre>

<p>While a normal <code>union</code> query would return all the rows of the table (the first query returning anything over <code>ID&gt;2</code> and the second anything having <code>ID&lt;4</code>) which would result in a full set, an intersect query would only return the row matching <code>id=3</code> as it meets both criteria.</p>

<p>Now, if your database doesn't support an <code>intersect</code> query, the above can be easily accomlished with the following query:</p>

<pre><code>select
    a.ID,
    a.color,
    a.paint
from
    colors a
        join colors b
            on a.ID=b.ID
where
    a.ID&gt;2
    and b.ID&lt;4

+----+-------+----------+
| ID | color | paint    |
+----+-------+----------+
|  3 | Blue  | Metallic |
+----+-------+----------+
1 row in set (0.00 sec)
</code></pre>

<p>If you wish to perform an intersection across two different tables using a database that doesn't inherently support an intersection query, you will need to create a join on <em>every column</em> of the tables.</p>
","12475851"
"Sql Server string to date conversion","643654","","<p>I want to convert a string like this:</p>

<pre><code>'10/15/2008 10:06:32 PM'
</code></pre>

<p>into the equivalent DATETIME value in Sql Server.</p>

<p>In Oracle, I would say this:</p>

<pre><code>TO_DATE('10/15/2008 10:06:32 PM','MM/DD/YYYY HH:MI:SS AM')
</code></pre>

<p><a href=""https://stackoverflow.com/questions/202243/custom-datetime-formatting-in-sql-server"">This question</a> implies that I must parse the string into one of the <a href=""http://www.sql-server-helper.com/tips/date-formats.aspx"" rel=""noreferrer"">standard formats</a>, and then convert using one of those codes.  That seems ludicrous for such a mundane operation.  Is there an easier way?</p>
","<p>SQL Server (2005, 2000, 7.0) does not have any flexible, or even non-flexible, way of taking an arbitrarily structured datetime in string format and converting it to the datetime data type.</p>

<p>By ""arbitrarily"", I mean ""a form that the person who wrote it, though perhaps not you or I or someone on the other side of the planet, would consider to be intuitive and completely obvious.""  Frankly, I'm not sure there is any such algorithm.</p>
","248310"
"How do I see active SQL Server connections?","640207","","<p>I am using SQL Server 2008 Enterprise. I want to see any active SQL Server connections, and the related information of all the connections, like from which IP address, connect to which database or something.</p>

<p>Are there existing tools to solve this issue?</p>
","<p>You can use the <a href=""http://msdn.microsoft.com/en-us/library/ms174313.aspx"" rel=""noreferrer""><code>sp_who</code></a> stored procedure. </p>

<blockquote>
  <p>Provides information about current users, sessions, and processes in an instance of the Microsoft SQL Server Database Engine. The information can be filtered to return only those processes that are not idle, that belong to a specific user, or that belong to a specific session.</p>
</blockquote>
","1248426"
"How to create id with AUTO_INCREMENT on Oracle?","633099","","<p>It appears that there is no concept of AUTO_INCREMENT in Oracle, up until and including version 11g.</p>

<p>How can I create a column that behaves like auto increment in Oracle 11g?</p>
","<p>There is no such thing as ""auto_increment"" or ""identity"" columns in Oracle <em>as of Oracle 11g</em>. However, you can model it easily with a sequence and a trigger:</p>

<p>Table definition:</p>

<pre><code>CREATE TABLE departments (
  ID           NUMBER(10)    NOT NULL,
  DESCRIPTION  VARCHAR2(50)  NOT NULL);

ALTER TABLE departments ADD (
  CONSTRAINT dept_pk PRIMARY KEY (ID));

CREATE SEQUENCE dept_seq START WITH 1;
</code></pre>

<p>Trigger definition:</p>

<pre><code>CREATE OR REPLACE TRIGGER dept_bir 
BEFORE INSERT ON departments 
FOR EACH ROW

BEGIN
  SELECT dept_seq.NEXTVAL
  INTO   :new.id
  FROM   dual;
END;
/
</code></pre>

<h3>UPDATE:</h3>

<p><a href=""http://docs.oracle.com/database/121/DRDAA/migr_tools_feat.htm#DRDAA109"" rel=""noreferrer""><code>IDENTITY</code></a> column is now available on Oracle 12c:</p>

<pre><code>create table t1 (
    c1 NUMBER GENERATED by default on null as IDENTITY,
    c2 VARCHAR2(10)
    );
</code></pre>

<p>or specify starting and increment values, also preventing any insert into the identity column (<code>GENERATED ALWAYS</code>) (again, Oracle 12c+ only)</p>

<pre><code>create table t1 (
    c1 NUMBER GENERATED ALWAYS as IDENTITY(START with 1 INCREMENT by 1),
    c2 VARCHAR2(10)
    );
</code></pre>
","11296469"
"Getting only Month and Year from SQL DATE","630895","","<p>I need to access only Month.Year from Date field in SQL Server.</p>

<p>.</p>
","<p>As well as the suggestions given already, there is one other possiblity I can infer from your question:<br>
- You still want the result to be a date<br>
- But you want to 'discard' the Days, Hours, etc<br>
- Leaving a year/month only date field  </p>

<pre><code>SELECT
   DATEADD(MONTH, DATEDIFF(MONTH, 0, &lt;dateField&gt;), 0) AS [year_month_date_field]
FROM
   &lt;your_table&gt;
</code></pre>

<p>This gets the number of whole months from a base date (0) and then adds them to that base date.  Thus rounding Down to the month in which the date is in.</p>

<p>NOTE: In SQL Server 2008, You will still have the TIME attached as 00:00:00.000
This is not exactly the same as ""removing"" any notation of day and time altogether.
Also the DAY set to the first. e.g. 2009-10-01 00:00:00.000</p>
","1783411"
"Oracle SQL: Update a table with data from another table","629920","","<p>Table 1:</p>

<pre><code>id    name    desc
-----------------------
1     a       abc
2     b       def
3     c       adf
</code></pre>

<p>Table 2:</p>

<pre><code>id    name    desc
-----------------------
1     x       123
2     y       345
</code></pre>

<p>In oracle SQL, how do I run an <strong>sql update</strong> query that can update Table 1 with Table 2's <code>name</code> and <code>desc</code> using the same <code>id</code>? So the end result I would get is</p>

<p>Table 1:</p>

<pre><code>id    name    desc
-----------------------
1     x       123
2     y       345
3     c       adf
</code></pre>

<p>Question is taken from <a href=""https://stackoverflow.com/questions/5036918/sql-update-query-with-data-from-another-table"">update one table with data from another</a>, but specifically for oracle SQL.</p>
","<p>This is called a correlated update</p>

<pre><code>UPDATE table1 t1
   SET (name, desc) = (SELECT t2.name, t2.desc
                         FROM table2 t2
                        WHERE t1.id = t2.id)
 WHERE EXISTS (
    SELECT 1
      FROM table2 t2
     WHERE t1.id = t2.id )
</code></pre>

<p>Assuming the join results in a key-preserved view, you could also</p>

<pre><code>UPDATE (SELECT t1.id, 
               t1.name name1,
               t1.desc desc1,
               t2.name name2,
               t2.desc desc2
          FROM table1 t1,
               table2 t2
         WHERE t1.id = t2.id)
   SET name1 = name2,
       desc1 = desc2
</code></pre>
","7031405"
"SQL update query using joins","628438","","<p>I have to update a field with a value which is returned by a join of 3 tables.</p>

<p>Example: </p>

<pre><code>select
    im.itemid
    ,im.sku as iSku
    ,gm.SKU as GSKU
    ,mm.ManufacturerId as ManuId
    ,mm.ManufacturerName
    ,im.mf_item_number
    ,mm.ManufacturerID
from 
    item_master im, group_master gm, Manufacturer_Master mm 
where
    im.mf_item_number like 'STA%'
    and im.sku=gm.sku
    and gm.ManufacturerID = mm.ManufacturerID
    and gm.manufacturerID=34
</code></pre>

<p>I want to update the <code>mf_item_number</code> field values of table <code>item_master</code> with some other value which is joined in the above condition.</p>

<p>How can I do this in MS SQL Server?</p>
","<pre><code>UPDATE im
SET mf_item_number = gm.SKU --etc
FROM item_master im
JOIN group_master gm
    ON im.sku = gm.sku 
JOIN Manufacturer_Master mm
    ON gm.ManufacturerID = mm.ManufacturerID
WHERE im.mf_item_number like 'STA%' AND
      gm.manufacturerID = 34
</code></pre>

<p>To make it clear... The <code>UPDATE</code> clause can refer to an table alias specified in the <code>FROM</code> clause. So <code>im</code> in this case is valid</p>

<h3>Generic example</h3>

<pre><code>UPDATE A
SET foo = B.bar
FROM TableA A
JOIN TableB B
    ON A.col1 = B.colx
WHERE ...
</code></pre>
","982947"
"SQL/mysql - Select distinct/UNIQUE but return all columns?","620690","","<pre><code>SELECT DISTINCT field1, field2, field3, ......   FROM table
</code></pre>

<p>I am trying to accomplish the following sql statement but I want it to return all columns is this possible? Something like:</p>

<pre><code>SELECT DISTINCT field1, * from table
</code></pre>
","<p>You're looking for a group by:</p>

<pre><code>select *
from table
group by field1
</code></pre>

<p>Which can occasionally be written with a distinct on statement:</p>

<pre><code>select distinct on field1 *
from table
</code></pre>

<p>On most platforms, however, neither of the above will work because the behavior on the other columns is unspecified. (The first works in MySQL, if that's what you're using.)</p>

<p>You could fetch the distinct fields and stick to picking a single arbitrary row each time.</p>

<p>On some platforms (e.g. PostgreSQL, Oracle, T-SQL) this can be done directly using window functions:</p>

<pre><code>select *
from (
   select *,
          row_number() over (partition by field1 order by field2) as row_number
   from table
   ) as rows
where row_number = 1
</code></pre>

<p>On others (MySQL, SQLite), you'll need to write subqueries that will make you join the entire table with itself (<a href=""https://stackoverflow.com/questions/6109894/how-to-efficiently-determine-changes-between-rows-using-sql/6110200#6110200"">example</a>), so not recommended.</p>
","6127471"
"How to replace a string in a SQL Server Table Column","618693","","<p>I have a table (SQL Sever) which references paths (UNC or otherwise), but now the path is going to change. In the path column, I have many records and I need to change just a portion of the path, but not the entire path. And I need to change the same string to the new one, in every record.</p>

<p>How can I do this with a simple update?</p>
","<p>It's this easy:</p>

<pre><code>update my_table
set path = replace(path, 'oldstring', 'newstring')
</code></pre>
","814551"
"How to create Temp table with SELECT * INTO tempTable FROM CTE Query","616354","","<p>I have a MS SQL CTE query from which I want to create a temporary table. I am not sure how to do it as it gives an <code>Invalid Object name</code> error.</p>

<p>Below is the whole query for reference</p>

<pre><code>SELECT * INTO TEMPBLOCKEDDATES FROM 
;with Calendar as (
    select EventID, EventTitle, EventStartDate, EventEndDate, EventEnumDays,EventStartTime,EventEndTime, EventRecurring, EventStartDate as PlannedDate
    ,EventType from EventCalender
    where EventActive = 1 AND LanguageID =1 AND EventBlockDate = 1
    union all
    select EventID, EventTitle, EventStartDate, EventEndDate, EventEnumDays,EventStartTime,EventEndTime, EventRecurring, dateadd(dd, 1, PlannedDate)
    ,EventType from Calendar
    where EventRecurring = 1
        and dateadd(dd, 1, PlannedDate) &lt;= EventEndDate 
)
select EventID, EventStartDate, EventEndDate, PlannedDate as [EventDates], Cast(PlannedDate As datetime) AS DT, Cast(EventStartTime As time) AS ST,Cast(EventEndTime As time) AS ET, EventTitle
,EventType from Calendar
where (PlannedDate &gt;= GETDATE()) AND ',' + EventEnumDays + ',' like '%,' + cast(datepart(dw, PlannedDate) as char(1)) + ',%'
    or EventEnumDays is null
order by EventID, PlannedDate
option (maxrecursion 0)
</code></pre>

<p>I would appreciate a point in the right direction or if I can create a temporary table from this CTE query </p>
","<h2>Sample DDL</h2>

<pre><code>create table #Temp
(
    EventID int, 
    EventTitle Varchar(50), 
    EventStartDate DateTime, 
    EventEndDate DatetIme, 
    EventEnumDays int,
    EventStartTime Datetime,
    EventEndTime DateTime, 
    EventRecurring Bit, 
    EventType int
)
</code></pre>

<hr>

<pre><code>;WITH Calendar
AS (SELECT /*...*/)

Insert Into #Temp
Select EventID, EventStartDate, EventEndDate, PlannedDate as [EventDates], Cast(PlannedDate As datetime) AS DT, Cast(EventStartTime As time) AS ST,Cast(EventEndTime As time) AS ET, EventTitle
,EventType from Calendar
where (PlannedDate &gt;= GETDATE()) AND ',' + EventEnumDays + ',' like '%,' + cast(datepart(dw, PlannedDate) as char(1)) + ',%'
    or EventEnumDays is null
</code></pre>

<hr>

<p>Make sure that the table is deleted after use</p>

<pre><code>If(OBJECT_ID('tempdb..#temp') Is Not Null)
Begin
    Drop Table #Temp
End
</code></pre>
","11491353"
"How do I query for all dates greater than a certain date in SQL Server?","607508","","<p>I'm trying: </p>

<pre><code>SELECT * 
FROM dbo.March2010 A
WHERE A.Date &gt;= 2010-04-01;
</code></pre>

<p><code>A.Date</code> looks like: <code>2010-03-04 00:00:00.000</code></p>

<p>However, this is not working. Can anyone provide a reference for why?</p>
","<pre><code>select *  
from dbo.March2010 A 
where A.Date &gt;= Convert(datetime, '2010-04-01' )
</code></pre>

<p>In your query, <code>2010-4-01</code> is treated as a mathematical expression, so in essence it read </p>

<pre><code>select *  
from dbo.March2010 A 
where A.Date &gt;= 2005; 
</code></pre>

<p>(<code>2010 minus 4 minus 1 is 2005</code>
Converting it to a proper <code>datetime</code>, and using single quotes will fix this issue.)</p>

<p>Technically, the parser might allow you to get away with</p>

<pre><code>select *  
from dbo.March2010 A 
where A.Date &gt;= '2010-04-01'
</code></pre>

<p>it will do the conversion for you, but in my opinion it is less readable than explicitly converting to a <code>DateTime</code> for the maintenance programmer that will come after you.</p>
","10643403"
"How to turn IDENTITY_INSERT on and off using SQL Server 2008?","606866","","<p>Why am I getting an error doing an insert when <code>IDENTITY_INSERT</code> is set to OFF?  </p>

<p>How do I turn it on properly in SQL Server 2008? Is it by using SQL Server Management Studio?</p>

<p>I have run this query:</p>

<pre><code>SET IDENTITY_INSERT Database. dbo. Baskets ON
</code></pre>

<p>Then I got the message back in the console that the Command(s) completed successfully.
However when I run the application, it still gives me the error shown below:</p>

<pre><code>Cannot insert explicit value for identity column in table 'Baskets' when 
IDENTITY_INSERT is set to OFF.
</code></pre>
","<p>Via SQL as per <a href=""https://docs.microsoft.com/en-us/sql/t-sql/statements/set-identity-insert-transact-sql"" rel=""noreferrer"">MSDN</a></p>

<pre><code>SET IDENTITY_INSERT sometableWithIdentity ON

INSERT sometableWithIdentity (IdentityColumn, col2, col3, ...)
VALUES (AnIdentityValue, col2value, col3value, ...)

SET IDENTITY_INSERT sometableWithIdentity OFF
</code></pre>

<p>The complete error message tells you <em>exactly</em> what is wrong...</p>

<blockquote>
  <p>Cannot insert explicit value for identity column in table 'sometableWithIdentity' when IDENTITY_INSERT is set to OFF.</p>
</blockquote>
","7063527"
"Select first row in each GROUP BY group?","602671","","

<p>As the title suggests, I'd like to select the first row of each set of rows grouped with a <code>GROUP BY</code>.</p>

<p>Specifically, if I've got a <code>purchases</code> table that looks like this:</p>

<pre class=""lang-sql prettyprint-override""><code>SELECT * FROM purchases;
</code></pre>

<pre>
id | customer | total
---+----------+------
 1 | Joe      | 5
 2 | Sally    | 3
 3 | Joe      | 2
 4 | Sally    | 1
</pre>

<p>I'd like to query for the <code>id</code> of the largest purchase (<code>total</code>) made by each <code>customer</code>. Something like this:</p>

<pre class=""lang-sql prettyprint-override""><code>SELECT FIRST(id), customer, FIRST(total)
FROM  purchases
GROUP BY customer
ORDER BY total DESC;
</code></pre>

<pre>
FIRST(id) | customer | FIRST(total)
----------+----------+-------------
        1 | Joe      | 5
        2 | Sally    | 3
</pre>
","<h2>On Oracle 9.2+ (not 8i+ as originally stated), SQL Server 2005+, PostgreSQL 8.4+, DB2, Firebird 3.0+, Teradata, Sybase, Vertica:</h2>

<pre><code>WITH summary AS (
    SELECT p.id, 
           p.customer, 
           p.total, 
           ROW_NUMBER() OVER(PARTITION BY p.customer 
                                 ORDER BY p.total DESC) AS rk
      FROM PURCHASES p)
SELECT s.*
  FROM summary s
 WHERE s.rk = 1
</code></pre>

<h2>Supported by any database:</h2>

<p>But you need to add logic to break ties:</p>

<pre><code>  SELECT MIN(x.id),  -- change to MAX if you want the highest
         x.customer, 
         x.total
    FROM PURCHASES x
    JOIN (SELECT p.customer,
                 MAX(total) AS max_total
            FROM PURCHASES p
        GROUP BY p.customer) y ON y.customer = x.customer
                              AND y.max_total = x.total
GROUP BY x.customer, x.total
</code></pre>
","3800572"
"Best way to get identity of inserted row?","601911","","<p>What is the best way to get identity of inserted row?</p>

<p>I know about <code>@@IDENTITY</code> and <code>IDENT_CURRENT</code> and <code>SCOPE_IDENTITY</code> but don't understand the pros and cons attached to each.</p>

<p>Can someone please explain the differences and when I should be using each?</p>
","<ul>
<li><p><a href=""http://msdn.microsoft.com/en-us/library/ms187342.aspx"" rel=""noreferrer""><code>@@IDENTITY</code></a> returns the last identity value generated for any table in the current session, across all scopes.  <strong>You need to be careful here</strong>, since it's across scopes.  You could get a value from a trigger, instead of your current statement.</p></li>
<li><p><a href=""http://msdn.microsoft.com/en-us/library/ms190315.aspx"" rel=""noreferrer""><code>SCOPE_IDENTITY()</code></a> returns the last identity value generated for any table in the current session and the current scope.  <strong>Generally what you want to use</strong>.</p></li>
<li><p><a href=""http://msdn.microsoft.com/en-us/library/ms175098.aspx"" rel=""noreferrer""><code>IDENT_CURRENT('tableName')</code></a> returns the last identity value generated for a specific table in any session and any scope.  This lets you specify which table you want the value from, in case the two above aren't quite what you need (<strong>very rare</strong>).  Also, as @<a href=""https://stackoverflow.com/questions/42648/best-way-to-get-identity-of-inserted-row#42665"">Guy Starbuck</a> mentioned, ""You could use this if you want to get the current IDENTITY value for a table that you have not inserted a record into.""</p></li>
<li><p>The <a href=""http://msdn.microsoft.com/en-us/library/ms177564.aspx"" rel=""noreferrer""><code>OUTPUT</code> clause</a> of the <code>INSERT</code> statement will let you access every row that was inserted via that statement.  Since it's scoped to the specific statement, it's <strong>more straightforward</strong> than the other functions above.  However, it's a little <strong>more verbose</strong> (you'll need to insert into a table variable/temp table and then query that) and it gives results even in an error scenario where the statement is rolled back.  That said, if your query uses a parallel execution plan, this is the <strong>only guaranteed method</strong> for getting the identity (short of turning off parallelism). However, it is executed <em>before</em> triggers and cannot be used to return trigger-generated values.</p></li>
</ul>
","42655"
"SQL Server SELECT INTO @variable?","599357","","<p>I have the following code in one of my Sql (2008) Stored Procs which executes perfectly fine:</p>

<pre><code>    CREATE PROCEDURE [dbo].[Item_AddItem]
        @CustomerId uniqueidentifier,
        @Description nvarchar(100),
        @Type int,
        @Username nvarchar(100),
    AS
    BEGIN

        DECLARE @TopRelatedItemId uniqueidentifier;
        SET @TopRelatedItemId = 
        (
           SELECT top(1) RelatedItemId 
           FROM RelatedItems 
           WHERE CustomerId = @CustomerId
        ) 

        DECLARE @TempItem TABLE
        (
            ItemId uniqueidentifier,
            CustomerId uniqueidentifier,
            Description nvarchar(100),
            Type int,
            Username nvarchar(100),
            TimeStamp datetime
        );

        INSERT INTO Item
        OUTPUT INSERTED.* INTO @TempItem
        SELECT NEWID(), @CustomerId, @Description, @Type, @Username, GETDATE()

        SELECT
            ItemId,
            CustomerId,
            @TopRelatedItemId,
            Description,
            Type,
            Username,
            TimeStamp
        FROM
            @TempItem
END
GO
</code></pre>

<p><strong>So the question for you guys is is there a possibility to do something along the lines of:</strong></p>

<pre><code>DECLARE @TempCustomer TABLE
(
   CustomerId uniqueidentifier,
   FirstName nvarchar(100),
   LastName nvarchar(100),
   Email nvarchar(100)
);
SELECT 
    CustomerId, 
    FirstName, 
    LastName, 
    Email 
INTO 
    @TempCustomer 
FROM 
    Customer
WHERE 
    CustomerId = @CustomerId
</code></pre>

<p>So that I could reuse this data from memory in other following statements? SQL Server throws a fit with the above statement, however i don't want to have to create separate variables and initialize each one of them via a separate SELECT statement against the same table.... UGH!!!</p>

<p>Any suggestions on how to achieve something along the lines without multiple queries against the same table?</p>
","<p>You cannot SELECT .. INTO .. a TABLE VARIABLE. The best you can do is create it first, then insert into it.  Your 2nd snippet has to be</p>

<pre><code>DECLARE @TempCustomer TABLE
(
   CustomerId uniqueidentifier,
   FirstName nvarchar(100),
   LastName nvarchar(100),
   Email nvarchar(100)
);
INSERT INTO 
    @TempCustomer 
SELECT 
    CustomerId, 
    FirstName, 
    LastName, 
    Email 
FROM 
    Customer
WHERE 
    CustomerId = @CustomerId
</code></pre>
","4823953"
"Adding an identity to an existing column","595672","","<p>I need to change the primary key of a table to an identity column, and there's already a number of rows in table. </p>

<p>I've got a script to clean up the IDs to ensure they're sequential starting at 1, works fine on my test database. </p>

<p>What's the SQL command to alter the column to have an identity property?</p>
","<p>You can't alter the existing columns for identity.</p>

<p>You have 2 options,</p>

<ol>
<li><p>Create a new table with identity &amp; drop the existing table</p></li>
<li><p>Create a new column with identity &amp; drop the existing column</p></li>
</ol>

<p>Approach 1. (<em>New table</em>) Here you can retain the existing data values on the newly created identity column.</p>

<pre><code>CREATE TABLE dbo.Tmp_Names
    (
      Id int NOT NULL
             IDENTITY(1, 1),
      Name varchar(50) NULL
    )
ON  [PRIMARY]
go

SET IDENTITY_INSERT dbo.Tmp_Names ON
go

IF EXISTS ( SELECT  *
            FROM    dbo.Names ) 
    INSERT  INTO dbo.Tmp_Names ( Id, Name )
            SELECT  Id,
                    Name
            FROM    dbo.Names TABLOCKX
go

SET IDENTITY_INSERT dbo.Tmp_Names OFF
go

DROP TABLE dbo.Names
go

Exec sp_rename 'Tmp_Names', 'Names'
</code></pre>

<p>Approach 2 (<em>New column</em>) You can’t retain the existing data values on the newly created identity column, The identity column will hold the sequence of number.</p>

<pre><code>Alter Table Names
Add Id_new Int Identity(1, 1)
Go

Alter Table Names Drop Column ID
Go

Exec sp_rename 'Names.Id_new', 'ID', 'Column'
</code></pre>

<p>See the following Microsoft SQL Server Forum post for more details:</p>

<p><a href=""http://social.msdn.microsoft.com/forums/en-US/transactsql/thread/04d69ee6-d4f5-4f8f-a115-d89f7bcbc032"" rel=""noreferrer"">How to alter column to identity(1,1)</a></p>
","1049305"
"SQL: IF clause within WHERE clause","593102","","<p>Is it possible to use an <strong>IF</strong> clause within a <strong>WHERE</strong> clause in MS SQL?</p>

<p>Example:</p>

<pre><code>WHERE
    IF IsNumeric(@OrderNumber) = 1
        OrderNumber = @OrderNumber
    ELSE
        OrderNumber LIKE '%' + @OrderNumber + '%'
</code></pre>
","<p>Use a <a href=""http://msdn.microsoft.com/en-us/library/ms181765.aspx"" rel=""noreferrer"">CASE</a> statement<br>
<strong>UPDATE:</strong> The previous syntax (as pointed out by a few people) doesn't work.  You can use CASE as follows:</p>

<pre><code>WHERE OrderNumber LIKE
  CASE WHEN IsNumeric(@OrderNumber) = 1 THEN 
    @OrderNumber 
  ELSE
    '%' + @OrderNumber
  END
</code></pre>

<p>Or you can use an IF statement like @<a href=""https://stackoverflow.com/questions/87821/sql-if-clause-within-where-clause#87992"">N. J. Reed</a> points out.</p>
","87839"
"SQL Server - SELECT FROM stored procedure","592692","","<p>I have a stored procedure that returns rows:</p>

<pre><code>CREATE PROCEDURE MyProc
AS
BEGIN
    SELECT * FROM MyTable
END
</code></pre>

<p>My actual procedure is a little more complicated, which is why a sproc is necessary.</p>

<p>Is it possible to select the output by calling this procedure?</p>

<p>Something like:</p>

<pre><code>SELECT * FROM (EXEC MyProc) AS TEMP
</code></pre>

<p>I need to use <code>SELECT TOP X</code>, <code>ROW_NUMBER</code>, and an additional <code>WHERE</code> clause to page my data, and I don't really want to pass these values as parameters.</p>
","<p>You can use a <a href=""https://docs.microsoft.com/en-us/sql/relational-databases/user-defined-functions/user-defined-functions"" rel=""noreferrer"">User-defined function</a> or a <a href=""https://docs.microsoft.com/en-us/sql/relational-databases/views/views"" rel=""noreferrer"">view</a> instead of a procedure.</p>

<p>A procedure can return multiple result sets, each with its own schema. It's not suitable for using in a <code>SELECT</code> statement.</p>
","1492446"
"SQL Server query - Selecting COUNT(*) with DISTINCT","591911","","<p>In SQL Server 2005 I have a table cm_production that lists all the code that's been put into production. The table has a ticket_number, program_type, and program_name and push_number along with some other columns. </p>

<p>GOAL: Count all the DISTINCT program names by program type and push number</p>

<p>What I have so far is:</p>

<pre><code>SELECT DISTINCT COUNT(*) AS Count, program_type AS [Type] 
FROM cm_production 
WHERE push_number=@push_number 
GROUP BY program_type
</code></pre>

<p>This gets me partway there, but it's counting all the program names, not the distinct ones (which I don't expect it to do in that query). I guess I just can't wrap my head around how to tell it to count only the distinct program names without selecting them. Or something. </p>
","<blockquote>
  <p>Count all the DISTINCT program names
  by program type and push number</p>
</blockquote>

<pre><code>SELECT COUNT(DISTINCT program_name) AS Count,
  program_type AS [Type] 
FROM cm_production 
WHERE push_number=@push_number 
GROUP BY program_type
</code></pre>

<p>DISTINCT COUNT(*) will return a row for each unique count. What you want is <a href=""http://msdn.microsoft.com/en-us/library/ms175997.aspx"" rel=""noreferrer"">COUNT(DISTINCT <em>expression</em>)</a>: evaluates expression for each row in a group and returns the number of unique, nonnull values.</p>
","1521656"
"How does database indexing work?","589416","","<p>Given that indexing is so important as your data set increases in size, can someone explain how does indexing work at a database-agnostic level?</p>

<p>For information on queries to index a field, check out <a href=""https://stackoverflow.com/questions/1156/"">How do I index a database column</a>.</p>
","<p><strong>Why is it needed?</strong></p>

<p>When data is stored on disk based storage devices, it is stored as blocks of data. These blocks are accessed in their entirety, making them the atomic disk access operation. Disk blocks are structured in much the same way as linked lists; both contain a section for data, a pointer to the location of the next node (or block), and both need not be stored contiguously.</p>

<p>Due to the fact that a number of records can only be sorted on one field, we can state that searching on a field that isn’t sorted requires a Linear Search which requires <code>N/2</code> block accesses (on average), where <code>N</code> is the number of blocks that the table spans. If that field is a non-key field (i.e. doesn’t contain unique entries) then the entire table space must be searched at <code>N</code> block accesses.</p>

<p>Whereas with a sorted field, a Binary Search may be used, which has <code>log2 N</code> block accesses. Also since the data is sorted given a non-key field, the rest of the table doesn’t need to be searched for duplicate values, once a higher value is found. Thus the performance increase is substantial.</p>

<p><strong>What is indexing?</strong></p>

<p>Indexing is a way of sorting a number of records on multiple fields. Creating an index on a field in a table creates another data structure which holds the field value, and pointer to the record it relates to. This index structure is then sorted, allowing Binary Searches to be performed on it.</p>

<p>The downside to indexing is that these indexes require additional space on the disk, since the indexes are stored together in a table using the MyISAM engine, this file can quickly reach the size limits of the underlying file system if many fields within the same table are indexed.</p>

<p><strong>How does it work?</strong></p>

<p>Firstly, let’s outline a sample database table schema; </p>

<pre>
Field name       Data type      Size on disk
id (Primary key) Unsigned INT   4 bytes
firstName        Char(50)       50 bytes
lastName         Char(50)       50 bytes
emailAddress     Char(100)      100 bytes
</pre>

<p><strong>Note</strong>: char was used in place of varchar to allow for an accurate size on disk value. 
This sample database contains five million rows, and is unindexed. The performance of several queries will now be analyzed. These are a query using the <em>id</em> (a sorted key field) and one using the <em>firstName</em> (a non-key unsorted field).</p>

<p><strong><em>Example 1</em></strong> - <em>sorted vs unsorted fields</em></p>

<p>Given our sample database of <code>r = 5,000,000</code> records of a fixed size giving a record length of <code>R = 204</code> bytes and they are stored in a table using the MyISAM engine which is using the default block size <code>B = 1,024</code> bytes. The blocking factor of the table would be <code>bfr = (B/R) = 1024/204 = 5</code> records per disk block. The total number of blocks required to hold the table is <code>N = (r/bfr) = 5000000/5 = 1,000,000</code> blocks. </p>

<p>A linear search on the id field would require an average of <code>N/2 = 500,000</code> block accesses to find a value, given that the id field is a key field. But since the id field is also sorted, a binary search can be conducted requiring an average of <code>log2 1000000 = 19.93 = 20</code> block accesses. Instantly we can see this is a drastic improvement.</p>

<p>Now the <em>firstName</em> field is neither sorted nor a key field, so a binary search is impossible, nor are the values unique, and thus the table will require searching to the end for an exact <code>N = 1,000,000</code> block accesses. It is this situation that indexing aims to correct.</p>

<p>Given that an index record contains only the indexed field and a pointer to the original record, it stands to reason that it will be smaller than the multi-field record that it points to. So the index itself requires fewer disk blocks than the original table, which therefore requires fewer block accesses to iterate through. The schema for an index on the <em>firstName</em> field is outlined below; </p>

<pre>
Field name       Data type      Size on disk
firstName        Char(50)       50 bytes
(record pointer) Special        4 bytes
</pre>

<p><strong>Note</strong>: Pointers in MySQL are 2, 3, 4 or 5 bytes in length depending on the size of the table.</p>

<p><strong><em>Example 2</em></strong>  - <em>indexing</em></p>

<p>Given our sample database of <code>r = 5,000,000</code> records with an index record length of <code>R = 54</code> bytes and using the default block size <code>B = 1,024</code> bytes. The blocking factor of the index would be <code>bfr = (B/R) = 1024/54 = 18</code> records per disk block. The total number of blocks required to hold the index is <code>N = (r/bfr) = 5000000/18 = 277,778</code> blocks.</p>

<p>Now a search using the <em>firstName</em> field can utilise the index to increase performance. This allows for a binary search of the index with an average of <code>log2 277778 = 18.08 = 19</code> block accesses. To find the address of the actual record, which requires a further block access to read, bringing the total to <code>19 + 1 = 20</code> block accesses, a far cry from the 1,000,000 block accesses required to find a <em>firstName</em> match in the non-indexed table.</p>

<p><strong>When should it be used?</strong></p>

<p>Given that creating an index requires additional disk space (277,778 blocks extra from the above example, a ~28% increase), and that too many indexes can cause issues arising from the file systems size limits, careful thought must be used to select the correct fields to index.</p>

<p>Since indexes are only used to speed up the searching for a matching field within the records, it stands to reason that indexing fields used only for output would be simply a waste of disk space and processing time when doing an insert or delete operation, and thus should be avoided. Also given the nature of a binary search, the cardinality or uniqueness of the data is important. Indexing on a field with a cardinality of 2 would split the data in half, whereas a cardinality of 1,000 would return approximately 1,000 records. With such a low cardinality the effectiveness is reduced to a linear sort, and the query optimizer will avoid using the index if the cardinality is less than 30% of the record number, effectively making the index a waste of space.</p>
","1130"
"How to create a table from select query result in SQL Server 2008","584992","","<p>I want to create a table from select query result in SQL Server, I tried </p>

<pre><code>create table temp AS select.....
</code></pre>

<p>but I got an error </p>

<blockquote>
  <p>Incorrect syntax near the keyword 'AS'</p>
</blockquote>
","<p>Use following syntax to create new table from old table in SQL server 2008</p>

<pre><code>Select * into new_table  from  old_table 
</code></pre>
","16683927"
"Get day of week in SQL 2005/2008","573761","","<p>If I have a date 01/01/2009, I want to find out what day it was e.g. Monday, Tuesday, etc...</p>

<p>Is there a built-in function for this in SQL 2005/2008? Or do I need to use an auxiliary table?</p>
","<p>Use <a href=""https://docs.microsoft.com/en-us/sql/t-sql/functions/datename-transact-sql"" rel=""noreferrer""><code>DATENAME</code></a> or <a href=""https://docs.microsoft.com/en-us/sql/t-sql/functions/datepart-transact-sql"" rel=""noreferrer""><code>DATEPART</code></a>:</p>

<pre><code>SELECT DATENAME(dw,GETDATE()) -- Friday
SELECT DATEPART(dw,GETDATE()) -- 6
</code></pre>
","1111013"
"SQL - Rounding off to 2 decimal places","573579","","<p>I need to convert minutes to hours, rounded off to 2 decimal places.I also need to display only up to 2 numbers after the decimal point. So if I have minutes as 650.Then hours should be 10.83</p>

<p>Here's what I have so far:</p>

<pre><code>Select round(Minutes/60.0,2) from ....
</code></pre>

<p>But in this case, if my minutes is, say,630 - hours is 10.5000000. But I want it as 10.50 only(after rounding). How do I achieve this?</p>
","<p>Could you not cast your result as <code>numeric(x,2)</code>? Where <code>x &lt;= 38</code></p>

<pre><code>select 
    round(630/60.0,2), 
    cast(round(630/60.0,2) as numeric(36,2))
</code></pre>

<p>Returns</p>

<pre><code>10.500000   10.50
</code></pre>
","10380227"
"Reset identity seed after deleting records in SQL Server","569555","","<p>I have inserted records into a SQL Server database table. The table had a primary key defined and the auto increment identity seed is set to “Yes”. This is done primarily because in SQL Azure, each table has to have a primary key and identity defined. </p>

<p>But since I have to delete some records from the table, the identity seed for those tables will be disturbed and the index column (which is auto-generated with an increment of 1) will get disturbed.</p>

<p><strong>How can I reset the identity column after I deleted the records so that the column has sequence in ascending numerical order?</strong></p>

<p>The identity column is not used as a foreign key anywhere in database.</p>
","<p>The <a href=""http://technet.microsoft.com/en-us/library/ms176057.aspx"" rel=""noreferrer""><code>DBCC CHECKIDENT</code></a> management command is used to reset identity counter. The command syntax is:</p>

<pre><code>DBCC CHECKIDENT (table_name [, { NORESEED | { RESEED [, new_reseed_value ]}}])
[ WITH NO_INFOMSGS ]
</code></pre>

<p>Example: </p>

<pre><code>DBCC CHECKIDENT ('[TestTable]', RESEED, 0);
GO
</code></pre>

<p>It was not supported in a previous versions of Azure SQL Database, but is supported now.</p>

<hr>

<p>Please note that <code>new_reseed_value</code> argument is varied across SQL Server versions <a href=""https://docs.microsoft.com/en-us/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql"" rel=""noreferrer"">according to documentation</a>: </p>

<blockquote>
  <p>If rows are present in the table, the next row is inserted with the <em>new_reseed_value</em> value. In version SQL Server 2008 R2 and earlier, the next row inserted uses <em>new_reseed_value</em> + the current increment value.</p>
</blockquote>

<p>However, <strong>I find this information misleading</strong> (just plain wrong actually) because observed behaviour indicates that at least SQL Server 2012 is still uses <em>new_reseed_value</em> + the current increment value logic. Microsoft even contradicts with its own <code>Example C</code> found on same page:</p>

<blockquote>
  <p>C. Forcing the current identity value to a new value</p>
  
  <p>The following example forces the current identity value in the
  AddressTypeID column in the AddressType table to a value of 10.
  Because the table has existing rows, the next row inserted will use 11
  as the value, that is, the new current increment value defined for the
  column value plus 1.</p>
</blockquote>

<pre><code>USE AdventureWorks2012;  
GO  
DBCC CHECKIDENT ('Person.AddressType', RESEED, 10);  
GO
</code></pre>

<p>Still, this all leaves an option for different behaviour on newer SQL Server versions. I guess the only way to be sure, until Microsoft clear up things in its own documentation, is to do actual tests before usage.</p>
","21824729"
"SQL multiple column ordering","563664","","<p>I am trying to sort by multiple columns in SQL, and in different directions. <code>column1</code> would be sorted descending, and <code>column2</code> ascending.</p>

<p>How can I do this?</p>
","<pre><code>ORDER BY column1 DESC, column2
</code></pre>

<p>This sorts everything by <code>column1</code> (descending) first, and then by <code>column2</code> (ascending, which is the default) whenever the <code>column1</code> fields for two rows are equal. </p>
","2051176"
"How do I set a column value to NULL in SQL Server Management Studio?","562286","","<p>How do I clear the value from a cell and make it NULL?</p>
","<p>If you've opened a table and you want to clear an existing value to NULL, click on the value, and press <kbd><code>Ctrl</code></kbd>+<kbd><code>0</code></kbd>.</p>
","444658"
"Best approach to remove time part of datetime in SQL Server","561892","","<p>Which method provides the best performance when removing the time portion from a datetime field in SQL Server?</p>

<pre><code>a) select DATEADD(dd, DATEDIFF(dd, 0, getdate()), 0)
</code></pre>

<p>or</p>

<pre><code>b) select cast(convert(char(11), getdate(), 113) as datetime)
</code></pre>

<p>The second method does send a few more bytes either way but that might not be as important as the speed of the conversion.</p>

<p>Both also appear to be very fast, but there might be a difference in speed when dealing with hundreds-of-thousands or more rows?</p>

<p>Also, is it possible that there are even better methods to get rid of the time portion of a datetime in SQL?</p>
","<p>Strictly, method <code>a</code> is the least resource intensive:</p>

<pre><code>a) select DATEADD(dd, DATEDIFF(dd, 0, getdate()), 0)
</code></pre>

<p>Proven less CPU intensive for same total duration a million rows by some one with way too much time on their hands: <a href=""https://stackoverflow.com/questions/133081/most-efficient-way-in-sql-server-to-get-date-from-datetime"">Most efficient way in SQL Server to get date from date+time?</a></p>

<p>I saw a similar test elsewhere with similar results too.</p>

<p>I prefer the DATEADD/DATEDIFF because:</p>

<ul>
<li>varchar is subject to language/dateformat issues<br>
Example: <a href=""https://stackoverflow.com/q/3596663/27535"">Why is my CASE expression non-deterministic?</a></li>
<li>float relies on internal storage</li>
<li>it extends to work out first day of month, tomorrow etc by changing ""0"" base</li>
</ul>

<p><strong>Edit, Oct 2011</strong></p>

<p>For SQL Server 2008+, you can CAST to <code>date</code>. Or just use <code>date</code> so no time to remove.</p>

<p><strong>Edit, Jan 2012</strong></p>

<p>A worked example of how flexible this is: <a href=""https://stackoverflow.com/questions/8722022/need-to-calculate-by-rounded-time-or-date-figure-in-sql-server/8723311#8723311"">Need to calculate by rounded time or date figure in sql server</a></p>

<p><strong>Edit, May 2012</strong></p>

<p>Do not use this in WHERE clauses and the like without thinking: adding a function or CAST to a column invalidates index usage. See number 2 here: <a href=""http://www.simple-talk.com/sql/t-sql-programming/ten-common-sql-programming-mistakes/"" rel=""noreferrer"">http://www.simple-talk.com/sql/t-sql-programming/ten-common-sql-programming-mistakes/</a></p>

<p>Now, this does have an example of later SQL Server optimiser versions managing CAST to date correctly, but <em>generally</em> it will be a bad idea ...</p>
","1177529"
"Sql query to insert datetime in SQL Server","561728","","<p>I want to insert a <code>datetime</code> value into a table(SQL Server) using the sql query below</p>

<pre><code>insert into table1(approvaldate)values(18-06-12 10:34:09 AM);
</code></pre>

<p>But I get this Error msg. <code>Incorrect syntax near '10'.</code></p>

<p>I tried it with the quotes</p>

<pre><code>insert into table1(approvaldate)values('18-06-12 10:34:09 AM');
</code></pre>

<p>I get this error message <code>Cannot convert varchar to datetime</code></p>

<p>Kindly help! 
Thanks.</p>
","<p>You will want to use the YYYYMMDD for unambiguous date determination in SQL Server.</p>

<pre><code>insert into table1(approvaldate)values('20120618 10:34:09 AM');
</code></pre>

<p>If you are married to the <code>dd-mm-yy hh:mm:ss xm</code> format, you will need to use CONVERT with the specific style.</p>

<pre><code>insert table1 (approvaldate)
       values (convert(datetime,'18-06-12 10:34:09 PM',5));
</code></pre>

<p><strong><code>5</code></strong> here is the style for Italian dates.  Well, not just Italians, but that's the culture it's attributed to in <a href=""http://msdn.microsoft.com/en-us/library/ms187928.aspx"">Books Online</a>.</p>
","12957690"
"How to find third or nth maximum salary from salary table?","559057","","<p>How to find <code>third or nth</code> maximum salary from salary <code>table(EmpID,EmpName,EmpSalary)</code> in Optimized way?</p>
","<p>Use <code>ROW_NUMBER</code>(if you want a single) or <code>DENSE_RANK</code>(for all related rows):</p>

<pre><code>WITH CTE AS
(
    SELECT EmpID, EmpName, EmpSalary,
           RN = ROW_NUMBER() OVER (ORDER BY EmpSalary DESC)
    FROM dbo.Salary
)
SELECT EmpID, EmpName, EmpSalary
FROM CTE
WHERE RN = @NthRow
</code></pre>
","16235035"
"How can I get column names from a table in Oracle?","557126","","<p>I need to query the database to get the <em>column names</em>, not to be confused with data in the table.  For example, if I have a table named <code>EVENT_LOG</code> that contains <code>eventID</code>, <code>eventType</code>, <code>eventDesc</code>, and <code>eventTime</code>, then I would want to retrieve those field names from the query and nothing else.</p>

<p>I found how to do this in:</p>

<ul>
<li><a href=""https://stackoverflow.com/q/1054984/419956"">Microsoft SQL Server</a></li>
<li><a href=""https://stackoverflow.com/q/193780/419956"">MySQL</a></li>
<li><a href=""https://dba.stackexchange.com/q/22362/5089"">PostgreSQL</a></li>
</ul>

<p>But I need to know: <strong>how can this be done in <em>Oracle</em>?</strong></p>
","<p>You can query the USER_TAB_COLUMNS table for table column metadata.</p>

<pre><code>SELECT table_name, column_name, data_type, data_length
FROM USER_TAB_COLUMNS
WHERE table_name = 'MYTABLE'
</code></pre>
","452476"
"How to select the nth row in a SQL database table?","552996","","<p>I'm interested in learning some (ideally) database agnostic ways of selecting the <em>n</em>th row from a database table. It would also be interesting to see how this can be achieved using the native functionality of the following databases: </p>

<ul>
<li>SQL Server</li>
<li>MySQL</li>
<li>PostgreSQL</li>
<li>SQLite</li>
<li>Oracle</li>
</ul>

<p>I am currently doing something like the following in SQL Server 2005, but I'd be interested in seeing other's more agnostic approaches:</p>

<pre><code>WITH Ordered AS (
SELECT ROW_NUMBER() OVER (ORDER BY OrderID) AS RowNumber, OrderID, OrderDate
FROM Orders)
SELECT *
FROM Ordered
WHERE RowNumber = 1000000
</code></pre>

<p>Credit for the above SQL: <a href=""http://weblogs.asp.net/Firoz/archive/2005/06/12/411949.aspx"" rel=""noreferrer"">Firoz Ansari's Weblog</a></p>

<p><strong>Update:</strong> See <a href=""https://stackoverflow.com/questions/16568/how-to-select-the-nth-row-in-a-sql-database-table#42765"">Troels Arvin's answer</a> regarding the SQL standard. <em>Troels, have you got any links we can cite?</em></p>
","<p>There are ways of doing this in optional parts of the standard, but a lot of databases support their own way of doing it.</p>

<p>A really good site that talks about this and other things is <a href=""http://troels.arvin.dk/db/rdbms/#select-limit"" rel=""noreferrer"">http://troels.arvin.dk/db/rdbms/#select-limit</a>.</p>

<p>Basically, PostgreSQL and MySQL supports the non-standard:</p>

<pre><code>SELECT...
LIMIT y OFFSET x 
</code></pre>

<p>Oracle, DB2 and MSSQL supports the standard windowing functions:</p>

<pre><code>SELECT * FROM (
  SELECT
    ROW_NUMBER() OVER (ORDER BY key ASC) AS rownumber,
    columns
  FROM tablename
) AS foo
WHERE rownumber &lt;= n
</code></pre>

<p>(which I just copied from the site linked above since I never use those DBs)</p>

<p><em>Update:</em> As of PostgreSQL 8.4 the standard windowing functions are supported, so expect the second example to work for PostgreSQL as well. </p>
","16777"
"Using group by on multiple columns","552888","","<p>I understand the point of <code>group by x</code> </p>

<p>But how does <code>group by x, y</code> work and what does it mean?</p>
","<p><code>Group By X</code> means <strong>put all those with the same value for X in the one group</strong>.</p>

<p><code>Group By X, Y</code> means <strong>put all those with the same values for both X and Y in the one group</strong>.</p>

<p>To illustrate using an example, let's say we have the following table, to do with who is attending what subject at a university:</p>

<pre><code>Table: Subject_Selection

Subject   Semester   Attendee
---------------------------------
ITB001    1          John
ITB001    1          Bob
ITB001    1          Mickey
ITB001    2          Jenny
ITB001    2          James
MKB114    1          John
MKB114    1          Erica
</code></pre>

<p>When you use a <code>group by</code> on the subject column only; say:</p>

<pre><code>select Subject, Count(*)
from Subject_Selection
group by Subject
</code></pre>

<p>You will get something like:</p>

<pre><code>Subject    Count
------------------------------
ITB001     5
MKB114     2
</code></pre>

<p>...because there are 5 entries for ITB001, and 2 for MKB114</p>

<p>If we were to <code>group by</code> two columns:</p>

<pre><code>select Subject, Semester, Count(*)
from Subject_Selection
group by Subject, Semester
</code></pre>

<p>we would get this:</p>

<pre><code>Subject    Semester   Count
------------------------------
ITB001     1          3
ITB001     2          2
MKB114     1          2
</code></pre>

<p>This is because, when we group by two columns, it is saying <strong>""Group them so that all of those with the same Subject and Semester are in the same group, and then calculate all the aggregate functions</strong> (Count, Sum, Average, etc.) <strong>for each of those groups""</strong>. In this example, this is demonstrated by the fact that, when we count them, there are <strong>three</strong> people doing ITB001 in semester 1, and <strong>two</strong> doing it in semester 2. Both of the people doing MKB114 are in semester 1, so there is no row for semester 2 (no data fits into the group ""MKB114, Semester 2"")</p>

<p>Hopefully that makes sense.</p>
","2421441"
"How to do INSERT into a table records extracted from another table","547369","","<p>I'm trying to write a query that extracts and transforms data from a table and then insert those data into another table. Yes, this is a data warehousing query and I'm doing it in MS Access. So basically I want some query like this:</p>

<pre><code>INSERT INTO Table2(LongIntColumn2, CurrencyColumn2) VALUES
  (SELECT LongIntColumn1, Avg(CurrencyColumn) as CurrencyColumn1 FROM Table1 GROUP BY LongIntColumn1);
</code></pre>

<p>I tried but get a syntax error message.</p>

<p>What would you do if you want to do this?</p>
","<p>No ""VALUES"", no parenthesis:</p>

<pre><code>INSERT INTO Table2(LongIntColumn2, CurrencyColumn2)
SELECT LongIntColumn1, Avg(CurrencyColumn) as CurrencyColumn1 FROM Table1 GROUP BY LongIntColumn1;
</code></pre>
","74204"
"Insert into a MySQL table or update if exists","539554","","<p>I want to add a row to a database table, but if a row exists with the same unique key I want to update the row.</p>

<p>For example,</p>

<pre><code>insert into table (id, name, age) values(1, ""A"", 19)
</code></pre>

<p>Let’s say the unique key is <code>id</code>, and in my database there is a row with <code>id = 1</code>. In that case I want to update that row with these values. Normally this gives an error. If I use <code>insert IGNORE</code> it will ignore the error, but it still won’t update.</p>
","<p>Use <a href=""https://dev.mysql.com/doc/en/insert-on-duplicate.html"" rel=""noreferrer""><code>INSERT ... ON DUPLICATE KEY UPDATE</code></a></p>

<p><strong>QUERY:</strong></p>

<pre><code>INSERT INTO table (id, name, age) VALUES(1, ""A"", 19) ON DUPLICATE KEY UPDATE    
name=""A"", age=19
</code></pre>
","4205207"
"How to calculate percentage with a SQL statement","537023","","<p>I have a SQL Server table that contains users &amp; their grades. For simplicity's sake, lets just say there are 2 columns - <code>name</code> &amp; <code>grade</code>. So a typical row would be Name: ""John Doe"", Grade:""A"".</p>

<p>I'm looking for one SQL statement that will find the percentages of all possible answers. (A, B, C, etc...) Also, is there a way to do this without defining all possible answers (open text field - users could enter 'pass/fail', 'none', etc...)</p>

<p>The final output I'm looking for is A: 5%, B: 15%, C: 40%, etc...</p>
","<p>I have tested the following and this does work. The answer by gordyii was close but had the multiplication of 100 in the wrong place and had some missing parenthesis.</p>

<pre><code>Select Grade, (Count(Grade)* 100 / (Select Count(*) From MyTable)) as Score
From MyTable
Group By Grade
</code></pre>
","772439"
"how to insert datetime into the SQL Database table?","535687","","<p>How can I insert datetime into the SQL Database table ?
Is there a way to insert this query through the insert command in C# / .NET?</p>
","<p>DateTime values should be inserted as if they are strings surrounded by single quotes:</p>

<pre><code>'20100301'
</code></pre>

<p>SQL Server allows for many accepted date formats and it should be the case that most development libraries provide a series of classes or functions to insert datetime values properly. However, if you are doing it manually, it is important to distinguish the date format using <code>DateFormat</code> and to use generalized format:</p>

<pre><code>Set DateFormat MDY --indicates the general format is Month Day Year

Insert Table( DateTImeCol )
Values( '2011-03-12' )
</code></pre>

<p>By setting the dateformat, SQL Server now assumes that my format is <code>YYYY-MM-DD</code> instead of <code>YYYY-DD-MM</code>.</p>

<p><a href=""http://msdn.microsoft.com/en-us/library/aa259188%28SQL.80%29.aspx"" rel=""noreferrer"">SET DATEFORMAT</a></p>

<p>SQL Server also recognizes a generic format that is always interpreted the same way: <code>YYYYMMDD</code> e.g. <code>20110312</code>.</p>

<p>If you are asking how to insert the current date and time using T-SQL, then I would recommend using the keyword <code>CURRENT_TIMESTAMP</code>. For example:</p>

<pre><code>Insert Table( DateTimeCol )
Values( CURRENT_TIMESTAMP )
</code></pre>
","5287473"
"How do I find duplicate values in a table in Oracle?","533517","","<p>What's the simplest SQL statement that will return the duplicate values for a given column and the count of their occurrences in an Oracle database table?</p>

<p>For example: I have a <code>JOBS</code> table with the column <code>JOB_NUMBER</code>.  How can I find out if I have any duplicate <code>JOB_NUMBER</code>s, and how many times they're duplicated?</p>
","<pre><code>select column_name, count(column_name)
from table
group by column_name
having count (column_name) &gt; 1;
</code></pre>
","59242"
"MySQL query String contains","529560","","<p>I've been trying to figure out how I can make a query with MySQL that checks if the value (string <code>$haystack</code> ) in a certain column contains certain data (string <code>$needle</code>), like this:</p>

<pre><code>mysql_query(""
SELECT *
FROM `table`
WHERE `column`.contains('{$needle}')
"");
</code></pre>

<p>In PHP, the function is called <code>substr($haystack, $needle)</code>, so maybe:</p>

<pre><code>WHERE substr(`column`, '{$needle}')=1
</code></pre>
","<p>Quite simple actually:</p>

<pre><code>mysql_query(""
SELECT *
FROM `table`
WHERE `column` LIKE '%{$needle}%'
"");
</code></pre>

<p>The <code>%</code> is a wildcard for any character. Do note that this can get slow on very large datasets so if your database grows you'll need to use fulltext indices.</p>
","2602274"
"How to use count and group by at the same select statement","525815","","<p>I have an sql select query that has a group by. 
I want to count all the records after the group by statement. 
Is there a way for this directly from sql?
For example, having a table with users I want to select the different towns and the <b>total</b> number of users</p>

<pre><code>select town, count(*) from user
group by town
</code></pre>

<p>I want to have a column with all the towns and another with the number of users in all rows.</p>

<p>An example of the result for having 3 towns and 58 users in total is :</p>

<pre><code>Town         Count
Copenhagen   58
NewYork      58
Athens       58
</code></pre>
","<p>This will do what you want (list of towns, with the number of users in each):</p>

<pre><code>select town, count(town) 
from user
group by town
</code></pre>

<p>You can use most <a href=""http://databases.about.com/od/sql/l/aaaggregate1.htm"" rel=""noreferrer"">aggregate functions</a> when using <code>GROUP BY</code>.</p>

<p><strong>Update</strong> (following change to question and comments)</p>

<p>You can declare a variable for the number of users and set it to the number of users then select with that.</p>

<pre><code>DECLARE @numOfUsers INT
SET @numOfUsers = SELECT COUNT(*) FROM user

SELECT DISTINCT town, @numOfUsers
FROM user
</code></pre>
","2722426"
"error, string or binary data would be truncated when trying to insert","518922","","<p>I am running data.bat file with the following lines:</p>

<pre><code>Rem Tis batch file will populate tables

cd\program files\Microsoft SQL Server\MSSQL
osql -U sa -P Password -d MyBusiness -i c:\data.sql
</code></pre>

<p>The contents of the data.sql file is:</p>

<pre><code>   insert Customers
            (CustomerID, CompanyName, Phone)
             Values('101','Southwinds','19126602729')
</code></pre>

<p>There are 8 more similar lines for adding records.</p>

<p>When I run this with <code>start</code> > <code>run</code> > <code>cmd</code> > <code>c:\data.bat</code>, I get this error message:</p>

<pre><code>1&gt;2&gt;3&gt;4&gt;5&gt;....&lt;1 row affected&gt;
Msg 8152, Level 16, State 4, Server SP1001, Line 1
string or binary data would be truncated.

&lt;1 row affected&gt;

&lt;1 row affected&gt;

&lt;1 row affected&gt;

&lt;1 row affected&gt;

&lt;1 row affected&gt;

&lt;1 row affected&gt;
</code></pre>

<p>Also, I am a newbie obviously, but what do <code>Level #</code>, and <code>state #</code> mean, and how do I look up error messages such as the one above: 8152?</p>
","<p>From <a href=""http://www.tek-tips.com/viewthread.cfm?qid=1042136"" rel=""noreferrer"">@gmmastros's answer</a></p>

<p>Whenever you see the message....</p>

<pre><code>string or binary data would be truncated 
</code></pre>

<p>Think to yourself... The field is NOT big enough to hold my data.</p>

<p>Check the table structure for the customers table.  I think you'll find that the length of one or more fields is NOT big enough to hold the data you are trying to insert.  For example, if the Phone field is a varchar(8) field, and you try to put 11 characters in to it, you will get this error. </p>
","5591482"
"Convert varchar into datetime in SQL Server","516368","","<p>How do I convert a string of format <code>mmddyyyy</code> into <code>datetime</code> in SQL Server 2008?</p>

<p>My target column is in <code>DateTime</code></p>

<p>I have tried with <code>Convert</code> and most of the <code>Date</code> style values however I get an error message:</p>

<blockquote>
  <p>'The conversion of a varchar data type to a datetime data type resulted in an out-of-range value.' </p>
</blockquote>
","<p>OP wants mmddyy and a plain convert will not work for that:</p>

<pre><code>select convert(datetime,'12312009')

Msg 242, Level 16, State 3, Line 1 
The conversion of a char data type to a datetime data type resulted in 
an out-of-range datetime value
</code></pre>

<p>so try this:</p>

<pre><code>DECLARE @Date char(8)
set @Date='12312009'
SELECT CONVERT(datetime,RIGHT(@Date,4)+LEFT(@Date,2)+SUBSTRING(@Date,3,2))
</code></pre>

<p>OUTPUT:</p>

<pre><code>-----------------------
2009-12-31 00:00:00.000

(1 row(s) affected)
</code></pre>
","1510131"
"How to 'insert if not exists' in MySQL?","515445","","<p>I started by googling, and found this <a href=""http://www.xaprb.com/blog/2005/09/25/insert-if-not-exists-queries-in-mysql/"" rel=""noreferrer"">article</a> which talks about mutex tables.</p>

<p>I have a table with ~14 million records. If I want to add more data in the same format, is there a way to ensure the record I want to insert does not already exist without using a pair of queries (ie, one query to check and one to insert is the result set is empty)?</p>

<p>Does a <code>unique</code> constraint on a field guarantee the <code>insert</code> will fail if it's already there?</p>

<p>It seems that with <em>merely</em> a constraint, when I issue the insert via php, the script croaks.</p>
","<p>use <code>INSERT IGNORE INTO table</code></p>

<p>see <a href=""http://bogdan.org.ua/2007/10/18/mysql-insert-if-not-exists-syntax.html"" rel=""noreferrer"">http://bogdan.org.ua/2007/10/18/mysql-insert-if-not-exists-syntax.html</a></p>

<p>there's also <code>INSERT … ON DUPLICATE KEY UPDATE</code> syntax, you can find explanations on <a href=""http://dev.mysql.com/doc/refman/5.1/en/insert-on-duplicate.html"" rel=""noreferrer"">dev.mysql.com</a></p>

<hr>

<p><strong>Post from bogdan.org.ua according to <a href=""http://webcache.googleusercontent.com/search?q=cache:bogdan.org.ua/2007/10/18/mysql-insert-if-not-exists-syntax.html"" rel=""noreferrer"">Google's webcache</a>:</strong></p>

<blockquote>
  <p>18th October 2007</p>
  
  <p>To start: as of the latest MySQL, syntax presented in the title is not
  possible. But there are several very easy ways to accomplish what is
  expected using existing functionality.</p>
  
  <p>There are 3 possible solutions: using INSERT IGNORE, REPLACE, or
  INSERT … ON DUPLICATE KEY UPDATE.</p>
  
  <p>Imagine we have a table:</p>

<pre><code>CREATE TABLE `transcripts` (
`ensembl_transcript_id` varchar(20) NOT NULL,
`transcript_chrom_start` int(10) unsigned NOT NULL,
`transcript_chrom_end` int(10) unsigned NOT NULL,
PRIMARY KEY (`ensembl_transcript_id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
</code></pre>
  
  <p>Now imagine that we have an automatic pipeline importing transcripts
  meta-data from Ensembl, and that due to various reasons the pipeline
  might be broken at any step of execution. Thus, we need to ensure two
  things: 1) repeated executions of the pipeline will not destroy our
  database, and 2) repeated executions will not die due to ‘duplicate
  primary key’ errors.</p>
  
  <p>Method 1: using REPLACE</p>
  
  <p>It’s very simple:</p>

<pre><code>REPLACE INTO `transcripts`
SET `ensembl_transcript_id` = ‘ENSORGT00000000001′,
`transcript_chrom_start` = 12345,
`transcript_chrom_end` = 12678;
</code></pre>
  
  <p>If the record exists, it will be overwritten; if it does not yet
  exist, it will be created. However, using this method isn’t efficient
  for our case: we do not need to overwrite existing records, it’s fine
  just to skip them.</p>
  
  <p>Method 2: using INSERT IGNORE Also very simple:</p>

<pre><code>INSERT IGNORE INTO `transcripts`
SET `ensembl_transcript_id` = ‘ENSORGT00000000001′,
`transcript_chrom_start` = 12345,
`transcript_chrom_end` = 12678;
</code></pre>
  
  <p>Here, if the ‘ensembl_transcript_id’ is already present in the
  database, it will be silently skipped (ignored). (To be more precise,
  here’s a quote from MySQL reference manual: “If you use the IGNORE
  keyword, errors that occur while executing the INSERT statement are
  treated as warnings instead. For example, without IGNORE, a row that
  duplicates an existing UNIQUE index or PRIMARY KEY value in the table
  causes a duplicate-key error and the statement is aborted.”.) If the
  record doesn’t yet exist, it will be created.</p>
  
  <p>This second method has several potential weaknesses, including
  non-abortion of the query in case any other problem occurs (see the
  manual). Thus it should be used if previously tested without the
  IGNORE keyword.</p>
  
  <p>There is one more option: to use INSERT … ON DUPLICATE KEY UPDATE
  syntax, and in the UPDATE part just do nothing do some meaningless
  (empty) operation, like calculating 0+0 (Geoffray suggests doing the
  id=id assignment for the MySQL optimization engine to ignore this
  operation). Advantage of this method is that it only ignores duplicate
  key events, and still aborts on other errors.</p>
  
  <p>As a final notice: this post was inspired by Xaprb. I’d also advise to
  consult his other post on writing flexible SQL queries.</p>
</blockquote>
","1361368"
"When should I use Cross Apply over Inner Join?","514484","","<p>What is the main purpose of using <a href=""http://technet.microsoft.com/en-us/library/ms175156.aspx"" rel=""noreferrer"">CROSS APPLY</a>?</p>

<p>I have read (vaguely, through posts on the Internet) that <code>cross apply</code> can be more efficient when selecting over large data sets if you are partitioning. (Paging comes to mind)</p>

<p>I also know that <code>CROSS APPLY</code> <a href=""http://www.eggheadcafe.com/conversation.aspx?messageid=34684493&amp;threadid=34673936"" rel=""noreferrer"">doesn't require a UDF as the right-table.</a></p>

<p>In most <code>INNER JOIN</code> queries (one-to-many relationships), I could rewrite them to use <code>CROSS APPLY</code>, but they always give me equivalent execution plans. </p>

<p>Can anyone give me a good example of when <code>CROSS APPLY</code> makes a difference in those cases where <code>INNER JOIN</code> will work as well?</p>

<hr>

<p><strong>Edit:</strong></p>

<p>Here's a trivial example, where the execution plans are exactly the same.  (Show me one where they differ and where <code>cross apply</code> is faster/more efficient)</p>

<pre><code>create table Company (
    companyId int identity(1,1)
,   companyName varchar(100)
,   zipcode varchar(10) 
,   constraint PK_Company primary key (companyId)
)
GO

create table Person (
    personId int identity(1,1)
,   personName varchar(100)
,   companyId int
,   constraint FK_Person_CompanyId foreign key (companyId) references dbo.Company(companyId)
,   constraint PK_Person primary key (personId)
)
GO

insert Company
select 'ABC Company', '19808' union
select 'XYZ Company', '08534' union
select '123 Company', '10016'


insert Person
select 'Alan', 1 union
select 'Bobby', 1 union
select 'Chris', 1 union
select 'Xavier', 2 union
select 'Yoshi', 2 union
select 'Zambrano', 2 union
select 'Player 1', 3 union
select 'Player 2', 3 union
select 'Player 3', 3 


/* using CROSS APPLY */
select *
from Person p
cross apply (
    select *
    from Company c
    where p.companyid = c.companyId
) Czip

/* the equivalent query using INNER JOIN */
select *
from Person p
inner join Company c on p.companyid = c.companyId
</code></pre>
","<blockquote>
  <p>Can anyone give me a good example of when CROSS APPLY makes a difference in those cases where INNER JOIN will work as well?</p>
</blockquote>

<p>See the article in my blog for detailed performance comparison:</p>

<ul>
<li><a href=""http://explainextended.com/2009/07/16/inner-join-vs-cross-apply/"" rel=""noreferrer""><strong><code>INNER JOIN</code> vs. <code>CROSS APPLY</code></strong></a></li>
</ul>

<p><code>CROSS APPLY</code> works better on things that have no simple <code>JOIN</code> condition.</p>

<p>This one selects <code>3</code> last records from <code>t2</code> for each record from <code>t1</code>:</p>

<pre><code>SELECT  t1.*, t2o.*
FROM    t1
CROSS APPLY
        (
        SELECT  TOP 3 *
        FROM    t2
        WHERE   t2.t1_id = t1.id
        ORDER BY
                t2.rank DESC
        ) t2o
</code></pre>

<p>It cannot be easily formulated with an <code>INNER JOIN</code> condition.</p>

<p>You could probably do something like that using <code>CTE</code>'s and window function:</p>

<pre><code>WITH    t2o AS
        (
        SELECT  t2.*, ROW_NUMBER() OVER (PARTITION BY t1_id ORDER BY rank) AS rn
        FROM    t2
        )
SELECT  t1.*, t2o.*
FROM    t1
INNER JOIN
        t2o
ON      t2o.t1_id = t1.id
        AND t2o.rn &lt;= 3
</code></pre>

<p>, but this is less readable and probably less efficient.</p>

<p><strong>Update:</strong></p>

<p>Just checked.</p>

<p><code>master</code> is a table of about <code>20,000,000</code> records with a <code>PRIMARY KEY</code> on <code>id</code>.</p>

<p>This query:</p>

<pre><code>WITH    q AS
        (
        SELECT  *, ROW_NUMBER() OVER (ORDER BY id) AS rn
        FROM    master
        ),
        t AS 
        (
        SELECT  1 AS id
        UNION ALL
        SELECT  2
        )
SELECT  *
FROM    t
JOIN    q
ON      q.rn &lt;= t.id
</code></pre>

<p>runs for almost <code>30</code> seconds, while this one:</p>

<pre><code>WITH    t AS 
        (
        SELECT  1 AS id
        UNION ALL
        SELECT  2
        )
SELECT  *
FROM    t
CROSS APPLY
        (
        SELECT  TOP (t.id) m.*
        FROM    master m
        ORDER BY
                id
        ) q
</code></pre>

<p>is instant.</p>
","1139231"
"Efficiently convert rows to columns in sql server","511164","","<p>I'm looking for an efficient way to convert rows to columns in SQL server, I heard that PIVOT is not very fast, and I need to deal with lot of records.</p>

<p>This is my example:</p>

<pre><code>   ----------------------------
   | Id | Value |ColumnName   |
   ----------------------------
   | 1  |John   |FirstName    |
   | 2  |2.4    | Amount      |
   | 3  |ZH1E4A |PostalCode   |
   | 4  |Fork   |LastName     |
   | 5  |857685 |AccountNumber|
   ----------------------------
</code></pre>

<p>This is my result:</p>

<pre><code>--------------------------------------------------------------------
|FirstName  |Amount|    PostalCode   |   LastName  |  AccountNumber|
--------------------------------------------------------------------
|John       | 2.4  |   ZH1E4A        |   Fork      | 857685        |
--------------------------------------------------------------------
</code></pre>

<p>How can I build the result?</p>
","<p>There are several ways that you can transform data from multiple rows into columns.  In SQL Server you can use the <code>PIVOT</code> function to transform the data from rows to columns:</p>

<pre><code>select Firstname, Amount, PostalCode, LastName, AccountNumber
from
(
  select value, columnname
  from yourtable
) d
pivot
(
  max(value)
  for columnname in (Firstname, Amount, PostalCode, LastName, AccountNumber)
) piv;
</code></pre>

<p>See <a href=""https://data.stackexchange.com/stackoverflow/query/497432"" rel=""noreferrer"">Demo</a>.</p>

<p>If you have an unknown number of <code>columnnames</code> that you want to transpose, then you can use dynamic SQL:</p>

<pre><code>DECLARE @cols AS NVARCHAR(MAX),
    @query  AS NVARCHAR(MAX)

select @cols = STUFF((SELECT ',' + QUOTENAME(ColumnName) 
                    from yourtable
                    group by ColumnName, id
                    order by id
            FOR XML PATH(''), TYPE
            ).value('.', 'NVARCHAR(MAX)') 
        ,1,1,'')

set @query = N'SELECT ' + @cols + N' from 
             (
                select value, ColumnName
                from yourtable
            ) x
            pivot 
            (
                max(value)
                for ColumnName in (' + @cols + N')
            ) p '

exec sp_executesql @query;
</code></pre>

<p>See <a href=""https://data.stackexchange.com/stackoverflow/query/497433"" rel=""noreferrer"">Demo</a>.</p>

<p>If you do not want to use the <code>PIVOT</code> function, then you can use an aggregate function with a <code>CASE</code> expression:</p>

<pre><code>select
  max(case when columnname = 'FirstName' then value end) Firstname,
  max(case when columnname = 'Amount' then value end) Amount,
  max(case when columnname = 'PostalCode' then value end) PostalCode,
  max(case when columnname = 'LastName' then value end) LastName,
  max(case when columnname = 'AccountNumber' then value end) AccountNumber
from yourtable
</code></pre>

<p>See <a href=""https://data.stackexchange.com/stackoverflow/query/497434"" rel=""noreferrer"">Demo</a>.</p>

<p>This could also be completed using multiple joins, but you will need some column to associate each of the rows which you do not have in your sample data. But the basic syntax would be:</p>

<pre><code>select fn.value as FirstName,
  a.value as Amount,
  pc.value as PostalCode,
  ln.value as LastName,
  an.value as AccountNumber
from yourtable fn
left join yourtable a
  on fn.somecol = a.somecol
  and a.columnname = 'Amount'
left join yourtable pc
  on fn.somecol = pc.somecol
  and pc.columnname = 'PostalCode'
left join yourtable ln
  on fn.somecol = ln.somecol
  and ln.columnname = 'LastName'
left join yourtable an
  on fn.somecol = an.somecol
  and an.columnname = 'AccountNumber'
where fn.columnname = 'Firstname'
</code></pre>
","15745076"
"Remove all spaces from a string in SQL Server","508683","","<p>What is the best way to remove all spaces from a string in SQL Server 2008?</p>

<p>LTRIM(RTRIM('  a b ') would remove all spaces at the right and left of the string, but I also need to remove the space in the middle.</p>
","<p>Simply replace it;</p>

<pre><code>SELECT REPLACE(fld_or_variable, ' ', '')
</code></pre>

<p><strong>Edit</strong>
Just to clarify; its a global replace, there is no need to <code>trim()</code> or worry about multiple spaces:</p>

<pre><code>create table #t (c char(8), v varchar(8))
insert #t (c, v) values 
    ('a a'    , 'a a'    ),
    ('a a  '  , 'a a  '  ),
    ('  a a'  , '  a a'  ),
    ('  a a  ', '  a a  ')

select
    '''' + c + '''' [IN], '''' + replace(c, ' ', '') + '''' [OUT]
from #t  
union all select
    '''' + v + '''', '''' + replace(v, ' ', '') + ''''
from #t 

IN            OUT
'a a     '   'aa'
'a a     '   'aa'
'  a a   '   'aa'
'  a a   '   'aa'
'a a'        'aa'
'a a  '      'aa'
'  a a'      'aa'
'  a a  '    'aa'
</code></pre>
","10432124"
"How to avoid the ""divide by zero"" error in SQL?","507266","","<p>I have this error message:</p>

<pre><code>Msg 8134, Level 16, State 1, Line 1
Divide by zero error encountered.
</code></pre>

<p>What is the best way to write SQL code so that I will never see this error message again?</p>

<p>I could do either of the following:</p>

<ul>
<li>Add a where clause so that my divisor is never zero</li>
</ul>

<p>Or</p>

<ul>
<li>I could add a case statement, so that there is a special treatment for zero. </li>
</ul>

<p>Is the best way to use a NullIf clause?  </p>

<p>Is there better way, or how can this be enforced?</p>
","<p>In order to avoid a ""Division by zero"" error we have programmed it like this:</p>

<pre><code>Select Case when divisor=0 then null
Else dividend / divisor
End ,,,
</code></pre>

<p>But here is a much nicer way of doing it:</p>

<pre><code>Select dividend / nullif(divisor, 0) ...
</code></pre>

<p>Now the only problem is to remember the NullIf bit, if I use the ""/"" key.</p>
","861791"
"Truncate (not round) decimal places in SQL Server","504574","","<p>I'm trying to determine the best way to truncate or drop extra decimal places in SQL without rounding.  For example:</p>

<pre><code>declare @value decimal(18,2)

set @value = 123.456
</code></pre>

<p>This will auto round @Value to be 123.46....which in most cases is good.  However, for this project I don't need that.  Is there a simple way to truncate the decimals I don't need?  I know I can use the left() function and convert back to a decimal...any other ways?</p>
","<pre><code>select round(123.456, 2, 1)
</code></pre>
","44052"
"Convert a string to int using sql query","503544","","<p>How to convert a string to integer using SQL query on SQL Server 2005?</p>
","<p>You could use <a href=""http://msdn.microsoft.com/en-us/library/ms187928(SQL.90).aspx"" rel=""noreferrer"">CAST or CONVERT</a>:</p>

<pre><code>SELECT CAST(MyVarcharCol AS INT) FROM Table

SELECT CONVERT(INT, MyVarcharCol) FROM Table
</code></pre>
","728840"
"UPDATE and REPLACE part of a string","503429","","<p>I've got a table with two columns, <code>ID</code> and <code>Value</code>. I want to change a part of some strings in the second column.</p>

<p>Example of Table:</p>

<pre class=""lang-none prettyprint-override""><code>ID            Value
---------------------------------
1             c:\temp\123\abc\111
2             c:\temp\123\abc\222
3             c:\temp\123\abc\333
4             c:\temp\123\abc\444
</code></pre>

<p>Now the <code>123\</code> in the <code>Value</code> string is not needed. I tried <code>UPDATE</code> and <code>REPLACE</code>:</p>

<pre><code>UPDATE dbo.xxx
SET Value = REPLACE(Value, '%123%', '')
WHERE ID &lt;= 4
</code></pre>

<p>When I execute the script SQL Server does not report an error, but it does not update anything either. Why is that?</p>
","<p>You don't need wildcards in the <code>REPLACE</code> - it just finds the string you enter for the second argument, so the following should work:</p>

<pre><code>UPDATE dbo.xxx
SET Value = REPLACE(Value, '123\', '')
WHERE ID &lt;=4
</code></pre>

<p>(I also added the <code>\</code> in the replace as I assume you don't need that either)</p>
","17365278"
"Oracle SELECT TOP 10 records","503068","","<p>I have an big problem with an SQL Statement in Oracle. I want to select the TOP 10 Records ordered by STORAGE_DB which aren't in a list from an other select statement.</p>

<p>This one works fine for all records:</p>

<pre><code>SELECT DISTINCT 
  APP_ID, 
  NAME, 
  STORAGE_GB, 
  HISTORY_CREATED, 
  TO_CHAR(HISTORY_DATE, 'DD.MM.YYYY') AS HISTORY_DATE  
  FROM HISTORY WHERE 
      STORAGE_GB IS NOT NULL AND 
        APP_ID NOT IN (SELECT APP_ID
                       FROM HISTORY
                        WHERE TO_CHAR(HISTORY_DATE, 'DD.MM.YYYY') = '06.02.2009') 
</code></pre>

<p>But when I am adding </p>

<pre><code>AND ROWNUM &lt;= 10
ORDER BY STORAGE_GB DESC
</code></pre>

<p>I'm getting some kind of ""random"" Records. I think because the limit takes in place before the order.</p>

<p>Does someone has an good solution? The other problem: This query is realy slow (10k+ records)</p>
","<p>You'll need to put your current query in subquery as below :</p>

<pre><code>SELECT * FROM (
  SELECT DISTINCT 
  APP_ID, 
  NAME, 
  STORAGE_GB, 
  HISTORY_CREATED, 
  TO_CHAR(HISTORY_DATE, 'DD.MM.YYYY') AS HISTORY_DATE  
  FROM HISTORY WHERE 
    STORAGE_GB IS NOT NULL AND 
      APP_ID NOT IN (SELECT APP_ID FROM HISTORY WHERE TO_CHAR(HISTORY_DATE, 'DD.MM.YYYY') ='06.02.2009')
  ORDER BY STORAGE_GB DESC )
WHERE ROWNUM &lt;= 10
</code></pre>

<p>Oracle applies <a href=""http://www.adp-gmbh.ch/ora/sql/rownum.html"" rel=""noreferrer"">rownum</a> to the result after it has been returned.<br> You need to filter the result after it has been returned, so a subquery is required. You can also use <a href=""http://www.adp-gmbh.ch/ora/sql/analytical/rank.html"" rel=""noreferrer"">RANK()</a> function to get Top-N results.
<br><br>
For performance try using <code>NOT EXISTS</code> in place of <code>NOT IN</code>. See <a href=""http://www.4tm.com.ar/4tmsite/wordpress/?p=25"" rel=""noreferrer"">this</a> for more.</p>
","2498058"
"Inserting data into a temporary table","501329","","<p>After having created a temporary table and declaring the data types like so;</p>

<pre><code> CREATE TABLE #TempTable(
 ID int,
 Date datetime,
 Name char(20))
</code></pre>

<p>How do I then insert the relevant data which is already held on a physical table within the database?</p>
","<pre><code>INSERT INTO #TempTable (ID, Date, Name) 
SELECT id, date, name 
FROM physical_table
</code></pre>
","11779015"
"Left Outer Join using + sign in Oracle 11g","496657","","<p>Can any one tell me whether below 2 queries are an example of Left Outer Join or Right Outer Join??</p>

<pre><code>Table Part:
Name         Null?       Type
PART_ID      NOT NULL    VARCHAR2(4)
SUPPLIER_ID              VARCHAR2(4)

PART_ID SUPPLIER_ID
P1      S1
P2      S2
P3  
P4  

Table Supplier:
Name            Null?     Type
SUPPLIER_ID NOT NULL      VARCHAR2(4)
SUPPLIER_NAME   NOT NULL  VARCHAR2(20)

SUPPLIER_ID  SUPPLIER_NAME
S1           Supplier#1
S2           Supplier#2
S3           Supplier#3
</code></pre>

<p>Display all the parts irrespective of whether any supplier supplies them or not:</p>

<pre>
SELECT P.Part_Id, S.Supplier_Name
FROM Part P, Supplier S
WHERE P.Supplier_Id = S.Supplier_Id (+)

SELECT P.Part_Id, S.Supplier_Name
FROM Part P, Supplier S
WHERE S.Supplier_Id (+) = P.Supplier_Id
</pre>

<p>Thanks!</p>
","<p><code>TableA LEFT OUTER JOIN TableB</code> is equivalent to <code>TableB RIGHT OUTER JOIN Table A</code>.</p>

<p>In Oracle, <code>(+)</code> denotes the ""optional"" table in the JOIN. So in your first query, it's a <code>P LEFT OUTER JOIN S</code>. In your second query, it's <code>S RIGHT OUTER JOIN P</code>. <strong>They're functionally equivalent.</strong></p>

<p>In the terminology, RIGHT or LEFT specify which side of the join always has a record, and the other side might be null. So in a <code>P LEFT OUTER JOIN S</code>, <code>P</code> will always have a record because it's on the <code>LEFT</code>, but <code>S</code> could be null.</p>

<p>See <a href=""http://www.java2s.com/Tutorial/Oracle/0140__Table-Joins/LeftandRightOuterJoins.htm"" rel=""noreferrer"">this example from java2s.com</a> for additional explanation.</p>

<hr>

<p>To clarify, I guess I'm saying that terminology doesn't matter, as it's only there to help visualize. What matters is that you understand the concept of how it works.</p>

<hr>

<h3>RIGHT vs LEFT</h3>

<p>I've seen some confusion about what matters in determining RIGHT vs LEFT in implicit join syntax.</p>

<p>LEFT OUTER JOIN</p>

<pre><code>SELECT *
FROM A, B
WHERE A.column = B.column(+)
</code></pre>

<p>RIGHT OUTER JOIN</p>

<pre><code>SELECT *
FROM A, B
WHERE B.column(+) = A.column
</code></pre>

<p>All I did is swap sides of the terms in the WHERE clause, but they're still functionally equivalent. (See higher up in my answer for more info about that.) The placement of the <code>(+)</code> determines RIGHT or LEFT. (Specifically, if the <code>(+)</code> is on the right, it's a LEFT JOIN. If <code>(+)</code> is on the left, it's a RIGHT JOIN.)</p>

<hr>

<h3>Types of JOIN</h3>

<p>The two styles of JOIN are <em>implicit JOINs</em> and <em>explicit JOINs</em>. They are different styles of writing JOINs, but they are functionally equivalent.</p>

<p>See <a href=""https://stackoverflow.com/questions/44917/explicit-vs-implicit-sql-joins"">this SO question</a>.</p>

<p><em>Implicit JOINs</em> simply list all tables together. The join conditions are specified in a WHERE clause.</p>

<p><em>Implicit JOIN</em></p>

<pre><code>SELECT *
FROM A, B
WHERE A.column = B.column(+)
</code></pre>

<p><em>Explicit JOINs</em> associate join conditions with a specific table's inclusion instead of in a WHERE clause.</p>

<p><em>Explicit JOIN</em></p>

<pre><code>SELECT *
FROM A
LEFT OUTER JOIN B ON A.column = B.column
</code></pre>

<p>These 
Implicit JOINs can be more difficult to read and comprehend, and they also have a few limitations since the join conditions are mixed in other WHERE conditions. As such, implicit JOINs are generally recommended against in favor of explicit syntax.</p>
","6559318"
"Convert Rows to columns using 'Pivot' in SQL Server","496614","","<p>Well I guess I am really dense. I have read the stuff on MS pivot tables and I am still having problems getting this correct. I have seen some of you that seem to eat and sleep this stuff, so I just decided to sign-up and ask the question.</p>

<p>I have a temp table that is being created, we will say that column 1 is a Store number, and column 2 is a week number and lastly column 3 is a total of some type. Also the Week numbers are dynamic, the store numbers are static.</p>

<pre><code>Store      Week     xCount
-------    ----     ------
102        1        96
101        1        138
105        1        37
109        1        59
101        2        282
102        2        212
105        2        78
109        2        97
105        3        60
102        3        123
101        3        220
109        3        87
</code></pre>

<p>I would like it to come out as a pivot table, like this:</p>

<pre><code>Store        1          2          3        4        5        6....
----- 
101        138        282        220
102         96        212        123
105         37        
109
</code></pre>

<p>Store numbers down the side and weeks across the top.</p>

<p>Thanks for the help.</p>
","<p>If you are using SQL Server 2005+, then you can use the <code>PIVOT</code> function to transform the data from rows into columns.</p>

<p>It sounds like you will need to use dynamic sql if the weeks are unknown but it is easier to see the correct code using a hard-coded version initially.</p>

<p>First up, here are some quick table definitions and data for use:</p>

<pre><code>CREATE TABLE #yt 
(
  [Store] int, 
  [Week] int, 
  [xCount] int
);

INSERT INTO #yt
(
  [Store], 
  [Week], [xCount]
)
VALUES
    (102, 1, 96),
    (101, 1, 138),
    (105, 1, 37),
    (109, 1, 59),
    (101, 2, 282),
    (102, 2, 212),
    (105, 2, 78),
    (109, 2, 97),
    (105, 3, 60),
    (102, 3, 123),
    (101, 3, 220),
    (109, 3, 87);
</code></pre>

<p>If your values are known, then you will hard-code the query:</p>

<pre><code>select *
from 
(
  select store, week, xCount
  from yt
) src
pivot
(
  sum(xcount)
  for week in ([1], [2], [3])
) piv;
</code></pre>

<p>See <a href=""https://data.stackexchange.com/stackoverflow/query/580181"" rel=""noreferrer"">SQL Demo</a></p>

<p>Then if you need to generate the week number dynamically, your code will be:</p>

<pre><code>DECLARE @cols AS NVARCHAR(MAX),
    @query  AS NVARCHAR(MAX)

select @cols = STUFF((SELECT ',' + QUOTENAME(Week) 
                    from yt
                    group by Week
                    order by Week
            FOR XML PATH(''), TYPE
            ).value('.', 'NVARCHAR(MAX)') 
        ,1,1,'')

set @query = 'SELECT store,' + @cols + ' from 
             (
                select store, week, xCount
                from yt
            ) x
            pivot 
            (
                sum(xCount)
                for week in (' + @cols + ')
            ) p '

execute(@query);
</code></pre>

<p>See <a href=""https://data.stackexchange.com/stackoverflow/query/580183"" rel=""noreferrer"">SQL Demo</a>.</p>

<p>The dynamic version, generates the list of <code>week</code> numbers that should be converted to columns. Both give the same result:</p>

<pre><code>| STORE |   1 |   2 |   3 |
---------------------------
|   101 | 138 | 282 | 220 |
|   102 |  96 | 212 | 123 |
|   105 |  37 |  78 |  60 |
|   109 |  59 |  97 |  87 |
</code></pre>
","15931734"
"Fetch the row which has the Max value for a column","492068","","<p>Table: </p>

<pre><code>UserId, Value, Date.
</code></pre>

<p>I want to get the UserId, Value for the max(Date) for each UserId. That is, the Value for each UserId that has the latest date. Is there a way to do this simply in SQL? (Preferably Oracle)</p>

<p><strong>Update:</strong> Apologies for any ambiguity: I need to get ALL the UserIds. But for each UserId, only that row where that user has the latest date.</p>
","<p>This will retrieve all rows for which the my_date column value is equal to the maximum value of my_date for that userid. This may retrieve multiple rows for the userid where the maximum date is on multiple rows.</p>

<pre><code>select userid,
       my_date,
       ...
from
(
select userid,
       my_Date,
       ...
       max(my_date) over (partition by userid) max_my_date
from   users
)
where my_date = max_my_date
</code></pre>

<p>""Analytic functions rock""</p>

<p>Edit: With regard to the first comment ...</p>

<p>""using analytic queries and a self-join defeats the purpose of analytic queries""</p>

<p>There is no self-join in this code. There is instead a predicate placed on the result of the inline view that contains the analytic function -- a very different matter, and completely standard practice.</p>

<p>""The default window in Oracle is from the first row in the partition to the current one""</p>

<p>The windowing clause is only applicable in the presence of the order by clause. With no order by clause, no windowing clause is applied by default and none can be explicitly specified.</p>

<p>The code works.</p>
","121450"
"MySQL SELECT only not null values","491644","","<p>Is it possible to do a select statement that takes only NOT NULL values?</p>

<p>Right now I am using this:</p>

<pre><code>SELECT * FROM table
</code></pre>

<p>And then I have to filter out the null values with a php loop.</p>

<p>Is there a way to do:</p>

<pre><code>SELECT * (that are NOT NULL) FROM table
</code></pre>

<p>?</p>

<p>Right now when I select * I get val1,val2,val3,null,val4,val5,null,null etc.... but I just want to get the values that are not null in my result. Is this possible without filtering with a loop?</p>
","<p>You should use <code>IS NOT NULL</code>. (The comparison operators <code>=</code> and <code>&lt;&gt;</code> both give <code>UNKNOWN</code> with <code>NULL</code> on either side of the expression.)</p>

<pre><code>SELECT * 
FROM table 
WHERE YourColumn IS NOT NULL;
</code></pre>

<p>Just for completeness I'll mention that in MySQL you can also negate the <a href=""http://dev.mysql.com/doc/refman/5.6/en/comparison-operators.html"" rel=""noreferrer"">null safe equality operator</a> but this is not standard SQL.</p>

<pre><code>SELECT *
FROM table 
WHERE NOT (YourColumn &lt;=&gt; NULL);
</code></pre>

<p>Edited to reflect comments. It sounds like your table may not be in first normal form in which case changing the structure may make your task easier. A couple of other ways of doing it though...</p>

<pre><code>SELECT val1 AS val
FROM  your_table
WHERE val1 IS NOT NULL
UNION ALL
SELECT val2 
FROM  your_table
WHERE val2 IS NOT NULL
/*And so on for all your columns*/
</code></pre>

<p>The disadvantage of the above is that it scans the table multiple times once for each column. That may possibly be avoided by the below but I haven't tested this in MySQL.</p>

<pre><code>SELECT CASE idx
         WHEN 1 THEN val1
         WHEN 2 THEN val2
       END AS val
FROM   your_table
        /*CROSS JOIN*/
       JOIN (SELECT 1 AS idx
                   UNION ALL
                   SELECT 2) t
HAVING val IS NOT NULL  /*Can reference alias in Having in MySQL*/
</code></pre>
","5285461"
"SQL join: where clause vs. on clause","476331","","<p>After reading it, this is <em>not</em> a duplicate of <a href=""https://stackoverflow.com/questions/44917/explicit-vs-implicit-sql-joins"">Explicit vs Implicit SQL Joins</a>.
The answer may be related (or even the same) but the <strong>question</strong> is different.</p>

<hr>

<p>What is the difference and what should go in each?</p>

<p>If I understand the theory correctly, the query optimizer should be able to use both interchangeably.</p>
","<p>They are not the same thing.</p>

<p>Consider these queries:</p>

<pre><code>SELECT *
FROM Orders
LEFT JOIN OrderLines ON OrderLines.OrderID=Orders.ID
WHERE Orders.ID = 12345
</code></pre>

<p>and</p>

<pre><code>SELECT *
FROM Orders
LEFT JOIN OrderLines ON OrderLines.OrderID=Orders.ID 
    AND Orders.ID = 12345
</code></pre>

<p>The first will return an order and its lines, if any, for order number <code>12345</code>.  The second will return all orders, but only order <code>12345</code> will have any lines associated with it.</p>

<p>With an <code>INNER JOIN</code>, the clauses are <em>effectively</em> equivalent. However, just because they are functionally the same, in that they produce the same results, does not mean the two kinds of clauses have the same semantic meaning.</p>
","354094"
"Conversion failed when converting date and/or time from character string while inserting datetime","475631","","<p>I was trying to create a table as follows,</p>

<pre><code>create table table1(date1 datetime,date2 datetime);
</code></pre>

<p>First I tried inserting values as below,</p>

<pre><code>insert into table1 values('21-02-2012 6:10:00 PM','01-01-2001 12:00:00 AM');
</code></pre>

<p>It has given error saying,</p>

<blockquote>
  <p><em>Cannot convert varchar to datetime</em></p>
</blockquote>

<p>Then I tried below format as one of the post suggested by our stackoverflow,</p>

<pre><code>insert into table1 values(convert(datetime,'21-02-2012 6:10:00 PM',5)
                          ,convert(datetime,'01-01-2001 12:00:00 AM',5));
</code></pre>

<p>But am still getting the error saying,</p>

<blockquote>
  <p><em>Conversion failed when converting date and/or time from character string</em></p>
</blockquote>

<p>Any suggestions?</p>
","<p>There are many formats supported by SQL Server - see the <a href=""http://msdn.microsoft.com/en-us/library/ms187928.aspx"" rel=""noreferrer"">MSDN Books Online on CAST and CONVERT</a>. Most of those formats are <strong>dependent</strong> on what settings you have - therefore, these settings might work some times - and sometimes not.</p>

<p>The way to solve this is to use the (slightly adapted) <strong>ISO-8601 date format</strong> that is supported by SQL Server - this format works <strong>always</strong> - regardless of your SQL Server language and dateformat settings.</p>

<p>The <a href=""http://msdn.microsoft.com/en-us/library/ms180878.aspx"" rel=""noreferrer"">ISO-8601 format</a> is supported by SQL Server comes in two flavors:</p>

<ul>
<li><code>YYYYMMDD</code> for just dates (no time portion); note here: <strong>no dashes!</strong>, that's very important! <code>YYYY-MM-DD</code> is <strong>NOT</strong> independent of the dateformat settings in your SQL Server and will <strong>NOT</strong> work in all situations!</li>
</ul>

<p>or:</p>

<ul>
<li><code>YYYY-MM-DDTHH:MM:SS</code> for dates and times - note here: this format <em>has</em> dashes (but they <em>can</em> be omitted), and a fixed <code>T</code> as delimiter between the date and time portion of your <code>DATETIME</code>.</li>
</ul>

<p>This is valid for SQL Server 2000 and newer.</p>

<p>So in your concrete case - use these strings:</p>

<pre><code>insert into table1 values('2012-02-21T18:10:00', '2012-01-01T00:00:00');
</code></pre>

<p>and you should be fine (note: you need to use the international <strong>24-hour</strong> format rather than 12-hour AM/PM format for this).</p>

<p><strong>Alternatively</strong>: if you're on SQL Server <strong>2008</strong> or newer, you could also use the <code>DATETIME2</code> datatype (instead of plain <code>DATETIME</code>) and your current <code>INSERT</code> would just work without any problems! :-) <code>DATETIME2</code> is a lot better and a lot less picky on conversions - and it's the recommend date/time data types for SQL Server 2008 or newer anyway.</p>

<pre><code>SELECT
   CAST('02-21-2012 6:10:00 PM' AS DATETIME2),     -- works just fine
   CAST('01-01-2012 12:00:00 AM' AS DATETIME2)   -- works just fine  
</code></pre>

<p>Don't ask me why this whole topic is so tricky and somewhat confusing - that's just the way it is. But with the <code>YYYYMMDD</code> format, you should be fine for any version of SQL Server and for any language and dateformat setting in your SQL Server.</p>
","14119145"
"Function vs. Stored Procedure in SQL Server","474101","","<p>I've been learning Functions and Stored Procedure for quite a while but I don't know why and when I should use a function or a stored procedure. They look same to me, maybe because I am kinda newbie about that.</p>

<p>Can some one tell me why?</p>
","<p>Functions are computed values and cannot perform permanent environmental changes to SQL Server (i.e. no INSERT or UPDATE statements allowed).</p>

<p>A Function can be used inline in SQL Statements if it returns a scalar value or can be joined upon if it returns a result set.</p>

<p><strong>A point worth noting from comments, which summarize the answer. Thanks to @Sean K Anderson</strong></p>

<ul>
<li>Functions follow the computer-sciency definition in that they MUST return a value and cannot alter the data they receive as parameters (the arguments). Functions are not allowed to change anything, must have at least one parameter, and they must return a value. Stored procs do not have to have a parameter, can change database objects, and do not have to return a value</li>
</ul>
","1179778"
"SQL Switch/Case in where clause","471817","","<p>I tried searching around but couldn't find anything that would help me out.</p>

<p>I'm trying to do this in SQL:</p>

<pre><code>declare @locationType varchar(50);
declare @locationID int;

SELECT column1, column2
FROM viewWhatever
WHERE
CASE @locationType
    WHEN 'location' THEN account_location = @locationID
    WHEN 'area' THEN xxx_location_area = @locationID
    WHEN 'division' THEN xxx_location_division = @locationID
</code></pre>

<p>I know that I shouldn't have to put '= @locationID' at the end of each one but I can't get the syntax even close to being correct. SQL keeps complaining about my '=' on the first WHEN line...</p>

<p>Help!</p>
","<pre><code>declare @locationType varchar(50);
declare @locationID int;

SELECT column1, column2
FROM viewWhatever
WHERE
@locationID = 
  CASE @locationType
      WHEN 'location' THEN account_location
      WHEN 'area' THEN xxx_location_area 
      WHEN 'division' THEN xxx_location_division 
  END
</code></pre>
","206500"
"How to convert java.util.Date to java.sql.Date?","470583","","<p>I am trying to use a <a href=""http://docs.oracle.com/javase/8/docs/api/java/util/Date.html"" rel=""noreferrer""><code>java.util.Date</code></a> as input and then creating a query with it - so I need a <a href=""http://docs.oracle.com/javase/8/docs/api/java/sql/Date.html"" rel=""noreferrer""><code>java.sql.Date</code></a>.  </p>

<p>I was surprised to find that it couldn't do the conversion implicitly or explicitly - but I don't even know how I would do this, as the Java API is still fairly new to me.</p>
","<h1>tl;dr</h1>

<ul>
<li>Use <a href=""https://docs.oracle.com/javase/9/docs/api/java/time/package-summary.html"" rel=""nofollow noreferrer""><em>java.time</em></a> classes instead of legacy <code>java.util.Date</code> &amp; <code>java.sql.Date</code> with JDBC 4.2 or later.</li>
<li>Convert to/from java.time if inter-operating with code not yet updated to java.time.</li>
</ul>

<p>Example query with <a href=""https://docs.oracle.com/javase/9/docs/api/java/sql/PreparedStatement.html"" rel=""nofollow noreferrer""><code>PreparedStatement</code></a>.</p>

<pre><code>myPreparedStatement.setObject( 
    … ,                                         // Specify the ordinal number of which argument in SQL statement.
    myJavaUtilDate.toInstant()                  // Convert from legacy class `java.util.Date` (a moment in UTC) to a modern `java.time.Instant` (a moment in UTC).
        .atZone( ZoneId.of( ""Africa/Tunis"" ) )  // Adjust from UTC to a particular time zone, to determine a date. Instantiating a `ZonedDateTime`.
        .toLocalDate()                          // Extract a date-only `java.time.LocalDate` object from the date-time `ZonedDateTime` object.
)
</code></pre>

<h1>Details</h1>

<p>If you are trying to work with date-only values (no time-of-day, no time zone), use the <a href=""http://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html"" rel=""nofollow noreferrer""><code>LocalDate</code></a> class rather than <a href=""https://docs.oracle.com/javase/8/docs/api/java/util/Date.html"" rel=""nofollow noreferrer""><code>java.util.Date</code></a>.</p>

<h1>java.time</h1>

<p>In Java 8 and later, the troublesome old date-time classes bundled with early versions of Java have been supplanted by the new <a href=""http://docs.oracle.com/javase/8/docs/api/java/time/package-summary.html"" rel=""nofollow noreferrer"">java.time package</a>. See <a href=""http://docs.oracle.com/javase/tutorial/datetime/TOC.html"" rel=""nofollow noreferrer"">Oracle Tutorial</a>. Much of the functionality has been back-ported to Java 6 &amp; 7 in <a href=""http://www.threeten.org/threetenbp/"" rel=""nofollow noreferrer"">ThreeTen-Backport</a> and further adapted to Android in <a href=""https://github.com/JakeWharton/ThreeTenABP"" rel=""nofollow noreferrer"">ThreeTenABP</a>.</p>

<p>A <a href=""https://en.wikipedia.org/wiki/SQL#Data_types"" rel=""nofollow noreferrer"">SQL data type</a> <code>DATE</code> is meant to be date-only, with no time-of-day and no time zone. Java never had precisely such a class† until <a href=""http://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html"" rel=""nofollow noreferrer""><code>java.time.LocalDate</code></a> in Java 8. Let's create such a value by getting today's date according to a particular time zone (time zone is important in determining a date as a new day dawns earlier in Paris than in Montréal, for example).</p>

<pre><code>LocalDate todayLocalDate = LocalDate.now( ZoneId.of( ""America/Montreal"" ) );  // Use proper ""continent/region"" time zone names; never use 3-4 letter codes like ""EST"" or ""IST"".
</code></pre>

<p>At this point, we may be done. If your <a href=""https://en.wikipedia.org/wiki/JDBC_driver"" rel=""nofollow noreferrer"">JDBC driver</a> complies with <a href=""https://www.jcp.org/en/jsr/detail?id=221"" rel=""nofollow noreferrer"">JDBC 4.2 spec</a>, you should be able to pass a <code>LocalDate</code> via <a href=""https://docs.oracle.com/javase/8/docs/api/java/sql/PreparedStatement.html#setObject-int-java.lang.Object-"" rel=""nofollow noreferrer""><code>setObject</code></a> on a <a href=""https://docs.oracle.com/javase/8/docs/api/java/sql/PreparedStatement.html"" rel=""nofollow noreferrer""><code>PreparedStatement</code></a> to store into a SQL DATE field. </p>

<pre><code>myPreparedStatement.setObject( 1 , localDate );
</code></pre>

<p>Likewise, use <a href=""https://docs.oracle.com/javase/8/docs/api/java/sql/ResultSet.html#getObject-int-java.lang.Class-"" rel=""nofollow noreferrer""><code>ResultSet::getObject</code></a> to fetch from a SQL DATE column to a Java <code>LocalDate</code> object. Specifying the class in the second argument makes your code <a href=""https://en.wikipedia.org/wiki/Type_safety"" rel=""nofollow noreferrer"">type-safe</a>.</p>

<pre><code>LocalDate localDate = ResultSet.getObject( 1 , LocalDate.class );
</code></pre>

<p>In other words, <strong>this entire Question is irrelevant under JDBC 4.2</strong> or later.</p>

<p>If your JDBC driver does not perform in this manner, you need to fall back to converting to the java.sql types.</p>

<h1>Convert to java.sql.Date</h1>

<p>To convert, use new methods added to the old date-time classes. We can call <a href=""http://docs.oracle.com/javase/8/docs/api/java/sql/Date.html#valueOf-java.time.LocalDate-"" rel=""nofollow noreferrer""><code>java.sql.Date.valueOf(…)</code></a> to convert a <code>LocalDate</code>.</p>

<pre><code>java.sql.Date sqlDate = java.sql.Date.valueOf( todayLocalDate );
</code></pre>

<p>And going the other direction.</p>

<pre><code>LocalDate localDate = sqlDate.toLocalDate();
</code></pre>

<h1>Converting from <code>java.util.Date</code></h1>

<p>While you should avoid using the old date-time classes, you may be forced to when working with existing code. If so, you can convert to/from java.time. </p>

<p>Go through the <code>Instant</code> class, which represents a moment on the timeline in UTC. An <code>Instant</code> is similar in idea to a <code>java.util.Date</code>. But note that <code>Instant</code> has a resolution up to <a href=""https://en.wikipedia.org/wiki/Nanosecond"" rel=""nofollow noreferrer"">nanoseconds</a> while <code>java.util.Date</code> has only <a href=""https://en.wikipedia.org/wiki/Millisecond"" rel=""nofollow noreferrer"">milliseconds</a> resolution.</p>

<p>To convert, use new methods added to the old classes. For example, <a href=""http://docs.oracle.com/javase/8/docs/api/java/util/Date.html#from-java.time.Instant-"" rel=""nofollow noreferrer""><code>java.util.Date.from( Instant )</code></a> and <a href=""http://docs.oracle.com/javase/8/docs/api/java/util/Date.html#toInstant--"" rel=""nofollow noreferrer""><code>java.util.Date::toInstant</code></a>.</p>

<pre><code>Instant instant = myUtilDate.toInstant();
</code></pre>

<p>To determine a date, we need the context of a time zone. For any given moment, the date varies around the globe by time zone. Apply a <a href=""http://docs.oracle.com/javase/8/docs/api/java/time/ZoneId.html"" rel=""nofollow noreferrer""><code>ZoneId</code></a> to get a <a href=""http://docs.oracle.com/javase/8/docs/api/java/time/ZonedDateTime.html"" rel=""nofollow noreferrer""><code>ZonedDateTime</code></a>.</p>

<pre><code>ZoneId zoneId = ZoneId.of ( ""America/Montreal"" );
ZonedDateTime zdt = ZonedDateTime.ofInstant ( instant , zoneId );
LocalDate localDate = zdt.toLocalDate();
</code></pre>

<hr>

<p>† The java.sql.Date class pretends to be date-only without a time-of-day but actually <em>does</em> a time-of-day, adjusted to a midnight time. Confusing? Yes, the old date-time classes are a mess.</p>
","31238011"
"Can I concatenate multiple MySQL rows into one field?","469939","","<p>Using <code>MySQL</code>, I can do something like:</p>

<pre><code>SELECT hobbies FROM peoples_hobbies WHERE person_id = 5;
</code></pre>

<p>and get:</p>

<pre><code>shopping
fishing
coding
</code></pre>

<p>but instead I just want 1 row, 1 col:</p>

<pre><code>shopping, fishing, coding
</code></pre>

<p>The reason is that I'm selecting multiple values from multiple tables, and after all the joins I've got a lot more rows than I'd like.</p>

<p>I've looked for a function on <a href=""http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_concat-ws"" rel=""noreferrer"">MySQL Doc</a> and it doesn't look like the <code>CONCAT</code> or <code>CONCAT_WS</code> functions accept result sets, so does anyone here know how to do this?</p>
","<p>You can use <a href=""http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat"" rel=""noreferrer"">GROUP_CONCAT</a>.</p>

<p>As in:</p>

<pre><code>SELECT person_id, GROUP_CONCAT(hobbies SEPARATOR ', ')
FROM peoples_hobbies GROUP BY person_id
</code></pre>

<p><strong><a href=""https://stackoverflow.com/users/440546/death"">Death</a></strong>:
As Dag stated in his comment, there is a 1024 byte limit on result. To solve this, run this query before your query:</p>

<pre><code>SET group_concat_max_len = 2048
</code></pre>

<p>Of course, you can change <code>2048</code>  according to your needs.</p>
","276949"
"INNER JOIN ON vs WHERE clause","469061","","<p>For simplicity, assume all relevant fields are NOT NULL.</p>

<p>You can do:</p>

<pre><code>SELECT
    table1.this, table2.that, table2.somethingelse
FROM
    table1, table2
WHERE
    table1.foreignkey = table2.primarykey
    AND (some other conditions)
</code></pre>

<p>Or else:</p>

<pre><code>SELECT
    table1.this, table2.that, table2.somethingelse
FROM
    table1 INNER JOIN table2
    ON table1.foreignkey = table2.primarykey
WHERE
    (some other conditions)
</code></pre>

<p>Do these two work on the same way in MySQL?</p>
","<p><code>INNER JOIN</code> is ANSI syntax which you should use.</p>

<p>It is generally considered more readable, especially when you join lots of tables.</p>

<p>It can also be easily replaced with an <code>OUTER JOIN</code> whenever a need arises.</p>

<p>The <code>WHERE</code> syntax is more relational model oriented.</p>

<p>A result of two tables <code>JOIN</code>ed is a cartesian product of the tables to which a filter is applied which selects only those rows with joining columns matching.</p>

<p>It's easier to see this with the <code>WHERE</code> syntax.</p>

<p>As for your example, in MySQL (and in SQL generally) these two queries are synonyms.</p>

<p>Also note that MySQL also has a <code>STRAIGHT_JOIN</code> clause.</p>

<p>Using this clause, you can control the <code>JOIN</code> order: which table is scanned in the outer loop and which one is in the inner loop.</p>

<p>You cannot control this in MySQL using <code>WHERE</code> syntax.</p>
","1018825"
"The multi-part identifier could not be bound","468077","","<p>I've seen similar errors on SO, but I don't find a solution for my problem.
I have a SQL query like:</p>

<pre><code>SELECT DISTINCT
        a.maxa ,
        b.mahuyen ,
        a.tenxa ,
        b.tenhuyen ,
        ISNULL(dkcd.tong, 0) AS tongdkcd
FROM    phuongxa a ,
        quanhuyen b
        LEFT OUTER JOIN ( SELECT    maxa ,
                                    COUNT(*) AS tong
                          FROM      khaosat
                          WHERE     CONVERT(DATETIME, ngaylap, 103) BETWEEN 'Sep 1 2011'
                                                              AND
                                                              'Sep 5 2011'
                          GROUP BY  maxa
                        ) AS dkcd ON dkcd.maxa = a.maxa
WHERE   a.maxa &lt;&gt; '99'
        AND LEFT(a.maxa, 2) = b.mahuyen
ORDER BY maxa;
</code></pre>

<p>When I execute this query, the error result is:
<strong>The multi-part identifier ""a.maxa"" could not be bound.</strong> Why?
<br>
P/s: if i divide the query into 2 individual query, it run ok.</p>

<pre><code>SELECT DISTINCT
        a.maxa ,
        b.mahuyen ,
        a.tenxa ,
        b.tenhuyen
FROM    phuongxa a ,
        quanhuyen b
WHERE   a.maxa &lt;&gt; '99'
        AND LEFT(a.maxa, 2) = b.mahuyen
ORDER BY maxa;
</code></pre>

<p>and</p>

<pre><code>SELECT  maxa ,
        COUNT(*) AS tong
FROM    khaosat
WHERE   CONVERT(DATETIME, ngaylap, 103) BETWEEN 'Sep 1 2011'
                                        AND     'Sep 5 2011'
GROUP BY maxa;
</code></pre>
","<p>You are mixing implicit joins with explicit joins. That is allowed, but you need to be aware of how to do that properly.</p>

<p>The thing is, explicit joins (the ones that are implemented using the <code>JOIN</code> keyword) take precedence over implicit ones (the 'comma' joins, where the join condition is specified in the <code>WHERE</code> clause).</p>

<p>Here's an outline of your query:</p>

<pre><code>SELECT
  …
FROM a, b LEFT JOIN dkcd ON …
WHERE …
</code></pre>

<p>You are probably expecting it to behave like this:</p>

<pre><code>SELECT
  …
FROM (a, b) LEFT JOIN dkcd ON …
WHERE …
</code></pre>

<p>that is, the combination of tables <code>a</code> and <code>b</code> is joined with the table <code>dkcd</code>. In fact, what's happening is</p>

<pre><code>SELECT
  …
FROM a, (b LEFT JOIN dkcd ON …)
WHERE …
</code></pre>

<p>that is, as you may already have understood, <code>dkcd</code> is joined specifically against <code>b</code> and only <code>b</code>, then the result of the join is combined with <code>a</code> and filtered further with the <code>WHERE</code> clause. In this case, any reference to <code>a</code> in the <code>ON</code> clause is invalid, <code>a</code> is unknown at that point. That is why you are getting the error message.</p>

<p>If I were you, I would probably try to rewrite this query, and one possible solution might be:</p>

<pre><code>SELECT DISTINCT
  a.maxa,
  b.mahuyen,
  a.tenxa,
  b.tenhuyen,
  ISNULL(dkcd.tong, 0) AS tongdkcd
FROM phuongxa a
  INNER JOIN quanhuyen b ON LEFT(a.maxa, 2) = b.mahuyen
  LEFT OUTER JOIN (
    SELECT
      maxa,
      COUNT(*) AS tong
    FROM khaosat
    WHERE CONVERT(datetime, ngaylap, 103) BETWEEN 'Sep 1 2011' AND 'Sep 5 2011'
    GROUP BY maxa
  ) AS dkcd ON dkcd.maxa = a.maxa
WHERE a.maxa &lt;&gt; '99'
ORDER BY a.maxa
</code></pre>

<p>Here the tables <code>a</code> and <code>b</code> are joined first, then the result is joined to <code>dkcd</code>. Basically, this is the same query as yours, only using a different syntax for one of the joins, which makes a great difference: the reference <code>a.maxa</code> in the <code>dkcd</code>'s join condition is now absolutely valid.</p>

<p>As @Aaron Bertrand has correctly noted, you should probably qualify <code>maxa</code> with a specific alias, probably <code>a</code>, in the <code>ORDER BY</code> clause.</p>
","7314936"
"How to check which locks are held on a table","463571","","<p>How can we check which database locks are applied on which rows against a query batch? </p>

<p>Any tool that highlights table row level locking in real time? </p>

<p>DB: SQL Server 2005</p>
","<p>To add to the other responses, <code>sp_lock</code> can also be used to dump full lock information on all running processes.  The output can be overwhelming, but if you want to know exactly what is locked, it's a valuable one to run.  I usually use it along with <code>sp_who2</code> to quickly zero in on locking problems.</p>

<p>There are multiple different versions of ""friendlier"" <code>sp_lock</code> procedures available online, depending on the version of SQL Server in question.</p>

<p>In your case, for SQL Server 2005, <code>sp_lock</code> is still available, but deprecated, so it's now recommended to use the <a href=""http://msdn.microsoft.com/en-us/library/ms190345.aspx"" rel=""noreferrer""><code>sys.dm_tran_locks</code></a> view for this kind of thing.  You can find an example of how to ""roll your own"" sp_lock function <a href=""http://www.techrepublic.com/blog/the-enterprise-cloud/write-your-own-sp-lock-system-stored-procedure-in-sql-server-2005/"" rel=""noreferrer"">here</a>.</p>
","694659"
"Solutions for INSERT OR UPDATE on SQL Server","460044","","<p>Assume a table structure of <code>MyTable(KEY, datafield1, datafield2...)</code>.</p>

<p>Often I want to either update an existing record, or insert a new record if it doesn't exist.</p>

<p>Essentially:</p>

<pre><code>IF (key exists)
  run update command
ELSE
  run insert command
</code></pre>

<p>What's the best performing way to write this?</p>
","<p>don't forget about transactions. Performance is good, but simple (IF EXISTS..) approach is very dangerous.<br>
When multiple threads will try to perform Insert-or-update you can easily 
get primary key violation.</p>

<p>Solutions provided by @Beau Crawford &amp; @Esteban show general idea but error-prone.</p>

<p>To avoid deadlocks and PK violations you can use something like this:  </p>

<pre><code>begin tran
if exists (select * from table with (updlock,serializable) where key = @key)
begin
   update table set ...
   where key = @key
end
else
begin
   insert into table (key, ...)
   values (@key, ...)
end
commit tran
</code></pre>

<p>or</p>

<pre><code>begin tran
   update table with (serializable) set ...
   where key = @key

   if @@rowcount = 0
   begin
      insert into table (key, ...) values (@key,..)
   end
commit tran
</code></pre>
","108420"
"Pad a string with leading zeros so it's 3 characters long in SQL Server 2008","459826","","<p>I have a string that is up to 3 characters long when it's first created in SQL Server 2008 R2.</p>

<p>I would like to pad it with leading zeros, so if its original value was '1' then the new value would be '001'. Or if its original value was '23' the new value is '023'. Or if its original value is '124' then new value is the same as original value.</p>

<p>I am using SQL Server 2008 R2. How would I do this using T-SQL?</p>
","<p>If the field is already a string, this will work</p>

<pre><code> SELECT RIGHT('000'+ISNULL(field,''),3)
</code></pre>

<p>If you want nulls to show as '000'</p>

<p>It might be an integer -- then you would want </p>

<pre><code> SELECT RIGHT('000'+CAST(field AS VARCHAR(3)),3)
</code></pre>
","16760967"
"Difference between numeric, float and decimal in SQL Server","459407","","<p>I searched in Google and also visited <a href=""http://msdn.microsoft.com/en-us/library/aa258832(SQL.80).aspx"" rel=""noreferrer"">decimal and numeric</a> and <a href=""http://www.sql-server-helper.com/faq/data-types-p01.aspx"" rel=""noreferrer"">SQL Server Helper</a> to glean the difference between numeric, float and decimal datatypes and also to find out which one should be used in which situation.</p>

<p>For any kind of financial transaction (e.g. for salary field), which one is prefered and why?</p>
","<blockquote>
  <p>use the <em>float</em> or <em>real</em> data types <strong>only if</strong> the precision provided by <em>decimal</em> (up to 38 digits) is insufficient</p>
</blockquote>

<ul>
<li><p>Approximate numeric data types do not store the exact values specified <strong>for many</strong> numbers; they store <strong>an extremely close</strong> approximation of the value.(<a href=""https://technet.microsoft.com/en-us/library/ms187912(v=sql.105).aspx"" rel=""noreferrer"">Technet</a>)</p></li>
<li><p>Avoid using float or real columns in WHERE clause search conditions, especially the = and &lt;> operators (<a href=""https://technet.microsoft.com/en-us/library/ms187912(v=sql.105).aspx"" rel=""noreferrer"">Technet</a>)</p></li>
</ul>

<p>so generally because the <em>precision provided by decimal</em> is [10E38 ~ 38 digits] if your number can fit in it, and smaller storage space (and maybe speed) of Float is not important and dealing with abnormal behaviors and issues of approximate numeric types are not acceptable, <strong>use Decimal generally</strong>.</p>

<p>more useful information </p>

<ul>
<li>numeric = decimal (5 to 17 bytes) (<strong>Exact</strong> Numeric Data Type)

<ul>
<li>will map to Decimal in .NET </li>
<li>both have (18, 0) as default (precision,scale) parameters in SQL server</li>
<li>scale = maximum number of decimal digits that can be stored to the right of the decimal point.</li>
<li>kindly note that money(8 byte) and smallmoney(4 byte) are also exact and map to Decimal In .NET and have 4 decimal points(<a href=""http://technet.microsoft.com/en-us/library/ms179882.aspx"" rel=""noreferrer"">MSDN</a>)</li>
<li><a href=""http://msdn.microsoft.com/en-US/library/ms187746%28v=sql.105%29.aspx"" rel=""noreferrer"">decimal and numeric (Transact-SQL) - MSDN</a></li>
</ul></li>
<li>real (4 byte) (<strong>Approximate</strong>  Numeric Data Type)

<ul>
<li>will map to Single in .NET</li>
<li>The ISO synonym for real is float(24)</li>
<li><a href=""http://msdn.microsoft.com/en-US/library/ms173773%28v=sql.105%29.aspx"" rel=""noreferrer"">float and real (Transact-SQL) - MSDN</a></li>
</ul></li>
<li>float (8 byte) (<strong>Approximate</strong>  Numeric Data Type)

<ul>
<li>will map to Double in .NET</li>
</ul></li>
<li>All <strong>exact</strong> numeric types always produce the same result, regardless of which kind
of processor architecture is being used <strong>or the magnitude of the numbers</strong></li>
<li>The parameter supplied to the float data type defines the number of bits that are
used to store the <strong><a href=""http://en.wikipedia.org/wiki/Significand"" rel=""noreferrer"">mantissa</a> of the floating point number</strong>.</li>
<li>Approximate Numeric Data Type usually uses less storage and have better speed (up to 20x) and you should also consider when they got converted in .NET 

<ul>
<li><a href=""https://stackoverflow.com/a/618543/184572"">What is the difference between Decimal, Float and Double in C#</a> </li>
<li><a href=""https://stackoverflow.com/a/329618/184572"">Decimal vs Double Speed</a></li>
<li><a href=""http://msdn.microsoft.com/en-us/library/cc716729.aspx"" rel=""noreferrer"">SQL Server - .NET Data Type Mappings (From MSDN)</a></li>
</ul></li>
</ul>

<p><img src=""https://i.stack.imgur.com/HGYoK.png"" alt=""Exact Numeric Data Types"">
<img src=""https://i.stack.imgur.com/O6ahT.png"" alt=""Approximate Numeric Data Types""></p>

<p><strong>main source</strong> :  <a href=""http://oreilly.com/catalog/9780735626393?cmp=ex-orm-books-msp-9780735626393"" rel=""noreferrer"">MCTS Self-Paced Training Kit (Exam 70-433): Microsoft® SQL Server® 2008 Database Development</a>  - Chapter 3 - Tables , Data Types , and Declarative Data Integrity Lesson 1 - Choosing Data Types (Guidelines) - Page 93 </p>
","7158770"
"Unknown column in 'field list' error on MySQL Update query","457536","","<p>I keep getting MySQL error #1054, when trying to perform this update query:</p>

<pre><code>UPDATE MASTER_USER_PROFILE, TRAN_USER_BRANCH
SET MASTER_USER_PROFILE.fellow=`y`
WHERE MASTER_USER_PROFILE.USER_ID = TRAN_USER_BRANCH.USER_ID
AND TRAN_USER_BRANCH.BRANCH_ID = 17
</code></pre>

<p>It's probably some syntax error, but I've tried using an inner join instead and other alterations, but I keep getting the same message:</p>

<pre><code>Unknown column 'y' in 'field list' 
</code></pre>
","<p>Try using different quotes for ""y"" as the identifier quote character is the backtick (“`”). Otherwise MySQL ""thinks"" that you point to a column named ""y"".</p>

<p>See also <a href=""http://dev.mysql.com/doc/refman/5.0/en/identifiers.html"" rel=""noreferrer"">MySQL 5 Documentation</a></p>
","1346298"
"Best way to do nested case statement logic in SQL Server","454930","","<p>I'm currently writing an SQL Query, where a few of the columns returned need to be calculated depending on quite a lot of conditions.</p>

<p>I'm currently using nested case statements, but its getting messy. Is there a better (more organised and/or readable) way?</p>

<p>(I am using Microsoft SQL Server, 2005)</p>

<hr>

<p>A simplified example:</p>

<pre><code>SELECT
    col1,
    col2,
    col3,
    CASE
        WHEN condition 
        THEN
            CASE
                WHEN condition1 
                THEN
                    CASE 
                        WHEN condition2
                        THEN calculation1
                        ELSE calculation2
                    END
                ELSE
                    CASE 
                        WHEN condition2
                        THEN calculation3
                        ELSE calculation4
                    END
            END
        ELSE 
            CASE 
                WHEN condition1 
                THEN 
                    CASE
                        WHEN condition2 
                        THEN calculation5
                        ELSE calculation6
                    END
                ELSE
                    CASE
                        WHEN condition2 
                        THEN calculation7
                        ELSE calculation8
                    END
            END            
    END AS 'calculatedcol1',
    col4,
    col5 -- etc
FROM table
</code></pre>
","<p>You could try some sort of COALESCE trick, eg:</p>

<pre>
SELECT COALESCE(
  CASE WHEN condition1 THEN calculation1 ELSE NULL END,
  CASE WHEN condition2 THEN calculation2 ELSE NULL END,
  etc...
)
</pre>
","505760"
"MySQL Query GROUP BY day / month / year","453288","","<p>Is it possible I make a simple query to count how many records I have in a determined period of time like a Year, month or day, having a <code>TIMESTAMP</code> field, like: </p>

<pre><code>SELECT COUNT(id)
FROM stats
WHERE record_date.YEAR = 2009
GROUP BY record_date.YEAR
</code></pre>

<p>Or even:</p>

<pre><code>SELECT COUNT(id)
FROM stats
GROUP BY record_date.YEAR, record_date.MONTH
</code></pre>

<p>To have a monthly statistic. </p>

<p>Thanks!</p>
","<pre><code>GROUP BY YEAR(record_date), MONTH(record_date)
</code></pre>

<p>Check out the <a href=""http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_month"" rel=""noreferrer"">date and time functions</a> in MySQL.</p>
","508806"
"Update multiple columns in SQL","452351","","<p>Is there a way to update multiple columns in SQL server the same way an insert statement is used?</p>

<p>Something like:</p>

<pre><code>Update table1 set (a,b,c,d,e,f,g,h,i,j,k)=
(t2.a,t2.b,t2.c,t2.d,t2.e,t2.f,t2.g,t2.h,t2.i,t2.j,t2.k)
from table2 t2
where table1.id=table2.id
</code></pre>

<p>Or something like that, rather than like so:</p>

<pre><code>update table set a=t2.a,b=t2.b etc 
</code></pre>

<p>which can be pretty tiresome to write if you have 100+ columns.</p>
","<p>The ""tiresome way"" is standard SQL and how mainstream RDBMS do it.</p>

<p>With a 100+ columns, you mostly likely have a design problem... also, there are mitigating methods in client tools (eg generation UPDATE statements) or by using ORMs</p>
","9079656"
"How to select all records from one table that do not exist in another table?","450781","","<blockquote>
  <p>table1 (id, name)<br>
  table2 (id, name)</p>
</blockquote>

<p>Query:</p>

<pre><code>SELECT name   
FROM table2  
-- that are not in table1 already
</code></pre>
","<pre><code>SELECT t1.name
FROM table1 t1
LEFT JOIN table2 t2 ON t2.name = t1.name
WHERE t2.name IS NULL
</code></pre>

<p><strong>Q</strong>: What is happening here?</p>

<p><strong>A</strong>: Conceptually, we select all rows from <code>table1</code> and for each row we attempt to find a row in <code>table2</code> with the same value for the <code>name</code> column. If there is no such row, we just leave the <code>table2</code> portion of our result empty for that row. Then we constrain our selection by picking only those rows in the result where the matching row does not exist. Finally, We ignore all fields from our result except for the <code>name</code> column (the one we are sure that exists, from <code>table1</code>).</p>

<p>While it may not be the most performant method possible in all cases, it should work in basically every database engine ever that attempts to implement <a href=""https://en.wikipedia.org/wiki/SQL-92"" rel=""noreferrer"">ANSI 92 SQL</a></p>
","2686266"
"How do I list all tables in a schema in Oracle SQL?","448752","","<p>How do i list all tables in a schema in Oracle SQL?</p>
","<p>To see all tables in another schema, you need to have one or more of the following system privileges:</p>

<pre><code>SELECT ANY DICTIONARY
(SELECT | INSERT | UPDATE | DELETE) ANY TABLE
</code></pre>

<p>or the big-hammer, the DBA role.</p>

<p>With any of those, you can select:</p>

<pre><code>SELECT DISTINCT OWNER, OBJECT_NAME 
  FROM DBA_OBJECTS
 WHERE OBJECT_TYPE = 'TABLE'
   AND OWNER = '[some other schema]'
</code></pre>

<p>Without those system privileges, you can only see tables you have been granted some level of access to, whether directly or through a role.</p>

<pre><code>SELECT DISTINCT OWNER, OBJECT_NAME 
  FROM ALL_OBJECTS
 WHERE OBJECT_TYPE = 'TABLE'
   AND OWNER = '[some other schema]'
</code></pre>

<p>Lastly, you can always query the data dictionary for your own tables, as your rights to your tables cannot be revoked (as of 10g):</p>

<pre><code>SELECT DISTINCT OBJECT_NAME 
  FROM USER_OBJECTS
 WHERE OBJECT_TYPE = 'TABLE'
</code></pre>
","2247758"
"Changing the size of a column referenced by a schema-bound view in SQL Server","443635","","<p>I'm trying to change the size of a column in sql server using:</p>

<pre><code>ALTER TABLE [dbo].[Address]
ALTER COLUMN [Addr1] [nvarchar](80) NULL
</code></pre>

<p>where the length of <code>Addr1</code> was originally <code>40</code>.</p>

<p>It failed, raising this error:</p>

<pre><code>The object 'Address_e' is dependent on column 'Addr1'.
ALTER TABLE ALTER COLUMN Addr1 failed because one or more objects access 
this column.
</code></pre>

<p>I've tried to read up on it and it seems that because some views are referencing this column and it seems that SQL Server is actually trying to drop the column that raised the error.</p>

<p><code>Address_e</code> is a view created by the previous DB Administrator.</p>

<p>Is there any other way I can change the size of the column?</p>
","<p>The views are probably created using the WITH SCHEMABINDING option and this means they are explicitly wired up to prevent such changes. Looks like the schemabinding worked and prevented you from breaking those views, lucky day, heh? Contact your database administrator and ask him to do the change, after it asserts the impact on the database.</p>

<p>From <a href=""http://msdn.microsoft.com/en-us/library/ms187956.aspx"" rel=""noreferrer"">MSDN</a>:</p>

<blockquote>
  <p><strong>SCHEMABINDING</strong></p>
  
  <p>Binds the view to the schema of the underlying table or tables. When
  SCHEMABINDING is specified, the base
  table or tables cannot be modified in
  a way that would affect the view
  definition. <strong>The view definition itself
  must first be modified or dropped</strong> to
  remove dependencies on the table that
  is to be modified.</p>
</blockquote>
","1320158"
"How do I spool to a CSV formatted file using SQLPLUS?","438893","","<p>I want to extract some queries to a CSV output format. Unfortunately, I can't use any fancy SQL client or any language to do it. I must use SQLPLUS.</p>

<p>How do I do it?</p>
","<p>You could also use the following, although it does introduce spaces between fields.</p>

<pre><code>set colsep ,     -- separate columns with a comma
set pagesize 0   -- No header rows
set trimspool on -- remove trailing blanks
set headsep off  -- this may or may not be useful...depends on your headings.
set linesize X   -- X should be the sum of the column widths
set numw X       -- X should be the length you want for numbers (avoid scientific notation on IDs)

spool myfile.csv

select table_name, tablespace_name 
  from all_tables
 where owner = 'SYS'
   and tablespace_name is not null;
</code></pre>

<p>Output will be like:</p>

<pre><code>    TABLE_PRIVILEGE_MAP           ,SYSTEM                        
    SYSTEM_PRIVILEGE_MAP          ,SYSTEM                        
    STMT_AUDIT_OPTION_MAP         ,SYSTEM                        
    DUAL                          ,SYSTEM 
...
</code></pre>

<p>This would be a lot less tedious than typing out all of the fields and concatenating them with the commas.  You could follow up with a simple sed script to remove whitespace that appears before a comma, if you wanted.</p>

<p>Something like this might work...(my sed skills are very rusty, so this will likely need work)</p>

<pre><code>sed 's/\s+,/,/' myfile.csv 
</code></pre>
","654723"
"Save PL/pgSQL output from PostgreSQL to a CSV file","438062","","<p>What is the easiest way to save PL/pgSQL output from a PostgreSQL database to a CSV file? </p>

<p>I'm using PostgreSQL 8.4 with pgAdmin III and PSQL plugin where I run queries from.</p>
","<p>Do you want the resulting file on the server, or on the client?</p>

<h1>Server side</h1>

<p>If you want something easy to re-use or automate, you can use Postgresql's built in <a href=""http://www.postgresql.org/docs/current/interactive/sql-copy.html"" rel=""noreferrer"">COPY</a> command. e.g.</p>

<pre><code>Copy (Select * From foo) To '/tmp/test.csv' With CSV DELIMITER ',';
</code></pre>

<p><strong>This approach runs entirely on the remote server</strong> - it can't write to your local PC. It also needs to be run as a Postgres ""superuser"" (normally called ""root"") because Postgres can't stop it doing nasty things with that machine's local filesystem.</p>

<p>That doesn't actually mean you have to be connected as a superuser (automating that would be a security risk of a different kind), because you can use <a href=""http://www.postgresql.org/docs/current/interactive/sql-createfunction.html"" rel=""noreferrer"">the <code>SECURITY DEFINER</code> option to <code>CREATE FUNCTION</code></a> to make a function which <em>runs as though you were a superuser</em>. </p>

<p>The crucial part is that your function is there to perform additional checks, not just by-pass the security - so you could write a function which exports the exact data you need, or you could write something which can accept various options as long as they meet a strict whitelist. You need to check two things:</p>

<ol>
<li>Which <strong>files</strong> should the user be allowed to read/write on disk? This might be a particular directory, for instance, and the filename might have to have a suitable prefix or extension.</li>
<li>Which <strong>tables</strong> should the user be able to read/write in the database? This would normally be defined by <code>GRANT</code>s in the database, but the function is now running as a superuser, so tables which would normally be ""out of bounds"" will be fully accessible. You probably don’t want to let someone invoke your function and add rows on the end of your “users” table…</li>
</ol>

<p>I've written <a href=""http://rwec.co.uk/q/pg-copy"" rel=""noreferrer"">a blog post expanding on this approach</a>, including some examples of functions that export (or import) files and tables meeting strict conditions.</p>

<hr>

<h1>Client side</h1>

<p>The other approach is to <strong>do the file handling on the client side</strong>, i.e. in your application or script. The Postgres server doesn't need to know what file you're copying to, it just spits out the data and the client puts it somewhere.</p>

<p>The underlying syntax for this is the <code>COPY TO STDOUT</code> command, and graphical tools like pgAdmin will wrap it for you in a nice dialog.</p>

<p>The <strong><code>psql</code> command-line client</strong> has a special ""meta-command"" called <strong><code>\copy</code></strong>, which takes all the same options as the ""real"" <code>COPY</code>, but is run inside the client:</p>

<pre><code>\copy (Select * From foo) To '/tmp/test.csv' With CSV
</code></pre>

<p>Note that there is no terminating <code>;</code>, because meta-commands are terminated by newline, unlike SQL commands.</p>

<p>From <a href=""http://www.postgresql.org/docs/current/interactive/app-psql.html#APP-PSQL-META-COMMANDS-COPY"" rel=""noreferrer"">the docs</a>:</p>

<blockquote>
  <p>Do not confuse COPY with the psql instruction \copy. \copy invokes COPY FROM STDIN or COPY TO STDOUT, and then fetches/stores the data in a file accessible to the psql client. Thus, file accessibility and access rights depend on the client rather than the server when \copy is used.</p>
</blockquote>

<p>Your application programming language <em>may</em> also have support for pushing or fetching the data, but you cannot generally use <code>COPY FROM STDIN</code>/<code>TO STDOUT</code> within a standard SQL statement, because there is no way of connecting the input/output stream. PHP's PostgreSQL handler (<em>not</em> PDO) includes very basic <a href=""http://www.php.net/manual/en/function.pg-copy-from.php"" rel=""noreferrer""><code>pg_copy_from</code></a> and <a href=""http://www.php.net/manual/en/function.pg-copy-to.php"" rel=""noreferrer""><code>pg_copy_to</code></a> functions which copy to/from a PHP array, which may not be efficient for large data sets.</p>
","1517692"
"What is the syntax for an inner join in LINQ to SQL?","437308","","<p>I'm writing a LINQ to SQL statement, and I'm after the standard syntax for a normal inner join with an <code>ON</code> clause in C#.</p>

<p>How do you represent the following in LINQ to SQL:</p>

<pre><code>select DealerContact.*
from Dealer 
inner join DealerContact on Dealer.DealerID = DealerContact.DealerID
</code></pre>
","<p>It goes something like:</p>

<pre><code>from t1 in db.Table1
join t2 in db.Table2 on t1.field equals t2.field
select new { t1.field2, t2.field3}
</code></pre>

<p>It would be nice to have sensible names and fields for your tables for a better example. :)</p>

<p><strong>Update</strong></p>

<p>I think for your query this might be more appropriate:</p>

<pre><code>var dealercontacts = from contact in DealerContact
                     join dealer in Dealer on contact.DealerId equals dealer.ID
                     select contact;
</code></pre>

<p>Since you are looking for the contacts, not the dealers.</p>
","37332"
"How do I do top 1 in Oracle?","436496","","<p>How do I do the following?</p>

<pre><code>select top 1 Fname from MyTbl
</code></pre>

<p>In <a href=""https://en.wikipedia.org/wiki/Oracle_Database#Version_numbering"" rel=""noreferrer"">Oracle 11g</a>?</p>
","<p>If you want just a first selected row, you can:</p>

<pre><code>select fname from MyTbl where rownum = 1
</code></pre>

<p>You can also use analytic functions to order and take the top x:</p>

<pre><code>select max(fname) over (rank() order by some_factor) from MyTbl
</code></pre>
","3451569"
"Finding duplicate rows in SQL Server","436182","","<p>I have a SQL Server database of organizations, and there are many duplicate rows. I want to run a select statement to grab all of these and the amount of dupes, but also return the ids that are associated with each organization.</p>

<p>A statement like:  </p>

<pre><code>SELECT     orgName, COUNT(*) AS dupes  
FROM         organizations  
GROUP BY orgName  
HAVING      (COUNT(*) &gt; 1)
</code></pre>

<p>Will return something like</p>

<pre><code>orgName        | dupes  
ABC Corp       | 7  
Foo Federation | 5  
Widget Company | 2 
</code></pre>

<p>But I'd also like to grab the IDs of them. Is there any way to do this? Maybe like a </p>

<pre><code>orgName        | dupeCount | id  
ABC Corp       | 1         | 34  
ABC Corp       | 2         | 5  
...  
Widget Company | 1         | 10  
Widget Company | 2         | 2  
</code></pre>

<p>The reason being that there is also a separate table of users that link to these organizations, and I would like to unify them (therefore remove dupes so the users link to the same organization instead of dupe orgs). But I would like part manually so I don't screw anything up, but I would still need a statement returning the IDs of all the dupe orgs so I can go through the list of users.</p>
","<pre><code>select o.orgName, oc.dupeCount, o.id
from organizations o
inner join (
    SELECT orgName, COUNT(*) AS dupeCount
    FROM organizations
    GROUP BY orgName
    HAVING COUNT(*) &gt; 1
) oc on o.orgName = oc.orgName
</code></pre>
","2112639"
"How do I do multiple CASE WHEN conditions using SQL Server 2008?","432386","","<p>What I'm trying to do is use more than one CASE WHEN condition for the same column.</p>

<p>Here is my code for the query:</p>

<pre><code>   SELECT   Url='',
            p.ArtNo,
            p.[Description],
            p.Specification,
            CASE 
            WHEN 1 = 1 or 1 = 1 
               THEN 1 
               ELSE 0 
            END as Qty,
            p.NetPrice,
            [Status] = 0
      FROM  Product p (NOLOCK)
</code></pre>

<p>However, what I want to do is use more then one WHEN for the same column ""qty"".</p>

<p>As in the following code:</p>

<pre><code>IF
// CODE
ELSE IF
// CODE
ELSE IF
// CODE
ELSE
// CODE
</code></pre>
","<p>There are <a href=""https://docs.microsoft.com/en-in/sql/t-sql/language-elements/case-transact-sql"" rel=""noreferrer"">two formats of case expression</a>. You can do <code>CASE</code> with many <code>WHEN</code> as;</p>

<pre><code>CASE  WHEN Col1 = 1 OR Col3 = 1  THEN 1 
      WHEN Col1 = 2 THEN 2
      ...
      ELSE 0 END as Qty
</code></pre>

<p><em>Or</em> a Simple <code>CASE</code> expression</p>

<pre><code>CASE Col1 WHEN 1 THEN 11 WHEN 2 THEN 21 ELSE 13 END
</code></pre>

<p><em>Or</em> <code>CASE</code> <em>within</em> <code>CASE</code> as;</p>

<pre><code>CASE  WHEN Col1 &lt; 2 THEN  
                    CASE Col2 WHEN 'X' THEN 10 ELSE 11 END
      WHEN Col1 = 2 THEN 2
      ...
      ELSE 0 END as Qty
</code></pre>
","14631123"
"Import SQL file into mysql","429989","","<p>I have a database `nitm`. I haven't created any tables there. But I have an sql file which contains all the necessary data for the database. The file is `nitm.sql` which is in `C:\ drive`. This file has size of about 103M. I am using wamp server.</p>

<p>I have used the following syntax in mysql console to import the file.</p>

<pre><code>mysql&gt;c:/nitm.sql;
</code></pre>

<p>But this didn't work.</p>
","<p>Finally, i solved the problem. I placed the `nitm.sql` file in `bin` file of the `mysql` folder and used the following syntax.</p>

<pre><code>C:\wamp\bin\mysql\mysql5.0.51b\bin&gt;mysql -u root nitm &lt; nitm.sql
</code></pre>

<p>And this worked.</p>
","5154002"
"How can I select the first day of a month in SQL?","426059","","<p>I just need to select the first day of the month of a given datetime variable.</p>

<p>I know it's quite easy to do using this kind of code :</p>

<pre><code>select CAST(CAST(YEAR(@mydate) AS VARCHAR(4)) 
+ '/' + CAST(MONTH(@mydate) AS VARCHAR(2)) + '/01' AS DATETIME)
</code></pre>

<p>but this is not very elegant, and probably not very fast either.</p>

<p>Is there a 'better way to do this ? (I'm using SQL Server 2008)</p>
","<pre><code>SELECT DATEADD(month, DATEDIFF(month, 0, @mydate), 0) AS StartOfMonth
</code></pre>
","1520803"
"Nested select statement in SQL Server","425248","","<p>Can someone help me understand why the following doesn't work?</p>

<pre><code>SELECT name FROM (SELECT name FROM agentinformation)
</code></pre>

<p>I guess my understanding of SQL is wrong, because I would have thought this would return the same thing as  </p>

<pre><code>SELECT name FROM agentinformation
</code></pre>

<p>Doesn't the inner select statement create a result set which the outer SELECT statement then queries?</p>
","<p>You need to alias the subquery.</p>

<pre><code>SELECT name FROM (SELECT name FROM agentinformation) a  
</code></pre>

<p>or to be more explicit</p>

<pre><code>SELECT a.name FROM (SELECT name FROM agentinformation) a  
</code></pre>
","4630000"
"How to declare variable and use it in the same SQL script? (Oracle SQL)","420913","","<p>I am doing some tests written in SQL. I want to write reusable code and therefore want to declare some variables at the beginning and reuse them in the script, like this:</p>

<pre><code>DEFINE stupidvar = 'stupidvarcontent';

SELECT stupiddata
FROM stupidtable
WHERE stupidcolumn = &amp;stupidvar;
</code></pre>

<p><strong>How can I declare a variable and reuse it in statements that follow?  (I am using SQLDeveloper to access an Oracle DB.)</strong></p>

<p>I tried so far:</p>

<ul>
<li>Use a DECLARE section and insert the following SELECT statement in <code>BEGIN</code> and <code>END;</code>. Acces the variable using <code>&amp;stupidvar</code>.</li>
<li>Use the keyword <code>DEFINE</code> and access the variable.</li>
<li>Using the keyword <code>VARIABLE</code> and access the the variable.</li>
</ul>

<p>But I am getting all kinds of errors during my tries (Unbound variable, Syntax error, Expected <code>SELECT INTO</code>...).</p>

<p>While searching the net I find a lot of different explanations, concerning SQL, PL/SQL.</p>

<p>Thank you in advance!</p>
","<p>There are a several ways of declaring variables in SQL*Plus scripts.</p>

<p>The first is to use VAR.  The mechanism for assigning values to a VAR is with an EXEC call:</p>

<pre><code>SQL&gt; var name varchar2(20)
SQL&gt; exec :name := 'SALES'

PL/SQL procedure successfully completed.

SQL&gt; select * from dept
  2  where dname = :name
  3  /

    DEPTNO DNAME          LOC
---------- -------------- -------------
        30 SALES          CHICAGO

SQL&gt;
</code></pre>

<p>A VAR is particularly useful when we want to call a stored procedure which has OUT parameters or a function.</p>

<p>Alternativley we can use subsitution variables.  These are good for interactive mode:</p>

<pre><code>SQL&gt; accept p_dno prompt ""Please enter Department number: "" default 10
Please enter Department number: 20
SQL&gt; select ename, sal
  2  from emp
  3  where deptno = &amp;p_dno
  4  /
old   3: where deptno = &amp;p_dno
new   3: where deptno = 20

ENAME             SAL
---------- ----------
CLARKE            800
ROBERTSON        2975
RIGBY            3000
KULASH           1100
GASPAROTTO       3000

SQL&gt;
</code></pre>

<p>When we're writing a script which calls other scripts it can be useful to DEFine the variables upfront:</p>

<pre><code>SQL&gt; def p_dno = 40
SQL&gt; select ename, sal
  2  from emp
  3  where deptno = &amp;p_dno
  4  /
old   3: where deptno = &amp;p_dno
new   3: where deptno = 40

no rows selected

SQL&gt;
</code></pre>

<p>Finally there's the anonymous PL/SQL block.  As you see, we can still assign values to declared variables interactively:</p>

<pre><code>SQL&gt; set serveroutput on size unlimited
SQL&gt; declare
  2      n pls_integer;
  3      l_sal number := 3500;
  4      l_dno number := &amp;dno;
  5  begin
  6      select count(*)
  7      into n
  8      from emp
  9      where sal &gt; l_sal
 10      and deptno = l_dno;
 11      dbms_output.put_line('top earners = '||to_char(n));
 12  end;
 13  /
Enter value for dno: 10
old   4:     l_dno number := &amp;dno;
new   4:     l_dno number := 10;
top earners = 1

PL/SQL procedure successfully completed.

SQL&gt;
</code></pre>
","3564790"
"Import CSV file into SQL Server","420192","","<p>I am looking for help to import a <code>.csv</code> file into SQL Server using <code>BULK INSERT</code> and I have few basic questions.</p>

<p><strong>Issues:</strong>  </p>

<ol>
<li><p>The CSV file data may have <code>,</code> (comma) in between (Ex: description), so how can I  make import handling these data?  </p></li>
<li><p>If the client creates the CSV from Excel then the data that have comma are enclosed within <code>""""</code> (double quotes) [as the below example] so how do the import can handle this?  </p></li>
<li><p>How do we track if some rows have bad data, which import skips? (does import skips rows that are not importable)</p></li>
</ol>

<p>Here is the sample CSV with header:</p>

<pre><code>Name,Class,Subject,ExamDate,Mark,Description
Prabhat,4,Math,2/10/2013,25,Test data for prabhat.
Murari,5,Science,2/11/2013,24,""Test data for his's test, where we can test 2nd ROW, Test.""
sanjay,4,Science,,25,Test Only.
</code></pre>

<p>And SQL statement to import:</p>

<pre><code>BULK INSERT SchoolsTemp
FROM 'C:\CSVData\Schools.csv'
WITH
(
    FIRSTROW = 2,
    FIELDTERMINATOR = ',',  --CSV field delimiter
    ROWTERMINATOR = '\n',   --Use to shift the control to next row
    TABLOCK
)
</code></pre>
","<p>Based SQL Server CSV Import</p>

<blockquote>
  <p>1) The CSV file data may have <code>,</code> (comma) in between (Ex:
  description), so how can I make import handling these data?</p>
</blockquote>

<p><strong>Solution</strong></p>

<p>If you're using <code>,</code> (comma) as a delimiter, then there is no way to differentiate between a comma as a field terminator and a comma in your data. I would use a different <code>FIELDTERMINATOR</code> like <code>||</code>. Code would look like and this will handle comma and single slash perfectly.</p>

<blockquote>
  <p>2) If the client create the csv from excel then the data that have
  comma are enclosed within <code>"" ... ""</code> (double quotes) [as the below
  example] so how do the import can handle this?</p>
</blockquote>

<p><strong>Solution</strong></p>

<p>If you're using BULK insert then there is no way to handle double quotes, data will be
inserted with double quotes into rows.
after inserting the data into table you could replace those double quotes with '<code></code>'.</p>

<pre><code>update table
set columnhavingdoublequotes = replace(columnhavingdoublequotes,'""','')
</code></pre>

<blockquote>
  <p>3) How do we track if some rows have bad data, which import skips?
  (does import skips rows that are not importable)?</p>
</blockquote>

<p><strong>Solution</strong></p>

<p>To handle rows which aren't loaded into table because of invalid data or format, could be
handle using <a href=""http://msdn.microsoft.com/en-us/library/ms188365.aspx"" rel=""noreferrer"">ERRORFILE property</a>, specify the error file name, it will write the rows
having error to error file. code should look like.</p>

<pre><code>BULK INSERT SchoolsTemp
    FROM 'C:\CSVData\Schools.csv'
    WITH
    (
    FIRSTROW = 2,
    FIELDTERMINATOR = ',',  --CSV field delimiter
    ROWTERMINATOR = '\n',   --Use to shift the control to next row
    ERRORFILE = 'C:\CSVDATA\SchoolsErrorRows.csv',
    TABLOCK
    )
</code></pre>
","15243801"
"How do I query between two dates using MySQL?","417760","","<p>The following query:</p>

<pre><code>SELECT * FROM `objects` 
WHERE (date_field BETWEEN '2010-09-29 10:15:55' AND '2010-01-30 14:15:55')
</code></pre>

<p>returns nothing.</p>

<p>I should have more than enough data to for the query to work though. What am I doing wrong?</p>
","<p>Your second date is before your first date (ie. you are querying between September 29 2010 and January 30 2010). Try reversing the order of the dates:</p>

<pre><code>SELECT *
FROM `objects`
WHERE (date_field BETWEEN '2010-01-30 14:15:55' AND '2010-09-29 10:15:55')
</code></pre>
","3822668"
"How can I create a copy of an Oracle table without copying the data?","416631","","<p>I know the statement:</p>

<pre><code>create table xyz_new as select * from xyz;
</code></pre>

<p>Which copies the structure and the data, but what if I just want the structure?</p>
","<p>Just use a where clause that won't select any rows:</p>

<pre><code>create table xyz_new as select * from xyz where 1=0;
</code></pre>

<h3>Limitations</h3>

<p>The following things will not be copied to the new table:</p>

<ul>
<li>sequences</li>
<li>triggers</li>
<li>indexes</li>
<li>some constraints may not be copied</li>
<li>materialized view logs</li>
</ul>

<p>This also does not handle partitions</p>

<hr>
","233890"
"How do I reset a sequence in Oracle?","416393","","<p>In <a href=""http://en.wikipedia.org/wiki/PostgreSQL"" rel=""noreferrer"">PostgreSQL</a>, I can do something like this:</p>

<pre><code>ALTER SEQUENCE serial RESTART WITH 0;
</code></pre>

<p>Is there an Oracle equivalent?</p>
","<p>Here is a good procedure for resetting any sequence to 0 from Oracle guru <a href=""http://asktom.oracle.com"" rel=""noreferrer"">Tom Kyte</a>.  Great discussion on the pros and cons in the links below too.</p>

<pre><code>tkyte@TKYTE901.US.ORACLE.COM&gt; 
create or replace
procedure reset_seq( p_seq_name in varchar2 )
is
    l_val number;
begin
    execute immediate
    'select ' || p_seq_name || '.nextval from dual' INTO l_val;

    execute immediate
    'alter sequence ' || p_seq_name || ' increment by -' || l_val || 
                                                          ' minvalue 0';

    execute immediate
    'select ' || p_seq_name || '.nextval from dual' INTO l_val;

    execute immediate
    'alter sequence ' || p_seq_name || ' increment by 1 minvalue 0';
end;
/
</code></pre>

<p>From this page: <a href=""http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:951269671592"" rel=""noreferrer"">Dynamic SQL to reset sequence value</a><br>
Another good discussion is also here: <a href=""http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:1119633817597"" rel=""noreferrer"">How to reset sequences?</a></p>
","93633"
"Altering column size in SQL Server","414937","","<p>I would like to change the column size of the <code>salary</code> column in the <code>employee</code> table from <code>numeric(18,0)</code> to <code>numeric(22,5)</code></p>

<p>Can some tell me how to do it?</p>
","<pre><code>ALTER TABLE [Employee]
ALTER COLUMN [Salary] NUMERIC(22,5)
</code></pre>
","10138150"
"How to send multiple data fields via Ajax?","414132","","<p>I'm stuck: I'm trying to submit a form using AJAX, but I can't find a way to send multiple data fields via my AJAX call.</p>

<pre><code>$(document).ready(function() {
  $(""#btnSubmit"").click(function()  {
    var status = $(""#activitymessage"").val();
    var name = ""Ronny"";
    $.ajax({
      type: ""POST"",
      url: ""ajax/activity_save.php"",
      **data: ""status=""+status+""name=""+name""**,
      success: function(msg) {...
</code></pre>

<p>I've tried all sorts of stuff:</p>

<pre><code>data: {status: status, name: name},
</code></pre>

<p>Or even stuff like this just for testing purposes:</p>

<pre><code>data: ""status=testing&amp;name=ronny"",
</code></pre>

<p>But whatever I try, I get nothing in my <code>activity_save.php</code> thus nothing in my SQL.</p>

<p>So, what's the correct syntax to put more lines of data in my AJAX call?</p>
","<p>The correct syntax is:</p>

<pre><code>data: {status: status, name: name},
</code></pre>

<p>As specified here: <a href=""http://api.jquery.com/jQuery.ajax/"" rel=""nofollow noreferrer"">http://api.jquery.com/jQuery.ajax/</a></p>

<p>So if that doesn't work, I would alert those variables to make sure they have values.</p>
","6085669"
"How to insert a value that contains an apostrophe (single quote)?","412630","","<p>What is the correct SQL syntax to insert a value with an apostrophe in it?</p>

<pre><code>Insert into Person
  (First, Last)
Values
  'Joe',
  'O'Brien'
</code></pre>

<p>I keep getting an error as I think the apostrophe after the O is the ending tag for the value.</p>
","<p>Escape the apostrophe (i.e. double-up the single quote character) in your SQL: </p>

<pre><code>INSERT INTO Person
    (First, Last)
VALUES
    ('Joe', 'O''Brien')
              /\
          right here  
</code></pre>

<p>The same applies to SELECT queries:</p>

<pre><code>SELECT First, Last FROM Person WHERE Last = 'O''Brien'
</code></pre>

<hr />

<p>The apostrophe, or single quote, is a special character in SQL that specifies the beginning and end of string data. This means that to use it as part of your literal string data you need to <code>escape</code> the special character. With a single quote this is typically accomplished by doubling your quote. (Two single quote characters, not double-quote instead of a single quote.) </p>

<p><strong>Note</strong>: You should only ever worry about this issue when you manually edit data via a raw SQL interface since writing queries outside of development and testing should be a rare occurrence. In code there are techniques and frameworks (depending on your stack) that take care of escaping special characters, <a href=""http://en.wikipedia.org/wiki/SQL_injection"" rel=""noreferrer"">SQL injection</a>, etc.</p>
","1912100"
"Difference between JOIN and INNER JOIN","412241","","<p>Both these joins will give me the same results:</p>

<pre><code>SELECT * FROM table JOIN otherTable ON table.ID = otherTable.FK
</code></pre>

<p>vs</p>

<pre><code>SELECT * FROM table INNER JOIN otherTable ON table.ID = otherTable.FK
</code></pre>

<p>Is there any difference between the statements in performance or otherwise? </p>

<p>Does it differ between different SQL implementations? </p>
","<p>They are functionally equivalent, but <code>INNER JOIN</code> can be a bit clearer to read, especially if the query has other join types (i.e. <code>LEFT</code> or <code>RIGHT</code> or <code>CROSS</code>) included in it.</p>
","565640"
"MySQL ""NOT IN"" query","410214","","<p>I wanted to run a simple query to throw up all the rows of <code>Table1</code> where a principal column value is not present in a column in another table (<code>Table2</code>).</p>

<p>I tried using:</p>

<pre><code>SELECT * FROM Table1 WHERE Table1.principal NOT IN Table2.principal
</code></pre>

<p>This is instead throwing a syntax error. Google search led me to forums where people were saying that MySQL does not support <code>NOT IN</code> and something extremely complex needs to be used. Is this true? Or am I making a horrendous mistake?</p>
","<p>To use IN, you must have a set, use this syntax instead:</p>

<pre><code>SELECT * FROM Table1 WHERE Table1.principal NOT IN (SELECT principal FROM table2)
</code></pre>
","1519296"
"How to get first character of a string in SQL?","408509","","<p>I have a SQL column with a length of 6. Now want to take only the first char of that column. Is there any string function in SQL to do this?</p>
","<p><code>LEFT(colName, 1)</code> will also do this, also.  It's equivalent to <code>SUBSTRING(colName, 1, 1)</code>.  </p>

<p>I like <code>LEFT</code>, since I find it a bit cleaner, but really, there's no difference either way.</p>
","792302"
"How to select date without time in SQL","404347","","<p>When I select date in SQL it is returned as  <code>2011-02-25 21:17:33.933</code>. But I need only the Date part, that is <code>2011-02-25</code>. How can I do this?</p>
","<p>I guess he wants a string</p>

<pre><code>select convert(varchar(10), '2011-02-25 21:17:33.933', 120)
</code></pre>
","5125767"
"SQL Server SELECT LAST N Rows","404159","","<p>This is a known question but the best solution I've found is something like:</p>

<pre><code>SELECT TOP N *
FROM MyTable
ORDER BY Id DESC
</code></pre>

<p>I've a table with lots of rows. It is not a posibility to use that query because it takes lot of time. So how can I do to select last N rows without using ORDER BY?</p>

<p><strong>EDIT</strong></p>

<p>Sorry duplicated question of <a href=""https://stackoverflow.com/questions/311054/how-do-i-select-last-5-rows-in-a-table-without-sorting"">this one</a></p>
","<p>You can do it by using the ROW NUMBER BY PARTITION Feature also. A great example can be found <a href=""http://www.sqlservercurry.com/2009/02/retrieve-last-n-rows-based-on-condition.html"" rel=""noreferrer"">here</a>:</p>

<blockquote>
  <p>I am using the Orders table of the Northwind database... Now let us retrieve the Last 5 orders placed by Employee 5:</p>

<pre><code>SELECT ORDERID, CUSTOMERID, OrderDate
FROM
(
    SELECT ROW_NUMBER() OVER (PARTITION BY EmployeeID ORDER BY OrderDate DESC) AS OrderedDate,*
    FROM Orders
) as ordlist

WHERE ordlist.EmployeeID = 5
AND ordlist.OrderedDate &lt;= 5
</code></pre>
</blockquote>
","4193757"
"How to do a FULL OUTER JOIN in MySQL?","402297","","<p>I want to do a Full Outer Join in MySQL. Is this possible? Is a Full Outer Join supported by MySQL?</p>
","<p>You don't have FULL JOINS on MySQL, but you can sure <a href=""http://dev.mysql.com/doc/refman/5.0/en/outer-join-simplification.html"" rel=""noreferrer"">emulate them</a>.</p>

<p>For a code SAMPLE transcribed from <a href=""https://stackoverflow.com/questions/2384298/mysql-full-outer-join-syntax-error"">this SO question</a> you have:</p>

<p>with two tables t1, t2:</p>

<pre><code>SELECT * FROM t1
LEFT JOIN t2 ON t1.id = t2.id
UNION
SELECT * FROM t1
RIGHT JOIN t2 ON t1.id = t2.id
</code></pre>

<hr>

<p>The query above works for special cases where a FULL OUTER JOIN operation would not produce any duplicate rows. The query above depends on the <code>UNION</code> set operator to remove duplicate rows introduced by the query pattern.  We can avoid introducing duplicate rows by using an <em>anti-join</em> pattern for the second query, and then use a UNION ALL set operator to combine the two sets. In the more general case, where a FULL OUTER JOIN would return duplicate rows, we can do this:</p>

<pre><code>  SELECT * FROM t1
  LEFT JOIN t2 ON t1.id = t2.id
  UNION ALL
  SELECT * FROM t1
  RIGHT JOIN t2 ON t1.id = t2.id
  WHERE t1.id IS NULL
</code></pre>
","4796911"
"CASE .. WHEN expression in Oracle SQL","399203","","<p>I have the table with 1 column and has following data</p>

<pre><code>Status
a1
i
t
a2
a3
</code></pre>

<p>I want to display the following result in my select query</p>

<pre><code>Status| STATUSTEXT
a1    | Active
i     | Inactive
t     | Terminated
a2    | Active
a3    | Active
</code></pre>

<p>One way I could think was using a Switch When expression in select query</p>

<pre><code>SELECT
status,
CASE status 
WHEN 'a1' THEN 'Active'
WHEN 'a2' THEN 'Active'
WHEN 'a3' THEN 'Active'
WHEN 'i' THEN 'Inactive'
WHEN 't' THEN 'Terminated'
END AS StatusText
FROM stage.tst
</code></pre>

<p>Is there any other way of doing this where I don't need to write <i><B>When expression 3 times for Active Status </B></i> and the entire active status can be checked in one single expression?</p>
","<p>You could use an <code>IN</code> clause</p>

<p>Something like</p>

<pre><code>SELECT
  status,
  CASE
    WHEN STATUS IN('a1','a2','a3')
    THEN 'Active'
    WHEN STATUS = 'i'
    THEN 'Inactive'
    WHEN STATUS = 't'
    THEN 'Terminated'
  END AS STATUSTEXT
FROM
  STATUS
</code></pre>

<p>Have a look at this demo</p>

<h2><a href=""http://www.sqlfiddle.com/#!4/94578/2/0"">SQL Fiddle DEMO</a></h2>
","12650929"
"Insert Data Into Temp Table with Query","396265","","<p>I have an existing query that outputs current data, and I would like to insert it into a Temp table, but am having some issues doing so. Would anybody have some insight on how to do this?</p>

<p>Here is an example</p>

<pre><code>SELECT *
FROM  (SELECT Received,
              Total,
              Answer,
              ( CASE
                  WHEN application LIKE '%STUFF%' THEN 'MORESTUFF'
                END ) AS application
       FROM   FirstTable
       WHERE  Recieved = 1
              AND application = 'MORESTUFF'
       GROUP  BY CASE
                   WHEN application LIKE '%STUFF%' THEN 'MORESTUFF'
                 END) data
WHERE  application LIKE isNull('%MORESTUFF%', '%') 
</code></pre>

<p>This seems to output my data currently the way that i need it to, but I would like to pass it into a Temp Table. My problem is that I am pretty new to SQL Queries and have not been able to find a way to do so. Or if it is even possible. If it is not possible, is there a better way to get the data that i am looking for <code>WHERE application LIKE isNull('%MORESTUFF%','%')</code> into a temp table?</p>

<p>Any help would be much appreciated! Thanks!</p>
","<pre><code>SELECT *
INTO #Temp
FROM

  (SELECT
     Received,
     Total,
     Answer,
     (CASE WHEN application LIKE '%STUFF%' THEN 'MORESTUFF' END) AS application
   FROM
     FirstTable
   WHERE
     Recieved = 1 AND
     application = 'MORESTUFF'
   GROUP BY
     CASE WHEN application LIKE '%STUFF%' THEN 'MORESTUFF' END) data
WHERE
  application LIKE
    isNull(
      '%MORESTUFF%',
      '%')
</code></pre>
","20107911"
"How can I list all foreign keys referencing a given table in SQL Server?","396097","","<p>I need to remove a highly referenced table in a SQL Server database.  How can I get a list of all the foreign key constraints I will need to remove in order to drop the table?</p>

<p>(SQL answers preferable over clicking about in the GUI of the management studio.)</p>
","<p>Not sure why no one suggested but I use <code>sp_fkeys</code> to query foreign keys for a given table:</p>

<pre><code>EXEC sp_fkeys 'TableName'
</code></pre>
","12956348"
"How do I check if a column is empty or null in mysql","395720","","<p>I have a column in a table which might contain null or empty values. How do I check if a column is empty or null in the rows present in a table.</p>

<pre><code>(e.g. null or '' or '  ' or '      ' and ...)
</code></pre>
","<p>This will select all rows where <code>some_col</code> is <code>NULL</code> or <code>''</code> (empty string)</p>

<pre><code>SELECT * FROM table WHERE some_col IS NULL OR some_col = '';
</code></pre>
","8470865"
"SQL server query to get the list of columns in a table along with Data types, NOT NULL, and PRIMARY KEY constraints","395134","","<p>I need to write a query on SQL server to get the list of columns in a particular table, its associated data types and their length and if they are not null. I have managed to do this much. But now i also need to get in the same table against a column - TRUE if it is a primary key. How do i do this ? </p>

<p>This is how the output should be:</p>

<p><code>Columns_name----Data type----Length----isnull----Pk</code></p>

<p>please help me!</p>
","<p>To avoid duplicate rows for some columns, use user_type_id instead of system_type_id.</p>

<pre><code>SELECT 
    c.name 'Column Name',
    t.Name 'Data type',
    c.max_length 'Max Length',
    c.precision ,
    c.scale ,
    c.is_nullable,
    ISNULL(i.is_primary_key, 0) 'Primary Key'
FROM    
    sys.columns c
INNER JOIN 
    sys.types t ON c.user_type_id = t.user_type_id
LEFT OUTER JOIN 
    sys.index_columns ic ON ic.object_id = c.object_id AND ic.column_id = c.column_id
LEFT OUTER JOIN 
    sys.indexes i ON ic.object_id = i.object_id AND ic.index_id = i.index_id
WHERE
    c.object_id = OBJECT_ID('YourTableName')
</code></pre>

<p>Just replace <code>YourTableName</code> with your actual table name - works for SQL Server 2005 and up.</p>
","2418665"
"SQL Server: IF EXISTS ; ELSE","391720","","<p>I have a tableA:</p>

<pre><code>ID value
 1  100
 2  101
 2  444
 3  501
</code></pre>

<p>Also TableB </p>

<pre><code>ID Code
1
2
</code></pre>

<p>Now I want to populate col = code of table B if there exists ID = 2 in tableA. for multiple values , get max value.
else populate it with '123'. Now here is what I used:</p>

<pre><code>if exists (select MAX(value) from #A where id = 2)
 BEGIN
 update #B
 set code = (select MAX(value) from #A where id = 2)
 from #A
 END

 ELSE 

 update #B
 set code = 123
 from #B
</code></pre>

<p>I am sure there is some problem in BEGIN;END or in IF EXIST;ELSE.
Basically I want to by-pass the else part if select statement in IF-part exist and vice- versa. For example if select statement of IF=part is:</p>

<pre><code>(select MAX(value) from #A where id = 4)
</code></pre>

<p>It should just populate 123, coz ID = 4 do not exist ! Please educate ! 
Thanks in Advance</p>
","<p><strong>EDIT</strong> </p>

<p>I want to add the reason that your <code>IF</code> statement seems to not work. When you do an <code>EXISTS</code> on an aggregate, it's always going to be <code>true</code>. It returns a value even if the <code>ID</code> doesn't exist. Sure, it's <code>NULL</code>, but its returning it. Instead, do this:</p>

<pre><code>if exists(select 1 from table where id = 4)
</code></pre>

<p>and you'll get to the <code>ELSE</code> portion of your <code>IF</code> statement.</p>

<hr>

<p>Now, here's a better, set-based solution:</p>

<pre><code>update b
  set code = isnull(a.value, 123)
from #b b
left join (select id, max(value) from #a group by id) a
  on b.id = a.id
where
  b.id = yourid
</code></pre>

<p>This has the benefit of being able to run on the entire table rather than individual ids.</p>
","7425208"
"What's the difference between VARCHAR and CHAR?","388576","","<p>What's the difference between VARCHAR and CHAR in MySQL?</p>

<p>I am trying to store MD5 hashes.</p>
","<p><code>VARCHAR</code> is variable-length.</p>

<p><code>CHAR</code> is fixed length.</p>

<p>If your content is a fixed size, you'll get better performance with <code>CHAR</code>.</p>

<p>See the MySQL page on <a href=""http://dev.mysql.com/doc/refman/5.7/en/char.html"" rel=""noreferrer"">CHAR and VARCHAR Types</a> for a detailed explaination (be sure to also read the comments).</p>
","1885635"
"Reason for Column is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause","388567","","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""https://stackoverflow.com/questions/4611897/group-by-aggregate-function-confusion-in-sql"">GROUP BY / aggregate function confusion in SQL</a>  </p>
</blockquote>



<p>I got an error - 
Column 'Employee.EmpID' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.</p>

<hr>

<pre><code>select loc.LocationID, emp.EmpID
from Employee as emp full join Location as loc 
on emp.LocationID = loc.LocationID
group by loc.LocationID 
</code></pre>

<p>This situation fits into the answer given by Bill Karwin.</p>

<p>correction for above, fits into answer by ExactaBox - </p>

<pre><code>select loc.LocationID, count(emp.EmpID) -- not count(*), don't want to count nulls
from Employee as emp full join Location as loc 
on emp.LocationID = loc.LocationID
group by loc.LocationID 
</code></pre>

<hr>

<p>ORIGINAL QUESTION -</p>

<p>For the SQL query -</p>

<pre><code>select *
from Employee as emp full join Location as loc 
on emp.LocationID = loc.LocationID
group by (loc.LocationID)
</code></pre>

<p>I don't understand why I get this error. All I want to do is join the tables and then group all the employees in a particular location together. </p>

<p><strong>I think I have a partial explanation for my own question. Tell me if its ok -</strong> </p>

<p>To group all employees that work in the same location we have to first mention the LocationID. </p>

<p>Then, we cannot/do not mention each employee ID next to it. Rather, we mention the total number of employees in that location, ie we should SUM() the employees working in that location. Why do we do it the latter way, i am not sure. 
So, this explains the ""it is not contained in either an aggregate function"" part of the error.</p>

<p>What is the explanation for the ""GROUP BY clause"" part of the error ?</p>
","<p>Suppose I have the following table <code>T</code>:</p>

<pre><code>a   b
--------
1   abc
1   def
1   ghi
2   jkl
2   mno
2   pqr
</code></pre>

<p>And I do the following query:</p>

<pre><code>SELECT a, b
FROM T
GROUP BY a
</code></pre>

<p>The output should have two rows, one row where <code>a=1</code> and a second row where <code>a=2</code>.</p>

<p>But what should the value of <em>b</em> show on each of these two rows? There are three possibilities in each case, and nothing in the query makes it clear which value to choose for b in each group. It's ambiguous.</p>

<p>This demonstrates the <em>single-value rule</em>, which prohibits the undefined results you get when you run a GROUP BY query, and you include any columns in the select-list that are neither part of the grouping criteria, nor appear in aggregate functions (SUM, MIN, MAX, etc.).</p>

<p>Fixing it might look like this:</p>

<pre><code>SELECT a, MAX(b) AS x
FROM T
GROUP BY a
</code></pre>

<p>Now it's clear that you want the following result:</p>

<pre><code>a   x
--------
1   ghi
2   pqr
</code></pre>
","13999903"
"declare variable for query string","387213","","<p>Hey all, i was wondering if there was a way to do this in MS SQL Server 2005:</p>

<pre><code>  DECLARE @theDate varchar(60)
  SET @theDate = '''2010-01-01'' AND ''2010-08-31 23:59:59'''

  SELECT    AdministratorCode, 
            SUM(Total) as theTotal, 
            SUM(WOD.Quantity) as theQty, 
            AVG(Total) as avgTotal, 
            (SELECT SUM(tblWOD.Amount)
                FROM tblWOD
                JOIN tblWO on tblWOD.OrderID = tblWO.ID
                WHERE tblWO.Approved = '1' 
                AND tblWO.AdministratorCode = tblWO.AdministratorCode
                AND tblWO.OrderDate BETWEEN @theDate
            )
 ... etc
</code></pre>

<p>Possible to do?</p>

<p>David</p>
","<p>It's possible, but it requires using dynamic SQL.<br>
I recommend reading <a href=""http://www.sommarskog.se/dynamic_sql.html"" rel=""noreferrer"">The curse and blessings of dynamic SQL</a> before continuing...</p>

<pre><code>DECLARE @theDate varchar(60)
SET @theDate = '''2010-01-01'' AND ''2010-08-31 23:59:59'''

DECLARE @SQL VARCHAR(MAX)  
SET @SQL = 'SELECT AdministratorCode, 
                   SUM(Total) as theTotal, 
                   SUM(WOD.Quantity) as theQty, 
                   AVG(Total) as avgTotal, 
                  (SELECT SUM(tblWOD.Amount)
                     FROM tblWOD
                     JOIN tblWO on tblWOD.OrderID = tblWO.ID
                    WHERE tblWO.Approved = ''1''
                      AND tblWO.AdministratorCode = tblWO.AdministratorCode
                      AND tblWO.OrderDate BETWEEN '+ @theDate +')'

EXEC(@SQL)
</code></pre>

<p>Dynamic SQL is just a SQL statement, composed as a string before being executed.  So the usual string concatenation occurs.  Dynamic SQL is required whenever you want to do something in SQL syntax that isn't allowed, like:</p>

<ul>
<li>a single parameter to represent comma separated list of values for an IN clause</li>
<li>a variable to represent both value and SQL syntax (IE: the example you provided)</li>
</ul>

<p><code>EXEC sp_executesql</code> allows you to use bind/preparedstatement parameters so you don't have to concern yourself with escaping single quotes/etc for SQL injection attacks.</p>
","3833421"
"sql query to return differences between two tables","385618","","<p>I am trying to compare two tables, SQL Server, to verify some data. I want to return all the rows from both tables where data is either in one or the other. In essence, I want to show all the discrepancies. I need to check three pieces of data in doing so, FirstName, LastName and Product.</p>

<p>I'm fairly new to SQL and it seems like a lot of the solutions I'm finding are over complicating things. I don't have to worry about NULLs.</p>

<p>I started by trying something like this:</p>

<pre><code>SELECT DISTINCT [First Name], [Last Name], [Product Name] FROM [Temp Test Data]
WHERE ([First Name] NOT IN (SELECT [First Name] 
FROM [Real Data]))
</code></pre>

<p>I'm having trouble taking this further though.</p>

<p>Thanks!</p>

<p>EDIT:</p>

<p>Based on the answer by @treaschf I have been trying to use a variation of the following query:</p>

<pre><code>SELECT td.[First Name], td.[Last Name], td.[Product Name]
FROM [Temp Test Data] td FULL OUTER JOIN [Data] AS d 
ON td.[First Name] = d.[First Name] AND td.[Last Name] = d.[Last Name] 
WHERE (d.[First Name] = NULL) AND (d.[Last Name] = NULL)
</code></pre>

<p>But I keep getting 0 results back, when I know that there is at least 1 row in td that is not in d.</p>

<p>EDIT:</p>

<p>Ok, I think I figured it out. At least in my few minutes of testing it seems to work good enough.</p>

<pre><code>SELECT [First Name], [Last Name]
FROM [Temp Test Data] AS td
WHERE (NOT EXISTS
        (SELECT [First Name], [Last Name]
         FROM [Data] AS d
         WHERE ([First Name] = td.[First Name]) OR ([Last Name] = td.[Last Name])))
</code></pre>

<p>This is basically going to tell me what is in my test data that is <em>not</em> in my real data. Which is completely fine for what I need to do.</p>
","<p>IF you have tables <code>A</code> and <code>B</code>, both with colum <code>C</code>, here are the records, which are present in table <code>A</code> but not in <code>B</code>:</p>

<pre><code>SELECT A.*
FROM A
    LEFT JOIN B ON (A.C = B.C)
WHERE B.C IS NULL
</code></pre>

<p>To get all the differences with a single query, a full join must be used, like this:</p>

<pre><code>SELECT A.*, B.*
FROM A
    FULL JOIN B ON (A.C = B.C)
WHERE A.C IS NULL OR B.C IS NULL
</code></pre>

<p>What you need to know in this case is, that when a record can be found in <code>A</code>, but not in <code>B</code>, than the columns which come from <code>B</code> will be NULL, and similarly for those, which are present in <code>B</code> and not in <code>A</code>, the columns from <code>A</code> will be null.</p>
","2077852"
"SQL Group By with an Order By","385216","","<p>I have a table of tags and want to get the highest count tags from the list.</p>

<p>Sample data looks like this</p>

<pre><code>id (1) tag ('night')
id (2) tag ('awesome')
id (3) tag ('night')
</code></pre>

<p>using</p>

<pre><code>SELECT COUNT(*), `Tag` from `images-tags`
GROUP BY `Tag`
</code></pre>

<p>gets me back the data I'm looking for perfectly. However, I would like to organize it, so that the highest tag counts are first, and limit it to only send me the first 20 or so.</p>

<p>I tried this...</p>

<pre><code>SELECT COUNT(id), `Tag` from `images-tags`
GROUP BY `Tag`
ORDER BY COUNT(id) DESC
LIMIT 20
</code></pre>

<p>and I keep getting an ""Invalid use of group function - ErrNr 1111""</p>

<p>What am I doing wrong?</p>

<p>I'm using MySQL 4.1.25-Debian</p>
","<p>In all versions of MySQL, simply alias the aggregate in the SELECT list, and order by the alias:</p>

<pre><code>SELECT COUNT(id) AS theCount, `Tag` from `images-tags`
GROUP BY `Tag`
ORDER BY theCount DESC
LIMIT 20
</code></pre>
","30503"
"Cast from VARCHAR to INT - MySQL","384942","","<p>My Current Data for</p>

<pre><code>SELECT PROD_CODE FROM `PRODUCT`
</code></pre>

<p>is</p>

<pre><code>PROD_CODE
2
5
7
8
22
10
9
11
</code></pre>

<p>I have tried all the four queries and none work. (<a href=""http://dev.mysql.com/doc/refman/5.5/en/cast-functions.html#function_cast"" rel=""noreferrer"">Ref</a>)</p>

<pre><code>SELECT CAST(PROD_CODE) AS INT FROM PRODUCT;

SELECT CAST(PROD_CODE AS INT) FROM PRODUCT;

SELECT CAST(PROD_CODE) AS INTEGER FROM PRODUCT;

SELECT CAST(PROD_CODE AS INTEGER) FROM PRODUCT;
</code></pre>

<p>All throw syntax errors such as below:</p>

<blockquote>
  <p>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use
  near ') AS INT FROM PRODUCT LIMIT 0, 30' at line 1</p>
  
  <p>You have an error in your SQL syntax; check the manual that
  corresponds to your MySQL server version for the right syntax to use
  near 'INTEGER) FROM PRODUCT LIMIT 0, 30' at line 1</p>
</blockquote>

<p>What is the right syntax to cast varchar to integer in MySQL?</p>

<p>MySQL Version: 5.5.16</p>
","<p>As described in <a href=""http://dev.mysql.com/doc/en/cast-functions.html#function_cast"" rel=""noreferrer"">Cast Functions and Operators</a>:</p>

<blockquote>
  <p>The type for the result can be one of the following values:</p>
  
  <ul>
  <li><code>BINARY[(N)]</code></li>
  <li><code>CHAR[(N)]</code></li>
  <li><code>DATE</code></li>
  <li><code>DATETIME</code></li>
  <li><code>DECIMAL[(M[,D])]</code></li>
  <li><code>SIGNED [INTEGER]</code></li>
  <li><code>TIME</code></li>
  <li><code>UNSIGNED [INTEGER]</code></li>
  </ul>
</blockquote>

<p>Therefore, you should use:</p>

<pre><code>SELECT CAST(PROD_CODE AS UNSIGNED) FROM PRODUCT
</code></pre>
","12127022"
"How to fetch the row count for all tables in a SQL SERVER database","384902","","<p>I am searching for a SQL Script that can be used to determine if there is any data (i.e. row count) in any of the tables of a given database. </p>

<p>The idea is to re-incarnate the database in case there are any rows existing (in any of the database).</p>

<p>The database being spoken of is Microsoft SQL SERVER.</p>

<p>Could someone suggest a sample script?</p>
","<p>The following SQL will get you the row count of all tables in a database:</p>

<pre><code>CREATE TABLE #counts
(
    table_name varchar(255),
    row_count int
)

EXEC sp_MSForEachTable @command1='INSERT #counts (table_name, row_count) SELECT ''?'', COUNT(*) FROM ?'
SELECT table_name, row_count FROM #counts ORDER BY table_name, row_count DESC
DROP TABLE #counts
</code></pre>

<p>The output will be a list of tables and their row counts.</p>

<p>If you just want the total row count across the whole database, appending:</p>

<pre><code>SELECT SUM(row_count) AS total_row_count FROM #counts
</code></pre>

<p>will get you a single value for the total number of rows in the whole database.</p>
","2221898"
"SQL Server Convert Varchar to Datetime","384830","","<p>I have this date format: 2011-09-28 18:01:00 (in varchar), and I want to convert it to datetime changing to this format 28-09-2011 18:01:00. How can I do it?</p>
","<pre><code>SELECT CONVERT(Datetime, '2011-09-28 18:01:00', 120) -- to convert it to Datetime

SELECT CONVERT( VARCHAR(30), @date ,105) -- italian format [28-09-2011 18:01:00]
+ ' ' + SELECT CONVERT( VARCHAR(30), @date ,108 ) -- full date [with time/minutes/sec]
</code></pre>
","10247221"
"How to Select a substring in Oracle SQL up to a specific character?","384381","","<p>Say I have a table column that has results like:</p>

<pre><code>ABC_blahblahblah
DEFGH_moreblahblahblah
IJKLMNOP_moremoremoremore
</code></pre>

<p>I would like to be able to write a query that selects this column from said table, but only returns the substring up to the Underscore (_) character. For example:</p>

<pre><code>ABC
DEFGH
IJKLMNOP
</code></pre>

<p>The SUBSTRING function doesn't seem to be up to the task because it is position-based and the position of the underscore varies.</p>

<p>I thought about the TRIM function (the RTRIM function specifically):</p>

<pre><code>SELECT RTRIM('listofchars' FROM somecolumn) 
FROM sometable
</code></pre>

<p>But I'm not sure how I'd get this to work since it only seems to remove a certain list/set of characters and I'm really only after the characters leading up to the Underscore character.</p>
","<p>Using a combination of SUBSTR, INSTR, and NVL (for strings without an underscore) will return what you want:</p>

<pre><code>SELECT NVL(SUBSTR('ABC_blah', 0, INSTR('ABC_blah', '_')-1), 'ABC_blah') AS output
  FROM DUAL
</code></pre>

<h2>Result:</h2>

<pre><code>output
------
ABC
</code></pre>

<h2>Use:</h2>

<pre><code>SELECT NVL(SUBSTR(t.column, 0, INSTR(t.column, '_')-1), t.column) AS output
  FROM YOUR_TABLE t
</code></pre>

<h2>Reference:</h2>

<ul>
<li><a href=""http://docs.oracle.com/database/121/SQLRF/functions196.htm#SQLRF06114"" rel=""noreferrer"">SUBSTR</a></li>
<li><a href=""http://docs.oracle.com/database/121/SQLRF/functions089.htm#SQLRF00651"" rel=""noreferrer"">INSTR</a></li>
</ul>

<h2>Addendum</h2>

<p>If using Oracle10g+, you can use regex via <a href=""http://docs.oracle.com/database/121/SQLRF/functions164.htm#SQLRF06303"" rel=""noreferrer"">REGEXP_SUBSTR</a>.</p>
","4389623"
"How do you return the column names of a table?","384055","","<p>How would I return the column names of a table using SQL Server 2008? i.e. a table contains these columns- id, name, address, country and I want to return these as data.</p>
","<p>Not sure if there is an easier way in 2008 version.</p>

<pre><code>USE [Database Name]
SELECT COLUMN_NAME,* 
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = 'YourTableName' AND TABLE_SCHEMA='YourSchemaName'
</code></pre>
","600457"
"How do I create a foreign key in SQL Server?","381161","","<p>I have never ""hand-coded"" object creation code for SQL Server and foreign key decleration is seemingly different between SQL Server and Postgres. Here is my sql so far:</p>

<pre><code>drop table exams;
drop table question_bank;
drop table anwser_bank;

create table exams
(
    exam_id uniqueidentifier primary key,
    exam_name varchar(50),
);
create table question_bank
(
    question_id uniqueidentifier primary key,
    question_exam_id uniqueidentifier not null,
    question_text varchar(1024) not null,
    question_point_value decimal,
    constraint question_exam_id foreign key references exams(exam_id)
);
create table anwser_bank
(
    anwser_id           uniqueidentifier primary key,
    anwser_question_id  uniqueidentifier,
    anwser_text         varchar(1024),
    anwser_is_correct   bit
);
</code></pre>

<p>When I run the query I get this error:</p>

<blockquote>
  <p>Msg 8139, Level 16, State 0, Line 9
  Number of referencing columns in
  foreign key differs from number of
  referenced columns, table
  'question_bank'.</p>
</blockquote>

<p>Can you spot the error?</p>
","<pre><code>create table question_bank
(
    question_id uniqueidentifier primary key,
    question_exam_id uniqueidentifier not null,
    question_text varchar(1024) not null,
    question_point_value decimal,
    constraint fk_questionbank_exams foreign key (question_exam_id) references exams (exam_id)
);
</code></pre>
","48778"
"SQL to find the number of distinct values in a column","380698","","<p>I can select all the distinct values in a column in the following ways:</p>

<ul>
<li><code>SELECT DISTINCT column_name FROM table_name;</code></li>
<li><code>SELECT column_name FROM table_name GROUP BY column_name;</code></li>
</ul>

<p>But how do I get the row count from that query? Is a subquery required?</p>
","<p>You can use the <code>DISTINCT</code> keyword within the <a href=""http://technet.microsoft.com/en-us/library/ms175997%28v=sql.90%29.aspx"" rel=""noreferrer""><code>COUNT</code></a> aggregate function:</p>

<pre><code>SELECT COUNT(DISTINCT column_name) AS some_alias FROM table_name
</code></pre>

<p>This will count only the distinct values for that column.</p>
","141574"
"Combining ""LIKE"" and ""IN"" for SQL Server","378888","","<p>Is it possible to combine <code>LIKE</code> and <code>IN</code> in a SQL Server-Query?</p>

<p>So, that this query</p>

<pre><code>SELECT * FROM table WHERE column LIKE IN ('Text%', 'Link%', 'Hello%', '%World%')
</code></pre>

<p>Finds any of these possible matches:</p>

<pre><code>Text, Textasd, Text hello, Link2, Linkomg, HelloWorld, ThatWorldBusiness
</code></pre>

<p>etc...</p>
","<p>Effectively, the IN statement creates a series of OR statements... so</p>

<pre><code>SELECT * FROM table WHERE column IN (1, 2, 3)
</code></pre>

<p>Is effectively</p>

<pre><code>SELECT * FROM table WHERE column = 1 OR column = 2 OR column = 3
</code></pre>

<p>And sadly, that is the route you'll have to take with your LIKE statements</p>

<pre><code>SELECT * FROM table
WHERE column LIKE 'Text%' OR column LIKE 'Hello%' OR column LIKE 'That%'
</code></pre>
","1865377"
"SQL - Select first 10 rows only?","377705","","<p>How do I select only the first 10 results of a query?</p>

<p>I would like to display only the first 10 results from the following query:</p>

<pre><code>SELECT a.names,
         COUNT(b.post_title) AS num
    FROM wp_celebnames a
    JOIN wp_posts b ON INSTR(b.post_title, a.names) &gt; 0
    WHERE b.post_date &gt; DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY a.names
ORDER BY num DESC
</code></pre>
","<p>In SQL server, use:</p>

<pre><code>select top 10 ...
</code></pre>

<p>e.g. </p>

<pre><code>select top 100 * from myTable
select top 100 colA, colB from myTable
</code></pre>

<p>In MySQL, use:</p>

<pre><code>select ... order by num desc limit 10
</code></pre>
","1891796"
"MYSQL - ORDER BY & LIMIT","376598","","<p>I have a query that looks like this:</p>

<p><code>SELECT article FROM table1 ORDER BY publish_date LIMIT 20</code></p>

<p>How does ORDER BY work? Will it order all records, then get the first 20, or will it get 20 records and order them by the <code>publish_date</code> field?</p>

<p>If it's the last one, you're not guaranteed to really get the most recent 20 articles.</p>
","<p>It will order first, then get the first 20.  A database will also process anything in the <code>WHERE</code> clause before <code>ORDER BY</code>.</p>
","4708714"
"Use '=' or LIKE to compare strings in SQL?","374312","","<p>There's the (almost religious) discussion, if you should use LIKE or '=' to compare strings in SQL statements.</p>

<ul>
<li>Are there reasons to use LIKE?</li>
<li>Are there reasons to use '='?</li>
<li>Performance? Readability? </li>
</ul>
","<p>To see the performance difference, try this:</p>

<pre><code>SELECT count(*)
FROM master..sysobjects as A
JOIN tempdb..sysobjects as B
on A.name = B.name

SELECT count(*)
FROM master..sysobjects as A
JOIN tempdb..sysobjects as B
on A.name LIKE B.name
</code></pre>

<p>Comparing strings with '=' is much faster.</p>
","515060"
"How can I join multiple SQL tables using the IDs?","372802","","<p>I have 4 different tables that I want to join. The tables are structured with columns as follows:</p>

<pre><code>TableA - aID | nameA | dID

TableB - bID | nameB | cID | aID

TableC - cID | nameC | date

TableD - dID | nameD
</code></pre>

<p>Starting with Table A, I understand how to JOIN tables a and c using b, since b has the Primary Keys for those tables. I want to be able to join table TableD on TableA as well. Below is my SQL statement that first joins tables A and B, then joins that to C:</p>

<pre><code>SELECT TableA.*, TableB.*, TableC.* FROM (TableB INNER JOIN TableA
ON TableB.aID= TableA.aID)
INNER JOIN TableC ON(TableB.cID= Tablec.cID)
WHERE (DATE(TableC.date)=date(now())) 
</code></pre>

<p>When I attempt to add another join, to include D, I get an error that 'TableD' is unknown:</p>

<pre><code> SELECT TableA.*, TableB.*, TableC.*, TableD.* FROM (TableB INNER JOIN TableA
    ON TableB.aID= TableA.aID)
    INNER JOIN TableC ON(TableB.cID= Tablec.cID)
    INNER JOIN TableA ta ON(ta.dID= TableD.dID)
    WHERE (DATE(TableC.date)=date(now())) 
</code></pre>
","<p>You want something more like this:</p>

<pre><code>SELECT TableA.*, TableB.*, TableC.*, TableD.*
FROM TableA
    JOIN TableB
        ON TableB.aID = TableA.aID
    JOIN TableC
        ON TableC.cID = TableB.cID
    JOIN TableD
        ON TableD.dID = TableA.dID
WHERE DATE(TableC.date)=date(now()) 
</code></pre>

<p>In your example, you are not actually including <code>TableD</code>. All you have to do is perform another join just like you have done before. </p>

<p>A note: you will notice that I removed many of your parentheses, as they really are not necessary in most of the cases you had them, and only add confusion when trying to read the code. Proper nesting is the best way to make your code readable and separated out. </p>
","9853636"
"MySQL: @variable vs. variable. What's the difference?","372512","","<p>In another question I posted someone told me that there is a difference between:</p>

<pre><code>@variable
</code></pre>

<p>and:</p>

<pre><code>variable
</code></pre>

<p>in MySQL. He also mentioned how MSSQL has batch scope and MySQL has session scope. Can someone elaborate on this for me?</p>
","<p><code>MySQL</code> has the concept of <em><a href=""http://dev.mysql.com/doc/refman/5.0/en/user-variables.html"" rel=""noreferrer"">user-defined variables</a></em>.</p>

<p>They are loosely typed variables that may be initialized somewhere in a session and keep their value until the session ends.</p>

<p>They are prepended with an <code>@</code> sign, like this: <code>@var</code></p>

<p>You can initialize this variable with a <code>SET</code> statement or inside in a query:</p>

<pre><code>SET @var = 1

SELECT @var2 := 2
</code></pre>

<p>When you develop a stored procedure in <code>MySQL</code>, you can pass the input parameters and declare the local variables:</p>

<pre><code>DELIMITER //

CREATE PROCEDURE prc_test (var INT)
BEGIN
    DECLARE  var2 INT;
    SET var2 = 1;
    SELECT  var2;
END;
//

DELIMITER ;
</code></pre>

<p>These variables are not prepended with any prefixes.</p>

<p>The difference between a procedure variable and a session-specific user-defined variable is that procedure variable is reinitialized to <code>NULL</code> each time the procedure is called, while the session-specific variable is not:</p>

<pre><code>CREATE PROCEDURE prc_test ()
BEGIN
    DECLARE var2 INT DEFAULT 1;
    SET var2 = var2 + 1;
    SET @var2 = @var2 + 1;
    SELECT  var2, @var2;
END;

SET @var2 = 1;

CALL prc_test();

var2  @var2
---   ---
2     2


CALL prc_test();

var2  @var2
---   ---
2     3


CALL prc_test();

var2  @var2
---   ---
2     4
</code></pre>

<p>As you can see, <code>var2</code> (procedure variable) is reinitialized each time the procedure is called, while <code>@var2</code> (session-specific variable) is not.</p>

<p>(In addition to user-defined variables, MySQL <em>also</em> has some predefined ""system variables"", which may be ""global variables"" such as <code>@@global.port</code> or ""session variables"" such as <code>@@session.sql_mode</code>; these ""session variables"" are unrelated to session-specific user-defined variables.)</p>
","1010042"
"Set database from SINGLE USER mode to MULTI USER","370599","","<p>I need help with setting a database that was restored in <code>SINGLE USER</code> mode to <code>MULTI USER</code>. Every time I run</p>

<pre><code>ALTER DATABASE BARDABARD
SET MULTI_USER;
GO
</code></pre>

<p>I get this error: </p>

<blockquote>
  <p>Changes to the state or options of database 'BARDABARD' cannot be made at this time. </p>
  
  <p>The database is in single-user mode, and a user is currently connected to it.</p>
</blockquote>

<p>It needs to be in non <code>SINGLE USER</code> mode to set it to another mode, but I can’t set the database in any another mode while it is <code>SINGLE USER</code> mode.</p>
","<p>The “user is currently connected to it” might be SQL Server Management Studio window itself. Try selecting the master database and running the <code>ALTER</code> query again.</p>
","14653003"
"Syntax of for-loop in SQL Server","370399","","<p>What is the syntax of a <code>for</code> loop in TSQL?</p>
","<p>T-SQL doesn't have a <code>FOR</code> loop, it has a <code>WHILE</code> loop<br/>
<a href=""https://docs.microsoft.com/en-us/sql/t-sql/language-elements/while-transact-sql"" rel=""noreferrer"">WHILE (Transact-SQL)</a></p>

<pre><code>WHILE Boolean_expression
BEGIN

END
</code></pre>
","6069036"
"Retrieving the last record in each group","369146","","<p>There is a table <code>messages</code> that contains data as shown below:</p>

<pre><code>Id   Name   Other_Columns
-------------------------
1    A       A_data_1
2    A       A_data_2
3    A       A_data_3
4    B       B_data_1
5    B       B_data_2
6    C       C_data_1
</code></pre>

<p>If I run a query <code>select * from messages group by name</code>, I will get the result as:</p>

<pre><code>1    A       A_data_1
4    B       B_data_1
6    C       C_data_1
</code></pre>

<p>What query will return the following result?</p>

<pre><code>3    A       A_data_3
5    B       B_data_2
6    C       C_data_1
</code></pre>

<p>That is, the last record in each group should be returned.</p>

<p>At present, this is the query that I use:</p>

<pre><code>select * from (select * from messages ORDER BY id DESC) AS x GROUP BY name
</code></pre>

<p>But this looks highly inefficient. Any other ways to achieve the same result?</p>
","<p>MySQL 8.0 now supports windowing functions, like almost all popular SQL implementations. With this standard syntax, we can write greatest-n-per-group queries:</p>

<pre><code>WITH ranked_messages AS (
  SELECT m.*, ROW_NUMBER() OVER (PARTITION BY name ORDER BY id DESC) AS rn
  FROM messages AS m
)
SELECT * FROM ranked_messages WHERE rn = 1;
</code></pre>

<p>Below is the original answer I wrote for this question in 2009:</p>

<hr>

<p>I write the solution this way:</p>

<pre><code>SELECT m1.*
FROM messages m1 LEFT JOIN messages m2
 ON (m1.name = m2.name AND m1.id &lt; m2.id)
WHERE m2.id IS NULL;
</code></pre>

<p>Regarding performance, one solution or the other can be better, depending on the nature of your data. So you should test both queries and use the one that is better at performance given your database.</p>

<p>For example, I have a copy of the <a href=""https://archive.org/details/stackexchange"" rel=""noreferrer"">StackOverflow August data dump</a>.  I'll use that for benchmarking.  There are 1,114,357 rows in the <code>Posts</code> table.  This is running on <a href=""https://www.mysql.com/"" rel=""noreferrer"">MySQL</a> 5.0.75 on my Macbook Pro 2.40GHz.</p>

<p>I'll write a query to find the most recent post for a given user ID (mine).</p>

<p><strong>First using the technique <a href=""https://stackoverflow.com/questions/1313120/sql-retrieving-the-last-record-in-each-group/1313140#1313140"">shown</a> by @Eric with the <code>GROUP BY</code> in a subquery:</strong></p>

<pre><code>SELECT p1.postid
FROM Posts p1
INNER JOIN (SELECT pi.owneruserid, MAX(pi.postid) AS maxpostid
            FROM Posts pi GROUP BY pi.owneruserid) p2
  ON (p1.postid = p2.maxpostid)
WHERE p1.owneruserid = 20860;

1 row in set (1 min 17.89 sec)
</code></pre>

<p>Even the <a href=""https://dev.mysql.com/doc/refman/5.7/en/using-explain.html"" rel=""noreferrer""><code>EXPLAIN</code> analysis</a> takes over 16 seconds:</p>

<pre><code>+----+-------------+------------+--------+----------------------------+-------------+---------+--------------+---------+-------------+
| id | select_type | table      | type   | possible_keys              | key         | key_len | ref          | rows    | Extra       |
+----+-------------+------------+--------+----------------------------+-------------+---------+--------------+---------+-------------+
|  1 | PRIMARY     | &lt;derived2&gt; | ALL    | NULL                       | NULL        | NULL    | NULL         |   76756 |             | 
|  1 | PRIMARY     | p1         | eq_ref | PRIMARY,PostId,OwnerUserId | PRIMARY     | 8       | p2.maxpostid |       1 | Using where | 
|  2 | DERIVED     | pi         | index  | NULL                       | OwnerUserId | 8       | NULL         | 1151268 | Using index | 
+----+-------------+------------+--------+----------------------------+-------------+---------+--------------+---------+-------------+
3 rows in set (16.09 sec)
</code></pre>

<p><strong>Now produce the same query result using <a href=""https://stackoverflow.com/questions/121387/fetch-the-row-which-has-the-max-value-for-a-column/123481#123481"">my technique</a> with <code>LEFT JOIN</code>:</strong></p>

<pre><code>SELECT p1.postid
FROM Posts p1 LEFT JOIN posts p2
  ON (p1.owneruserid = p2.owneruserid AND p1.postid &lt; p2.postid)
WHERE p2.postid IS NULL AND p1.owneruserid = 20860;

1 row in set (0.28 sec)
</code></pre>

<p>The <code>EXPLAIN</code> analysis shows that both tables are able to use their indexes:</p>

<pre><code>+----+-------------+-------+------+----------------------------+-------------+---------+-------+------+--------------------------------------+
| id | select_type | table | type | possible_keys              | key         | key_len | ref   | rows | Extra                                |
+----+-------------+-------+------+----------------------------+-------------+---------+-------+------+--------------------------------------+
|  1 | SIMPLE      | p1    | ref  | OwnerUserId                | OwnerUserId | 8       | const | 1384 | Using index                          | 
|  1 | SIMPLE      | p2    | ref  | PRIMARY,PostId,OwnerUserId | OwnerUserId | 8       | const | 1384 | Using where; Using index; Not exists | 
+----+-------------+-------+------+----------------------------+-------------+---------+-------+------+--------------------------------------+
2 rows in set (0.00 sec)
</code></pre>

<hr>

<p>Here's the DDL for my <code>Posts</code> table:</p>

<pre><code>CREATE TABLE `posts` (
  `PostId` bigint(20) unsigned NOT NULL auto_increment,
  `PostTypeId` bigint(20) unsigned NOT NULL,
  `AcceptedAnswerId` bigint(20) unsigned default NULL,
  `ParentId` bigint(20) unsigned default NULL,
  `CreationDate` datetime NOT NULL,
  `Score` int(11) NOT NULL default '0',
  `ViewCount` int(11) NOT NULL default '0',
  `Body` text NOT NULL,
  `OwnerUserId` bigint(20) unsigned NOT NULL,
  `OwnerDisplayName` varchar(40) default NULL,
  `LastEditorUserId` bigint(20) unsigned default NULL,
  `LastEditDate` datetime default NULL,
  `LastActivityDate` datetime default NULL,
  `Title` varchar(250) NOT NULL default '',
  `Tags` varchar(150) NOT NULL default '',
  `AnswerCount` int(11) NOT NULL default '0',
  `CommentCount` int(11) NOT NULL default '0',
  `FavoriteCount` int(11) NOT NULL default '0',
  `ClosedDate` datetime default NULL,
  PRIMARY KEY  (`PostId`),
  UNIQUE KEY `PostId` (`PostId`),
  KEY `PostTypeId` (`PostTypeId`),
  KEY `AcceptedAnswerId` (`AcceptedAnswerId`),
  KEY `OwnerUserId` (`OwnerUserId`),
  KEY `LastEditorUserId` (`LastEditorUserId`),
  KEY `ParentId` (`ParentId`),
  CONSTRAINT `posts_ibfk_1` FOREIGN KEY (`PostTypeId`) REFERENCES `posttypes` (`PostTypeId`)
) ENGINE=InnoDB;
</code></pre>
","1313293"
"What is a stored procedure?","368685","","<p>What is a stored procedure? How do they work? What is the make-up of a stored procedure (things each <em>must</em> have to be a stored procedure)?</p>
","<p>Stored procedures are a batch of SQL statements that can be executed in a couple of ways. Most major DBMs support stored procedures; however, not all do. You will need to verify with your particular DBMS help documentation for specifics. As I am most familiar with SQL Server I will use that as my samples. </p>

<p>To create a stored procedure the syntax is fairly simple:</p>

<pre><code>CREATE PROCEDURE &lt;owner&gt;.&lt;procedure name&gt;

     &lt;Param&gt; &lt;datatype&gt;

AS

     &lt;Body&gt;
</code></pre>

<p>So for example:</p>

<pre><code>CREATE PROCEDURE Users_GetUserInfo

    @login nvarchar(30)=null

AS

    SELECT * from [Users]
    WHERE ISNULL(@login,login)=login
</code></pre>

<p>A benefit of stored procedures is that you can centralize data access logic into a single place that is then easy for DBA's to optimize. Stored procedures also have a security benefit in that you can grant execute rights to a stored procedure but the user will not need to have read/write permissions on the underlying tables. This is a good first step against SQL injection.</p>

<p>Stored procedures do come with downsides, basically the maintenance associated with your basic <a href=""https://en.wikipedia.org/wiki/Create,_read,_update_and_delete"" rel=""noreferrer"">CRUD</a> operation. Let's say for each table you have an Insert, Update, Delete and at least one select based on the primary key, that means each table will have 4 procedures. Now take a decent size database of 400 tables, and you have 1600 procedures! And that's assuming you don't have duplicates which you probably will.</p>

<p>This is where using an <a href=""https://stackoverflow.com/questions/1279613/what-is-an-orm-and-where-can-i-learn-more-about-it"">ORM</a> or some other method to auto generate your basic CRUD operations has a ton of merit. </p>
","459531"
"How can I list ALL grants a user received?","367930","","<p>I need to see all grants on an Oracle DB.</p>

<p>I used the TOAD feature to compare schemas but it does not shows temptable grants etc. so there's my question:</p>

<p>How can I list all grants on a Oracle DB?</p>
","<p>If you want more than just direct table grants (e.g., grants via roles, system privileges such as select any table, etc.), here are some additional queries:</p>

<p>System privileges for a user:</p>

<pre><code>SELECT PRIVILEGE
  FROM sys.dba_sys_privs
 WHERE grantee = &lt;theUser&gt;
UNION
SELECT PRIVILEGE 
  FROM dba_role_privs rp JOIN role_sys_privs rsp ON (rp.granted_role = rsp.role)
 WHERE rp.grantee = &lt;theUser&gt;
 ORDER BY 1;
</code></pre>

<p>Direct grants to tables/views:</p>

<pre><code>SELECT owner, table_name, select_priv, insert_priv, delete_priv, update_priv, references_priv, alter_priv, index_priv 
  FROM table_privileges
 WHERE grantee = &lt;theUser&gt;
 ORDER BY owner, table_name;
</code></pre>

<p>Indirect grants to tables/views:</p>

<pre><code>SELECT DISTINCT owner, table_name, PRIVILEGE 
  FROM dba_role_privs rp JOIN role_tab_privs rtp ON (rp.granted_role = rtp.role)
 WHERE rp.grantee = &lt;theUser&gt;
 ORDER BY owner, table_name;
</code></pre>
","1301327"
"SQL Server FOR EACH Loop","367744","","<p>I have the following SQL query:</p>

<pre><code>DECLARE @MyVar datetime = '1/1/2010'    
SELECT @MyVar
</code></pre>

<p>This naturally returns '1/1/2010'.</p>

<p>What I want to do is have a list of dates, say:</p>

<pre><code>1/1/2010
2/1/2010
3/1/2010
4/1/2010
5/1/2010
</code></pre>

<p>Then i want to FOR EACH through the numbers and run the SQL Query.</p>

<p>Something like (pseudocode):</p>

<pre><code>List = 1/1/2010,2/1/2010,3/1/2010,4/1/2010,5/1/2010

For each x in List
do
  DECLARE @MyVar datetime = x

  SELECT @MyVar
</code></pre>

<p>So this would return:-</p>

<p>1/1/2010
    2/1/2010
    3/1/2010
    4/1/2010
    5/1/2010</p>

<p>I want this to return the data as one resultset, not multiple resultsets, so I may need to use some kind of union at the end of the query, so each iteration of the loop unions onto the next.</p>

<p><strong>edit</strong></p>

<p>I have a large query that accepts a 'to date' parameter, I need to run it 24 times, each time with a specific to date which I need to be able to supply (these dates are going to be dynamic) I want to avoid repeating my query 24 times with union alls joining them as if I need to come back and add additional columns it would be very time consuming.</p>
","<p>SQL is primarily a set-orientated language - it's generally a bad idea to use a loop in it.</p>

<p>In this case, a similar result could be achieved using a recursive CTE:</p>

<pre><code>with cte as
(select 1 i union all
 select i+1 i from cte where i &lt; 5)
select dateadd(d, i-1, '2010-01-01') from cte
</code></pre>
","10300538"
"How to temporarily disable a foreign key constraint in MySQL?","364951","","<p>Is it possible to temporarily disable constraints in MySQL?</p>

<p>I have two Django models, each with a ForeignKey to the other one. Deleting instances of a model returns an error because of the ForeignKey constraint:</p>

<pre><code>cursor.execute(""DELETE FROM myapp_item WHERE n = %s"", n)
transaction.commit_unless_managed()  #a foreign key constraint fails here

cursor.execute(""DELETE FROM myapp_style WHERE n = %s"", n)
transaction.commit_unless_managed()
</code></pre>

<p>Is it possible to temporarily disable constraints and delete anyway?</p>
","<p>Try <code>DISABLE KEYS</code> or    </p>

<pre><code>SET FOREIGN_KEY_CHECKS=0;
</code></pre>

<p>make sure to</p>

<pre><code>SET FOREIGN_KEY_CHECKS=1;
</code></pre>

<p>after.</p>
","15501754"
"MySQL select where column is not empty","364302","","<p>In MySQL, can I select columns only where something exists? </p>

<p>For example, I have the following query:</p>

<pre><code>select phone, phone2
from jewishyellow.users
where phone like '813%'
and phone2
</code></pre>

<p>I'm trying to select only the rows where phone starts with 813 and phone2 has something in it.</p>
","<p>Compare value of <code>phone2</code> with empty string:</p>

<pre><code>select phone, phone2 
from jewishyellow.users 
where phone like '813%' and phone2&lt;&gt;''
</code></pre>

<p>Note that <code>NULL</code> value is interpreted as <code>false</code>.</p>
","1869274"
"JOIN two SELECT statement results","362506","","<p>Is it possible to join the results of 2 sql SELECT statements in one statement?
I have a database of tasks where each record is a seperate task, with deadlines (and a PALT, which is just an INT of days from start to deadline.  Age is also an INT number of days.)</p>

<p>I want to have a table which has each person in the table, the number of tasks they have, and the number of LATE tasks they have (if any.)</p>

<p>I can get this data in seperate tables easily, like so:</p>

<pre><code>SELECT ks, COUNT(*) AS '# Tasks' FROM Table GROUP BY ks
</code></pre>

<p>returning data like:</p>

<pre><code>ks        # Tasks
person1   7
person2   3
</code></pre>

<p>and then I have</p>

<pre><code>SELECT ks, COUNT(*) AS '# Late' FROM Table WHERE Age &gt; Palt GROUP BY ks
</code></pre>

<p>which returns:</p>

<pre><code>ks        # Late
person1   1
person2   1
</code></pre>

<p>And I want to join the results of these two select statements (by the KS)</p>

<p>I'm trying to avoid using a temp table, but if that's the only practical way to do this, I'd like to know more about using temp tables in this fashion.</p>

<p>I also tried to do some kind of count() # of rows which satisfy a conditional, but I couldn't figure out how to do that either.  If it's possible, that would work too.</p>

<p>Addendum:
Sorry, I want my results to have columns for KS, Tasks, and Late</p>

<pre><code>KS        # Tasks   # Late
person1   7         1
person2   3         1
person3   2         0  (or null)
</code></pre>

<p>Additionally, I want a person to show up even if they have no late tasks.</p>

<p>SUM(CASE WHEN Age > Palt THEN 1 ELSE 0 END) Late
works well, thanks for this answer!</p>

<p>Two select statements also work, using a LEFT JOIN to join them also works, and I understand now how to join multiple selects in this fashion.  Thanks!</p>
","<pre><code>select t1.ks, t1.[# Tasks], coalesce(t2.[# Late], 0) as [# Late]
from 
    (SELECT ks, COUNT(*) AS '# Tasks' FROM Table GROUP BY ks) t1
left join
    (SELECT ks, COUNT(*) AS '# Late' FROM Table WHERE Age &gt; Palt GROUP BY ks) t2
on
    t1.ks = t2.ks
</code></pre>
","10538604"
"Set NOW() as Default Value for datetime datatype?","362227","","<p>I have two columns in table users namely <code>registerDate and lastVisitDate</code> which consist of datetime data type. I would like to do the following.</p>

<ol>
<li>Set registerDate defaults value to MySQL NOW()</li>
<li>Set lastVisitDate default value to <code>0000-00-00 00:00:00</code> Instead of null which it uses by default.</li>
</ol>

<p>Because the table already exists and has existing records, I would like to use Modify table.  I've tried using the two piece of code below, but neither works.  </p>

<pre><code>ALTER TABLE users MODIFY registerDate datetime DEFAULT NOW()
ALTER TABLE users MODIFY registerDate datetime DEFAULT CURRENT_TIMESTAMP;
</code></pre>

<p>It gives me Error : <code>ERROR 1067 (42000): Invalid default value for 'registerDate'</code></p>

<p>Is it possible for me to set the default datetime value to NOW() in MySQL?</p>
","<p>As of MySQL 5.6.5, you can use the <code>DATETIME</code> type with a dynamic default value:</p>

<pre><code>CREATE TABLE foo (
    creation_time      DATETIME DEFAULT   CURRENT_TIMESTAMP,
    modification_time  DATETIME ON UPDATE CURRENT_TIMESTAMP
)
</code></pre>

<p>Or even combine both rules:</p>

<pre><code>modification_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
</code></pre>

<p>Reference:<br>
<a href=""http://dev.mysql.com/doc/refman/5.7/en/timestamp-initialization.html"" rel=""noreferrer"">http://dev.mysql.com/doc/refman/5.7/en/timestamp-initialization.html</a><br>
<a href=""http://optimize-this.blogspot.com/2012/04/datetime-default-now-finally-available.html"" rel=""noreferrer"">http://optimize-this.blogspot.com/2012/04/datetime-default-now-finally-available.html</a></p>

<p>Prior to 5.6.5, you need to use the <code>TIMESTAMP</code> data type, which automatically updates whenever the record is modified. Unfortunately, however, only one auto-updated <code>TIMESTAMP</code> field can exist per table.</p>

<pre><code>CREATE TABLE mytable (
  mydate TIMESTAMP
)
</code></pre>

<p>See: <a href=""http://dev.mysql.com/doc/refman/5.1/en/create-table.html"" rel=""noreferrer"">http://dev.mysql.com/doc/refman/5.1/en/create-table.html</a></p>

<p>If you want to prevent MySQL from updating the timestamp value on <code>UPDATE</code> (so that it only triggers on <code>INSERT</code>) you can change the definition to:</p>

<pre><code>CREATE TABLE mytable (
  mydate TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
</code></pre>
","5818452"
"SQL Server SELECT into existing table","360335","","<p>I am trying to select some fields from one table and insert them into an existing table from a stored procedure. Here is what I am trying:</p>

<pre><code>SELECT col1, col2
INTO dbo.TableTwo 
FROM dbo.TableOne 
WHERE col3 LIKE @search_key
</code></pre>

<p>I think select into is for temporary tables which is why I get an error that <code>dbo.TableTwo</code> already exists.</p>

<p>How can I insert multiple rows from <code>dbo.TableOne</code> into <code>dbo.TableTwo</code>?</p>
","<p><code>SELECT ... INTO ...</code> only works if the table specified in the INTO clause does not exist - otherwise, you have to use:</p>

<pre><code>INSERT INTO dbo.TABLETWO
SELECT col1, col2
  FROM dbo.TABLEONE
 WHERE col3 LIKE @search_key
</code></pre>

<p>This assumes there's only two columns in dbo.TABLETWO - you need to specify the columns otherwise:</p>

<pre><code>INSERT INTO dbo.TABLETWO
  (col1, col2)
SELECT col1, col2
  FROM dbo.TABLEONE
 WHERE col3 LIKE @search_key
</code></pre>
","4101761"
"Get top 1 row of each group","358807","","<p>I have a table which I want to get the latest entry for each group. Here's the table:</p>

<p><code>DocumentStatusLogs</code> Table</p>

<pre><code>|ID| DocumentID | Status | DateCreated |
| 2| 1          | S1     | 7/29/2011   |
| 3| 1          | S2     | 7/30/2011   |
| 6| 1          | S1     | 8/02/2011   |
| 1| 2          | S1     | 7/28/2011   |
| 4| 2          | S2     | 7/30/2011   |
| 5| 2          | S3     | 8/01/2011   |
| 6| 3          | S1     | 8/02/2011   |
</code></pre>

<p>The table will be grouped by <code>DocumentID</code> and sorted by <code>DateCreated</code> in descending order. For each <code>DocumentID</code>, I want to get the latest status. </p>

<p>My preferred output:</p>

<pre><code>| DocumentID | Status | DateCreated |
| 1          | S1     | 8/02/2011   |
| 2          | S3     | 8/01/2011   |
| 3          | S1     | 8/02/2011   |
</code></pre>

<ul>
<li><p>Is there any aggregate function to get only the top from each group? See pseudo-code <code>GetOnlyTheTop</code> below:</p>

<pre><code>SELECT
  DocumentID,
  GetOnlyTheTop(Status),
  GetOnlyTheTop(DateCreated)
FROM DocumentStatusLogs
GROUP BY DocumentID
ORDER BY DateCreated DESC
</code></pre></li>
<li><p>If such function doesn't exist, is there any way I can achieve the output I want?</p></li>
<li>Or at the first place, could this be caused by unnormalized database? I'm thinking, since what I'm looking for is just one row, should that <code>status</code> also be located in the parent table?</li>
</ul>

<p>Please see the parent table for more information:</p>

<p>Current <code>Documents</code> Table</p>

<pre><code>| DocumentID | Title  | Content  | DateCreated |
| 1          | TitleA | ...      | ...         |
| 2          | TitleB | ...      | ...         |
| 3          | TitleC | ...      | ...         |
</code></pre>

<p>Should the parent table be like this so that I can easily access its status?</p>

<pre><code>| DocumentID | Title  | Content  | DateCreated | CurrentStatus |
| 1          | TitleA | ...      | ...         | s1            |
| 2          | TitleB | ...      | ...         | s3            |
| 3          | TitleC | ...      | ...         | s1            |
</code></pre>

<p><strong>UPDATE</strong>
I just learned how to use ""apply"" which makes it easier to address such problems.</p>
","<pre><code>;WITH cte AS
(
   SELECT *,
         ROW_NUMBER() OVER (PARTITION BY DocumentID ORDER BY DateCreated DESC) AS rn
   FROM DocumentStatusLogs
)
SELECT *
FROM cte
WHERE rn = 1
</code></pre>

<p>If you expect 2 entries per day, then this will arbitrarily pick one. To get both entries for a day, use DENSE_RANK instead</p>

<p>As for normalised or not, it depends if you want to:</p>

<ul>
<li>maintain status in 2 places</li>
<li>preserve status history</li>
<li>...</li>
</ul>

<p>As it stands, you preserve status history. If you want latest status in the parent table too (which is denormalisation) you'd need a trigger to maintain ""status"" in the parent. or drop this status history table.</p>
","6841644"
"Hibernate show real SQL","357963","","<p>if I set</p>

<pre><code>&lt;property name=""show_sql""&gt;true&lt;/property&gt;
</code></pre>

<p>in my <strong>hibernate.cfg.xml</strong> configuration file in the console I can see the SQL.</p>

<p>But it's not <em>real</em> SQL... Can I see the SQL code that will be passed directly to database?</p>

<p>Example:</p>

<p>I see </p>

<pre><code>select this_.code from true.employee this_ where this_.code=?
</code></pre>

<p>Can I see</p>

<pre><code>select employee.code from employee where employee.code=12
</code></pre>

<p>the <em>real</em> SQL?</p>
","<h2>log4j.properties</h2>

<pre><code>log4j.logger.org.hibernate=INFO, hb
log4j.logger.org.hibernate.SQL=DEBUG
log4j.logger.org.hibernate.type=TRACE
log4j.logger.org.hibernate.hql.ast.AST=info
log4j.logger.org.hibernate.tool.hbm2ddl=warn
log4j.logger.org.hibernate.hql=debug
log4j.logger.org.hibernate.cache=info
log4j.logger.org.hibernate.jdbc=debug

log4j.appender.hb=org.apache.log4j.ConsoleAppender
log4j.appender.hb.layout=org.apache.log4j.PatternLayout
log4j.appender.hb.layout.ConversionPattern=HibernateLog --&gt; %d{HH:mm:ss} %-5p %c - %m%n
log4j.appender.hb.Threshold=TRACE
</code></pre>

<h2>hibernate.cfg.xml</h2>

<pre><code>&lt;property name=""show_sql""&gt;true&lt;/property&gt;
&lt;property name=""format_sql""&gt;true&lt;/property&gt;
&lt;property name=""use_sql_comments""&gt;true&lt;/property&gt;
</code></pre>

<h2>persistence.xml</h2>

<p>Some frameworks use <code>persistence.xml</code>:</p>

<pre><code>&lt;property name=""hibernate.show_sql"" value=""true""/&gt;
&lt;property name=""hibernate.format_sql"" value=""true""/&gt;
&lt;property name=""hibernate.use_sql_comments"" value=""true""/&gt;
</code></pre>
","2538954"
"How to use GROUP BY to concatenate strings in SQL Server?","357109","","<p>How do I get:</p>

<pre><code>id       Name       Value
1          A          4
1          B          8
2          C          9
</code></pre>

<p>to</p>

<pre><code>id          Column
1          A:4, B:8
2          C:9
</code></pre>
","<p><strong>No CURSOR, WHILE loop, or User-Defined Function needed</strong>.  </p>

<p>Just need to be creative with FOR XML and PATH.</p>

<p>[Note: This solution only works on SQL 2005 and later. Original question didn't specify the version in use.]</p>

<pre><code>CREATE TABLE #YourTable ([ID] INT, [Name] CHAR(1), [Value] INT)

INSERT INTO #YourTable ([ID],[Name],[Value]) VALUES (1,'A',4)
INSERT INTO #YourTable ([ID],[Name],[Value]) VALUES (1,'B',8)
INSERT INTO #YourTable ([ID],[Name],[Value]) VALUES (2,'C',9)

SELECT 
  [ID],
  STUFF((
    SELECT ', ' + [Name] + ':' + CAST([Value] AS VARCHAR(MAX)) 
    FROM #YourTable 
    WHERE (ID = Results.ID) 
    FOR XML PATH(''),TYPE).value('(./text())[1]','VARCHAR(MAX)')
  ,1,2,'') AS NameValues
FROM #YourTable Results
GROUP BY ID

DROP TABLE #YourTable
</code></pre>
","273330"
"Replacing NULL with 0 in a SQL server query","356432","","<p>I have developed a query, and in the results for the first three columns I get <code>NULL</code>.  How can I replace it with <code>0</code>? </p>

<pre><code>  Select c.rundate, 
    sum(case when c.runstatus = 'Succeeded' then 1 end) as Succeeded, 
    sum(case when c.runstatus = 'Failed' then 1 end) as Failed, 
    sum(case when c.runstatus = 'Cancelled' then 1 end) as Cancelled, 
    count(*) as Totalrun from
    (    Select a.name,case when b.run_status=0 Then 'Failed' when b.run_status=1 Then 'Succeeded'
    when b.run_status=2 Then 'Retry' Else 'Cancelled' End as Runstatus,
    ---cast(run_date as datetime)
                cast(substring(convert(varchar(8),run_date),1,4)+'/'+substring(convert(varchar(8),run_date),5,2)+'/'          +substring(convert(varchar(8),run_date),7,2) as Datetime) as RunDate
    from msdb.dbo.sysjobs as a(nolock) inner join msdb.dbo.sysjobhistory as b(nolock) 
    on a.job_id=b.job_id
    where a.name='AI'
    and b.step_id=0) as c
    group by 
    c.rundate
</code></pre>
","<p>When you want to replace a possibly <code>null</code> column with something else, use <a href=""http://msdn.microsoft.com/en-us/library/ms184325.aspx"" rel=""noreferrer"">IsNull</a>.</p>

<pre><code>SELECT ISNULL(myColumn, 0 ) FROM myTable
</code></pre>

<p>This will put a 0 in myColumn if it is null in the first place.</p>
","16840585"
"How to check if a stored procedure exists before creating it","354837","","<p>I have a SQL script that has to be run every time a client executes the ""database management"" functionality. The script includes creating stored procedures on the client database.  Some of these clients might already have the stored procedure upon running the script, and some may not. I need to have the missing stored procedures added to the client database, but it doesn't matter how much I try to bend T-SQL syntax, I get</p>

<blockquote>
  <p><em>CREATE/ALTER PROCEDURE' must be the first statement in a query batch</em></p>
</blockquote>

<p>I've read that dropping before creating works, but I don't like doing it that way.</p>

<pre><code>IF EXISTS (SELECT * FROM sys.objects WHERE type = 'P' AND name = 'MyProc')
DROP PROCEDURE MyProc
GO

CREATE PROCEDURE MyProc
...
</code></pre>

<p>How can I add check for the existence of a stored procedure and create it if it doesn't exist but alter it if it does exist?</p>
","<p>You can run procedural code anywhere you are able to run a query.</p>

<p>Just copy everything after <code>AS</code>:</p>

<pre><code>BEGIN
    DECLARE @myvar INT
    SELECT  *
    FROM    mytable
    WHERE   @myvar ...
END
</code></pre>

<p>This code does exactly same things a stored proc would do, but is not stored on the database side.</p>

<p>That's much like what is called anonymous procedure in <code>PL/SQL</code>.</p>

<p><strong>Update:</strong></p>

<p>Your question title is a little bit confusing.</p>

<p>If you only need to create a procedure if it not exists, then your code is just fine.</p>

<p>Here's what <code>SSMS</code> outputs in the create script:</p>

<pre><code>IF EXISTS ( SELECT  *
            FROM    sys.objects
            WHERE   object_id = OBJECT_ID(N'myproc')
                    AND type IN ( N'P', N'PC' ) ) 
DROP …
CREATE …
</code></pre>

<p><strong>Update:</strong></p>

<p>Example of how to do it when including the schema:</p>

<pre><code>IF EXISTS ( SELECT * 
            FROM   sysobjects 
            WHERE  id = object_id(N'[dbo].[MyProc]') 
                   and OBJECTPROPERTY(id, N'IsProcedure') = 1 )
BEGIN
    DROP PROCEDURE [dbo].[MyProc]
END
</code></pre>

<p>In the example above, <em>dbo</em> is the schema.</p>
","2072174"
"Getting ""Lock wait timeout exceeded; try restarting transaction"" even though I'm not using a transaction","354818","","<p>I'm running the following MySQL <code>UPDATE</code> statement:</p>

<pre><code>mysql&gt; update customer set account_import_id = 1;
ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction
</code></pre>

<p>I'm not using a transaction, so why would I be getting this error? I even tried restarting my MySQL server and it didn't help.</p>

<p>The table has 406,733 rows.</p>
","<p>You are using a transaction; autocommit does not disable transactions, it just makes them automatically commit at the end of the statement.</p>

<p>What is happening is, some other thread is holding a record lock on some record (you're updating every record in the table!) for too long, and your thread is being timed out.</p>

<p>You can see more details of the event by issuing a </p>

<pre><code>SHOW ENGINE INNODB STATUS\G 
</code></pre>

<p>after the event. Ideally do this on a quiet test-machine.</p>
","5837308"
"SQL Server: How to Join to first row","353462","","<p>I'll use a concrete, but hypothetical, example.</p>

<p>Each <strong>Order</strong> normally has only one <strong>line item</strong>:</p>

<p><strong>Orders:</strong></p>

<pre><code>OrderGUID   OrderNumber
=========   ============
{FFB2...}   STL-7442-1      
{3EC6...}   MPT-9931-8A
</code></pre>

<p><strong>LineItems:</strong></p>

<pre><code>LineItemGUID   Order ID Quantity   Description
============   ======== ========   =================================
{098FBE3...}   1        7          prefabulated amulite
{1609B09...}   2        32         spurving bearing
</code></pre>

<p>But occasionally there will be an order with two line items:</p>

<pre><code>LineItemID   Order ID    Quantity   Description
==========   ========    ========   =================================
{A58A1...}   6,784,329   5          pentametric fan
{0E9BC...}   6,784,329   5          differential girdlespring 
</code></pre>

<p>Normally when showing the orders to the user:</p>

<pre><code>SELECT Orders.OrderNumber, LineItems.Quantity, LineItems.Description
FROM Orders
    INNER JOIN LineItems 
    ON Orders.OrderID = LineItems.OrderID
</code></pre>

<p>I want to show the single item on the order. But with this occasional order containing two (or more) items, the orders would <em>appear</em> be <strong>duplicated</strong>:</p>

<pre><code>OrderNumber   Quantity   Description
===========   ========   ====================
STL-7442-1    7          prefabulated amulite
MPT-9931-8A   32         differential girdlespring
KSG-0619-81   5          panametric fan
KSG-0619-81   5          differential girdlespring
</code></pre>

<p>What I really want is to have SQL Server <em>just pick one</em>, as it will be <em>good enough</em>:</p>

<pre><code>OrderNumber   Quantity   Description
===========   ========   ====================
STL-7442-1    7          prefabulated amulite
MPT-9931-8A   32         differential girdlespring
KSG-0619-81   5          panametric fan
</code></pre>

<p>If I get adventurous, I might show the user, an ellipsis to indicate that there's more than one:</p>

<pre><code>OrderNumber   Quantity   Description
===========   ========   ====================
STL-7442-1    7          prefabulated amulite
MPT-9931-8A   32         differential girdlespring
KSG-0619-81   5          panametric fan, ...
</code></pre>

<p>So the question is how to either</p>

<ul>
<li>eliminate ""duplicate"" rows</li>
<li>only join to one of the rows, to avoid duplication</li>
</ul>

<h2>First attempt</h2>

<p>My first naive attempt was to only join to the ""<strong>TOP 1</strong>"" line items:</p>

<pre><code>SELECT Orders.OrderNumber, LineItems.Quantity, LineItems.Description
FROM Orders
    INNER JOIN (
       SELECT TOP 1 LineItems.Quantity, LineItems.Description
       FROM LineItems
       WHERE LineItems.OrderID = Orders.OrderID) LineItems2
    ON 1=1
</code></pre>

<p>But that gives the error:</p>

<blockquote>
  <p>The column or prefix 'Orders' does not
  match with a table name or alias name
  used in the query.</p>
</blockquote>

<p>Presumably because the inner select doesn't see the outer table.</p>
","<pre><code>SELECT   Orders.OrderNumber, LineItems.Quantity, LineItems.Description
FROM     Orders
JOIN     LineItems
ON       LineItems.LineItemGUID =
         (
         SELECT  TOP 1 LineItemGUID 
         FROM    LineItems
         WHERE   OrderID = Orders.OrderID
         )
</code></pre>

<p>In <code>SQL Server 2005</code> and above, you could just replace <code>INNER JOIN</code> with <code>CROSS APPLY</code>:</p>

<pre><code>SELECT  Orders.OrderNumber, LineItems2.Quantity, LineItems2.Description
FROM    Orders
CROSS APPLY
        (
        SELECT  TOP 1 LineItems.Quantity, LineItems.Description
        FROM    LineItems
        WHERE   LineItems.OrderID = Orders.OrderID
        ) LineItems2
</code></pre>
","2043290"
"Delete all Duplicate Rows except for One in MySQL?","352839","","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""https://stackoverflow.com/questions/3311903/remove-duplicate-rows-in-mysql"">Remove duplicate rows in MySQL</a>  </p>
</blockquote>



<p>How would I delete all duplicate data from a MySQL Table?</p>

<p>For example, with the following data:</p>

<pre><code>SELECT * FROM names;
</code></pre>



<pre><code>+----+--------+
| id | name   |
+----+--------+
| 1  | google |
| 2  | yahoo  |
| 3  | msn    |
| 4  | google |
| 5  | google |
| 6  | yahoo  |
+----+--------+
</code></pre>

<p>I would use <code>SELECT DISTINCT name FROM names;</code> if it were a <code>SELECT</code> query. How would I do this with <code>DELETE</code> to only remove duplicates and keep just one record of each?</p>
","<p><strong>NB - You <em>need</em> to do this first on a <em>test copy</em> of your table!</strong></p>

<p><strong>When I did it, I found that unless I also included <code>AND n1.id &lt;&gt; n2.id</code>, it deleted every row in the table.</strong></p>

<p>1)  If you want to keep the row with the lowest <code>id</code> value:  </p>

<pre><code>DELETE n1 FROM names n1, names n2 WHERE n1.id &gt; n2.id AND n1.name = n2.name
</code></pre>

<p>2) If you want to keep the row with the highest <code>id</code> value:</p>

<pre><code>DELETE n1 FROM names n1, names n2 WHERE n1.id &lt; n2.id AND n1.name = n2.name
</code></pre>

<p>I used this method in MySQL 5.1</p>

<p>Not sure about other versions.  </p>

<p><strong>Update: Since people Googling for removing duplicates end up here</strong><br>
Although the OP's question is about DELETE, please be advised that using INSERT and DISTINCT is much faster. For a database with 8 million rows, the below query took 13 minutes, while using DELETE, it took more than 2 hours and yet didn't complete.  </p>

<pre><code>INSERT INTO tempTableName(cellId,attributeId,entityRowId,value)
    SELECT DISTINCT cellId,attributeId,entityRowId,value
    FROM tableName;
</code></pre>
","5016434"
"ROW_NUMBER() in MySQL","350983","","<p>Is there a nice way in MySQL to replicate the SQL Server function <code>ROW_NUMBER()</code>?</p>

<p>For example:</p>

<pre><code>SELECT 
    col1, col2, 
    ROW_NUMBER() OVER (PARTITION BY col1, col2 ORDER BY col3 DESC) AS intRow
FROM Table1
</code></pre>

<p>Then I could, for example, add a condition to limit <code>intRow</code> to 1 to get a single row with the highest <code>col3</code> for each <code>(col1, col2)</code> pair.</p>
","<blockquote>
  <p>I want the row with the single highest col3 for each (col1, col2) pair.</p>
</blockquote>

<p>That's a <a href=""https://stackoverflow.com/questions/755918/simple-query-to-grab-max-value-for-each-id"">groupwise maximum</a>, one of the most commonly-asked SQL questions (since it seems like it should be easy, but actually it kind of isn't).</p>

<p>I often plump for a null-self-join:</p>

<pre><code>SELECT t0.col3
FROM table AS t0
LEFT JOIN table AS t1 ON t0.col1=t1.col1 AND t0.col2=t1.col2 AND t1.col3&gt;t0.col3
WHERE t1.col1 IS NULL;
</code></pre>

<p>“Get the rows in the table for which no other row with matching col1,col2 has a higher col3.” (You will notice this and most other groupwise-maximum solutions will return multiple rows if more than one row has the same col1,col2,col3. If that's a problem you may need some post-processing.)</p>
","1895149"
"how do I query sql for a latest record date for each user","349988","","<p>I have a table that is a collection entries as to when a user was logged on.</p>

<pre><code>username, date,      value
--------------------------
brad,     1/2/2010,  1.1
fred,     1/3/2010,  1.0
bob,      8/4/2009,  1.5
brad,     2/2/2010,  1.2
fred,     12/2/2009, 1.3

etc..
</code></pre>

<p>How do I create a query that would give me the latest date for each user?</p>

<p><strong>Update:</strong> I forgot that I needed to have a value that goes along with the latest date.</p>
","<pre><code>select t.username, t.date, t.value
from MyTable t
inner join (
    select username, max(date) as MaxDate
    from MyTable
    group by username
) tm on t.username = tm.username and t.date = tm.MaxDate
</code></pre>
","2411703"
"How to set auto increment primary key in PostgreSQL?","349324","","<p>I have a table in PostgreSQL with 22 columns, and I want to add an auto increment primary key.</p>

<p>I tried to create a column called <code>id</code> of type BIGSERIAL but pgadmin responded with an error:</p>

<pre class=""lang-none prettyprint-override""><code>ERROR: sequence must have same owner as table it is linked to.
</code></pre>

<p>Does anyone know how to fix this issue?  How do I add a create an auto-incrementing primary key in PostgreSQL without recreating the table again?</p>
","<p>Try this command:</p>

<pre><code>ALTER TABLE your_table ADD COLUMN key_column BIGSERIAL PRIMARY KEY;
</code></pre>

<p>Try it with the same DB-user as the one you have <em>created</em> the table.</p>
","7718734"
"ORA-12560: TNS:protocol adaptor error","349200","","<p><img src=""https://i.stack.imgur.com/JLGWa.png"" alt=""enter image description here""></p>

<p>I Google[d] for this error <strong>ORA-12560: TNS:protocol adaptor error</strong> but not able to find the actual reason and how to solve this error ?</p>

<p>Can anyone tell me a perfect solution to solve login problem.</p>
","<ol>
<li>Go to the windows machine that hosts the Oracle database server </li>
<li>Go to Start -> Run -> Services.msc in windows.  Locate OracleService
(here OracleServiceORCL) and click on ""Start"" to start the oracle database service (if not already running)</li>
<li><p>Once it is up and running, from the command prompt run the following: </p>

<p>tnsping &lt; tnsalias > </p></li>
</ol>

<p>(tnsalias entry you can find it in tnsnames.ora file)</p>

<p><img src=""https://i.stack.imgur.com/AEjdq.png"" alt=""Services""></p>
","6904462"
"INSERT statement conflicted with the FOREIGN KEY constraint","348727","","<p>I am getting the following error. Could you please help me?</p>

<blockquote>
  <p>Msg 547, Level 16, State 0, Line 1<br>
  The INSERT statement conflicted with the FOREIGN KEY constraint ""FK_Sup_Item_Sup_Item_Cat"". The conflict occurred in database ""dev_bo"", table ""dbo.Sup_Item_Cat"". The statement has been terminated.</p>
</blockquote>

<p>Code:</p>

<pre><code>insert into sup_item (supplier_id, sup_item_id, name, sup_item_cat_id, 
                      status_code, last_modified_user_id, last_modified_timestamp, client_id)   
values (10162425, 10, 'jaiso', '123123',
        'a', '12', '2010-12-12', '1062425')
</code></pre>

<p>The last column <code>client_id</code> is causing the error. I tried to put the value which already exists in the <code>dbo.Sup_Item_Cat</code> into the column, corresponding to the sup_item.. but no joy :-(</p>
","<p>In your table <code>dbo.Sup_Item_Cat</code>, it has a foreign key reference to another table. The way a FK works is it cannot have a value in that column that is not also in the primary key column of the referenced table.</p>

<p>If you have SQL Server Management Studio, open it up and <code>sp_help</code> '<code>dbo.Sup_Item_Cat</code>'. See which column that FK is on, and which column of which table it references. You're inserting some bad data.</p>

<p>Let me know if you need anything explained better!</p>
","2965877"
"MySQL combine two columns into one column","348478","","<p>I'm trying to find a way to combine two columns into one, but keep getting the value '0' in the column instead to the combination of the words.</p>

<p>These are what I've tried as well as others:</p>

<pre><code>SELECT column1 + column2 AS column3
FROM table;

SELECT column1 || column2 AS column3
FROM table;

SELECT column1 + ' ' + column2 AS column3
FROM table;
</code></pre>

<p>Could someone please let me know what I'm doing wrong?</p>
","<p>My guess is that you are using MySQL where the <code>+</code> operator does addition, along with silent conversion of the values to numbers.  If a value does not start with a digit, then the converted value is <code>0</code>.</p>

<p>So try this:</p>

<pre><code>select concat(column1, column2)
</code></pre>

<p>Two ways to add a space:</p>

<pre><code>select concat(column1, ' ', column2)
select concat_ws(' ', column1, column2)
</code></pre>
","22739860"
"How to show all privileges from a user in oracle?","348178","","<p>Can someone please tell me how to show all privileges/rules from a specific user in the sql-console?</p>
","<p>You can try these below views.</p>

<pre><code>SELECT * FROM USER_SYS_PRIVS; 
SELECT * FROM USER_TAB_PRIVS;
SELECT * FROM USER_ROLE_PRIVS;
</code></pre>

<p>DBAs and other power users can find the privileges granted to other users with the <code>DBA_</code> versions of these same views.  They are covered in the <a href=""http://docs.oracle.com/cd/E11882_01/server.112/e40402/statviews_5041.htm#REFRN23274"" rel=""noreferrer"">documentation</a> .</p>

<p>Those views only show the privileges granted <em>directly</em> to the user.  Finding <em>all</em> the privileges, including those granted indirectly through roles, requires more complicated recursive SQL statements:</p>

<pre><code>select * from dba_role_privs connect by prior granted_role = grantee start with grantee = '&amp;USER' order by 1,2,3;
select * from dba_sys_privs  where grantee = '&amp;USER' or grantee in (select granted_role from dba_role_privs connect by prior granted_role = grantee start with grantee = '&amp;USER') order by 1,2,3;
select * from dba_tab_privs  where grantee = '&amp;USER' or grantee in (select granted_role from dba_role_privs connect by prior granted_role = grantee start with grantee = '&amp;USER') order by 1,2,3,4;
</code></pre>
","9811709"
"MySQL select 10 random rows from 600K rows fast","347205","","<p>How can I best write a query that selects 10 rows randomly from a total of 600k?</p>
","<p>A great post handling several cases, from simple, to gaps, to non-uniform with gaps.</p>

<p><a href=""http://jan.kneschke.de/projects/mysql/order-by-rand/"" rel=""noreferrer"">http://jan.kneschke.de/projects/mysql/order-by-rand/</a></p>

<p>For most general case, here is how you do it:</p>

<pre><code>SELECT name
  FROM random AS r1 JOIN
       (SELECT CEIL(RAND() *
                     (SELECT MAX(id)
                        FROM random)) AS id)
        AS r2
 WHERE r1.id &gt;= r2.id
 ORDER BY r1.id ASC
 LIMIT 1
</code></pre>

<p>This supposes that the distribution of ids is equal, and that there can be gaps in the id list. See the article for more advanced examples</p>
","4329447"
"How do I get the size of a java.sql.ResultSet?","345955","","<p>Shouldn't this be a pretty straightforward operation? However, I see there's neither a <code>size()</code> nor <code>length()</code> method.</p>
","<p><code>resultSet.last()</code> followed by <code>resultSet.getRow()</code> will give you the row count, but it may not be a good idea as it can mean reading the entire table over the network and throwing away the data.  Do a <code>SELECT COUNT(*) FROM ...</code> query instead.</p>
","192104"
"Simple way to transpose columns and rows in Sql?","344852","","<p>How do I simply switch columns with rows in SQL?
Is there any simple command to transpose?</p>

<p>ie turn this result:</p>

<pre><code>        Paul  | John  | Tim  |  Eric
Red     1       5       1       3
Green   8       4       3       5
Blue    2       2       9       1
</code></pre>

<p>into this:</p>

<pre><code>        Red  | Green | Blue
Paul    1       8       2
John    5       4       2
Tim     1       3       9
Eric    3       5       1
</code></pre>

<p><code>PIVOT</code> seems too complex for this scenario.</p>
","<p>There are several ways that you can transform this data. In your original post, you stated that <code>PIVOT</code> seems too complex for this scenario, but it can be applied very easily using both the <a href=""http://msdn.microsoft.com/en-us/library/ms177410%28v=sql.105%29.aspx?ppud=4"" rel=""noreferrer""><code>UNPIVOT</code> and <code>PIVOT</code></a> functions in SQL Server. </p>

<p>However, if you do not have access to those functions this can be replicated using <code>UNION ALL</code> to <code>UNPIVOT</code> and then an aggregate function with a <code>CASE</code> statement to <code>PIVOT</code>:</p>

<p><strong>Create Table:</strong></p>

<pre><code>CREATE TABLE yourTable([color] varchar(5), [Paul] int, [John] int, [Tim] int, [Eric] int);

INSERT INTO yourTable
    ([color], [Paul], [John], [Tim], [Eric])
VALUES
    ('Red', 1, 5, 1, 3),
    ('Green', 8, 4, 3, 5),
    ('Blue', 2, 2, 9, 1);
</code></pre>

<p><strong>Union All, Aggregate and CASE Version:</strong></p>

<pre><code>select name,
  sum(case when color = 'Red' then value else 0 end) Red,
  sum(case when color = 'Green' then value else 0 end) Green,
  sum(case when color = 'Blue' then value else 0 end) Blue
from
(
  select color, Paul value, 'Paul' name
  from yourTable
  union all
  select color, John value, 'John' name
  from yourTable
  union all
  select color, Tim value, 'Tim' name
  from yourTable
  union all
  select color, Eric value, 'Eric' name
  from yourTable
) src
group by name
</code></pre>

<p>See <a href=""http://sqlfiddle.com/#!3/9a05d/1"" rel=""noreferrer"">SQL Fiddle with Demo</a></p>

<p>The <code>UNION ALL</code> performs the <code>UNPIVOT</code> of the data by transforming the columns <code>Paul, John, Tim, Eric</code> into separate rows. Then you apply the aggregate function <code>sum()</code> with the <code>case</code> statement to get the new columns for each <code>color</code>.</p>

<p><strong>Unpivot and Pivot Static Version:</strong></p>

<p>Both the <code>UNPIVOT</code> and <code>PIVOT</code> functions in SQL server make this transformation much easier.  If you know all of the values that you want to transform, you can hard-code them into a static version to get the result:</p>

<pre><code>select name, [Red], [Green], [Blue]
from
(
  select color, name, value
  from yourtable
  unpivot
  (
    value for name in (Paul, John, Tim, Eric)
  ) unpiv
) src
pivot
(
  sum(value)
  for color in ([Red], [Green], [Blue])
) piv
</code></pre>

<p>See <a href=""http://sqlfiddle.com/#!3/09920/4"" rel=""noreferrer"">SQL Fiddle with Demo</a></p>

<p>The inner query with the <code>UNPIVOT</code> performs the same function as the <code>UNION ALL</code>. It takes the list of columns and turns it into rows, the <code>PIVOT</code> then performs the final transformation into columns.</p>

<p><strong>Dynamic Pivot Version:</strong></p>

<p>If you have an unknown number of columns (<code>Paul, John, Tim, Eric</code> in your example) and then an unknown number of colors to transform you can use dynamic sql to generate the list to <code>UNPIVOT</code> and then <code>PIVOT</code>:</p>

<pre><code>DECLARE @colsUnpivot AS NVARCHAR(MAX),
    @query  AS NVARCHAR(MAX),
    @colsPivot as  NVARCHAR(MAX)

select @colsUnpivot = stuff((select ','+quotename(C.name)
         from sys.columns as C
         where C.object_id = object_id('yourtable') and
               C.name &lt;&gt; 'color'
         for xml path('')), 1, 1, '')

select @colsPivot = STUFF((SELECT  ',' 
                      + quotename(color)
                    from yourtable t
            FOR XML PATH(''), TYPE
            ).value('.', 'NVARCHAR(MAX)') 
        ,1,1,'')


set @query 
  = 'select name, '+@colsPivot+'
      from
      (
        select color, name, value
        from yourtable
        unpivot
        (
          value for name in ('+@colsUnpivot+')
        ) unpiv
      ) src
      pivot
      (
        sum(value)
        for color in ('+@colsPivot+')
      ) piv'

exec(@query)
</code></pre>

<p>See <a href=""http://sqlfiddle.com/#!3/09920/5"" rel=""noreferrer"">SQL Fiddle with Demo</a></p>

<p>The dynamic version queries both <code>yourtable</code> and then the <code>sys.columns</code> table to generate the list of items to <code>UNPIVOT</code> and <code>PIVOT</code>.  This is then added to a query string to be executed. The plus of the dynamic version is if you have a changing list of <code>colors</code> and/or <code>names</code> this will generate the list at run-time.</p>

<p>All three queries will produce the same result:</p>

<pre><code>| NAME | RED | GREEN | BLUE |
-----------------------------
| Eric |   3 |     5 |    1 |
| John |   5 |     4 |    2 |
| Paul |   1 |     8 |    2 |
|  Tim |   1 |     3 |    9 |
</code></pre>
","13377114"
"Best way to do multi-row insert in Oracle?","343608","","<p>I'm looking for a good way to perform multi-row inserts into an Oracle 9 database.  The following works in MySQL but doesn't seem to be supported in Oracle.</p>

<pre><code>INSERT INTO TMP_DIM_EXCH_RT 
(EXCH_WH_KEY, 
 EXCH_NAT_KEY, 
 EXCH_DATE, EXCH_RATE, 
 FROM_CURCY_CD, 
 TO_CURCY_CD, 
 EXCH_EFF_DATE, 
 EXCH_EFF_END_DATE, 
 EXCH_LAST_UPDATED_DATE) 
VALUES
    (1, 1, '28-AUG-2008', 109.49, 'USD', 'JPY', '28-AUG-2008', '28-AUG-2008', '28-AUG-2008'),
    (2, 1, '28-AUG-2008', .54, 'USD', 'GBP', '28-AUG-2008', '28-AUG-2008', '28-AUG-2008'),
    (3, 1, '28-AUG-2008', 1.05, 'USD', 'CAD', '28-AUG-2008', '28-AUG-2008', '28-AUG-2008'),
    (4, 1, '28-AUG-2008', .68, 'USD', 'EUR', '28-AUG-2008', '28-AUG-2008', '28-AUG-2008'),
    (5, 1, '28-AUG-2008', 1.16, 'USD', 'AUD', '28-AUG-2008', '28-AUG-2008', '28-AUG-2008'),
    (6, 1, '28-AUG-2008', 7.81, 'USD', 'HKD', '28-AUG-2008', '28-AUG-2008', '28-AUG-2008');
</code></pre>
","<p>This works in Oracle:</p>

<pre><code>insert into pager (PAG_ID,PAG_PARENT,PAG_NAME,PAG_ACTIVE)
          select 8000,0,'Multi 8000',1 from dual
union all select 8001,0,'Multi 8001',1 from dual
</code></pre>

<p>The thing to remember here is to use the <code>from dual</code> statement.</p>

<p>(<a href=""http://forums.devshed.com/oracle-development-96/how-can-i-do-multirow-insert-in-oracle-406709.html"" rel=""noreferrer"">source</a>)</p>
","39602"
"Oracle: If Table Exists","341969","","<p>I'm writing some migration scripts for an Oracle database, and was hoping Oracle had something similar to MySQL's <code>IF EXISTS</code> construct.</p>

<p>Specifically, whenever I want to drop a table in MySQL, I do something like</p>

<pre><code>DROP TABLE IF EXISTS `table_name`;
</code></pre>

<p>This way, if the table doesn't exist, the <code>DROP</code> doesn't produce an error, and the script can continue.</p>

<p>Does Oracle have a similar mechanism?  I realize I could use the following query to check if a table exists or not</p>

<pre><code>SELECT * FROM dba_tables where table_name = 'table_name';
</code></pre>

<p>but the syntax for tying that together with a <code>DROP</code> is escaping me.</p>
","<p>The best and most efficient way is to catch the ""table not found"" exception: this avoids the overhead of checking if the table exists twice; and doesn't suffer from the problem that if the DROP fails for some other reason (that might be important) the exception is still raised to the caller:</p>

<pre><code>BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE mytable';
EXCEPTION
   WHEN OTHERS THEN
      IF SQLCODE != -942 THEN
         RAISE;
      END IF;
END;
</code></pre>

<p><strong>ADDENDUM</strong>
For reference, here are the equivalent blocks for other object types:</p>

<p>Sequence</p>

<pre><code>BEGIN
  EXECUTE IMMEDIATE 'DROP SEQUENCE ' || sequence_name;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -2289 THEN
      RAISE;
    END IF;
END;
</code></pre>

<p>View</p>

<pre><code>BEGIN
  EXECUTE IMMEDIATE 'DROP VIEW ' || view_name;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -942 THEN
      RAISE;
    END IF;
END;
</code></pre>

<p>Trigger</p>

<pre><code>BEGIN
  EXECUTE IMMEDIATE 'DROP TRIGGER ' || trigger_name;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -4080 THEN
      RAISE;
    END IF;
END;
</code></pre>

<p>Index</p>

<pre><code>BEGIN
  EXECUTE IMMEDIATE 'DROP INDEX ' || index_name;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -1418 THEN
      RAISE;
    END IF;
END;
</code></pre>

<p>Column</p>

<pre><code>BEGIN
  EXECUTE IMMEDIATE 'ALTER TABLE ' || table_name
                || ' DROP COLUMN ' || column_name;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -904 THEN
      RAISE;
    END IF;
END;
</code></pre>

<p>Database Link</p>

<pre><code>BEGIN
  EXECUTE IMMEDIATE 'DROP DATABASE LINK ' || dblink_name;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -2024 THEN
      RAISE;
    END IF;
END;
</code></pre>

<p>Materialized View</p>

<pre><code>BEGIN
  EXECUTE IMMEDIATE 'DROP MATERIALIZED VIEW ' || mview_name;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -12003 THEN
      RAISE;
    END IF;
END;
</code></pre>

<p>Type</p>

<pre><code>BEGIN
  EXECUTE IMMEDIATE 'DROP TYPE ' || type_name;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -4043 THEN
      RAISE;
    END IF;
END;
</code></pre>

<p>Constraint</p>

<pre><code>BEGIN
  EXECUTE IMMEDIATE 'ALTER TABLE ' || table_name
            || ' DROP CONSTRAINT ' || constraint_name;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -2443 THEN
      RAISE;
    END IF;
END;
</code></pre>

<p>Scheduler Job</p>

<pre><code>BEGIN
  DBMS_SCHEDULER.drop_job(job_name);
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -27475 THEN
      RAISE;
    END IF;
END;
</code></pre>

<p>User / Schema</p>

<pre><code>BEGIN
  EXECUTE IMMEDIATE 'DROP USER ' || user_name;
  /* you may or may not want to add CASCADE */
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -1918 THEN
      RAISE;
    END IF;
END;
</code></pre>

<p>Package</p>

<pre><code>BEGIN
  EXECUTE IMMEDIATE 'DROP PACKAGE ' || package_name;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -4043 THEN
      RAISE;
    END IF;
END;
</code></pre>

<p>Procedure</p>

<pre><code>BEGIN
  EXECUTE IMMEDIATE 'DROP PROCEDURE ' || procedure_name;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -4043 THEN
      RAISE;
    END IF;
END;
</code></pre>

<p>Function</p>

<pre><code>BEGIN
  EXECUTE IMMEDIATE 'DROP FUNCTION ' || function_name;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -4043 THEN
      RAISE;
    END IF;
END;
</code></pre>

<p>Tablespace</p>

<pre><code>BEGIN
  EXECUTE IMMEDIATE 'DROP TABLESPACE' || tablespace_name;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -959 THEN
      RAISE;
    END IF;
END;
</code></pre>
","1801453"
"How do I rename a column in a database table using SQL?","341156","","<p>If I wish to simply rename a column (not change its type or constraints, just its name) in an SQL database using SQL, how do I do that?  Or is it not possible?</p>

<p>This is for any database claiming to support SQL, I'm simply looking for an SQL-specific query that will work regardless of actual database implementation.</p>
","<p>On PostgreSQL (and many other RDBMS), you can do it with regular <code>ALTER TABLE</code> statement:</p>

<pre><code>essais=&gt; SELECT * FROM Test1;
 id | foo | bar 
----+-----+-----
  2 |   1 |   2

essais=&gt; ALTER TABLE Test1 RENAME COLUMN foo TO baz;
ALTER TABLE

essais=&gt; SELECT * FROM Test1;
 id | baz | bar 
----+-----+-----
  2 |   1 |   2
</code></pre>
","174632"
"SQL MAX of multiple columns?","339033","","<p>How do you return 1 value per row of the max of several columns:</p>

<p><strong>TableName</strong></p>

<pre><code>[Number, Date1, Date2, Date3, Cost]
</code></pre>

<p>I need to return something like this:</p>

<pre><code>[Number, Most_Recent_Date, Cost]
</code></pre>

<p>Query?</p>
","<p>Well, you can use the CASE statement:</p>

<pre><code>SELECT
    CASE
        WHEN Date1 &gt;= Date2 AND Date1 &gt;= Date3 THEN Date1
        WHEN Date2 &gt;= Date1 AND Date2 &gt;= Date3 THEN Date2
        WHEN Date3 &gt;= Date1 AND Date3 &gt;= Date2 THEN Date3
        ELSE                                        Date1
    END AS MostRecentDate
</code></pre>

<p>[For Microsoft SQL Server <strong>2008</strong> and above, you may consider Sven's simpler answer below.]</p>
","71045"
"Datetime equal or greater than today in MySQL","337869","","<p>What's the best way to do following:</p>

<pre><code>SELECT * FROM users WHERE created &gt;= today;
</code></pre>

<p>Note: created is a datetime field.</p>
","<pre><code>SELECT * FROM users WHERE created &gt;= CURDATE();
</code></pre>

<p>But I think you mean <code>created &lt; today</code> </p>
","5182309"
"Convert text into number in MySQL query","337146","","<p>Is it possible to convert text into number within MySQL query? I have a column with an identifier that consists a name and a number in the format of ""name-number"". The column has VARCHAR type. I want to sort the rows according the number (rows with the same name) but the column is sorted according do character order, i.e.</p>

<pre><code>name-1
name-11
name-12
name-2
</code></pre>

<p>If I cut of the number, can I convert the 'varchar' number into the 'real' number and use it to sort the rows? I would like to obtained following order.</p>

<pre><code>name-1
name-2
name-11
name-12
</code></pre>

<p>I cannot represent the number as a separate column.</p>

<p><strong>edited 2011-05-11 9:32</strong></p>

<p>I have found following solution <code>... ORDER BY column * 1</code>. If the name will not contain any numbers is it save to use that solution?</p>
","<p>This should work:</p>

<pre><code>SELECT field,CONVERT(SUBSTRING_INDEX(field,'-',-1),UNSIGNED INTEGER) AS num
FROM table
ORDER BY num;
</code></pre>
","5960705"
"DateTime2 vs DateTime in SQL Server","337040","","<p>Which one: </p>

<ul>
<li><a href=""https://msdn.microsoft.com/en-us/library/ms187819.aspx"" rel=""noreferrer""><code>datetime</code></a></li>
<li><a href=""https://msdn.microsoft.com/en-us/library/bb677335.aspx"" rel=""noreferrer""><code>datetime2</code></a></li>
</ul>

<p>is <em>the</em> recommended way to store date and time in SQL Server 2008+?</p>

<p>I'm aware of differences in precision (and storage space probably), but ignoring those for now, is there a best practice document on when to use what, or maybe we should just use <code>datetime2</code> only?</p>
","<p>The MSDN documentation for <a href=""http://technet.microsoft.com/en-us/library/ms187819.aspx"" rel=""noreferrer"">datetime</a> recommends using <a href=""http://technet.microsoft.com/en-us/library/bb677335.aspx"" rel=""noreferrer"">datetime2</a>. Here is their recommendation:</p>

<blockquote>
  <p>Use the time, date, datetime2 and
  datetimeoffset data types for new
  work. These types align with the SQL
  Standard. They are more portable.
  time, datetime2 and datetimeoffset
  provide more seconds precision.
  datetimeoffset provides time zone
  support for globally deployed
  applications.</p>
</blockquote>

<p>datetime2 has larger date range, a larger default fractional precision, and optional user-specified precision. Also depending on the user-specified precision it may use less storage. </p>
","1884088"
"How to check the maximum number of allowed connections to an Oracle database?","336639","","<p>What's the best way, using SQL, to check the maximum number of connections that is allowed for an Oracle database? In the end, I would like to show the current number of sessions and the total number allowed, e.g. ""Currently, 23 out of 80 connections are used"".</p>
","<p>There are a few different limits that might come in to play in determining the number of connections an Oracle database supports.  The simplest approach would be to use the SESSIONS parameter and V$SESSION, i.e.</p>

<p>The number of sessions the database was configured to allow</p>

<pre><code>SELECT name, value 
  FROM v$parameter
 WHERE name = 'sessions'
</code></pre>

<p>The number of sessions currently active</p>

<pre><code>SELECT COUNT(*)
  FROM v$session
</code></pre>

<p>As I said, though, there are other potential limits both at the database level and at the operating system level and depending on whether shared server has been configured.  If shared server is ignored, you may well hit the limit of the PROCESSES parameter before you hit the limit of the SESSIONS parameter.  And you may hit operating system limits because each session requires a certain amount of RAM.</p>
","162381"
"What is the difference between SQL, PL-SQL and T-SQL?","336036","","<p>What is the difference between SQL, PL-SQL and T-SQL?</p>

<p>Can anyone explain what the differences between these three are, and provide scenarios where each would be relevantly used?</p>
","<ul>
<li><p><code>SQL</code> is a query language to operate on sets.</p>

<p>It is more or less standardized, and used by almost all relational database management systems: SQL Server, Oracle, MySQL, PostgreSQL, DB2, Informix, etc.</p></li>
<li><p><code>PL/SQL</code> is a proprietary procedural language used by Oracle</p></li>
<li><p><code>PL/pgSQL</code> is a procedural language used by PostgreSQL</p></li>
<li><p><code>TSQL</code> is a proprietary procedural language used by Microsoft in SQL Server.</p></li>
</ul>

<p>Procedural languages are designed to extend SQL's abilities while being able to integrate well with SQL. Several features such as local variables and string/data processing are added. These features make the language Turing-complete.</p>

<p>They are also used to write stored procedures: pieces of code residing on the server to manage complex business rules that are hard or impossible to manage with pure set-based operations.</p>
","1043290"
"Fastest way to count exact number of rows in a very large table?","335078","","<p>I have come across articles that state that <code>SELECT COUNT(*) FROM TABLE_NAME</code> will be slow when the table has lots of rows and lots of columns.</p>

<p>I have a table that might contain even billions of rows [it has approximately 15 columns]. Is there a better way to get the <strong>EXACT</strong> count of the number of rows of a table?</p>

<p>Please consider the following before your answer:</p>

<ul>
<li><p>I am looking for a database vendor
independent solution. It is OK if it
covers <strong>MySQL</strong>, <strong>Oracle</strong>, <strong>MS SQL Server</strong>.
But if there is <strong>really</strong> no database
vendor independent solution then I
will settle for different solutions
for different database vendors.</p></li>
<li><p>I cannot use any other external tool
to do this. I am mainly looking for a
SQL based solution.</p></li>
<li><p>I cannot normalize my database design
any further. It is already in 3NF and moreover a 
lot of code has already been written
around it.</p></li>
</ul>
","<p>Simple answer:</p>

<ul>
<li>database vendor independent solution = use the standard = <code>COUNT(*)</code></li>
<li>there are <em>approximate</em> SQL Server solutions but don't use COUNT(*) = out of scope</li>
</ul>

<p>Notes:</p>

<p><a href=""https://stackoverflow.com/questions/1221559/count-vs-count1/1221649#1221649"">COUNT(1) = COUNT(*) = COUNT(PrimaryKey)</a> just in case</p>

<p>Edit:</p>

<p>SQL Server example (1.4 billion rows, 12 columns)</p>

<pre><code>SELECT COUNT(*) FROM MyBigtable WITH (NOLOCK)
-- NOLOCK here is for me only to let me test for this answer: no more, no less
</code></pre>

<p>1 runs, 5:46 minutes, count = 1,401,659,700</p>

<pre><code>--Note, sp_spaceused uses this DMV
SELECT
   Total_Rows= SUM(st.row_count)
FROM
   sys.dm_db_partition_stats st
WHERE
    object_name(object_id) = 'MyBigtable' AND (index_id &lt; 2)
</code></pre>

<p>2 runs, both under 1 second, count = 1,401,659,670</p>

<p>The second one has less rows = wrong. Would be the same or more depending on writes (deletes are done out of hours here) </p>
","6069288"
"Insert all values of a table into another table in SQL","334699","","<p>I am trying to insert all values of one table into another. But the insert statement accepts values, but i would like it to accept a select * from the initial_Table. Is this possible?</p>
","<p>The insert statement actually has a syntax for doing just that. It's a lot easier if you specify the column names rather than selecting ""*"" though:</p>

<pre><code>INSERT INTO new_table (Foo, Bar, Fizz, Buzz)
SELECT Foo, Bar, Fizz, Buzz
FROM initial_table
-- optionally WHERE ...
</code></pre>

<p>I'd better clarify this because for some reason this post is getting a few down-votes.</p>

<p>The INSERT INTO ... SELECT FROM syntax is for when the table you're inserting into (""new_table"" in my example above) already exists. As others have said, the SELECT ... INTO syntax is for when you want to create the new table as part of the command.</p>

<p>You didn't specify whether the new table needs to be created as part of the command, so INSERT INTO ... SELECT FROM should be fine if your destination table already exists.</p>
","576442"
"Oracle query to fetch column names","334321","","<p>I have a mySQL query to get columns from a table like this:</p>

<pre><code>String sqlStr=""select column_name 
from information_schema.COLUMNS 
where table_name='users' 
and table_schema='""+_db+""' 
and column_name not in ('password','version','id')""
</code></pre>

<p>How do I change the above query in Oracle 11g database? I need to get columns names as a resultset for table 'users' excluding certain columns, specifying a schema. Right now I have all tables in my new tablespace, so do I specify tablespace name in place of schema name?</p>

<p>Also is there a generic HQL for this? In my new Oracle database (I am new to Oracle), I only have tablespace name, so is that equivalent to schema name (logically?)</p>
","<p>The Oracle equivalent for <code>information_schema.COLUMNS</code> is <code>USER_TAB_COLS</code> for tables owned by the current user, <code>ALL_TAB_COLS</code> or <code>DBA_TAB_COLS</code> for tables owned by all users.</p>

<p>Tablespace is not equivalent to a schema, neither do you have to provide the tablespace name.</p>

<p>Providing the schema/username would be of use if you want to query <code>ALL_TAB_COLS</code> or <code>DBA_TAB_COLS</code> for columns OF tables owned by a specific user. in your case, I'd imagine the query would look something like:</p>

<pre><code>String sqlStr= ""
SELECT column_name
FROM   all_tab_cols
WHERE  table_name = 'users'
       AND owner = ' || +_db+ || '
       AND column_name NOT IN ( 'password', 'version', 'id' ) 
""
</code></pre>

<p>Note that with this approach, you risk SQL injection.</p>
","8739400"
"Can you have if-then-else logic in SQL?","333542","","<p>I need to do select data from a table based on some kind of priority like so:</p>

<pre><code>select product, price from table1 where project = 1

-- pseudo: if no price found, do this:
select product, price from table1 where customer = 2

-- pseudo: if still no price found, do this:
select product, price from table1 where company = 3
</code></pre>

<p>That is, if I found 3 products with prices based on <code>project = X</code>, I don't want to select on <code>customer = Y</code>. I just want to return the resulting 3 rows and be done.</p>

<p>How are you supposed to do stuff like this in SQL? Use some kind of CASE-statement for the pseudo-if's? Do a union or some other smart thing?</p>

<p>Edit: I'm using MS SQL.</p>

<p>Thanks!</p>
","<p>You can make the following sql query</p>

<pre><code>IF ((SELECT COUNT(*) FROM table1 WHERE project = 1) &gt; 0) 
    SELECT product, price FROM table1 WHERE project = 1
ELSE IF ((SELECT COUNT(*) FROM table1 WHERE project = 2) &gt; 0) 
    SELECT product, price FROM table1 WHERE project = 2
ELSE IF ((SELECT COUNT(*) FROM table1 WHERE project = 3) &gt; 0)
    SELECT product, price FROM table1 WHERE project = 3
</code></pre>
","15086050"
"Simple DateTime sql query","332691","","<p>How do I query DateTime database field within a certain range?</p>

<p>I am using SQL SERVER 2005</p>

<p>Error code below</p>

<pre><code>SELECT * 
  FROM TABLENAME 
 WHERE DateTime &gt;= 12/04/2011 12:00:00 AM 
   AND DateTime &lt;= 25/05/2011 3:53:04 AM
</code></pre>

<p>Note that I need to get rows within a certain time range.  Example, 10 mins time range.</p>

<p>Currently SQL return with Incorrect syntax near '12'.""</p>
","<p>You missed single quote sign:</p>

<pre><code>SELECT * 
FROM TABLENAME 
WHERE DateTime &gt;= '12/04/2011 12:00:00 AM' AND DateTime &lt;= '25/05/2011 3:53:04 AM'
</code></pre>

<p>Also, it is recommended to use ISO8601 format YYYY-MM-DDThh:mm:ss.nnn[ Z ], as this one will not depend on your server's local culture.</p>

<pre><code>SELECT *
FROM TABLENAME 
WHERE 
    DateTime &gt;= '2011-04-12T00:00:00.000' AND 
    DateTime &lt;= '2011-05-25T03:53:04.000'
</code></pre>
","6119388"
"Using If else in SQL Select statement","331519","","<p>I have a select statement which will return 2 columns.</p>

<pre><code>ID | IDParent
</code></pre>

<p>Then in my program I have to test <code>if IDParent is &lt; 1 then use ID ELSE use IDParent</code></p>

<p>Is there a way to use an If Else like condition in SQL to return only single value?</p>
","<p>you can use <code>CASE</code></p>

<pre><code>SELECT   ...,
         CASE WHEN IDParent &lt; 1 THEN ID ELSE IDPArent END AS ColumnName,
         ...
FROM     tableName
</code></pre>
","13526616"
"SQL UPDATE SET one column to be equal to a value in a related table referenced by a different column?","331436","","<p>I hope that made sense, let me elaborate:</p>

<p>There is a table of tracking data for a quiz program where each row has..</p>

<p>QuestionID and AnswerID (there is a table for each). So because of a bug there were a bunch of QuestionIDs set to NULL, but the QuestionID of a related AnswerID is in the Answers table.</p>

<p>So say QuestionID is NULL and AnswerID is 500, if we go to the Answers table and find AnswerID 500 there is a column with the QuestionID that should have been where the NULL value is.</p>

<p>So basically I want to set each NULL QuestionID to be equal to the QuestionID found in the Answers table on the Answer row of the AnswerID that is in the trackings table (same row as the NULL QuestionID that is being written).</p>

<p>How would I do this?</p>

<pre><code>UPDATE QuestionTrackings
SET QuestionID = (need some select query that will get the QuestionID from the AnswerID in this row)
WHERE QuestionID is NULL AND ... ?
</code></pre>

<p>Not sure how I will be able to make it assign the QuestionID to the QuestionID from the matching AnswerID...</p>
","<pre><code>update q
set q.QuestionID = a.QuestionID
from QuestionTrackings q
inner join QuestionAnswers a
on q.AnswerID = a.AnswerID
where q.QuestionID is null -- and other conditions you might want
</code></pre>

<p>I recommend to check what the result set to update is before running the update (same query, just with a select):</p>

<pre><code>select *
from QuestionTrackings q
inner join QuestionAnswers a
on q.AnswerID = a.AnswerID
where q.QuestionID is null -- and other conditions you might want
</code></pre>

<p>Particularly whether each answer id has definitely only 1 associated question id.</p>
","707383"
"What is SELF JOIN and when would you use it?","330418","","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""https://stackoverflow.com/questions/2458519/sql-self-joins-explained"">sql: self-joins explained</a>  </p>
</blockquote>



<p>What is self join and when would you use it? I don't understand self joins so a layman explanation with an example would be great.</p>
","<p>You use a self join when a table references data in itself.</p>

<p>E.g., an <code>Employee</code> table may have a <code>SupervisorID</code> column that points to the employee that is the boss of the current employee.</p>

<p>To query the data and get information for both people in one row, you could self join like this:</p>

<pre><code>select e1.EmployeeID, 
    e1.FirstName, 
    e1.LastName,
    e1.SupervisorID, 
    e2.FirstName as SupervisorFirstName, 
    e2.LastName as SupervisorLastName
from Employee e1
left outer join Employee e2 on e1.SupervisorID = e2.EmployeeID
</code></pre>
","3362053"
"What is an index in SQL?","328890","","<p>What is an <em>index</em> in SQL? Can you explain or reference to understand clearly? </p>

<p>Where should I use an index?</p>
","<p>An index is used to speed up searching in the database. MySQL have some good documentation on the subject (which is relevant for other SQL servers as well):
<a href=""http://dev.mysql.com/doc/refman/5.0/en/mysql-indexes.html"" rel=""noreferrer"">http://dev.mysql.com/doc/refman/5.0/en/mysql-indexes.html</a></p>

<p>An index can be used to efficiently find all row matching some column in your query and then walk through only that subset of the table to find exact matches. If you don't have indexes on any column in the <code>WHERE</code> clause, the <code>SQL</code> server have to walk through <em>the whole table</em> and check every row to see if it matches, which may be a slow operation on big tables.</p>

<p>The index can also be a <code>UNIQUE</code> index, which means that you cannot have duplicate values in that column, or a <code>PRIMARY KEY</code> which in some storage engines defines where in the database file the value is stored.</p>

<p>In MySQL you can use <code>EXPLAIN</code> in front of your <code>SELECT</code> statement to see if your query will make use of any index. This is a good start for troubleshooting performance problems. Read more here:
<a href=""http://dev.mysql.com/doc/refman/5.0/en/explain.html"" rel=""noreferrer"">http://dev.mysql.com/doc/refman/5.0/en/explain.html</a></p>
","2955470"
"How to request a random row in SQL?","327063","","<p>How can I request a random row (or as close to truly random as is possible) in pure SQL?</p>
","<p>See this post: <a href=""http://www.petefreitag.com/item/466.cfm"" rel=""noreferrer"">SQL to Select a random row from a database table</a>. It goes through methods for doing this in MySQL, PostgreSQL, Microsoft SQL Server, IBM DB2 and Oracle (the following is copied from that link):</p>

<p>Select a random row with MySQL:</p>

<pre><code>SELECT column FROM table
ORDER BY RAND()
LIMIT 1
</code></pre>

<p>Select a random row with PostgreSQL:</p>

<pre><code>SELECT column FROM table
ORDER BY RANDOM()
LIMIT 1
</code></pre>

<p>Select a random row with Microsoft SQL Server:</p>

<pre><code>SELECT TOP 1 column FROM table
ORDER BY NEWID()
</code></pre>

<p>Select a random row with IBM DB2</p>

<pre><code>SELECT column, RAND() as IDX 
FROM table 
ORDER BY IDX FETCH FIRST 1 ROWS ONLY
</code></pre>

<p>Select a random record with Oracle:</p>

<pre><code>SELECT column FROM
( SELECT column FROM table
ORDER BY dbms_random.value )
WHERE rownum = 1
</code></pre>
","19419"
"SQL query for finding records where count > 1","326958","","<p>I have a table named <code>PAYMENT</code>. Within this table I have a user ID, an account number, a ZIP code and a date. I would like to find all records for all users that have more than one payment per day with the same account number. </p>

<p><strong>UPDATE:</strong> Additionally, there should be a filter than only counts the records whose ZIP code is different.</p>

<p>This is how the table looks like:</p>

<pre>| user_id | account_no | zip   |      date |
|       1 |        123 | 55555 | 12-DEC-09 | 
|       1 |        123 | 66666 | 12-DEC-09 |
|       1 |        123 | 55555 | 13-DEC-09 |
|       2 |        456 | 77777 | 14-DEC-09 |
|       2 |        456 | 77777 | 14-DEC-09 |
|       2 |        789 | 77777 | 14-DEC-09 |
|       2 |        789 | 77777 | 14-DEC-09 |
</pre> 

<p>The result should look similar to this:</p>

<pre>| user_id | count |
|       1 |     2 |
</pre> 

<p>How would you express this in a SQL query? I was thinking self join but for some reason my count is wrong.</p>
","<p>Use the <a href=""http://www.w3schools.com/sql/sql_having.asp"">HAVING</a> clause and GROUP By the fields that make the row unique</p>

<p>The below will find </p>

<blockquote>
  <p>all users that have more than one payment per day with the same account number</p>
</blockquote>

<pre><code>SELECT 
 user_id ,
 COUNT(*) count
FROM 
 PAYMENT
GROUP BY
 account,
 user_id ,
 date
Having
COUNT(*) &gt; 1
</code></pre>

<p><strong>Update</strong>
If you want to only include those that have a distinct ZIP you can get a distinct set first and then perform you HAVING/GROUP BY</p>

<pre><code> SELECT 
    user_id,
    account_no , 
    date,
        COUNT(*)
 FROM
    (SELECT DISTINCT
            user_id,
            account_no , 
            zip, 
            date
         FROM
            payment 

        ) 
        payment
 GROUP BY

    user_id,
    account_no , 

    date
HAVING COUNT(*) &gt; 1
</code></pre>
","7151428"
"Is there a Max function in SQL Server that takes two values like Math.Max in .NET?","325019","","<p>I want to write a query like this:</p>

<pre><code>SELECT o.OrderId, MAX(o.NegotiatedPrice, o.SuggestedPrice)
FROM Order o
</code></pre>

<p>But this isn't how the <code>MAX</code> function works, right?  It is an aggregate function so it expects a single parameter and then returns the MAX of all rows.   </p>

<p>Does anyone know how to do it my way?</p>
","<p>You'd need to make a <code>User-Defined Function</code> if you wanted to have syntax similar to your example, but could you do what you want to do, inline, fairly easily with a <code>CASE</code> statement, as the others have said.</p>

<p>The <code>UDF</code> could be something like this:</p>

<pre><code>create function dbo.InlineMax(@val1 int, @val2 int)
returns int
as
begin
  if @val1 &gt; @val2
    return @val1
  return isnull(@val2,@val1)
end
</code></pre>

<p>... and you would call it like so ...</p>

<pre><code>SELECT o.OrderId, dbo.InlineMax(o.NegotiatedPrice, o.SuggestedPrice) 
FROM Order o
</code></pre>
","124474"
"How to SUM two fields within an SQL query","323187","","<p>I need to get the total of two fields which are within the same row and input that number in a field at the end of that same row.</p>

<p>This is my code. </p>

<pre><code>Sum(tbl1.fld1 + tbl1.fld2) AS [Total]
</code></pre>

<p>Is this what the SUM function is used for, or can you only use the SUM function for getting the total of a column?</p>

<p>Thanks</p>
","<p><code>SUM</code> is an aggregate function. It will calculate the total for each group. <code>+</code> is used for calculating two or more columns in a row.</p>

<p>Consider this example,</p>

<pre><code>ID  VALUE1  VALUE2
===================
1   1       2
1   2       2
2   3       4
2   4       5
</code></pre>

<p>&nbsp;</p>

<pre><code>SELECT  ID, SUM(VALUE1), SUM(VALUE2)
FROM    tableName
GROUP   BY ID
</code></pre>

<p>will result</p>

<pre><code>ID, SUM(VALUE1), SUM(VALUE2)
1   3           4
2   7           9
</code></pre>

<p>&nbsp;</p>

<pre><code>SELECT  ID, VALUE1 + VALUE2
FROM    TableName
</code></pre>

<p>will result</p>

<pre><code>ID, VALUE1 + VALUE2
1   3
1   4
2   7
2   9
</code></pre>

<p>&nbsp;</p>

<pre><code>SELECT  ID, SUM(VALUE1 + VALUE2)
FROM    tableName
GROUP   BY ID
</code></pre>

<p>will result</p>

<pre><code>ID, SUM(VALUE1 + VALUE2)
1   7
2   16
</code></pre>
","14877850"
"SQL Server - Return value after INSERT","320839","","<p>I'm trying to get a the key-value back after an INSERT-statement. 
Example: 
I've got a table with the attributes name and id. id is a generated value.</p>

<pre><code>    INSERT INTO table (name) VALUES('bob');
</code></pre>

<p>Now I want to get the id back in the same step. How is this done?</p>

<p>We're using Microsoft SQL Server 2008.</p>
","<p>No need for a separate SELECT...</p>

<pre><code>INSERT INTO table (name)
OUTPUT Inserted.ID
VALUES('bob');
</code></pre>

<p>This works for non-IDENTITY columns (such as GUIDs) too</p>
","7917874"
"Create a date with T-SQL","319566","","<p>I am trying to convert a date with individual parts such as 12, 1, 2007 into a datetime in SQL Server 2005. I have tried the following:</p>

<pre><code>CAST(DATEPART(year, DATE)+'-'+ DATEPART(month, DATE) +'-'+ DATEPART(day, DATE) AS DATETIME)
</code></pre>

<p>but this results in the wrong date. What is the correct way to turn the three date values into a proper datetime format.</p>
","<p>Assuming <code>y, m, d</code> are all <code>int</code>, how about:</p>

<pre><code>CAST(CAST(y AS varchar) + '-' + CAST(m AS varchar) + '-' + CAST(d AS varchar) AS DATETIME)
</code></pre>

<p>Please see <a href=""https://stackoverflow.com/a/10142966/18255"">my other answer</a> for SQL Server 2012 and above</p>
","266940"
"Oracle: how to UPSERT (update or insert into a table?)","318680","","<p>The UPSERT operation either updates or inserts a row in a table, depending if the table already has a row that matches the data:</p>

<pre><code>if table t has a row exists that has key X:
    update t set mystuff... where mykey=X
else
    insert into t mystuff...
</code></pre>

<p>Since Oracle doesn't have a specific UPSERT statement, what's the best way to do this?</p>
","<p>The <a href=""http://docs.oracle.com/cd/B28359_01/server.111/b28286/statements_9016.htm#SQLRF01606"" rel=""noreferrer"">MERGE statement</a>  merges data between two tables.  Using DUAL
allows us to use this command.</p>

<pre><code>create or replace
procedure ups(xa number)
as
begin
    merge into mergetest m using dual on (a = xa)
         when not matched then insert (a,b) values (xa,1)
             when matched then update set b = b+1;
end ups;
/
drop table mergetest;
create table mergetest(a number, b number);
call ups(10);
call ups(10);
call ups(20);
select * from mergetest;

A                      B
---------------------- ----------------------
10                     2
20                     1
</code></pre>
","237328"
"MySQL - insert current date/time?","317997","","<p>Is there a value or command like DATETIME that I can use in a manual query to insert the current date and time? </p>

<pre><code>INSERT INTO servers (
  server_name, online_status, exchange, disk_space, network_shares
) VALUES(
  'm1', 'ONLINE', 'ONLINE', '100GB', 'ONLINE' 'DATETIME' 
)
</code></pre>

<p>The quoted DATETIME value at the end is where I want to add the current date and time.</p>
","<p>You can use <code>NOW()</code>:</p>

<pre><code>INSERT INTO servers (server_name, online_status, exchange, disk_space, network_shares)
VALUES('m1', 'ONLINE', 'exchange', 'disk_space', 'network_shares', NOW())
</code></pre>
","19246330"
"Query comparing dates in SQL","317541","","<p>I have a table with  dates that all happened in the month November.
I wrote this query </p>

<pre><code>select id,numbers_from,created_date,amount_numbers,SMS_text 
from Test_Table
where 
created_date &lt;= '2013-04-12'
</code></pre>

<p>This query should return everything that happened in month 11 (November) because it happened <strong>before</strong> the date '2013-04-12' (in December)</p>

<p>But it's only returning available dates that happened in days lesser than 04 (2013-<strong>04</strong>-12)</p>

<p>Could it be that it's only comparing the day part? and not the whole date?</p>

<p>How to fix this?</p>

<p>Created_date is of type <strong>date</strong></p>

<p>Date format is by default <strong>yyyy-dd-MM</strong></p>
","<p>Instead of '2013-04-12' whose meaning depends on the local culture, use '20130412' which is recognized as the culture invariant format.</p>

<p>If you want to compare with December 4<sup>th</sup>, you should write '20131204'. If you want to compare with April 12<sup>th</sup>, you should write '20130412'.</p>

<p>The article <a href=""http://technet.microsoft.com/en-us/library/ms191307.aspx"" rel=""noreferrer"">Write International Transact-SQL Statements</a> from SQL Server's documentation explains how to write statements that are culture invariant:</p>

<blockquote>
  <p>Applications that use other APIs, or Transact-SQL scripts, stored procedures, and triggers, should use the unseparated numeric strings. For example, yyyymmdd as 19980924.</p>
</blockquote>

<p><strong>EDIT</strong></p>

<p>Since you are using ADO, the best option is to parameterize the query and pass the date value as a date parameter. This way you avoid the format issue entirely and gain the performance benefits of parameterized queries as well.</p>

<p><strong>UPDATE</strong></p>

<p>To use the the the ISO 8601 format in a literal, all elements must be specified. To quote <a href=""https://msdn.microsoft.com/en-us/library/ms187819.aspx"" rel=""noreferrer"">from the ISO 8601 section of datetime's documentation</a></p>

<blockquote>
  <p>To use the ISO 8601 format, you must specify each element in the format. This also includes the T, the colons (:), and the period (.) that are shown in the format.</p>
  
  <p>... the fraction of second component is optional. The time component is specified in the 24-hour format.</p>
</blockquote>
","19924274"
"Select SQL Server database size","317433","","<p>how can i query my sql server to only get the size of database? </p>

<p>I used this : </p>

<pre><code>use ""MY_DB""
exec sp_spaceused
</code></pre>

<p>I got this :</p>

<pre><code>database_name   database_size   unallocated space
My_DB           17899.13 MB 5309.39 MB
</code></pre>

<p>It returns me several column that i don't need, maybe there is a trick to select database_size column from this stored procedure ? </p>

<p>I also tried this code :</p>

<pre><code>SELECT DB_NAME(database_id) AS DatabaseName,
       Name AS Logical_Name,
       Physical_Name,
       (size * 8) / 1024 SizeMB
FROM sys.master_files
WHERE DB_NAME(database_id) = 'MY_DB'
</code></pre>

<p>It gives me this result:</p>

<pre><code>DatabaseName    Logical_Name    Physical_Name                    SizeMB
MY_DB           MY_DB           D:\MSSQL\Data\MY_DB.mdf          10613
MY_DB           MY_DB_log       D:\MSSQL\Data\MY_DB.ldf          7286
</code></pre>

<p>So i wrote this: </p>

<pre><code>SELECT SUM(SizeMB)
FROM (
    SELECT DB_NAME(database_id) AS DatabaseName,
           Name AS Logical_Name,
           Physical_Name,
           (size * 8) / 1024 SizeMB
    FROM sys.master_files
    WHERE DB_NAME(database_id) = 'MY_DB'
) AS TEMP
</code></pre>

<p>I got: 1183</p>

<p>So it works but maybe there is a proper way to get this? </p>
","<p>Try this one -</p>

<p><strong>Query:</strong></p>

<pre><code>SELECT 
      database_name = DB_NAME(database_id)
    , log_size_mb = CAST(SUM(CASE WHEN type_desc = 'LOG' THEN size END) * 8. / 1024 AS DECIMAL(8,2))
    , row_size_mb = CAST(SUM(CASE WHEN type_desc = 'ROWS' THEN size END) * 8. / 1024 AS DECIMAL(8,2))
    , total_size_mb = CAST(SUM(size) * 8. / 1024 AS DECIMAL(8,2))
FROM sys.master_files WITH(NOWAIT)
WHERE database_id = DB_ID() -- for current db 
GROUP BY database_id
</code></pre>

<p><strong>Output:</strong></p>

<pre><code>-- my query
name           log_size_mb  row_size_mb   total_size_mb
-------------- ------------ ------------- -------------
xxxxxxxxxxx    512.00       302.81        814.81

-- sp_spaceused
database_name    database_size      unallocated space
---------------- ------------------ ------------------
xxxxxxxxxxx      814.81 MB          13.04 MB
</code></pre>

<p><strong>Function:</strong></p>

<pre><code>ALTER FUNCTION [dbo].[GetDBSize] 
(
    @db_name NVARCHAR(100)
)
RETURNS TABLE
AS
RETURN

  SELECT 
        database_name = DB_NAME(database_id)
      , log_size_mb = CAST(SUM(CASE WHEN type_desc = 'LOG' THEN size END) * 8. / 1024 AS DECIMAL(8,2))
      , row_size_mb = CAST(SUM(CASE WHEN type_desc = 'ROWS' THEN size END) * 8. / 1024 AS DECIMAL(8,2))
      , total_size_mb = CAST(SUM(size) * 8. / 1024 AS DECIMAL(8,2))
  FROM sys.master_files WITH(NOWAIT)
  WHERE database_id = DB_ID(@db_name)
      OR @db_name IS NULL
  GROUP BY database_id
</code></pre>

<p><strong>UPDATE 2016/01/22:</strong></p>

<p>Show information about size, free space, last database backups</p>

<pre><code>IF OBJECT_ID('tempdb.dbo.#space') IS NOT NULL
    DROP TABLE #space

CREATE TABLE #space (
      database_id INT PRIMARY KEY
    , data_used_size DECIMAL(18,2)
    , log_used_size DECIMAL(18,2)
)

DECLARE @SQL NVARCHAR(MAX)

SELECT @SQL = STUFF((
    SELECT '
    USE [' + d.name + ']
    INSERT INTO #space (database_id, data_used_size, log_used_size)
    SELECT
          DB_ID()
        , SUM(CASE WHEN [type] = 0 THEN space_used END)
        , SUM(CASE WHEN [type] = 1 THEN space_used END)
    FROM (
        SELECT s.[type], space_used = SUM(FILEPROPERTY(s.name, ''SpaceUsed'') * 8. / 1024)
        FROM sys.database_files s
        GROUP BY s.[type]
    ) t;'
    FROM sys.databases d
    WHERE d.[state] = 0
    FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '')

EXEC sys.sp_executesql @SQL

SELECT
      d.database_id
    , d.name
    , d.state_desc
    , d.recovery_model_desc
    , t.total_size
    , t.data_size
    , s.data_used_size
    , t.log_size
    , s.log_used_size
    , bu.full_last_date
    , bu.full_size
    , bu.log_last_date
    , bu.log_size
FROM (
    SELECT
          database_id
        , log_size = CAST(SUM(CASE WHEN [type] = 1 THEN size END) * 8. / 1024 AS DECIMAL(18,2))
        , data_size = CAST(SUM(CASE WHEN [type] = 0 THEN size END) * 8. / 1024 AS DECIMAL(18,2))
        , total_size = CAST(SUM(size) * 8. / 1024 AS DECIMAL(18,2))
    FROM sys.master_files
    GROUP BY database_id
) t
JOIN sys.databases d ON d.database_id = t.database_id
LEFT JOIN #space s ON d.database_id = s.database_id
LEFT JOIN (
    SELECT
          database_name
        , full_last_date = MAX(CASE WHEN [type] = 'D' THEN backup_finish_date END)
        , full_size = MAX(CASE WHEN [type] = 'D' THEN backup_size END)
        , log_last_date = MAX(CASE WHEN [type] = 'L' THEN backup_finish_date END)
        , log_size = MAX(CASE WHEN [type] = 'L' THEN backup_size END)
    FROM (
        SELECT
              s.database_name
            , s.[type]
            , s.backup_finish_date
            , backup_size =
                        CAST(CASE WHEN s.backup_size = s.compressed_backup_size
                                    THEN s.backup_size
                                    ELSE s.compressed_backup_size
                        END / 1048576.0 AS DECIMAL(18,2))
            , RowNum = ROW_NUMBER() OVER (PARTITION BY s.database_name, s.[type] ORDER BY s.backup_finish_date DESC)
        FROM msdb.dbo.backupset s
        WHERE s.[type] IN ('D', 'L')
    ) f
    WHERE f.RowNum = 1
    GROUP BY f.database_name
) bu ON d.name = bu.database_name
ORDER BY t.total_size DESC
</code></pre>

<p><strong>Output:</strong></p>

<pre><code>database_id name                             state_desc   recovery_model_desc total_size   data_size   data_used_size  log_size    log_used_size  full_last_date          full_size    log_last_date           log_size
----------- -------------------------------- ------------ ------------------- ------------ ----------- --------------- ----------- -------------- ----------------------- ------------ ----------------------- ---------
24          StackOverflow                    ONLINE       SIMPLE              66339.88     65840.00    65102.06        499.88      5.05           NULL                    NULL         NULL                    NULL
11          AdventureWorks2012               ONLINE       SIMPLE              16404.13     15213.00    192.69          1191.13     15.55          2015-11-10 10:51:02.000 44.59        NULL                    NULL
10          locateme                         ONLINE       SIMPLE              1050.13      591.00      2.94            459.13      6.91           2015-11-06 15:08:34.000 17.25        NULL                    NULL
8           CL_Documents                     ONLINE       FULL                793.13       334.00      333.69          459.13      12.95          2015-11-06 15:08:31.000 309.22       2015-11-06 13:15:39.000 0.01
1           master                           ONLINE       SIMPLE              554.00       492.06      4.31            61.94       5.20           2015-11-06 15:08:12.000 0.65         NULL                    NULL
9           Refactoring                      ONLINE       SIMPLE              494.32       366.44      308.88          127.88      34.96          2016-01-05 18:59:10.000 37.53        NULL                    NULL
3           model                            ONLINE       SIMPLE              349.06       4.06        2.56            345.00      0.97           2015-11-06 15:08:12.000 0.45         NULL                    NULL
13          sql-format.com                   ONLINE       SIMPLE              216.81       181.38      149.00          35.44       3.06           2015-11-06 15:08:39.000 23.64        NULL                    NULL
23          users                            ONLINE       FULL                173.25       73.25       3.25            100.00      5.66           2015-11-23 13:15:45.000 0.72         NULL                    NULL
4           msdb                             ONLINE       SIMPLE              46.44        20.25       19.31           26.19       4.09           2015-11-06 15:08:12.000 2.96         NULL                    NULL
21          SSISDB                           ONLINE       FULL                45.06        40.00       4.06            5.06        4.84           2014-05-14 18:27:11.000 3.08         NULL                    NULL
27          tSQLt                            ONLINE       SIMPLE              9.00         5.00        3.06            4.00        0.75           NULL                    NULL         NULL                    NULL
2           tempdb                           ONLINE       SIMPLE              8.50         8.00        4.50            0.50        1.78           NULL                    NULL         NULL                    NULL
</code></pre>
","18014581"
"Get table column names in mysql?","314825","","<p>Is there a way to grab the columns name of a table in mysql?
using php</p>
","<p>You can use <a href=""http://dev.mysql.com/doc/refman/5.1/en/describe.html"" rel=""noreferrer"">DESCRIBE</a>:</p>

<pre><code>DESCRIBE my_table;
</code></pre>

<p>Or in newer versions you can use <a href=""http://dev.mysql.com/doc/refman/5.0/en/columns-table.html"" rel=""noreferrer"">INFORMATION_SCHEMA</a>:</p>

<pre><code>SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = 'my_database' AND TABLE_NAME = 'my_table';
</code></pre>

<p>Or you can use <a href=""http://dev.mysql.com/doc/refman/5.0/en/show-columns.html"" rel=""noreferrer"">SHOW COLUMNS</a>:</p>

<pre><code>SHOW COLUMNS FROM my_table;
</code></pre>
","1526722"
"How to declare a variable in MySQL?","314554","","<p>How to declare a variable in mysql, so that my second query can use it?</p>

<p>I would like to write something like:</p>

<pre><code>SET start = 1;
SET finish = 10;

SELECT * FROM places WHERE place BETWEEN start AND finish;
</code></pre>
","<p>There are mainly three types of variables in MySQL:</p>

<ol>
<li><p><strong><a href=""http://dev.mysql.com/doc/refman/5.0/en/user-variables.html"">User-defined variables</a> (prefixed with <code>@</code>):</strong>  </p>

<p>You can access any user-defined variable without declaring it or
initializing it. If you refer to a variable that has not been
initialized, it has a value of <code>NULL</code> and a type of string.</p>

<pre><code>SELECT @var_any_var_name
</code></pre>

<p>You can initialize a variable using <code>SET</code> or <code>SELECT</code> statement:</p>

<pre><code>SET @start = 1, @finish = 10;    
</code></pre>

<p>or </p>

<pre><code>SELECT @start := 1, @finish := 10;

SELECT * FROM places WHERE place BETWEEN @start AND @finish;
</code></pre>

<p>User variables can be assigned a value from a limited set of data
types: integer, decimal, floating-point, binary or nonbinary string,
or NULL value.</p>

<p>User-defined variables are session-specific. That is, a user
variable defined by one client cannot be seen or used by other
clients.</p>

<p>They can be used in <code>SELECT</code> queries using <a href=""http://www.xaprb.com/blog/2006/12/15/advanced-mysql-user-variable-techniques/"">Advanced MySQL user variable techniques</a>.</p></li>
<li><p><strong><a href=""http://dev.mysql.com/doc/refman/5.0/en/declare-local-variable.html"">Local Variables</a> (no prefix) :</strong></p>

<p>Local variables needs to be declared using <code>DECLARE</code> before
accessing it.</p>

<p>They can be used as local variables and the input parameters
inside a stored procedure:   </p>

<pre><code>DELIMITER //

CREATE PROCEDURE sp_test(var1 INT) 
BEGIN   
    DECLARE start  INT unsigned DEFAULT 1;  
    DECLARE finish INT unsigned DEFAULT 10;

    SELECT  var1, start, finish;

    SELECT * FROM places WHERE place BETWEEN start AND finish; 
END; //

DELIMITER ;

CALL sp_test(5);
</code></pre>

<p>If the <code>DEFAULT</code> clause is missing, the initial value is <code>NULL</code>. </p>

<p>The scope of a local variable is the <code>BEGIN ... END</code> block within
which it is declared.</p></li>
<li><p><strong><a href=""https://dev.mysql.com/doc/refman/5.5/en/using-system-variables.html"">Server System Variables</a> (prefixed with <code>@@</code>):</strong></p>

<p>The MySQL server maintains many <a href=""https://dev.mysql.com/doc/refman/5.0/en/server-system-variables.html"">system variables</a> configured to a default value.
They can be of type <code>GLOBAL</code>, <code>SESSION</code> or <code>BOTH</code>.</p>

<p>Global variables affect the overall operation of the server whereas session variables affect its operation for individual client connections.</p>

<p>To see the current values used by a running server, use the <code>SHOW VARIABLES</code> statement or <code>SELECT @@var_name</code>. </p>

<pre><code>SHOW VARIABLES LIKE '%wait_timeout%';

SELECT @@sort_buffer_size;
</code></pre>

<p>They can be set at server startup using options on the command line or in an option file. 
Most of them can be changed dynamically while the server is running using <code>SET GLOBAL</code> or <code>SET SESSION</code>:</p>

<pre><code>-- Syntax to Set value to a Global variable:
SET GLOBAL sort_buffer_size=1000000;
SET @@global.sort_buffer_size=1000000;

-- Syntax to Set value to a Session variable:
SET sort_buffer_size=1000000;
SET SESSION sort_buffer_size=1000000;
SET @@sort_buffer_size=1000000;
SET @@local.sort_buffer_size=10000;
</code></pre></li>
</ol>
","11754790"
"Must declare the scalar variable","313694","","<p><code>@RowFrom int</code></p>

<p><code>@RowTo int</code></p>

<p>are both Global Input Params for the Stored Procedure, and since I am compiling the SQL query inside the Stored Procedure with T-SQL then using <code>Exec(@sqlstatement)</code> at the end of the stored procedure to show the result, it gives me this error when I try to use the <code>@RowFrom</code> or <code>@RowTo</code> inside the <code>@sqlstatement</code> variable that is executed.. it works fine otherwise.. please help.</p>

<pre><code>""Must declare the scalar variable ""@RowFrom"".""
</code></pre>

<hr>

<p>Also, I tried including the following in the <code>@sqlstatement</code> variable:</p>

<pre><code>'Declare @Rt int'
'SET @Rt = ' + @RowTo
</code></pre>

<p>but <code>@RowTo</code> still doesn't pass its value to <code>@Rt</code>  and generates an error.</p>
","<p>You can't concatenate an int to a string. Instead of:</p>

<pre><code>SET @sql = N'DECLARE @Rt INT; SET @Rt = ' + @RowTo;
</code></pre>

<p>You need:</p>

<pre><code>SET @sql = N'DECLARE @Rt INT; SET @Rt = ' + CONVERT(VARCHAR(12), @RowTo);
</code></pre>

<p>To help illustrate what's happening here. Let's say @RowTo = 5.</p>

<pre><code>DECLARE @RowTo INT;
SET @RowTo = 5;

DECLARE @sql NVARCHAR(MAX);
SET @sql = N'SELECT ' + CONVERT(VARCHAR(12), @RowTo) + ' * 5';
EXEC sp_executeSQL @sql;
</code></pre>

<p>In order to build that into a string (even if ultimately it will be a number), I need to convert it. But as you can see, the number is still treated as a number when it's executed. The answer is 25, right?</p>

<p>In your case you don't really need to re-declare @Rt etc. inside the @sql string, you just need to say:</p>

<pre><code>SET @sql = @sql + ' WHERE RowNum BETWEEN ' 
    + CONVERT(VARCHAR(12), @RowFrom) + ' AND ' 
    + CONVERT(VARCHAR(12), @RowTo);
</code></pre>

<p>Though it would be better to have proper parameterization, e.g.</p>

<pre><code>SET @sql = @sql + ' WHERE RowNum BETWEEN @RowFrom AND @RowTo;';

EXEC sp_executesql @sql,
  N'@RowFrom INT, @RowTo INT',
  @RowFrom, @RowTo;
</code></pre>
","7182216"
"How can I combine multiple rows into a comma-delimited list in Oracle?","313444","","<p>I have a simple query:</p>

<pre><code>select * from countries
</code></pre>

<p>with the following results:</p>

<pre><code>country_name
------------
Albania
Andorra
Antigua
.....
</code></pre>

<p>I would like to return the results in one row, so like this:</p>

<pre><code>Albania, Andorra, Antigua, ...
</code></pre>

<p>Of course, I can write a PL/SQL function to do the job (I already did in Oracle 10g), but is there a nicer, preferably non-Oracle-specific solution (or may be a built-in function) for this task?</p>

<p>I would generally use it to avoid multiple rows in a sub-query, so if a person has more then one citizenship, I do not want her/him to be a duplicate in the list.</p>

<p>My question is based on the similar question on <a href=""https://stackoverflow.com/questions/180032/how-can-i-combine-multiple-rows-into-a-comma-delimited-list-in-sql-server-2005"">SQL server 2005</a>.</p>

<p><strong>UPDATE</strong>:
My function looks like this:</p>

<pre><code>CREATE OR REPLACE FUNCTION APPEND_FIELD (sqlstr in varchar2, sep in varchar2 ) return varchar2 is
ret varchar2(4000) := '';
TYPE cur_typ IS REF CURSOR;
rec cur_typ;
field varchar2(4000);
begin
     OPEN rec FOR sqlstr;
     LOOP
         FETCH rec INTO field;
         EXIT WHEN rec%NOTFOUND;
         ret := ret || field || sep;
     END LOOP;
     if length(ret) = 0 then
          RETURN '';
     else
          RETURN substr(ret,1,length(ret)-length(sep));
     end if;
end;
</code></pre>
","<p>Here is a simple way without stragg or creating a function.  It is referenced in Tom Kyte's blog.  <a href=""http://tkyte.blogspot.com/2006/08/evolution.html"" rel=""noreferrer"">http://tkyte.blogspot.com/2006/08/evolution.html</a></p>

<pre><code>create table countries ( country_name varchar2 (100));

insert into countries values ('Albania');

insert into countries values ('Andorra');

insert into countries values ('Antigua');


SELECT SUBSTR (SYS_CONNECT_BY_PATH (country_name , ','), 2) csv
      FROM (SELECT country_name , ROW_NUMBER () OVER (ORDER BY country_name ) rn,
                   COUNT (*) OVER () cnt
              FROM countries)
     WHERE rn = cnt
START WITH rn = 1
CONNECT BY rn = PRIOR rn + 1;

CSV                                                                             
--------------------------
Albania,Andorra,Antigua                                                         

1 row selected.
</code></pre>

<p>As others have mentioned, if you are on 11g R2 or greater, you can now use listagg which is much simpler.</p>

<pre><code>select listagg(country_name,', ') within group(order by country_name) csv
  from countries;

CSV                                                                             
--------------------------
Albania, Andorra, Antigua

1 row selected.
</code></pre>
","470663"
"Oracle DateTime in Where Clause?","311315","","<p>I have sql something like this:</p>

<pre><code>SELECT EMP_NAME, DEPT
FROM EMPLOYEE
WHERE TIME_CREATED &gt;= TO_DATE('26/JAN/2011','dd/mon/yyyy')
</code></pre>

<p>-> This returns 10 rows and TIME_CREATED = '26-JAN-2011'</p>

<p>Now when i do this i don't get any rows back,</p>

<pre><code>SELECT EMP_NAME, DEPT
    FROM EMPLOYEE
    WHERE TIME_CREATED = TO_DATE('26/JAN/2011','dd/mon/yyyy')
</code></pre>

<p>-> Took the greater than out</p>

<p>Any reason why?</p>
","<p>Yes: TIME_CREATED contains a date and a <strong>time</strong>. Use <code>TRUNC</code> to strip the time:</p>

<pre><code>SELECT EMP_NAME, DEPT
FROM EMPLOYEE
WHERE TRUNC(TIME_CREATED) = TO_DATE('26/JAN/2011','dd/mon/yyyy')
</code></pre>

<p><strong>UPDATE:</strong><br>
As Dave Costa points out in the comment below, this will prevent Oracle from using the index of the column <code>TIME_CREATED</code> if it exists. An alternative approach without this problem is this:</p>

<pre><code>SELECT EMP_NAME, DEPT
FROM EMPLOYEE
WHERE TIME_CREATED &gt;= TO_DATE('26/JAN/2011','dd/mon/yyyy') 
      AND TIME_CREATED &lt; TO_DATE('26/JAN/2011','dd/mon/yyyy') + 1
</code></pre>
","6749403"
"Oracle ""Partition By"" Keyword","310171","","<p>Can someone please explain what the <code>partition by</code> keyword does and give a simple example of it in action, as well as why one would want to use it?  I have a SQL query written by someone else and I'm trying to figure out what it does.</p>

<p>An example of partition by:</p>

<pre><code>SELECT empno, deptno, COUNT(*) 
OVER (PARTITION BY deptno) DEPT_COUNT
FROM emp
</code></pre>

<p>The examples I've seen online seem a bit too in-depth.</p>
","<p>The <code>PARTITION BY</code> clause sets the range of records that will be used for each ""GROUP"" within the <code>OVER</code> clause.</p>

<p>In your example SQL, <code>DEPT_COUNT</code> will return the number of employees within that department for every employee record.  (It is as if your de-nomalising the <code>emp</code> table; you still return every record in the <code>emp</code> table.)</p>

<pre><code>emp_no  dept_no  DEPT_COUNT
1       10       3
2       10       3
3       10       3 &lt;- three because there are three ""dept_no = 10"" records
4       20       2
5       20       2 &lt;- two because there are two ""dept_no = 20"" records
</code></pre>

<p>If there was another column (e.g., <code>state</code>) then you could count how many departments in that State.</p>

<p>It is like getting the results of a <code>GROUP BY</code> (<code>SUM</code>, <code>AVG</code>, etc.) without the aggregation of the result set.</p>

<p>It is useful when you use the <code>LAST OVER</code> or <code>MIN OVER</code> functions to get, for example, the lowest and highest salary in the department and then use that in a calulation against this records salary <em>without</em> a sub select, which is much faster.</p>

<p>Read the linked <a href=""http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:3170642805938"" rel=""noreferrer"">AskTom article</a> for further details. </p>
","561884"
"How do I get the current year using SQL on Oracle?","309422","","<p>I need to add the current year as a variable in an SQL statement, how can I retrieve the current year using SQL?</p>

<p>i.e.</p>

<pre>
  BETWEEN 
    TO_DATE('01/01/<i>**currentYear**</i> 00:00:00', 'DD/MM/YYYY HH24:MI:SS')
    AND
    TO_DATE('31/12/<i>**currentYear**</i> 23:59:59', 'DD/MM/YYYY HH24:MI:SS')
</pre>
","<p>With to_char:</p>

<pre><code>select to_char(sysdate, 'YYYY') from dual;
</code></pre>

<p>In your example you can use something like:</p>

<pre><code>BETWEEN trunc(sysdate, 'YEAR') 
    AND add_months(trunc(sysdate, 'YEAR'), 12)-1/24/60/60;
</code></pre>

<p>The comparision values are exactly what you request:</p>

<pre><code>select trunc(sysdate, 'YEAR') begin_year
     , add_months(trunc(sysdate, 'YEAR'), 12)-1/24/60/60 last_second_year
from dual;

BEGIN_YEAR  LAST_SECOND_YEAR
----------- ----------------
01/01/2009  31/12/2009
</code></pre>
","1119717"
"Extracting hours from a DateTime (SQL Server 2005)","309141","","<p>I can extract the month and day by using <code>Day(Date())</code>, <code>Month(Date())</code>. I can't extract hours, with <code>HOUR(Date())</code>. I get the following error.</p>

<pre><code>'HOUR' is not a recognized built-in function name.
</code></pre>

<p>How can I extract hours?</p>
","<pre><code>SELECT DATEPART(HOUR, GETDATE());
</code></pre>

<p><a href=""http://msdn.microsoft.com/en-us/library/ms174420%28loband%29.aspx"" rel=""noreferrer""><code>DATEPART</code> documentation</a></p>
","1114314"
"Oracle date ""Between"" Query","308855","","<p>I am using oracle database. i want to execute one query to check the data between two dates.</p>

<pre><code>NAME               START_DATE    
-------------    ------------- 
Small Widget       15-JAN-10 04.25.32.000000 PM      
Product 1          17-JAN-10 04.31.32.000000 PM  



select * from &lt;TABLENAME&gt; where start_date  
BETWEEN '15-JAN-10' AND '17-JAN-10'
</code></pre>

<p>But I dont get any results from above query. I think I have to use ""like"" and ""%"". But I dont know where to use them. Please throw some lights on this. </p>

<p>thanks in advance.</p>
","<p>Judging from your output it looks like you have defined START_DATE as a timestamp.  If it were a regular date Oracle would be able to handle the implicit conversion.  But as it isn't you need to explicitly cast those strings to be dates.</p>

<pre><code>SQL&gt; alter session set nls_date_format = 'dd-mon-yyyy hh24:mi:ss'
  2  /

Session altered.

SQL&gt;
SQL&gt; select * from t23
  2  where start_date between '15-JAN-10' and '17-JAN-10'
  3  /

no rows selected

SQL&gt; select * from t23
  2  where start_date between to_date('15-JAN-10') and to_date('17-JAN-10')
  3  /

WIDGET                          START_DATE
------------------------------  ----------------------
Small Widget                    15-JAN-10 04.25.32.000    

SQL&gt; 
</code></pre>

<p>But we still only get one row.  This is because START_DATE has a time element.  If we don't specify the time component Oracle defaults it to midnight.  That is fine for the <em>from</em> side of the <code>BETWEEN</code> but not for the <em>until</em> side:</p>

<pre><code>SQL&gt; select * from t23
  2  where start_date between to_date('15-JAN-10') 
  3                       and to_date('17-JAN-10 23:59:59')
  4  /

WIDGET                          START_DATE
------------------------------  ----------------------
Small Widget                    15-JAN-10 04.25.32.000
Product 1                       17-JAN-10 04.31.32.000

SQL&gt;
</code></pre>

<p><strong>edit</strong></p>

<p>If you cannot pass in the time component there are a couple of choices.  One is to change the WHERE clause to remove the time element from the criteria: </p>

<pre><code>where trunc(start_date) between to_date('15-JAN-10') 
                            and to_date('17-JAN-10')
</code></pre>

<p>This might have an impact on performance, because it disqualifies any b-tree index on START_DATE.  You would need to build a function-based index instead. </p>

<p>Alternatively you could add the time element to the date in your code:</p>

<pre><code>where start_date between to_date('15-JAN-10') 
                     and to_date('17-JAN-10') + (86399/86400) 
</code></pre>

<p>Because of these problems many people prefer to avoid the use of <code>between</code> by checking for date boundaries like this:</p>

<pre><code>where start_date &gt;= to_date('15-JAN-10') 
and start_date &lt; to_date('18-JAN-10')
</code></pre>
","2369333"
"Exporting data In SQL Server as INSERT INTO","308311","","<p>I am using SQL Server 2008 Management Studio and have a table I want to migrate to a different db server.</p>

<p>Is there any option to export the data as an insert into SQL script?? </p>
","<p>In SSMS in the Object Explorer, right click on the database, right-click and pick ""Tasks"" and then ""Generate Scripts"".</p>

<p>This will allow you to generate scripts for a single or all tables, and one of the options is ""Script Data"". If you set that to TRUE, the wizard will generate a script with INSERT INTO () statement for your data. </p>

<p><strong>If using 2008 R2 or 2012  it is called something else, see screenshot below this one</strong></p>

<p><img src=""https://i.stack.imgur.com/1RGpo.png"" alt=""alt text""></p>

<h2>2008 R2 or later eg 2012</h2>

<p>Select ""Types of Data to Script"" which can be ""Data Only"", ""Schema and Data"" or ""Schema Only"" - the default). </p>

<p><img src=""https://i.stack.imgur.com/oApeb.png"" alt=""enter image description here""></p>

<p>And then there's a ""<a href=""http://ssmsaddins.codeplex.com/"" rel=""noreferrer"">SSMS Addin</a>"" Package on Codeplex (including source) which promises pretty much the same functionality and a few more (like quick find etc.)</p>

<p><img src=""https://i.stack.imgur.com/o398L.png"" alt=""alt text""></p>
","1515975"
"Extract date (yyyy/mm/dd) from a timestamp in PostgreSQL","307856","","<p>I want to extract just the date part from a timestamp in PostgreSQL.</p>

<p>I need it to be a postgresql <code>DATE</code> type so I can insert it into another table that expects a <code>DATE</code> value.</p>

<p>For example, if I have <code>2011/05/26 09:00:00</code>, I want <code>2011/05/26</code></p>

<p><strong>I tried casting, but I only get 2011:</strong></p>

<pre><code>timestamp:date
cast(timestamp as date)
</code></pre>

<p><strong>I tried <code>to_char()</code> with <code>to_date()</code>:</strong></p>

<pre><code>SELECT to_date(to_char(timestamp, 'YYYY/MM/DD'), 'YYYY/MM/DD') 
FROM val3 WHERE id=1;
</code></pre>

<p><strong>I tried to make it a function:</strong></p>

<pre><code>CREATE OR REPLACE FUNCTION testing() RETURNS void AS '
DECLARE i_date DATE;
BEGIN
    SELECT to_date(to_char(val1, ""YYYY/MM/DD""),""YYYY/MM/DD"") 
      INTO i_date FROM exampTable WHERE id=1;
    INSERT INTO foo(testd) VALUES (i);
END
</code></pre>

<p>What is the best way to extract date (yyyy/mm/dd) from a timestamp in PostgreSQL?</p>
","<p>You can cast your timestamp to a date by suffixing it with <code>::date</code>.  Here, in psql, is a timestamp:</p>

<pre><code># select '2010-01-01 12:00:00'::timestamp;
      timestamp      
---------------------
 2010-01-01 12:00:00
</code></pre>

<p>Now we'll cast it to a date:</p>

<pre><code>wconrad=# select '2010-01-01 12:00:00'::timestamp::date;
    date    
------------
 2010-01-01
</code></pre>

<p>On the other hand you can use <code>date_trunc</code> function. The difference between them is that the latter returns the same data type like <code>timestamptz</code> keeping your time zone intact (if you need it).</p>

<pre><code>=&gt; select date_trunc('day', now());
       date_trunc
------------------------
 2015-12-15 00:00:00+02
(1 row)
</code></pre>
","6133144"
"Script to kill all connections to a database (More than RESTRICTED_USER ROLLBACK)","307348","","<p>I have a development database that re-deploy frequently from a Visual Studio Database project (via a TFS Auto Build).</p>

<p>Sometimes when I run my build I get this error:</p>

<blockquote>
  <p>ALTER DATABASE failed because a lock could not be placed on database 'MyDB'. Try again later.<br>
   ALTER DATABASE statement failed.<br>
   Cannot drop database ""MyDB"" because it is currently in use.  </p>
</blockquote>

<p>I tried this:</p>

<pre><code>ALTER DATABASE MyDB SET RESTRICTED_USER WITH ROLLBACK IMMEDIATE
</code></pre>

<p>but I still cannot drop the database.  (My guess is that most of the developers have dbo access.)</p>

<p>I can manually run SP_WHO and start killing connections, but I need an automatic way to do this in the auto build.  (Though this time my connection is the only one on the db I am trying to drop.)</p>

<p>Is there a script that can drop my database regardless of who is connected?</p>
","<p><strong>Updated</strong></p>

<p>For MS SQL Server 2012 and above</p>

<pre><code>USE [master];

DECLARE @kill varchar(8000) = '';  
SELECT @kill = @kill + 'kill ' + CONVERT(varchar(5), session_id) + ';'  
FROM sys.dm_exec_sessions
WHERE database_id  = db_id('MyDB')

EXEC(@kill);
</code></pre>

<p>For MS SQL Server 2000, 2005, 2008</p>

<pre><code>USE master;

DECLARE @kill varchar(8000); SET @kill = '';  
SELECT @kill = @kill + 'kill ' + CONVERT(varchar(5), spid) + ';'  
FROM master..sysprocesses  
WHERE dbid = db_id('MyDB')

EXEC(@kill); 
</code></pre>
","7201350"
"ORA-00904: invalid identifier","306665","","<p>I tried to write the following inner join query using an Oracle database:</p>

<pre><code> SELECT Employee.EMPLID as EmpID, 
        Employee.FIRST_NAME AS Name,
        Team.DEPARTMENT_CODE AS TeamID, 
        Team.Department_Name AS teamname
 FROM PS_TBL_EMPLOYEE_DETAILS Employee
 INNER JOIN PS_TBL_DEPARTMENT_DETAILS Team 
 ON Team.DEPARTMENT_CODE = Employee.DEPTID
</code></pre>

<p>That gives the below error:</p>

<pre><code> INNER JOIN PS_TBL_DEPARTMENT_DETAILS Team ON Team.DEPARTMENT_CODE = Employee.DEPTID
                                              *
ERROR at line 4:
ORA-00904: ""TEAM"".""DEPARTMENT_CODE"": invalid identifier
</code></pre>

<p>The DDL of one table is:</p>

<pre><code>CREATE TABLE ""HRMS"".""PS_TBL_DEPARTMENT_DETAILS""
(
  ""Company Code"" VARCHAR2(255),
  ""Company Name"" VARCHAR2(255),
  ""Sector_Code"" VARCHAR2(255),
  ""Sector_Name"" VARCHAR2(255),
  ""Business_Unit_Code"" VARCHAR2(255),
  ""Business_Unit_Name"" VARCHAR2(255),
  ""Department_Code"" VARCHAR2(255),
  ""Department_Name"" VARCHAR2(255),
  ""HR_ORG_ID"" VARCHAR2(255),
  ""HR_ORG_Name"" VARCHAR2(255),
  ""Cost_Center_Number"" VARCHAR2(255),
  "" "" VARCHAR2(255)
)
SEGMENT CREATION IMMEDIATE PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS
</code></pre>
","<p>Your problem is those pernicious double quotes.  </p>

<pre><code>SQL&gt; CREATE TABLE ""APC"".""PS_TBL_DEPARTMENT_DETAILS""
  2  (
  3    ""Company Code"" VARCHAR2(255),
  4    ""Company Name"" VARCHAR2(255),
  5    ""Sector_Code"" VARCHAR2(255),
  6    ""Sector_Name"" VARCHAR2(255),
  7    ""Business_Unit_Code"" VARCHAR2(255),
  8    ""Business_Unit_Name"" VARCHAR2(255),
  9    ""Department_Code"" VARCHAR2(255),
 10    ""Department_Name"" VARCHAR2(255),
 11    ""HR_ORG_ID"" VARCHAR2(255),
 12    ""HR_ORG_Name"" VARCHAR2(255),
 13    ""Cost_Center_Number"" VARCHAR2(255),
 14    "" "" VARCHAR2(255)
 15  )
 16  /

Table created.

SQL&gt;
</code></pre>

<p>Oracle SQL allows us to ignore the case of database object names provided we either create them with names all in upper case, or without using double quotes.  If we use mixed case or  lower case in the script and wrapped the identifiers in double quotes we are condemned to using double quotes and the precise case whenever we refer to the object or its attributes:</p>

<pre><code>SQL&gt; select count(*) from PS_TBL_DEPARTMENT_DETAILS
  2  where Department_Code = 'BAH'
  3  /
where Department_Code = 'BAH'
      *
ERROR at line 2:
ORA-00904: ""DEPARTMENT_CODE"": invalid identifier


SQL&gt; select count(*) from PS_TBL_DEPARTMENT_DETAILS
  2  where ""Department_Code"" = 'BAH'
  3  /

  COUNT(*)
----------
         0

SQL&gt;
</code></pre>

<hr>

<p><strong>tl;dr</strong></p>

<p>don't use double quotes in DDL scripts</p>

<p>(I know most third party code generators do, but they are disciplined enough to put all their object names in UPPER CASE.)</p>
","6030439"
"Returning Month Name in SQL Server Query","305596","","<p>Using SQL Server 2008, I have a query that is used to create a view and I'm trying to display a month's name instead of an integer. </p>

<p>In my database, the datetime is in a column called OrderDateTime. The lines in the query that return the date is:</p>

<pre><code>DATENAME(yyyy, S0.OrderDateTime) AS OrderYear,
DATEPART(MONTH, S0.OrderDateTime) AS OrderMonth
</code></pre>

<p>This returns a column of years and a column of months as integers. I want to return the month names (Jan, Feb, etc). I've tried:</p>

<pre><code>CONVERT(varchar(3), DATEPART(MONTH, S0.OrderDateTime) AS OrderMonth
</code></pre>

<p>This is obviously is incorrect, as I get ""Incorrect syntax near 'AS'"" message. What is the proper syntax for my query?</p>
","<p>This will give you the full name of the month.</p>

<pre><code>select datename(month, S0.OrderDateTime)
</code></pre>

<p>If you only want the first three letters you can use this</p>

<pre><code>select convert(char(3), S0.OrderDateTime, 0)
</code></pre>
","5650850"
"Need to list all triggers in SQL Server database with table name and table's schema","305463","","<p>I need to list all triggers in SQL Server database with table name and table's schema.</p>

<p>I'm almost there with this:</p>

<pre><code>SELECT trigger_name = name, trigger_owner = USER_NAME(uid),table_schema = , table_name = OBJECT_NAME(parent_obj),
  isupdate = OBJECTPROPERTY( id, 'ExecIsUpdateTrigger'), isdelete = OBJECTPROPERTY( id, 'ExecIsDeleteTrigger'),
  isinsert = OBJECTPROPERTY( id, 'ExecIsInsertTrigger'), isafter = OBJECTPROPERTY( id, 'ExecIsAfterTrigger'),
  isinsteadof = OBJECTPROPERTY( id, 'ExecIsInsteadOfTrigger'),
  [disabled] = OBJECTPROPERTY(id, 'ExecIsTriggerDisabled') 
FROM sysobjects INNER JOIN sysusers ON sysobjects.uid = sysusers.uid
WHERE type = 'TR'
</code></pre>

<p>I just need to get the table's schema also.</p>
","<p>Here's one way:</p>

<pre><code>SELECT 
     sysobjects.name AS trigger_name 
    ,USER_NAME(sysobjects.uid) AS trigger_owner 
    ,s.name AS table_schema 
    ,OBJECT_NAME(parent_obj) AS table_name 
    ,OBJECTPROPERTY( id, 'ExecIsUpdateTrigger') AS isupdate 
    ,OBJECTPROPERTY( id, 'ExecIsDeleteTrigger') AS isdelete 
    ,OBJECTPROPERTY( id, 'ExecIsInsertTrigger') AS isinsert 
    ,OBJECTPROPERTY( id, 'ExecIsAfterTrigger') AS isafter 
    ,OBJECTPROPERTY( id, 'ExecIsInsteadOfTrigger') AS isinsteadof 
    ,OBJECTPROPERTY(id, 'ExecIsTriggerDisabled') AS [disabled] 
FROM sysobjects 

INNER JOIN sysusers 
    ON sysobjects.uid = sysusers.uid 

INNER JOIN sys.tables t 
    ON sysobjects.parent_obj = t.object_id 

INNER JOIN sys.schemas s 
    ON t.schema_id = s.schema_id 

WHERE sysobjects.type = 'TR' 
</code></pre>

<p><strong>EDIT</strong>:
Commented out join to sysusers for query to work on AdventureWorks2008.</p>

<pre><code>SELECT 
     sysobjects.name AS trigger_name 
    ,USER_NAME(sysobjects.uid) AS trigger_owner 
    ,s.name AS table_schema 
    ,OBJECT_NAME(parent_obj) AS table_name 
    ,OBJECTPROPERTY( id, 'ExecIsUpdateTrigger') AS isupdate 
    ,OBJECTPROPERTY( id, 'ExecIsDeleteTrigger') AS isdelete 
    ,OBJECTPROPERTY( id, 'ExecIsInsertTrigger') AS isinsert 
    ,OBJECTPROPERTY( id, 'ExecIsAfterTrigger') AS isafter 
    ,OBJECTPROPERTY( id, 'ExecIsInsteadOfTrigger') AS isinsteadof 
    ,OBJECTPROPERTY(id, 'ExecIsTriggerDisabled') AS [disabled] 
FROM sysobjects 
/*
INNER JOIN sysusers 
    ON sysobjects.uid = sysusers.uid 
*/  
INNER JOIN sys.tables t 
    ON sysobjects.parent_obj = t.object_id 

INNER JOIN sys.schemas s 
    ON t.schema_id = s.schema_id 
WHERE sysobjects.type = 'TR' 
</code></pre>

<p><strong>EDIT 2</strong>: For SQL 2000</p>

<pre><code>SELECT 
     o.name AS trigger_name 
    ,'x' AS trigger_owner 
    /*USER_NAME(o.uid)*/ 
    ,s.name AS table_schema 
    ,OBJECT_NAME(o.parent_obj) AS table_name 
    ,OBJECTPROPERTY(o.id, 'ExecIsUpdateTrigger') AS isupdate 
    ,OBJECTPROPERTY(o.id, 'ExecIsDeleteTrigger') AS isdelete 
    ,OBJECTPROPERTY(o.id, 'ExecIsInsertTrigger') AS isinsert 
    ,OBJECTPROPERTY(o.id, 'ExecIsAfterTrigger') AS isafter 
    ,OBJECTPROPERTY(o.id, 'ExecIsInsteadOfTrigger') AS isinsteadof 
    ,OBJECTPROPERTY(o.id, 'ExecIsTriggerDisabled') AS [disabled] 
FROM sysobjects AS o 
/*
INNER JOIN sysusers 
    ON sysobjects.uid = sysusers.uid 
*/  
INNER JOIN sysobjects AS o2 
    ON o.parent_obj = o2.id 

INNER JOIN sysusers AS s 
    ON o2.uid = s.uid 

WHERE o.type = 'TR'
</code></pre>
","4305751"
"How do you create a temporary table in an Oracle database?","305448","","<p>I would like to create a temporary table in a Oracle database</p>

<p>something like </p>

<pre><code>Declare table @table (int id)
</code></pre>

<p>In SQL server</p>

<p>And than populate it with a select statement</p>

<p>Is it possible?</p>

<p>Thanks</p>
","<p>Yep, oracle has temporary tables. Here is a link to an <a href=""http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:48812348054"" rel=""noreferrer"">AskTom</a> article describing them.<br>
And <a href=""https://docs.oracle.com/database/121/SQLRF/statements_7002.htm#SQLRF54447"" rel=""noreferrer"">here</a> is the official oracle CREATE TABLE documentation (scroll down to the CREATE GLOBAL TEMPORARY section)<br>
And an example:</p>

<pre><code>CREATE GLOBAL TEMPORARY TABLE today_sales
   ON COMMIT PRESERVE ROWS 
   AS SELECT * FROM orders WHERE order_date = SYSDATE;
</code></pre>
","2671546"
"Display names of all constraints for a table in Oracle SQL","305415","","<p>I have defined a name for each of the constraint for the multiple tables that I have created in Oracle SQL. </p>

<p>The problem is that to drop a constraint for the column of a particular table I need to know the name that I have supplied for each constraints, which I have forgotten. </p>

<p>How do I list out all the names of constraints that I have specified for each column of a table? </p>

<p>Is there any SQL statement for doing so? </p>
","<p>You need to query the <a href=""http://docs.oracle.com/cd/B28359_01/server.111/b28318/datadict.htm"">data dictionary</a>, specifically the <code>USER_CONS_COLUMNS</code> view to see the table columns and corresponding constraints:</p>

<pre><code>SELECT *
  FROM user_cons_columns
 WHERE table_name = '&lt;your table name&gt;';
</code></pre>

<p>FYI, unless you specifically created your table with a lower case name (using double quotes) then the table name will be defaulted to upper case so ensure it is so in your query.</p>

<p>If you then wish to see more information about the constraint itself query the <code>USER_CONSTRAINTS</code> view:</p>

<pre><code>SELECT *
  FROM user_constraints
 WHERE table_name = '&lt;your table name&gt;'
   AND constraint_name = '&lt;your constraint name&gt;';
</code></pre>

<p>If the table is held in a schema that is not your default schema then you might need to replace the views with:</p>

<pre><code>all_cons_columns
</code></pre>

<p>and</p>

<pre><code>all_constraints
</code></pre>

<p>adding to the where clause:</p>

<pre><code>   AND owner = '&lt;schema owner of the table&gt;'
</code></pre>
","11880294"
"What is best tool to compare two SQL Server databases (schema and data)?","305019","","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""https://stackoverflow.com/questions/193438/free-tool-to-compare-sql-server-tables"">Free Tool to compare Sql Server tables</a>  </p>
</blockquote>



<p>I would like to compare two SQL Server databases including schema (table structure) and data in tables too. What is best tool to do this?</p>
","<p>I am using Red-Gate's software:
 <a href=""http://www.red-gate.com/"" rel=""noreferrer"">http://www.red-gate.com</a></p>
","685064"
"SQL Server Subquery returned more than 1 value. This is not permitted when the subquery follows =, !=, <, <= , >, >=","304760","","<p>I run the following query:</p>

<pre><code>SELECT 
   orderdetails.sku,
   orderdetails.mf_item_number,
   orderdetails.qty,
   orderdetails.price,
   supplier.supplierid,
   supplier.suppliername,
   supplier.dropshipfees,
   cost = (SELECT supplier_item.price
           FROM   supplier_item,
                  orderdetails,
                  supplier
           WHERE  supplier_item.sku = orderdetails.sku
                  AND supplier_item.supplierid = supplier.supplierid)
FROM   orderdetails,
       supplier,
       group_master
WHERE  invoiceid = '339740'
       AND orderdetails.mfr_id = supplier.supplierid
       AND group_master.sku = orderdetails.sku  
</code></pre>

<p>I get the following error:</p>

<blockquote>
  <p>Msg 512, Level 16, State 1, Line 2
  Subquery returned more than 1 value. This is not permitted when the subquery follows =, !=, &lt;, &lt;= , >, >= or when the subquery is used as an expression.</p>
</blockquote>

<p>Any ideas?</p>
","<p>Try this:</p>

<pre><code>select
    od.Sku,
    od.mf_item_number,
    od.Qty,
    od.Price,
    s.SupplierId,
    s.SupplierName,
    s.DropShipFees,
    si.Price as cost
from
    OrderDetails od
    inner join Supplier s on s.SupplierId = od.Mfr_ID
    inner join Group_Master gm on gm.Sku = od.Sku
    inner join Supplier_Item si on si.SKU = od.Sku and si.SupplierId = s.SupplierID
where
    od.invoiceid = '339740'
</code></pre>

<p>This will return multiple rows that are identical except for the <code>cost</code> column. Look at the different cost values that are returned and figure out what is causing the different values. Then ask somebody which cost value they want, and add the criteria to the query that will select that cost.</p>
","2653579"
"SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax — PHP — PDO","303297","","<p>I've looked through all the other stackoverflow (and google) posts with the same problem, but none seemed to address my problem.</p>

<p>I am using pdo and php.</p>

<p>My code:</p>

<pre><code>$vals = array(
 ':from'=&gt;$email,
 ':to'=&gt;$recipient,
 ':name'=&gt;$name,
 ':subject'=&gt;$subject,
 ':message'=&gt;$message
);
print_r($vals);
try {

 $pdo = new PDOConfig();

 $pdo-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

 $sql = ""SELECT * FROM messages WHERE `message` LIKE :message"";

 $q = $pdo-&gt;prepare($sql);
 $q-&gt;execute(array(':message' =&gt; $vals[':message']));
 $resp = $q-&gt;fetchAll();

 foreach ($resp as $row) {
  throw new Exception('Please do not post the same message twice!');
 }

 $sql = ""INSERT INTO messages (from, to, name, subject, message) VALUES (:from, :to, :name, :subject, :message)"";
 $q = $pdo-&gt;prepare($sql);
 $q-&gt;execute($vals);


} 
catch(PDOException $e) {
   echo $e-&gt;getMessage();
}
</code></pre>

<p>and the first print_r gives</p>

<pre><code>Array ( [:from] =&gt; abc@gmail.com [:to] =&gt; lala@me.com [:name] =&gt; abc [:subject] =&gt; abc [:message] =&gt; abc )
</code></pre>

<p>which is expected (none are null)</p>

<p>but it outputs the error</p>

<blockquote>
  <p>QLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'from, to, name, subject, message) VALUES ('abc@gmail.com', 'lala@me.com' at line 1</p>
</blockquote>

<p>No idea how to fix this... ideas?</p>
","<p><code>from</code> is a keyword in SQL. You may not used it as a column name without quoting it. In MySQL, things like column names are quoted using backticks, i.e. <code>`from`</code>.</p>

<p>Personally, I wouldn't bother; I'd just rename the column.</p>

<p>PS. as pointed out in the comments, <code>to</code> is another SQL keyword so it needs to be quoted, too. Conveniently, the folks at drupal.org maintain a <a href=""https://www.drupal.org/docs/develop/coding-standards/list-of-sql-reserved-words"" rel=""noreferrer"">list of reserved words in SQL</a>.</p>
","4544085"
"Is it possible to insert multiple rows at a time in an SQLite database?","301718","","<p>In MySQL you can insert multiple rows like this:</p>

<pre><code>INSERT INTO 'tablename' ('column1', 'column2') VALUES
    ('data1', 'data2'),
    ('data1', 'data2'),
    ('data1', 'data2'),
    ('data1', 'data2');
</code></pre>

<p>However, I am getting an error when I try to do something like this. Is it possible to insert multiple rows at a time in an SQLite database? What is the syntax to do that?</p>
","<h2>update</h2>

<p>As <a href=""https://stackoverflow.com/a/1609688/558639"">BrianCampbell points out here</a>, <strong>SQLite 3.7.11 and above now supports the simpler syntax of the original post</strong>.  However, the approach shown is still appropriate if you want maximum compatibility across legacy databases.</p>

<h2>original answer</h2>

<p>If I had privileges, I would bump <a href=""https://stackoverflow.com/a/1734067/356895"">andy's reply</a>: You <strong>can</strong> insert multiple rows in SQLite, you just need <strong>different syntax</strong>.  To make it perfectly clear, the OPs MySQL example:</p>

<pre><code>INSERT INTO 'tablename' ('column1', 'column2') VALUES
  ('data1', 'data2'),
  ('data1', 'data2'),
  ('data1', 'data2'),
  ('data1', 'data2');
</code></pre>

<p>This can be recast into SQLite as:</p>

<pre><code>     INSERT INTO 'tablename'
          SELECT 'data1' AS 'column1', 'data2' AS 'column2'
UNION ALL SELECT 'data1', 'data2'
UNION ALL SELECT 'data1', 'data2'
UNION ALL SELECT 'data1', 'data2'
</code></pre>

<h2>a note on performance</h2>

<p>I originally used this technique to efficiently load large datasets from Ruby on Rails.  <strong>However</strong>, <a href=""https://stackoverflow.com/a/5209093/558639"">as Jaime Cook points out</a>, it's not clear this is any faster wrapping individual <code>INSERTs</code> within a single transaction:</p>

<pre><code>BEGIN TRANSACTION;
INSERT INTO 'tablename' table VALUES ('data1', 'data2');
INSERT INTO 'tablename' table VALUES ('data3', 'data4');
...
COMMIT;
</code></pre>

<p>If efficiency is your goal, you should try this first.</p>

<h2>a note on UNION vs UNION ALL</h2>

<p>As several people commented, if you use <code>UNION ALL</code> (as shown above), all rows will be inserted, so in this case, you'd get four rows of <code>data1, data2</code>.  If you omit the <code>ALL</code>, then duplicate rows will be eliminated (and the operation will presumably be a bit slower).  We're using UNION ALL since it more closely matches the semantics of the original post.</p>

<h2>in closing</h2>

<p>P.S.: Please +1 <a href=""https://stackoverflow.com/a/1734067/356895"">andy's reply</a>, not mine!  He presented the solution first.</p>
","5009740"
"How to compare two dates to find time difference in SQL Server 2005, date manipulation","301704","","<p>I have two columns: </p>

<pre><code>job_start                         job_end
2011-11-02 12:20:37.247           2011-11-02 13:35:14.613
</code></pre>

<p>How would it be possible using T-SQL to find the raw amount of time that has passed between when the job started and when the job ended?</p>

<p>I tried this:</p>

<pre><code>select    (job_end - job_start) from tableA
</code></pre>

<p>but ended up with this:</p>

<pre><code>1900-01-01 01:14:37.367
</code></pre>
","<p>Take a look at the <a href=""https://msdn.microsoft.com/en-us/library/ms189794(v=sql.90).aspx"" rel=""nofollow noreferrer""><code>DateDiff()</code></a> function.</p>

<pre><code>-- Syntax
-- DATEDIFF ( datepart , startdate , enddate )

-- Example usage
SELECT DATEDIFF(DAY, GETDATE(), GETDATE() + 1) AS DayDiff
SELECT DATEDIFF(MINUTE, GETDATE(), GETDATE() + 1) AS MinuteDiff
SELECT DATEDIFF(SECOND, GETDATE(), GETDATE() + 1) AS SecondDiff
SELECT DATEDIFF(WEEK, GETDATE(), GETDATE() + 1) AS WeekDiff
SELECT DATEDIFF(HOUR, GETDATE(), GETDATE() + 1) AS HourDiff
...
</code></pre>

<p>You can see it in action / <a href=""https://data.stackexchange.com/stackoverflow/query/62856/datediff-example"" rel=""nofollow noreferrer"">play with it here</a></p>
","9521452"
"Join vs. sub-query","299242","","<p>I am an old-school MySQL user and have always preferred <code>JOIN</code> over sub-query. But nowadays everyone uses sub-query and I hate it, I don't know why.   </p>

<p>I lack the theoretical knowledge to judge for myself if there is any difference.
Is a sub-query as good as a <code>JOIN</code> and therefore there is nothing to worry about?</p>
","<p>Taken from the manual (<a href=""https://dev.mysql.com/doc/refman/5.7/en/rewriting-subqueries.html"" rel=""noreferrer"">13.2.10.11 Rewriting Subqueries as Joins</a>):</p>

<blockquote>
  <p>A LEFT [OUTER] JOIN can be faster than an equivalent subquery because the server might be able to optimize it better—a fact that is not specific to MySQL Server alone.</p>
</blockquote>

<p>So subqueries can be slower than LEFT [OUTER] JOINS, but in my opinion their strength is slightly higher readability.</p>
","39588846"
"MySQL INSERT INTO table VALUES.. vs INSERT INTO table SET","296650","","<p>What is main difference between <code>INSERT INTO table VALUES ..</code> and  <code>INSERT INTO table SET</code>?</p>

<p>Example:</p>

<pre><code>INSERT INTO table (a, b, c) VALUES (1,2,3)

INSERT INTO table SET a=1, b=2, c=3
</code></pre>

<p>And what about performance of these two?</p>
","<p>As far as I can tell, both syntaxes are equivalent. The first is SQL standard, the second is MySQL's extension.</p>

<p>So they should be exactly equivalent performance wise.</p>

<p><a href=""http://dev.mysql.com/doc/refman/5.6/en/insert.html"" rel=""noreferrer"">http://dev.mysql.com/doc/refman/5.6/en/insert.html</a> says:</p>

<blockquote>
  <p>INSERT inserts new rows into an existing table. The INSERT ... VALUES and INSERT ... SET forms of the statement insert rows based on explicitly specified values. The INSERT ... SELECT form inserts rows selected from another table or tables.</p>
</blockquote>
","861729"
"MySQL Insert Where query","295776","","<p>What's wrong with this query: </p>

<pre><code>INSERT INTO Users( weight, desiredWeight ) VALUES ( 160, 145 ) WHERE id = 1;
</code></pre>

<p>It works without the <code>WHERE</code> clause. I've seemed to have forgot my SQL.. </p>
","<p>MySQL <a href=""http://dev.mysql.com/doc/refman/5.5/en/insert.html"" rel=""noreferrer"">INSERT Syntax</a> does not support the WHERE clause so your query as it stands will fail. Assuming your <code>id</code> column is unique or primary key:</p>

<p>If you're trying to insert a new row with ID 1 you should be using:</p>

<pre><code>INSERT INTO Users(id, weight, desiredWeight) VALUES(1, 160, 145);
</code></pre>

<p>If you're trying to change the weight/desiredWeight values for an existing row with ID 1 you should be using:</p>

<pre><code>UPDATE Users SET weight = 160, desiredWeight = 145 WHERE id = 1;
</code></pre>

<p>If you want you can also use INSERT .. ON DUPLICATE KEY syntax like so:</p>

<pre><code>INSERT INTO Users (id, weight, desiredWeight) VALUES(1, 160, 145) ON DUPLICATE KEY UPDATE weight=160, desiredWeight=145
</code></pre>

<p>OR even like so:</p>

<pre><code>INSERT INTO Users SET id=1, weight=160, desiredWeight=145 ON DUPLICATE KEY UPDATE weight=160, desiredWeight=145
</code></pre>

<p>It's also important to note that if your <code>id</code> column is an autoincrement column then you might as well omit it from your INSERT all together and let mysql increment it as normal.</p>
","485062"
"SQL Statement using Where clause with multiple values","295509","","<p>I have a table that has multiple rows with the following fields: </p>

<pre><code>PersonName SongName Status
</code></pre>

<p>I want to use names selected from a multiple selection listbox, which I can retrieve the values, and then do a where clause so it shows the song names that the selected people can all play, therefore status is complete. </p>

<p>For example: </p>

<pre><code> PersonName      SongName    Status 
 Holly           Highland    Complete
 Holly           Mech        Complete 
 Ryan            Highland    Complete
</code></pre>

<p>If I select Holly and Ryan from the list box and press the button the query should just show Highland as that is what they both know.</p>
","<p>Try this:</p>

<pre><code>select songName from t
where personName in ('Ryan', 'Holly')
group by songName
having count(distinct personName) = 2
</code></pre>

<p>The number in the having should match the amount of people. If you also need the Status to be <code>Complete</code> use this <code>where</code> clause instead of the previous one:</p>

<pre><code>where personName in ('Ryan', 'Holly') and status = 'Complete'
</code></pre>
","10012861"
"SQL - Update multiple records in one query","295032","","<p>I have table - <strong>config</strong>.
Schema:
<code>config_name | config_value</code></p>

<p>And I would like to update multiple records in one query. I try like that: </p>

<pre><code>UPDATE config 
SET t1.config_value = 'value'
  , t2.config_value = 'value2' 
WHERE t1.config_name = 'name1' 
  AND t2.config_name = 'name2';
</code></pre>

<p>but that query is wrong :( </p>

<p>Can you help me?</p>
","<p>Try either multi-table update syntax </p>

<pre><code>UPDATE config t1 JOIN config t2
    ON t1.config_name = 'name1' AND t2.config_name = 'name2'
   SET t1.config_value = 'value',
       t2.config_value = 'value2';
</code></pre>

<p>Here is <strong><a href=""http://sqlfiddle.com/#!2/84ef4/1"" rel=""noreferrer"">SQLFiddle</a></strong> demo</p>

<p>or conditional update</p>

<pre><code>UPDATE config
   SET config_value = CASE config_name 
                      WHEN 'name1' THEN 'value' 
                      WHEN 'name2' THEN 'value2' 
                      ELSE config_value
                      END
 WHERE config_name IN('name1', 'name2');
</code></pre>

<p>Here is <strong><a href=""http://sqlfiddle.com/#!2/e820f/1"" rel=""noreferrer"">SQLFiddle</a></strong> demo</p>
","20255203"
"Insert, on duplicate update in PostgreSQL?","294446","","<p>Several months ago I learned from an answer on Stack Overflow how to perform multiple updates at once in MySQL using the following syntax:</p>

<pre><code>INSERT INTO table (id, field, field2) VALUES (1, A, X), (2, B, Y), (3, C, Z)
ON DUPLICATE KEY UPDATE field=VALUES(Col1), field2=VALUES(Col2);
</code></pre>

<p>I've now switched over to PostgreSQL and apparently this is not correct. It's referring to all the correct tables so I assume it's a matter of different keywords being used but I'm not sure where in the PostgreSQL documentation this is covered.</p>

<p>To clarify, I want to insert several things and if they already exist to update them.</p>
","<p>PostgreSQL since version 9.5 has <a href=""http://www.postgresql.org/docs/devel/static/sql-insert.html"" rel=""noreferrer"">UPSERT</a> syntax, with <strong><a href=""http://www.postgresql.org/docs/current/static/sql-insert.html#SQL-ON-CONFLICT"" rel=""noreferrer"">ON CONFLICT</a> clause.</strong> with the following syntax (similar to MySQL)</p>

<pre><code>INSERT INTO the_table (id, column_1, column_2) 
VALUES (1, 'A', 'X'), (2, 'B', 'Y'), (3, 'C', 'Z')
ON CONFLICT (id) DO UPDATE 
  SET column_1 = excluded.column_1, 
      column_2 = excluded.column_2;
</code></pre>

<hr>

<p>Searching postgresql's email group archives for ""upsert"" leads to finding <a href=""http://www.postgresql.org/docs/current/static/plpgsql-control-structures.html#PLPGSQL-UPSERT-EXAMPLE"" rel=""noreferrer"">an example of doing what you possibly want to do, in the manual</a>:</p>

<blockquote>
  <p><strong>Example 38-2. Exceptions with UPDATE/INSERT</strong></p>
  
  <p>This example uses exception handling to perform either UPDATE or INSERT, as appropriate:</p>
</blockquote>

<pre><code>CREATE TABLE db (a INT PRIMARY KEY, b TEXT);

CREATE FUNCTION merge_db(key INT, data TEXT) RETURNS VOID AS
$$
BEGIN
    LOOP
        -- first try to update the key
        -- note that ""a"" must be unique
        UPDATE db SET b = data WHERE a = key;
        IF found THEN
            RETURN;
        END IF;
        -- not there, so try to insert the key
        -- if someone else inserts the same key concurrently,
        -- we could get a unique-key failure
        BEGIN
            INSERT INTO db(a,b) VALUES (key, data);
            RETURN;
        EXCEPTION WHEN unique_violation THEN
            -- do nothing, and loop to try the UPDATE again
        END;
    END LOOP;
END;
$$
LANGUAGE plpgsql;

SELECT merge_db(1, 'david');
SELECT merge_db(1, 'dennis');
</code></pre>

<hr>

<p>There's possibly an example of how to do this in bulk, using CTEs in 9.1 and above, in the <a href=""http://archives.postgresql.org/pgsql-hackers/2011-06/msg01826.php"" rel=""noreferrer"">hackers mailing list</a>:</p>

<pre><code>WITH foos AS (SELECT (UNNEST(%foo[])).*)
updated as (UPDATE foo SET foo.a = foos.a ... RETURNING foo.id)
INSERT INTO foo SELECT foos.* FROM foos LEFT JOIN updated USING(id)
WHERE updated.id IS NULL;
</code></pre>

<p>See <a href=""https://stackoverflow.com/a/8702291/642706"">a_horse_with_no_name's answer</a> for a clearer example.</p>
","1109198"
"How can i introduce multiple conditions in LIKE operator","294266","","<p>I want to write an SQL statement like below:</p>

<pre><code>select * from tbl where col like ('ABC%','XYZ%','PQR%');
</code></pre>

<p>I know it can be done using <code>OR</code>. But I want to know is there any better solution.</p>
","<p>Here is an alternative way:</p>

<pre><code>select * from tbl where col like 'ABC%'
union
select * from tbl where col like 'XYZ%'
union
select * from tbl where col like 'PQR%';
</code></pre>

<p>Here is the test code to verify:</p>

<pre><code>create table tbl (col varchar(255));
insert into tbl (col) values ('ABCDEFG'), ('HIJKLMNO'), ('PQRSTUVW'), ('XYZ');
select * from tbl where col like 'ABC%'
union
select * from tbl where col like 'XYZ%'
union
select * from tbl where col like 'PQR%';
+----------+
| col      |
+----------+
| ABCDEFG  |
| XYZ      |
| PQRSTUVW |
+----------+
3 rows in set (0.00 sec)
</code></pre>
","1387627"
"Search All Fields In All Tables For A Specific Value (Oracle)","294261","","<p>Is it possible to search every field of every table for a particular value in Oracle?</p>

<p>There are hundreds of tables with thousands of rows in some tables so I know this could take a very long time to query. But the only thing I know is that a value for the field I would like to query against is <code>1/22/2008P09RR8</code>.
&lt;</p>

<p>I've tried using this statement below to find an appropriate column based on what I think it should be named but it returned no results.</p>

<pre><code>SELECT * from dba_objects 
WHERE object_name like '%DTN%'
</code></pre>

<p>There is absolutely no documentation on this database and I have no idea where this field is being pulled from.</p>

<p>Any thoughts?</p>
","<p>Quote:</p>

<blockquote>
  <p>I've tried using this statement below
  to find an appropriate column based on
  what I think it should be named but it
  returned no results.*</p>

<pre><code>SELECT * from dba_objects WHERE
object_name like '%DTN%'
</code></pre>
</blockquote>

<p>A column isn't an object.  If you mean that you expect the column name to be like '%DTN%', the query you want is:</p>

<pre><code>SELECT owner, table_name, column_name FROM all_tab_columns WHERE column_name LIKE '%DTN%';
</code></pre>

<p>But if the 'DTN' string is just a guess on your part, that probably won't help.</p>

<p>By the way, how certain are you that '1/22/2008P09RR8' is a value selected directly from a single column?  If you don't know at all where it is coming from, it could be a concatenation of several columns, or the result of some function, or a value sitting in a nested table object.  So you might be on a wild goose chase trying to check every column for that value.  Can you not start with whatever client application is displaying this value and try to figure out what query it is using to obtain it?</p>

<p>Anyway, diciu's answer gives one method of generating SQL queries to check every column of every table for the value.  You can also do similar stuff entirely in one SQL session using a PL/SQL block and dynamic SQL.  Here's some hastily-written code for that:</p>

<pre><code>    SET SERVEROUTPUT ON SIZE 100000

    DECLARE
      match_count INTEGER;
    BEGIN
      FOR t IN (SELECT owner, table_name, column_name
                  FROM all_tab_columns
                  WHERE owner &lt;&gt; 'SYS' and data_type LIKE '%CHAR%') LOOP

        EXECUTE IMMEDIATE
          'SELECT COUNT(*) FROM ' || t.owner || '.' || t.table_name ||
          ' WHERE '||t.column_name||' = :1'
          INTO match_count
          USING '1/22/2008P09RR8';

        IF match_count &gt; 0 THEN
          dbms_output.put_line( t.table_name ||' '||t.column_name||' '||match_count );
        END IF;

      END LOOP;

    END;
    /
</code></pre>

<p>There are some ways you could make it more efficient too.</p>

<p>In this case, given the value you are looking for, you can clearly eliminate any column that is of NUMBER or DATE type, which would reduce the number of queries.  Maybe even restrict it to columns where type is like '%CHAR%'.</p>

<p>Instead of one query per column, you could build one query per table like this:</p>

<pre><code>SELECT * FROM table1
  WHERE column1 = 'value'
     OR column2 = 'value'
     OR column3 = 'value'
     ...
     ;
</code></pre>
","208892"
"Counting DISTINCT over multiple columns","294095","","<p>Is there a better way of doing a query like this:</p>

<pre><code>SELECT COUNT(*) 
FROM (SELECT DISTINCT DocumentId, DocumentSessionId
      FROM DocumentOutputItems) AS internalQuery
</code></pre>

<p>I need to count the number of distinct items from this table but the distinct is over two columns.</p>

<p>My query works fine but I was wondering if I can get the final result using just one query (without using a sub-query)</p>
","<p>If you are trying to improve performance, you could try creating a persisted computed column on either a hash or concatenated value of the two columns.</p>

<p>Once it is persisted,  provided the column is deterministic and you are using ""sane"" database settings, it can be indexed and / or statistics can be created on it. </p>

<p>I believe a distinct count of the computed column would be equivalent to your query.</p>
","1480381"
"how to check if table exist and if it doesn't exist create table in sql server 2008","292513","","<p>I am writing a <code>Stored procedure</code> in sql server 2008
I need to check if a <code>table</code> exist in the DB, if it doesn't then I need to create it.</p>

<p>How do I do it?</p>
","<p>Something like this</p>

<pre><code>IF  NOT EXISTS (SELECT * FROM sys.objects 
WHERE object_id = OBJECT_ID(N'[dbo].[YourTable]') AND type in (N'U'))

BEGIN
CREATE TABLE [dbo].[YourTable](
    ....
    ....
    ....
) 

END
</code></pre>
","5952051"
"SQL Server 2008: how do I grant privileges to a username?","291044","","<p>I need to be able to establish an ODBC connection through SQL Server authentication. </p>

<p>In SSMS how do I grant permission for a user to be able to have ALL RIGHTS on a specific database?</p>

<p>is there a way to do this graphically with SSMS?</p>
","<p>If you want to give your user all read permissions, you could use:</p>

<pre><code>EXEC sp_addrolemember N'db_datareader', N'your-user-name'
</code></pre>

<p>That adds the default <code>db_datareader</code> role (read permission on all tables) to that user.</p>

<p>There's also a <code>db_datawriter</code> role - which gives your user all WRITE permissions (INSERT, UPDATE, DELETE) on all tables:</p>

<pre><code>EXEC sp_addrolemember N'db_datawriter', N'your-user-name'
</code></pre>

<p>If you need to be more granular, you can use the <code>GRANT</code> command:</p>

<pre><code>GRANT SELECT, INSERT, UPDATE ON dbo.YourTable TO YourUserName
GRANT SELECT, INSERT ON dbo.YourTable2 TO YourUserName
GRANT SELECT, DELETE ON dbo.YourTable3 TO YourUserName
</code></pre>

<p>and so forth - you can granularly give SELECT, INSERT, UPDATE, DELETE permission on specific tables.</p>

<p>This is all very well documented in the <a href=""http://msdn.microsoft.com/en-us/library/ms187965.aspx"">MSDN Books Online for SQL Server</a>.</p>

<p>And yes, you can also do it graphically - in SSMS, go to your database, then <code>Security &gt; Users</code>, right-click on that user you want to give permissions to, then <code>Properties</code> adn at the bottom you see ""Database role memberships"" where you can add the user to db roles.</p>

<p><img src=""https://i.stack.imgur.com/glrrj.png"" alt=""alt text""></p>
","3998649"
"What's the difference between RANK() and DENSE_RANK() functions in oracle?","290873","","<p>What's the difference between <code>RANK()</code> and <code>DENSE_RANK()</code> functions? How to find out nth salary in the following <code>emptbl</code> table?</p>

<pre><code>DEPTNO  EMPNAME    SAL
------------------------------
10       rrr    10000.00
11       nnn    20000.00
11       mmm    5000.00
12       kkk    30000.00
10       fff    40000.00
10       ddd    40000.00
10       bbb    50000.00
10       ccc    50000.00
</code></pre>

<p>If in the table data having <code>nulls</code>, what will happen if I want to find out <code>nth</code> salary?</p>
","<p>RANK gives you the ranking within your ordered partition. Ties are assigned the same rank, with the next ranking(s) skipped. So, if you have 3 items at rank 2, the next rank listed would be ranked 5.</p>

<p>DENSE_RANK again gives you the ranking within your ordered partition, but the ranks are consecutive. No ranks are skipped if there are ranks with multiple items.</p>

<p>As for nulls, it depends on the ORDER BY clause. Here is a simple test script you can play with to see what happens:</p>

<pre><code>with q as (
select 10 deptno, 'rrr' empname, 10000.00 sal from dual union all
select 11, 'nnn', 20000.00 from dual union all
select 11, 'mmm', 5000.00 from dual union all
select 12, 'kkk', 30000 from dual union all
select 10, 'fff', 40000 from dual union all
select 10, 'ddd', 40000 from dual union all
select 10, 'bbb', 50000 from dual union all
select 10, 'xxx', null from dual union all
select 10, 'ccc', 50000 from dual)
select empname, deptno, sal
     , rank() over (partition by deptno order by sal nulls first) r
     , dense_rank() over (partition by deptno order by sal nulls first) dr1
     , dense_rank() over (partition by deptno order by sal nulls last) dr2
 from q; 

EMP     DEPTNO        SAL          R        DR1        DR2
--- ---------- ---------- ---------- ---------- ----------
xxx         10                     1          1          4
rrr         10      10000          2          2          1
fff         10      40000          3          3          2
ddd         10      40000          3          3          2
ccc         10      50000          5          4          3
bbb         10      50000          5          4          3
mmm         11       5000          1          1          1
nnn         11      20000          2          2          2
kkk         12      30000          1          1          1

9 rows selected.
</code></pre>

<p><a href=""http://www.oracle-base.com/articles/misc/rank-dense-rank-first-last-analytic-functions.php"" rel=""noreferrer"">Here's a link</a> to a good explanation and some examples.</p>
","11183610"
"concatenate two database columns into one resultset column","290191","","<p>I use the following SQL to concatenate several database columns from one table into one column in the result set:</p>

<p><code>SELECT (field1 + '' + field2 + '' + field3) FROM table1</code></p>

<p>When one of the fields is null I got null result for the whole concatenation expression. How can I overcome this?</p>

<p>The database is MS SQL Server 2008. By the way, is this the best way to concatenate database columns? Is there any standard SQL doing this?</p>
","<p>The SQL standard way of doing this would be:</p>

<pre><code>SELECT COALESCE(field1, '') || COALESCE(field2, '') || COALESCE(field3, '') FROM table1
</code></pre>

<p>Example:</p>

<pre><code>INSERT INTO table1 VALUES ('hello', null, 'world');
SELECT COALESCE(field1, '') || COALESCE(field2, '') || COALESCE(field3, '') FROM table1;

helloworld
</code></pre>
","6427807"
"How do I get textual contents from BLOB in Oracle SQL","288748","","<p>I am trying to see from an SQL console what is inside an Oracle BLOB.</p>

<p>I know it contains a somewhat large body of text and I want to just see the text, but the following query only indicates that there is a BLOB in that field:</p>

<pre><code>select BLOB_FIELD from TABLE_WITH_BLOB where ID = '&lt;row id&gt;';
</code></pre>

<p>the result I'm getting is not quite what I expected:</p>

<pre>
    BLOB_FIELD
    -----------------------
    oracle.sql.BLOB@1c4ada9
</pre>

<p>So what kind of magic incantations can I do to turn the BLOB into it's textual representation?</p>

<p>PS: I am just trying to look at the content of the BLOB from an SQL console (Eclipse Data Tools), not use it in code.</p>
","<p>First of all, you may want to store text in CLOB/NCLOB columns instead of BLOB, which is designed for binary data (your query would work with a CLOB, by the way).</p>

<p>The following query will let you see the first 32767 characters (at most) of the text inside the blob, provided all the character sets are compatible (original CS of the text stored in the BLOB, CS of the database used for VARCHAR2) :</p>

<pre><code>select utl_raw.cast_to_varchar2(dbms_lob.substr(BLOB_FIELD)) from TABLE_WITH_BLOB where ID = '&lt;row id&gt;';
</code></pre>
","828834"
"How to replace specific values in a oracle database column?","288696","","<p>I am looking to replace values in a particular column. For example the following column values</p>

<pre><code>column name
----------
Test1
Test2
Test3
Test12
</code></pre>

<p>should be (replacing <code>est1</code> with <code>rest1</code>)</p>

<pre><code>column name
----------
Trest1
Test2
Test3
Trest12
</code></pre>
","<p>Use <a href=""http://techonthenet.com/oracle/functions/replace.php"" rel=""noreferrer"">REPLACE</a>:</p>

<pre><code>SELECT REPLACE(t.column, 'est1', 'rest1')
  FROM MY_TABLE t
</code></pre>

<p>If you want to update the values in the table, use:</p>

<pre><code>UPDATE MY_TABLE t
   SET column = REPLACE(t.column, 'est1', 'rest1')
</code></pre>
","3443182"
"What is the simplest SQL Query to find the second largest value?","288696","","<p>What is the simplest SQL query to find the second largest integer value in a specific column? </p>

<p>There are maybe duplicate values in the column.</p>
","<pre><code>SELECT MAX( col )
  FROM table
 WHERE col &lt; ( SELECT MAX( col )
                 FROM table )
</code></pre>
","32111"
"SQL Server: Get table primary key using sql query","288163","","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""https://stackoverflow.com/questions/95967/how-do-you-list-the-primary-key-of-a-sql-server-table"">How do you list the primary key of a SQL Server table?</a>  </p>
</blockquote>



<p>I want to get a particular table's primary key using SQL query for <strong>SQL Server</strong> database.</p>

<p>In <strong>MySQL</strong> I am using following query to get table primary key:</p>

<pre><code>SHOW KEYS FROM tablename WHERE Key_name = 'PRIMARY'
</code></pre>

<p>What is equivalent of above query for <strong>SQL Server</strong> ?.</p>

<p>If There is a query that will work for both <strong>MySQL</strong> and <strong>SQL Server</strong> then It will be an ideal case.</p>
","<p>Found another one:</p>

<pre><code>SELECT KU.table_name as TABLENAME,column_name as PRIMARYKEYCOLUMN
FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS AS TC
INNER JOIN
    INFORMATION_SCHEMA.KEY_COLUMN_USAGE AS KU
          ON TC.CONSTRAINT_TYPE = 'PRIMARY KEY' AND
             TC.CONSTRAINT_NAME = KU.CONSTRAINT_NAME AND 
             KU.table_name='yourTableName'
ORDER BY KU.TABLE_NAME, KU.ORDINAL_POSITION;
</code></pre>

<p>I have tested this on SQL Server 2003/2005</p>
","3942921"
"SQL Server Operating system error 5: ""5(Access is denied.)""","287785","","<p>I am starting to learn SQL and I have a book that provides a database to work on. These files below are in the directory but the problem is that when I run the query, it gives me this error:</p>

<blockquote>
  <p>Msg 5120, Level 16, State 101, Line 1 Unable to open the physical file
  ""C:\Murach\SQL Server 2008\Databases\AP.mdf"". Operating system error
  5: ""5(Access is denied.)"".</p>
</blockquote>

<pre><code>   CREATE DATABASE AP
      ON PRIMARY (FILENAME = 'C:\Murach\SQL Server 2008\Databases\AP.mdf')
      LOG ON (FILENAME =     'C:\Murach\SQL Server 2008\Databases\AP_log.ldf')
      FOR ATTACH
    GO
</code></pre>

<p>In the book the author says it should work, but it is not working in my case. I searched but I do not know exactly what the problem is, so I posted this question.</p>
","<p>SQL Server database engine service account must have permissions to read/write in the new folder.</p>

<p>Check out <a href=""http://dbamohsin.wordpress.com/2009/06/03/attaching-database-unable-to-open-physical-file-access-is-denied/"" rel=""noreferrer"">this</a></p>

<blockquote>
  <p>To fix, I did the following:</p>
  
  <p>Added the Administrators Group to the file security permissions with
  full control for the Data file (S:) and the Log File (T:).</p>
  
  <p>Attached the database and it works fine.</p>
</blockquote>

<p><a href=""https://i.stack.imgur.com/i8VlC.png"" rel=""noreferrer""><img src=""https://i.stack.imgur.com/i8VlC.png"" alt=""enter image description here""></a></p>

<p><a href=""https://i.stack.imgur.com/PNUhP.png"" rel=""noreferrer""><img src=""https://i.stack.imgur.com/PNUhP.png"" alt=""enter image description here""></a></p>
","18286808"
"Drop a temporary table if it exists","287012","","<p>I have two lines of code in SQL that create two tables on the fly, i need to do something like</p>

<pre><code>IF TABLE EXISTS 
    DROP IT AND CREATE IT AGAIN
ELSE
    CREATE IT
</code></pre>

<p>my lines are the following ones</p>

<pre><code>CREATE TABLE ##CLIENTS_KEYWORD(client_id int)     
CREATE TABLE ##TEMP_CLIENTS_KEYWORD(client_id int)   
</code></pre>

<p>how can I apply that concept for these two tables in my procedure?</p>
","<p>From SQL Server 2016 you can just use</p>

<pre><code> DROP TABLE IF EXISTS ##CLIENTS_KEYWORD
</code></pre>

<p>On previous versions you can use</p>

<pre><code>IF OBJECT_ID('tempdb..##CLIENTS_KEYWORD') IS NOT NULL
  /*Then it exists*/
  DROP TABLE ##CLIENTS_KEYWORD

CREATE TABLE ##CLIENTS_KEYWORD
  (
     client_id INT
  ) 
</code></pre>

<p>You could also consider truncating the table instead rather than dropping and recreating.</p>

<pre><code>IF OBJECT_ID('tempdb..##CLIENTS_KEYWORD') IS NOT NULL
  TRUNCATE TABLE ##CLIENTS_KEYWORD
ELSE
  CREATE TABLE ##CLIENTS_KEYWORD
    (
       client_id INT
    ) 
</code></pre>
","7259329"
"How can I query a value in SQL Server XML column","286916","","<p>I have following XML stored in a XML column (called <code>Roles</code>) in a SQL Server database.</p>

<pre><code>&lt;root&gt;
   &lt;role&gt;Alpha&lt;/role&gt;
   &lt;role&gt;Beta&lt;/role&gt;
   &lt;role&gt;Gamma&lt;/role&gt;
&lt;/root&gt;
</code></pre>

<p>I'd like to list all rows that have a specific role in them. This role passed by parameter.</p>
","<pre><code>select
  Roles
from
  MyTable
where
  Roles.value('(/root/role)[1]', 'varchar(max)') like 'StringToSearchFor'
</code></pre>

<p>These pages will show you more about how to query XML in T-SQL:</p>

<p><a href=""http://www.brokenwire.net/bw/Programming/125/querying-xml-fields-using-t-sql"">Querying XML fields using t-sql</a></p>

<p><a href=""http://blogs.msdn.com/b/simonince/archive/2009/04/24/flattening-xml-data-in-sql-server.aspx"">Flattening XML Data in SQL Server</a></p>

<p><strong>EDIT</strong></p>

<p>After playing with it a little bit more, I ended up with this amazing query that uses <a href=""http://msdn.microsoft.com/en-us/library/ms175156.aspx"">CROSS APPLY</a>. This one will search every row (role) for the value you put in your like expression...</p>

<p>Given this table structure:</p>

<pre><code>create table MyTable (Roles XML)

insert into MyTable values
('&lt;root&gt;
   &lt;role&gt;Alpha&lt;/role&gt;
   &lt;role&gt;Gamma&lt;/role&gt;
   &lt;role&gt;Beta&lt;/role&gt;
&lt;/root&gt;')
</code></pre>

<p>We can query it like this:</p>

<pre><code>select * from 

(select 
       pref.value('(text())[1]', 'varchar(32)') as RoleName
from 
       MyTable CROSS APPLY

       Roles.nodes('/root/role') AS Roles(pref)
)  as Result

where RoleName like '%ga%'
</code></pre>

<p>You can check the SQL Fiddle here: <a href=""http://sqlfiddle.com/#!3/ae0d5/13"">http://sqlfiddle.com/#!3/ae0d5/13</a></p>
","10344601"
"How to use NULL or empty string in SQL","286771","","<p>I would like to know how to use NULL and an empty string at the same time in a <code>WHERE</code> clause in SQL Server. I need to find records that have either null values or an empty string. Thanks.</p>
","<pre><code>Select *
From Table
Where (col is null or col = '')
</code></pre>

<p>Or</p>

<pre><code>Select *
From Table
Where IsNull(col, '') = ''
</code></pre>
","15663302"
"What is the difference between JOIN and UNION?","286764","","<p>What is the difference between <code>JOIN</code> and <code>UNION</code>? Can I have an example?</p>
","<p><code>UNION</code> puts lines from queries after each other, while <code>JOIN</code> makes a cartesian product and subsets it -- completely different operations. Trivial example of <code>UNION</code>:</p>

<pre><code>mysql&gt; SELECT 23 AS bah
    -&gt; UNION
    -&gt; SELECT 45 AS bah;
+-----+
| bah |
+-----+
|  23 | 
|  45 | 
+-----+
2 rows in set (0.00 sec)
</code></pre>

<p>similary trivial example of <code>JOIN</code>:</p>

<pre><code>mysql&gt; SELECT * FROM 
    -&gt; (SELECT 23 AS bah) AS foo 
    -&gt; JOIN 
    -&gt; (SELECT 45 AS bah) AS bar
    -&gt; ON (33=33);
+-----+-----+
| foo | bar |
+-----+-----+
|  23 |  45 | 
+-----+-----+
1 row in set (0.01 sec)
</code></pre>
","905383"
"How to query a CLOB column in Oracle","285932","","<p>I'm trying to run a query that has a few columns that are a CLOB datatype. If i run the query like normal, all of those fields just have <code>(CLOB)</code> as the value.</p>

<p>I tried using <code>DBMS_LOB.substr(column</code>) and i get the error </p>

<pre><code>ORA-06502: PL/SQL: numeric or value error: character string buffer too small
</code></pre>

<p>How can i query the CLOB column?</p>
","<p>When getting the substring of a CLOB column and using a query tool that has size/buffer restrictions sometimes you would need to set the BUFFER to a larger size. For example while using SQL Plus use the <code>SET BUFFER 10000</code> to set it to 10000 as the default is 4000.</p>

<p>Running the <code>DBMS_LOB.substr</code> command you can also specify the amount of characters you want to return and the offset from which. So using <code>DBMS_LOB.substr(column, 3000)</code> might restrict it to a small enough amount for the buffer.</p>

<p>See <a href=""http://download-west.oracle.com/docs/cd/A87860_01/doc/appdev.817/a76936/dbms_lo2.htm#1009072"" rel=""noreferrer"">oracle documentation</a> for more info on the substr command</p>

<pre>

    DBMS_LOB.SUBSTR (
       lob_loc     IN    CLOB   CHARACTER SET ANY_CS,
       amount      IN    INTEGER := 32767,
       offset      IN    INTEGER := 1)
      RETURN VARCHAR2 CHARACTER SET lob_loc%CHARSET;

</pre>
","3790523"
"SELECT DISTINCT on one column","284643","","<p>Using SQL Server, I have...</p>

<pre><code>ID  SKU PRODUCT
=======================
1   FOO-23  Orange
2   BAR-23  Orange
3   FOO-24  Apple
4   FOO-25  Orange
</code></pre>

<p>I want </p>

<pre><code>1   FOO-23  Orange
3   FOO-24  Apple
</code></pre>

<p>This query isn't getting me there. How can I SELECT DISTINCT on just one column?</p>

<pre><code>SELECT 
[ID],[SKU],[PRODUCT]
FROM [TestData] 
WHERE ([PRODUCT] = 
(SELECT DISTINCT [PRODUCT] FROM [TestData] WHERE ([SKU] LIKE 'FOO-%')) 
ORDER BY [ID]
</code></pre>
","<p>Assuming that you're on SQL Server 2005 or greater, you can use a CTE with ROW_NUMBER():</p>

<pre><code>SELECT  *
FROM    (SELECT ID, SKU, Product,
                ROW_NUMBER() OVER (PARTITION BY PRODUCT ORDER BY ID) AS RowNumber
         FROM   MyTable
         WHERE  SKU LIKE 'FOO%') AS a
WHERE   a.RowNumber = 1
</code></pre>
","966215"
"Remove duplicate rows in MySQL","284453","","<p>I have a table with the following fields:</p>

<pre><code>id (Unique)
url (Unique)
title
company
site_id
</code></pre>

<p>Now, I need  to remove rows having same title, company and site_id. One way to do it will be using the following SQL along with a script (PHP):</p>

<pre><code>SELECT title, site_id, location, id, count( * ) 
FROM jobs
GROUP BY site_id, company, title, location
HAVING count( * ) &gt;1
</code></pre>

<p>After running this query, I can remove duplicates using a server side script.
But, I want to know if this can be done only using SQL query.</p>
","<p>A really easy way to do this is to add a <code>UNIQUE</code> index on the 3 columns.  When you write the <code>ALTER</code> statement, include the <code>IGNORE</code> keyword.  Like so:</p>

<pre><code>ALTER IGNORE TABLE jobs
ADD UNIQUE INDEX idx_name (site_id, title, company);
</code></pre>

<p>This will drop all the duplicate rows.  As an added benefit, future <code>INSERTs</code> that are duplicates will error out.  As always, you may want to take a backup before running something like this...</p>
","3312066"
"SQL JOIN and different types of JOINs","284335","","<p>I have been going through many threads on <strong>SO</strong> and some other forums. So I thought I would summarize ""<strong>What is SQL JOIN?</strong>"" and ""<strong>What are different types of SQL JOINs?</strong>"".</p>
","<h1>What is <code>SQL JOIN</code> ?</h1>

<p><code>SQL JOIN</code> is a method to retrieve data from two or more database tables.</p>

<h1>What are the different <code>SQL JOIN</code>s ?</h1>

<p>There are a total of five <code>JOIN</code>s. They are :</p>

<pre><code>  1. JOIN or INNER JOIN
  2. OUTER JOIN

     2.1 LEFT OUTER JOIN or LEFT JOIN
     2.2 RIGHT OUTER JOIN or RIGHT JOIN
     2.3 FULL OUTER JOIN or FULL JOIN

  3. NATURAL JOIN
  4. CROSS JOIN
  5. SELF JOIN
</code></pre>

<h2>1. JOIN or INNER JOIN :</h2>

<p>In this kind of a <code>JOIN</code>, we get all records that match the condition in both the tables,
and records in both the tables that do not match are not reported.</p>

<p>In other words, <code>INNER JOIN</code> is based on the single fact that : ONLY the matching entries in BOTH the tables SHOULD be listed.</p>

<p>Note that a <code>JOIN</code> without any other <code>JOIN</code> keywords (like <code>INNER</code>, <code>OUTER</code>, <code>LEFT</code>, etc) is an <code>INNER JOIN</code>. In other words, <code>JOIN</code> is
a Syntactic sugar for <code>INNER JOIN</code> (see : <a href=""https://stackoverflow.com/questions/565620/difference-between-join-and-inner-join"">Difference between JOIN and INNER JOIN</a>).</p>

<h2>2. OUTER JOIN :</h2>

<p><code>OUTER JOIN</code> retrieves</p>

<p>Either,
       the matched rows from one table and all rows in the other table
     Or,
       all rows in all tables (it doesn't matter whether or not there is a match).</p>

<p>There are three kinds of Outer Join :</p>

<p><strong>2.1 LEFT OUTER JOIN or LEFT JOIN</strong></p>

<p>This join returns all the rows from the left table in conjunction with the matching rows from the
     right table. If there are no columns matching in the right table, it returns <code>NULL</code> values.</p>

<p><strong>2.2 RIGHT OUTER JOIN or RIGHT JOIN</strong></p>

<p>This <code>JOIN</code> returns all the rows from the right table in conjunction with the matching rows from the
     left table. If there are no columns matching in the left table, it returns <code>NULL</code> values.</p>

<p><strong>2.3 FULL OUTER JOIN or FULL JOIN</strong> </p>

<p>This <code>JOIN</code> combines <code>LEFT OUTER JOIN</code> and <code>RIGHT OUTER JOIN</code>. It returns row from either table when the
     conditions are met and returns <code>NULL</code> value when there is no match.</p>

<p>In other words, <code>OUTER JOIN</code> is based on the fact that : ONLY the matching entries in ONE OF the tables (RIGHT or LEFT)
or BOTH of the tables(FULL) SHOULD be listed.</p>

<pre><code>Note that `OUTER JOIN` is a loosened form of `INNER JOIN`.
</code></pre>

<h2>3. NATURAL JOIN :</h2>

<p>It is based on the two conditions :</p>

<ol>
<li>the <code>JOIN</code> is made on all the columns with the same name for equality.</li>
<li>Removes duplicate columns from the result.</li>
</ol>

<p>This seems to be more of theoretical in nature and as a result (probably) most DBMS 
don't even bother supporting this.</p>

<h2>4. CROSS JOIN :</h2>

<p>It is the Cartesian product of the two tables involved. The result of a <code>CROSS JOIN</code> will not make sense
in most of the situations. Moreover, we wont need this at all (or needs the least, to be precise).</p>

<h2>5. SELF JOIN :</h2>

<p>It is not a different form of <code>JOIN</code>, rather it is a <code>JOIN</code> (<code>INNER</code>, <code>OUTER</code>, etc) of a table to itself.</p>

<h1>JOINs based on Operators</h1>

<p>Depending on the operator used for a <code>JOIN</code> clause, there can be two types of <code>JOIN</code>s. They are</p>

<ol>
<li>Equi JOIN</li>
<li>Theta JOIN</li>
</ol>

<h2>1. Equi JOIN :</h2>

<p>For whatever <code>JOIN</code> type (<code>INNER</code>, <code>OUTER</code>, etc), if we use ONLY the equality operator (=), then we say that
the <code>JOIN</code> is an <code>EQUI JOIN</code>.</p>

<h2>2. Theta JOIN :</h2>

<p>This is same as <code>EQUI JOIN</code> but it allows all other operators like >, &lt;, >= etc.</p>

<blockquote>
  <p>Many consider both <code>EQUI JOIN</code> and Theta <code>JOIN</code> similar to <code>INNER</code>, <code>OUTER</code>
  etc <code>JOIN</code>s. But I strongly believe that its a mistake and makes the
  ideas vague. Because <code>INNER JOIN</code>, <code>OUTER JOIN</code> etc are all connected with
  the tables and their data where as <code>EQUI JOIN</code> and <code>THETA JOIN</code> are only
  connected with the operators we use in the former.</p>
  
  <p>Again, there are many who consider <code>NATURAL JOIN</code> as some sort of
  ""peculiar"" <code>EQUI JOIN</code>. In fact, it is true, because of the first
  condition I mentioned for <code>NATURAL JOIN</code>. However, we dont have to
  restrict that simply to <code>NATURAL JOIN</code>s alone. <code>INNER JOIN</code>s, <code>OUTER JOIN</code>s
  etc could be an <code>EQUI JOIN</code> too.</p>
</blockquote>
","17946222"
"How to retrieve the current value of an oracle sequence without increment it?","283976","","<p>Is there an SQL instruction to retrieve the value of a sequence that does not increment it.</p>

<p>Thanks.</p>

<p><strong>EDIT AND CONCLUSION</strong> </p>

<p>As stated by Justin Cave It's not useful to try to ""save"" sequence number so</p>

<pre><code>select a_seq.nextval from dual;
</code></pre>

<p>is good enough to check a sequence value.</p>

<p>I still keep Ollie answer as the good one because it answered the initial question. but ask yourself about the necessity of not modifying the sequence if you ever want to do it.</p>
","<pre><code>SELECT last_number
  FROM all_sequences
 WHERE sequence_owner = '&lt;sequence owner&gt;'
   AND sequence_name = '&lt;sequence_name&gt;';
</code></pre>

<p>You can get a variety of sequence metadata from <code>user_sequences</code>, <code>all_sequences</code> and <code>dba_sequences</code>.</p>

<p>These views work across sessions.</p>

<p><strong>EDIT:</strong></p>

<p>If the sequence is in your default schema then:</p>

<pre><code>SELECT last_number
  FROM user_sequences
 WHERE sequence_name = '&lt;sequence_name&gt;';
</code></pre>

<p>If you want all the metadata then:</p>

<pre><code>SELECT *
  FROM user_sequences
 WHERE sequence_name = '&lt;sequence_name&gt;';
</code></pre>

<p>Hope it helps...</p>

<p><strong>EDIT2:</strong></p>

<p>A long winded way of doing it more reliably if your cache size is not 1 would be:</p>

<pre><code>SELECT increment_by I
  FROM user_sequences
 WHERE sequence_name = 'SEQ';

      I
-------
      1

SELECT seq.nextval S
  FROM dual;

      S
-------
   1234

-- Set the sequence to decrement by 
-- the same as its original increment
ALTER SEQUENCE seq 
INCREMENT BY -1;

Sequence altered.

SELECT seq.nextval S
  FROM dual;

      S
-------
   1233

-- Reset the sequence to its original increment
ALTER SEQUENCE seq 
INCREMENT BY 1;

Sequence altered.
</code></pre>

<p>Just beware that if others are using the sequence during this time - they (or you) may get </p>

<pre><code>ORA-08004: sequence SEQ.NEXTVAL goes below the sequences MINVALUE and cannot be instantiated
</code></pre>

<p>Also, you might want to set the cache to <code>NOCACHE</code> prior to the resetting and then back to its original value afterwards to make sure you've not cached a lot of values.</p>
","10210308"
"Parameterize an SQL IN clause","283276","","<p>How do I parameterize a query containing an <code>IN</code> clause with a variable number of arguments, like this one?</p>

<pre><code>SELECT * FROM Tags 
WHERE Name IN ('ruby','rails','scruffy','rubyonrails')
ORDER BY Count DESC
</code></pre>

<p>In this query, the number of arguments could be anywhere from 1 to 5.</p>

<p>I would prefer not to use a dedicated stored procedure for this (or XML), but if there is some elegant way specific to <a href=""http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2008"" rel=""noreferrer"">SQL Server 2008</a>, I am open to that.</p>
","<p>Here's a quick-and-dirty technique I have used:</p>

<pre><code>SELECT * FROM Tags
WHERE '|ruby|rails|scruffy|rubyonrails|'
LIKE '%|' + Name + '|%'
</code></pre>

<p>So here's the C# code:</p>

<pre><code>string[] tags = new string[] { ""ruby"", ""rails"", ""scruffy"", ""rubyonrails"" };
const string cmdText = ""select * from tags where '|' + @tags + '|' like '%|' + Name + '|%'"";

using (SqlCommand cmd = new SqlCommand(cmdText)) {
   cmd.Parameters.AddWithValue(""@tags"", string.Join(""|"", tags);
}
</code></pre>

<p>Two caveats:</p>

<ul>
<li>The performance is terrible. <code>LIKE ""%...%""</code> queries are not indexed.</li>
<li>Make sure you don't have any <code>|</code>, blank, or null tags or this won't work</li>
</ul>

<p>There are other ways to accomplish this that some people may consider cleaner, so please keep reading.</p>
","337817"
"MySQL - Get row number on select","281611","","<p>Can I run a select statement and get the row number if the items are sorted?</p>

<p>I have a table like this:</p>

<pre><code>mysql&gt; describe orders;
+-------------+---------------------+------+-----+---------+----------------+
| Field       | Type                | Null | Key | Default | Extra          |
+-------------+---------------------+------+-----+---------+----------------+
| orderID     | bigint(20) unsigned | NO   | PRI | NULL    | auto_increment |
| itemID      | bigint(20) unsigned | NO   |     | NULL    |                |
+-------------+---------------------+------+-----+---------+----------------+
</code></pre>

<p>I can then run this query to get the number of orders by ID:</p>

<pre><code>SELECT itemID, COUNT(*) as ordercount
FROM orders
GROUP BY itemID ORDER BY ordercount DESC;
</code></pre>

<p>This gives me a count of each <code>itemID</code> in the table like this:</p>

<pre><code>+--------+------------+
| itemID | ordercount |
+--------+------------+
|    388 |          3 |
|    234 |          2 |
|   3432 |          1 |
|    693 |          1 |
|   3459 |          1 |
+--------+------------+
</code></pre>

<p>I want to get the row number as well, so I could tell that <code>itemID=388</code> is the first row, <code>234</code> is second, etc (essentially the ranking of the orders, not just a raw count). I know I can do this in Java when I get the result set back, but I was wondering if there was a way to handle it purely in SQL.</p>

<p><strong>Update</strong></p>

<p>Setting the rank adds it to the result set, but not properly ordered:</p>

<pre><code>mysql&gt; SET @rank=0;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; SELECT @rank:=@rank+1 AS rank, itemID, COUNT(*) as ordercount
    -&gt; FROM orders
    -&gt; GROUP BY itemID ORDER BY rank DESC;
+------+--------+------------+
| rank | itemID | ordercount |
+------+--------+------------+
|    5 |   3459 |          1 |
|    4 |    234 |          2 |
|    3 |    693 |          1 |
|    2 |   3432 |          1 |
|    1 |    388 |          3 |
+------+--------+------------+
5 rows in set (0.00 sec)
</code></pre>
","<p>Take a look at <a href=""http://www.fromdual.com/ranking-mysql-results"" rel=""noreferrer"">this</a>.</p>

<p>Change your query to:</p>

<pre><code>SET @rank=0;
SELECT @rank:=@rank+1 AS rank, itemID, COUNT(*) as ordercount
  FROM orders
  GROUP BY itemID
  ORDER BY ordercount DESC;
</code></pre>
","2520377"
"How to do an INNER JOIN on multiple columns","281335","","<p>I'm working on a homework project and I'm supposed to perform a database query which finds flights either by the city name or the airport code, but the <code>flights</code> table only contains the airport codes so if I want to search by city I have to join on the <code>airports</code> table.</p>

<p>The airports table has the following columns: <code>code, city</code><br>
The flights table has the following columns: <code>airline, flt_no, fairport, tairport, depart, arrive, fare</code><br>
The columns <code>fairport</code> and <code>tairport</code> are the <strong>from</strong> and <strong>to</strong> airport codes.<br>
The columns <code>depart</code> and <code>arrive</code> are dates of departure and arrival.  </p>

<p>I came up with a query which first joins the flights on the <code>fairport</code> column and the <code>airports.code</code> column.  In order for me to match the <code>tairport</code> I have to perform another join on the previous matches from the first join.</p>

<pre><code>SELECT airline, flt_no, fairport, tairport, depart, arrive, fare
    FROM (SELECT * FROM flights
        INNER JOIN airports
        ON flights.fairport = airports.code
        WHERE (airports.code = '?' OR airports.city='?')) AS matches
    INNER JOIN airports
    ON matches.tairport = airports.code
    WHERE (airports.code = '?' OR airports.city = '?')
</code></pre>

<p>My query returns the proper results and it will suffice for the purpose of the homework, but I'm wondering if I can <code>JOIN</code> on multiple columns? How would I construct the <code>WHERE</code> clause so it matches the departure and the destination city/code?</p>

<p>Below is a ""pseudo-query"" on what I want to acheive, but I can't get the syntax correctly and i don't know how to represent the <code>airports</code> table for the departures and the destinations:</p>

<pre><code>SELECT * FROM flights
INNER JOIN airports
ON flights.fairport = airports.code AND flights.tairport = airports.code
WHERE (airports.code = 'departureCode' OR airports.city= 'departureCity') 
    AND (airports.code = 'destinationCode' OR airports.city = 'destinationCity')
</code></pre>

<h2>Update</h2>

<p>I also found <a href=""http://www.codeproject.com/Articles/33052/Visual-Representation-of-SQL-Joins"" rel=""noreferrer"">this visual representation of SQL Join statements</a> to be <strong>very</strong> helpful as a general guide on how to construct SQL statements!</p>
","<p>You can JOIN with the same table more than once by giving the joined tables an <a href=""http://www.w3schools.com/SQl/sql_alias.asp"" rel=""noreferrer"">alias</a>, as in the following example:</p>

<pre><code>SELECT 
    airline, flt_no, fairport, tairport, depart, arrive, fare
FROM 
    flights
INNER JOIN 
    airports from_port ON (from_port.code = flights.fairport)
INNER JOIN
    airports to_port ON (to_port.code = flights.tairport)
WHERE 
    from_port.code = '?' OR to_port.code = '?' OR airports.city='?'
</code></pre>

<p>Note that the <code>to_port</code> and <code>from_port</code> are aliases for the first and second copies of the <code>airports</code> table.</p>
","2366820"
"Fastest Way of Inserting in Entity Framework","280902","","<p>I'm looking for the fastest way of inserting into Entity Framework.</p>

<p>I'm asking this because of the scenario where you have an active TransactionScope and the insertion is huge (4000+). It can potentially last more than 10 minutes (default timeout of transactions), and this will lead to an incomplete transaction.</p>
","<p>To your remark in the comments to your question:</p>

<blockquote>
  <p>""...SavingChanges (<strong>for each
  record</strong>)...""</p>
</blockquote>

<p>That's the worst thing you can do! Calling <code>SaveChanges()</code> for each record slows bulk inserts extremely down. I would do a few simple tests which will very likely improve the performance:</p>

<ul>
<li>Call <code>SaveChanges()</code> once after ALL records.</li>
<li>Call <code>SaveChanges()</code> after for example 100 records.</li>
<li>Call <code>SaveChanges()</code> after for example 100 records and dispose the context and create a new one.</li>
<li>Disable change detection</li>
</ul>

<p>For bulk inserts I am working and experimenting with a pattern like this:</p>

<pre><code>using (TransactionScope scope = new TransactionScope())
{
    MyDbContext context = null;
    try
    {
        context = new MyDbContext();
        context.Configuration.AutoDetectChangesEnabled = false;

        int count = 0;            
        foreach (var entityToInsert in someCollectionOfEntitiesToInsert)
        {
            ++count;
            context = AddToContext(context, entityToInsert, count, 100, true);
        }

        context.SaveChanges();
    }
    finally
    {
        if (context != null)
            context.Dispose();
    }

    scope.Complete();
}

private MyDbContext AddToContext(MyDbContext context,
    Entity entity, int count, int commitCount, bool recreateContext)
{
    context.Set&lt;Entity&gt;().Add(entity);

    if (count % commitCount == 0)
    {
        context.SaveChanges();
        if (recreateContext)
        {
            context.Dispose();
            context = new MyDbContext();
            context.Configuration.AutoDetectChangesEnabled = false;
        }
    }

    return context;
}
</code></pre>

<p>I have a test program which inserts 560.000 entities (9 scalar properties, no navigation properties) into the DB. With this code it works in less than 3 minutes.</p>

<p>For the performance it is important to call <code>SaveChanges()</code> after ""many"" records (""many"" around 100 or 1000). It also improves the performance to dispose the context after SaveChanges and create a new one. This clears the context from all entites, <code>SaveChanges</code> doesn't do that, the entities are still attached to the context in state <code>Unchanged</code>. It is the growing size of attached entities in the context what slows down the insertion step by step. So, it is helpful to clear it after some time.</p>

<p>Here are a few measurements for my 560.000 entities:</p>

<ul>
<li>commitCount = 1,       recreateContext = false: <strong>many hours</strong> (That's your current procedure)</li>
<li>commitCount = 100,     recreateContext = false: <strong>more than 20 minutes</strong></li>
<li>commitCount = 1000,    recreateContext = false: <strong>242 sec</strong></li>
<li>commitCount = 10000,   recreateContext = false: <strong>202 sec</strong></li>
<li>commitCount = 100000,  recreateContext = false: <strong>199 sec</strong></li>
<li>commitCount = 1000000, recreateContext = false: <strong>out of memory exception</strong></li>
<li>commitCount = 1,       recreateContext = true:  <strong>more than 10 minutes</strong></li>
<li>commitCount = 10,      recreateContext = true:  <strong>241 sec</strong></li>
<li>commitCount = 100,     recreateContext = true:  <strong>164 sec</strong></li>
<li>commitCount = 1000,    recreateContext = true:  <strong>191 sec</strong></li>
</ul>

<p>The behaviour in the first test above is that the performance is very non-linear and decreases extremely over time. (""Many hours"" is an estimation, I never finished this test, I stopped at 50.000 entities after 20 minutes.) This non-linear behaviour is not so significant in all other tests.</p>
","5942176"
"Table Naming Dilemma: Singular vs. Plural Names","279953","","<p>Academia has it that table names should be the singular of the entity that they store attributes of.  </p>

<p>I dislike any T-SQL that requires square brackets around names, but I have renamed a <code>Users</code> table to the singular, forever sentencing those using the table to sometimes have to use brackets.  </p>

<p>My gut feel is that it is more correct to stay with the singular, but my gut feel is also that brackets indicate undesirables like column names with spaces in them etc.</p>

<p>Should I stay, or should I go?</p>
","<p>Others have given pretty good answers as far as ""standards"" go, but I just wanted to add this... Is it possible that ""User"" (or ""Users"") is not actually a full description of the data held in the table? Not that you should get too crazy with table names and specificity, but perhaps something like ""Widget_Users"" (where ""Widget"" is the name of your application or website) would be more appropriate.</p>
","338433"
"Count(*) vs Count(1)","279335","","<p>Just wondering if any of you guys use <code>Count(1)</code> over <code>Count(*)</code> and if there is a noticeable difference in performance or if this is just a legacy habit that has been brought forward from days gone past?</p>

<p>(The specific database is SQL Server 2005.)</p>
","<p>There is no difference.</p>

<p>Reason:</p>

<blockquote>
  <p><a href=""http://msdn.microsoft.com/en-us/library/ms175997.aspx"" rel=""noreferrer"">Books on-line</a> says ""<code>COUNT ( { [ [ ALL | DISTINCT ] expression ] | * } )</code>""</p>
</blockquote>

<p>""1"" is a non-null expression: so it's the same as <code>COUNT(*)</code>.
The optimizer recognizes it for what it is: trivial.</p>

<p>The same as <code>EXISTS (SELECT * ...</code> or <code>EXISTS (SELECT 1 ...</code></p>

<p>Example:</p>

<pre><code>SELECT COUNT(1) FROM dbo.tab800krows
SELECT COUNT(1),FKID FROM dbo.tab800krows GROUP BY FKID

SELECT COUNT(*) FROM dbo.tab800krows
SELECT COUNT(*),FKID FROM dbo.tab800krows GROUP BY FKID
</code></pre>

<p>Same IO, same plan, the works</p>

<p>Edit, Aug 2011</p>

<p><a href=""https://dba.stackexchange.com/questions/2511/what-is-the-difference-between-select-count-and-select-countany-non-null-col/2512#2512"">Similar question on DBA.SE</a>.</p>

<p>Edit, Dec 2011</p>

<p><code>COUNT(*)</code> is mentioned specifically in <a href=""http://msdn.microsoft.com/en-us/library/ms175997.aspx"" rel=""noreferrer"">ANSI-92</a> (look for ""<code>Scalar expressions 125</code>"")</p>

<blockquote>
  <p>Case:</p>
  
  <p>a) If COUNT(*) is specified, then the result is the cardinality of T.</p>
</blockquote>

<p>That is, the ANSI standard recognizes it as bleeding obvious what you mean. <code>COUNT(1)</code> has been optimized out by RDBMS vendors <em>because</em> of this superstition. Otherwise it would be evaluated as per ANSI</p>

<blockquote>
  <p>b) Otherwise, let TX be the single-column table that is the
                result of applying the &lt;value expression&gt; to each row of T
                and eliminating null values. If one or more null values are
                eliminated, then a completion condition is raised: warning-</p>
</blockquote>
","1221649"
"I want to use CASE statement to update some records in sql server 2005","278556","","<pre><code>UPDATE dbo.TestStudents  
SET LASTNAME = 
( CASE  
WHEN (LASTNAME = 'AAA') THEN 'BBB' 
WHEN (LASTNAME = 'CCC') THEN 'DDD' 
WHEN (LASTNAME = 'EEE') THEN 'FFF' 
ELSE  (LASTNAME)
END )
</code></pre>

<p>The statement work for the purpose but the else condition scan through every record in the table. Is there any way I can leave the unaffected rows as they are?</p>
","<p>Add a <code>WHERE</code> clause</p>

<pre><code>UPDATE dbo.TestStudents  
SET     LASTNAME =  CASE  
                        WHEN LASTNAME = 'AAA' THEN 'BBB' 
                        WHEN LASTNAME = 'CCC' THEN 'DDD' 
                        WHEN LASTNAME = 'EEE' THEN 'FFF' 
                        ELSE LASTNAME
                    END 
WHERE   LASTNAME IN ('AAA', 'CCC', 'EEE')
</code></pre>
","15766129"
"How to copy a row and insert in same table with a autoincrement field in MySQL?","277688","","<p>I have a table Eg- tab . What I am trying to do is copying a row with an autoincrement column ID=1 and insert the data into same table with a row and column ID=2.</p>

<p>Using MySql.
How can I do this in a single query?Please help </p>
","<p>Use <code>INSERT ... SELECT</code>:</p>

<pre><code>insert into your_table (c1, c2, ...)
select c1, c2, ...
from your_table
where id = 1
</code></pre>

<p>where <code>c1, c2, ...</code> are all the columns except <code>id</code>. If you want to explicitly insert with an <code>id</code> of 2 then include that in your INSERT column list and your SELECT:</p>

<pre><code>insert into your_table (id, c1, c2, ...)
select 2, c1, c2, ...
from your_table
where id = 1
</code></pre>

<p>You'll have to take care of a possible duplicate <code>id</code> of 2 in the second case of course.</p>
","9156386"
"Multiple Updates in MySQL","277489","","<p>I know that you can insert multiple rows at once, is there a way to update multiple rows at once (as in, in one query) in MySQL?</p>

<p>Edit:
For example I have the following</p>

<pre><code>Name   id  Col1  Col2
Row1   1    6     1
Row2   2    2     3
Row3   3    9     5
Row4   4    16    8
</code></pre>

<p>I want to combine all the following Updates into one query</p>

<pre><code>UPDATE table SET Col1 = 1 WHERE id = 1;
UPDATE table SET Col1 = 2 WHERE id = 2;
UPDATE table SET Col2 = 3 WHERE id = 3;
UPDATE table SET Col1 = 10 WHERE id = 4;
UPDATE table SET Col2 = 12 WHERE id = 4;
</code></pre>
","<p>Yes, that's possible - you can use INSERT ... ON DUPLICATE KEY UPDATE.</p>

<p>Using your example:</p>

<pre><code>INSERT INTO table (id,Col1,Col2) VALUES (1,1,1),(2,2,3),(3,9,3),(4,10,12)
ON DUPLICATE KEY UPDATE Col1=VALUES(Col1),Col2=VALUES(Col2);
</code></pre>
","3466"
"Select n random rows from SQL Server table","277294","","<p>I've got a SQL Server table with about 50,000 rows in it. I want to select about 5,000 of those rows at random. I've thought of a complicated way, creating a temp table with a ""random number"" column, copying my table into that, looping through the temp table and updating each row with <code>RAND()</code>, and then selecting from that table where the random number column &lt; 0.1. I'm looking for a simpler way to do it, in a single statement if possible.</p>

<p><a href=""http://www.sql-server-helper.com/tips/generate-random-numbers.aspx"" rel=""noreferrer"">This article</a> suggest using the <code>NEWID()</code> function. That looks promising, but I can't see how I could reliably select a certain percentage of rows.</p>

<p>Anybody ever do this before? Any ideas?</p>
","<pre><code>select top 10 percent * from [yourtable] order by newid()
</code></pre>

<p>In response to the ""pure trash"" comment concerning large tables: you could do it like this to improve performance.</p>

<pre><code>select  * from [yourtable] where [yourPk] in 
(select top 10 percent [yourPk] from [yourtable] order by newid())
</code></pre>

<p>The cost of this will be the key scan of values plus the join cost, which on a large table with a small percentage selection should be reasonable.</p>
","848908"
"SQL query for today's date minus two months","275979","","<p>I want to select all the records in a table where their date of entry is older then 2 months.</p>

<p>Any idea how I can do that?</p>

<p>I haven't tried anything yet but I am on this point:</p>

<pre><code>SELECT COUNT(1) FROM FB WHERE Dte &gt; GETDATE()
</code></pre>
","<p>If you are using SQL Server try this:</p>

<pre><code>SELECT * FROM MyTable
WHERE MyDate &lt; DATEADD(month, -2, GETDATE())
</code></pre>

<p>Based on your update it would be:</p>

<pre><code>SELECT * FROM FB WHERE Dte &lt;  DATEADD(month, -2, GETDATE())
</code></pre>
","5425688"
"SQL Server convert string to datetime","275498","","<p>This is not asking how to convert an arbitrary string to datetime in MSSQL such as <a href=""https://stackoverflow.com/questions/207190/sql-server-string-to-date-conversion"">this question</a>.</p>

<p>I can control the string format but I want to know what the MSSQL syntax is for updating a datetime field using a date string.</p>
","<p>For instance you can use</p>

<pre><code>update tablename set datetimefield='19980223 14:23:05'
update tablename set datetimefield='02/23/1998 14:23:05'
update tablename set datetimefield='1998-12-23 14:23:05'
update tablename set datetimefield='23 February 1998 14:23:05'
update tablename set datetimefield='1998-02-23T14:23:05'
</code></pre>

<p>You need to be careful of day/month order since this will be language dependent when the year is not specified first. If you specify the <em>year first</em> then there is no problem; date order will always be year-month-day.</p>
","1135755"
"SQL Query Where Field DOES NOT Contain $x","275283","","<p>I want to find an SQL query to find rows where field1 does not contain $x. How can I do this?</p>
","<p>What kind of field is this? The IN operator cannot be used with a single field, but is meant to be used in subqueries or with predefined lists:</p>

<pre><code>-- subquery
SELECT a FROM x WHERE x.b NOT IN (SELECT b FROM y);
-- predefined list
SELECT a FROM x WHERE x.b NOT IN (1, 2, 3, 6);
</code></pre>

<p>If you are searching a string, go for the LIKE operator (but this will be slow):</p>

<pre><code>-- Finds all rows where a does not contain ""text""
SELECT * FROM x WHERE x.a NOT LIKE '%text%';
</code></pre>

<p>If you restrict it so that the string you are searching for has to start with the given string, it can use indices (if there is an index on that field) and be reasonably fast:</p>

<pre><code>-- Finds all rows where a does not start with ""text""
SELECT * FROM x WHERE x.a NOT LIKE 'text%';
</code></pre>
","232951"
"Only one expression can be specified in the select list when the subquery is not introduced with EXISTS","274662","","<p>My query is as follows, and contains a subquery within it:</p>

<pre><code> select count(distinct dNum)
 from myDB.dbo.AQ
 where A_ID in 
  (SELECT DISTINCT TOP (0.1) PERCENT A_ID, 
            COUNT(DISTINCT dNum) AS ud 
 FROM         myDB.dbo.AQ
 WHERE     M &gt; 1 and B = 0 
 GROUP BY A_ID ORDER BY ud DESC)
</code></pre>

<p>The error I am receiving is ...</p>

<pre><code>Only one expression can be specified in the select list when the subquery is not
introduced with EXISTS.`
</code></pre>

<p>When I run the sub-query alone, it returns just fine, so I am assuming there is some issue with the main query?</p>
","<p>You can't return two (or multiple) columns in your subquery to do the comparison in the <code>WHERE A_ID IN (subquery)</code> clause - which column is it supposed to compare <code>A_ID</code> to? Your subquery must only return the one column needed for the comparison to the column on the other side of the <code>IN</code>. So the query needs to be of the form:</p>

<pre><code>SELECT * From ThisTable WHERE ThisColumn IN (SELECT ThatColumn FROM ThatTable)
</code></pre>

<p>You also want to add sorting so you can select just from the top rows, but you don't need to return the COUNT as a column in order to do your sort; sorting in the <code>ORDER</code> clause is independent of the columns returned by the query. </p>

<p>Try something like this:</p>

<pre><code>select count(distinct dNum) 
from myDB.dbo.AQ 
where A_ID in
    (SELECT DISTINCT TOP (0.1) PERCENT A_ID
    FROM myDB.dbo.AQ 
    WHERE M &gt; 1 and B = 0
    GROUP BY A_ID 
    ORDER BY COUNT(DISTINCT dNum) DESC)
</code></pre>
","1904426"
"INSERT with SELECT","273571","","<p>I have a query that inserts using a select:</p>

<pre><code>INSERT INTO courses (name, location, gid) 
            SELECT name, location, gid 
              FROM courses 
             WHERE cid = $cid
</code></pre>

<p>Is it possible to only select ""name,location"" for the insert, and set gid to something else in the query?</p>
","<p>Yes, absolutely, but check your syntax.</p>

<pre><code>INSERT INTO courses (name, location, gid)
SELECT name, location, 1
FROM   courses
WHERE  cid = 2
</code></pre>

<p>You can put a constant of the same type as <code>gid</code> in its place, not just 1, of course.  And, I just made up the <code>cid</code> value.</p>
","5391390"
"Remove Primary Key in MySQL","273245","","<p>I have the following table schema which maps user_customers to permissions on a live MySQL database:</p>

<pre><code>mysql&gt; describe user_customer_permission;
+------------------+---------+------+-----+---------+----------------+
| Field            | Type    | Null | Key | Default | Extra          |
+------------------+---------+------+-----+---------+----------------+
| id               | int(11) | NO   | PRI | NULL    | auto_increment |
| user_customer_id | int(11) | NO   | PRI | NULL    |                |
| permission_id    | int(11) | NO   | PRI | NULL    |                |
+------------------+---------+------+-----+---------+----------------+
3 rows in set (0.00 sec)
</code></pre>

<p>I would like to remove the primary keys for user_customer_id and permission_id and retain the primary key for id.</p>

<p>When I run the command:</p>

<pre><code>alter table user_customer_permission drop primary key;
</code></pre>

<p>I get the following error:</p>

<pre><code>ERROR 1075 (42000): Incorrect table definition; there can be only one auto column and it must be defined as a key
</code></pre>

<p>How can I drop a column's primary key?</p>
","<p>Without an index, maintaining an autoincrement column becomes too expensive, that's why <code>MySQL</code> requires an autoincrement column to be a leftmost part of an index.</p>

<p>You should remove the autoincrement property before dropping the key:</p>

<pre><code>ALTER TABLE user_customer_permission MODIFY id INT NOT NULL;
ALTER TABLE user_customer_permission DROP PRIMARY KEY;
</code></pre>

<p>Note that you have a composite <code>PRIMARY KEY</code> which covers all three columns and <code>id</code> is not guaranteed to be unique.</p>

<p>If it happens to be unique, you can make it to be a <code>PRIMARY KEY</code> and <code>AUTO_INCREMENT</code> again:</p>

<pre><code>ALTER TABLE user_customer_permission MODIFY id INT NOT NULL PRIMARY KEY AUTO_INCREMENT;
</code></pre>
","2111324"
"How do I remove the first characters of a specific column in a table?","272672","","<p>In SQL, how can I remove the first 4 characters of values of a specific column in a table?  Column name is <code>Student Code</code> and an example value is <code>ABCD123Stu1231</code>.
I want to remove first 4 chars from my table for all records</p>

<p>Please guide me</p>
","<pre><code>SELECT RIGHT(MyColumn, LEN(MyColumn) - 4) AS MyTrimmedColumn
</code></pre>

<p>Edit:
To explain, RIGHT takes 2 arguments - the string (or column) to operate on, and the number of characters to return (starting at the ""right"" side of the string).  LEN returns the length of the column data, and we subtract four so that our RIGHT function leaves the leftmost 4 characters ""behind"".</p>

<p>Hope this makes sense.</p>

<p>Edit again - I just read Andrew's response, and he may very well have interperpereted correctly, and I might be mistaken.  If this is the case (and you want to UPDATE the table rather than just return doctored results), you can do this:</p>

<pre><code>UPDATE MyTable
SET MyColumn = RIGHT(MyColumn, LEN(MyColumn) - 4)
</code></pre>

<p>He's on the right track, but his solution will <em>keep</em> the 4 characters at the start of the string, rather than discarding said 4 characters.</p>
","982821"
"MySQL Cannot Add Foreign Key Constraint","272557","","<p>So I'm trying to add Foreign Key constraints to my database as a project requirement and it worked the first time or two on different tables, but I have two tables on which I get an error when trying to add the Foreign Key Constraints. 
The error message that I get is:</p>

<blockquote>
  <p>ERROR 1215 (HY000): Cannot add foreign key constraint</p>
</blockquote>

<p>This is the SQL I'm using to create the tables, the two offending tables are <code>Patient</code> and <code>Appointment</code>.</p>

<pre><code>SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=1;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

CREATE SCHEMA IF NOT EXISTS `doctorsoffice` DEFAULT CHARACTER SET utf8 ;
USE `doctorsoffice` ;

-- -----------------------------------------------------
-- Table `doctorsoffice`.`doctor`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `doctorsoffice`.`doctor` ;

CREATE  TABLE IF NOT EXISTS `doctorsoffice`.`doctor` (
  `DoctorID` INT(11) NOT NULL AUTO_INCREMENT ,
  `FName` VARCHAR(20) NULL DEFAULT NULL ,
  `LName` VARCHAR(20) NULL DEFAULT NULL ,
  `Gender` VARCHAR(1) NULL DEFAULT NULL ,
  `Specialty` VARCHAR(40) NOT NULL DEFAULT 'General Practitioner' ,
  UNIQUE INDEX `DoctorID` (`DoctorID` ASC) ,
  PRIMARY KEY (`DoctorID`) )
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `doctorsoffice`.`medicalhistory`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `doctorsoffice`.`medicalhistory` ;

CREATE  TABLE IF NOT EXISTS `doctorsoffice`.`medicalhistory` (
  `MedicalHistoryID` INT(11) NOT NULL AUTO_INCREMENT ,
  `Allergies` TEXT NULL DEFAULT NULL ,
  `Medications` TEXT NULL DEFAULT NULL ,
  `ExistingConditions` TEXT NULL DEFAULT NULL ,
  `Misc` TEXT NULL DEFAULT NULL ,
  UNIQUE INDEX `MedicalHistoryID` (`MedicalHistoryID` ASC) ,
  PRIMARY KEY (`MedicalHistoryID`) )
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `doctorsoffice`.`Patient`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `doctorsoffice`.`Patient` ;

CREATE  TABLE IF NOT EXISTS `doctorsoffice`.`Patient` (
  `PatientID` INT unsigned NOT NULL AUTO_INCREMENT ,
  `FName` VARCHAR(30) NULL ,
  `LName` VARCHAR(45) NULL ,
  `Gender` CHAR NULL ,
  `DOB` DATE NULL ,
  `SSN` DOUBLE NULL ,
  `MedicalHistory` smallint(5) unsigned NOT NULL,
  `PrimaryPhysician` smallint(5) unsigned NOT NULL,
  PRIMARY KEY (`PatientID`) ,
  UNIQUE INDEX `PatientID_UNIQUE` (`PatientID` ASC) ,
  CONSTRAINT `FK_MedicalHistory`
    FOREIGN KEY (`MEdicalHistory` )
    REFERENCES `doctorsoffice`.`medicalhistory` (`MedicalHistoryID` )
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `FK_PrimaryPhysician`
    FOREIGN KEY (`PrimaryPhysician` )
    REFERENCES `doctorsoffice`.`doctor` (`DoctorID` )
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `doctorsoffice`.`Appointment`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `doctorsoffice`.`Appointment` ;

CREATE  TABLE IF NOT EXISTS `doctorsoffice`.`Appointment` (
  `AppointmentID` smallint(5) unsigned NOT NULL AUTO_INCREMENT ,
  `Date` DATE NULL ,
  `Time` TIME NULL ,
  `Patient` smallint(5) unsigned NOT NULL,
  `Doctor` smallint(5) unsigned NOT NULL,
  PRIMARY KEY (`AppointmentID`) ,
  UNIQUE INDEX `AppointmentID_UNIQUE` (`AppointmentID` ASC) ,
  CONSTRAINT `FK_Patient`
    FOREIGN KEY (`Patient` )
    REFERENCES `doctorsoffice`.`Patient` (`PatientID` )
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `FK_Doctor`
    FOREIGN KEY (`Doctor` )
    REFERENCES `doctorsoffice`.`doctor` (`DoctorID` )
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `doctorsoffice`.`InsuranceCompany`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `doctorsoffice`.`InsuranceCompany` ;

CREATE  TABLE IF NOT EXISTS `doctorsoffice`.`InsuranceCompany` (
  `InsuranceID` smallint(5) NOT NULL AUTO_INCREMENT ,
  `Name` VARCHAR(50) NULL ,
  `Phone` DOUBLE NULL ,
  PRIMARY KEY (`InsuranceID`) ,
  UNIQUE INDEX `InsuranceID_UNIQUE` (`InsuranceID` ASC) )
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `doctorsoffice`.`PatientInsurance`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `doctorsoffice`.`PatientInsurance` ;

CREATE  TABLE IF NOT EXISTS `doctorsoffice`.`PatientInsurance` (
  `PolicyHolder` smallint(5) NOT NULL ,
  `InsuranceCompany` smallint(5) NOT NULL ,
  `CoPay` INT NOT NULL DEFAULT 5 ,
  `PolicyNumber` smallint(5) NOT NULL AUTO_INCREMENT ,
  PRIMARY KEY (`PolicyNumber`) ,
  UNIQUE INDEX `PolicyNumber_UNIQUE` (`PolicyNumber` ASC) ,
  CONSTRAINT `FK_PolicyHolder`
    FOREIGN KEY (`PolicyHolder` )
    REFERENCES `doctorsoffice`.`Patient` (`PatientID` )
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `FK_InsuranceCompany`
    FOREIGN KEY (`InsuranceCompany` )
    REFERENCES `doctorsoffice`.`InsuranceCompany` (`InsuranceID` )
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;

USE `doctorsoffice` ;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
</code></pre>
","<p>To find the specific error run this:</p>

<pre><code>SHOW ENGINE INNODB STATUS;
</code></pre>

<p>And look in the <code>LATEST FOREIGN KEY ERROR</code> section.</p>

<p>The data type for the child column must match the parent column exactly. For example, since <code>medicalhistory.MedicalHistoryID</code> is an <code>INT</code>, <code>Patient.MedicalHistory</code> also needs to be an <code>INT</code>, not a <code>SMALLINT</code>.</p>

<p>Also, you should run the query <code>set foreign_key_checks=0</code> before running the DDL so you can create the tables in an arbitrary order rather than needing to create all parent tables before the relevant child tables.</p>
","15535110"
"Cannot delete or update a parent row: a foreign key constraint fails","272175","","<p>When doing:</p>

<pre><code>DELETE FROM `jobs` WHERE `job_id` =1 LIMIT 1 
</code></pre>

<p>It errors:</p>

<pre><code>#1451 - Cannot delete or update a parent row: a foreign key constraint fails 
(paymesomething.advertisers, CONSTRAINT advertisers_ibfk_1 FOREIGN KEY 
(advertiser_id) REFERENCES jobs (advertiser_id))
</code></pre>

<p>Here are my tables:</p>

<pre><code>CREATE TABLE IF NOT EXISTS `advertisers` (
  `advertiser_id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  `password` char(32) NOT NULL,
  `email` varchar(128) NOT NULL,
  `address` varchar(255) NOT NULL,
  `phone` varchar(255) NOT NULL,
  `fax` varchar(255) NOT NULL,
  `session_token` char(30) NOT NULL,
  PRIMARY KEY (`advertiser_id`),
  UNIQUE KEY `email` (`email`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=2 ;


INSERT INTO `advertisers` (`advertiser_id`, `name`, `password`, `email`, `address`, `phone`, `fax`, `session_token`) VALUES
(1, 'TEST COMPANY', '', '', '', '', '', '');

CREATE TABLE IF NOT EXISTS `jobs` (
  `job_id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `advertiser_id` int(11) unsigned NOT NULL,
  `name` varchar(255) NOT NULL,
  `shortdesc` varchar(255) NOT NULL,
  `longdesc` text NOT NULL,
  `address` varchar(255) NOT NULL,
  `time_added` int(11) NOT NULL,
  `active` tinyint(1) NOT NULL,
  `moderated` tinyint(1) NOT NULL,
  PRIMARY KEY (`job_id`),
  KEY `advertiser_id` (`advertiser_id`,`active`,`moderated`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=2 ;


INSERT INTO `jobs` (`job_id`, `advertiser_id`, `name`, `shortdesc`, `longdesc`, `address`, `active`, `moderated`) VALUES
(1, 1, 'TEST', 'TESTTEST', 'TESTTESTES', '', 0, 0);

ALTER TABLE `advertisers`
  ADD CONSTRAINT `advertisers_ibfk_1` FOREIGN KEY (`advertiser_id`) REFERENCES `jobs` (`advertiser_id`);
</code></pre>
","<p>As is, you must delete the row out of the advertisers table before you can delete the row in the jobs table that it references.  This:</p>

<pre><code>ALTER TABLE `advertisers`
  ADD CONSTRAINT `advertisers_ibfk_1` FOREIGN KEY (`advertiser_id`) 
      REFERENCES `jobs` (`advertiser_id`);
</code></pre>

<p>...is actually the opposite to what it should be.  As it is, it means that you'd have to have a record in the jobs table before the advertisers.  So you need to use:</p>

<pre><code>ALTER TABLE `jobs`
  ADD CONSTRAINT `advertisers_ibfk_1` FOREIGN KEY (`advertiser_id`) 
      REFERENCES `advertisers` (`advertiser_id`);
</code></pre>

<p>Once you correct the foreign key relationship, your delete statement will work.</p>
","1905498"
"Function to Calculate Median in SQL Server","271974","","<p>According to <a href=""http://msdn.microsoft.com/en-us/library/ms173454.aspx"" rel=""nofollow noreferrer"">MSDN</a>, Median is not available as an aggregate function in Transact-SQL. However, I would like to find out whether it is possible to create this functionality (using the <a href=""http://msdn.microsoft.com/en-us/library/ms182741.aspx"" rel=""nofollow noreferrer"">Create Aggregate</a> function, user defined function, or some other method). </p>

<p>What would be the best way (if possible) to do this - allow for the calculation of a median value (assuming a numeric data type) in an aggregate query?</p>
","<p>There are lots of ways to do this, with dramatically varying performance. Here's one particularly well-optimized solution, from <em><a href=""http://sqlblog.com/blogs/adam_machanic/archive/2006/12/18/medians-row-numbers-and-performance.aspx"" rel=""nofollow noreferrer"">Medians, ROW_NUMBERs, and performance</a></em>. This is a particularly optimal solution when it comes to actual I/Os generated during execution-- it looks more costly than other solutions, but it is actually much faster.</p>

<p>That page also contains a discussion of other solutions and performance testing details. Note the use of a unique column as a disambiguator in case there are multiple rows with the same value of the median column.</p>

<p>As with all database performance scenarios, always try to test a solution out with real data on real hardware-- you never know when a change to SQL Server's optimizer or a peculiarity in your environment will make a normally-speedy solution slower.</p>

<pre><code>SELECT
   CustomerId,
   AVG(TotalDue)
FROM
(
   SELECT
      CustomerId,
      TotalDue,
      ROW_NUMBER() OVER (
         PARTITION BY CustomerId
         ORDER BY TotalDue ASC, SalesOrderId ASC) AS RowAsc,
      ROW_NUMBER() OVER (
         PARTITION BY CustomerId
         ORDER BY TotalDue DESC, SalesOrderId DESC) AS RowDesc
   FROM Sales.SalesOrderHeader SOH
) x
WHERE
   RowAsc IN (RowDesc, RowDesc - 1, RowDesc + 1)
GROUP BY CustomerId
ORDER BY CustomerId;
</code></pre>
","1567946"
"SELECT INTO using Oracle","271433","","<p>I'm trying to do a SELECT INTO using Oracle. My query is:</p>

<pre><code>SELECT * INTO new_table FROM old_table;
</code></pre>

<p>But I get the following error:</p>

<pre><code>SQL Error: ORA-00905: missing keyword
00905. 00000 -  ""missing keyword""
</code></pre>

<p>Any ideas what's wrong?</p>

<hr>

<p>The Standard behavior of the above should be as I originally thought:
However Oracle implemented it totally differently in their own dialect of SQL
<a href=""http://docs.oracle.com/cd/E17952_01/refman-5.0-en/insert-select.html"" rel=""noreferrer"">Oracle Docs on Insert ... Select</a> </p>
","<p>If NEW_TABLE already exists then ...</p>

<pre><code>insert into new_table select * from old_table
/
</code></pre>

<p>If you want to create NEW_TABLE based on the records in OLD_TABLE ...</p>

<pre><code>create table new_table as select * from old_table
/
</code></pre>
","2250213"
"SQL Server - stop or break execution of a SQL script","271408","","<p>Is there a way to immediately stop execution of a SQL script in SQL server, like a ""break"" or ""exit"" command?</p>

<p>I have a script that does some validation and lookups before it starts doing inserts, and I want it to stop if any of the validations or lookups fail.</p>
","<p><strong>The <a href=""http://msdn.microsoft.com/en-us/library/ms178592.aspx"" rel=""noreferrer"">raiserror</a> method</strong></p>

<pre><code>raiserror('Oh no a fatal error', 20, -1) with log
</code></pre>

<p>This will terminate the connection, thereby stopping the rest of the script from running.</p>

<p>Note that both severity level 20 or higher and the <code>WITH LOG</code> option are necessary for it to work this way.</p>

<p>This even works with GO statements, eg.</p>

<pre><code>print 'hi'
go
raiserror('Oh no a fatal error', 20, -1) with log
go
print 'ho'
</code></pre>

<p>Will give you the output:</p>

<pre><code>hi
Msg 2745, Level 16, State 2, Line 1
Process ID 51 has raised user error 50000, severity 20. SQL Server is terminating this process.
Msg 50000, Level 20, State 1, Line 1
Oh no a fatal error
Msg 0, Level 20, State 0, Line 0
A severe error occurred on the current command.  The results, if any, should be discarded.
</code></pre>

<p>Notice that 'ho' is not printed.</p>

<p>CAVEATS:</p>

<ul>
<li>This only works if you are logged in as admin ('sysadmin' role), and also leaves you with no database connection.</li>
<li>If you are NOT logged in as admin, the RAISEERROR() call itself will fail <em>and the script will continue executing</em>.</li>
<li>When invoked with sqlcmd.exe, exit code 2745 will be reported.</li>
</ul>

<p>Reference: <a href=""http://www.mydatabasesupport.com/forums/ms-sqlserver/174037-sql-server-2000-abort-whole-script.html#post761334"" rel=""noreferrer"">http://www.mydatabasesupport.com/forums/ms-sqlserver/174037-sql-server-2000-abort-whole-script.html#post761334</a></p>

<p><strong>The noexec method</strong></p>

<p>Another method that works with GO statements is <code>set noexec on</code>. This causes the rest of the script to be skipped over. It does not terminate the connection, but you need to turn <code>noexec</code> off again before any commands will execute.</p>

<p>Example:</p>

<pre><code>print 'hi'
go

print 'Fatal error, script will not continue!'
set noexec on

print 'ho'
go

-- last line of the script
set noexec off -- Turn execution back on; only needed in SSMS, so as to be able 
               -- to run this script again in the same session.
</code></pre>
","804811"
"How do i rename the table name using SQL query?","271273","","<p>I Used the following syntax but I couldn't find the rename keyword in SQL server 2005.</p>

<pre><code>Alter table Stu_Table rename to Stu_Table_10
</code></pre>

<p>Please help me in renaming the table name using a query statement.</p>
","<p>Use sp_rename:</p>

<pre><code>EXEC sp_rename 'Stu_Table', 'Stu_Table_10'
</code></pre>

<p>You can find documentation on this procedure on <a href=""http://msdn.microsoft.com/en-us/library/ms188351%28SQL.90%29.aspx"" rel=""noreferrer"">MSDN</a>.</p>

<p>If you need to include a schema name, this can only be included in the first parameter (that is, this cannot be used to move a table from one schema to another). So, for example, this is valid:</p>

<pre><code>EXEC sp_rename 'myschema.Stu_Table', 'Stu_Table_10'
</code></pre>
","886797"
"SET versus SELECT when assigning variables?","271181","","<p>What are the differences between the <code>SET</code> and <code>SELECT</code> statements when assigning variables in T-SQL?</p>
","<p><a href=""http://ryanfarley.com/blog/archive/2004/03/01/390.aspx"" rel=""noreferrer"">Quote</a>, which summarizes from <a href=""http://vyaskn.tripod.com/differences_between_set_and_select.htm"" rel=""noreferrer"">this article</a>:</p>

<blockquote>
  <ol>
  <li>SET is the ANSI standard for variable assignment, SELECT is not.</li>
  <li>SET can only assign one variable at a time, SELECT can make multiple assignments at once.</li>
  <li>If assigning from a query, SET can only assign a scalar value. If the query returns multiple values/rows then SET will raise an error. SELECT will assign one of the values to the variable and hide the fact that multiple values were returned (so you'd likely never know why something was going wrong elsewhere - have fun troubleshooting that one)</li>
  <li>When assigning from a query if there is no value returned then SET will assign NULL, where SELECT will not make the assignment at all (so the variable will not be changed from its previous value)</li>
  <li>As far as speed differences - there are no direct differences between SET and SELECT. However SELECT's ability to make multiple assignments in one shot does give it a slight speed advantage over SET.</li>
  </ol>
</blockquote>
","3945396"
"How to get second-highest salary employees in a table","271053","","<p>It's a question I got this afternoon:</p>

<p>There a table contains ID, Name, and Salary of Employees, get names of the second-highest salary employees, in SQL Server</p>

<p>Here's my answer, I just wrote it in paper and not sure that it's perfectly valid, but it seems to work: </p>

<pre><code>SELECT Name FROM Employees WHERE Salary = 
( SELECT DISTINCT TOP (1) Salary FROM Employees WHERE Salary NOT IN
 (SELECT DISTINCT TOP (1) Salary FROM Employees ORDER BY Salary DESCENDING)
ORDER BY Salary DESCENDING)
</code></pre>

<p>I think it's ugly, but it's the only solution come to my mind.</p>

<p>Can you suggest me a better query?</p>

<p>Thank you very much.</p>
","<p>To get the names of the employees with the 2nd highest distinct salary amount you can use.</p>

<pre><code>;WITH T AS
(
SELECT *,
       DENSE_RANK() OVER (ORDER BY Salary Desc) AS Rnk
FROM Employees
)
SELECT Name
FROM T
WHERE Rnk=2;
</code></pre>

<p>If Salary is indexed the following may well be more efficient though especially if there are many employees.</p>

<pre><code>SELECT Name
FROM   Employees
WHERE  Salary = (SELECT MIN(Salary)
                 FROM   (SELECT DISTINCT TOP (2) Salary
                         FROM   Employees
                         ORDER  BY Salary DESC) T);
</code></pre>

<p>Test Script</p>

<pre><code>CREATE TABLE Employees
  (
     Name   VARCHAR(50),
     Salary FLOAT
  )

INSERT INTO Employees
SELECT TOP 1000000 s1.name,
                   abs(checksum(newid()))
FROM   sysobjects s1,
       sysobjects s2

CREATE NONCLUSTERED INDEX ix
  ON Employees(Salary)

SELECT Name
FROM   Employees
WHERE  Salary = (SELECT MIN(Salary)
                 FROM   (SELECT DISTINCT TOP (2) Salary
                         FROM   Employees
                         ORDER  BY Salary DESC) T);

WITH T
     AS (SELECT *,
                DENSE_RANK() OVER (ORDER BY Salary DESC) AS Rnk
         FROM   Employees)
SELECT Name
FROM   T
WHERE  Rnk = 2;

SELECT Name
FROM   Employees
WHERE  Salary = (SELECT DISTINCT TOP (1) Salary
                 FROM   Employees
                 WHERE  Salary NOT IN (SELECT DISTINCT TOP (1) Salary
                                       FROM   Employees
                                       ORDER  BY Salary DESC)
                 ORDER  BY Salary DESC)

SELECT Name
FROM   Employees
WHERE  Salary = (SELECT TOP 1 Salary
                 FROM   (SELECT TOP 2 Salary
                         FROM   Employees
                         ORDER  BY Salary DESC) sel
                 ORDER  BY Salary ASC)  
</code></pre>
","7417462"
"What is a 'multi-part identifier' and why can't it be bound?","270964","","<p>I continually get these errors when I try to update tables based on another table. I end up rewriting the query, change the order of joins, change some groupings and then it eventually works, but I just don't quite get it.</p>

<p>What is a 'multi-part identifier'?<br>
When is a 'multi-part identifier' not able to be bound?<br>
What is it being bound to anyway?<br>
In what cases will this error occur?<br>
What are the best ways to prevent it?  </p>

<p>The specific error from SQL Server 2005 is:</p>

<blockquote>
  <p>The multi-part identifier ""..."" could not be bound.</p>
</blockquote>

<p>Here is an example:</p>

<pre><code>UPDATE  [test].[dbo].[CompanyDetail]

SET Mnemonic = [dbBWKMigration].[dbo].[Company].[MNEMONIC], 
               [Company Code] = [dbBWKMigration].[dbo].[Company].[COMPANYCODE]

WHERE [Company Name] = **[dbBWKMigration].[dbo].[Company].[COMPANYNAME]**
</code></pre>

<p>The actual error:</p>

<blockquote>
  <p>Msg 4104, Level 16, State 1, Line 3 The multi-part identifier
  ""dbBWKMigration.dbo.Company.COMPANYNAME"" could not be bound.</p>
</blockquote>
","<p>A multipart identifier is any description of a field or table that contains multiple parts - for instance MyTable.SomeRow - if it can't be bound that means there's something wrong with it - either you've got a simple typo, or a confusion between table and column.  It can also be caused by using reserved words in your table or field names and not surrounding them with [].</p>

<p>Something like <a href=""http://www.red-gate.com/products/SQL_Prompt/index.htm"" rel=""noreferrer"">redgate sql prompt</a> is brilliant for avoiding having to manually type these (it even auto-completes joins based on foreign keys), but isn't free.  SQL server 2008 supports intellisense out of the box, although it isn't quite as complete as the redgate version.</p>
","206645"
"Mysql - Alter a column to be AUTO_INCREMENT","270319","","<p>I'm trying to modify a table to make it's primary key column <code>AUTO_INCREMENT</code> after the fact.  I have tried the following sql, but got a syntax error:</p>

<pre><code>ALTER TABLE document
ALTER COLUMN document_id AUTO_INCREMENT
</code></pre>

<p>Am I doing something wrong or is this not possible?</p>

<pre>
+--------------------+
| VERSION()          |
+--------------------+
| 5.0.75-0ubuntu10.2 |
+--------------------+
</pre>
","<pre><code>ALTER TABLE document MODIFY COLUMN document_id INT auto_increment
</code></pre>
","2169090"
"DROP IF EXISTS VS DROP?","269363","","<p>Can someone tell me if there is any difference between</p>

<pre><code>DROP IF EXISTS [TABLE_NAME]
</code></pre>



<pre><code>DROP [TABLE_NAME]
</code></pre>

<p>I am asking this because I am using JDBC template in my MVC web application. If I use <code>DROP [TABLE_NAME]</code> the error said that Table exist. And if I use <code>DROP IF EXISTS [TABLE_NAME]</code> it says bad SQL grammar. Can some one help?</p>
","<p>Standard SQL syntax is</p>

<pre><code>DROP TABLE table_name;
</code></pre>

<p><code>IF EXISTS</code> is not standard; different platforms might support it with different syntax, or not support it at all. In PostgreSQL, the syntax is</p>

<pre><code>DROP TABLE IF EXISTS table_name;
</code></pre>

<p>The first one will throw an error if the table doesn't exist, or if other database objects depend on it.  Most often, the other database objects will be foreign key references, but there may be others, too.  (Views, for example.)  The second will not throw an error if the table doesn't exist, but it will still throw an error if other database objects depend on it. </p>

<p>To drop a table, and all the other objects that depend on it, use one of these.</p>

<pre><code>DROP TABLE table_name CASCADE;
DROP TABLE IF EXISTS table_name CASCADE;
</code></pre>

<p>Use CASCADE with great care.</p>
","9565901"
"how can I Update top 100 records in sql server","269149","","<p>I want to update the top 100 records in SQL Server. I have  a table <code>T1</code> with fields <code>F1</code> and <code>F2</code>. <code>T1</code> has 200 records. I want to update the <code>F1</code> field in the top 100 records. How can I update based on <code>TOP 100</code> in SQL Server?</p>
","<p>Note, the parentheses are required for UPDATE statements:</p>

<pre><code>update top (100) table1 set field1 = 1
</code></pre>
","1198404"
"How to read the last row with SQL Server","268725","","<p>What is the most efficient way to read the last row with SQL Server?</p>

<p>The table is indexed on a unique key -- the ""bottom"" key values represent the last row.</p>
","<p>If you're using MS SQL, you can try:</p>

<pre><code>SELECT TOP 1 * FROM table_Name ORDER BY unique_column DESC 
</code></pre>
","177328"
"Is it possible to specify condition in Count()?","268420","","<p>Is it possible to specify a condition in <code>Count()</code>? I would like to count only the rows that have for example ""Manager"" value in Position column.</p>

<p><strong>Edit:</strong> <strong>please</strong> read carefully, I want to do it <code>IN</code> count statement, not using <code>WHERE</code>; I'm asking about it because I need to count both Managers and Other in the same select (something like <code>Count(Position = Manager), Count(Poisition = Other))</code> so <code>WHERE</code> is no use for me in this example</p>
","<p>If you can't just limit the query itself with a <code>where</code> clause, you can use the fact that the <code>count</code> aggregate only counts the non-null values:</p>

<pre><code>select count(case Position when 'Manager' then 1 else null end)
from ...
</code></pre>

<p>You can also use the <code>sum</code> aggregate in a similar way:</p>

<pre><code>select sum(case Position when 'Manager' then 1 else 0 end)
from ...
</code></pre>
","1400115"
"Fastest way to determine if record exists","267665","","<p>As the title suggests... I'm trying to figure out the fastest way with the least overhead to determine if a record exists in a table or not. </p>

<p>Sample query:</p>

<pre><code>SELECT COUNT(*) FROM products WHERE products.id = ?;

    vs

SELECT COUNT(products.id) FROM products WHERE products.id = ?;

    vs

SELECT products.id FROM products WHERE products.id = ?;
</code></pre>

<p>Say the <code>?</code> is swapped with <code>'TB100'</code>... both the first and second queries will return the exact same result (say... <code>1</code> for this conversation). The last query will return <code>'TB100'</code> as expected, or nothing if the <code>id</code> is not present in the table. </p>

<p>The purpose is to figure out if the <code>id</code> is in the table or not. If not, the program will next insert the record, if it is, the program will skip it or perform an UPDATE query based on other program logic outside the scope of this question.</p>

<p>Which is faster and has less overhead? (This will be repeated tens of thousands of times per program run, and will be run many times a day). </p>

<p>(Running this query against M$ SQL Server from Java via the M$ provided JDBC driver)</p>
","<p><code>SELECT TOP 1 products.id FROM products WHERE products.id = ?;</code> will outperform all of your suggestions as it will terminate execution after it finds the first record.</p>
","18114500"
"SQL statement to get column type","267173","","<p>Is there a SQL statement that can return the type of a column in a table?</p>
","<p>Using SQL Server:</p>

<pre><code>SELECT DATA_TYPE 
FROM INFORMATION_SCHEMA.COLUMNS
WHERE 
     TABLE_NAME = 'yourTableName' AND 
     COLUMN_NAME = 'yourColumnName'
</code></pre>
","13405667"
"How do I add a auto_increment primary key in SQL Server database?","266934","","<p>I have a table set up that currently has no primary key. All I need to do is add a primary key, no null, auto_increment.</p>

<p>I'm working with a Microsoft SQL Server database. I understand that it can't be done in a single command but every command I try keeps returning syntax errors.</p>

<p>edit ---------------</p>

<p>I have created the primary key and even set it as not null. However, I can't set up the auto_increment.</p>

<p>I've tried:</p>

<pre><code>ALTER TABLE tableName MODIFY id NVARCHAR(20) auto_increment
ALTER TABLE tableName ALTER COLUMN id NVARCHAR(20) auto_increment
ALTER TABLE tableName MODIFY id NVARCHAR(20) auto_increment
ALTER TABLE tableName ALTER COLUMN id NVARCHAR(20) auto_increment
</code></pre>

<p>I'm using NVARCHAR because it wouldn't let me set NOT NULL under int</p>
","<p>It can be done in a single command. You need to set the IDENTITY property for ""auto number""</p>

<pre><code>ALTER TABLE MyTable ADD mytableID int NOT NULL IDENTITY (1,1) PRIMARY KEY
</code></pre>

<p>More precisely to set a named table level constraint </p>

<pre><code>ALTER TABLE MyTable
   ADD MytableID int NOT NULL IDENTITY (1,1),
   ADD CONSTRAINT PK_MyTable PRIMARY KEY CLUSTERED (MyTableID)
</code></pre>

<p>See <a href=""http://msdn.microsoft.com/en-us/library/ms187742.aspx"" rel=""noreferrer"">ALTER TABLE and IDENTITY</a> on MSDN</p>
","6777807"
"Table name as variable","266054","","<p>I am trying to execute this query:</p>

<pre><code>declare @tablename varchar(50)
set @tablename = 'test'
select * from @tablename
</code></pre>

<p>This produces the following error:</p>

<blockquote>
  <p>Msg 1087, Level 16, State 1, Line 5</p>
  
  <p>Must declare the table variable ""@tablename"".</p>
</blockquote>

<p>What's the right way to have table name populated dynamically?</p>
","<p>Table names and column names need to be static, if the query is static. For dynamic table or column names, you should generate the full SQL dynamically, and use sp_executesql to execute it.</p>

<p>More details here: <a href=""http://www.sommarskog.se/dynamic_sql.html"" rel=""noreferrer"">The curse and blessings of dynamic SQL</a></p>
","2838507"
"Is there a combination of ""LIKE"" and ""IN"" in SQL?","266052","","<p>In SQL I (sadly) often have to use ""<code>LIKE</code>"" conditions due to databases that violate nearly every rule of normalization. I can't change that right now. But that's irrelevant to the question.</p>

<p>Further, I often use conditions like <code>WHERE something in (1,1,2,3,5,8,13,21)</code> for better readability and flexibility of my SQL statements.</p>

<p>Is there any possible way to combine these two things without writing complicated sub-selects?</p>

<p>I want something as easy as <code>WHERE something LIKE ('bla%', '%foo%', 'batz%')</code> instead of</p>

<pre><code>WHERE something LIKE 'bla%'
OR something LIKE '%foo%'
OR something LIKE 'batz%'
</code></pre>

<p>I'm working with SQl Server and Oracle here but I'm interested if this is possible in any RDBMS at all.</p>
","<p>There is no combination of LIKE &amp; IN in SQL, much less in TSQL (SQL Server) or PLSQL (Oracle).  Part of the reason for that is because Full Text Search (FTS) is the recommended alternative.</p>

<p>Both Oracle and SQL Server FTS implementations support the CONTAINS keyword, but the syntax is still slightly different:</p>

<h2>Oracle:</h2>

<pre><code>WHERE CONTAINS(t.something, 'bla OR foo OR batz', 1) &gt; 0
</code></pre>

<h2>SQL Server:</h2>

<pre><code>WHERE CONTAINS(t.something, '""bla*"" OR ""foo*"" OR ""batz*""')
</code></pre>

<p>Reference:</p>

<ul>
<li><a href=""http://docs.oracle.com/cd/E11882_01/appdev.112/e23094/xdb09sea.htm#ADXDB4747"" rel=""noreferrer"">Building Full-Text Search Applications with Oracle Text</a> </li>
<li><a href=""http://www.developer.com/db/article.php/3446891/Understanding-SQL-Server-Full-Text-Indexing.htm"" rel=""noreferrer"">Understanding SQL Server Full-Text</a> </li>
</ul>
","3016918"
"What is the best way to paginate results in SQL Server","265823","","<p>What is the best way (performance wise) to paginate results in SQL Server 2000, 2005, 2008, 2012 if you also want to get the total number of results (before paginating)?</p>
","<p>Getting the total number of results and paginating are two different operations. For the sake of this example, let's assume that the query you're dealing with is</p>

<pre><code>SELECT * FROM Orders WHERE OrderDate &gt;= '1980-01-01' ORDER BY OrderDate
</code></pre>

<p>In this case, you would determine the total number of results using:</p>

<pre><code>SELECT COUNT(*) FROM Orders WHERE OrderDate &gt;= '1980-01-01'
</code></pre>

<p>...which may seem inefficient, but is actually pretty performant, assuming all indexes etc. are properly set up.</p>

<p>Next, to get actual results back in a paged fashion, the following query would be most efficient:</p>

<pre><code>SELECT  *
FROM    ( SELECT    ROW_NUMBER() OVER ( ORDER BY OrderDate ) AS RowNum, *
          FROM      Orders
          WHERE     OrderDate &gt;= '1980-01-01'
        ) AS RowConstrainedResult
WHERE   RowNum &gt;= 1
    AND RowNum &lt; 20
ORDER BY RowNum
</code></pre>

<p>This will return rows 1-19 of the original query. The cool thing here, especially for web apps, is that you don't have to keep any state, except the row numbers to be returned.</p>
","109290"
"SQL Server Insert if not exist","265650","","<p>I want to insert data in my table, but insert only that doesn't exist in my DB!</p>

<p>here is my code:</p>

<pre><code>ALTER PROCEDURE [dbo].[EmailsRecebidosInsert]
  (@_DE nvarchar(50),
   @_ASSUNTO nvarchar(50),
   @_DATA nvarchar(30) )
AS
BEGIN
   INSERT INTO EmailsRecebidos (De, Assunto, Data)
   VALUES (@_DE, @_ASSUNTO, @_DATA)
   WHERE NOT EXISTS ( SELECT * FROM EmailsRecebidos 
                   WHERE De = @_DE
                   AND Assunto = @_ASSUNTO
                   AND Data = @_DATA);
END
</code></pre>

<p>And the error is: </p>

<blockquote>
  <p>Msg 156, Level 15, State 1, Procedure EmailsRecebidosInsert, Line 11<br>
  Incorrect syntax near the keyword 'WHERE'.</p>
</blockquote>
","<p>instead of below Code </p>

<pre><code>BEGIN
   INSERT INTO EmailsRecebidos (De, Assunto, Data)
   VALUES (@_DE, @_ASSUNTO, @_DATA)
   WHERE NOT EXISTS ( SELECT * FROM EmailsRecebidos 
                   WHERE De = @_DE
                   AND Assunto = @_ASSUNTO
                   AND Data = @_DATA);
END
</code></pre>

<p>replace with </p>

<pre><code>BEGIN
   IF NOT EXISTS (SELECT * FROM EmailsRecebidos 
                   WHERE De = @_DE
                   AND Assunto = @_ASSUNTO
                   AND Data = @_DATA)
   BEGIN
       INSERT INTO EmailsRecebidos (De, Assunto, Data)
       VALUES (@_DE, @_ASSUNTO, @_DATA)
   END
END
</code></pre>

<p><strong>Updated :</strong> (thanks to @Marc Durdin for pointing)</p>

<p>Note that under high load, this will still sometimes fail, because a second connection can pass the IF NOT EXISTS test before the first connection executes the INSERT, i.e. a race condition. See <a href=""https://stackoverflow.com/a/3791506/1836776"">stackoverflow.com/a/3791506/1836776</a> for a good answer on why even wrapping in a transaction doesn't solve this.</p>
","20971775"
"Effect of NOLOCK hint in SELECT statements","265165","","<p>I guess the real question is:  </p>

<p>If I don't care about dirty reads, will adding the <strong>with (NOLOCK)</strong> hint to a SELECT statement affect the performance of:</p>

<ol>
<li>the current SELECT statement  </li>
<li>other transactions against the given table</li>
</ol>

<p>Example:</p>

<pre><code>Select * 
from aTable with (NOLOCK)
</code></pre>
","<p>1) <strong>Yes</strong>, a select with <code>NOLOCK</code> will complete faster than a normal select.</p>

<p>2) <strong>Yes</strong>, a select with <code>NOLOCK</code> will allow other queries against the effected table to complete faster than a normal select.</p>

<p><strong>Why would this be?</strong> </p>

<p><code>NOLOCK</code> typically (depending on your DB engine) means give me your data, and I don't care what state it is in, and don't bother holding it still while you read from it. It is all at once faster, less resource-intensive, and very very dangerous. </p>

<p>You should be warned to never do an update from or perform anything system critical, or where absolute correctness is required using data that originated from a <code>NOLOCK</code> read. It is absolutely possible that this data contains rows that were deleted during the query's run or that have been deleted in other sessions that have yet to be finalized. It is possible that this data includes rows that have been partially updated. It is possible that this data contains records that violate foreign key constraints. It is possible that this data excludes rows that have been added to the table but have yet to be committed. </p>

<p><em>You really have no way to know what the state of the data is.</em></p>

<p>If you're trying to get things like a Row Count or other summary data where some margin of error is acceptable, then <code>NOLOCK</code> is a good way to boost performance for these queries and avoid having them negatively impact database performance.</p>

<p><strong>Always use the <code>NOLOCK</code> hint with great caution and treat any data it returns suspiciously.</strong> </p>
","210227"
"Select count(*) from multiple tables","265133","","<p>How can I select <code>count(*)</code> from two different tables (call them <code>tab1</code> and <code>tab2</code>) having as result:</p>

<pre><code>Count_1   Count_2
123       456
</code></pre>

<p>I've tried this:</p>

<pre><code>select count(*) Count_1 from schema.tab1 union all select count(*) Count_2 from schema.tab2
</code></pre>

<p>But all I have is:</p>

<pre><code>Count_1
123
456
</code></pre>
","<pre><code>SELECT  (
        SELECT COUNT(*)
        FROM   tab1
        ) AS count1,
        (
        SELECT COUNT(*)
        FROM   tab2
        ) AS count2
FROM    dual
</code></pre>
","606238"
"Copy data into another table","264594","","<p>How to copy/append data from one table into another table with same schema in SQL Server?</p>

<p><strong>Edit:</strong></p>

<p>I mean to say there is query </p>

<pre><code>select * 
into table1 
from table2 
where 1=1 
</code></pre>

<p>which creates <code>table1</code> with the same schema as well as data as in <code>table2</code>. </p>

<p>Is there any short query like this to only copy entire data only into an already existing table?</p>
","<p>If both tables are truly the same schema:</p>

<pre><code>INSERT INTO newTable
SELECT * FROM oldTable
</code></pre>

<p>Otherwise, you'll have to specify the column names (the column list for <code>newTable</code> is optional if you are specifying a value for all columns and selecting columns in the same order as <code>newTable</code>'s schema):</p>

<pre><code>INSERT INTO newTable (col1, col2, col3)
SELECT column1, column2, column3
FROM oldTable
</code></pre>
","13237661"
"MySQL: Can't create table (errno: 150)","264312","","<p>I am trying to import a .sql file and its failing on creating tables.</p>

<p>Here's the query that fails:</p>

<pre><code>CREATE TABLE `data` (
`id` int(10) unsigned NOT NULL,
`name` varchar(100) NOT NULL,
`value` varchar(15) NOT NULL,
UNIQUE KEY `id` (`id`,`name`),
CONSTRAINT `data_ibfk_1` FOREIGN KEY (`id`) REFERENCES `keywords` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=latin1;    
</code></pre>

<p>I exported the .sql from the the same database, I dropped all the tables and now im trying to import it, why is it failing?</p>

<blockquote>
  <p>MySQL: Can't create table './dbname/data.frm' (errno: 150)</p>
</blockquote>
","<p>From the <a href=""https://dev.mysql.com/doc/refman/5.7/en/create-table-foreign-keys.html"" rel=""noreferrer"">MySQL - FOREIGN KEY Constraints Documentation</a>:</p>

<blockquote>
  <p>If you re-create a table that was dropped, it must have a definition that conforms to the foreign key constraints referencing it. It must have the correct column names and types, and it must have indexes on the referenced keys, as stated earlier. <strong><em>If these are not satisfied, MySQL returns Error 1005 and refers to Error 150 in the error message, which means that a foreign key constraint was not correctly formed.</em></strong> Similarly, if an ALTER TABLE fails due to Error 150, this means that a foreign key definition would be incorrectly formed for the altered table. </p>
</blockquote>
","4061333"
"How To Create Table with Identity Column","264146","","<p>I have an existing table that I am about to blow away because I did not create it with the <code>ID</code> column set to be the table's Identity column.</p>

<p>Using SQL Server Management Studio, I scripted a <strong>Create To...</strong> of the existing table and got this:</p>

<pre><code>CREATE TABLE [dbo].[History](
    [ID] [int] NOT NULL,
    [RequestID] [int] NOT NULL,
    [EmployeeID] [varchar](50) NOT NULL,
    [DateStamp] [datetime] NOT NULL,
 CONSTRAINT [PK_History] PRIMARY KEY CLUSTERED 
(
    [ID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
</code></pre>

<p>My question is, how would I modify this SQL so that my resulting table has the <code>ID</code> column set as the <strong>Identity</strong>?</p>
","<pre><code>CREATE TABLE [dbo].[History](
    [ID] [int] IDENTITY(1,1) NOT NULL,
    [RequestID] [int] NOT NULL,
    [EmployeeID] [varchar](50) NOT NULL,
    [DateStamp] [datetime] NOT NULL,
 CONSTRAINT [PK_History] PRIMARY KEY CLUSTERED 
(
    [ID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON)
) ON [PRIMARY]
</code></pre>
","10725745"
"Order by descending date - month, day and year","262284","","<p>This seems stupid but, I simply need a list of dates to be ordered with the most recent date at top. Using <code>order by DESC</code> doesn't seem to be working the way I want it to.</p>

<pre><code>SELECT     *
FROM         vw_view
ORDER BY EventDate DESC
</code></pre>

<p>It gives me the date ordered by month and day, but doesn't take year into consideration.
for example:</p>

<pre><code>12/31/2009 

12/31/2008

12/30/2009

12/29/2009
</code></pre>

<p>Needs to be more like:</p>

<pre><code>12/31/2009

12/30/2009

12/29/2009

12/28/2009
</code></pre>

<p>and so on.</p>
","<p>I'm guessing <code>EventDate</code> is a char or varchar and not a date otherwise your order by clause would be fine.</p>

<p>You can use CONVERT to change the values to a date and sort by that</p>

<pre><code>SELECT * 
FROM 
     vw_view 
ORDER BY 
   CONVERT(DateTime, EventDate,101)  DESC
</code></pre>

<p>The problem with that is, as Sparky points out in the comments, if EventDate has a value that can't be converted to a date the query won't execute. </p>

<p>This means you should either exclude the bad rows or let the bad rows go to the bottom of the results</p>

<p>To exclude the bad rows just add <code>WHERE IsDate(EventDate) = 1</code></p>

<p>To let let the bad dates go to the bottom you need to use <code>CASE</code></p>

<p>e.g.</p>

<pre><code>ORDER BY 
    CASE
       WHEN IsDate(EventDate) = 1 THEN CONVERT(DateTime, EventDate,101)
       ELSE null
    END DESC
</code></pre>
","4676158"
"How do I DROP multiple columns with a single ALTER TABLE statement?","261972","","<p>I would like to write a single SQL command to drop multiple columns from a single table in one <code>ALTER TABLE</code> statement.</p>

<p>From <a href=""http://msdn.microsoft.com/en-us/library/aa275462%28v=sql.80%29.aspx"" rel=""noreferrer"">MSDN's ALTER TABLE documentation</a>...</p>

<blockquote>
<pre><code>DROP { [CONSTRAINT] constraint_name | COLUMN column_name }
</code></pre>
  
  <p>Specifies that constraint_name or column_name is removed from the table. DROP COLUMN is not allowed if the compatibility level is 65 or earlier. Multiple columns and constraints can be listed.</p>
</blockquote>

<p>It says that mutliple columns can be listed in the the statement but the syntax doesn't show an optional comma or anything that would even hint at the syntax.</p>

<p>How should I write my SQL to drop multiple columns in one statement (if possible)?</p>
","<pre><code>alter table TableName
    drop column Column1, Column2
</code></pre>

<p>The syntax is</p>

<pre><code>DROP { [ CONSTRAINT ] constraint_name | COLUMN column } [ ,...n ] 
</code></pre>

<p>For MySQL</p>

<pre><code>alter table TableName
    drop Column1, drop Column2
</code></pre>
","6346185"
"How to select the last record of a table in SQL?","261459","","<p>This is a sample code to select all records from a table. Can someone show me how to select the last record of that table?</p>

<pre><code>select * from table
</code></pre>

<p>When I use: <code>SELECT * FROM TABLE ORDER BY ID DESC LIMIT</code> 
I get this error: Line 1: Incorrect syntax near 'LIMIT'.
This is the code I use: </p>

<pre><code>private void LastRecord()
{
    SqlConnection conn = new SqlConnection(ConfigurationManager.ConnectionStrings[""HELPDESK_OUTLOOKConnectionString3""].ToString());

    conn.Open();
    SqlDataReader myReader = null;
    SqlCommand myCommand = new SqlCommand(""SELECT * FROM HD_AANVRAGEN ORDER BY "" +
                ""aanvraag_id DESC LIMIT 1"", conn);
    myReader = myCommand.ExecuteReader();
    while (myReader.Read())
    {
        TextBox1.Text = (myReader[""aanvraag_id""].ToString());
        TextBox1.Text += (myReader[""wijziging_nummer""].ToString());
        TextBox1.Text += (myReader[""melding_id""].ToString());
        TextBox1.Text += (myReader[""aanvraag_titel""].ToString());
        TextBox1.Text += (myReader[""aanvraag_omschrijving""].ToString());
        TextBox1.Text += (myReader[""doorlooptijd_id""].ToString());
        TextBox1.Text += (myReader[""rapporteren""].ToString());
        TextBox1.Text += (myReader[""werknemer_id""].ToString());
        TextBox1.Text += (myReader[""outlook_id""].ToString());
    }
}
</code></pre>
","<p>Without any further information, which Database etc the best we can do is something like</p>

<p><strong>Sql Server</strong></p>

<pre><code>SELECT TOP 1 * FROM Table ORDER BY ID DESC
</code></pre>

<p><strong>MySql</strong></p>

<pre><code>SELECT * FROM Table ORDER BY ID DESC LIMIT 1
</code></pre>
","5191525"
"Most efficient T-SQL way to pad a varchar on the left to a certain length?","260305","","<p>As compared to say:</p>

<pre><code>REPLICATE(@padchar, @len - LEN(@str)) + @str
</code></pre>
","<p>This is simply an inefficient use of SQL, no matter how you do it. </p>

<p>perhaps something like </p>

<pre><code>right('XXXXXXXXXXXX'+ rtrim(@str), @n)
</code></pre>

<p>where X is your padding character and @n is the number of characters in the resulting string (assuming you need the padding because you are dealing with a fixed length).  </p>

<p>But as I said you should really avoid doing this in your database.</p>
","121890"
"MySQL OPTIMIZE all tables?","260127","","<p>MySQL has an <a href=""http://dev.mysql.com/doc/refman/5.1/en/optimize-table.html"" rel=""noreferrer"">OPTIMIZE TABLE</a> command which can be used to reclaim unused space in a MySQL install.  Is there a way (built-in command or common stored procedure) to run this optimization for every table in the database and/or server install, or is this something you'd have to script up yourself?</p>
","<p>You can use <a href=""http://dev.mysql.com/doc/refman/5.0/en/mysqlcheck.html""><code>mysqlcheck</code></a> to do this at the command line.</p>

<p>One database:</p>

<pre><code>mysqlcheck -o &lt;db_schema_name&gt;
</code></pre>

<p>All databases:</p>

<pre><code>mysqlcheck -o --all-databases
</code></pre>
","5475582"
"Convert timestamp to date in MySQL query","260106","","<p>I want to convert a <code>timestamp</code> in MySQL to a date.  </p>

<p>I would like to format the user.registration field into the text file as a <code>yyyy-mm-dd</code>.</p>

<p>Here is my SQL:</p>

<pre><code>$sql = requestSQL(""SELECT user.email, 
                   info.name, 
                   FROM_UNIXTIME(user.registration),
                   info.news
                   FROM user, info 
                   WHERE user.id = info.id "", ""export members"");
</code></pre>

<p>I also tried the date conversion with:</p>

<pre><code>DATE_FORMAT(user.registration, '%d/%m/%Y')
DATE(user.registration)
</code></pre>

<p>I echo the result before to write the text file and I get :</p>

<blockquote>
  <p>email1;name1;DATE_FORMAT(user.registration, '%d/%m/%Y');news1</p>
  
  <p>email2;name2;news2</p>
</blockquote>

<p>How can I convert that field to date?</p>
","<pre><code>DATE_FORMAT(FROM_UNIXTIME(`user.registration`), '%e %b %Y') AS 'date_formatted'
</code></pre>
","12629932"
"how to extract only the year from the date in sql server 2008?","258873","","<p>In sql server 2008, how to extract only the year from the date.
In DB I have a column for date, from that I need to extract the year.
Is there any function for that?</p>
","<pre><code>year(@date)
year(getdate())
year('20120101')

update table
set column = year(date_column)
whre ....
</code></pre>

<p>or if you need it in another table</p>

<pre><code> update t
   set column = year(t1.date_column)
     from table_source t1
     join table_target t on (join condition)
    where ....
</code></pre>
","12436755"
"How do I get the query builder to output its raw SQL query as a string?","258677","","<p>Given the following code:</p>

<pre class=""lang-php prettyprint-override""><code>DB::table('users')-&gt;get();
</code></pre>

<p>I want to get the raw SQL query string that the query builder above will generate, so in this example it would be <code>SELECT * FROM users</code>.</p>

<p>How do I do this?</p>
","<p>To output to the screen the last queries ran you can use this</p>

<pre class=""lang-php prettyprint-override""><code>dd(DB::getQueryLog());
</code></pre>

<p>I believe the most recent queries will be at the bottom of the array.</p>

<p>You will have something like that:</p>

<pre class=""lang-none prettyprint-override""><code>array(1) {
  [0]=&gt;
  array(3) {
    [""query""]=&gt;
    string(21) ""select * from ""users""""
    [""bindings""]=&gt;
    array(0) {
    }
    [""time""]=&gt;
    string(4) ""0.92""
  }
}
</code></pre>

<p>As per <a href=""https://stackoverflow.com/questions/18236294/how-do-i-get-the-query-builder-to-output-its-raw-sql-query-as-a-string#comment56908005_18236656"">Joshua's</a> comment below, this is turned off by default now. To use, you'll need to enable it manually using:</p>

<pre><code>DB::enableQueryLog();
</code></pre>
","18236656"
"postgresql: INSERT INTO ... (SELECT * ...)","258555","","<p>I'm not sure if its standard SQL:  </p>

<pre><code> INSERT INTO tblA 
 (SELECT id, time 
    FROM tblB 
   WHERE time &gt; 1000)  
</code></pre>

<p>What I'm looking for is: <strong>what if tblA and tblB are in different DB Servers</strong>.</p>

<p>Does PostgreSql gives any utility or has any functionality that will help to use <code>INSERT query with PGresult struct</code>  </p>

<p>I mean <code>SELECT id, time FROM tblB ...</code> will return a <code>PGresult*</code> on using <code>PQexec</code>. Is it possible to use this struct in another <code>PQexec</code> to execute an INSERT command.  </p>

<p>EDIT:<br>
If not possible then I would go for extracting the values from PQresult* and create a multiple INSERT statement syntax like:</p>

<pre><code>INSERT INTO films (code, title, did, date_prod, kind) VALUES
    ('B6717', 'Tampopo', 110, '1985-02-10', 'Comedy'),
    ('HG120', 'The Dinner Game', 140, DEFAULT, 'Comedy'); 
</code></pre>

<p>Is it possible to create a prepared statement out of this!! :(</p>
","<p>As Henrik wrote you can use dblink to connect remote database and fetch result. For example:</p>

<pre><code>psql dbtest
CREATE TABLE tblB (id serial, time integer);
INSERT INTO tblB (time) VALUES (5000), (2000);

psql postgres
CREATE TABLE tblA (id serial, time integer);

INSERT INTO tblA
    SELECT id, time 
    FROM dblink('dbname=dbtest', 'SELECT id, time FROM tblB')
    AS t(id integer, time integer)
    WHERE time &gt; 1000;

TABLE tblA;
 id | time 
----+------
  1 | 5000
  2 | 2000
(2 rows)
</code></pre>

<p>PostgreSQL has <a href=""http://www.postgresql.org/docs/current/static/datatype-pseudo.html"" rel=""noreferrer"">record</a> pseudo-type (only for function's argument or result type), which allows you query data from another (unknown) table.</p>

<p>Edit:</p>

<p>You can make it as prepared statement if you want and it works as well:</p>

<pre><code>PREPARE migrate_data (integer) AS
INSERT INTO tblA
    SELECT id, time
    FROM dblink('dbname=dbtest', 'SELECT id, time FROM tblB')
    AS t(id integer, time integer)
    WHERE time &gt; $1;

EXECUTE migrate_data(1000);
-- DEALLOCATE migrate_data;
</code></pre>

<p>Edit (yeah, another):</p>

<p>I just saw your <a href=""https://stackoverflow.com/questions/6086914/postgresql-insert-into-select-ii"">revised question</a> (closed as duplicate, or just very similar to this).</p>

<p>If my understanding is correct (postgres has tbla and dbtest has tblb and you want <strong>remote insert with local select</strong>, not <strong>remote select with local insert</strong> as above):</p>

<pre><code>psql dbtest

SELECT dblink_exec
(
    'dbname=postgres',
    'INSERT INTO tbla
        SELECT id, time
        FROM dblink
        (
            ''dbname=dbtest'',
            ''SELECT id, time FROM tblb''
        )
        AS t(id integer, time integer)
        WHERE time &gt; 1000;'
);
</code></pre>

<p>I don't like that nested dblink, but AFAIK I can't reference to tblB in <a href=""http://www.postgresql.org/docs/current/static/contrib-dblink-exec.html"" rel=""noreferrer"">dblink_exec</a> body. Use LIMIT to specify top 20 rows, but I think you need to sort them using ORDER BY clause first.</p>
","6083444"
"Difference between BYTE and CHAR in column datatypes","258246","","<p>In Oracle, what is the difference between :</p>

<pre><code>CREATE TABLE CLIENT
(
 NAME VARCHAR2(11 BYTE),
 ID_CLIENT NUMBER
)
</code></pre>

<p>and</p>

<pre><code>CREATE TABLE CLIENT
(
 NAME VARCHAR2(11 CHAR), -- or even VARCHAR2(11)
 ID_CLIENT NUMBER
)
</code></pre>
","<p>Let us assume the database character set is UTF-8, which is the recommended setting in recent versions of Oracle. In this case, some characters take more than 1 byte to store in the database.</p>

<p>If you define the field as <code>VARCHAR2(11 BYTE)</code>, Oracle can use up to 11 bytes for storage, but you may not actually be able to store 11 characters in the field, because some of them take more than one byte to store, e.g. non-English characters.</p>

<p>By defining the field as <code>VARCHAR2(11 CHAR)</code> you tell Oracle it can use enough space to store 11 characters, no matter how many bytes it takes to store each one. A single character may require up to 4 bytes.</p>
","81492"
"SQL Server 2008: How to query all databases sizes?","257311","","<p>I have MS SQL 2008 R2, 500 databases.
What is the most efficient, easiest and 'modern' way to query all databases sizes.</p>

<p>The output should have columns:</p>

<ul>
<li>DatabaseName</li>
<li>DataFilesSize</li>
<li>LogFilesSize</li>
</ul>
","<pre><code>with fs
as
(
    select database_id, type, size * 8.0 / 1024 size
    from sys.master_files
)
select 
    name,
    (select sum(size) from fs where type = 0 and fs.database_id = db.database_id) DataFileSizeMB,
    (select sum(size) from fs where type = 1 and fs.database_id = db.database_id) LogFileSizeMB
from sys.databases db
</code></pre>
","5946134"
"How do you update a DateTime field in T-SQL?","256301","","<p>The following query does not update the datetime field:</p>

<pre><code>update table
SET EndDate = '2009-05-25'
WHERE Id = 1
</code></pre>

<p>I also tried it with no dashes, but that does not work either.</p>
","<p>When in doubt, <a href=""http://msdn.microsoft.com/en-us/library/ms187928.aspx"" rel=""noreferrer"">be explicit about the data type conversion using CAST/CONVERT</a>:</p>

<pre><code>UPDATE TABLE
   SET EndDate = CAST('2009-05-25' AS DATETIME)
 WHERE Id = 1
</code></pre>
","3144128"
"Not equal <> != operator on NULL","255769","","<p>Could someone please explain the following behavior in SQL?</p>

<pre><code>SELECT * FROM MyTable WHERE MyColumn != NULL (0 Results)
SELECT * FROM MyTable WHERE MyColumn &lt;&gt; NULL (0 Results)
SELECT * FROM MyTable WHERE MyColumn IS NOT NULL (568 Results)
</code></pre>
","<p><code>&lt;&gt;</code> is Standard SQL-92; <code>!=</code> is its equivalent.  Both evaluate for values, which <code>NULL</code> is not -- <code>NULL</code> is a placeholder to say there is the absence of a value.</p>

<p>Which is why you can only use <code>IS NULL</code>/<code>IS NOT NULL</code> as predicates for such situations.</p>

<p>This behavior is not specific to SQL Server. All standards-compliant SQL dialects work the same way.</p>
","5658472"
"How to insert a timestamp in Oracle?","255422","","<p>I have an Oracle DB with a <code>timestamp</code> field in it. What is the correct SQL code to insert a <code>timestamp</code> into this field?</p>
","<pre><code>insert
into tablename (timestamp_value)
values (TO_TIMESTAMP(:ts_val, 'YYYY-MM-DD HH24:MI:SS'));
</code></pre>

<p>if you want the current time stamp to be inserted then:</p>

<pre><code>insert
into tablename (timestamp_value)
values (CURRENT_TIMESTAMP);
</code></pre>
","5420884"
"ORA-00979 not a group by expression","255164","","<p>I am getting ORA-00979 with the following query:</p>

<pre><code>SELECT cr.review_sk, cr.cs_sk, cr.full_name,
tolist(to_char(cf.fact_date, 'mm/dd/yyyy')) ""appt"",
cs.cs_id, cr.tracking_number
from review cr, cs, fact cf
where cr.cs_sk = cs.cs_sk
and UPPER(cs.cs_id) like '%' || UPPER(i_cs_id) || '%'
and row_delete_date_time is null
and cr.review_sk = cf.review_wk (+)
and cr.fact_type_code (+) = 183050
GROUP BY cr.review_sk, cr.cs_sk, cf.fact_date, cr.tracking_number
ORDER BY cs.cs_id, cr.full_name;
</code></pre>

<p>I couldn't find any examples that had both GROUP BY and ORDER BY clauses in the same query.  I tried removing each field from the group by one at a time, but am still getting the same error.</p>
","<p>You must put all columns of the <code>SELECT</code> in the <code>GROUP BY</code> or use functions on them which compress the results to a single value (like <code>MIN</code>, <code>MAX</code> or <code>SUM</code>).</p>

<p>A simple example to understand why this happens: Imagine you have a database like this:</p>

<pre><code>FOO BAR
0   A
0   B
</code></pre>

<p>and you run <code>SELECT * FROM table GROUP BY foo</code>. This means the database must return a single row as result with the first column <code>0</code> to fulfill the <code>GROUP BY</code> but there are now two values of <code>bar</code> to chose from. Which result would you expect - <code>A</code> or <code>B</code>? Or should the database return more than one row, violating the contract of <code>GROUP BY</code>?</p>
","1520641"
"Best way to test if a row exists in a MySQL table","255120","","<p>I'm trying to find out if a row exists in a table. Using MySQL, is it better to do a query like this:</p>

<pre><code>SELECT COUNT(*) AS total FROM table1 WHERE ...
</code></pre>

<p>and check to see if the total is non-zero or is it better to do a query like this:</p>

<pre><code>SELECT * FROM table1 WHERE ... LIMIT 1
</code></pre>

<p>and check to see if any rows were returned?</p>

<p>In both queries, the WHERE clause uses an index.</p>
","<p>You could also try using</p>

<pre><code>SELECT EXISTS(SELECT * FROM table1 WHERE ...)
</code></pre>

<p>per <a href=""http://dev.mysql.com/doc/refman/5.0/en/exists-and-not-exists-subqueries.html"" rel=""noreferrer"">the documentation</a></p>

<p><strong>Per a comment below:</strong></p>

<pre><code>SELECT EXISTS(SELECT 1 FROM table1 WHERE ...)
</code></pre>
","1676573"
"ALTER TABLE to add a composite primary key","254611","","<p>I have a table called <code>provider</code>. I have three columns called <code>person</code>, <code>place</code>, <code>thing</code>. There can be duplicate persons, duplicate places, and duplicate things, but there can never be a dupicate person-place-thing combination.</p>

<p>How would I ALTER TABLE to add a composite primary key for this table in MySQL with the these three columns?</p>
","<pre><code>ALTER TABLE provider ADD PRIMARY KEY(person,place,thing);
</code></pre>

<p>If a primary key already exists then you want to do this</p>

<pre><code>ALTER TABLE provider DROP PRIMARY KEY, ADD PRIMARY KEY(person, place, thing);
</code></pre>
","8859374"
"Get the last inserted row ID (with SQL statement)","254527","","<p>I want to get the new created ID when you insert a new record in table.</p>

<p>I read this: <a href=""http://msdn.microsoft.com/en-us/library/ms177564.aspx"">http://msdn.microsoft.com/en-us/library/ms177564.aspx</a> but it needs to create temporary table.</p>

<p>I want to return the ID after executing INSERT statement (assuming executing just one INSERT).</p>

<p>Example: </p>

<pre><code>1     Joe      Joe
2     Michael  Mike
3     Zoe      Zoe
</code></pre>

<p>When executing an INSERT statement, I want to return the created ID, means 4.</p>

<p>Can tell me how to do that using SQL statement or it is not possible ?</p>
","<p>If your SQL Server table has a column of type <code>INT IDENTITY</code> (or <code>BIGINT IDENTITY</code>), then you can get the latest inserted value using:</p>

<pre><code>INSERT INTO dbo.YourTable(columns....)
   VALUES(..........)

SELECT SCOPE_IDENTITY()
</code></pre>

<p>This works as long as you haven't inserted another row - it just returns the last <code>IDENTITY</code> value handed out in this scope here.</p>

<p>There are at least two more options - <code>@@IDENTITY</code> and <code>IDENT_CURRENT</code> - read more about how they works and in what way they're different (and might give you unexpected results) in this <a href=""http://blog.sqlauthority.com/2007/03/25/sql-server-identity-vs-scope_identity-vs-ident_current-retrieve-last-inserted-identity-of-record/"" rel=""noreferrer"">excellent blog post by Pinal Dave here</a>.</p>
","9477528"
"Get Week day name from a Given Date in SQL Server","253457","","<p>I am trying get a day name like friday, saturday, sunday, monday etc from a given date. I know there is a built in function which returns the day name for example:</p>

<pre><code>SELECT DATENAME(dw,'09/23/2013') as theDayName 
</code></pre>

<p>this SQL query returns:</p>

<p><strong>'Monday'</strong></p>

<p>This is all OK. But I would like to pass <code>Month, Day and Year</code> individually. </p>

<p>I am using the builtin DATEPART function to retrieve month, day and year from a date so I can pass it to the DATENAME function:</p>

<pre><code>SELECT DATEPART(m, GETDATE()) as theMonth  -- returns 11
SELECT DATEPART(d, GETDATE()) as theDay   -- returns 20
SELECT DATEPART(yy, GETDATE()) as theYear   -- returns 2013
</code></pre>

<p>Now that I have Month, Day, Year values individually, I pass it to my <code>DATENAME</code> to get the <code>Weekname</code> of the date I want:</p>

<pre><code>--my SQL query to return dayName
SELECT (DATENAME(dw, DATEPART(m, GETDATE())/DATEPART(d, myDateCol1)/ DATEPART(yy, getdate())))  as myNameOfDay, FirstName, LastName FROM myTable
</code></pre>

<p>This returns an incorrect Day Name. I tried replace / with - so that in the DATENAME function my SQL query becomes:</p>

<pre><code>SELECT DATENAME(dw,'09/23/2013') 
--becomes
SELECT DATENAME(dw,'09-23-2013') 
</code></pre>

<p>but it still returns incorrect dayName from my SQL query. Am I missing something here.</p>

<p>Please advice.</p>
","<p>You need to construct a date string.  You're using <code>/</code> or <code>-</code> operators which do MATH/numeric operations on the numeric return values of DATEPART.  Then <code>DATENAME</code> is taking that numeric value and interpreting it as a date.</p>

<p>You need to convert it to a string.  For example:</p>

<pre><code>SELECT (
  DATENAME(dw, 
  CAST(DATEPART(m, GETDATE()) AS VARCHAR) 
  + '/' 
  + CAST(DATEPART(d, myDateCol1) AS VARCHAR) 
  + '/' 
  + CAST(DATEPART(yy, getdate()) AS VARCHAR))
  )
</code></pre>
","20106955"
"What's the difference between TRUNCATE and DELETE in SQL","252595","","<p>I wrote up an answer to this question by mistake in response to a question about the difference between DROP and TRUNCATE, but I thought that it's a shame not to share so I'll post my own answer to my own question ... is that even ethical? :)</p>

<p>Edit: If your answer is platform specific can you please indicate that.</p>
","<p>Here's a list of differences. I've highlighted Oracle-specific features, and hopefully the community can add in other vendors' specific difference also. Differences that are common to most vendors can go directly below the headings, with differences highlighted below.</p>

<p><hr></p>

<h1>General Overview</h1>

<p>If you want to quickly delete all of the rows from a table, and you're really sure that you want to do it, and you do not have foreign keys against the tables, then a TRUNCATE is probably going to be faster than a DELETE.</p>

<p>Various system-specific issues have to be considered, as detailed below.</p>

<p><hr></p>

<h1>Statement type</h1>

<p>Delete is DML, Truncate is DDL</p>

<p><hr></p>

<h1>Commit and Rollback</h1>

<p>Variable by vendor</p>

<p><strong>SQL*Server</strong></p>

<p>Truncate can be rolled back.</p>

<p><strong>PostgreSQL</strong></p>

<p>Truncate can be rolled back.</p>

<p><strong>Oracle</strong></p>

<p>Because a TRUNCATE is DDL it involves two commits, one before and one after the statement execution. Truncate can therefore not be rolled back, and a failure in the truncate process will have issued a commit anyway.</p>

<p>However, see Flashback below.</p>

<p><hr></p>

<h1>Space reclamation</h1>

<p>Delete does not recover space, Truncate recovers space</p>

<p><strong>Oracle</strong></p>

<p>If you use the REUSE STORAGE clause then the data segments are not de-allocated, which can be marginally more efficient if the table is to be reloaded with data. The high water mark is reset.</p>

<p><hr></p>

<h1>Row scope</h1>

<p>Delete can remove only some rows. Truncate removes all rows.</p>

<p><strong>Oracle</strong></p>

<p>When a table is partitioned, the individual partitions can be truncated in isolation, thus a partial removal of all the table's data is possible.</p>

<p><hr></p>

<h1>Object types</h1>

<p>Delete can be applied to tables and tables inside a cluster. Truncate applies only to tables or the entire cluster. (May be Oracle specific)</p>

<p><hr></p>

<h1>Data Object Identity</h1>

<p><strong>Oracle</strong></p>

<p>Delete does not affect the data object id, but truncate assigns a new data object id <em>unless</em> there has never been an insert against the table since its creation Even a single insert that is rolled back will cause a new data object id to be assigned upon truncation.</p>

<p><hr></p>

<h1>Flashback (Oracle)</h1>

<p>Flashback works across deletes, but a truncate prevents flashback to states prior to the operation.</p>

<p>However, from 11gR2 the FLASHBACK ARCHIVE feature allows this, except in Express Edition</p>

<p><a href=""https://stackoverflow.com/questions/25950145/use-of-flashback-in-oracle"">Use of FLASHBACK in Oracle</a>
<a href=""http://docs.oracle.com/cd/E11882_01/appdev.112/e41502/adfns_flashback.htm#ADFNS638"" rel=""noreferrer"">http://docs.oracle.com/cd/E11882_01/appdev.112/e41502/adfns_flashback.htm#ADFNS638</a></p>

<p><hr></p>

<h1>Privileges</h1>

<p>Variable</p>

<p><strong>Oracle</strong></p>

<p>Delete can be granted on a table to another user or role, but truncate cannot be without using a DROP ANY TABLE grant.</p>

<p><hr></p>

<h1>Redo/Undo</h1>

<p>Delete generates a small amount of redo and a large amount of undo. Truncate generates a negligible amount of each.</p>

<p><hr></p>

<h1>Indexes</h1>

<p><strong>Oracle</strong></p>

<p>A truncate operation renders unusable indexes usable again. Delete does not.</p>

<p><hr></p>

<h1>Foreign Keys</h1>

<p>A truncate cannot be applied when an enabled foreign key references the table. Treatment with delete depends on the configuration of the foreign keys.</p>

<p><hr></p>

<h1>Table Locking</h1>

<p><strong>Oracle</strong></p>

<p>Truncate requires an exclusive table lock, delete requires a shared table lock. Hence disabling table locks is a way of preventing truncate operations on a table.</p>

<p><hr></p>

<h1>Triggers</h1>

<p>DML triggers do not fire on a truncate.</p>

<p><strong>Oracle</strong></p>

<p>DDL triggers are available.</p>

<p><hr></p>

<h1>Remote Execution</h1>

<p><strong>Oracle</strong></p>

<p>Truncate cannot be issued over a database link.</p>

<p><hr></p>

<h1>Identity Columns</h1>

<p><strong>SQL*Server</strong></p>

<p>Truncate resets the sequence for IDENTITY column types, delete does not.</p>

<p><hr></p>

<h1>Result set</h1>

<p>In most implementations, a <code>DELETE</code> statement can return to the client the rows that were deleted.</p>

<p>e.g. in an Oracle PL/SQL subprogram you could:</p>

<pre><code>DELETE FROM employees_temp
WHERE       employee_id = 299 
RETURNING   first_name,
            last_name
INTO        emp_first_name,
            emp_last_name;
</code></pre>
","139633"
"Update a column value, replacing part of a string","252549","","<p>I have a table with the following columns in a MySQL database</p>

<pre><code>[id, url]
</code></pre>

<p>And the urls are like:  </p>

<pre><code> http://domain1.com/images/img1.jpg
</code></pre>

<p>I want to update all the urls to another domain</p>

<pre><code> http://domain2.com/otherfolder/img1.jpg
</code></pre>

<p>keeping the name of the file as is. </p>

<p>What's the query must I run?</p>
","<pre><code>UPDATE urls
SET url = REPLACE(url, 'domain1.com/images/', 'domain2.com/otherfolder/')
</code></pre>
","10177250"
"SQL - find records from one table which don't exist in another","252350","","<p>I've got the following two SQL tables (in MySQL):</p>

<pre><code>Phone_book
+----+------+--------------+
| id | name | phone_number |
+----+------+--------------+
| 1  | John | 111111111111 |
+----+------+--------------+
| 2  | Jane | 222222222222 |
+----+------+--------------+

Call
+----+------+--------------+
| id | date | phone_number |
+----+------+--------------+
| 1  | 0945 | 111111111111 |
+----+------+--------------+
| 2  | 0950 | 222222222222 |
+----+------+--------------+
| 3  | 1045 | 333333333333 |
+----+------+--------------+
</code></pre>

<p>How do I find out which calls were made by people whose <code>phone_number</code> is not in the <code>Phone_book</code>? The desired output would be:</p>

<pre><code>Call
+----+------+--------------+
| id | date | phone_number |
+----+------+--------------+
| 3  | 1045 | 333333333333 |
+----+------+--------------+
</code></pre>

<p>Any help would be much appreciated.</p>
","<p>There's several different ways of doing this, with varying efficiency, depending on how good your query optimiser is, and the relative size of your two tables:</p>

<p>This is the shortest statement, and may be quickest if your phone book is very short:</p>

<pre><code>SELECT  *
FROM    Call
WHERE   phone_number NOT IN (SELECT phone_number FROM Phone_book)
</code></pre>

<p>alternatively (thanks to <a href=""https://stackoverflow.com/users/36848/alterlife"">Alterlife</a>)</p>

<pre><code>SELECT *
FROM   Call
WHERE  NOT EXISTS
  (SELECT *
   FROM   Phone_book
   WHERE  Phone_book.phone_number = Call.phone_number)
</code></pre>

<p>or (thanks to WOPR)</p>

<pre><code>SELECT * 
FROM   Call
LEFT OUTER JOIN Phone_Book
  ON (Call.phone_number = Phone_book.phone_number)
  WHERE Phone_book.phone_number IS NULL
</code></pre>

<p>(ignoring that, as others have said, it's normally best to select just the columns you want, not '<code>*</code>')</p>
","367865"
"SQL 'LIKE' query using '%' where the search criteria contains '%'","250692","","<p>I have an SQL query as below.</p>

<pre><code>Select * from table 
where name like '%' + search_criteria + '%' 
</code></pre>

<p>If search_criteria = 'abc', it will return data containing <code>xxxabcxxxx</code> which is fine.</p>

<p>But if my search_criteria = 'abc%', it will still return data containing <code>xxxabcxxx</code>, which should not be the case.</p>

<p>How do I handle this situation?</p>
","<p>MS-SQL; If you want a <code>%</code> symbol in <code>search_criteria</code> in to be treated as a literal character rather than as a wildcard, escape it to <code>[%]</code>;</p>

<pre><code>.... where name like '%' + replace(search_criteria, '%', '[%]') + '%'
</code></pre>
","10803647"
"Difference between left join and right join in SQL Server","249509","","<p>I know about joins in SQL Server.</p>

<p>For example. there is two tables Table1, Table2. </p>

<p>There table structure are following.</p>

<pre><code>create table Table1 (id int, Name varchar (10))

create table Table2 (id int, Name varchar (10))
</code></pre>

<p>Table1 Data as follows:</p>

<pre><code>    Id     Name     
    -------------
    1      A        
    2      B    
</code></pre>

<p>Table2 Data as follows:</p>

<pre><code>    Id     Name     
    -------------
    1      A        
    2      B 
    3      C
</code></pre>

<p>If I execute both below mentioned SQL statements, both outputs will be the same</p>

<pre><code>select *
from Table1
  left join Table2 on Table1.id = Table2.id

select *
from Table2
  right join Table1 on Table1.id = Table2.id
</code></pre>

<p>Please explain the difference between left and right join in above sql statements.</p>
","<pre><code>Select * from Table1 left join Table2 ...
</code></pre>

<p>and</p>

<pre><code>Select * from Table2 right join Table1 ...
</code></pre>

<p>are indeed completely interchangeable. Try however <code>Table2 left join Table1</code> (or its identical pair, <code>Table1 right join Table2</code>) to see a difference. This query should give you more rows, since Table2 contains a row with an id which is not present in Table1.</p>
","4715723"
"SQL Query to concatenate column values from multiple rows in Oracle","249157","","<p>Would it be possible to construct SQL to concatenate column values from
multiple rows? </p>

<p>The following is an example: </p>

<p>Table A</p>

<pre>
PID
A
B
C
</pre>

<p>Table B</p>

<pre>
PID   SEQ    Desc

A     1      Have
A     2      a nice
A     3      day.
B     1      Nice Work.
C     1      Yes
C     2      we can 
C     3      do 
C     4      this work!
</pre>

<p>Output of the SQL should be -</p>

<pre>
PID   Desc
A     Have a nice day.
B     Nice Work.
C     Yes we can do this work!
</pre>

<p>So basically the Desc column for out put table is a concatenation of the SEQ values from Table B?</p>

<p>Any help with the SQL?</p>
","<p>There are a few ways depending on what version you have - see the <a href=""http://www.oracle-base.com/articles/misc/StringAggregationTechniques.php"" rel=""noreferrer"">oracle documentation on string aggregation techniques</a>. A very common one is to use <a href=""https://docs.oracle.com/cd/E11882_01/server.112/e41084/functions089.htm#SQLRF30030"" rel=""noreferrer""><code>LISTAGG</code></a>:</p>

<pre><code>SELECT pid, LISTAGG(Desc, ' ') WITHIN GROUP (ORDER BY seq) AS desc
FROM B GROUP BY pid;
</code></pre>

<p>Then join to <code>A</code> to pick out the <code>pids</code> you want.</p>

<p><strong>Note:</strong> Out of the box, <code>LISTAGG</code> only works correctly with <code>VARCHAR2</code> columns.</p>
","4686600"
"MySQL's now() +1 day","247679","","<p>I'm using <code>now()</code> in MySQL query.  </p>

<pre><code>INSERT INTO table SET data = '$data', date = now()
</code></pre>

<p>But I want to add 1 day to this date (so that <code>date</code> should contain tomorrow).<br>
Is it possible?</p>
","<p>You can use:</p>

<pre><code>NOW() + INTERVAL 1 DAY
</code></pre>

<p>If you are only interested in the date, not the date and time then you can use CURDATE instead of NOW:</p>

<pre><code>CURDATE() + INTERVAL 1 DAY
</code></pre>
","3887517"
"Using DISTINCT inner join in SQL","247524","","<p>I have three tables, A, B, C, where A is many to one B, and B is many to one C. I'd like a list of all C's in A. </p>

<p>My tables are something like this: A[id, valueA, lookupB], B[id, valueB, lookupC], C[id, valueC]. I've written a query with two nested SELECTs, but I'm wondering if it's possible to do INNER JOIN with DISTINCT somehow.</p>

<pre><code>SELECT valueC
FROM C
INNER JOIN
(
    SELECT DISTINCT lookupC
    FROM B INNER JOIN
    (
        SELECT DISTINCT lookupB
        FROM A
    ) 
    A2 ON B.id = A2.lookupB
) 
B2 ON C.id = B2.lookupC
</code></pre>

<p>EDIT:
The tables are fairly large, A is 500k rows, B is 10k rows and C is 100 rows, so there are a lot of uneccesary info if I do a basic inner join and use DISTINCT in the end, like this:</p>

<pre><code>SELECT DISTINCT valueC
FROM 
C INNER JOIN B on C.id = B.lookupB
INNER JOIN A on B.id = A.lookupB
</code></pre>

<p>This is very, very slow (magnitudes times slower than the nested SELECT I do above.</p>
","<p>I did a test on MS SQL 2005 using the following tables: A 400K rows, B 26K rows and C 450 rows.</p>

<p>The estimated query plan indicated that the basic inner join would be 3 times slower than the nested sub-queries, however when actually running the query, the basic inner join was twice as fast as the nested queries, The basic inner join took 297ms on very minimal server hardware.</p>

<p>What database are you using, and what times are you seeing?  I'm thinking if you are seeing poor performance then it is probably an index problem.</p>
","162312"
"How do I extract data from a DataTable?","246884","","<p>I have a <code>DataTable</code> that is filled in from an SQL query to a local database, but I don't know how to extract data from it.
Main method (in test program):</p>

<pre class=""lang-cs prettyprint-override""><code>static void Main(string[] args)
{
    const string connectionString = ""server=localhost\\SQLExpress;database=master;integrated Security=SSPI;"";
    DataTable table = new DataTable(""allPrograms"");

    using (var conn = new SqlConnection(connectionString))
    {
        Console.WriteLine(""connection created successfuly"");

        string command = ""SELECT * FROM Programs"";

        using (var cmd = new SqlCommand(command, conn))
        {
            Console.WriteLine(""command created successfuly"");

            SqlDataAdapter adapt = new SqlDataAdapter(cmd);

            conn.Open(); 
            Console.WriteLine(""connection opened successfuly"");
            adapt.Fill(table);
            conn.Close();
            Console.WriteLine(""connection closed successfuly"");
        }
    }

    Console.Read();
}
</code></pre>

<p>The command I used to create the tables in my database:</p>

<pre class=""lang-sql prettyprint-override""><code>create table programs
(
    progid int primary key identity(1,1),
    name nvarchar(255),
    description nvarchar(500),
    iconFile nvarchar(255),
    installScript nvarchar(255)
)
</code></pre>

<p>How can I extract data from the <code>DataTable</code> into a form meaningful to use?</p>
","<p>The DataTable has a collection <code>.Rows</code> of DataRow elements.</p>

<p>Each DataRow corresponds to one row in your database, and contains a collection of columns.</p>

<p>In order to access a single value, do something like this:</p>

<pre><code> foreach(DataRow row in YourDataTable.Rows)
 { 
     string name = row[""name""].ToString();
     string description = row[""description""].ToString();
     string icoFileName = row[""iconFile""].ToString();
     string installScript = row[""installScript""].ToString();
 }
</code></pre>

<p>Marc</p>
","1346142"
"How do I format date and time on ssrs report?","246876","","<p>on SSRS report I need to show <code>todays date and current time</code> </p>

<p>i tried this <code>=FormatDateTime(Now,""MM/dd/yyyy hh:mm tt"")</code> but this is not working for me giving an error.</p>

<p>Anyone please help me for <code>expression</code> ?</p>

<p>I want output display like <code>4/12/2013 12:05 PM</code></p>
","<pre><code>=Format(Now(), ""MM/dd/yyyy hh:mm tt"")
</code></pre>

<p>Output:</p>

<p><img src=""https://i.stack.imgur.com/BgxgM.png"" alt=""enter image description here""></p>
","15976113"
"How to combine date from one field with time from another field - MS SQL Server","246046","","<p>In an extract I am dealing with, I have 2 <code>datetime</code> columns. One column stores the dates and another the times as shown.</p>

<p>How can I query the table to combine these two fields into 1 column of type <code>datetime</code>?</p>

<p><strong>Dates</strong></p>

<pre><code>2009-03-12 00:00:00.000
2009-03-26 00:00:00.000
2009-03-26 00:00:00.000
</code></pre>

<p><strong>Times</strong></p>

<pre><code>1899-12-30 12:30:00.000
1899-12-30 10:00:00.000
1899-12-30 10:00:00.000
</code></pre>
","<p>You can simply add the two.</p>

<ul>
<li><strong>if</strong> the <code>Time part</code> of your <code>Date</code> column is always zero  </li>
<li><strong>and</strong> the <code>Date part</code> of your <code>Time</code> column is also always zero <em>(base date: January 1, 1900)</em></li>
</ul>

<p>Adding them returns the correct result.</p>

<pre><code>SELECT Combined = MyDate + MyTime FROM MyTable
</code></pre>

<h3>Rationale (kudos to ErikE/dnolan)</h3>

<pre><code>It works like this due to the way the date is stored as two 4-byte `Integers` with the
left 4-bytes being the `date` and the right 4-bytes being the `time`.  

Its like doing $0001 0000 + $0000 0001 = $0001 0001
</code></pre>

<h3>Edit regarding new SQL Server 2008 types</h3>

<p><code>Date</code> and <code>Time</code> are types introduced in <code>SQL Server 2008</code>. If you insist on adding, you can use <code>Combined = CAST(MyDate AS DATETIME) + CAST(MyTime AS DATETIME)</code></p>

<h3>Edit2 regarding loss of precision in SQL Server 2008 and up (kudos to Martin Smith)</h3> 

<p>Have a look at <a href=""https://dba.stackexchange.com/questions/51440/how-to-combine-date-and-time-to-datetime2-in-sql-server"">How to combine date and time to datetime2 in SQL Server?</a> to prevent loss of precision using SQL Server 2008 and up.</p>
","700649"
"Subtract one day from datetime","245037","","<p>I have a query to fetch date diff between 2 datetime as :</p>

<pre><code>SELECT DATEDIFF(DAY, @CreatedDate , GETDATE())

Ex :

SELECT DATEDIFF(DAY, '2013-03-13 00:00:00.000' , GETDATE())
</code></pre>

<p>I need to have a query work like this which will subtract a day from created day:</p>

<pre><code>SELECT DATEDIFF(DAY, **@CreatedDate- 1** , GETDATE())
</code></pre>
","<p>Try this</p>

<pre><code>SELECT DATEDIFF(DAY,  DATEADD(day, -1, '2013-03-13 00:00:00.000'), GETDATE())
</code></pre>

<p>OR</p>

<pre><code>SELECT DATEDIFF(DAY,  DATEADD(day, -1, @CreatedDate), GETDATE())
</code></pre>
","15632043"
"IDENTITY_INSERT is set to OFF - How to turn it ON?","244919","","<p>I have a deleted file archive database that stores the ID of the file that was deleted,  I want the admin to be able to restore the file (as well as the same ID for linking files).  I do not want to take identity_insert off the entire table, as the increment by one works great.  In my insert to <code>TBL_Content</code> store procedure I have something like this</p>

<pre><code>set ANSI_NULLS ON
set QUOTED_IDENTIFIER ON
SET IDENTITY_INSERT tbl_content ON
GO

ALTER procedure [dbo].[spInsertDeletedIntoTBLContent]
@ContentID int, 
...insert command...
SET IDENTITY_INSERT tbl_content OFF
</code></pre>

<p>But I keep getting the same error:</p>

<blockquote>
  <p>Cannot insert explicit value for identity column in table
  'TBL_Content' when IDENTITY_INSERT is set to OFF.</p>
</blockquote>

<p>Any help?</p>
","<p>Should you instead be setting the identity insert to on within the stored procedure?  It looks like you're setting it to on only when changing the stored procedure, not when actually calling it.  Try:</p>

<pre><code>ALTER procedure [dbo].[spInsertDeletedIntoTBLContent]
@ContentID int, 

SET IDENTITY_INSERT tbl_content ON

...insert command...

SET IDENTITY_INSERT tbl_content OFF
GO
</code></pre>
","3112633"
"CROSS JOIN vs INNER JOIN in SQL Server 2008","244742","","<p>What is the difference between <code>CROSS JOIN</code> AND <code>INNER JOIN</code></p>

<p><strong>CROSS JOIN:</strong></p>

<pre><code>SELECT 
    Movies.CustomerID, Movies.Movie, Customers.Age, 
    Customers.Gender, Customers.[Education Level], 
    Customers.[Internet Connection], Customers.[Marital Status], 
FROM   
    Customers 
CROSS JOIN 
    Movies
</code></pre>

<p><strong>INNER JOIN:</strong></p>

<pre><code>SELECT 
    Movies.CustomerID, Movies.Movie, Customers.Age, 
    Customers.Gender, Customers.[Education Level], 
    Customers.[Internet Connection], Customers.[Marital Status]
FROM   
    Customers 
INNER JOIN 
    Movies ON Customers.CustomerID = Movies.CustomerID
</code></pre>

<p>Which one is better and why would I use either one? </p>
","<p>Cross join does not combine the rows, if you have 100 rows in each table with 1 to 1 match, you get 10.000 results, Innerjoin will only return 100 rows in the same situation.</p>

<p>These 2 examples will return the same result:</p>

<p>Cross join</p>

<pre><code>select * from table1 cross join table2 where table1.id = table2.fk_id
</code></pre>

<p>Inner join</p>

<pre><code>select * from table1 join table2 on table1.id = table2.fk_id
</code></pre>

<p>Use the last method</p>
","17759769"
"Can I use CASE statement in a JOIN condition?","244533","","<p>The following image is a part of Microsoft SQL Server 2008 R2 System Views. From the image we can see that the relationship between <code>sys.partitions</code> and <code>sys.allocation_units</code> depends on the value of <code>sys.allocation_units.type</code>. So to join them together I would write something similar to this:</p>

<pre><code>SELECT  *
FROM    sys.indexes i
        JOIN sys.partitions p
            ON i.index_id = p.index_id 
        JOIN sys.allocation_units a
            ON CASE
               WHEN a.type IN (1, 3)
                   THEN a.container_id = p.hobt_id 
               WHEN a.type IN (2)
                   THEN a.container_id = p.partition_id
               END 
</code></pre>

<p>But the upper code gives a syntax error. I guess that's because of the <code>CASE</code> statement. 
Can anyone help to explain a little?</p>

<p>Thanks!</p>

<hr>

<p>Add error message:</p>

<blockquote>
  <p>Msg 102, Level 15, State 1, Line 6 Incorrect syntax near '='.</p>
</blockquote>

<p><img src=""https://i.stack.imgur.com/HYmiS.jpg"" alt=""this is the image""></p>
","<p>A <code>CASE</code> expression returns a value from the <code>THEN</code> portion of the clause.  You could use it thusly:</p>

<pre><code>SELECT  * 
FROM    sys.indexes i 
    JOIN sys.partitions p 
        ON i.index_id = p.index_id  
    JOIN sys.allocation_units a 
        ON CASE 
           WHEN a.type IN (1, 3) AND a.container_id = p.hobt_id THEN 1
           WHEN a.type IN (2) AND a.container_id = p.partition_id THEN 1
           ELSE 0
           END = 1
</code></pre>

<p>Note that you need to do something with the returned value, e.g. compare it to 1.  Your statement attempted to return the value of an assignment or test for equality, neither of which make sense in the context of a <code>CASE</code>/<code>THEN</code> clause.  (If <code>BOOLEAN</code> was a datatype then the test for equality would make sense.)</p>
","10260297"
"Count work days between two dates","244119","","<p>How can I calculate the number of work days between two dates in SQL Server? </p>

<p>Monday to Friday and it must be T-SQL.</p>
","<p>For workdays, Monday to Friday, you can do it with a single SELECT, like this:</p>

<pre><code>DECLARE @StartDate DATETIME
DECLARE @EndDate DATETIME
SET @StartDate = '2008/10/01'
SET @EndDate = '2008/10/31'


SELECT
   (DATEDIFF(dd, @StartDate, @EndDate) + 1)
  -(DATEDIFF(wk, @StartDate, @EndDate) * 2)
  -(CASE WHEN DATENAME(dw, @StartDate) = 'Sunday' THEN 1 ELSE 0 END)
  -(CASE WHEN DATENAME(dw, @EndDate) = 'Saturday' THEN 1 ELSE 0 END)
</code></pre>

<p>If you want to include holidays, you have to work it out a bit...</p>
","252533"
"Drop all the tables, stored procedures, triggers, constraints and all the dependencies in one sql statement","243838","","<p>Is there any way in which I can clean a database in SQl Server 2005 by dropping all the tables and deleting stored procedures, triggers, constraints and all the dependencies in one SQL statement?</p>

<p><strong>REASON FOR REQUEST:</strong></p>

<p>I want to have a DB script for cleaning up an existing DB which is not in use rather than creating new ones, especially when you have to put in a request to your DB admin and wait for a while to get it done!</p>
","<p>this script cleans all views, SPS, functions PKs, FKs and tables.</p>

<pre><code>/* Drop all non-system stored procs */
DECLARE @name VARCHAR(128)
DECLARE @SQL VARCHAR(254)

SELECT @name = (SELECT TOP 1 [name] FROM sysobjects WHERE [type] = 'P' AND category = 0 ORDER BY [name])

WHILE @name is not null
BEGIN
    SELECT @SQL = 'DROP PROCEDURE [dbo].[' + RTRIM(@name) +']'
    EXEC (@SQL)
    PRINT 'Dropped Procedure: ' + @name
    SELECT @name = (SELECT TOP 1 [name] FROM sysobjects WHERE [type] = 'P' AND category = 0 AND [name] &gt; @name ORDER BY [name])
END
GO

/* Drop all views */
DECLARE @name VARCHAR(128)
DECLARE @SQL VARCHAR(254)

SELECT @name = (SELECT TOP 1 [name] FROM sysobjects WHERE [type] = 'V' AND category = 0 ORDER BY [name])

WHILE @name IS NOT NULL
BEGIN
    SELECT @SQL = 'DROP VIEW [dbo].[' + RTRIM(@name) +']'
    EXEC (@SQL)
    PRINT 'Dropped View: ' + @name
    SELECT @name = (SELECT TOP 1 [name] FROM sysobjects WHERE [type] = 'V' AND category = 0 AND [name] &gt; @name ORDER BY [name])
END
GO

/* Drop all functions */
DECLARE @name VARCHAR(128)
DECLARE @SQL VARCHAR(254)

SELECT @name = (SELECT TOP 1 [name] FROM sysobjects WHERE [type] IN (N'FN', N'IF', N'TF', N'FS', N'FT') AND category = 0 ORDER BY [name])

WHILE @name IS NOT NULL
BEGIN
    SELECT @SQL = 'DROP FUNCTION [dbo].[' + RTRIM(@name) +']'
    EXEC (@SQL)
    PRINT 'Dropped Function: ' + @name
    SELECT @name = (SELECT TOP 1 [name] FROM sysobjects WHERE [type] IN (N'FN', N'IF', N'TF', N'FS', N'FT') AND category = 0 AND [name] &gt; @name ORDER BY [name])
END
GO

/* Drop all Foreign Key constraints */
DECLARE @name VARCHAR(128)
DECLARE @constraint VARCHAR(254)
DECLARE @SQL VARCHAR(254)

SELECT @name = (SELECT TOP 1 TABLE_NAME FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE constraint_catalog=DB_NAME() AND CONSTRAINT_TYPE = 'FOREIGN KEY' ORDER BY TABLE_NAME)

WHILE @name is not null
BEGIN
    SELECT @constraint = (SELECT TOP 1 CONSTRAINT_NAME FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE constraint_catalog=DB_NAME() AND CONSTRAINT_TYPE = 'FOREIGN KEY' AND TABLE_NAME = @name ORDER BY CONSTRAINT_NAME)
    WHILE @constraint IS NOT NULL
    BEGIN
        SELECT @SQL = 'ALTER TABLE [dbo].[' + RTRIM(@name) +'] DROP CONSTRAINT [' + RTRIM(@constraint) +']'
        EXEC (@SQL)
        PRINT 'Dropped FK Constraint: ' + @constraint + ' on ' + @name
        SELECT @constraint = (SELECT TOP 1 CONSTRAINT_NAME FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE constraint_catalog=DB_NAME() AND CONSTRAINT_TYPE = 'FOREIGN KEY' AND CONSTRAINT_NAME &lt;&gt; @constraint AND TABLE_NAME = @name ORDER BY CONSTRAINT_NAME)
    END
SELECT @name = (SELECT TOP 1 TABLE_NAME FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE constraint_catalog=DB_NAME() AND CONSTRAINT_TYPE = 'FOREIGN KEY' ORDER BY TABLE_NAME)
END
GO

/* Drop all Primary Key constraints */
DECLARE @name VARCHAR(128)
DECLARE @constraint VARCHAR(254)
DECLARE @SQL VARCHAR(254)

SELECT @name = (SELECT TOP 1 TABLE_NAME FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE constraint_catalog=DB_NAME() AND CONSTRAINT_TYPE = 'PRIMARY KEY' ORDER BY TABLE_NAME)

WHILE @name IS NOT NULL
BEGIN
    SELECT @constraint = (SELECT TOP 1 CONSTRAINT_NAME FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE constraint_catalog=DB_NAME() AND CONSTRAINT_TYPE = 'PRIMARY KEY' AND TABLE_NAME = @name ORDER BY CONSTRAINT_NAME)
    WHILE @constraint is not null
    BEGIN
        SELECT @SQL = 'ALTER TABLE [dbo].[' + RTRIM(@name) +'] DROP CONSTRAINT [' + RTRIM(@constraint)+']'
        EXEC (@SQL)
        PRINT 'Dropped PK Constraint: ' + @constraint + ' on ' + @name
        SELECT @constraint = (SELECT TOP 1 CONSTRAINT_NAME FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE constraint_catalog=DB_NAME() AND CONSTRAINT_TYPE = 'PRIMARY KEY' AND CONSTRAINT_NAME &lt;&gt; @constraint AND TABLE_NAME = @name ORDER BY CONSTRAINT_NAME)
    END
SELECT @name = (SELECT TOP 1 TABLE_NAME FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE constraint_catalog=DB_NAME() AND CONSTRAINT_TYPE = 'PRIMARY KEY' ORDER BY TABLE_NAME)
END
GO

/* Drop all tables */
DECLARE @name VARCHAR(128)
DECLARE @SQL VARCHAR(254)

SELECT @name = (SELECT TOP 1 [name] FROM sysobjects WHERE [type] = 'U' AND category = 0 ORDER BY [name])

WHILE @name IS NOT NULL
BEGIN
    SELECT @SQL = 'DROP TABLE [dbo].[' + RTRIM(@name) +']'
    EXEC (@SQL)
    PRINT 'Dropped Table: ' + @name
    SELECT @name = (SELECT TOP 1 [name] FROM sysobjects WHERE [type] = 'U' AND category = 0 AND [name] &gt; @name ORDER BY [name])
END
GO
</code></pre>
","1473313"
"Calculating difference between two timestamps in Oracle in milliseconds","243322","","<p>How do I calculate the time difference in milliseconds between two timestamps in Oracle?</p>
","<p>When you subtract two variables of type <code>TIMESTAMP</code>, you get an <code>INTERVAL DAY TO SECOND</code> which includes a number of milliseconds and/or microseconds depending on the platform.  If the database is running on Windows, <code>systimestamp</code> will generally have milliseconds.  If the database is running on Unix, <code>systimestamp</code> will generally have microseconds.</p>

<pre><code>  1  select systimestamp - to_timestamp( '2012-07-23', 'yyyy-mm-dd' )
  2*   from dual
SQL&gt; /

SYSTIMESTAMP-TO_TIMESTAMP('2012-07-23','YYYY-MM-DD')
---------------------------------------------------------------------------
+000000000 14:51:04.339000000
</code></pre>

<p>You can use the <code>EXTRACT</code> function to extract the individual elements of an <code>INTERVAL DAY TO SECOND</code> </p>

<pre><code>SQL&gt; ed
Wrote file afiedt.buf

  1  select extract( day from diff ) days,
  2         extract( hour from diff ) hours,
  3         extract( minute from diff ) minutes,
  4         extract( second from diff ) seconds
  5    from (select systimestamp - to_timestamp( '2012-07-23', 'yyyy-mm-dd' ) diff
  6*           from dual)
SQL&gt; /

      DAYS      HOURS    MINUTES    SECONDS
---------- ---------- ---------- ----------
         0         14         55     37.936
</code></pre>

<p>You can then convert each of those components into milliseconds and add them up</p>

<pre><code>SQL&gt; ed
Wrote file afiedt.buf

  1  select extract( day from diff )*24*60*60*1000 +
  2         extract( hour from diff )*60*60*1000 +
  3         extract( minute from diff )*60*1000 +
  4         round(extract( second from diff )*1000) total_milliseconds
  5    from (select systimestamp - to_timestamp( '2012-07-23', 'yyyy-mm-dd' ) diff
  6*           from dual)
SQL&gt; /

TOTAL_MILLISECONDS
------------------
          53831842
</code></pre>

<p>Normally, however, it is more useful to have either the <code>INTERVAL DAY TO SECOND</code> representation or to have separate columns for hours, minutes, seconds, etc. rather than computing the total number of milliseconds between two <code>TIMESTAMP</code> values.</p>
","11618722"
"What represents a double in sql server?","243316","","<p>I have a couple of properties in <code>C#</code> which are <code>double</code> and I want to store these in a table in SQL Server, but noticed there is no <code>double</code> type, so what is best to use, <code>decimal</code> or <code>float</code>?</p>

<p>This will store latitude and longitude values, so I need the most accurate precision.</p>

<p>Thanks for the responses so far.</p>
","<pre><code>float
</code></pre>

<p>Or if you want to go old-school:</p>

<pre><code>real
</code></pre>

<p>You can also use float(53), but it means the same thing as float.</p>

<p>(""real"" is equivalent to float(24), not float/float(53).)</p>

<p>The <strong>decimal(x,y)</strong> SQL Server type is for when you want <em>exact</em> decimal numbers rather than floating point (which can be approximations). This is in contrast to the C# ""decimal"" data type, which is more like a 128-bit floating point number.</p>

<p>MSSQL <strong>float</strong> does not have <em>exactly</em> the same precision as the 64-bit <strong>double</strong> type in .NET (slight difference in mantissa IIRC), but it's a close enough match most uses.</p>

<p>To make things more confusing, a ""float"" in C# is only 32-bit, so it would be more equivalent in SQL to the real/float(24) type in MSSQL than float/float(53).</p>

<p><strong>In your specific use case...</strong>
All you need is 5 places after the decimal point to represent latitude and longitude within about one-meter precision, and you only need up to three digits before the decimal point for the degrees. Float(24) or decimal(8,5) will best fit your needs in MSSQL, and using float in C# is good enough, you don't need double. In fact, your users will probably thank you for rounding to 5 decimal places rather than having a bunch of insignificant digits coming along for the ride.</p>
","1209190"
"Cast int to varchar","243258","","<p>I have below query and need to cast <code>id</code> to <code>varchar</code></p>

<p><strong>Schema</strong></p>

<pre><code>create table t9 (id int, name varchar (55));
insert into t9( id, name)values(2, 'bob');
</code></pre>

<p><strong>What I tried</strong></p>

<pre><code>select CAST(id as VARCHAR(50)) as col1 from t9;

select CONVERT(VARCHAR(50),id) as colI1 from t9;
</code></pre>

<p>but they don't work. Please suggest.</p>
","<p>You will need to <a href=""http://dev.mysql.com/doc/refman/5.0/en/cast-functions.html#function_cast""><code>cast</code></a> or <a href=""http://dev.mysql.com/doc/refman/5.0/en/cast-functions.html#function_convert""><code>convert</code></a> as a <code>CHAR</code> datatype, there is no <code>varchar</code> datatype that you can cast/convert data to:</p>

<pre><code>select CAST(id as CHAR(50)) as col1 
from t9;

select CONVERT(id, CHAR(50)) as colI1 
from t9;
</code></pre>

<p>See the following SQL — in action — over at <a href=""http://sqlfiddle.com/#!2/cd1eb/3"">SQL Fiddle</a>:</p>

<pre class=""lang-sql prettyprint-override""><code>/*! Build Schema */
create table t9 (id INT, name VARCHAR(55));
insert into t9 (id, name) values (2, 'bob');

/*! SQL Queries */
select CAST(id as CHAR(50)) as col1 from t9;
select CONVERT(id, CHAR(50)) as colI1 from t9;
</code></pre>



<p>Besides the fact that you were trying to convert to an incorrect datatype, the syntax that you were using for <code>convert</code> was incorrect.  The <code>convert</code> function uses the following where <code>expr</code> is your column or value:</p>

<pre><code> CONVERT(expr,type)
</code></pre>

<p>or </p>

<pre><code> CONVERT(expr USING transcoding_name)
</code></pre>

<p>Your original query had the syntax backwards.</p>
","15368852"
"SQL - How to select a row having a column with max value","242881","","<pre><code>date                 value

18/5/2010, 1 pm        40
18/5/2010, 2 pm        20
18/5/2010, 3 pm        60
18/5/2010, 4 pm        30
18/5/2010, 5 pm        60
18/5/2010, 6 pm        25 
</code></pre>

<p>i need to query for the row having max(value)(i.e. 60). So, here we get two rows. From that, I need the row with the lowest time stamp for that day(i.e 18/5/2010, 3 pm -> 60)</p>
","<p>Keywords like TOP, LIMIT, ROWNUM, ...etc are database dependent. Please read this article for more information.</p>

<p><a href=""http://en.wikipedia.org/wiki/Select_(SQL)#Result_limits"" rel=""noreferrer"">http://en.wikipedia.org/wiki/Select_(SQL)#Result_limits</a> </p>

<p>Oracle: ROWNUM could be used.</p>

<pre><code>select * from (select * from table 
order by value desc, date_column) 
where rownum = 1;
</code></pre>

<p>Answering the question more specifically:</p>

<pre><code>select high_val, my_key
from (select high_val, my_key
      from mytable
      where something = 'avalue'
      order by high_val desc)
where rownum &lt;= 1
</code></pre>
","2854309"
"How to trim a string in MS SQL?","242629","","<p>For example:</p>

<pre><code>SELECT TRIM(Names) FROM Customer;
</code></pre>
","<pre><code>SELECT LTRIM(RTRIM(Names)) AS Names FROM Customer
</code></pre>
","179630"
"SQL statement to select all rows from previous day","242078","","<p>I am looking for a good SQL Statement to select all rows from the previous day from one table. The table holds one datetime column. I am using SQL Server 2005.</p>
","<p>get today no time:</p>

<pre><code>SELECT dateadd(day,datediff(day,0,GETDATE()),0)
</code></pre>

<p>get yestersday no time:</p>

<pre><code>SELECT dateadd(day,datediff(day,1,GETDATE()),0)
</code></pre>

<p>query for all of rows from only yesterday:</p>

<pre><code>select 
    * 
    from yourTable
    WHERE YourDate &gt;= dateadd(day,datediff(day,1,GETDATE()),0)
        AND YourDate &lt; dateadd(day,datediff(day,0,GETDATE()),0)
</code></pre>
","1503495"
"Use tnsnames.ora in Oracle SQL Developer","241851","","<p>I am evaluating <a href=""http://www.oracle.com/technology/products/database/sql_developer/index.html"" rel=""noreferrer"">Oracle SQL Developer</a>.</p>

<p>My <code>tnsnames.ora</code> is populated, and a <code>tnsping</code> to a connection defined in <code>tnsnames.ora</code> works fine. Still, SQL Developer does not display any connections.</p>

<p><a href=""http://www.oracle.com/technology/oramag/oracle/06-may/o36sql.html"" rel=""noreferrer"">Oracle SQL Developer Soars </a> mentions, that if</p>

<blockquote>
  <p>you have Oracle client software and a tnsnames.ora file already installed on your machine, Oracle SQL Developer will automatically populate the Connections navigator from the net service names defined in tnsnames.ora.</p>
</blockquote>

<p>I also tried to set my <code>TNS_ADMIN</code> environment variable, but after restarting SQL Developer there are still no connections displayed.</p>

<p>Any ideas?<br>
Anyone successfully working with SQL Developer and tnsnames.ora?</p>
","<ul>
<li>In <strong>SQLDeveloper</strong> browse <strong><code>Tools --&gt; Preferences</code></strong>, as shown in below image.<br/><br/>
<img src=""https://i.stack.imgur.com/28b8A.png"" alt=""SQLDeveloper access preferences""><br/><br/></li>
<li>In the <strong>Preferences</strong> options <strong><code>expand Database --&gt; select Advanced --&gt; under ""Tnsnames Directory"" --&gt; Browse the directory</code></strong> where <strong>tnsnames.ora</strong> present.<br/></li>
<li>Then click on <strong>Ok</strong>,
as shown in below diagram.<br/>
<strong><em>tnsnames.ora</em></strong> available at <strong><code>Drive:\oracle\product\10x.x.x\client_x\NETWORK\ADMIN</code></strong><br/><br/>
<img src=""https://i.stack.imgur.com/9xJeL.png"" alt=""SQLDeveloper update tnsnames directory""></li>
</ul>

<blockquote>
  <p>Now you can connect via the <strong><em>TNSnames</em></strong> options.</p>
</blockquote>
","11612449"
"How can I find which tables reference a given table in Oracle SQL Developer?","239692","","<p>In <a href=""http://www.oracle.com/technology/products/database/sql_developer/index.html"" rel=""noreferrer"">Oracle SQL Developer</a>, if I'm viewing the information on a table, I can view the constraints, which let me see the foreign keys (and thus which tables are referenced by this table), and I can view the dependencies to see what packages and such reference the table. But I'm not sure how to find which tables reference the table.</p>

<p>For example, say I'm looking at the <code>emp</code> table. There is another table <code>emp_dept</code> which captures which employees work in which departments, which references the <code>emp</code> table through <code>emp_id</code>, the primary key of the <code>emp</code> table. Is there a way (through some UI element in the program, not through SQL) to find that the <code>emp_dept</code> table references the <code>emp</code> table, without me having to know that the <code>emp_dept</code> table exists?</p>
","<p>No. There is no such option available from Oracle SQL Developer. </p>

<p>You have to execute a query by hand or use other tool (For instance <a href=""http://www.allroundautomations.com/plsqldev.html"" rel=""noreferrer"">PLSQL Developer</a> has such option). The following SQL is that one used by PLSQL Developer:</p>

<pre><code>select table_name, constraint_name, status, owner
from all_constraints
where r_owner = :r_owner
and constraint_type = 'R'
and r_constraint_name in
 (
   select constraint_name from all_constraints
   where constraint_type in ('P', 'U')
   and table_name = :r_table_name
   and owner = :r_owner
 )
order by table_name, constraint_name
</code></pre>

<p>Where <code>r_owner</code> is the schema, and <code>r_table_name</code> is the table for which you are looking for references. The names are case sensitive</p>

<hr>

<p>Be careful because on the reports tab of Oracle SQL Developer there is the option  ""All tables / Dependencies"" this is from <a href=""http://download.oracle.com/docs/cd/B19306_01/server.102/b14237/statviews_1041.htm#i1576452"" rel=""noreferrer"">ALL_DEPENDENCIES</a> which refers to  ""<em>dependencies between procedures, packages, functions, package bodies, and triggers accessible to the current user, including dependencies on views created without any database links.""</em>. Then, this report have no value for your question.</p>
","1144079"
"Find rows that have the same value on a column in MySQL","237847","","<p>In a [member] table, some rows have the same value for the <code>email</code> column.</p>

<pre><code>login_id | email
---------|---------------------
john     | john123@hotmail.com
peter    | peter456@gmail.com
johnny   | john123@hotmail.com
...
</code></pre>

<p>Some people used a different login_id but the same email address, no unique constraint was set on this column. Now I need to find these rows and see if they should be removed.</p>

<p>What SQL statement should I use to find these rows? (MySQL 5)</p>
","<p>This query will give you a list of email addresses and how many times they're used, with the most used addresses first.</p>

<pre><code>select email, count(*) as c from table
group by email having c &gt; 1
order by c desc
</code></pre>

<p>If you want the full rows:</p>

<pre><code>select * from table where email in (
    select email from table
    group by email having count(*) &gt; 1
)
</code></pre>
","1786568"
"Turn off constraints temporarily (MS SQL)","237685","","<p>I'm looking for a way to temporarily turn off all DB's constraints (eg table relationships).</p>

<p>I need to copy (using INSERTs) one DB's tables to another DB.
I know I can achieve that by executing commands in proper order (to not break relationships).</p>

<p>But it would be easier if I could turn off checking constraints temporarily and turn it back on after the operation's finish.</p>

<p>Is this possible?</p>
","<p>You can disable FK and CHECK constraints <strike>only in SQL 2005+</strike>. See <a href=""http://msdn.microsoft.com/en-us/library/ms190273(SQL.90).aspx"" rel=""noreferrer"">ALTER TABLE</a></p>

<pre><code>ALTER TABLE foo NOCHECK CONSTRAINT ALL
</code></pre>

<p>or</p>

<pre><code>ALTER TABLE foo NOCHECK CONSTRAINT CK_foo_column
</code></pre>

<p>Primary keys and unique constraints can not be disabled, but this should be OK if I've understood you correctly.</p>
","737167"
"update columns values with column of another table based on condition","237683","","<p>I have two tables...</p>

<p>table1 ( id, item, price ) values:</p>

<pre><code>id | item | price
-------------
10 | book | 20  
20 | copy | 30   
30 | pen  | 10
</code></pre>

<p>....table2 ( id, item, price) values:</p>

<pre><code>id | item | price
-------------
10 | book | 20
20 | book | 30
</code></pre>

<p>Now I want to:</p>

<pre><code>update table1 
   set table1.Price = table2.price 
 where table1.id = table2.id
   and table1.item = table2.item.
</code></pre>

<p>How do I do it?</p>
","<p>Something like this should do it : </p>

<pre><code>UPDATE table1 
   SET table1.Price = table2.price 
   FROM table1  INNER JOIN  table2 ON table1.id = table2.id
</code></pre>

<p>You can also try this:
update table1 set price=(select price from table2 where table1.id=table2.id);</p>
","1746161"
"What's the difference between HAVING and WHERE?","237549","","<p>I must be googling in the wrong way or I'm having a stupid moment in time.</p>

<p>What's the difference between <code>HAVING</code> and <code>WHERE</code> in an <code>SQL SELECT</code> statement?</p>

<p>EDIT: I've marked Steven's answer as the correct one as it contained the key bit of information on the link:</p>

<blockquote>
  <p>When <code>GROUP BY</code> is not used, <code>HAVING</code> behaves like a <code>WHERE</code> clause</p>
</blockquote>

<p>The situation I had seen the <code>WHERE</code> in did not have <code>GROUP BY</code> and is where my confusion started. Of course, until you know this you can't specify it in the question.</p>

<p>Many thanks for all the answers which were very enlightening.</p>
","<blockquote>
  <p>HAVING specifies a search condition for a
  group or an aggregate function used in SELECT statement.</p>
</blockquote>

<p><a href=""http://blog.sqlauthority.com/2007/07/04/sql-server-definition-comparison-and-difference-between-having-and-where-clause/"" rel=""noreferrer"">Source</a></p>
","287483"
"How to count occurrences of a column value efficiently in SQL?","237457","","<p>I have a table of students:</p>

<pre><code>id | age
--------
0  | 25
1  | 25
2  | 23
</code></pre>

<p>I want to query for all students, and an additional column that counts how many students are of the same age:</p>

<pre><code>id | age | count
----------------
0  | 25  | 2
1  | 25  | 2
2  | 23  | 1
</code></pre>

<p>What's the most efficient way of doing this? <strong>I fear that a sub-query will be slow, and I'm wondering if there's a better way</strong>. Is there?</p>
","<p>This should work:</p>

<pre><code>SELECT age, count(age) 
  FROM Students 
 GROUP by age
</code></pre>

<p>If you need the id as well you could include the above as a sub query like so:</p>

<pre><code>SELECT S.id, S.age, C.cnt
  FROM Students  S
       INNER JOIN (SELECT age, count(age) as cnt
                     FROM Students 
                    GROUP BY age) C ON S.age = C.age
</code></pre>
","1503980"
"MySql export schema without data","237076","","<p>I'm using a MySql database with a Java program, now I want to give the program to somebody else.</p>

<p>How to export the MySql database structure without the data in it, just the structure?</p>
","<p>You can do with the <code>--no-data</code> option with mysqldump command</p>

<pre class=""lang-sh prettyprint-override""><code>mysqldump -u root -p --no-data dbname &gt; schema.sql
</code></pre>
","6175506"
"MySQL error: key specification without a key length","236540","","<p>I have a table with a primary key that is a varchar(255). Some cases have arisen where 255 characters isn't enough. I tried changing the field to a text, but I get the following error:</p>

<pre><code>BLOB/TEXT column 'message_id' used in key specification without a key length
</code></pre>

<p>how can I fix this?</p>

<p>edit: I should also point out this table has a composite primary key with multiple columns.</p>
","<p>The error happens because MySQL can index only the first N chars of a BLOB or <code>TEXT</code> column. So The error mainly happens when there is a field/column type of <code>TEXT</code> or BLOB or those belong to <code>TEXT</code> or <code>BLOB</code> types such as <code>TINYBLOB</code>, <code>MEDIUMBLOB</code>, <code>LONGBLOB</code>, <code>TINYTEXT</code>, <code>MEDIUMTEXT</code>, and <code>LONGTEXT</code> that you try to make a primary key or index. With full <code>BLOB</code> or <code>TEXT</code> without the length value, MySQL is unable to guarantee the uniqueness of the column as it’s of variable and dynamic size. So, when using <code>BLOB</code> or <code>TEXT</code> types as an index, the value of N must be supplied so that MySQL can determine the key length. However, MySQL doesn’t support a key length limit on <code>TEXT</code> or <code>BLOB</code>. <code>TEXT(88)</code> simply won’t work.</p>

<p>The error will also pop up when you try to convert a table column from <code>non-TEXT</code> and <code>non-BLOB</code> type such as <code>VARCHAR</code> and <code>ENUM</code> into <code>TEXT</code> or <code>BLOB</code> type, with the column already been defined as unique constraints or index. The Alter Table SQL command will fail.</p>

<p>The solution to the problem is to remove the <code>TEXT</code> or <code>BLOB</code> column from the index or unique constraint or set another field as primary key. If you can't do that, and wanting to place a limit on the <code>TEXT</code> or <code>BLOB</code> column, try to use <code>VARCHAR</code> type and place a limit of length on it. By default, <code>VARCHAR</code> is limited to a maximum of 255 characters and its limit must be specified implicitly within a bracket right after its declaration, i.e <code>VARCHAR(200)</code> will limit it to 200 characters long only.</p>

<p>Sometimes, even though you don’t use <code>TEXT</code> or <code>BLOB</code> related type in your table, the Error 1170 may also appear. It happens in a situation such as when you specify <code>VARCHAR</code> column as primary key, but wrongly set its length or characters size. <code>VARCHAR</code> can only accepts up to 256 characters, so anything such as <code>VARCHAR(512)</code> will force MySQL to auto-convert the <code>VARCHAR(512)</code> to a <code>SMALLTEXT</code> datatype, which subsequently fails with error 1170 on key length if the column is used as primary key or unique or non-unique index. To solve this problem, specify a figure less than 256 as the size for <code>VARCHAR</code> field.</p>

<p>Reference: <a href=""http://www.mydigitallife.info/2007/07/09/mysql-error-1170-42000-blobtext-column-used-in-key-specification-without-a-key-length/"" rel=""noreferrer"">MySQL Error 1170 (42000): BLOB/TEXT Column Used in Key Specification Without a Key Length</a></p>
","1827099"
"delete from two tables in one query","236530","","<p>i have two tables in mysql </p>

<pre><code>#messages table  : 
messageid
messagetitle 
.
.

#usersmessages table 
usersmessageid 
messageid
userid
.
.
</code></pre>

<p>now i want to delete from messages table it's ok . but when i delete message with messageid='1' for example it's still exists on usersmessage i have to delete from this two tables at once  ; </p>

<p>so i use the following query : </p>

<pre><code>DELTE FROM messages LEFT JOIN usersmessages USING(messageid) WHERE messageid='1' ; 
</code></pre>

<p>then i test </p>

<pre><code>   DELETE FROM messages , usersmessages 
   WHERE messages.messageid = usersmessages.messageid 
   and messageid='1' ; 
</code></pre>

<p>but this two queries is not accoumplish this task . </p>
","<p>Can't you just separate them by a semicolon?</p>

<pre><code>Delete from messages where messageid = '1';
Delete from usersmessages where messageid = '1'
</code></pre>

<p><strong>OR</strong></p>

<p>Just use <code>INNER JOIN</code> as below</p>

<pre><code>DELETE messages , usersmessages  FROM messages  INNER JOIN usersmessages  
WHERE messages.messageid= usersmessages.messageid and messages.messageid = '1'
</code></pre>
","1233479"
"How to describe table in SQL Server 2008?","236497","","<p>I want to describe a table in SQL Server 2008 like what we can do with the <code>DESC</code> command in Oracle.</p>

<p>I have table <code>[EX].[dbo].[EMP_MAST]</code> which I want to describe, but it does not work.</p>

<p>Error shown:  </p>

<blockquote>
  <p>The object 'EMP_MAST' does not exist in database 'master' or is
  invalid for this operation.</p>
</blockquote>
","<p>According to <a href=""http://ss64.com/ora/desc.html"" rel=""noreferrer"">this documentation</a>:</p>

<blockquote>
  <p>DESC MY_TABLE</p>
  
  <p>is equivalent to</p>
  
  <p>SELECT column_name ""Name"", nullable ""Null?"",
  concat(concat(concat(data_type,'('),data_length),')') ""Type"" FROM
  user_tab_columns WHERE table_name='TABLE_NAME_TO_DESCRIBE';</p>
</blockquote>

<p>I've roughly translated that to the SQL Server equivalent for you - just make sure you're running it on the <code>EX</code> database.</p>

<pre><code>SELECT column_name AS [name],
       IS_NULLABLE AS [null?],
       DATA_TYPE + COALESCE('(' + CASE WHEN CHARACTER_MAXIMUM_LENGTH = -1
                                  THEN 'Max'
                                  ELSE CAST(CHARACTER_MAXIMUM_LENGTH AS VARCHAR(5))
                                  END + ')', '') AS [type]
FROM   INFORMATION_SCHEMA.Columns
WHERE  table_name = 'EMP_MAST'
</code></pre>
","11082116"
"Export SQL query data to Excel","236460","","<p>I have a query that returns a very large data set. I cannot copy and paste it into Excel which I usually do. I have been doing some research on how to export directly to an Excel sheet. I am running SQL SERVER 2008 on a server running Microsoft Server 2003. I am trying to use the Microsoft.Jet.OLEDB.4.0 data provider and Excel 2007. I've pieced together a small piece of code that looks like this from what I've seen in examples.</p>

<pre><code>INSERT INTO OPENDATASOURCE('Microsoft.Jet.OLEDB.4.0',
'Data Source=C:\Working\Book1.xlsx;Extended Properties=EXCEL 12.0;HDR=YES')
SELECT productid, price FROM dbo.product
</code></pre>

<p>However this is not working, I am getting an error message saying </p>

<blockquote>
  <p>""Incorrect syntax near the keyword 'SELECT'"".</p>
</blockquote>

<p>Does anyone have any ideas about how to do this or possibly a better approach?</p>
","<p>I don't know if this is what you're looking for, but you can export the results to Excel like this:</p>

<p>In the results pane, click the top-left cell to highlight all the records, and then right-click the top-left cell and click ""Save Results As"". One of the export options is CSV.</p>

<p>You might give this a shot too:</p>

<pre><code>INSERT INTO OPENROWSET 
   ('Microsoft.Jet.OLEDB.4.0', 
   'Excel 8.0;Database=c:\Test.xls;','SELECT productid, price FROM dbo.product')
</code></pre>

<p>Lastly, you can look into using SSIS (replaced DTS) for data exports. Here is a link to a tutorial:</p>

<p><a href=""http://www.accelebrate.com/sql_training/ssis_2008_tutorial.htm"" rel=""noreferrer"">http://www.accelebrate.com/sql_training/ssis_2008_tutorial.htm</a></p>
","7390928"
"java.util.Date vs java.sql.Date","235915","","<p><code>java.util.Date</code> vs <code>java.sql.Date</code>: when to use which and why?</p>
","<p>Congratulations, you've hit my favorite pet peeve with JDBC: Date class handling.</p>

<p>Basically databases usually support at least <strong>three</strong> forms of datetime fields which are date, time and timestamp. Each of these have a corresponding class in JDBC and <strong>each of them extend <a href=""http://docs.oracle.com/javase/8/docs/api/index.html?java/util/Date.html"" rel=""noreferrer""><code>java.util.Date</code></a></strong>. Quick semantics of each of these three are the following:</p>

<ul>
<li><a href=""http://docs.oracle.com/javase/8/docs/api/index.html?java/sql/Date.html"" rel=""noreferrer""><code>java.sql.Date</code></a> corresponds to SQL DATE which means it stores <em>years, months and days</em> while <em>hour, minute, second and millisecond</em> are ignored. Additionally <code>sql.Date</code> isn't tied to timezones.</li>
<li><a href=""http://docs.oracle.com/javase/8/docs/api/index.html?java/sql/Time.html"" rel=""noreferrer""><code>java.sql.Time</code></a> corresponds to SQL TIME and as should be obvious, only contains information about <em>hour, minutes, seconds and milliseconds</em>.</li>
<li><a href=""http://docs.oracle.com/javase/8/docs/api/index.html?java/sql/Timestamp.html"" rel=""noreferrer""><code>java.sql.Timestamp</code></a> corresponds to SQL TIMESTAMP which is exact date to the nanosecond (<em>note that <code>util.Date</code> only supports milliseconds!</em>) with customizable precision.</li>
</ul>

<p><strong>One of the most common bugs when using JDBC drivers in relation to these three types is that the types are handled incorrectly.</strong> This means that <code>sql.Date</code> is timezone specific, <code>sql.Time</code> contains current year, month and day et cetera et cetera.</p>

<h2>Finally: Which one to use?</h2>

<p>Depends on the SQL type of the field, really. <code>PreparedStatement</code> has setters for all three values, <code>#setDate()</code> being the one for <code>sql.Date</code>, <code>#setTime()</code> for <code>sql.Time</code> and <code>#setTimestamp()</code> for <code>sql.Timestamp</code>.</p>

<p>Do note that if you use <code>ps.setObject(fieldIndex, utilDateObject);</code> you can actually give a normal <code>util.Date</code> to most JDBC drivers which will happily devour it as if it was of the correct type but when you request the data afterwards, you may notice that you're actually missing stuff.</p>

<h2>I'm really saying that none of the Dates should be used at all.</h2>

<p>What I am saying that save the milliseconds/nanoseconds as plain longs and convert them to whatever objects you are using (<em><a href=""http://www.joda.org/joda-time/"" rel=""noreferrer"">obligatory joda-time plug</a></em>). One hacky way which can be done is to store the date component as one long and time component as another, for example right now would be 20100221 and 154536123. These magic numbers can be used in SQL queries and will be portable from database to another and will let you avoid this part of JDBC/Java Date API:s entirely.</p>
","2306051"
"How do I concatenate text in a query in sql server?","235825","","<p>The following SQL:</p>

<pre><code>SELECT notes + 'SomeText'
FROM NotesTable a 
</code></pre>

<p>Give the error:</p>

<blockquote>
  <p>The data types nvarchar and text are incompatible in the add operator.</p>
</blockquote>
","<p>The only way would be to convert your text field into an nvarchar field.</p>

<pre><code>Select Cast(notes as nvarchar(4000)) + 'SomeText'
From NotesTable a
</code></pre>

<p>Otherwise, I suggest doing the concatenation in your application.</p>
","54343"
"Search for a string in all tables, rows and columns of a DB","235799","","<p>I am lost in a big database and I am not able to find where the data I get comes from. I was wondering if it is possible with SQL Server 2005 to search for a string in all tables, rows and columns of a database?</p>

<p>Does anybody has an idea if it is possible and how?</p>
","<p>This code should do it in SQL 2005, but a few caveats:</p>

<ol>
<li><p>It is RIDICULOUSLY slow. I tested it on a small database that I have with only a handful of tables and it took many minutes to complete. If your database is so big that you can't understand it then this will probably be unusable anyway.</p></li>
<li><p>I wrote this off the cuff. I didn't put in any error handling and there might be some other sloppiness especially since I don't use cursors often. For example, I think there's a way to refresh the columns cursor instead of closing/deallocating/recreating it every time.</p></li>
</ol>

<p>If you can't understand the database or don't know where stuff is coming from, then you should probably find someone who does. Even if you can find where the data is, it might be duplicated somewhere or there might be other aspects of the database that you don't understand. If no one in your company understands the database then you're in a pretty big mess.</p>

<pre><code>DECLARE
    @search_string  VARCHAR(100),
    @table_name     SYSNAME,
    @table_schema   SYSNAME,
    @column_name    SYSNAME,
    @sql_string     VARCHAR(2000)

SET @search_string = 'Test'

DECLARE tables_cur CURSOR FOR SELECT TABLE_SCHEMA, TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE'

OPEN tables_cur

FETCH NEXT FROM tables_cur INTO @table_schema, @table_name

WHILE (@@FETCH_STATUS = 0)
BEGIN
    DECLARE columns_cur CURSOR FOR SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = @table_schema AND TABLE_NAME = @table_name AND COLLATION_NAME IS NOT NULL  -- Only strings have this and they always have it

    OPEN columns_cur

    FETCH NEXT FROM columns_cur INTO @column_name
    WHILE (@@FETCH_STATUS = 0)
    BEGIN
        SET @sql_string = 'IF EXISTS (SELECT * FROM ' + QUOTENAME(@table_schema) + '.' + QUOTENAME(@table_name) + ' WHERE ' + QUOTENAME(@column_name) + ' LIKE ''%' + @search_string + '%'') PRINT ''' + QUOTENAME(@table_schema) + '.' + QUOTENAME(@table_name) + ', ' + QUOTENAME(@column_name) + ''''

        EXECUTE(@sql_string)

        FETCH NEXT FROM columns_cur INTO @column_name
    END

    CLOSE columns_cur

    DEALLOCATE columns_cur

    FETCH NEXT FROM tables_cur INTO @table_schema, @table_name
END

CLOSE tables_cur

DEALLOCATE tables_cur
</code></pre>
","591991"
"Remove Trailing Spaces and Update in Columns in SQL Server","235171","","<p>I have trailing spaces in a column in a SQL Server table called <code>Company Name</code>.</p>

<p>All data in this column has trailing spaces.</p>

<p>I want to remove all those, and I want to have the data without any trailing spaces.</p>

<p>The company name is like <code>""Amit Tech Corp         ""</code></p>

<p>I want the company name to be <code>""Amit Tech Corp""</code></p>
","<p>Try 
<code>SELECT LTRIM(RTRIM('Amit Tech Corp '))</code></p>

<p><a href=""https://docs.microsoft.com/en-us/sql/t-sql/functions/ltrim-transact-sql"" rel=""nofollow noreferrer""><code>LTRIM</code></a> - removes any leading spaces from left side of string</p>

<p><a href=""https://docs.microsoft.com/en-us/sql/t-sql/functions/rtrim-transact-sql"" rel=""nofollow noreferrer""><code>RTRIM</code></a> - removes any spaces from right</p>

<p>Ex: </p>

<pre><code>update table set CompanyName = LTRIM(RTRIM(CompanyName))
</code></pre>
","14782025"
"How to find sum of multiple columns in a table in SQL Server 2005?","234852","","<p>I have a table <code>Emp</code> which has these rows:</p>

<pre><code>Emp_cd | Val1  | Val2  | Val3  | Total
-------+-------+-------+-------+-------
 1     | 1.23  | 2.23  | 3.43  | 
 2     | 23.03 | 12.23 | 2.92  |
 3     | 7.23  | 9.05  | 13.43 |
 4     | 03.21 | 78.23 | 9.43  |
</code></pre>

<p>I want to find <code>SUM</code> of <code>Val1, Val2, Val3</code> and which will show in the <code>Total</code> column.</p>
","<p>Easy:</p>

<pre><code>SELECT 
   Val1,
   Val2,
   Val3,
   (Val1 + Val2 + Val3) as 'Total'
FROM Emp
</code></pre>

<p>or if you just want one row:</p>

<pre><code>SELECT 
   SUM(Val1) as 'Val1',
   SUM(Val2) as 'Val2',
   SUM(Val3) as 'Val3',
   (SUM(Val1) + SUM(Val2) + SUM(Val3)) as 'Total'
FROM Emp
</code></pre>
","11033391"
"Describe table structure","234625","","<p>Which query will give the table structure with column definitions in SQL?</p>
","<p><a href=""http://msdn.microsoft.com/en-us/library/ms187335.aspx"" rel=""nofollow noreferrer"">sp_help</a> tablename in sql server -- <code>sp_help [ [ @objname = ] 'name' ]</code>  </p>

<p><a href=""https://docs.oracle.com/javadb/10.8.3.0/tools/rtoolsijcomrefdescribe.html"" rel=""nofollow noreferrer"">desc</a> tablename in oracle -- <code>DESCRIBE { table-Name | view-Name }</code></p>
","3362240"
"Convert Datetime column from UTC to local time in select statement","232814","","<p>I'm doing a few SQL select queries and would like to convert my UTC datetime column into local time to be displayed as local time in my query results. Note, I am NOT looking to do this conversion via code but rather when I am doing manual and random SQL queries against my databases.</p>
","<p>You can do this as follows on SQL Server 2008 or greater:</p>

<pre><code>SELECT CONVERT(datetime, 
               SWITCHOFFSET(CONVERT(datetimeoffset, 
                                    MyTable.UtcColumn), 
                            DATENAME(TzOffset, SYSDATETIMEOFFSET()))) 
       AS ColumnInLocalTime
FROM MyTable
</code></pre>

<p>You can also do the less verbose:</p>

<pre><code>SELECT DATEADD(mi, DATEDIFF(mi, GETUTCDATE(), GETDATE()), MyTable.UtcColumn) 
       AS ColumnInLocalTime
FROM MyTable
</code></pre>

<p>Whatever you do, <strong>do not</strong> use <code>-</code> to subtract dates, because the operation is not atomic, and you will on occasion get indeterminate results due to race conditions between the system datetime and the local datetime being checked at different times (i.e., non-atomically).</p>

<p>Please note that this answer does not take DST into account. If you want to include a DST adjustment, please also see the following SO question:</p>

<p><a href=""https://stackoverflow.com/questions/19732896/how-to-create-daylight-savings-time-start-and-end-function-in-sql-server"">How to create Daylight Savings time Start and End function in SQL Server</a></p>
","8038792"
"Read SQL Table into C# DataTable","232575","","<p>I've read a lot of posts about inserting a DataTable into a SQL table, but is there an easy way to pull a SQL table into a .NET DataTable?</p>
","<p>Here, give this a shot (this is just a pseudocode)</p>

<pre><code>using System;
using System.Data;
using System.Data.SqlClient;


public class PullDataTest
{
    // your data table
    private DataTable dataTable = new DataTable();

    public PullDataTest()
    {
    }

    // your method to pull data from database to datatable   
    public void PullData()
    {
        string connString = @""your connection string here"";
        string query = ""select * from table"";

        SqlConnection conn = new SqlConnection(connString);        
        SqlCommand cmd = new SqlCommand(query, conn);
        conn.Open();

        // create data adapter
        SqlDataAdapter da = new SqlDataAdapter(cmd);
        // this will query your database and return the result to your datatable
        da.Fill(dataTable);
        conn.Close();
        da.Dispose();
    }
}
</code></pre>
","6073545"
"COUNT DISTINCT with CONDITIONS","232483","","<p>I want to count the number of distinct items in a column subject to a certain condition, for example if the table is like this:</p>

<pre><code>tag | entryID
----+---------
foo | 0
foo | 0
bar | 3
</code></pre>

<p>If I want to count the number of distinct tags as ""tag count"" and count the number of distinct tags with entry id > 0 as ""positive tag count"" in the same table, what should I do?</p>

<p>I'm now counting from two different tables where in the second table I've only selected those rows with entryID larger than zero. I think there should be a more compact way to solve this problem.</p>
","<p>You can try this:</p>

<pre><code>select
  count(distinct tag) as tag_count,
  count(distinct (case when entryId &gt; 0 then tag end)) as positive_tag_count
from
  your_table_name;
</code></pre>

<p>The first <code>count(distinct...)</code> is easy.
The second one, looks somewhat complex, is actually the same as the first one, except that you use <code>case...when</code> clause. In the <code>case...when</code> clause, you filter only positive values. Zeros or negative values would be <code>null</code> and don't be included in count.</p>

<p>One thing to note here is that this can be done by reading the table once. When it seems that you have to read the same table twice or more, it can actually be done by reading once, in most of the time. As a result, it will finish the task a lot faster with less I/O.</p>
","14048147"
"How to quickly edit values in table in SQL Server Management Studio?","231548","","<p>Aside from context menu -> ""Edit Top 200 Rows"" from Object Explorer, is there a quick way to open a table in Edit mode where I can just quickly modify the value of a cell?  </p>

<p>I need to be able to page past the first 200 rows. And I dont want to write ""insert"" script for every minor tweak I need to do... I don't understand why SMS doesn't offer quick access to a paged table editor (like Navicat).</p>
","<p>In Mgmt Studio, when you are editing the top 200, you can view the SQL pane - either by right clicking in the grid and choosing Pane->SQL or by the button in the upper left.  This will allow you to write a custom query to drill down to the row(s) you want to edit.</p>

<p>But ultimately mgmt studio isn't a data entry/update tool which is why this is a little cumbersome.</p>
","1535498"
"How to concatenate strings of a string field in a PostgreSQL 'group by' query?","231501","","<p>I am looking for a way to concatenate the strings of a field within a group by query. So for example, I have a table:</p>

<pre><code>ID   COMPANY_ID   EMPLOYEE
1    1            Anna
2    1            Bill
3    2            Carol
4    2            Dave
</code></pre>

<p>and I wanted to group by company_id to get something like:</p>

<pre><code>COMPANY_ID   EMPLOYEE
1            Anna, Bill
2            Carol, Dave
</code></pre>

<p>There is a built-in function in mySQL to do this <a href=""http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat"" rel=""noreferrer"">group_concat</a></p>
","<h3>Update as of PostgreSQL 9.0:</h3>

<p>Recent versions of Postgres (since late 2010) have the <a href=""http://www.postgresql.org/docs/current/static/functions-aggregate.html#FUNCTIONS-AGGREGATE-TABLE"" rel=""noreferrer""><code>string_agg(expression, delimiter)</code></a> function that will do exactly what the question asked for, even letting you specify the delimiter string:</p>

<pre><code>SELECT company_id, string_agg(employee, ', ')
FROM mytable
GROUP BY company_id;
</code></pre>

<h3>Update as of PostgreSQL 8.4:</h3>

<p>PostgreSQL 8.4 (in 2009) introduced <a href=""http://www.postgresql.org/docs/8.4/interactive/functions-aggregate.html"" rel=""noreferrer"" title=""array_agg&#40;expression&#41;"">the aggregate function <code>array_agg(expression)</code></a> which concatenates the values into an array. Then <code>array_to_string()</code> can be used to give the desired result:</p>

<pre><code>SELECT company_id, array_to_string(array_agg(employee), ', ')
FROM mytable
GROUP BY company_id;
</code></pre>

<h3>Original Answer (for pre-8.4 PostgreSQL):</h3>

<p>There is no built-in aggregate function to concatenate strings. It seems like this would be needed, but it's not part of the default set. A web search however reveals some manual implementations <a href=""http://archives.postgresql.org/pgsql-novice/2003-09/msg00177.php"" rel=""noreferrer"">the same example</a>:</p>

<pre><code>CREATE AGGREGATE textcat_all(
  basetype    = text,
  sfunc       = textcat,
  stype       = text,
  initcond    = ''
);
</code></pre>

<p><a href=""http://www.postgresql.org/docs/8.3/static/sql-createaggregate.html"" rel=""noreferrer"">Here is the <code>CREATE AGGREGATE</code> documentation.</a></p>

<p>In order to get the "", "" inserted in between them without having it at the end, you might want to make your own concatenation function and substitute it for the ""textcat"" above. Here is one I put together but haven't tested (<strong><em>update:</strong> tested on 8.3.12 and working fine</em>):</p>

<pre><code>CREATE FUNCTION commacat(acc text, instr text) RETURNS text AS $$
  BEGIN
    IF acc IS NULL OR acc = '' THEN
      RETURN instr;
    ELSE
      RETURN acc || ', ' || instr;
    END IF;
  END;
$$ LANGUAGE plpgsql;
</code></pre>

<p><strong><em>Note:</strong> The function above will output a comma even if the value in the row is null/empty, which outputs:</em></p>

<pre><code>a, b, c, , e, , g
</code></pre>

<p><em>If you would prefer to remove extra commas to output:</em></p>

<pre><code>a, b, c, e, g
</code></pre>

<p><em>just add an <code>ELSIF</code> check to the function:</em></p>

<pre><code>CREATE FUNCTION commacat_ignore_nulls(acc text, instr text) RETURNS text AS $$
  BEGIN
    IF acc IS NULL OR acc = '' THEN
      RETURN instr;
    ELSIF instr IS NULL OR instr = '' THEN
      RETURN acc;
    ELSE
      RETURN acc || ', ' || instr;
    END IF;
  END;
$$ LANGUAGE plpgsql;
</code></pre>
","43944"
"SQL SERVER: Get total days between two dates","231138","","<p>I'm trying to get the total number of days between two days:</p>

<pre><code>1/1/2011
3/1/2011

RETURN
62
</code></pre>

<p>Is it possible to do in SQL Server?</p>
","<p><code>PRINT DATEDIFF(DAY, '1/1/2011', '3/1/2011')</code> will give you what you're after.</p>

<p>This gives the number of times the midnight boundary is crossed between the two dates.  You may decide to need to add one to this if you're including both dates in the count - or subtract one if you don't want to include either date.</p>
","6068048"
"How to debug ORA-01775: looping chain of synonyms?","230464","","<p>I'm familiar with the issue behind ORA-01775: looping chain of synonyms, but is there any trick to debugging it, or do I just have to ""create or replace"" my way out of it?  </p>

<p>Is there a way to query the schema or whatever to find out what the current definition of a public synonym is?  </p>

<p>Even more awesome would be a graphical tool, but at this point, anything would be helpful.</p>
","<p>As it turns out, the problem wasn't actually a looping chain of synonyms, but the fact that the synonym was pointing to a view that did not exist.</p>

<p>Oracle apparently errors out as a looping chain in this condition.</p>
","247620"
"How to use DbContext.Database.SqlQuery<TElement>(sql, params) with stored procedure? EF Code First CTP5","229777","","<p>I have a stored procedure that has three parameters and I've been trying to use the following to return the results:</p>

<pre><code>context.Database.SqlQuery&lt;myEntityType&gt;(""mySpName"", param1, param2, param3);
</code></pre>

<p>At first I tried using <code>SqlParameter</code> objects as the params but this didn't work and threw a <code>SqlException</code> with the following message:</p>

<blockquote>
  <p>Procedure or function 'mySpName' expects parameter '@param1', which was not supplied.</p>
</blockquote>

<p>So my question is how you can use this method with a stored procedure that expects parameters?</p>

<p>Thanks.</p>
","<p>You should supply the SqlParameter instances in the following way:  </p>

<pre><code>context.Database.SqlQuery&lt;myEntityType&gt;(
    ""mySpName @param1, @param2, @param3"",
    new SqlParameter(""param1"", param1),
    new SqlParameter(""param2"", param2),
    new SqlParameter(""param3"", param3)
);
</code></pre>
","4874600"
"Conversion failed when converting the varchar value 'simple, ' to data type int","228779","","<p>I am struggling for a few days with this issue and I can't figure out how can I fix it.</p>

<p>I would like to <code>group by</code> my table on values 1,2,3,4,5 so I have created a temporary table with this values.</p>

<p>Now I have to INNER JOIN this table with other tables on <code>a.value = #myTempTable.num</code>
BUT <code>a.value</code> is <code>ntext</code> so I need to CONVERT it what I actually did, but I am getting an error:</p>

<pre><code>Conversion failed when converting the varchar value 'simple, ' to data type int. 
</code></pre>

<p>(on line 7)</p>

<pre><code>Create table #myTempTable
(
num int
)
insert into #myTempTable (num) values (1),(2),(3),(4),(5)

 SELECT a.name, CONVERT(INT, CONVERT(VARCHAR(12), a.value)) AS value, COUNT(*) AS pocet   
 FROM 
 (SELECT item.name, value.value 
  FROM mdl_feedback AS feedback 
  INNER JOIN mdl_feedback_item AS item 
       ON feedback.id = item.feedback
  INNER JOIN mdl_feedback_value AS value 
       ON item.id = value.item 
   WHERE item.typ = 'multichoicerated' AND item.feedback IN (43)
 ) AS a 
 INNER JOIN #myTempTable 
     on CONVERT(INT, CONVERT(VARCHAR(12), a.value)) = #myTempTable.num
 GROUP BY a.name, CONVERT(INT, CONVERT(VARCHAR(12), a.value)) ORDER BY a.name

 drop table #myTempTable
</code></pre>

<p>I am not getting this error without the last INNER JOIN </p>

<pre><code>INNER JOIN #myTempTable on CONVERT(INT, CONVERT(VARCHAR(12), a.value))
= #myTempTable.num
</code></pre>

<p>Could you help me please? I am desperate.</p>

<p>Thanks.</p>
","<p>In order to avoid such error you could use <code>CASE</code> + <code>ISNUMERIC</code> to handle scenarios when you cannot convert to int. 
<br>Change  </p>

<pre><code>CONVERT(INT, CONVERT(VARCHAR(12), a.value))
</code></pre>

<p>To </p>

<pre><code>CONVERT(INT, CASE WHEN IsNumeric(CONVERT(VARCHAR(12), a.value)) = 1 then CONVERT(VARCHAR(12), a.value) else 0 End) 
</code></pre>

<p>Basically this is saying if you cannot convert me to int assign value of 0 (in my example)</p>

<p>Alternatively you can look at this article about creating a custom function that will check if <code>a.value</code> is number: <a href=""http://www.tek-tips.com/faqs.cfm?fid=6423"" rel=""nofollow noreferrer"">http://www.tek-tips.com/faqs.cfm?fid=6423</a></p>
","21984828"
"Equals(=) vs. LIKE","228081","","<p>When using SQL, are there any benefits of using <code>=</code> in a <code>WHERE</code> clause instead of <code>LIKE</code>?</p>

<p>Without any special operators, <code>LIKE</code> and <code>=</code> are the same, right?</p>
","<h1>Different Operators</h1>

<p><code>LIKE</code> and <code>=</code> are different operators. Most answers here focus on the wildcard support, which is not the only difference between these operators!</p>

<p><code>=</code> is a comparison operator that operates on numbers and strings. When comparing strings, the comparison operator compares <em>whole strings</em>.</p>

<p><code>LIKE</code> is a string operator that compares <em>character by character</em>.</p>

<p>To complicate matters, both operators use a <a href=""http://dev.mysql.com/doc/refman/5.1/en/charset-general.html"" rel=""noreferrer"">collation</a> which can have important effects on the result of the comparison.</p>

<h1>Motivating Example</h1>

<p>Let's first identify an example where these operators produce obviously different results. Allow me to quote from the MySQL manual:</p>

<blockquote>
  <p>Per the SQL standard, LIKE performs matching on a per-character basis, thus it can produce results different from the = comparison operator:</p>
</blockquote>

<pre><code>mysql&gt; SELECT 'ä' LIKE 'ae' COLLATE latin1_german2_ci;
+-----------------------------------------+
| 'ä' LIKE 'ae' COLLATE latin1_german2_ci |
+-----------------------------------------+
|                                       0 |
+-----------------------------------------+
mysql&gt; SELECT 'ä' = 'ae' COLLATE latin1_german2_ci;
+--------------------------------------+
| 'ä' = 'ae' COLLATE latin1_german2_ci |
+--------------------------------------+
|                                    1 |
+--------------------------------------+
</code></pre>

<p>Please note that this page of the MySQL manual is called <em>String Comparison Functions</em>, and <code>=</code> is not discussed, which implies that <code>=</code> is not strictly a string comparison function.</p>

<h1>How Does <code>=</code> Work?</h1>

<p>The <a href=""http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt"" rel=""noreferrer"">SQL Standard § 8.2</a> describes how <code>=</code> compares strings:</p>

<blockquote>
  <p>The comparison of two character strings is determined as follows:</p>
  
  <p>a) If the length in characters of X is not equal to the length
  in characters of Y, then the shorter string is effectively
  replaced, for the purposes of comparison, with a copy of
  itself that has been extended to the length of the longer
  string by concatenation on the right of one or more pad 
  characters, where the pad character is chosen based on CS. If
  CS has the NO PAD attribute, then the pad character is an
  implementation-dependent character different from any 
  character in the character set of X and Y that collates less
  than any string under CS. Otherwise, the pad character is a
  .</p>
  
  <p><strong>b) The result of the comparison of X and Y is given by the 
  collating sequence CS.</strong></p>
  
  <p>c) Depending on the collating sequence, two strings may 
  compare as equal even if they are of different lengths or 
  contain different sequences of characters. When the operations
  MAX, MIN, DISTINCT, references to a grouping column, and the
  UNION, EXCEPT, and INTERSECT operators refer to character
  strings, the specific value selected by these operations from
  a set of such equal values is implementation-dependent.</p>
</blockquote>

<p>(Emphasis added.)</p>

<p>What does this mean? It means that when comparing strings, the <code>=</code> operator is just a thin wrapper around the current collation. A collation is a library that has various rules for comparing strings. Here's an example of <a href=""https://github.com/mysql/mysql-server/blob/5.7/strings/ctype-bin.c"" rel=""noreferrer"">a binary collation from MySQL</a>:</p>

<pre><code>static int my_strnncoll_binary(const CHARSET_INFO *cs __attribute__((unused)),
                               const uchar *s, size_t slen,
                               const uchar *t, size_t tlen,
                               my_bool t_is_prefix)
{
  size_t len= MY_MIN(slen,tlen);
  int cmp= memcmp(s,t,len);
  return cmp ? cmp : (int)((t_is_prefix ? len : slen) - tlen);
}
</code></pre>

<p>This particular collation happens to compare byte-by-byte (which is why it's called ""binary"" — it doesn't give any special meaning to strings). Other collations may provide more advanced comparisons. </p>

<p>For example, here is a <a href=""https://github.com/mysql/mysql-server/blob/5.7/strings/ctype-utf8.c#L8241"" rel=""noreferrer"">UTF-8 collation</a> that supports case-insensitive comparisons. The code is too long to paste here, but go to that link and read the body of <code>my_strnncollsp_utf8mb4()</code>. This collation can process multiple bytes at a time and it can apply various transforms (such as case insensitive comparison). The <code>=</code> operator is completely abstracted from the vagaries of the collation.</p>

<h1>How Does <code>LIKE</code> Work?</h1>

<p>The <a href=""http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt"" rel=""noreferrer"">SQL Standard § 8.5</a> describes how <code>LIKE</code> compares strings:</p>

<blockquote>
  <p>The &lt;predicate&gt;</p>
  
  <p><code>M LIKE P</code></p>
  
  <p>is true if there exists a partitioning of M into substrings
  such that:</p>
  
  <p>i) A substring of M is a sequence of 0 or more contiguous
  &lt;character representation&gt;s of M and each &lt;character 
  representation&gt; of M is part of exactly one substring.</p>
  
  <p>ii) If the i-th substring specifier of P is an arbitrary 
  character specifier, the i-th substring of M is any single
  &lt;character representation&gt;.</p>
  
  <p>iii) If the i-th substring specifier of P is an arbitrary string
  specifier, then the i-th substring of M is any sequence of
  0 or more &lt;character representation&gt;s.</p>
  
  <p><strong>iv) If the i-th substring specifier of P is neither an 
  arbitrary character specifier nor an arbitrary string specifier, 
  then the i-th substring of M is equal to that substring 
  specifier according to the collating sequence of
  the &lt;like predicate&gt;, without the appending of &lt;space&gt;
  characters to M, and has the same length as that substring
  specifier.</strong></p>
  
  <p>v) The number of substrings of M is equal to the number of
  substring specifiers of P.</p>
</blockquote>

<p>(Emphasis added.)</p>

<p>This is pretty wordy, so let's break it down. Items ii and iii refer to the wildcards <code>_</code> and <code>%</code>, respectively. If <code>P</code> does not contain any wildcards, then only item iv applies. This is the case of interest posed by the OP.</p>

<p>In this case, it compares each ""substring"" (individual characters) in <code>M</code> against each substring in <code>P</code> using the current collation.</p>

<h1>Conclusions</h1>

<p>The bottom line is that when comparing strings, <code>=</code> compares the entire string while <code>LIKE</code> compares one character at a time. Both comparisons use the current collation. This difference leads to different results in some cases, as evidenced in the first example in this post.</p>

<p>Which one should you use? Nobody can tell you that — you need to use the one that's correct for your use case. Don't prematurely optimize by switching comparison operators.</p>
","2336940"
"Formatting Numbers by padding with leading zeros in SQL Server","228025","","<p>We have an old SQL table that was used by SQL Server 2000 for close to 10 years.</p>

<p>In it, our employee badge numbers are stored as <code>char(6)</code> from <code>000001</code> to <code>999999</code>.</p>

<p>I am writing a web application now, and I need to store employee badge numbers.</p>

<p>In my new table, I could take the short cut and copy the old table, but I am hoping for better data transfer, smaller size, etc, by simply storing the <code>int</code> values from <code>1</code> to <code>999999</code>.</p>

<p>In C#, I can quickly format an <code>int</code> value for the badge number using</p>

<pre><code>public static string GetBadgeString(int badgeNum) {
  return string.Format(""{0:000000}"", badgeNum);
  // alternate
  // return string.Format(""{0:d6}"", badgeNum);
}
</code></pre>

<p>How would I modify this simple SQL query to format the returned value as well?</p>

<pre><code>SELECT EmployeeID
FROM dbo.RequestItems
WHERE ID=0
</code></pre>

<p>If <code>EmployeeID</code> is 7135, this query should return <code>007135</code>.</p>
","<p>Change the number 6 to whatever your total length needs to be:</p>

<pre><code>SELECT REPLICATE('0',6-LEN(EmployeeId)) + EmployeeId
</code></pre>

<p>If the column is an INT, you can use RTRIM to implicitly convert it to a VARCHAR </p>

<pre><code>SELECT REPLICATE('0',6-LEN(RTRIM(EmployeeId))) + RTRIM(EmployeeId)
</code></pre>

<p>And the code to remove these 0s and get back the 'real' number:</p>

<pre><code>SELECT RIGHT(EmployeeId,(LEN(EmployeeId) - PATINDEX('%[^0]%',EmployeeId)) + 1)
</code></pre>
","9520709"
"Adding a new SQL column with a default value","227982","","<p>I am looking for the syntax to add a column to a MySQL database with a default value of 0 </p>

<p><a href=""http://dev.mysql.com/doc/refman/5.1/en/alter-table.html"" rel=""noreferrer"">Reference</a></p>
","<p>Try this:</p>

<pre><code>ALTER TABLE table1 ADD COLUMN foo INT DEFAULT 0;
</code></pre>

<hr>

<p>From the documentation that you linked to:</p>

<pre><code>ALTER [ONLINE | OFFLINE] [IGNORE] TABLE tbl_name
   alter_specification [, alter_specification] ...

alter_specification:
    ...
    ADD [COLUMN] (col_name column_definition,...)
    ...
</code></pre>

<p>To find the syntax for <code>column_definition</code> search a bit further down the page:</p>

<blockquote>
  <p>column_definition clauses use the same syntax for ADD and CHANGE as for CREATE TABLE. See <a href=""http://dev.mysql.com/doc/refman/5.1/en/create-table.html"" rel=""noreferrer"">Section 12.1.17, “CREATE TABLE Syntax”.</a></p>
</blockquote>

<p>And from the linked page:</p>

<pre><code>column_definition:  
   data_type [NOT NULL | NULL] [DEFAULT default_value]
   [AUTO_INCREMENT] [UNIQUE [KEY] | [PRIMARY] KEY]  
   [COMMENT 'string']  
   [COLUMN_FORMAT {FIXED|DYNAMIC|DEFAULT}]  
   [STORAGE {DISK|MEMORY|DEFAULT}]  
   [reference_definition]  
</code></pre>

<p></p>

<p>Notice the word DEFAULT there.</p>
","3569372"
"LIMIT 10..20 in SQL Server","227862","","<p>I'm trying to do something like :</p>

<pre><code>SELECT * FROM table LIMIT 10,20
</code></pre>

<p>or</p>

<pre><code>SELECT * FROM table LIMIT 10 OFFSET 10
</code></pre>

<p>but using SQL Server</p>

<p>The only <a href=""http://blogs.msdn.com/sqlserver/archive/2006/10/25/limit-in-sql-server.aspx"" rel=""noreferrer"">solution I found</a> looks like overkill:</p>

<pre><code>SELECT * FROM ( 
  SELECT *, ROW_NUMBER() OVER (ORDER BY name) as row FROM sys.databases 
 ) a WHERE row &gt; 5 and row &lt;= 10
</code></pre>

<p>I also <a href=""http://vorg.ca/626-the-MS-SQL-equivalent-to-MySQLs-limit-command"" rel=""noreferrer"">found</a>:</p>

<pre><code>SELECT TOP 10 * FROM stuff; 
</code></pre>

<p>... but it's not what I want to do since I can't specify the starting limit.</p>

<p>Is there another way for me to do that ? </p>

<p>Also, just curious, is there a reason why doesn't SQL Server support the <code>LIMIT</code> function or something similar? I don't want to be mean, but that really sounds like something a DBMS needs ... If it does, then I'm sorry for being so ignorant! I've been working with MySQL and SQL+ for the past 5 years so...</p>
","<p>The <code>LIMIT</code> clause is not part of standard SQL.  It's supported as a vendor extension to SQL by MySQL, PostgreSQL, and SQLite.  </p>

<p>Other brands of database may have similar features (e.g. <code>TOP</code> in Microsoft SQL Server), but these don't always work identically.</p>

<p>It's hard to use <code>TOP</code> in Microsoft SQL Server to mimic the <code>LIMIT</code> clause.  There are cases where it just doesn't work.</p>

<p>The solution you showed, using <code>ROW_NUMBER()</code> is available in Microsoft SQL Server 2005 and later.  This is the best solution (for now) that works solely as part of the query.</p>

<p>Another solution is to use <code>TOP</code> to fetch the first <em>count</em> + <em>offset</em> rows, and then use the API to seek past the first <em>offset</em> rows.</p>

<p>See also:</p>

<ul>
<li>""<a href=""https://stackoverflow.com/questions/216673/emulate-mysql-limit-clause-in-microsoft-sql-server-2000"">Emulate MySQL LIMIT clause in Microsoft SQL Server 2000</a>""</li>
<li>""<a href=""http://www.codeproject.com/KB/aspnet/PagingLarge.aspx"" rel=""noreferrer"">Paging of Large Resultsets in ASP.NET</a>""</li>
</ul>
","972074"
"Altering a column to be nullable","227668","","<p>I want to alter a table column to be nullable. I have used: </p>

<pre><code>ALTER TABLE Merchant_Pending_Functions Modify NumberOfLocations NULL
</code></pre>

<p>This gives an error at <code>Modify</code>. What is the correct syntax?</p>
","<p>Assuming <code>SQL Server</code> (based on your previous questions):</p>

<pre><code>ALTER TABLE Merchant_Pending_Functions ALTER COLUMN NumberOfLocations INT NULL
</code></pre>

<p>Replace <code>INT</code> with your actual datatype.</p>
","3556942"
"DECODE( ) function in SQL Server","227267","","<pre><code>SELECT PC_COMP_CODE,
       'R',
       PC_RESUB_REF,
       DECODE(PC_SL_LDGR_CODE, '02', 'DR', 'CR'),
       PC_DEPT_NO DEPT,
       '', --PC_DEPT_NO,
       PC_SL_LDGR_CODE + '/' + PC_SL_ACNO,
       SUM(DECODE(PC_SL_LDGR_CODE, '02', 1, -1) * PC_AMOUNT),
       PC_CHEQUE_NO CHQNO
  FROM GLAS_PDC_CHEQUES
 WHERE PC_RESUB_REF IS NOT NULL 
   AND PC_DISCD NOT IN ('d', 'D', 'T') 
GROUP BY PC_RESUB_REF, 
         PC_COMP_CODE, 
         'JJ', 
         PC_SL_LDGR_CODE + '/' + PC_SL_ACNO, 
         PC_DEPT_NO, 
         PC_CHEQUE_NO, 
         DECODE(PC_SL_LDGR_CODE, '02', 'DR', 'CR')
</code></pre>

<p>Above is a Oracle query; how can I use DECODE() function in SQL Server 2005? </p>
","<p>You could use the 'CASE .. WHEN .. THEN .. ELSE .. END' syntax in SQL.</p>
","1559266"
"SQLite in Android How to update a specific row","226618","","<p>I've been trying to update a specific row for a while now, and it seems that there are two ways to do this. From what I've read and tried, you can just use the:</p>

<p><code>execSQL(String sql)</code> method </p>

<p>or the:</p>

<p><code>update(String table, ContentValues values, String whereClause, String[] whereArgs)</code> method.</p>

<p>(Let me know if this is incorrect as I am new to android and very new to SQL.)</p>

<p>So let me get to my actual code.</p>

<pre><code>myDB.update(TableName, ""(Field1, Field2, Field3)"" + "" VALUES ('Bob', 19, 'Male')"", ""where _id = 1"", null);
</code></pre>

<p>I am trying to accomplish this:</p>

<p>Update Field1, Field2, and Field3 where the primary key (_id) is equal to 1.</p>

<p>Eclipse gives me a red line right underneath the word ""update"" and gives me this explanation:</p>

<blockquote>
  <p>The method update(String, ContentValues, String, String[]) in the type
  SQLiteDatabase is not applicable for the arguments (String, String,
  String, null)</p>
</blockquote>

<p>I'm guessing I'm not assigning the ContentValues correctly. Can anyone point me in the right direction?</p>
","<p>First make a ContentValues object :</p>

<pre><code>ContentValues cv = new ContentValues();
cv.put(""Field1"",""Bob""); //These Fields should be your String values of actual column names
cv.put(""Field2"",""19"");
cv.put(""Field2"",""Male"");
</code></pre>

<p>Then use the update method, it should work now:</p>

<pre><code>myDB.update(TableName, cv, ""_id=""+id, null);
</code></pre>
","9798527"
"MySQL dump by query","225987","","<p>Is it possible to do <code>mysqldump</code> by single <code>SQL query</code>?</p>

<p>I mean to dump the <strong>whole</strong> database, like <code>phpmyadmin</code> does when you do export to <code>SQL</code></p>
","<p>not mysqldump, but mysql cli...</p>

<pre><code>mysql -e ""select * from myTable"" -u myuser -pxxxxxxxxx mydatabase
</code></pre>

<p>you can redirect it out to a file if you want :</p>

<pre><code>mysql -e ""select * from myTable"" -u myuser -pxxxxxxxx mydatabase &gt; mydumpfile.txt
</code></pre>

<p>Update: 
Original post asked if he could dump from the database by query. What he asked and what he meant were different. He really wanted to just mysqldump all tables.</p>

<pre><code>mysqldump --tables myTable --where=""id &lt; 1000""
</code></pre>
","935848"
"SQL Inner join more than two tables","225669","","<p>I can currently query the join of two tables on the equality of a foreign/primary key in the following way.</p>

<pre><code> $result = mysql_query(""SELECT * FROM `table1` 
                         INNER JOIN 
                       `table2` ON table1.primaryKey=table2.table1Id"");
</code></pre>

<p>I'd like to extend this to multiple tables (all with the same foreign keys). I am trying the following code which is not returning anything. Can anyone point out what I'm doing wrong?</p>

<pre><code> $result = mysql_query(""SELECT * FROM `table1` 
                        INNER JOIN `table2` 
                        INNER JOIN table3 
                        ON table1.primaryKey=table2.table1Id=table3.table1Id"");
</code></pre>
","<pre><code>SELECT * 
FROM table1 INNER JOIN table2 ON 
     table1.primaryKey=table2.table1Id INNER JOIN 
     table3 ON table1.primaryKey=table3.table1Id
</code></pre>
","14995014"
"SQL left join vs multiple tables on FROM line?","225549","","<p>Most SQL dialects accept both the following queries:</p>

<pre><code>SELECT a.foo, b.foo
FROM a, b
WHERE a.x = b.x

SELECT a.foo, b.foo
FROM a
LEFT JOIN b ON a.x = b.x
</code></pre>

<p>Now obviously when you need an outer join, the second syntax is required. But when doing an inner join why should I prefer the second syntax to the first (or vice versa)?</p>
","<p>The old syntax, with just listing the tables, and using the <code>WHERE</code> clause to specify the join criteria, is being deprecated in most modern databases.</p>

<p>It's not just for show, the old syntax has the possibility of being ambiguous when you use both INNER and OUTER joins in the same query.</p>

<p>Let me give you an example.</p>

<p>Let's suppose you have 3 tables in your system:</p>

<pre><code>Company
Department
Employee
</code></pre>

<p>Each table contain numerous rows, linked together. You got multiple companies, and each company can have multiple departments, and each department can have multiple employees.</p>

<p>Ok, so now you want to do the following:</p>

<blockquote>
  <p>List all the companies, and include all their departments, and all their employees. Note that some companies don't have any departments yet, but make sure you include them as well. Make sure you only retrieve departments that have employees, but always list all companies.</p>
</blockquote>

<p>So you do this:</p>

<pre><code>SELECT * -- for simplicity
FROM Company, Department, Employee
WHERE Company.ID *= Department.CompanyID
  AND Department.ID = Employee.DepartmentID
</code></pre>

<p>Note that the last one there is an inner join, in order to fulfill the criteria that you only want departments with people.</p>

<p>Ok, so what happens now. Well, the problem is, it depends on the database engine, the query optimizer, indexes, and table statistics. Let me explain.</p>

<p>If the query optimizer determines that the way to do this is to first take a company, then find the departments, and then do an inner join with employees, you're not going to get any companies that don't have departments.</p>

<p>The reason for this is that the <code>WHERE</code> clause determines which <em>rows</em> end up in the final result, not individual parts of the rows.</p>

<p>And in this case, due to the left join, the Department.ID column will be NULL, and thus when it comes to the INNER JOIN to Employee, there's no way to fulfill that constraint for the Employee row, and so it won't appear.</p>

<p>On the other hand, if the query optimizer decides to tackle the department-employee join first, and then do a left join with the companies, you will see them.</p>

<p>So the old syntax is ambiguous. There's no way to specify what you want, without dealing with query hints, and some databases have no way at all.</p>

<p>Enter the new syntax, with this you can choose.</p>

<p>For instance, if you want all companies, as the problem description stated, this is what you would write:</p>

<pre><code>SELECT *
FROM Company
     LEFT JOIN (
         Department INNER JOIN Employee ON Department.ID = Employee.DepartmentID
     ) ON Company.ID = Department.CompanyID
</code></pre>

<p>Here you specify that you want the department-employee join to be done as one join, and then left join the results of that with the companies.</p>

<p>Additionally, let's say you only want departments that contains the letter X in their name. Again, with old style joins, you risk losing the company as well, if it doesn't have any departments with an X in its name, but with the new syntax, you can do this:</p>

<pre><code>SELECT *
FROM Company
     LEFT JOIN (
         Department INNER JOIN Employee ON Department.ID = Employee.DepartmentID
     ) ON Company.ID = Department.CompanyID AND Department.Name LIKE '%X%'
</code></pre>

<p>This extra clause is used for the joining, but is not a filter for the entire row. So the row might appear with company information, but might have NULLs in all the department and employee columns for that row, because there is no department with an X in its name for that company. This is hard with the old syntax.</p>

<p>This is why, amongst other vendors, Microsoft has deprecated the old outer join syntax, but not the old inner join syntax, since SQL Server 2005 and upwards. The only way to talk to a database running on Microsoft SQL Server 2005 or 2008, using the old style outer join syntax, is to set that database in 8.0 compatibility mode (aka SQL Server 2000).</p>

<p>Additionally, the old way, by throwing a bunch of tables at the query optimizer, with a bunch of WHERE clauses, was akin to saying ""here you are, do the best you can"". With the new syntax, the query optimizer has less work to do in order to figure out what parts goes together.</p>

<p>So there you have it.</p>

<p>LEFT and INNER JOIN is the wave of the future.</p>
","894659"
"The transaction log for the database is full","225224","","<p>I have a long running process that holds open a transaction for the full duration. </p>

<p>I have no control over the way this is executed. </p>

<p>Because a transaction is held open for the full duration, when the transaction log fills, SQL Server cannot increase the size of the log file. </p>

<p>So the process fails with the error <code>""The transaction log for database 'xxx' is full""</code>.</p>

<p>I have attempted to prevent this by increasing the size of the transaction log file in the database properties, but I get the same error.</p>

<p>Not sure what I should try next. The process runs for several hours so it's not easy to play trial and error. </p>

<p>Any ideas?</p>

<p>If anyone is interested, the process is an organisation import in <code>Microsoft Dynamics CRM 4.0.</code>  </p>

<p>There is plenty of disk space, we have the log in simple logging mode and have backed up the log prior to kicking off the process.</p>

<p>-=-=-=-=- UPDATE -=-=-=-=-</p>

<p>Thanks all for the comments so far.  The following is what led me to believe that the log would not grow due to the open transaction:</p>

<p>I am getting the following error...</p>

<pre><code>Import Organization (Name=xxx, Id=560d04e7-98ed-e211-9759-0050569d6d39) failed with Exception:
System.Data.SqlClient.SqlException: The transaction log for database 'xxx' is full. To find out why space in the log cannot be reused, see the log_reuse_wait_desc column in sys.databases
</code></pre>

<p>So following that advice I went to ""<code>log_reuse_wait_desc column in sys.databases</code>"" and it held the value ""<code>ACTIVE_TRANSACTION</code>"".</p>

<p>According to Microsoft:
<a href=""http://msdn.microsoft.com/en-us/library/ms345414(v=sql.105).aspx"">http://msdn.microsoft.com/en-us/library/ms345414(v=sql.105).aspx</a></p>

<p>That means the following:</p>

<p>A transaction is active (all recovery models).
• A long-running transaction might exist at the start of the log backup. In this case, freeing the space might require another log backup. For more information, see ""Long-Running Active Transactions,"" later in this topic.</p>

<p>• A transaction is deferred (SQL Server 2005 Enterprise Edition and later versions only). A deferred transaction is effectively an active transaction whose rollback is blocked because of some unavailable resource. For information about the causes of deferred transactions and how to move them out of the deferred state, see Deferred Transactions. </p>

<p>Have I misunderstood something?</p>

<p>-=-=-=- UPDATE 2 -=-=-=-</p>

<p>Just kicked off the process with initial log file size set to 30GB.  This will take a couple of hours to complete.</p>

<p>-=-=-=- Final UPDATE -=-=-=-</p>

<p>The issue was actually caused by the log file consuming all available disk space.  In the last attempt I freed up 120GB and it still used all of it and ultimately failed.</p>

<p>I didn't realise this was happening previously because when the process was running overnight, it was rolling back on failure.  This time I was able to check the log file size before the rollback.</p>

<p>Thanks all for your input.</p>
","<p>Is this a one time script, or regularly occurring job?</p>

<p>In the past, for special projects that temporarily require lots of space for the log file, I  created a second log file and made it huge. Once the project is complete we then removed the extra log file.</p>
","17675449"
"SQL Server: Is it possible to insert into two tables at the same time?","224988","","<p>My database contains three tables called <code>Object_Table</code>, <code>Data_Table</code> and <code>Link_Table</code>. The link table just contains two columns, the identity of an object record and an identity of a data record.</p>

<p>I want to copy the data from <code>DATA_TABLE</code> where it is linked to one given object identity and insert corresponding records into <code>Data_Table</code> and <code>Link_Table</code> for a different given object identity.</p>

<p>I <strong>can</strong> do this by selecting into a table variable and the looping through doing two inserts for each iteration.</p>

<p>Is this the best way to do it?</p>

<p><strong>Edit</strong> : I want to avoid a loop for two reason, the first is that I'm lazy and a loop/temp table requires more code, more code means more places to make a mistake and the second reason is a concern about performance.</p>

<p>I can copy all the data in one insert but how do get the link table to link to the new data records where each record has a new id?</p>
","<p>The following sets up the situation I had, using table variables.</p>

<pre><code>DECLARE @Object_Table TABLE
(
    Id INT NOT NULL PRIMARY KEY
)

DECLARE @Link_Table TABLE
(
    ObjectId INT NOT NULL,
    DataId INT NOT NULL
)

DECLARE @Data_Table TABLE
(
    Id INT NOT NULL Identity(1,1),
    Data VARCHAR(50) NOT NULL
)

-- create two objects '1' and '2'
INSERT INTO @Object_Table (Id) VALUES (1)
INSERT INTO @Object_Table (Id) VALUES (2)

-- create some data
INSERT INTO @Data_Table (Data) VALUES ('Data One')
INSERT INTO @Data_Table (Data) VALUES ('Data Two')

-- link all data to first object
INSERT INTO @Link_Table (ObjectId, DataId)
SELECT Objects.Id, Data.Id
FROM @Object_Table AS Objects, @Data_Table AS Data
WHERE Objects.Id = 1
</code></pre>

<p>Thanks to another <a href=""https://stackoverflow.com/questions/175066/in-sql-server-is-it-possible-to-insert-into-two-tables-at-the-same-time#175136"">answer</a> that pointed me towards the OUTPUT clause I can demonstrate a solution:</p>

<pre><code>-- now I want to copy the data from from object 1 to object 2 without looping
INSERT INTO @Data_Table (Data)
OUTPUT 2, INSERTED.Id INTO @Link_Table (ObjectId, DataId)
SELECT Data.Data
FROM @Data_Table AS Data INNER JOIN @Link_Table AS Link ON Data.Id = Link.DataId
                INNER JOIN @Object_Table AS Objects ON Link.ObjectId = Objects.Id 
WHERE Objects.Id = 1
</code></pre>

<p>It turns out however that it is not that simple in real life because of the following error</p>

<blockquote>
  <p>the OUTPUT INTO clause cannot be on
  either side of a (primary key, foreign
  key) relationship</p>
</blockquote>

<p>I can still <code>OUTPUT INTO</code> a temp table and then finish with normal insert. So I can avoid my loop but I cannot avoid the temp table.</p>
","175756"
"What is the difference between function and procedure in PL/SQL?","224888","","<p>What is the difference between function and procedure in PL/SQL ?</p>
","<p>A procedure does not have a return value, whereas a function has.</p>

<p>Example:</p>

<pre><code>CREATE OR REPLACE PROCEDURE my_proc
   (p_name IN VARCHAR2 := 'John') as begin ... end

CREATE OR REPLACE FUNCTION my_func
   (p_name IN VARCHAR2 := 'John') return varchar2 as begin ... end
</code></pre>

<p>Notice how the function has a return clause between the parameter list and the ""as"" keyword. This means that it is expected to have the last statement inside the body of the function read something like:</p>

<pre><code>return(my_varchar2_local_variable);
</code></pre>

<p>Where my_varchar2_local_variable is some varchar2 that should be returned by that function.</p>
","771959"
"How to use index in select statement?","224460","","<p>Lets say in the employee table, I have created an index(idx_name) on the <code>emp_name</code> column of the table.</p>

<p>Do I need to explicitly specify the index name in select clause or it will automatically used to speed up queries.</p>

<p>If it is required to be specified in the select clause, What is the syntax for using index in select query ?</p>
","<p>If you want to test the index to see if it works, here is the syntax:</p>

<pre><code>SELECT *
FROM Table WITH(INDEX(Index_Name))
</code></pre>

<p>The WITH statement will force the index to be used.</p>
","6603833"
"T-SQL: Deleting all duplicate rows but keeping one","222934","","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""https://stackoverflow.com/questions/18932/sql-how-can-i-remove-duplicate-rows"">SQL - How can I remove duplicate rows?</a>  </p>
</blockquote>



<p>I have a table with a very large amount of rows. Duplicates are not allowed but due to a problem with how the rows were created I know there are some duplicates in this table.
I need to eliminate the extra rows from the perspective of the key columns. Some other columns may have <em>slightly</em> different data but I do not care about that. I still need to keep one of these rows however. SELECT DISTINCT won't work because it operates on all columns and I need to suppress duplicates based on the key columns.</p>

<p>How can I delete the extra rows but still keep one efficiently?</p>
","<p>You didn't say what version you were using, but in SQL 2005 and above, you can use a common table expression with the <a href=""http://msdn.microsoft.com/en-us/library/ms189461.aspx"" rel=""noreferrer"">OVER Clause</a>.  It goes a little something like this:</p>

<pre><code>WITH cte AS (
  SELECT[foo], [bar], 
     row_number() OVER(PARTITION BY foo, bar ORDER BY baz) AS [rn]
  FROM TABLE
)
DELETE cte WHERE [rn] &gt; 1
</code></pre>

<p>Play around with it and see what you get.</p>

<p>(Edit: In an attempt to be helpful, someone edited the <code>ORDER BY</code> clause within the CTE. To be clear, you can order by anything you want here, it needn't be one of the columns returned by the cte. In fact, a common use-case here is that ""foo, bar"" are the group identifier and ""baz"" is some sort of time stamp. In order to keep the latest, you'd do <code>ORDER BY baz desc</code>)</p>
","6025929"
"SQLite - UPSERT *not* INSERT or REPLACE","222798","","<p><a href=""http://en.wikipedia.org/wiki/Upsert"" rel=""noreferrer"">http://en.wikipedia.org/wiki/Upsert</a></p>

<p><a href=""https://stackoverflow.com/questions/13540/insert-update-stored-proc-on-sql-server"">Insert Update stored proc on SQL Server</a></p>

<p>Is there some clever way to do this in SQLite that I have not thought of?</p>

<p>Basically I want to update three out of four columns if the record exists, 
If it does not exists I want to INSERT the record with the default (NUL) value for the fourth column.</p>

<p>The ID is a primary key so there will only ever be one record to UPSERT.</p>

<p>(I am trying to avoid the overhead of SELECT in order to determin if I need to UPDATE or INSERT obviously)</p>

<p>Suggestions?</p>
","<p>Assuming 3 columns in the table.. ID, NAME, ROLE</p>

<hr>

<p><strong>BAD:</strong> This will insert or replace all columns with new values for ID=1:</p>

<pre><code>INSERT OR REPLACE INTO Employee (id, name, role) 
  VALUES (1, 'John Foo', 'CEO');
</code></pre>

<hr>

<p><strong>BAD:</strong> This will insert or replace 2 of the columns... the NAME column will be set to NULL or the default value:</p>

<pre><code>INSERT OR REPLACE INTO Employee (id, role) 
  VALUES (1, 'code monkey');
</code></pre>

<hr>

<p><strong>GOOD:</strong> This will update 2 of the columns.
When ID=1 exists, the NAME will be unaffected.
When ID=1 does not exist, the name will be default (NULL).</p>

<pre><code>INSERT OR REPLACE INTO Employee (id, role, name) 
  VALUES (  1, 
            'code monkey',
            (SELECT name FROM Employee WHERE id = 1)
          );
</code></pre>

<p>This will update 2 of the columns.
When ID=1 exists, the ROLE will be unaffected.
When ID=1 does not exist, the role will be set to 'Benchwarmer' instead of the default value.</p>

<pre><code>INSERT OR REPLACE INTO Employee (id, name, role) 
  VALUES (  1, 
            'Susan Bar',
            COALESCE((SELECT role FROM Employee WHERE id = 1), 'Benchwarmer')
          );
</code></pre>
","4330694"
"When to use ""ON UPDATE CASCADE""","222757","","<p>I use ""ON DELETE CASCADE"" regularly but I never use ""ON UPDATE CASCADE"" as I am not so sure in what situation it will be useful.</p>

<p>For the sake of discussion let see some code.</p>

<pre><code>CREATE TABLE parent (
    id INT NOT NULL AUTO_INCREMENT,
    PRIMARY KEY (id)
);

CREATE TABLE child (
    id INT NOT NULL AUTO_INCREMENT, parent_id INT,
    INDEX par_ind (parent_id),
    FOREIGN KEY (parent_id)
        REFERENCES parent(id)
        ON DELETE CASCADE
);
</code></pre>

<p>For ""ON DELETE CASCADE"", if a parent with an <code>id</code> is deleted, a record in child with <code>parent_id = parent.id</code> will be automatically deleted. This should be no problem.</p>

<ol>
<li><p>This means that ""ON UPDATE CASCADE"" will do the same thing when <code>id</code> of the parent is updated?</p></li>
<li><p>If (1) is true, it means that there is no need to use ""ON UPDATE CASCADE"" if <code>parent.id</code> is not updatable (or will never be updated) like when it is <code>AUTO_INCREMENT</code> or always set to be <code>TIMESTAMP</code>. Is that right?</p></li>
<li><p>If (2) is not true, in what other kind of situation should we use ""ON UPDATE CASCADE""?</p></li>
<li><p>What if I (for some reason) update the <code>child.parent_id</code> to be something not existing, will it then be automatically deleted?</p></li>
</ol>

<p>Well, I know, some of the question above can be test programmically to understand but I want also know if any of this is database vendor dependent or not.</p>

<p>Please shed some light.</p>
","<p>It's true that if your primary key is just a identity value auto incremented, you would have no real use for ON UPDATE CASCADE.</p>

<p>However, let's say that your primary key is a 10 digit UPC bar code and because of expansion, you need to change it to a 13-digit UPC bar code.  In that case, ON UPDATE CASCADE would allow you to change the primary key value and any tables that have foreign key references to the value will be changed accordingly.</p>

<p>In reference to #4, if you change the child ID to something that doesn't exist in the parent table (and you have referential integrity), you should get a foreign key error.</p>
","1481524"
"Set value to NULL in MySQL","222550","","<p>I want a value to be set to <code>NULL</code> if nothing is put into the text box in the form I'm submitting. How can I make this happen?
I've tried inserting <code>'NULL'</code> but this just adds the word <code>NULL</code> into the field.</p>

<p>I'm not sure what code I should provide for this, I'm just writing an UPDATE query.</p>
","<p>Don't put <code>NULL</code> inside quotes in your update statement.   This should work:</p>

<pre><code>UPDATE table SET field = NULL WHERE something = something
</code></pre>
","9314387"
"Updating a date in Oracle SQL table","222424","","<p>I am trying to update a date in a SQL table.  I am using Peoplesoft Oracle.  When I run this query:</p>

<pre><code>Select ASOFDATE from PASOFDATE;
</code></pre>

<p>I get 4/16/2012</p>

<p>I tried running this query</p>

<pre><code>UPDATE PASOFDATE SET ASOFDATE = '11/21/2012';
</code></pre>

<p>but it is not working.  </p>

<p>Does anyone know how I would change the date to the one desired?</p>
","<p>This is based on the <em>assumption</em> that you're getting an error about the date format, such as an invalid month value or non-numeric character when numeric expected.</p>

<p>Dates stored in the database do not have formats. When you query the date your client is formatting the date for display, as <code>4/16/2011</code>. Normally the same date format is used for selecting and updating dates, but in this case they appear to be different - so your client is apparently doing something more complicated that SQL*Plus, for example.</p>

<p>When you try to update it it's using a default <a href=""http://docs.oracle.com/cd/E11882_01/server.112/e26088/sql_elements004.htm#sthref394"">date format model</a>. Because of how it's displayed you're assuming that is <code>MM/DD/YYYY</code>, but it seems not to be. You could find out what it is, but it's better not to rely on the default or any implicit format models at all.</p>

<p>Whether that is the problem or not, you should always specify the date model:</p>

<pre><code>UPDATE PASOFDATE SET ASOFDATE = TO_DATE('11/21/2012', 'MM/DD/YYYY');
</code></pre>

<p>Since you aren't specifying a time component - all Oracle <code>DATE</code> columns include a time, even if it's midnight - you could also use a <a href=""http://docs.oracle.com/cd/E11882_01/server.112/e26088/sql_elements003.htm#sthref362"">date literal</a>:</p>

<pre><code>UPDATE PASOFDATE SET ASOFDATE = DATE '2012-11-21';
</code></pre>

<p>You should maybe check that the current value doesn't include a time, though the column name suggests it doesn't.</p>
","13497380"
"Passing multiple values for a single parameter in Reporting Services","221844","","<p>I have several Multi-Select parameters in my report. I am trying to find a way to pass in multiple values for a single parameter in the web query string? If I pass in a single value, it works fine.</p>

<p>The report runs fine selecting multiple choices for a single param. My trouble lies in the web query string.</p>
","<p>Although John Sansom's solution works, there's another way to do this, without having to use a potentially inefficient scalar valued UDF.
In the SSRS report, on the parameters tab of the query definition, set the parameter value to </p>

<pre><code>=join(Parameters!&lt;your param name&gt;.Value,"","")
</code></pre>

<p>In your query, you can then reference the value like so:</p>

<pre><code>where yourColumn in (@&lt;your param name&gt;)
</code></pre>
","519573"
"NOT IN clause and NULL values","221302","","<p>This issue came up when I got different records counts for what I thought were identical queries one using a <code>not in</code> <code>where</code> constraint and the other a <code>left join</code>. The table in the <code>not in</code> constraint had one null value (bad data) which caused that query to return a count of 0 records. I sort of understand why but I could use some help fully grasping the concept.</p>

<p>To state it simply, why does query A return a result but B doesn't?</p>

<pre><code>A: select 'true' where 3 in (1, 2, 3, null)
B: select 'true' where 3 not in (1, 2, null)
</code></pre>

<p>This was on SQL Server 2005. I also found that calling <code>set ansi_nulls off</code> causes B to return a result.</p>
","<p>Query A is the same as:</p>

<pre><code>select 'true' where 3 = 1 or 3 = 2 or 3 = 3 or 3 = null
</code></pre>

<p>Since <code>3 = 3</code> is true, you get a result.</p>

<p>Query B is the same as:</p>

<pre><code>select 'true' where 3 &lt;&gt; 1 and 3 &lt;&gt; 2 and 3 &lt;&gt; null
</code></pre>

<p>When <code>ansi_nulls</code> is on, <code>3 &lt;&gt; null</code> is UNKNOWN, so the predicate evaluates to UNKNOWN, and you don't get any rows.</p>

<p>When <code>ansi_nulls</code> is off, <code>3 &lt;&gt; null</code> is true, so the predicate evaluates to true, and you get a row.</p>
","129152"
"Select where count of one field is greater than one","221231","","<p>I want to do something like this:</p>

<pre><code>SELECT * 
  FROM db.table 
 WHERE COUNT(someField) &gt; 1
</code></pre>

<p>How can I achieve this in MySql?</p>
","<p>Use the <code>HAVING</code>, not <code>WHERE</code> clause, for aggregate result comparison.</p>

<p>Taking the query at face value:</p>

<pre><code>SELECT * 
  FROM db.table 
HAVING COUNT(someField) &gt; 1
</code></pre>

<p>Ideally, there should be a <code>GROUP BY</code> defined for proper valuation in the <code>HAVING</code> clause, but <a href=""http://dev.mysql.com/doc/refman/5.0/en/group-by-hidden-columns.html"" rel=""noreferrer"">MySQL does allow hidden columns from the GROUP BY</a>...</p>

<p>Is this in preparation for a unique constraint on <code>someField</code>?  Looks like it should be...</p>
","3710501"
"Sql: How to properly check if a record exists","221185","","<p>Reading some <em>SQL Tuning</em> documentation I found this:</p>

<p><code>Select count(*)</code> :<br>
-  Counts the number of rows<br>
-  Often is improperly used to verify the existence of a record</p>

<p>Is <code>Select count(*)</code> really that bad?  </p>

<p>What's the proper way to verify the existence of a record?</p>
","<p>It is better to use a</p>

<pre><code>select 1
from table
where key = value;

select count(1)
from table
where key = value;
</code></pre>

<p>The first alternative should give you no result or one result, the second count should be zero or one.</p>

<p>How old is the documentation you're using? Although you've read good advice, most query optimizers in recent RDBMS's optimize <code>select count(*)</code> anyway, so while there is a difference in theory (and older databases), you shouldn't notice any difference in practice.</p>
","4254003"
"SELECTING with multiple WHERE conditions on same column","221115","","<p>Ok, I think I might be overlooking something obvious/simple here... but I need to write a query that returns only records that match multiple criteria on the same column...</p>

<p>My table is a very simple linking setup for applying flags to a user ...</p>

<pre><code>ID   contactid  flag        flag_type 
-----------------------------------
118  99         Volunteer   1 
119  99         Uploaded    2 
120  100        Via Import  3 
121  100        Volunteer   1  
122  100        Uploaded    2
</code></pre>

<p>etc... in this case you'll see both contact 99 and 100 are flagged as both ""Volunteer"" and ""Uploaded""...</p>

<p>What I need to be able to do is return those contactid's ONLY that match multiple criteria entered via a search form...the contactid's have to match ALL chosen flags... in my head the SQL should look something like:</p>

<pre><code>SELECT contactid 
 WHERE flag = 'Volunteer' 
   AND flag = 'Uploaded'...
</code></pre>

<p>but... that returns nothing... What am I doing wrong here?</p>
","<p>You can either use <code>GROUP BY</code> and <code>HAVING COUNT(*) = _</code>:</p>

<pre><code>SELECT contact_id
FROM your_table
WHERE flag IN ('Volunteer', 'Uploaded', ...)
GROUP BY contact_id
HAVING COUNT(*) = 2 -- // must match number in the WHERE flag IN (...) list
</code></pre>

<p>(assuming <code>contact_id, flag</code> is unique).</p>

<p>Or use joins:</p>

<pre><code>SELECT T1.contact_id
FROM your_table T1
JOIN your_table T2 ON T1.contact_id = T2.contact_id AND T2.flag = 'Uploaded'
-- // more joins if necessary
WHERE T1.flag = 'Volunteer'
</code></pre>

<p>If the list of flags is very long and there are lots of matches the first is probably faster. If the list of flags is short and there are few matches, you will probably find that the second is faster. If performance is a concern try testing both on your data to see which works best.</p>
","4047514"
"How do I execute a stored procedure once for each row returned by query?","220990","","<p>I have a stored procedure that alters user data in a certain way. I pass it user_id and it does it's thing. I want to run a query on a table and then for each user_id I find run the stored procedure once on that user_id</p>

<p>How would I write query for this?</p>
","<p>use a cursor</p>

<p>ADDENDUM: [MS SQL cursor example]</p>

<pre><code>declare @field1 int
declare @field2 int
declare cur CURSOR LOCAL for
    select field1, field2 from sometable where someotherfield is null

open cur

fetch next from cur into @field1, @field2

while @@FETCH_STATUS = 0 BEGIN

    --execute your sproc on each row
    exec uspYourSproc @field1, @field2

    fetch next from cur into @field1, @field2
END

close cur
deallocate cur
</code></pre>

<p>in MS SQL, <a href=""http://www.sqlteam.com/article/cursors-an-overview"" rel=""noreferrer"">here's an example article</a></p>

<p>note that cursors are slower than set-based operations, but faster than manual while-loops; more details <a href=""https://stackoverflow.com/questions/287445/why-do-people-hate-sql-cursors-so-much"">in this SO question</a></p>

<p>ADDENDUM 2: if you will be processing more than just a few records, pull them into a temp table first and run the cursor over the temp table; this will prevent SQL from escalating into table-locks and speed up operation</p>

<p>ADDENDUM 3: and of course, if you can inline whatever your stored procedure is doing to each user ID and run the whole thing as a single SQL update statement, that would be optimal</p>
","886314"
"How to convert integer to decimal in SQL Server query?","220373","","<p>A column <code>height</code> is integer type in my SQL Server table. I want to do a division and have the result as decimal in my query:</p>

<pre><code>Select (height/10) as HeightDecimal
</code></pre>

<p>How do I cast so that the <code>HeightDecimal</code> is no longer integer? Thanks.</p>
","<pre><code>SELECT height/10.0 AS HeightDecimal FROM dbo.whatever;
</code></pre>

<p>If you want a specific precision scale, then say so:</p>

<pre><code>SELECT CONVERT(DECIMAL(16,4), height/10.0) AS HeightDecimal
  FROM dbo.whatever;
</code></pre>
","10271576"
"Skip certain tables with mysqldump","220178","","<p>Is there a way to restrict certain tables from the mysqldump command?</p>

<p>For example, I'd use the following syntax to dump <em>only</em> table1 and table2:</p>

<pre><code>mysqldump -u username -p database table1 table2 &gt; database.sql
</code></pre>

<p>But is there a similar way to dump all the tables <em>except</em> table1 and table2? I haven't found anything in the mysqldump documentation, so is brute-force (specifying all the table names) the only way to go?</p>
","<p>You can use the <a href=""http://dev.mysql.com/doc/refman/5.1/en/mysqldump.html#option_mysqldump_ignore-table"" rel=""noreferrer"">--ignore-table</a> option.  So you could do</p>

<pre><code>mysqldump -u username -p database --ignore-table=database.table1 &gt; database.sql
</code></pre>

<p>If you want to ignore multiple tables you can use a simple script like this</p>

<pre><code>#!/bin/bash
PASSWORD=XXXXXX
HOST=XXXXXX
USER=XXXXXX
DATABASE=databasename
DB_FILE=dump.sql
EXCLUDED_TABLES=(
table1
table2
table3
table4
tableN   
)

IGNORED_TABLES_STRING=''
for TABLE in ""${EXCLUDED_TABLES[@]}""
do :
   IGNORED_TABLES_STRING+="" --ignore-table=${DATABASE}.${TABLE}""
done

echo ""Dump structure""
mysqldump --host=${HOST} --user=${USER} --password=${PASSWORD} --single-transaction --no-data ${DATABASE} &gt; ${DB_FILE}

echo ""Dump content""
mysqldump --host=${HOST} --user=${USER} --password=${PASSWORD} ${DATABASE} --no-create-info ${IGNORED_TABLES_STRING} &gt;&gt; ${DB_FILE}
</code></pre>
","425172"
"Generate sql insert script from excel worksheet","219171","","<p>I have a large excel worksheet that I want to add to my database.</p>

<p>Can I generate an SQL insert script from this excel worksheet?</p>
","<p>I think importing using one of the methods mentioned is ideal if it truly is a large file, but you can use Excel to create insert statements:</p>

<pre><code>=""INSERT INTO table_name VALUES('""&amp;A1&amp;""','""&amp;B1&amp;""','""&amp;C1&amp;""')""
</code></pre>

<p>In MS SQL you can use:</p>

<pre><code>SET NOCOUNT ON
</code></pre>

<p>To forego showing all the '1 row affected' comments.  And if you are doing a lot of rows and it errors out, put a GO between statements every once in a while</p>
","16819629"
"SQL selecting rows by most recent date","218975","","<p>Using the following query and results, I'm looking for the most recent entry where the ChargeId and ChargeType are unique.</p>

<pre><code>select chargeId, chargeType, serviceMonth from invoice

    CHARGEID    CHARGETYPE  SERVICEMONTH
1   101     R       8/1/2008
2   161     N       2/1/2008
3   101     R       2/1/2008
4   101     R       3/1/2008
5   101     R       4/1/2008
6   101     R       5/1/2008
7   101     R       6/1/2008
8   101     R       7/1/2008
</code></pre>

<p>Desired:</p>

<pre><code>    CHARGEID    CHARGETYPE  SERVICEMONTH
1   101     R       8/1/2008
2   161     N       2/1/2008
</code></pre>
","<p>You can use a <strong>GROUP BY</strong> to group items by type and id.  Then you can use the <strong>MAX()</strong> Aggregate function to get the most recent service month.  The below returns a result set with ChargeId, ChargeType, and MostRecentServiceMonth</p>

<pre><code>SELECT
  CHARGEID,
  CHARGETYPE,
  MAX(SERVICEMONTH) AS ""MostRecentServiceMonth""
FROM INVOICE
GROUP BY CHARGEID, CHARGETYPE
</code></pre>
","189221"
"SQL update statement in C#","218336","","<p>I have table  <strong>""Student""</strong></p>

<pre><code>   P_ID   LastName  FirstName  Address  City

   1        Hansen    Ola                
   2        Svendson   Tove
   3        Petterson   Kari
   4        Nilsen       Johan
...and so on 
</code></pre>

<p>How do i change edit code in C#</p>

<pre><code> string firstName = ""Ola"";
 string  lastName =""Hansen"";
 string  address = ""ABC"";
 string city = ""Salzburg"";

 string connectionString = System.Configuration.ConfigurationManager
                          .ConnectionStrings[""LocalDB""].ConnectionString;

 using (SqlConnection connection = new SqlConnection(connectionString))
     using (SqlCommand command = connection.CreateCommand())
 { 
   command.CommandText = ""INSERT INTO Student (LastName, FirstName, Address, City) 
                          VALUES (@ln, @fn, @add, @cit)"";

   command.Parameters.AddWithValue(""@ln"", lastName);
   command.Parameters.AddWithValue(""@fn"", firstName);
   command.Parameters.AddWithValue(""@add"", address);
   command.Parameters.AddWithValue(""@cit"", city);

   connection.Open();

   command.ExecuteNonQuery();

   connection.Close();
 } 
</code></pre>

<p>to edit entry  where <strong>Lastname</strong> field has lastname value and <strong>FirstName</strong> field has firstname  value.  </p>

<p>I dont want to use like this </p>

<pre><code> UPDATE Persons  SET Address='Nissestien 67', City='Sandnes' 
 WHERE LastName='Tjessem'     AND FirstName='Jakob'
</code></pre>

<p>and i edited my original statement to </p>

<pre><code> command.CommandText = ""UPDATE Student(LastName, FirstName, Address, City) 
   VALUES (@ln, @fn, @add, @cit) WHERE LastName='"" + lastName + 
                           ""' AND FirstName='"" +  firstName+""'"";
</code></pre>

<p>but the statement is not getting executed, why is it throwing SQL exception ? Is there nay solution to it ?</p>
","<p>This is not a correct method of updating record in SQL:</p>

<pre><code>command.CommandText = ""UPDATE Student(LastName, FirstName, Address, City) VALUES (@ln, @fn, @add, @cit) WHERE LastName='"" + lastName + ""' AND FirstName='"" + firstName+""'"";
</code></pre>

<p>You should write it like this:</p>

<pre><code>command.CommandText = ""UPDATE Student 
SET Address = @add, City = @cit Where FirstName = @fn and LastName = @add"";
</code></pre>

<p>Then you add the parameters same as you added them for the insert operation.</p>
","15246246"
"Sql Server equivalent of a COUNTIF aggregate function","218033","","<p>I'm building a query with a <code>GROUP BY</code> clause that needs the ability to count records based only on a certain condition (e.g. count only records where a certain column value is equal to 1).</p>

<pre><code>SELECT  UID, 
        COUNT(UID) AS TotalRecords, 
        SUM(ContractDollars) AS ContractDollars,
        (COUNTIF(MyColumn, 1) / COUNT(UID) * 100) -- Get the average of all records that are 1
FROM    dbo.AD_CurrentView
GROUP BY UID
HAVING  SUM(ContractDollars) &gt;= 500000
</code></pre>

<p>The <code>COUNTIF()</code> line obviously fails since there is no native SQL function called <code>COUNTIF</code>, but the idea here is to determine the percentage of all rows that have the value '1' for MyColumn.</p>

<p>Any thoughts on how to properly implement this in a MS SQL 2005 environment?</p>
","<p>You could use a <code>SUM</code> (not <code>COUNT</code>!) combined with a <code>CASE</code> statement, like this:</p>

<pre><code>SELECT SUM(CASE WHEN myColumn=1 THEN 1 ELSE 0 END)
FROM AD_CurrentView
</code></pre>

<p>Note: in my own test <code>NULL</code>s were not an issue, though this can be environment dependent. You could handle nulls such as:</p>

<pre><code>SELECT SUM(CASE WHEN ISNULL(myColumn,0)=1 THEN 1 ELSE 0 END)
FROM AD_CurrentView
</code></pre>
","582649"
"Getting the current date in SQL Server?","217046","","<p>How can I get the current date in MS-SQL Server 2008 R2?</p>

<p>The format of the column in my database is <code>DATETIME</code> and dates are stored in the following format:</p>

<pre><code>+++++++++++++ Vrdate ++++++++++
|                             |
|   2012-11-18 00:00:00.000   |
|   2012-11-19 00:00:00.000   |
|   2013-11-18 00:00:00.000   |
|   2012-12-01 00:00:00.000   |
|   2010-10-09 00:00:00.000   |
|   2012-11-11 00:00:00.000   |
|                             |
+++++++++++++++++++++++++++++++
</code></pre>

<p>I searched but wasn't able to find the way to get the date in this format (i.e. which has the time associated with it in <code>00:00:00.00</code>). I found <code>GETDATE()</code> function but that provides the current time along with the date as well, what I want is get the date in the following format: <code>CurrentDate 00:00:00.00</code></p>

<p>How may I get this?</p>
","<pre><code>SELECT CAST(GETDATE() AS DATE)
</code></pre>

<p>Returns the current date with the time part removed.</p>

<p><code>DATETIME</code>s are not ""stored in the following format"". They are stored in a binary format. </p>

<pre><code>SELECT CAST(GETDATE() AS BINARY(8))
</code></pre>

<p>The display format in the question is independent of storage.</p>

<p>Formatting into a particular display format should be done by your application. </p>
","19197483"
"How to print a query string with parameter values when using Hibernate","216757","","<p>Is it possible in Hibernate to print generated SQL queries with real values instead of question marks?</p>

<p>How would you suggest to print queries with real values if it is not possible with Hibernate API?</p>
","<p>You need to enable <a href=""http://docs.jboss.org/hibernate/core/3.3/reference/en/html/session-configuration.html#configuration-logging"" rel=""noreferrer"">logging</a> for the the following categories:</p>

<ul>
<li><code>org.hibernate.SQL</code> &nbsp;&nbsp;- set to <code>debug</code> to log all SQL DML statements as they are executed</li>
<li><code>org.hibernate.type</code> - set to <code>trace</code> to log all JDBC parameters</li>
</ul>

<p>So a log4j configuration could look like:</p>

<pre><code># logs the SQL statements
log4j.logger.org.hibernate.SQL=debug 

# Logs the JDBC parameters passed to a query
log4j.logger.org.hibernate.type=trace 
</code></pre>

<p>The first is equivalent to <code>hibernate.show_sql=true</code> legacy <a href=""http://docs.jboss.org/hibernate/core/3.3/reference/en/html/session-configuration.html#configuration-optional"" rel=""noreferrer"">property</a>, the second <strong>prints the bound parameters among other things.</strong></p>

<p>Another solution (non hibernate based) would be to use a JDBC proxy driver like <a href=""https://github.com/p6spy/p6spy"" rel=""noreferrer"">P6Spy</a>.</p>
","1713464"
"Can a foreign key be NULL and/or duplicate?","216111","","<p>Please clarify two things for me:</p>

<ol>
<li>Can a Foreign key be NULL?</li>
<li>Can a Foreign key be duplicate?</li>
</ol>

<p>As fair as I know, <code>NULL</code> shouldn't be used in foreign keys, but in some application of mine I'm able to input <code>NULL</code> in both Oracle and SQL Server, and I don't know why.</p>
","<p>Short answer: Yes, it can be NULL or duplicate.</p>

<p>I want to explain why a foreign key might need to be null or might need to be unique or not unique. First remember a Foreign key simply requires that the value in that field must exist first in a different table (the parent table). That is all an FK is by definition. Null by definition is not a value. Null means that we do not yet know what the value is.</p>

<p>Let me give you a real life example. Suppose you have a database that stores sales proposals. Suppose further that each proposal only has one sales person assigned and one client.  So your proposal table would have two foreign keys, one with the client ID and one with the sales rep ID.  However, at the time the record is created, a sales rep is not always assigned (because no one is free to work on it yet), so the client ID is filled in but the sales rep ID might be null.  In other words, usually you need the ability to have a null FK when you may not know its value at the time the data is entered, but you do know other values in the table that need to be entered. To allow nulls in an FK generally all you have to do is allow nulls on the field that has the FK. The null value is separate from the idea of it being an FK. </p>

<p>Whether it is unique or not unique relates to whether the table has a one-one or a one-many relationship to the parent table.  Now if you have a one-one relationship, it is possible that you could have the data all in one table, but if the table is getting too wide or if the data is on a different topic (the employee - insurance example @tbone gave for instance), then you want separate tables with a FK. You would then want to make this FK either also the PK (which guarantees uniqueness) or put a unique constraint on it. </p>

<p>Most FKs are for a one to many relationship and that is what you get from a FK without adding a further constraint on the field. So you have an order table and the order details table for instance. If the customer orders ten items at one time, he has one order and ten order detail records that contain the same orderID as the FK. </p>
","7574042"
"Compare dates in MySQL","216056","","<p>I want to compare a date from a database that is between 2 given dates.
The column from the database is DATETIME, and I want to compare it only to the date format, not the datetime format.</p>

<pre><code>SELECT * FROM `players` WHERE CONVERT(CHAR(10),us_reg_date,120) &gt;= '2000-07-05' AND CONVERT(CHAR(10),us_reg_date,120) &lt;= '2011-11-10'
</code></pre>

<p>I get this error when I execute the SQL above:</p>

<blockquote>
  <p>You have an error in your SQL syntax;
  check the manual that corresponds to
  your MySQL server version for the
  right syntax to use near
  'us_reg_date,120) >= '2000-07-05' AND
  CONVERT(CHAR(10),us_reg_date,120) &lt;=
  '2011-' at line 1</p>
</blockquote>

<p>How can this problem be fixed?</p>
","<p>You can try below query,</p>

<pre><code>select * from players
where 
    us_reg_date between '2000-07-05'
and
    DATE_ADD('2011-11-10',INTERVAL 1 DAY)
</code></pre>
","3652415"
"How to SUM and SUBTRACT using SQL?","215554","","<p>I am using MySQL and I have two tables:</p>

<p><code>master_table</code></p>

<ul>
<li>ORDERNO </li>
<li>ITEM</li>
<li>QTY</li>
</ul>

<p><code>stock_bal</code> </p>

<ul>
<li>ITEM </li>
<li>BAL_QTY</li>
</ul>

<p>Master table has duplicate <code>ORDERNO</code> and <code>ITEM</code> values. I have get total <code>QTY</code> using SQL 'GROUP BY' clause.</p>

<p>I need to deduct/subtract <code>BAL_QTY</code> from SUM of <code>ITEM</code> (master_table).  I've got SUM <code>QTY</code> value using query (actually there are many rows).</p>
","<p>I think this is what you're looking for. <code>NEW_BAL</code> is the sum of <code>QTY</code>s subtracted from the balance:</p>

<pre><code>SELECT   master_table.ORDERNO,
         master_table.ITEM,
         SUM(master_table.QTY),
         stock_bal.BAL_QTY,
         (stock_bal.BAL_QTY - SUM(master_table.QTY)) AS NEW_BAL
FROM     master_table INNER JOIN
         stock_bal ON master_bal.ITEM = stock_bal.ITEM
GROUP BY master_table.ORDERNO,
         master_table.ITEM
</code></pre>

<p>If you want to update the item balance with the new balance, use the following:</p>

<pre><code>UPDATE stock_bal
SET    BAL_QTY = BAL_QTY - (SELECT   SUM(QTY)
                            FROM     master_table
                            GROUP BY master_table.ORDERNO,
                                     master_table.ITEM)
</code></pre>

<p>This assumes you posted the subtraction backward; it subtracts the quantities in the order from the balance, which makes the most sense without knowing more about your tables. Just swap those two to change it if I was wrong:</p>

<pre><code>(SUM(master_table.QTY) - stock_bal.BAL_QTY) AS NEW_BAL
</code></pre>
","6715121"
"What is the string concatenation operator in Oracle?","215537","","<p>What is the string concatenation operator in Oracle SQL?  </p>

<p>Are there any ""interesting"" features I should be careful of?  </p>

<p>(This seems obvious, but I couldn't find a previous question asking it).  </p>
","<p>It is <code>||</code>, for example:</p>

<pre><code>select 'Mr ' || ename from emp;
</code></pre>

<p>The only ""interesting"" feature I can think of is that <code>'x' || null</code> returns <code>'x'</code>, not <code>null</code> as you might perhaps expect.</p>
","278198"
"Get record counts for all tables in MySQL database","215493","","<p>Is there a way to get the count of rows in all tables in a MySQL database without running a <code>SELECT count()</code> on each table?</p>
","<pre><code>SELECT SUM(TABLE_ROWS) 
     FROM INFORMATION_SCHEMA.TABLES 
     WHERE TABLE_SCHEMA = '{your_db}';
</code></pre>

<p><a href=""https://dev.mysql.com/doc/refman/5.7/en/tables-table.html"" rel=""noreferrer"">Note from the docs though:</a> For InnoDB tables, <strong>the row count is only a rough estimate</strong> used in SQL optimization. You'll need to use COUNT(*) for exact counts (which is more expensive).</p>
","286048"
"Multiple rows to one comma-separated value","215487","","<p>I want to create a table valued function in SQL Server, which I want to return data in comma separated values.</p>

<p>For example table: <code>tbl</code></p>

<pre><code>ID | Value
---+-------
 1 | 100
 1 | 200
 1 | 300     
 1 | 400 
</code></pre>

<p>Now when I execute the query using the function <code>Func1(value)</code></p>

<pre><code>SELECT Func1(Value) 
FROM tbl 
WHERE ID = 1
</code></pre>

<p>Output that I want is: <code>100,200,300,400</code></p>
","<p><strong>Test Data</strong></p>

<pre><code>DECLARE @Table1 TABLE(ID INT, Value INT)
INSERT INTO @Table1 VALUES (1,100),(1,200),(1,300),(1,400)
</code></pre>

<p><strong>Query</strong></p>

<pre><code>SELECT  ID
       ,STUFF((SELECT ', ' + CAST(Value AS VARCHAR(10)) [text()]
         FROM @Table1 
         WHERE ID = t.ID
         FOR XML PATH(''), TYPE)
        .value('.','NVARCHAR(MAX)'),1,2,' ') List_Output
FROM @Table1 t
GROUP BY ID
</code></pre>

<p><strong>Result Set</strong></p>

<pre><code>╔════╦═════════════════════╗
║ ID ║     List_Output     ║
╠════╬═════════════════════╣
║  1 ║  100, 200, 300, 400 ║
╚════╩═════════════════════╝
</code></pre>
","21761267"
"How to find what is locking my tables","214929","","<p>I have a SQL table that all of a sudden cannot return data unless I include ""with (nolock)"" on the end, which indicates some kind of lock left on my table.  I've experimented a bit with dm_tran_locks to identify that there are in fact a number of locks on the table, but how do I identify <em>what</em> is locking them (ie the request element of the dm_tran_locks)?</p>

<p>EDIT: I know about sp_lock for pre SQL 2005, but now that that sp is deprecated, AFAIK the right way to do this is with dm_tran_locks.  I'm using SQL Server 2008 R2.</p>
","<p>Take a look at the following system stored procedures, which you can run in SQLServer Management Studio (SSMS):</p>

<ul>
<li>sp_who</li>
<li>sp_lock</li>
</ul>

<p>Also, in SSMS, you can view locks and processes in different ways:</p>

<p><img src=""https://i.stack.imgur.com/FsGGg.png"" alt=""enter image description here""></p>

<p>Different versions of SSMS put the activity monitor in different places.  For example, SSMS 2008 and 2012 have it in the context menu when you right-click on a server node.</p>
","8749551"
"Case insensitive searching in Oracle","213873","","<p>The default behaviour of LIKE and the other comparison operators, <code>=</code> etc is case-sensitive.</p>

<p>Is it possible make them case-insensitive?</p>
","<p>Since 10gR2, Oracle allows to fine-tune the behaviour of string comparisons by setting the <a href=""http://docs.oracle.com/cd/B28359_01/server.111/b28320/initparams135.htm#REFRN10117""><code>NLS_COMP</code></a> and <a href=""http://docs.oracle.com/cd/B28359_01/server.111/b28320/initparams145.htm#REFRN10127""><code>NLS_SORT</code></a> session parameters:</p>

<pre><code>SQL&gt; SET HEADING OFF
SQL&gt; SELECT *
  2  FROM NLS_SESSION_PARAMETERS
  3  WHERE PARAMETER IN ('NLS_COMP', 'NLS_SORT');

NLS_SORT
BINARY

NLS_COMP
BINARY


SQL&gt;
SQL&gt; SELECT CASE WHEN 'abc'='ABC' THEN 1 ELSE 0 END AS GOT_MATCH
  2  FROM DUAL;

         0

SQL&gt;
SQL&gt; ALTER SESSION SET NLS_COMP=LINGUISTIC;

Session altered.

SQL&gt; ALTER SESSION SET NLS_SORT=BINARY_CI;

Session altered.

SQL&gt;
SQL&gt; SELECT *
  2  FROM NLS_SESSION_PARAMETERS
  3  WHERE PARAMETER IN ('NLS_COMP', 'NLS_SORT');

NLS_SORT
BINARY_CI

NLS_COMP
LINGUISTIC


SQL&gt;
SQL&gt; SELECT CASE WHEN 'abc'='ABC' THEN 1 ELSE 0 END AS GOT_MATCH
  2  FROM DUAL;

         1
</code></pre>

<p>You can also create case insensitive indexes:</p>

<pre><code>create index
   nlsci1_gen_person
on
   MY_PERSON
   (NLSSORT
      (PERSON_LAST_NAME, 'NLS_SORT=BINARY_CI')
   )
;
</code></pre>

<p>This information was taken from <a href=""http://www.dba-oracle.com/t_case_insensitive_indexes_searches.htm"">Oracle case insensitive searches</a>. The article mentions <code>REGEXP_LIKE</code> but it seems to work with good old <code>=</code> as well.</p>

<hr>

<p>In versions older than 10gR2 it can't really be done and the usual approach, if you don't need <em>accent-insensitive</em> search, is to just <code>UPPER()</code> both the column and the search expression.</p>
","5391234"
"How can I confirm a database is Oracle & what version it is using SQL?","213387","","<p>I'm building an installer for an application. The user gets to select a datasource they have configured and nominate what type of database it is.  I want to confirm that the database type is indeed Oracle, and if possible, what version of Oracle they are running by sending a SQL statement to the datasource.</p>
","<p>Run this SQL:</p>

<pre><code>select * from v$version;
</code></pre>

<p>And you'll get a result like:    </p>

<pre><code>BANNER
----------------------------------------------------------------
Oracle Database 10g Release 10.2.0.3.0 - 64bit Production
PL/SQL Release 10.2.0.3.0 - Production
CORE    10.2.0.3.0      Production
TNS for Solaris: Version 10.2.0.3.0 - Production
NLSRTL Version 10.2.0.3.0 - Production
</code></pre>
","101197"
"How do you transfer or export SQL Server 2005 data to Excel","213310","","<p>I have a simple SQL 'Select' query, and I'd like to dump the results into an Excel file. I'm only able to save as .csv and converting to .xls creates some super ugly output. In any case, as far as I can tell (using Google) this doesn't seem to be so straight forward. Any help would be greatly appreciated.</p>
","<p>Use ""External data"" from Excel. It can use ODBC connection to fetch data from external source: Data/Get External Data/New Database Query</p>

<p>That way, even if the data in the database changes, you can easily refresh.</p>
","87759"
"Get the records of last month in SQL server","213294","","<p>I want to get the records of last month based on my db table [member] field ""date_created"".</p>

<p>What's the sql to do this?</p>

<p>For clarification, 
last month - 1/8/2009 to 31/8/2009</p>

<p>If today is 3/1/2010, I'll need to get the records of 1/12/2009 to 31/12/2009.</p>
","<pre><code>SELECT * 
FROM Member
WHERE DATEPART(m, date_created) = DATEPART(m, DATEADD(m, -1, getdate()))
AND DATEPART(yyyy, date_created) = DATEPART(yyyy, DATEADD(m, -1, getdate()))
</code></pre>

<p>You need to check the month and year.</p>
","1425025"
"Oracle insert from select into table with more columns","213047","","<p>I want to insert to a table from a select statement, however, there are 3 columns returned from the select statement and the table has 4 columns, I would like to add 0 for all rows in the extra column. Can anyone give me a sample SQL query for that?</p>

<p>Thank you!</p>
","<p>Just add in the '0' in your select.</p>

<pre><code>INSERT INTO table_name (a,b,c,d)
    SELECT
       other_table.a AS a,
       other_table.b AS b,
       other_table.c AS c,
       '0' AS d
    FROM other_table
</code></pre>
","10842956"
"how to schedule a job for sql query to run daily?","212412","","<p>I need to know how to make an sql query run daily using sql server agent jobs with minimum required configuration settings.</p>
","<ol>
<li><p>Expand the SQL Server Agent node and right click the Jobs node in SQL Server Agent and select <code>'New Job'</code></p></li>
<li><p>In the <code>'New Job'</code> window enter the name of the job and a description on the <code>'General'</code> tab.</p></li>
<li><p>Select <code>'Steps'</code> on the left hand side of the window and click <code>'New'</code> at the bottom.</p></li>
<li><p>In the <code>'Steps'</code> window enter a step name and select the database you want the query to run against.</p></li>
<li><p>Paste in the T-SQL command you want to run into the Command window and click <code>'OK'</code>.</p></li>
<li><p>Click on the <code>'Schedule'</code> menu on the left of the New Job window and enter the schedule information (e.g. daily and a time).</p></li>
<li><p>Click <code>'OK'</code> - and that should be it.</p></li>
</ol>

<p>(There are of course other options you can add - but I would say that is the bare minimum you need to get a job set up and scheduled)</p>
","5471440"
"SQL Server IF NOT EXISTS Usage?","212397","","<p>Ok, so my schema is this:</p>

<p>Table: Timesheet_Hours</p>

<p>Columns:</p>

<ul>
<li>Timesheet_Id (PK, int)</li>
<li>Staff_Id (int)</li>
<li>BookedHours (int)</li>
<li>Posted_Flag (boolean)</li>
</ul>

<p>This is an extremely simplified version of the table, but it will serve for the purposes of this explaination. Assume that a person can only ever have one timesheet record.</p>

<p>What I'm trying to do is add records to another table, called WorkLog. Each record here has a time associated with it. When that table is updated, I want to update Timesheet_Hours as well.</p>

<p>Before I update Timesheet_Hours, I want to check first that the relevant Timesheets haven't already been posted, and then I want to check if there is in fact a record to update in the first place.</p>

<p>The first part of the if statement, which checks to see that the timesheets haven't already been posted, works fine. The problem is the second part. It is checkint to see that the record it is going to update already exists. The issue is that it always raises an error.</p>

<p>NB: The code below is extracted from a stored procedure run by the update, insert and delete triggers on the WorkLog table. @PersonID is one of the parameters to that table. The stored procedure works fine if I comment out the second part of this statement.</p>

<pre><code>IF EXISTS
    (
    SELECT 1
    FROM Timesheet_Hours
    WHERE Posted_Flag = 1
    AND Staff_Id = @PersonID
    )

    BEGIN
        RAISERROR('Timesheets have already been posted!', 16, 1)
        ROLLBACK TRAN
    END
ELSE
    IF NOT EXISTS
        (
        SELECT 1
        FROM Timesheet_Hours
        WHERE Staff_Id = @PersonID
        )

        BEGIN
            RAISERROR('Default list has not been loaded!', 16, 1)
            ROLLBACK TRAN
        END
</code></pre>
","<p>Have you verified that there is in fact a row where Staff_Id = @PersonID?  What you've posted works fine in a test script, assuming the row exists.  If you comment out the insert statement, then the error is raised.</p>

<pre><code>set nocount on

create table Timesheet_Hours (Staff_Id int, BookedHours int, Posted_Flag bit)

insert into Timesheet_Hours (Staff_Id, BookedHours, Posted_Flag) values (1, 5.5, 0)

declare @PersonID int
set @PersonID = 1

IF EXISTS    
    (
    SELECT 1    
    FROM Timesheet_Hours    
    WHERE Posted_Flag = 1    
        AND Staff_Id = @PersonID    
    )    
    BEGIN
        RAISERROR('Timesheets have already been posted!', 16, 1)
        ROLLBACK TRAN
    END
ELSE
    IF NOT EXISTS
        (
        SELECT 1
        FROM Timesheet_Hours
        WHERE Staff_Id = @PersonID
        )
        BEGIN
            RAISERROR('Default list has not been loaded!', 16, 1)
            ROLLBACK TRAN
        END
    ELSE
        print 'No problems here'

drop table Timesheet_Hours
</code></pre>
","1175307"
"How to select unique records by SQL","212396","","<p>When I perform ""SELECT * FROM table"" I got results like below:</p>

<pre><code>1 item1 data1
2 item1 data2
3 item2 data3
4 item3 data4
</code></pre>

<p>As you can see, there are dup records from column2 (item1 are dupped). So how could I just get result like this:</p>

<pre><code>1 item1 data1
2 item2 data3
3 item3 data4
</code></pre>

<p>Only one record are returned from the duplicate, along with the rest of the unique records.</p>
","<p>You can use <code>SELECT DISTINCT</code> or <code>GROUP BY</code> to do this.</p>

<pre><code>SELECT DISTINCT a, c
FROM table_c
</code></pre>

<p>or</p>

<pre><code>SELECT a, b
FROM table_c
GROUP BY a, b
</code></pre>

<p><code>GROUP BY</code> will be more helpful if you want to use some aggregate function like <code>COUNT()</code> or <code>SUM()</code></p>

<pre><code>SELECT a, b, count(*)
FROM table_c
GROUP BY a, b

SELECT a, b, sum(d)
FROM table_c
GROUP BY a, b
</code></pre>
","1641732"
"SQL update trigger only when column is modified","211968","","<p>By looking at other examples I've come up with the following but it doesn't seem to work as I would like: I want it to only update the modified information if the <code>QtyToRepair</code> value has been updated... but it doesn't do that. </p>

<p>If I comment out the where then the modified information is updated in every case. As I said other examples led me to be optimistic. Any clues appreciated. Thanks.</p>

<p>Walter</p>

<pre><code>ALTER TRIGGER [dbo].[tr_SCHEDULE_Modified]
   ON [dbo].[SCHEDULE]
   AFTER UPDATE
AS 
BEGIN
    SET NOCOUNT ON;

    UPDATE SCHEDULE SET modified = GETDATE()
        , ModifiedUser = SUSER_NAME()
        , ModifiedHost = HOST_NAME()
    FROM SCHEDULE S
    INNER JOIN Inserted I on S.OrderNo = I.OrderNo and S.PartNumber = I.PartNumber
    WHERE S.QtyToRepair &lt;&gt; I.QtyToRepair
END
</code></pre>
","<p>You have two way for your question :</p>

<p>1- Use Update Command in your Trigger.</p>

<pre><code>ALTER TRIGGER [dbo].[tr_SCHEDULE_Modified]
   ON [dbo].[SCHEDULE]
   AFTER UPDATE
AS BEGIN
    SET NOCOUNT ON;
    IF UPDATE (QtyToRepair) 
    BEGIN
        UPDATE SCHEDULE 
        SET modified = GETDATE()
           , ModifiedUser = SUSER_NAME()
           , ModifiedHost = HOST_NAME()
        FROM SCHEDULE S INNER JOIN Inserted I 
        ON S.OrderNo = I.OrderNo and S.PartNumber = I.PartNumber
        WHERE S.QtyToRepair &lt;&gt; I.QtyToRepair
    END 
END
</code></pre>

<p>2- Use Join between Inserted table and deleted table</p>

<pre><code>ALTER TRIGGER [dbo].[tr_SCHEDULE_Modified]
   ON [dbo].[SCHEDULE]
   AFTER UPDATE
AS BEGIN
    SET NOCOUNT ON;    

    UPDATE SCHEDULE 
    SET modified = GETDATE()
       , ModifiedUser = SUSER_NAME()
       , ModifiedHost = HOST_NAME()
    FROM SCHEDULE S 
    INNER JOIN Inserted I ON S.OrderNo = I.OrderNo and S.PartNumber = I.PartNumber
    INNER JOIN Deleted D ON S.OrderNo = D.OrderNo and S.PartNumber = D.PartNumber                  
    WHERE S.QtyToRepair &lt;&gt; I.QtyToRepair
    AND D.QtyToRepair &lt;&gt; I.QtyToRepair
END
</code></pre>

<p>When you use update command for table <code>SCHEDULE</code> and Set <code>QtyToRepair</code> Column to new value, if new value equal to old value in one or multi row, solution 1 update all updated row in Schedule table but solution 2 update only schedule rows that old value not equal to new value.</p>
","12141730"
"Combine two tables for one output","211648","","<p>Say I have two tables:</p>

<p>KnownHours:</p>

<pre>
ChargeNum    CategoryID    Month    Hours
111111       1             2/1/09   10
111111       1             3/1/09   30
111111       1             4/1/09   50
222222       1             3/1/09   40
111111       2             4/1/09   50
</pre>

<p>UnknownHours:</p>

<pre>
ChargeNum   Month   Hours
111111      2/1/09  70
111111      3/1/09  40.5
222222      7/1/09  25.5
</pre>

<p>I need to group these hours, ignoring Month, into a single data table so that my expected result is the following:</p>

<pre>
ChargeNum    CategoryID     Hours
111111       1              90
111111       2              50
111111       Unknown        110.5
222222       1              40
222222       Unknown        25.5
</pre>

<p>I cannot seem to figure this out. Any help would be greatly appreciated!</p>

<p>EDIT: I need to sum the hours for each ChargeNum/Category combination.  I updated the sample data to reflect this.</p>
","<p>You'll need to use <code>UNION</code> to combine the results of two queries. In your case:</p>

<pre><code>SELECT ChargeNum, CategoryID, SUM(Hours)
FROM KnownHours
GROUP BY ChargeNum, CategoryID
UNION ALL
SELECT ChargeNum, 'Unknown' AS CategoryID, SUM(Hours)
FROM UnknownHours
GROUP BY ChargeNum
</code></pre>

<p>Note - If you use <code>UNION ALL</code> as in above, it's no slower than running the two queries separately as it does no duplicate-checking.</p>
","1227844"
"postgres: upgrade a user to be a superuser?","211225","","<p>In postgres, how do I change an existing user to be a superuser? I don't want to delete the existing user, for various reasons. </p>

<pre><code># alter user myuser ...?
</code></pre>
","<pre><code>ALTER USER myuser WITH SUPERUSER;
</code></pre>

<p><a href=""http://www.postgresql.org/docs/current/static/sql-alteruser.html"" rel=""noreferrer"">Docs.</a></p>
","10757486"
"IndexOf function in T-SQL","210948","","<p>Given an email address column, I need to find the position of the @ sign for substringing.</p>

<p>What is the <code>indexof</code> function, for strings in T-SQL?</p>

<p>Looking for something that returns the position of a substring within a string.</p>

<p>in C#</p>

<pre class=""lang-cs prettyprint-override""><code>var s = ""abcde"";
s.IndexOf('c'); // yields 2
</code></pre>
","<p><a href=""http://msdn.microsoft.com/en-us/library/ms186323.aspx"" rel=""noreferrer"">CHARINDEX</a> is what you are looking for</p>

<pre><code>select CHARINDEX('@', 'someone@somewhere.com')
-----------
8

(1 row(s) affected)
</code></pre>

<p>-or-</p>

<pre><code>select CHARINDEX('c', 'abcde')
-----------
3

(1 row(s) affected)
</code></pre>
","1869471"
"Error related to only_full_group_by when executing a query in MySql","210796","","<p>I have upgraded my system and have installed MySql 5.7.9 with php for a web application I am working on. I have a query that is dynamically created, and when run in older versions of MySql it works fine.  Since upgrading to 5.7 I get this error:</p>

<blockquote>
  <p>Expression #1 of SELECT list is not in GROUP BY clause and contains
  nonaggregated column 'support_desk.mod_users_groups.group_id' which is
  not functionally dependent on columns in GROUP BY clause; this is
  incompatible with sql_mode=only_full_group_by</p>
</blockquote>

<p>Note the Manual page for Mysql 5.7 on the topic of <a href=""http://dev.mysql.com/doc/refman/5.7/en/sql-mode.html"">Server SQL Modes</a>.</p>

<p>This is the query that is giving me trouble:</p>

<pre class=""lang-sql prettyprint-override""><code>SELECT mod_users_groups.group_id AS 'value', 
       group_name AS 'text' 
FROM mod_users_groups
LEFT JOIN mod_users_data ON mod_users_groups.group_id = mod_users_data.group_id 
WHERE  mod_users_groups.active = 1 
  AND mod_users_groups.department_id = 1 
  AND mod_users_groups.manage_work_orders = 1 
  AND group_name != 'root' 
  AND group_name != 'superuser' 
GROUP BY group_name 
HAVING COUNT(`user_id`) &gt; 0 
ORDER BY group_name
</code></pre>

<p>I did some googling on the issue, but I don't understand <code>only_full_group_by</code> enough to figure out what I need to do to fix the query. Can I just turn off the <code>only_full_group_by</code> option, or is there something else I need to do?</p>

<p>Let me know if you need more information.</p>
","<p>I would just add <code>group_id</code> to the <code>GROUP BY</code>. </p>

<p>When <code>SELECT</code>ing a column that is not part of the <code>GROUP BY</code> there could be multiple values for that column within the groups, but there will only be space for a single value in the results. So, the database <em>usually</em> needs to be told exactly how to make those multiple values into one value. Commonly, this is done with an aggregate function like <code>COUNT()</code>, <code>SUM()</code>, <code>MAX()</code> etc... I say <em>usually</em> because most other popular database systems insist on this. However, in MySQL prior to version 5.7 the default behaviour has been more forgiving because it will not complain and then arbitrarily choose <em>any value</em>! It also has an <code>ANY_VALUE()</code> function that could be used as another solution to this question if you really needed the same behaviour as before. This flexibility comes at a cost because it is non-deterministic, so I would not recommend it unless you have a very good reason for needing it. MySQL are now turning on the <code>only_full_group_by</code> setting by default for good reasons, so it's best to get used to it and make your queries comply with it.</p>

<p>So why my simple answer above? I've made a couple of assumptions:</p>

<p>1) the <code>group_id</code> is unique. Seems reasonable, it is an 'ID' after all.</p>

<p>2) the <code>group_name</code> is also unique. This may not be such a reasonable assumption. If this is not the case and you have some duplicate <code>group_names</code> and you then follow my advice to add <code>group_id</code> to the <code>GROUP BY</code>, you may find that you now get more results than before because the groups with the same name will now have separate rows in the results. To me, this would be better than having these duplicate groups hidden because the database has quietly selected a value arbitrarily!    </p>

<p>It's also good practice to qualify all the columns with their table name or alias when there's more than one table involved... </p>

<pre class=""lang-sql prettyprint-override""><code>SELECT 
  g.group_id AS 'value', 
  g.group_name AS 'text' 
FROM mod_users_groups g
LEFT JOIN mod_users_data d ON g.group_id = d.group_id 
WHERE g.active = 1 
  AND g.department_id = 1 
  AND g.manage_work_orders = 1 
  AND g.group_name != 'root' 
  AND g.group_name != 'superuser' 
GROUP BY 
  g.group_name, 
  g.group_id 
HAVING COUNT(d.user_id) &gt; 0 
ORDER BY g.group_name
</code></pre>
","34115425"
"GROUP BY with MAX(DATE)","210170","","<p>I'm trying to list the latest destination (MAX departure time) for each train in a table, <a href=""http://googledrive.com/host/0B53jM4a9X2fqfnRaUjZQOGhKd2pBbC1Yd1p5UmlJNTRQNEswWnNsZkVfS1p0NEVSSmtHUzA"" rel=""noreferrer"">for example</a>:</p>

<pre><code>Train    Dest      Time
1        HK        10:00
1        SH        12:00
1        SZ        14:00
2        HK        13:00
2        SH        09:00
2        SZ        07:00
</code></pre>

<p>The desired result should be:</p>

<pre><code>Train    Dest      Time
1        SZ        14:00
2        HK        13:00
</code></pre>

<p>I have tried using</p>

<pre><code>SELECT Train, Dest, MAX(Time)
FROM TrainTable
GROUP BY Train
</code></pre>

<p>by I got a ""ora-00979 not a GROUP BY expression"" error saying that I must include 'Dest' in my group by statement. But surely that's not what I want...</p>

<p>Is it possible to do it in one line of SQL?</p>
","<p>You cannot include non-aggregated columns in your result set which are not grouped. If a train has only one destination, then just add the destination column to your group by clause, otherwise you need to rethink your query.</p>

<p>Try:</p>

<pre><code>SELECT t.Train, t.Dest, r.MaxTime
FROM (
      SELECT Train, MAX(Time) as MaxTime
      FROM TrainTable
      GROUP BY Train
) r
INNER JOIN TrainTable t
ON t.Train = r.Train AND t.Time = r.MaxTime
</code></pre>
","3491386"
"How to select records without duplicate on just one field in SQL?","209989","","<p>I have a table with 3 columns like this:  </p>

<pre><code>+------------+---------------+-------+  
| Country_id | country_title | State |  
+------------+---------------+-------+    
</code></pre>

<p>There are many records in this table. Some of them have <code>state</code> and some other don't. Now, imagine these records:  </p>

<pre><code>1 | Canada  | Alberta  
2 |  Canada | British  Columbia  
3 | Canada  | Manitoba  
4 | China   |
</code></pre>

<p>I need to have country names without any duplicate. Actually I need their <code>id</code> and <code>title</code>, What is the best SQL command to make this? I used <code>DISTINCT</code> in the form below but I could not achieve an appropriate result.  </p>

<pre><code>SELECT DISTINCT title,id FROM tbl_countries ORDER BY title
</code></pre>

<p>My desired result is something like this:  </p>

<pre><code>1, Canada  
4, China
</code></pre>
","<p>Try this:</p>

<pre><code>SELECT MIN(id) AS id, title
FROM tbl_countries
GROUP BY title
</code></pre>
","12239289"
"How do I combine 2 select statements into one?","209984","","<p>I am a noob when it comes to SQL syntax. </p>

<p>I have a table with lots of rows and columns of course :P
Lets say it looks like this:</p>

<pre><code>      AAA BBB CCC DDD
-----------------------
Row1 | 1   A   D   X
Row2 | 2   B   C   X
Row3 | 3   C   D   Z
</code></pre>

<p>Now I want to create an advanced select statement that gives me this combined (pseudo SQLish here):</p>

<pre><code>select 'Test1', * from TABLE Where CCC='D' AND DDD='X'
select 'Test2', * from TABLE Where CCC&lt;&gt;'D' AND DDD='X'
</code></pre>

<p>The output would be:</p>

<pre><code>Test1, 1, A, D, X
Test2, 2, B, C, X
</code></pre>

<p>How would I combine those two select statements into one nice select statement?</p>

<p>Would it work if I complicated the SQL like below (because my own SQL statement contains an exists statement)? I just want to know how I can combine the selects and then try to apply it to my somewhat more advanced SQL.</p>

<pre><code>select 'Test1', * from TABLE Where CCC='D' AND DDD='X' AND exists(select ...)
select 'Test2', * from TABLE Where CCC&lt;&gt;'D' AND DDD='X' AND exists(select ...)
</code></pre>

<p><br>
<br>
<br>
My REAL SQL statement is this one:</p>

<pre><code>select Status, * from WorkItems t1
where  exists (select 1 from workitems t2 where t1.TextField01=t2.TextField01 AND (BoolField05=1) )
AND TimeStamp=(select max(t2.TimeStamp) from workitems t2 where t2.TextField01=t1.TextField01) 
AND TimeStamp&gt;'2009-02-12 18:00:00'
</code></pre>

<p>which gives me a result. But I want to combine it with a copy of this select statement with an added AND on the end and the 'Status' field would be changed with a string like 'DELETED'.</p>

<pre><code>select 'DELETED', * from WorkItems t1
where  exists (select 1 from workitems t2 where t1.TextField01=t2.TextField01 AND (BoolField05=1) )
AND TimeStamp=(select max(t2.TimeStamp) from workitems t2 where t2.TextField01=t1.TextField01) 
AND TimeStamp&gt;'2009-02-12 18:00:00'
AND NOT (BoolField05=1)
</code></pre>
","<p>You have two choices here.  The first is to have two result sets which will set 'Test1' or 'Test2' based on the condition in the <code>WHERE</code> clause, and then <code>UNION</code> them together:</p>

<pre><code>select 
    'Test1', * 
from 
    TABLE 
Where 
    CCC='D' AND DDD='X' AND exists(select ...)
UNION
select 
    'Test2', * 
from 
    TABLE
Where
    CCC&lt;&gt;'D' AND DDD='X' AND exists(select ...)
</code></pre>

<p>This might be an issue, because you are going to effectively scan/seek on TABLE twice.</p>

<p>The other solution would be to select from the table once, and set 'Test1' or 'Test2' based on the conditions in TABLE:</p>

<pre><code>select 
    case 
        when CCC='D' AND DDD='X' AND exists(select ...) then 'Test1'
        when CCC&lt;&gt;'D' AND DDD='X' AND exists(select ...) then 'Test2'
    end,
    * 
from 
    TABLE 
Where 
    (CCC='D' AND DDD='X' AND exists(select ...)) or
    (CCC&lt;&gt;'D' AND DDD='X' AND exists(select ...))
</code></pre>

<p>The catch here being that you will have to duplicate the filter conditions in the <code>CASE</code> statement and the <code>WHERE</code> statement.</p>
","542735"
"Left Join With Where Clause","209669","","<p>I need to retrieve all default settings from the settings table but also grab the character setting if exists for x character. </p>

<p>But this query is only retrieving those settings where character is = 1, not the default settings if the user havent setted anyone.</p>

<pre><code>SELECT `settings`.*, `character_settings`.`value`
FROM (`settings`)
LEFT JOIN `character_settings` 
ON `character_settings`.`setting_id` = `settings`.`id`
WHERE `character_settings`.`character_id` = '1'  
</code></pre>

<p>So i should need something like this:</p>

<pre><code>array(
    '0' =&gt; array('somekey' =&gt; 'keyname', 'value' =&gt; 'thevalue'),
    '1' =&gt; array('somekey2' =&gt; 'keyname2'),
    '2' =&gt; array('somekey3' =&gt; 'keyname3')
)
</code></pre>

<p>Where key 1 and 2 are the default values when key 0 contains the default value with the character value.</p>
","<p>The <code>where</code> clause is filtering away rows where the <code>left join</code> doesn't succeed.  Move it to the join:</p>

<pre><code>SELECT  `settings`.*, `character_settings`.`value`
FROM    `settings`
LEFT JOIN 
       `character_settings` 
ON     `character_settings`.`setting_id` = `settings`.`id`
        AND `character_settings`.`character_id` = '1'  
</code></pre>
","4752507"
"How can I tell when a MySQL table was last updated?","208434","","<p>In the footer of my page, I would like to add something like ""last updated the xx/xx/200x"" with this date being the last time a certain mySQL table has been updated.</p>

<p>What is the best way to do that?  Is there a function to retrieve the last updated date? Should I access to the database every time I need this value?</p>
","<p>In later versions of MySQL you can use the <code>information_schema</code> database to tell you when another table was updated:</p>

<pre><code>SELECT UPDATE_TIME
FROM   information_schema.tables
WHERE  TABLE_SCHEMA = 'dbname'
   AND TABLE_NAME = 'tabname'
</code></pre>

<p>This does of course mean opening a connection to the database.</p>

<hr>

<p>An alternative option would be to ""touch"" a particular file whenever the MySQL table is updated:</p>

<p>On database updates:</p>

<ul>
<li>Open your timestamp file in <code>O_RDRW</code> mode</li>
<li><code>close</code> it again</li>
</ul>

<p>or alternatively</p>

<ul>
<li>use <a href=""http://us3.php.net/manual/en/function.touch.php"" rel=""noreferrer""><code>touch()</code></a>, the PHP equivalent of the <code>utimes()</code> function, to change the file timestamp.</li>
</ul>

<p>On page display:</p>

<ul>
<li>use <code>stat()</code> to read back the file modification time.</li>
</ul>
","307488"
"Copy data from one column to other column (which is in a different table)","208331","","<p>I want to copy data from one column to another column of other table. How can I do that?</p>

<p>I tried the following:</p>

<pre><code>Update tblindiantime Set CountryName =(Select contacts.BusinessCountry From contacts) 
</code></pre>

<p>but it did not work.</p>

<p>I want to copy ""BusinessCountry"" column of contact table to ""CountryName"" column of tblindiantime table.</p>
","<p>In SQL Server 2008 you can use a multi-table update as follows:</p>

<pre><code>UPDATE tblindiantime 
SET tblindiantime.CountryName = contacts.BusinessCountry
FROM tblindiantime 
JOIN contacts
ON -- join condition here
</code></pre>

<p>You need a join condition to specify which row should be updated.</p>

<p>If the target table is currently empty then you should use an INSERT instead:</p>

<pre><code>INSERT INTO tblindiantime (CountryName)
SELECT BusinessCountry FROM contacts
</code></pre>
","3361804"
"When to use Common Table Expression (CTE)","208140","","<p>I have begun reading about <em>Common Table Expression</em> and cannot think of a use case where I would need to use them. They would seem to be redundant as the same can be done with derived tables. Is there something I am missing or not understanding well? Can someone give me a simple example of limitations with regular select, derived or temp table queries to make the case of CTE? Any simple examples would be highly appreciated.</p>
","<p>One example, if you need to reference/join the same data set multiple times you can do so by defining a CTE. Therefore, it can be a form of code re-use.</p>

<p>An example of self referencing is recursion: <a href=""http://msdn.microsoft.com/en-us/library/ms186243.aspx"" rel=""noreferrer"">Recursive Queries Using CTE</a></p>

<p>For exciting Microsoft definitions
<a href=""http://msdn.microsoft.com/en-us/library/ms190766.aspx"" rel=""noreferrer"">Taken from Books Online:</a></p>

<p>A CTE can be used to:</p>

<ul>
<li><p>Create a recursive query. For more information, see <a href=""http://msdn.microsoft.com/en-us/library/ms186243.aspx"" rel=""noreferrer"">Recursive Queries Using Common Table Expressions.</a></p></li>
<li><p>Substitute for a view when the general use of a view is not required; that is, you do not have to store the definition in metadata.</p></li>
<li><p>Enable grouping by a column that is derived from a scalar subselect, or a function that is either not deterministic or has external access.</p></li>
<li><p>Reference the resulting table multiple times in the same statement.</p></li>
</ul>
","4740800"
"INNER JOIN vs LEFT JOIN performance in SQL Server","208119","","<p>I've created SQL command that use INNER JOIN for 9 tables, anyway this command take a very long time (more than five minutes). So my folk suggest me to change INNER JOIN to LEFT JOIN because the performance of LEFT JOIN is better, at first time its despite what I know. After I changed, the speed of query is significantly improve.</p>

<p>I would like to know why LEFT JOIN is faster than INNER JOIN?</p>

<p>My SQL command look like below:
<code>SELECT * FROM A INNER JOIN B ON ... INNER JOIN C ON ... INNER JOIN D</code> and so on</p>

<p><strong>Update:</strong>
This is brief of my schema.</p>

<pre><code>FROM sidisaleshdrmly a -- NOT HAVE PK AND FK
    INNER JOIN sidisalesdetmly b -- THIS TABLE ALSO HAVE NO PK AND FK
        ON a.CompanyCd = b.CompanyCd 
           AND a.SPRNo = b.SPRNo 
           AND a.SuffixNo = b.SuffixNo 
           AND a.dnno = b.dnno
    INNER JOIN exFSlipDet h -- PK = CompanyCd, FSlipNo, FSlipSuffix, FSlipLine
        ON a.CompanyCd = h.CompanyCd
           AND a.sprno = h.AcctSPRNo
    INNER JOIN exFSlipHdr c -- PK = CompanyCd, FSlipNo, FSlipSuffix
        ON c.CompanyCd = h.CompanyCd
           AND c.FSlipNo = h.FSlipNo 
           AND c.FSlipSuffix = h.FSlipSuffix 
    INNER JOIN coMappingExpParty d -- NO PK AND FK
        ON c.CompanyCd = d.CompanyCd
           AND c.CountryCd = d.CountryCd 
    INNER JOIN coProduct e -- PK = CompanyCd, ProductSalesCd
        ON b.CompanyCd = e.CompanyCd
           AND b.ProductSalesCd = e.ProductSalesCd 
    LEFT JOIN coUOM i -- PK = UOMId
        ON h.UOMId = i.UOMId 
    INNER JOIN coProductOldInformation j -- PK = CompanyCd, BFStatus, SpecCd
        ON a.CompanyCd = j.CompanyCd
            AND b.BFStatus = j.BFStatus
            AND b.ProductSalesCd = j.ProductSalesCd
    INNER JOIN coProductGroup1 g1 -- PK = CompanyCd, ProductCategoryCd, UsedDepartment, ProductGroup1Cd
        ON e.ProductGroup1Cd  = g1.ProductGroup1Cd
    INNER JOIN coProductGroup2 g2 -- PK = CompanyCd, ProductCategoryCd, UsedDepartment, ProductGroup2Cd
        ON e.ProductGroup1Cd  = g2.ProductGroup1Cd
</code></pre>
","<p>A <code>LEFT JOIN</code> is absolutely not faster than an <code>INNER JOIN</code>.  In fact, it's slower; by definition, an outer join (<code>LEFT JOIN</code> or <code>RIGHT JOIN</code>)  has to do all the work of an <code>INNER JOIN</code> plus the extra work of null-extending the results.  It would also be expected to return more rows, further increasing the total execution time simply due to the larger size of the result set.</p>

<p>(And even if a <code>LEFT JOIN</code> <em>were</em> faster in <em>specific</em> situations due to some difficult-to-imagine confluence of factors, it is not functionally equivalent to an <code>INNER JOIN</code>, so you cannot simply go replacing all instances of one with the other!)</p>

<p>Most likely your performance problems lie elsewhere, such as not having a candidate key or foreign key indexed properly.  9 tables is quite a lot to be joining so the slowdown could literally be almost anywhere.  If you post your schema, we might be able to provide more details.</p>

<hr>

<p><strong>Edit:</strong></p>

<p>Reflecting further on this, I could think of one circumstance under which a <code>LEFT JOIN</code> might be faster than an <code>INNER JOIN</code>, and that is when:</p>

<ul>
<li>Some of the tables are <em>very</em> small (say, under 10 rows);</li>
<li>The tables do not have sufficient indexes to cover the query.</li>
</ul>

<p>Consider this example:</p>

<pre><code>CREATE TABLE #Test1
(
    ID int NOT NULL PRIMARY KEY,
    Name varchar(50) NOT NULL
)
INSERT #Test1 (ID, Name) VALUES (1, 'One')
INSERT #Test1 (ID, Name) VALUES (2, 'Two')
INSERT #Test1 (ID, Name) VALUES (3, 'Three')
INSERT #Test1 (ID, Name) VALUES (4, 'Four')
INSERT #Test1 (ID, Name) VALUES (5, 'Five')

CREATE TABLE #Test2
(
    ID int NOT NULL PRIMARY KEY,
    Name varchar(50) NOT NULL
)
INSERT #Test2 (ID, Name) VALUES (1, 'One')
INSERT #Test2 (ID, Name) VALUES (2, 'Two')
INSERT #Test2 (ID, Name) VALUES (3, 'Three')
INSERT #Test2 (ID, Name) VALUES (4, 'Four')
INSERT #Test2 (ID, Name) VALUES (5, 'Five')

SELECT *
FROM #Test1 t1
INNER JOIN #Test2 t2
ON t2.Name = t1.Name

SELECT *
FROM #Test1 t1
LEFT JOIN #Test2 t2
ON t2.Name = t1.Name

DROP TABLE #Test1
DROP TABLE #Test2
</code></pre>

<p>If you run this and view the execution plan, you'll see that the <code>INNER JOIN</code> query does indeed cost more than the <code>LEFT JOIN</code>, because it satisfies the two criteria above.  It's because SQL Server wants to do a hash match for the <code>INNER JOIN</code>, but does nested loops for the <code>LEFT JOIN</code>; the former is <em>normally</em> much faster, but since the number of rows is so tiny <em>and</em> there's no index to use, the hashing operation turns out to be the most expensive part of the query.</p>

<p>You can see the same effect by writing a program in your favourite programming language to perform a large number of lookups on a list with 5 elements, vs. a hash table with 5 elements.  Because of the size, the hash table version is actually slower.  But increase it to 50 elements, or 5000 elements, and the list version slows to a crawl, because it's O(N) vs. O(1) for the hashtable.</p>

<p>But change this query to be on the <code>ID</code> column instead of <code>Name</code> and you'll see a very different story.  In that case, it does nested loops for both queries, but the <code>INNER JOIN</code> version is able to replace one of the clustered index scans with a seek - meaning that this will literally be <em>an order of magnitude</em> faster with a large number of rows.</p>

<p>So the conclusion is more or less what I mentioned several paragraphs above; this is almost certainly an indexing or index coverage problem, possibly combined with one or more very small tables.  Those are the only circumstances under which SQL Server <em>might</em> sometimes choose a worse execution plan for an <code>INNER JOIN</code> than a <code>LEFT JOIN</code>.</p>
","2726683"
"How to get multiple counts with one SQL query?","207962","","<p>I am wondering how to write this query.</p>

<p>I know this actual syntax is bogus, but it will help you understand what I am wanting.
I need it in this format, because it is part of a much bigger query.</p>

<pre><code>SELECT distributor_id, 
COUNT(*) AS TOTAL, 
COUNT(*) WHERE level = 'exec', 
COUNT(*) WHERE level = 'personal'
</code></pre>

<p>I need this all returned in one query. </p>

<p>Also, it need to be in one row, so the following won't work:</p>

<pre><code>'SELECT distributor_id, COUNT(*)
GROUP BY distributor_id'
</code></pre>
","<p>You can use a <code>CASE</code> statement with an aggregate function. This is basically the same thing as a <code>PIVOT</code> function in some RDBMS:</p>

<pre><code>select distributor_id,
    count(*) total,
    sum(case when level = 'exec' then 1 else 0 end) ExecCount,
    sum(case when level = 'personal' then 1 else 0 end) PersonalCount
from yourtable
group by distributor_id
</code></pre>
","12789493"
"Oracle SQL escape character (for a '&')","207902","","<p>While attempting to execute SQL insert statements using <a href=""http://www.oracle.com/technology/products/database/sql_developer/index.html"" rel=""noreferrer"">Oracle SQL Developer</a> I keep generating an ""Enter substitution value"" prompt:</p>

<pre><code>insert into agregadores_agregadores 
(
 idagregador,
 nombre,
 url
) 
values 
(
 2,
 'Netvibes',
 'http://www.netvibes.com/subscribe.php?type=rss\&amp;amp;url='
);
</code></pre>

<p>I've tried <a href=""http://download.oracle.com/docs/cd/B10501_01/text.920/a96518/cqspcl.htm"" rel=""noreferrer"">escaping the special character in the query</a> using the '\' above but I still can't avoid the ampersand, '&amp;', causing a string substitution.</p>

<p>Go ahead punks, make my day  :)</p>
","<p>the &amp; is the default value for DEFINE, which allows you to use substitution variables.  I like to turn it off using</p>

<p>SET DEFINE OFF</p>

<p>then you won't have to worry about escaping or CHR(38).  </p>
","1153624"
"how to increase sqlplus column output length?","207634","","<p>I have some queries to find out the ddl of some objects from a schema.
I am getting the result columns are truncated in middle of the queries.</p>

<p>How can I increase the with of the column?</p>

<p>I tried with </p>

<pre><code>SET SERVEROUTPUT ON SIZE 1000000;
SET LINESIZE 50000;
set pagesize 50000;
set long 50000;
</code></pre>

<p>But, still getting the same result.</p>

<p>Any help indeed.</p>

<p>Thanks</p>
","<p>I've just used the following command:</p>

<pre><code>SET LIN[ESIZE] 200
</code></pre>

<p>(from <a href=""http://ss64.com/ora/syntax-sqlplus-set.html"">http://ss64.com/ora/syntax-sqlplus-set.html</a>).</p>

<p>This works fine, but you have to ensure your console window is wide enough.  If you're using SQL Plus direct from MS Windows Command Prompt, the console window will automatically wrap the line at whatever the ""Screen Buffer Size <em>Width</em>"" property is set to, regardless of any SQL Plus <code>LINESIZE</code> specification.</p>

<p>As suggested by @simplyharsh, you can also configure individual columns to display set widths, using <code>COLUMN col_name FORMAT Ax</code> (where <em>x</em> is the desired length, in characters) - this is useful if you have one or two extra large columns and you just wish to show a summary of their values in the console screen.</p>
","12087682"
"Grant execute permission for a user on all stored procedures in database?","207568","","<p>I generated script from old database, created a new database and imported all data from old database. So far so good, however, no user has execute rights for stored procedures. I know I can use </p>

<pre><code>GRANT EXECUTE ON [storedProcName] TO [userName] 
</code></pre>

<p>If it was just a few procedures, however, I have about 100 so what's the easiest way for me to grant execute access for a specific user to all of them?</p>

<p>Thanks in advance.</p>
","<p>Create a role add this role to users, and then you can grant execute to all the routines in one shot to this role.</p>

<pre><code>CREATE ROLE &lt;abc&gt;
GRANT EXECUTE TO &lt;abc&gt;
</code></pre>

<p><strong>EDIT</strong><BR>
This works in SQL Server 2005, I'm not sure about backward compatibility of this feature, I'm sure anything later than 2005 should be fine.</p>
","5428431"
"How can I add a column to a Postgresql database that doesn't allow nulls?","207566","","<p>I'm adding a new, ""NOT NULL"" column to my Postgresql database using the following query (sanitized for the Internet):</p>

<pre><code>ALTER TABLE mytable ADD COLUMN mycolumn character varying(50) NOT NULL;
</code></pre>

<p>Each time I run this query, I receive the following error message:</p>

<blockquote>
<pre><code>ERROR:  column ""mycolumn"" contains null values
</code></pre>
</blockquote>

<p>I'm stumped.  Where am I going wrong?</p>

<p>NOTE: I'm using pgAdmin III (1.8.4) primarily, but I received the same error when I ran the SQL from within Terminal.</p>
","<p>You have to set a default value.</p>

<pre><code>ALTER TABLE mytable ADD COLUMN mycolumn character varying(50) NOT NULL DEFAULT 'foo';

... some work (set real values as you want)...

ALTER TABLE mytable ALTER COLUMN mycolumn DROP DEFAULT;
</code></pre>
","512485"
"SQL User Defined Function Within Select","207234","","<p>I have a user defined function in SQL called getBuisnessDays it takes @startdate and @enddate and returns the number of business days between the two dates. How can I call that function within my select?</p>

<p>Here's what I'd like to do.. </p>

<pre><code>SELECT getBusinessDays(a.opendate,a.closedate) 
FROM account a
WHERE ...
</code></pre>
","<p>Yes, you can do almost that: </p>

<pre><code>SELECT dbo.GetBusinessDays(a.opendate,a.closedate) as BusinessDays
FROM account a
WHERE...
</code></pre>
","363857"
"How to pass variable as a parameter in Execute SQL Task SSIS?","206785","","<p>I have ssis package in that I'm taking values from flat file and insert it into table.</p>

<p>I have taken one Execute SQL Task in that creating one temptable </p>

<pre><code>CREATE TABLE [tempdb].dbo.##temptable 
(
date datetime,
companyname nvarchar(50),
price decimal(10,0),
PortfolioId int,
stype nvarchar(50)
)

Insert into [tempdb].dbo.##temptable (date,companyname,price,PortfolioId,stype) 
SELECT   date,companyname,price,PortfolioId,stype
FROM        ProgressNAV
WHERE     (Date = '2011-09-30') AND (PortfolioId = 5) AND (stype in ('Index'))
ORDER BY CompanyName
</code></pre>

<p>Now in above query I need to pass <code>(Date = '2011-09-30') AND (PortfolioId = 5) AND (stype in ('Index'))</code>
these 3 parameter using variable name I have created variables in package so that I become dynamic.</p>
","<p>In your Execute SQL Task, make sure SQLSourceType is set to Direct Input, then your SQL Statement is the name of the stored proc, with questionmarks for each paramter of the proc, like so:</p>

<p><img src=""https://i.stack.imgur.com/gDRNf.png"" alt=""enter image description here""></p>

<p>Click the parameter mapping in the left column and add each paramter from your stored proc and map it to your SSIS variable:</p>

<p><img src=""https://i.stack.imgur.com/Q6zke.png"" alt=""enter image description here""></p>

<p>Now when this task runs it will pass the SSIS variables to the stored proc.</p>
","7611546"
"How to select rows with no matching entry in another table?","206721","","<p>I'm doing some maintenance work on a database application and I've discovered that, joy of joys, even though values from one table are being used in the style of foreign keys, there's no foreign key constraints on the tables.</p>

<p>I'm trying to add FK constraints on these columns, but I'm finding that, because there's already a whole load of bad data in the tables from previous errors which have been naively corrected, I need to find the rows which don't match up to the other table and then delete them.</p>

<p>I've found some examples of this kind of query on the web, but they all seem to provide examples rather than explanations, and I don't understand why they work.</p>

<p>Can someone explain to me how to construct a query which returns all the rows with no matches in another table, and what it's doing, so that I can make these queries myself, rather than coming running to SO for every table in this <em>mess</em> that has no FK constraints?</p>
","<p>Here's a simple query:</p>

<pre><code>SELECT t1.ID
FROM Table1 t1
    LEFT JOIN Table2 t2 ON t1.ID = t2.ID
WHERE t2.ID IS NULL
</code></pre>

<p>The key points are:</p>

<ol>
<li><p><code>LEFT JOIN</code> is used; this will return ALL rows from <code>Table1</code>, regardless of whether or not there is a matching row in <code>Table2</code>.</p></li>
<li><p>The <code>WHERE t2.ID IS NULL</code> clause; this will restrict the results returned to only those rows where the ID returned from <code>Table2</code> is null - in other words there is <strong>NO</strong> record in <code>Table2</code> for that particular ID from <code>Table1</code>. <code>Table2.ID</code> will be returned as NULL for all records from <code>Table1</code> where the ID is not matched in <code>Table2</code>.</p></li>
</ol>
","4076157"
"Creating an index on a table variable","206704","","<p>Can you create a index on a table variable in SQL Server 2000?</p>

<p>i.e. </p>

<pre><code>DECLARE @TEMPTABLE TABLE (
        [ID] [int] NOT NULL PRIMARY KEY
        ,[Name] [nvarchar] (255) COLLATE DATABASE_DEFAULT NULL 
)
</code></pre>

<p>Can I create a index on Name?</p>
","<p>The question is tagged SQL Server 2000 but for the benefit of people developing on the latest version I'll address that first.</p>

<p><strong>SQL Server 2014</strong></p>

<p>In addition to the methods of adding constraint based indexes discussed below SQL Server 2014 also allows non unique indexes to be specified directly with inline syntax on table variable declarations. </p>

<p>Example syntax for that is below.</p>

<pre><code>/*SQL Server 2014+ compatible inline index syntax*/
DECLARE @T TABLE (
C1 INT INDEX IX1 CLUSTERED, /*Single column indexes can be declared next to the column*/
C2 INT INDEX IX2 NONCLUSTERED,
       INDEX IX3 NONCLUSTERED(C1,C2) /*Example composite index*/
);
</code></pre>

<p>Filtered indexes and indexes with included columns can not currently be declared with this syntax however <strong>SQL Server 2016</strong> relaxes this a bit further. From CTP 3.1 it is now possible to declare filtered indexes for table variables. By RTM it <em>may</em> be the case that included columns are also allowed but the current position is that they <a href=""https://connect.microsoft.com/SQLServer/Feedback/Details/2079552"" rel=""noreferrer"">""will likely not make it into SQL16 due to resource constraints""</a></p>

<pre><code>/*SQL Server 2016 allows filtered indexes*/
DECLARE @T TABLE
(
c1 INT NULL INDEX ix UNIQUE WHERE c1 IS NOT NULL /*Unique ignoring nulls*/
)
</code></pre>

<hr>

<p><strong>SQL Server 2000 - 2012</strong></p>

<blockquote>
  <p>Can I create a index on Name?</p>
</blockquote>

<p>Short answer: Yes.</p>

<pre><code>DECLARE @TEMPTABLE TABLE (
  [ID]   [INT] NOT NULL PRIMARY KEY,
  [Name] [NVARCHAR] (255) COLLATE DATABASE_DEFAULT NULL,
  UNIQUE NONCLUSTERED ([Name], [ID]) 
  ) 
</code></pre>

<p>A more detailed answer is below.</p>

<p>Traditional tables in SQL Server can either have a clustered index or are structured as <a href=""http://msdn.microsoft.com/en-us/library/hh213609.aspx"" rel=""noreferrer"">heaps</a>. </p>

<p>Clustered indexes can either be declared as unique to disallow duplicate key values or default to non unique. If not unique then SQL Server silently adds a <a href=""http://msdn.microsoft.com/en-us/library/ms190639%28v=sql.105%29.aspx"" rel=""noreferrer"">uniqueifier</a> to any duplicate keys to make them unique.</p>

<p>Non clustered indexes can also be explicitly declared as unique. Otherwise for the non unique case SQL Server <a href=""http://sqlblog.com/blogs/kalen_delaney/archive/2010/03/07/more-about-nonclustered-index-keys.aspx"" rel=""noreferrer"">adds the row locator</a> (clustered index key or <a href=""http://technet.microsoft.com/en-us/library/ms190696%28v=sql.105%29.aspx"" rel=""noreferrer"">RID</a> for a heap) to all index keys (not just duplicates) this again ensures they are unique.</p>

<p>In SQL Server 2000 - 2012 indexes on table variables can only be created implicitly by creating a <code>UNIQUE</code> or <code>PRIMARY KEY</code> constraint. The difference between these constraint types are that the primary key must be on non nullable column(s). The columns participating in a unique constraint may be nullable. (though SQL Server's implementation of unique constraints in the presence of <code>NULL</code>s is not per that specified in the SQL Standard). Also a table can only have one primary key but multiple unique constraints.</p>

<p>Both of these logical constraints are physically implemented with a unique index. If not explicitly specified otherwise the <code>PRIMARY KEY</code> will become the clustered index and unique constraints non clustered but this behavior can be overridden by specifying <code>CLUSTERED</code> or <code>NONCLUSTERED</code> explicitly with the constraint declaration (Example syntax)</p>

<pre><code>DECLARE @T TABLE
(
A INT NULL UNIQUE CLUSTERED,
B INT NOT NULL PRIMARY KEY NONCLUSTERED
)
</code></pre>

<p>As a result of the above the following indexes can be implicitly created on table variables in SQL Server 2000 - 2012.</p>

<pre><code>+-------------------------------------+-------------------------------------+
|             Index Type              | Can be created on a table variable? |
+-------------------------------------+-------------------------------------+
| Unique Clustered Index              | Yes                                 |
| Nonunique Clustered Index           |                                     |
| Unique NCI on a heap                | Yes                                 |
| Non Unique NCI on a heap            |                                     |
| Unique NCI on a clustered index     | Yes                                 |
| Non Unique NCI on a clustered index | Yes                                 |
+-------------------------------------+-------------------------------------+
</code></pre>

<p>The last one requires a bit of explanation. In the table variable definition at the beginning of this answer the <strong>non unique</strong> non clustered index on <code>Name</code> is simulated by a <strong>unique</strong> index on <code>Name,Id</code> (recall that SQL Server would silently add the clustered index key to the non unique NCI key anyway).</p>

<p>A non unique clustered index can also be achieved by manually adding an <code>IDENTITY</code> column to act as a uniqueifier.</p>

<pre><code>DECLARE @T TABLE
(
A INT NULL,
B INT NULL,
C INT NULL,
Uniqueifier INT NOT NULL IDENTITY(1,1),
UNIQUE CLUSTERED (A,Uniqueifier)
)
</code></pre>

<p>But this is not an accurate simulation of how a non unique clustered index would normally actually be implemented in SQL Server as this adds the ""Uniqueifier"" to all rows. Not just those that require it.</p>
","17385085"
"what is the difference between GROUP BY and ORDER BY in sql","205710","","<p>When do you use which in general? Examples are highly encouraged!</p>

<p>I am referring so MySql, but can't imagine the concept being different on another DBMS</p>
","<p>ORDER BY alters the order in which items are returned.</p>

<p>GROUP BY will aggregate records by the specified columns which allows you to perform aggregation functions on non-grouped columns (such as SUM, COUNT, AVG, etc).</p>
","1277468"
"Comparing results with today's date?","205050","","<p>Is there a way to use the Now() function in SQL to select values with today's date? I was under the impression Now() would contain the time as well as date, but today's date would have the time set to 00:00:00 and therefore this would never match?</p>
","<p>There is no native Now() function in SQL Server so you should use:</p>

<pre><code>select GETDATE() --2012-05-01 10:14:13.403
</code></pre>

<p>you can get day, month and year separately by doing: </p>

<pre><code>select DAY(getdate())  --1
select month(getdate())  --5
select year(getdate()) --2012
</code></pre>

<p>if you are on sql server 2008, there is the DATE date time which has only the date part, not the time:</p>

<pre><code>select cast (GETDATE() as DATE) --2012-05-01
</code></pre>
","10395728"
"Does MS SQL Server's ""between"" include the range boundaries?","204975","","<p>For instance can </p>

<pre><code>SELECT foo
FROM bar
WHERE foo BETWEEN 5 AND 10
</code></pre>

<p>select 5 and 10 or they are excluded from the range?</p>
","<p>The BETWEEN operator is inclusive.</p>

<p>From Books Online:</p>

<blockquote>
  <p>BETWEEN returns TRUE if the value of
  test_expression is greater than or
  equal to the value of begin_expression
  and less than or equal to the value of
  end_expression.</p>
</blockquote>

<p><strong>DateTime Caveat</strong></p>

<p>NB: With DateTimes you have to be careful; if only a date is given the value is taken as of midnight on that day; to avoid missing times within your end date, or repeating the capture of the following day's data at midnight in multiple ranges, your end date should be 3 milliseconds before midnight on of day following your to date.  3 milliseconds because any less than this and the value will be rounded up to midnight the next day.</p>

<p>e.g. to get all values within June 2016 you'd need to run:</p>

<p><code>where myDateTime between '2016-06-01' and dateadd(millisecond, -3, '2016-07-01')</code></p>

<p>i.e.</p>

<p><code>where myDateTime between '2016-06-01 00:00:00.000' and '2016-07-01 23:59:59.997'</code></p>
","749620"
"SQL UPDATE all values in a field with appended string CONCAT not working","204867","","<p>Here is what I want to do:  </p>

<p>current table:  </p>

<pre><code>+----+-------------+  
| id | data        |  
+----+-------------+  
|  1 | max         |  
|  2 | linda       |  
|  3 | sam         |  
|  4 | henry       |  
+----+-------------+  
</code></pre>

<p>Mystery Query ( something like <code>""UPDATE table SET data = CONCAT(data, 'a')""</code> )</p>

<p>resulting table:  </p>

<pre><code>+----+-------------+  
| id | data        |  
+----+-------------+  
|  1 | maxa        |  
|  2 | lindaa      |  
|  3 | sama        |  
|  4 | henrya      |  
+----+-------------+  
</code></pre>

<p>thats it! I just need to do it in a single query, but can't seem to find a way. I am using mySQL on bluehost (I think its version 4.1)</p>

<p>Thanks everyone.</p>
","<p>That's pretty much all you need:</p>

<pre><code>mysql&gt; select * from t;
+------+-------+
| id   | data  |
+------+-------+
|    1 | max   |
|    2 | linda |
|    3 | sam   |
|    4 | henry |
+------+-------+
4 rows in set (0.02 sec)

mysql&gt; update t set data=concat(data, 'a');
Query OK, 4 rows affected (0.01 sec)
Rows matched: 4  Changed: 4  Warnings: 0

mysql&gt; select * from t;
+------+--------+
| id   | data   |
+------+--------+
|    1 | maxa   |
|    2 | lindaa |
|    3 | sama   |
|    4 | henrya |
+------+--------+
4 rows in set (0.00 sec)
</code></pre>

<p>Not sure why you'd be having trouble, though I am testing this on 5.1.41</p>
","4128384"
"How to rollback or commit a transaction in SQL Server","204075","","<p>In my stored procedure, I have three insert statements.</p>

<p>On duplicate key value insertion first two queries generate the error </p>

<blockquote>
  <p><em>Violation of PRIMARY KEY constraint</em></p>
</blockquote>

<p>and third query runs as usual.</p>

<p>Now I want that if any query generates any exception, everything should get rolled back.</p>

<p>If there isn't any exception generate by any query, it should get committed.</p>

<pre><code>declare @QuantitySelected as char
    set @QuantitySelected = 2

    declare @sqlHeader as varchar(1000)
    declare @sqlTotals as varchar(1000)
    declare @sqlLine as varchar(1000)

    select @sqlHeader = 'Insert into tblKP_EstimateHeader '
    select @sqlHeader = @sqlHeader + '(CompanyID,CompanyName,ProjectName,EstimateID,EstimateHeader,QuoteDate,ValidUntil,RFQNum,Revision,Contact,Status,NumConfigurations) '
    select @sqlHeader = @sqlHeader + ' select CompanyID,CompanyName,ProjectName,EstimateID,EstimateHeader,QuoteDate,ValidUntil,RFQNum,Revision,Contact,Status,NumConfigurations '
    select @sqlHeader = @sqlHeader +  'from V_EW_Estimate_Header where EstimateID = 2203'



    select @sqlTotals = 'Insert into tblKP_Estimate_Configuration_Totals '
    select @sqlTotals = @sqlTotals + '(ConfigRecId,RecId,SellQty,ConfigNum,ConfigDesc,SortOrder,OptionsInMainPrice,MarkupPctQty,'
    select @sqlTotals = @sqlTotals + ' SellPriceQty,RubberStamp,OptPriceQty,StatusRecid,LastUpdate_Date,LastUpdate_User,TotalCost,QuantityBracketSelected)'
    select @sqlTotals = @sqlTotals + ' select ConfigRecId,RecId,SellQty' + @QuantitySelected + ',ConfigNum,ConfigDesc,SortOrder,OptionsInMainPrice'
    select @sqlTotals = @sqlTotals + ' ,MarkupPctQty' + @QuantitySelected + ',SellPriceQty' + @QuantitySelected + ',RubberStamp,OptPriceQty' + @QuantitySelected + ',StatusRecid,LastUpdate_Date,LastUpdate_User,TotalCost' + @QuantitySelected + ',' + @QuantitySelected
    select @sqlTotals = @sqlTotals + ' from v_EW_Estimate_Configuration_Totals where ConfigRecId = -3'


    select @sqlLine = 'Insert into tblKP_Estimate_Configuration_Lines'
    select @sqlLine = @sqlLine + '(MstrRfqRecId,RfqRecId,RfqLineRecId,CompanyId,VendorQuoteNum,LineGrp,LineNum,StatusRecId,'
    select @sqlLine = @sqlLine + ' LineDesc,LineSize,LineMatl,LineDeco,LineFinish,CopyFromRecId,PerPieceCost,IsOptional,'
    select @sqlLine = @sqlLine + ' CopyToNewRev,RecId,UnitPrice,LineQty,LinePrice,CustOrVend,SellQty1,RfqNum,ConfigLineIsOptional,ConfigLinePerPieceCost,ConfigLineRecid,SellPrice,SaleQty)'
    select @sqlLine = @sqlLine + ' select distinct MstrRfqRecId,RfqRecId,RfqLineRecId,CompanyId,VendorQuoteNum,LineGrp,LineNum,'
    select @sqlLine = @sqlLine + ' StatusRecId,LineDesc,LineSize,LineMatl,LineDeco,LineFinish,CopyFromRecId,PerPieceCost,IsOptional,'
    select @sqlLine = @sqlLine + ' CopyToNewRev,RecId,UnitPrice' + @QuantitySelected + ',LineQty' + @QuantitySelected + ', isnull(LinePrice' + @QuantitySelected + ', 0.0000),CustOrVend,SellQty' + @QuantitySelected + ',RfqNum,ConfigLineIsOptional,ConfigLinePerPieceCost,ConfigLineRecid,SellPrice' + @QuantitySelected + ',SaleQty' + @QuantitySelected
    select @sqlLine = @sqlLine + ' from v_EW_EstimateLine  where rfqlinerecid in (select RfqLineRecID from kp_tblVendorRfqConfigLine where ConfigRecID = -3) '

    exec( @sqlHeader)
    exec(@sqlTotals)
    exec(@sqlLine)
</code></pre>
","<p>The good news is a transaction in SQL Server can span multiple batches (each <code>exec</code> is treated as a separate batch.)</p>

<p>You can wrap your <code>EXEC</code> statements in a <code>BEGIN TRANSACTION</code> and <code>COMMIT</code> but you'll need to go a step further and rollback if any errors occur.</p>

<p>Ideally you'd want something like this:</p>

<pre><code>BEGIN TRY
    BEGIN TRANSACTION 
        exec( @sqlHeader)
        exec(@sqlTotals)
        exec(@sqlLine)
    COMMIT
END TRY
BEGIN CATCH

    IF @@TRANCOUNT &gt; 0
        ROLLBACK
END CATCH
</code></pre>

<p>The <code>BEGIN TRANSACTION</code> and <code>COMMIT</code> I believe you are already familiar with. The <code>BEGIN TRY</code> and <code>BEGIN CATCH</code> blocks are basically there to catch and handle any errors that occur. If any of your <code>EXEC</code> statements raise an error, the code execution will jump to the <code>CATCH</code> block. </p>

<p>Your existing SQL building code should be outside the transaction (above) as you always want to keep your transactions as short as possible. </p>
","15013018"
"How to check for Is not Null And Is not Empty string in SQL server?","203345","","<p>How can we  check in a SQL Server <code>WHERE</code> condition whether the column is not null and not the empty string (<code>''</code>)?</p>
","<p>If you only want to match """" as an empty string</p>

<pre><code>WHERE DATALENGTH(COLUMN) &gt; 0 
</code></pre>

<p>If you want to count any string consisting entirely of spaces as empty</p>

<pre><code>WHERE COLUMN &lt;&gt; '' 
</code></pre>

<p>Both of these will not return <code>NULL</code> values when used in a <code>WHERE</code> clause. As <code>NULL</code> will evaluate as <code>UNKNOWN</code> for these rather than <code>TRUE</code>.</p>

<pre><code>CREATE TABLE T 
  ( 
     C VARCHAR(10) 
  ); 

INSERT INTO T 
VALUES      ('A'), 
            (''),
            ('    '), 
            (NULL); 

SELECT * 
FROM   T 
WHERE  C &lt;&gt; ''
</code></pre>

<p>Returns just the single row <code>A</code>. I.e. The rows with <code>NULL</code> or an empty string or a string consisting entirely of spaces are all excluded by this query.</p>

<p><a href=""http://www.sqlfiddle.com/#!3/3d933/1"">SQL Fiddle</a></p>
","8660220"
"How to run a SQL query on an Excel table?","203261","","<p>I'm trying to create a sub-table from another table of all the last name fields sorted A-Z which have a phone number field that isn't null. I could do this pretty easy with SQL, but I have no clue how to go about running a SQL query within Excel. I'm tempted to import the data into postgresql and just query it there, but that seems a little excessive. </p>

<p>For what I'm trying to do, the SQL query <code>SELECT lastname, firstname, phonenumber WHERE phonenumber IS NOT NULL ORDER BY lastname</code> would do the trick. It seems too simple for it to be something that Excel can't do natively. How can I run a SQL query like this from within Excel?</p>
","<p>There are many fine ways to get this done, which others have already suggestioned. Following along the ""get Excel data via SQL track"", here are some pointers.</p>

<ol>
<li><p>Excel has the ""Data Connection Wizard"" which allows you to import or link from another data source or even within the very same Excel file.</p></li>
<li><p>As part of Microsoft Office (and OS's) are two providers of interest: the old ""Microsoft.Jet.OLEDB"", and the latest ""Microsoft.ACE.OLEDB"". Look for them when setting up a connection (such as with the Data Connection Wizard).</p></li>
<li><p>Once connected to an Excel workbook, a worksheet or range is the equivalent of a table or view. The table name of a worksheet is the name of the worksheet with a dollar sign (""$"") appended to it, and surrounded with square brackets (""["" and ""]""); of a range, it is simply the name of the range. To specify an unnamed range of cells as your recordsource, append standard Excel row/column notation to the end of the sheet name in the square brackets.</p></li>
<li><p>The native SQL will (more or less be) the SQL of Microsoft Access. (In the past, it was called JET SQL; however Access SQL has evolved, and I believe JET is deprecated old tech.)</p></li>
<li><p>Example, reading a worksheet: SELECT * FROM [Sheet1$]</p></li>
<li><p>Example, reading a range: SELECT * FROM MyRange</p></li>
<li><p>Example, reading an unnamed range of cells: SELECT * FROM [Sheet1$A1:B10]</p></li>
<li><p>There are many many many books and web sites available to help you work through the particulars.</p></li>
</ol>

<p>=== Further notes ===</p>

<p>By default, it is assumed that the first row of your Excel data source contains column headings that can be used as field names. If this is not the case, you must turn this setting off, or your first row of data ""disappears"" to be used as field names. This is done by adding the optional HDR= setting to the Extended Properties of the connection string. The default, which does not need to be specified, is HDR=Yes. If you do not have column headings, you need to specify HDR=No; the provider names your fields F1, F2, etc.</p>

<p>A caution about specifying worksheets: The provider assumes that your table of data begins with the upper-most, left-most, non-blank cell on the specified worksheet. In other words, your table of data can begin in Row 3, Column C without a problem. However, you cannot, for example, type a worksheeet title above and to the left of the data in cell A1.</p>

<p>A caution about specifying ranges: When you specify a worksheet as your recordsource, the provider adds new records below existing records in the worksheet as space allows. When you specify a range (named or unnamed), Jet also adds new records below the existing records in the range as space allows. However, if you requery on the original range, the resulting recordset does not include the newly added records outside the range.</p>

<p>Data types (worth trying) for CREATE TABLE: Short, Long, Single, Double, Currency, DateTime, Bit, Byte, GUID, BigBinary, LongBinary, VarBinary, LongText, VarChar, Decimal.</p>

<p>Connecting to ""old tech"" Excel (files with the xls extention): <code>Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\MyFolder\MyWorkbook.xls;Extended Properties=Excel 8.0;</code>. Use the Excel 5.0 source database type for Microsoft Excel 5.0 and 7.0 (95) workbooks and use the Excel 8.0 source database type for Microsoft Excel 8.0 (97), 9.0 (2000) and 10.0 (2002) workbooks.</p>

<p>Connecting to ""latest"" Excel (files with the xlsx file extension): <code>Provider=Microsoft.ACE.OLEDB.12.0;Data Source=Excel2007file.xlsx;Extended Properties=""Excel 12.0 Xml;HDR=YES;""</code></p>

<p>Treating data as text: IMEX setting treats all data as text. Provider=Microsoft.ACE.OLEDB.12.0;Data Source=Excel2007file.xlsx;Extended Properties=""Excel 12.0 Xml;HDR=YES;IMEX=1"";</p>

<p>(More details at <a href=""http://www.connectionstrings.com/excel"" rel=""noreferrer"">http://www.connectionstrings.com/excel</a>)</p>

<p>More information at <a href=""http://msdn.microsoft.com/en-US/library/ms141683(v=sql.90).aspx"" rel=""noreferrer"">http://msdn.microsoft.com/en-US/library/ms141683(v=sql.90).aspx</a>, and at <a href=""http://support.microsoft.com/kb/316934"" rel=""noreferrer"">http://support.microsoft.com/kb/316934</a></p>

<p>Connecting to Excel via ADODB via VBA detailed at <a href=""http://support.microsoft.com/kb/257819"" rel=""noreferrer"">http://support.microsoft.com/kb/257819</a></p>

<p>Microsoft JET 4 details at <a href=""http://support.microsoft.com/kb/275561"" rel=""noreferrer"">http://support.microsoft.com/kb/275561</a></p>
","18984865"
"Querying data by joining two tables in two database on different servers","203049","","<p>There are two tables in two different databases on different servers, I need to join them so as to make few queries. What options do I have? What should I do?</p>
","<p>You'll need to use <code>sp_addlinkedserver</code> to create a server link.  See the <a href=""http://msdn.microsoft.com/en-us/library/ms190479.aspx"" rel=""noreferrer"">reference documentation</a> for usage.  Once the server link is established, you'll construct the query as normal, just prefixing the database name with the other server.  I.E:</p>

<pre><code>-- FROM DB1
SELECT *
FROM [MyDatabaseOnDB1].[dbo].[MyTable] tab1
    INNER JOIN [DB2].[MyDatabaseOnDB2].[dbo].[MyOtherTable] tab2
        ON tab1.ID = tab2.ID
</code></pre>

<p>Once the link is established, you can also use <code>OPENQUERY</code> to execute a SQL statement on the remote server and transfer only the data back to you.  This can be a bit faster, and it will let the remote server optimize your query.  If you cache the data in a temporary (or in-memory) table on <code>DB1</code> in the example above, then you'll be able to query it just like joining a standard table.  For example:</p>

<pre><code>-- Fetch data from the other database server
SELECT *
INTO #myTempTable
FROM OPENQUERY([DB2], 'SELECT * FROM [MyDatabaseOnDB2].[dbo].[MyOtherTable]')

-- Now I can join my temp table to see the data
SELECT * FROM [MyDatabaseOnDB1].[dbo].[MyTable] tab1
    INNER JOIN #myTempTable tab2 ON tab1.ID = tab2.ID
</code></pre>

<p>Check out the <a href=""http://msdn.microsoft.com/en-us/library/ms188427.aspx"" rel=""noreferrer"">documentation for OPENQUERY</a> to see some more examples.  The example above is pretty contrived.  I would definitely use the first method in this specific example, but the second option using <code>OPENQUERY</code> can save some time and performance if you use the query to filter out some data.</p>
","5145685"
"How to Concatenate Numbers and Strings to Format Numbers in T-SQL?","202683","","<p>I have the following function </p>

<pre><code>ALTER FUNCTION [dbo].[ActualWeightDIMS]
(
    -- Add the parameters for the function here
    @ActualWeight int,
    @Actual_Dims_Lenght int,
    @Actual_Dims_Width int,
    @Actual_Dims_Height int
)
RETURNS varchar(50)
AS
BEGIN

DECLARE @ActualWeightDIMS varchar(50);
--Actual Weight
     IF (@ActualWeight is not null) 
          SET @ActualWeightDIMS = @ActualWeight;
--Actual DIMS
     IF (@Actual_Dims_Lenght is not null) AND 
          (@Actual_Dims_Width is not null) AND (@Actual_Dims_Height is not null)
          SET @ActualWeightDIMS= @Actual_Dims_Lenght + 'x' + @Actual_Dims_Width + 'x' + @Actual_Dims_Height;


     RETURN(@ActualWeightDIMS);

END
</code></pre>

<p>but when i tried to use it, i got the following error ""Conversion failed when converting the varchar value 'x' to data type int."" when i use the following select statement</p>

<pre><code>select 
 BA_Adjustment_Detail.ID_Number [ID_Number],
 BA_Adjustment_Detail.Submit_Date [Submit_Date],
 BA_Category.Category [category],
 BA_Type_Of_Request.Request [Type_Of_Request],
 dbo.ActualWeightDIMS(BA_Adjustment_Detail.ActualWeight,BA_Adjustment_Detail.Actual_Dims_Lenght,BA_Adjustment_Detail.Actual_Dims_Width,BA_Adjustment_Detail.Actual_Dims_Height) [Actual Weight/DIMS],
 BA_Adjustment_Detail.Notes [Notes],
 BA_Adjustment_Detail.UPSCustomerNo [UPSNo],
 BA_Adjustment_Detail.TrackingNo [AirbillNo],
 BA_Adjustment_Detail.StoreNo [StoreNo],
 BA_Adjustment_Detail.Download_Date [Download_Date],
 BA_Adjustment_Detail.Shipment_Date[ShipmentDate],
 BA_Adjustment_Detail.FranchiseNo [FranchiseNo],
 BA_Adjustment_Detail.CustomerNo [CustomerNo],
 BA_Adjustment_Detail.BillTo [BillTo],
 BA_Adjustment_Detail.Adjustment_Amount_Requested [Adjustment_Amount_Requested]
from BA_Adjustment_Detail
inner join BA_Category 
on BA_Category.ID = BA_Adjustment_Detail.CategoryID
inner join BA_Type_Of_Request
on BA_Type_Of_Request.ID = BA_Adjustment_Detail.TypeOfRequestID
</code></pre>

<p>What I want to do is if the ActualWeight is not null then return the ActualWeight for the ""Actual Weight/DIMS"" or else use the Actual_Dims_Lenght, Width and Height.</p>

<p>If it is DIMS then i want to format the output to be LenghtxWidhtxHeight (15x10x4). The ActualWeight, Adcutal_Dims_Lenght, Width and Height are all int (integer) value but the output for ""Actual Weight/DIMS"" should be varchar(50).</p>

<p>Where am i getting it wrong?</p>

<p>thank</p>

<p>edit: The user can only pick either Weight or DIMS on ASP.net page and if user selected DIMS then they must supply Length, Width and Height. Else it will throw error on the ASP.net page. Should i worry about it on the sql side? </p>
","<p>A couple of quick notes:</p>

<ul>
<li>It's ""length"" not ""lenght""</li>
<li>Table aliases in your query would probably make it a lot more readable</li>
</ul>

<p>Now onto the problem...</p>

<p>You need to explicitly convert your parameters to VARCHAR before trying to concatenate them. When SQL Server sees @my_int + 'X' it thinks you're trying to add the number ""X"" to @my_int and it can't do that. Instead try:</p>

<pre><code>SET @ActualWeightDIMS =
     CAST(@Actual_Dims_Lenght AS VARCHAR(16)) + 'x' +
     CAST(@Actual_Dims_Width  AS VARCHAR(16)) + 'x' +
     CAST(@Actual_Dims_Height  AS VARCHAR(16))
</code></pre>
","951365"
"alter the size of column in table containing data","202539","","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""https://stackoverflow.com/questions/8404194/how-to-make-a-varchar2-field-shorter-in-oracle"">How to make a varchar2 field shorter in Oracle?</a>  </p>
</blockquote>



<p>In Oracle(9i and above)</p>

<pre><code> Alter table employee  
 MODIFY ename varchar2(10);
</code></pre>

<p>I want to alter the column ename of table employee from varchar2(30) to varchar2(10)</p>

<ul>
<li><p>Case1 : if the table has data having ename column containing values which are of length less than 10 char(i mean it can fit in varchar2(10) comfortably) - is this allowed by oracle ?</p></li>
<li><p>Case 2: if the table has data having ename column containing values which are of length greater than 10 char(i mean it can not fit in varchar2(10)) - is this not allowed by oracle ?</p></li>
</ul>
","<p>Case 1 : Yes, this works fine.</p>

<p>Case 2 : This will fail with the error ORA-01441 : cannot decrease column length because some value is too big.</p>

<p>Share and enjoy.</p>
","10179417"
"Difference between Subquery and Correlated Subquery","202536","","<p>Is the following piece of SQL Query a normal query or a Correlated Subquery ??</p>

<pre><code>SELECT UserID,
       FirstName,
       LastName,
       DOB,
       GFName,
       GLName,
       LoginName,
       LoginEffectiveDate,
       LoginExpiryDate,
       Password,
       Email,
       ReportingTo,
       Mobile,
       CommunicationPreference,
       IsActive
FROM   (SELECT row_number() OVER (ORDER BY FirstName) AS Row,
               UserID,
               FirstName,
               LastName,
               DOB,
               GFName,
               GLName,
               LoginName,
               LoginEffectiveDate,
               LoginExpiryDate,
               Password,
               Email,
               ReportingTo,
               Mobile,
               CommunicationPreference,
               IsActive
        FROM   DivakarUserRegistration)  T
</code></pre>

<p>Also, can someone state the difference between the both</p>
","<p>Correlated Subquery is a sub-query that uses values from the outer query. In this case the inner query has to be executed for every row of outer query. </p>

<p>See example here <a href=""http://en.wikipedia.org/wiki/Correlated_subquery"" rel=""noreferrer"">http://en.wikipedia.org/wiki/Correlated_subquery</a></p>

<p>Simple subquery doesn't use values from the outer query and is being calculated only once:</p>

<pre><code>SELECT id, first_name 
FROM student_details 
WHERE id IN (SELECT student_id
FROM student_subjects 
WHERE subject= 'Science'); 
</code></pre>
","17269406"
"MySQL LIKE IN()?","202437","","<p>My current query looks like this:</p>

<pre><code>SELECT * FROM fiberbox f WHERE f.fiberBox LIKE '%1740 %' OR f.fiberBox LIKE '%1938 %' OR f.fiberBox LIKE '%1940 %'
</code></pre>

<p>I did some looking around and can't find anything similar to a LIKE IN() - I envision it working like this:</p>

<pre><code>SELECT * FROM fiberbox f WHERE f.fiberbox LIKE IN('%140 %', '%1938 %', '%1940 %')
</code></pre>

<p>Any ideas? Am I just thinking of the problem the wrong way - some obscure command I've never seen.</p>

<p>MySQL 5.0.77-community-log</p>
","<p>A <a href=""http://dev.mysql.com/doc/refman/5.1/en/regexp.html"" rel=""noreferrer"">REGEXP</a> <em>might</em> be more efficient, but you'd have to benchmark it to be sure, e.g.</p>

<pre><code>SELECT * from fiberbox where field REGEXP '1740|1938|1940'; 
</code></pre>
","1127106"
"How to drop all tables from a database with one SQL query?","202357","","<p>I don't want to type all tables' name to drop all of them. Is it possible with one query?</p>
","<p>Use the <a href=""http://msdn.microsoft.com/en-IN/library/ms186778.aspx""><strong>INFORMATION_SCHEMA.TABLES</strong></a> view to get the list of tables. Generate Drop scripts in the select statement and drop it using Dynamic SQL:</p>

<pre><code>DECLARE @sql NVARCHAR(max)=''

SELECT @sql += ' Drop table ' + QUOTENAME(TABLE_SCHEMA) + '.'+ QUOTENAME(TABLE_NAME) + '; '
FROM   INFORMATION_SCHEMA.TABLES
WHERE  TABLE_TYPE = 'BASE TABLE'

Exec Sp_executesql @sql
</code></pre>

<p><a href=""http://msdn.microsoft.com/en-us/library/ms187406.aspx""><strong>Sys.Tables</strong></a> Version</p>

<pre><code>SELECT ' Drop table ' + QUOTENAME(s.NAME) + '.' + QUOTENAME(t.NAME) + '; '
FROM   sys.tables t
       JOIN sys.schemas s
         ON t.[schema_id] = s.[schema_id]
WHERE  t.type = 'U'

Exec sp_executesql @sql
</code></pre>

<p><strong>Note:</strong> If you have any <code>foreign Keys</code> defined between tables then first run the below query to <strong>disable</strong> all <code>foreign keys</code> present in your database.</p>

<pre><code>EXEC sp_msforeachtable ""ALTER TABLE ? NOCHECK CONSTRAINT all""
</code></pre>

<p>For more information, <a href=""http://blog.sqlauthority.com/2013/04/29/sql-server-disable-all-the-foreign-key-constraint-in-database-enable-all-the-foreign-key-constraint-in-database/""><strong><em>check here</em></strong></a>.</p>
","27606618"
"How do I insert datetime value into a SQLite database?","201973","","<p>I am trying to insert a datetime value into a <a href=""http://en.wikipedia.org/wiki/SQLite"" rel=""noreferrer"">SQLite</a> database. It seems to be sucsessful but when I try to retrieve the value there is an error:</p>

<blockquote>
  <p>&lt;Unable to read data></p>
</blockquote>

<p>The SQL statements are:</p>

<pre><code>create table myTable (name varchar(25), myDate DATETIME)
insert into myTable (name,mydate) Values ('fred','jan 1 2009 13:22:15')
</code></pre>
","<p>The format you need is:</p>

<pre><code>'2007-01-01 10:00:00'
</code></pre>

<p>i.e. yyyy-MM-dd HH:mm:ss</p>

<p>If possible, however, use a parameterised query as this frees you from worrying about the formatting details.</p>
","1933733"
"SQL Error: ORA-01861: literal does not match format string 01861","201969","","<p>I am trying to insert data into an existing table and keep receiving an error.</p>

<pre><code>INSERT INTO Patient  
(
  PatientNo,
  PatientFirstName,
  PatientLastName,
  PatientStreetAddress,
  PatientTown,
  PatientCounty,
  PatientPostcode,
  DOB,
  Gender,
  PatientHomeTelephoneNumber,
  PatientMobileTelephoneNumber
)
VALUES 
(
  121, 
  'Miles', 
  'Malone', 
  '64 Zoo Lane', 
  'Clapham', 
  'United Kingdom',
  'SW4 9LP',
  '1989-12-09',
  'M',
  02086950291,
  07498635200
);
</code></pre>

<p>Error:</p>

<pre><code>Error starting at line : 1 in command -
INSERT INTO Patient (PatientNo,PatientFirstName,PatientLastName,PatientStreetAddress,PatientTown,PatientCounty,PatientPostcode,DOB,Gender,PatientHomeTelephoneNumber,PatientMobileTelephoneNumber)
VALUES (121, 'Miles', 'Malone', '64 Zoo Lane', 'Clapham', 'United Kingdom','SW4 9LP','1989-12-09','M',02086950291,07498635200)
Error report -
SQL Error: ORA-01861: literal does not match format string
01861. 00000 -  ""literal does not match format string""
*Cause:    Literals in the input must be the same length as literals in
           the format string (with the exception of leading whitespace).  If the
           ""FX"" modifier has been toggled on, the literal must match exactly,
           with no extra whitespace.
*Action:   Correct the format string to match the literal.
</code></pre>

<p>Just not sure why this keeps happening I am learning SQL at the moment, any help will be greatly appreciated!</p>
","<p>Try replacing the string literal for date <code>'1989-12-09'</code> with <code>TO_DATE('1989-12-09','YYYY-MM-DD')</code></p>
","22543299"
"MYSQL Update Statement Inner Join Tables","201064","","<p>I have no idea what the problem is.  Using MySQL 5.0 i get a compile error when attempting to run the following MYSQL update statement</p>

<pre><code>  UPDATE  b
SET b.mapx = g.latitude,
  b.mapy = g.longitude
FROM business AS b
INNER JOIN business_geocode g ON b.business_id = g.business_id
WHERE  (b.mapx = '' or b.mapx = 0) and
  g.latitude &gt; 0
</code></pre>

<p>all the field names are correct.  Any thoughts?</p>
","<p>Try this:</p>

<pre><code>UPDATE business AS b
INNER JOIN business_geocode AS g ON b.business_id = g.business_id
SET b.mapx = g.latitude,
  b.mapy = g.longitude
WHERE  (b.mapx = '' or b.mapx = 0) and
  g.latitude &gt; 0
</code></pre>

<h2>Update:</h2>

<p>Since you said the query yielded a syntax error, I created some tables that I could test it against and confirmed that there is no syntax error in my query:</p>

<pre><code>mysql&gt; create table business (business_id int unsigned primary key auto_increment, mapx varchar(255), mapy varchar(255)) engine=innodb;
Query OK, 0 rows affected (0.01 sec)

mysql&gt; create table business_geocode (business_geocode_id int unsigned primary key auto_increment, business_id int unsigned not null, latitude varchar(255) not null, longitude varchar(255) not null, foreign key (business_id) references business(business_id)) engine=innodb;
Query OK, 0 rows affected (0.01 sec)

mysql&gt; UPDATE business AS b
    -&gt; INNER JOIN business_geocode AS g ON b.business_id = g.business_id
    -&gt; SET b.mapx = g.latitude,
    -&gt;   b.mapy = g.longitude
    -&gt; WHERE  (b.mapx = '' or b.mapx = 0) and
    -&gt;   g.latitude &gt; 0;
Query OK, 0 rows affected (0.00 sec)
Rows matched: 0  Changed: 0  Warnings: 0
</code></pre>

<p>See? No syntax error. I tested against MySQL 5.5.8.</p>
","8057585"
"Avoid duplicates in INSERT INTO SELECT query in SQL Server","199944","","<p>I have the following two tables:</p>

<pre><code>Table1
----------
ID   Name
1    A
2    B
3    C

Table2
----------
ID   Name
1    Z
</code></pre>

<p>I need to insert data from <code>Table1</code> to <code>Table2</code>. I can use the following syntax:</p>

<pre><code>INSERT INTO Table2(Id, Name) SELECT Id, Name FROM Table1
</code></pre>

<p>However, in my case, duplicate IDs might exist in <code>Table2</code> (in my case, it's just ""<code>1</code>"") and I don't want to copy that again as that would throw an error. </p>

<p>I can write something like this:</p>

<pre><code>IF NOT EXISTS(SELECT 1 FROM Table2 WHERE Id=1)
INSERT INTO Table2 (Id, name) SELECT Id, name FROM Table1 
ELSE
INSERT INTO Table2 (Id, name) SELECT Id, name FROM Table1 WHERE Table1.Id&lt;&gt;1
</code></pre>

<p>Is there a better way to do this without using <code>IF - ELSE</code>? I want to avoid two <code>INSERT INTO-SELECT</code> statements based on some condition.</p>
","<p>Using <code>NOT EXISTS</code>:</p>

<pre><code>INSERT INTO TABLE_2
  (id, name)
SELECT t1.id,
       t1.name
  FROM TABLE_1 t1
 WHERE NOT EXISTS(SELECT id
                    FROM TABLE_2 t2
                   WHERE t2.id = t1.id)
</code></pre>

<p>Using <code>NOT IN</code>:</p>

<pre><code>INSERT INTO TABLE_2
  (id, name)
SELECT t1.id,
       t1.name
  FROM TABLE_1 t1
 WHERE t1.id NOT IN (SELECT id
                       FROM TABLE_2)
</code></pre>

<p>Using <code>LEFT JOIN/IS NULL</code>:</p>

<pre><code>INSERT INTO TABLE_2
  (id, name)
   SELECT t1.id,
          t1.name
     FROM TABLE_1 t1
LEFT JOIN TABLE_2 t2 ON t2.id = t1.id
    WHERE t2.id IS NULL
</code></pre>

<p>Of the three options, the <code>LEFT JOIN/IS NULL</code> is less efficient.  See <a href=""http://explainextended.com/2009/09/15/not-in-vs-not-exists-vs-left-join-is-null-sql-server/"" rel=""noreferrer"">this link for more details</a>.</p>
","2513187"
"Find max and second max salary for a employee table MySQL","199730","","<p>Suppose that you are given the following simple database table called Employee that has 2 columns named Employee ID and Salary:</p>

<pre><code>  Employee
  Employee ID    Salary
   3            200
   4            800
   7            450
</code></pre>

<p>I wish to write a query select max(salary) as max_salary, 2nd_max_salary from employee</p>

<p>then it should return</p>

<pre><code>  max_salary   2nd_max_salary
   800             450
</code></pre>

<p>i know how to find 2nd highest salary </p>

<pre><code>   SELECT MAX(Salary) FROM Employee
  WHERE Salary NOT IN (SELECT MAX(Salary) FROM Employee )
</code></pre>

<p>or to find the nth </p>

<pre><code>  SELECT FROM Employee Emp1 WHERE (N-1) = ( SELECT COUNT(DISTINCT(Emp2.Salary)) FROM Employee Emp2
  WHERE Emp2.Salary &gt; Emp1.Salary)
</code></pre>

<p>but i am unable to figureout how to join these 2 results for the desired result</p>
","<p>You can just run 2 queries as inner queries to return 2 columns:</p>

<pre><code>select
  (SELECT MAX(Salary) FROM Employee) maxsalary,
  (SELECT MAX(Salary) FROM Employee
  WHERE Salary NOT IN (SELECT MAX(Salary) FROM Employee )) as [2nd_max_salary]
</code></pre>

<p><a href=""http://sqlfiddle.com/#!2/2445c/2"">SQL Fiddle Demo</a></p>
","21520083"
"SQL Formatter for SQL Management Studio","199687","","<p>I was wondering if there is a plugin/tool for SQL Server Management Studio that will format your SQL?</p>

<p>I'm working with some large-ish stored procs that are a mangled mess of poorly formatted SQL and it'd be nice if I could just go ""Select All -> Format SQL""</p>
","<p>Today I discovered Apex SQL Refactor.  It is a free plugin.  Integrates with SSMS.  Downside is that it is an all or nothing process.  It does not refactor as you type.</p>
","907988"
"How to select records from last 24 hours using SQL?","199590","","<p>I am looking for a <code>where</code> clause that can be used to retrieve records for the last 24 hours?</p>
","<pre><code>SELECT * 
FROM table_name
WHERE table_name.the_date &gt; DATE_SUB(CURDATE(), INTERVAL 1 DAY)
</code></pre>
","1888593"
"Need a row count after SELECT statement: what's the optimal SQL approach?","199405","","<p>I'm trying to select a column from a single table (no joins) and I need the count of the number of rows, ideally before I begin retrieving the rows.  I have come to two approaches that provide the information I need.</p>

<p><strong>Approach 1:</strong></p>

<pre><code>SELECT COUNT( my_table.my_col ) AS row_count
  FROM my_table
 WHERE my_table.foo = 'bar'
</code></pre>

<p>Then</p>

<pre><code>SELECT my_table.my_col
  FROM my_table
 WHERE my_table.foo = 'bar'
</code></pre>

<p>Or <strong>Approach 2</strong></p>

<pre><code>SELECT my_table.my_col, ( SELECT COUNT ( my_table.my_col )
                            FROM my_table
                           WHERE my_table.foo = 'bar' ) AS row_count
  FROM my_table
 WHERE my_table.foo = 'bar'
</code></pre>

<p>I am doing this because my SQL driver (SQL Native Client 9.0) does not allow me to use SQLRowCount on a SELECT statement but I need to know the number of rows in my result in order to allocate an array before assigning information to it.  The use of a dynamically allocated container is, unfortunately, not an option in this area of my program.</p>

<p>I am concerned that the following scenario might occur:</p>

<ul>
<li>SELECT for count occurs</li>
<li>Another instruction occurs, adding or removing a row</li>
<li>SELECT for data occurs and suddenly the array is the wrong size.<br>
  -In the worse case, this will attempt to write data beyond the arrays limits and crash my program.</li>
</ul>

<p>Does Approach 2 prohibit this issue?</p>

<p>Also, Will one of the two approaches be faster?  If so, which?</p>

<p>Finally, is there a better approach that I should consider (perhaps a way to instruct the driver to return the number of rows in a SELECT result using SQLRowCount?)</p>

<p>For those that asked, I am using Native C++ with the aforementioned SQL driver (provided by Microsoft.)</p>
","<p>There are only two ways to be 100% certain that the <code>COUNT(*)</code> and the actual query will give consistent results:</p>

<ul>
<li>Combined the <code>COUNT(*)</code> with the query, as in your Approach 2.  I recommend the form you show in your example, not the correlated subquery form shown in the comment from kogus.</li>
<li>Use two queries, as in your Approach 1, after starting a transaction in <code>SNAPSHOT</code> or <code>SERIALIZABLE</code> isolation level.  </li>
</ul>

<p>Using one of those isolation levels is important because any other isolation level allows new rows created by other clients to become visible in your current transaction.  Read the MSDN documentation on <a href=""http://msdn.microsoft.com/en-us/library/ms173763.aspx"" rel=""noreferrer""><code>SET TRANSACTION ISOLATION</code></a> for more details.</p>
","244128"
"How to get the first and last date of the current year?","199019","","<p>Using SQL Server 2000, how can I get the first and last date of the current year?</p>

<p>Expected Output:</p>

<p><code>01/01/2012</code> and <code>31/12/2012</code></p>
","<pre><code>SELECT
   DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0) AS StartOfYear,
   DATEADD(yy, DATEDIFF(yy, 0, GETDATE()) + 1, -1) AS EndOfYear
</code></pre>

<p>The above query gives a datetime value for midnight at the beginning of December 31. This is about 24 hours short of the last moment of the year. If you want to include time that might occur on December 31, then you should compare to the first of the next year, with a <code>&lt;</code> comparison. Or you can compare to the last few milliseconds of the current year, but this still leaves a gap if you are using something other than DATETIME (such as DATETIME2):</p>

<pre><code>SELECT
   DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0) AS StartOfYear,
   DATEADD(yy, DATEDIFF(yy, 0, GETDATE()) + 1, -1) AS LastDayOfYear,
   DATEADD(yy, DATEDIFF(yy, 0, GETDATE()) + 1, 0) AS FirstOfNextYear,
   DATEADD(ms, -3, DATEADD(yy, DATEDIFF(yy, 0, GETDATE()) + 1, 0)) AS LastTimeOfYear
</code></pre>

<p><strong>Tech Details</strong></p>

<p>This works by figuring out the number of years since 1900 with <code>DATEDIFF(yy, 0, GETDATE())</code> and then adding that to a date of zero = Jan 1, 1900. This can be changed to work for an arbitrary date by replacing the <code>GETDATE()</code> portion or an arbitrary year by replacing the <code>DATEDIFF(...)</code> function with ""Year - 1900.""</p>

<pre><code> SELECT
   DATEADD(yy, DATEDIFF(yy, 0, '20150301'), 0) AS StartOfYearForMarch2015,
   DATEADD(yy, 2015 - 1900, 0) AS StartOfYearFor2015
</code></pre>
","13437389"
"SQL Server stored procedure parameters","198988","","<p>I am developing a framework, where in I am a calling stored procedure with dynamically created parameters. I am building parameter collection at the runtime. </p>

<p>The problem occurs when I am passing a parameter to stored procedure, but stored proc doesn't accept such parameter.</p>

<p>For example, my stored procedure is:</p>

<pre><code>CREATE PROCEDURE GetTaskEvents
    @TaskName varchar(50)
AS
BEGIN
-- SP Logic
END
</code></pre>

<p>Calling stored procedure as:</p>

<pre><code>EXEC GetTaskEvents @TaskName = 'TESTTASK', @ID = 2
</code></pre>

<p>This throws below error:</p>

<pre><code>Msg 8144, Level 16, State 2, Procedure GetTaskEvents, Line 0
Procedure or function GetTaskEvents has too many arguments specified.
</code></pre>

<p>This works fine in Sybase ASE, which simply ignores any additional parameters. Could this be achieved with MSSQL server 2008? Any help, much appreciated. Thanks</p>
","<p>Why would you pass a parameter to a stored procedure that doesn't use it? </p>

<p>It sounds to me  like you might be better of building dynamic SQL statements and then executing them. What you are trying to do with the SP won't work, and even if you could change what you are doing in such a way to accommodate varying numbers of parameters, you would then essentially be using dynamically generated SQL you are defeating the purpose of having/using a SP in the first place. SP's have a role, but there are not the solution in all cases.</p>
","15191584"
"Oracle 'Partition By' and 'Row_Number' keyword","198880","","<p>I have a SQL query written by someone else and I'm trying to figure out what it does. Can someone please explain what the <code>Partition By</code> and <code>Row_Number</code> keywords does here and give a simple example of it in action, as well as why one would want to use it?</p>

<p>An example of partition by:</p>

<pre><code>(SELECT cdt.*,
        ROW_NUMBER ()
        OVER (PARTITION BY cdt.country_code, cdt.account, cdt.currency
              ORDER BY cdt.country_code, cdt.account, cdt.currency)
           seq_no
   FROM CUSTOMER_DETAILS cdt);
</code></pre>

<p>I've seen some examples online, they are in bit too depth.</p>

<p>Thanks in advance!</p>
","<p><code>PARTITION BY</code> segregate sets, this enables you to be able to work(ROW_NUMBER(),COUNT(),SUM(),etc) on related set independently.</p>

<p>In your query, the related set comprised of rows with similar cdt.country_code, cdt.account, cdt.currency. When you partition on those columns and you apply ROW_NUMBER on them. Those other columns on those combination/set will receive sequential number from ROW_NUMBER</p>

<p>But that query is funny, if your partition by some unique data and you put a row_number on it, it will just produce same number. It's like you do an ORDER BY on a partition that is guaranteed to be unique. Example, think of GUID as unique combination of <code>cdt.country_code, cdt.account, cdt.currency</code> </p>

<p><code>newid()</code> produces GUID, so what shall you expect by this expression? </p>

<pre><code>select
   hi,ho,
   row_number() over(partition by newid() order by hi,ho)
from tbl;
</code></pre>

<p>...Right, all the partitioned(none was partitioned, every row is partitioned in their own row) rows' row_numbers are all set to 1</p>

<p>Basically, you should partition on non-unique columns. ORDER BY on OVER needed the PARTITION BY to have a non-unique combination, otherwise all row_numbers will become 1</p>

<p>An example, this is your data:</p>

<pre><code>create table tbl(hi varchar, ho varchar);

insert into tbl values
('A','X'),
('A','Y'),
('A','Z'),
('B','W'),
('B','W'),
('C','L'),
('C','L');
</code></pre>

<p>Then this is analogous to your query:</p>

<pre><code>select
   hi,ho,
   row_number() over(partition by hi,ho order by hi,ho)
from tbl;
</code></pre>

<p>What will be the output of that?</p>

<pre><code>HI  HO  COLUMN_2
A   X   1
A   Y   1
A   Z   1
B   W   1
B   W   2
C   L   1
C   L   2
</code></pre>

<p>You see thee combination of HI HO? The first three rows has unique combination, hence they are set to 1, the B rows has same W, hence different ROW_NUMBERS, likewise with HI C rows.</p>

<p>Now, why is the <code>ORDER BY</code> needed there? If the previous developer merely want to put a row_number on similar data (e.g. HI B, all data are B-W, B-W), he can just do this:</p>

<pre><code>select
   hi,ho,
   row_number() over(partition by hi,ho)
from tbl;
</code></pre>

<p>But alas, Oracle(and Sql Server too) doesn't allow partition with no <code>ORDER BY</code>; whereas in Postgresql, <code>ORDER BY</code> on PARTITION is optional: <a href=""http://www.sqlfiddle.com/#!1/27821/1"" rel=""noreferrer"">http://www.sqlfiddle.com/#!1/27821/1</a></p>

<pre><code>select
   hi,ho,
   row_number() over(partition by hi,ho)
from tbl;
</code></pre>

<p>Your <code>ORDER BY</code> on your partition look a bit redundant, not because of the previous developer's fault, some database just don't allow <code>PARTITION</code> with no <code>ORDER BY</code>, he might not able find a good candidate column to sort on. If both PARTITION BY columns and ORDER BY columns are the same just remove the ORDER BY, but since some database don't allow it, you can just do this:</p>

<pre><code>SELECT cdt.*,
        ROW_NUMBER ()
        OVER (PARTITION BY cdt.country_code, cdt.account, cdt.currency
              ORDER BY newid())
           seq_no
   FROM CUSTOMER_DETAILS cdt
</code></pre>

<p>You cannot find a good column to use for sorting similar data? You might as well sort on random, the partitioned data have the <strong>same values</strong> anyway. You can use GUID for example(you use <code>newid()</code> for SQL Server). So that has the same output made by previous developer, it's unfortunate that some database doesn't allow <code>PARTITION</code> with no <code>ORDER BY</code></p>

<p>Though really, it eludes me and I cannot find a good reason to put a number on the same combinations (B-W, B-W in example above). It's giving the impression of database having redundant data.  Somehow reminded me of this: <a href=""https://stackoverflow.com/questions/6645746/how-to-get-one-unique-record-from-the-same-list-of-records-from-table-no-unique"">How to get one unique record from the same list of records from table? No Unique constraint in the table</a></p>

<p>It really looks arcane seeing a PARTITION BY with same combination of columns with ORDER BY, can not easily infer the code's intent.</p>

<p>Live test: <a href=""http://www.sqlfiddle.com/#!3/27821/6"" rel=""noreferrer"">http://www.sqlfiddle.com/#!3/27821/6</a></p>

<hr/>

<p>But as dbaseman have noticed also, it's useless to partition and order on same columns.</p>

<p>You have a set of data like this:</p>

<pre><code>create table tbl(hi varchar, ho varchar);

insert into tbl values
('A','X'),
('A','X'),
('A','X'),
('B','Y'),
('B','Y'),
('C','Z'),
('C','Z');
</code></pre>

<p>Then you PARTITION BY hi,ho; and then you ORDER BY hi,ho. There's no sense numbering similar data :-) <a href=""http://www.sqlfiddle.com/#!3/29ab8/3"" rel=""noreferrer"">http://www.sqlfiddle.com/#!3/29ab8/3</a></p>

<pre><code>select
   hi,ho,
   row_number() over(partition by hi,ho order by hi,ho) as nr
from tbl;
</code></pre>

<p>Output:</p>

<pre><code>HI  HO  ROW_QUERY_A
A   X   1
A   X   2
A   X   3
B   Y   1
B   Y   2
C   Z   1
C   Z   2
</code></pre>

<p>See? Why need to put row numbers on same combination? What you will analyze on triple A,X, on double B,Y, on double C,Z? :-)</p>

<hr/>

<p>You just need to use PARTITION on non-unique column, then you sort on non-unique column(s)'s <em>unique</em>-ing column. Example will make it more clear:</p>

<pre><code>create table tbl(hi varchar, ho varchar);

insert into tbl values
('A','D'),
('A','E'),
('A','F'),
('B','F'),
('B','E'),
('C','E'),
('C','D');

select
   hi,ho,
   row_number() over(partition by hi order by ho) as nr
from tbl;
</code></pre>

<p><code>PARTITION BY hi</code> operates on non unique column, then on each partitioned column, you order on its unique column(ho), <code>ORDER BY ho</code></p>

<p>Output:</p>

<pre><code>HI  HO  NR
A   D   1
A   E   2
A   F   3
B   E   1
B   F   2
C   D   1
C   E   2
</code></pre>

<p>That data set makes more sense</p>

<p>Live test: <a href=""http://www.sqlfiddle.com/#!3/d0b44/1"" rel=""noreferrer"">http://www.sqlfiddle.com/#!3/d0b44/1</a></p>

<p>And this is similar to your query with same columns on both PARTITION BY and ORDER BY: </p>

<pre><code>select
   hi,ho,
   row_number() over(partition by hi,ho order by hi,ho) as nr
from tbl;
</code></pre>

<p>And this is the ouput:</p>

<pre><code>HI  HO  NR
A   D   1
A   E   1
A   F   1
B   E   1
B   F   1
C   D   1
C   E   1
</code></pre>

<p>See? no sense?</p>

<p>Live test: <a href=""http://www.sqlfiddle.com/#!3/d0b44/3"" rel=""noreferrer"">http://www.sqlfiddle.com/#!3/d0b44/3</a></p>

<hr/>

<p>Finally this might be the right query:</p>

<pre><code>SELECT cdt.*,
     ROW_NUMBER ()
     OVER (PARTITION BY cdt.country_code, cdt.account -- removed: cdt.currency
           ORDER BY 
               -- removed: cdt.country_code, cdt.account, 
               cdt.currency) -- keep
        seq_no
FROM CUSTOMER_DETAILS cdt
</code></pre>
","10477672"
"How to get the insert ID in JDBC?","197863","","<p>I want to <code>INSERT</code> a record in a database (which is Microsoft SQL Server in my case) using JDBC in Java. At the same time, I want to obtain the insert ID. How can I achieve this using JDBC API?</p>
","<p>If it is an auto generated key, then you can use <a href=""http://docs.oracle.com/javase/7/docs/api/java/sql/Statement.html#getGeneratedKeys%28%29"" rel=""noreferrer""><code>Statement#getGeneratedKeys()</code></a> for this. You need to call it on the same <code>Statement</code> as the one being used for the <code>INSERT</code>. You first need to create the statement using <a href=""http://docs.oracle.com/javase/7/docs/api/java/sql/Statement.html#RETURN_GENERATED_KEYS"" rel=""noreferrer""><code>Statement.RETURN_GENERATED_KEYS</code></a> to notify the JDBC driver to return the keys. </p>

<p>Here's a basic example:</p>

<pre><code>public void create(User user) throws SQLException {
    try (
        Connection connection = dataSource.getConnection();
        PreparedStatement statement = connection.prepareStatement(SQL_INSERT,
                                      Statement.RETURN_GENERATED_KEYS);
    ) {
        statement.setString(1, user.getName());
        statement.setString(2, user.getPassword());
        statement.setString(3, user.getEmail());
        // ...

        int affectedRows = statement.executeUpdate();

        if (affectedRows == 0) {
            throw new SQLException(""Creating user failed, no rows affected."");
        }

        try (ResultSet generatedKeys = statement.getGeneratedKeys()) {
            if (generatedKeys.next()) {
                user.setId(generatedKeys.getLong(1));
            }
            else {
                throw new SQLException(""Creating user failed, no ID obtained."");
            }
        }
    }
}
</code></pre>

<p>Note that you're dependent on the JDBC driver whether it works. Currently, most of the last versions will do, but if I am correct, Oracle JDBC driver is still somewhat troublesome with this. MySQL and DB2 already supported it for ages. PostgreSQL started to support it short ago. No wording about MSSQL as I've never used it.</p>

<p>For Oracle, you can invoke a <code>CallableStatement</code> with a <code>RETURNING</code> clause or a <code>SELECT CURRVAL(sequencename)</code> (or whatever DB-specific syntax to do so) directly after the <code>INSERT</code> in the same transaction to obtain the last generated key. See also <a href=""https://stackoverflow.com/questions/3552260/plsql-jdbc-how-to-get-last-row-id/3552353#3552353"">this answer</a>.</p>
","1915197"
"T-SQL: Using a CASE in an UPDATE statement to update certain columns depending on a condition","197215","","<p>I am wondering if this is possible at all. I want to update column x if a condition is true, otherwise column y would be updated</p>

<pre><code>UPDATE table SET
     (CASE (CONDITION) WHEN TRUE THEN columnx
                       ELSE columny
      END)
= 25
</code></pre>

<p>I have searched all over, tried out some things and am unable to find a solution. I think it's not possible, but I thought I would ask here and see if anyone has done it before. Thanks in advance.</p>
","<p>You can't use a condition to change the structure of your query, just the data involved. You could do this:</p>

<pre><code>update table set
    columnx = (case when condition then 25 else columnx end),
    columny = (case when condition then columny else 25 end)
</code></pre>

<p>This is semantically the same, but just bear in mind that <em>both columns will always be updated</em>. This <em>probably</em> won't cause you any problems, but if you have a high transactional volume, then this could cause concurrency issues.</p>

<p>The only way to do <em>specifically</em> what you're asking is to use dynamic SQL. This is, however, something I'd encourage you to stay away from. The solution above will almost certainly be sufficient for what you're after.</p>
","4830240"
"How to create relationships in MySQL","197132","","<p>In class, we are all 'studying' databases, and everyone is using Access. Bored with this, I am trying to do what the rest of the class is doing, but with raw SQL commands with MySQL instead of using Access.</p>

<p>I have managed to create databases and tables, but now how do I make a relationship between two tables?</p>

<p>If I have my two tables like this:</p>

<pre><code>CREATE TABLE accounts(
    account_id INT NOT NULL AUTO_INCREMENT,
    customer_id INT( 4 ) NOT NULL ,
    account_type ENUM( 'savings', 'credit' ) NOT NULL,
    balance FLOAT( 9 ) NOT NULL,
    PRIMARY KEY ( account_id )
)
</code></pre>

<p>and</p>

<pre><code>CREATE TABLE customers(
    customer_id INT NOT NULL AUTO_INCREMENT,
    name VARCHAR(20) NOT NULL,
    address VARCHAR(20) NOT NULL,
    city VARCHAR(20) NOT NULL,
    state VARCHAR(20) NOT NULL,
)
</code></pre>

<p>How do I create a 'relationship' between the two tables? I want each account to be 'assigned' one customer_id (to indicate who owns it).</p>
","<p>If the tables are innodb you can create it like this: </p>

<pre><code>CREATE TABLE accounts(
    account_id INT NOT NULL AUTO_INCREMENT,
    customer_id INT( 4 ) NOT NULL ,
    account_type ENUM( 'savings', 'credit' ) NOT NULL,
    balance FLOAT( 9 ) NOT NULL,
    PRIMARY KEY ( account_id ), 
    FOREIGN KEY (customer_id) REFERENCES customers(customer_id) 
) ENGINE=INNODB;
</code></pre>

<p>You have to specify that the tables are innodb because myisam engine doesn't support foreign key. Look <a href=""http://dev.mysql.com/doc/refman/5.0/en/innodb-foreign-key-constraints.html"" rel=""noreferrer"">here</a> for more info. </p>
","260453"
"1052: Column 'id' in field list is ambiguous","196685","","<p>I have 2 tables. <code>tbl_names</code> and <code>tbl_section</code> which has both the <code>id</code> field in them. How do I go about selecting the <code>id</code> field, because I always get this error:</p>

<pre><code>1052: Column 'id' in field list is ambiguous
</code></pre>

<p>Here's my query:</p>

<pre><code>SELECT id, name, section
  FROM tbl_names, tbl_section 
 WHERE tbl_names.id = tbl_section.id
</code></pre>

<p>I could just select all the fields and avoid the error. But that would be a waste in performance. What should I do?</p>
","<p>SQL supports qualifying a column by prefixing the reference with either the full table name:</p>

<pre><code>SELECT tbl_names.id, tbl_section.id, name, section
  FROM tbl_names
  JOIN tbl_section ON tbl_section.id = tbl_names.id 
</code></pre>

<p>...or a table alias:</p>

<pre><code>SELECT n.id, s.id, n.name, s.section
  FROM tbl_names n
  JOIN tbl_section s ON s.id = n.id 
</code></pre>

<p>The table alias is the recommended approach -- why type more than you have to?</p>

<h3>Why Do These Queries Look Different?</h3>

<p>Secondly, my answers use ANSI-92 JOIN syntax (yours is ANSI-89).  While they perform the same, ANSI-89 syntax does not support OUTER joins (RIGHT, LEFT, FULL).  ANSI-89 syntax should be considered deprecated, there are many on SO who will not vote for ANSI-89 syntax to reinforce that.  For <a href=""https://stackoverflow.com/questions/2241991/in-mysql-queries-why-use-join-instead-of-where"">more information, see this question</a>.</p>
","6638601"
"How can I search (case-insensitive) in a column using LIKE wildcard?","196486","","<p>I looked around some and didn't find what I was after so here goes.</p>

<pre><code>SELECT * FROM trees WHERE trees.`title` LIKE  '%elm%'
</code></pre>

<p>This works fine, but not if the tree is named Elm or ELM etc...</p>

<p>How do I make SQL case insensitive for this wild-card search?</p>

<p>I'm using MySQL 5 and Apache.</p>
","<pre><code>SELECT  *
FROM    trees
WHERE   trees.`title` COLLATE UTF8_GENERAL_CI LIKE '%elm%'
</code></pre>

<p>Actually, if you add <code>COLLATE UTF8_GENERAL_CI</code> to your column's definition, you can just omit all these tricks: it will work automatically. </p>

<pre><code>ALTER TABLE trees 
 MODIFY COLUMN title VARCHAR(…) CHARACTER 
 SET UTF8 COLLATE UTF8_GENERAL_CI. 
</code></pre>

<p>This will also rebuild any indexes on this column so that they could be used for the queries without leading '%'</p>
","2876820"
"mysql update column with value from another table","195885","","<p>I have two tables, both looking like</p>

<pre><code>id  name  value
===================
1   Joe     22
2   Derk    30
</code></pre>

<p>I need to copy the value of <code>value</code> from <code>tableA</code> to <code>tableB</code> based on check name in each table.</p>

<p>Any tips for this <code>UPDATE</code> statement?</p>
","<p>In addition to this answer if you need to change t1.value according to t2.value dynamically you can do for example:</p>

<pre><code>UPDATE tableB
INNER JOIN tableA ON tableB.name = tableA.name
SET tableB.value = IF(tableA.value &gt; 0, tableA.value, tableB.value)
WHERE tableA.name = 'Joe'
</code></pre>
","19346375"
"SQL Insert into table only if record doesn't exist","195868","","<p>I want to run a set of queries to insert some data into an SQL table but only if the record satisfying certain criteria are met. The table has 4 fields: <code>id</code> (primary), <code>fund_id</code>, <code>date</code> and <code>price</code></p>

<p>I have 3 fields in the query: <code>fund_id</code>, <code>date</code> and <code>price</code>.</p>

<p>So my query would go something like this:</p>

<pre><code>INSERT INTO funds (fund_id, date, price)
    VALUES (23, '2013-02-12', 22.43)
    WHERE NOT EXISTS (
       SELECT * 
       FROM funds 
       WHERE fund_id = 23
         AND date = '2013-02-12'
    );
</code></pre>

<p>So I only want to insert the data if a record matching the <code>fund_id</code> and <code>date</code> does not already exist. If the above is correct it strikes me as quite an inefficient way of achieving this as an additional select statement must be run each time.</p>

<p>Is there a better way of achieving the above?</p>

<p>Edit: For clarification neither <code>fund_id</code> nor <code>date</code> are unique fields; records sharing the same fund_id or date will exist but no record should have both the same fund_id and date as another.</p>
","<p>Although the answer I originally marked as chosen is correct and achieves what I asked there is a better way of doing this (which others acknowledged but didn't go into). A composite unique index should be created on the table consisting of <code>fund_id</code> and <code>date</code>.</p>

<pre><code>ALTER TABLE funds ADD UNIQUE KEY `fund_date` (`fund_id`, `date`);
</code></pre>

<p>Then when inserting a record add the condition when a conflict is encountered:</p>

<pre><code>INSERT INTO funds (`fund_id`, `date`, `price`)
    VALUES (23, DATE('2013-02-12'), 22.5)
        ON DUPLICATE KEY UPDATE `price` = `price`; --this keeps the price what it was (no change to the table) or:

INSERT INTO funds (`fund_id`, `date`, `price`)
    VALUES (23, DATE('2013-02-12'), 22.5)
        ON DUPLICATE KEY UPDATE `price` = 22.5; --this updates the price to the new value
</code></pre>

<p>This will provide much better performance to a sub-query and the structure of the table is superior. It comes with the caveat that you can't have NULL values in your unique key columns as they are still treated as values by MySQL.</p>
","19952092"
"Sorting by date & time in descending order?","195326","","<p>all
         I want to display last 5 entered data for specific id.
My sql query is,</p>

<pre><code>SELECT id, name, form_id, DATE(updated_at) as date
  FROM wp_frm_items
  WHERE user_id = 11 &amp;&amp; form_id=9
  ORDER BY updated_at DESC
</code></pre>

<p><code>updated_at</code> is DATETIME</p>

<p>It displays last 5 entry sort by date not by time. On same date then it is sorting alphabetically.</p>

<p>Suppose i have 3 entries in same date with diff time</p>

<p>let's say</p>

<pre><code>Ajay 1/3/2012 1:15
John 1/3/2012 1:00
Bony 1/3/2012 1:10
</code></pre>

<p>after querying the above query </p>

<p>what i got is </p>

<pre><code>Ajay 1/3/2012 1:15
Bony 1/3/2012 1:10
John 1/3/2012 1:00
</code></pre>

<p>Sort by date then after alphabetically</p>

<p>What i want is this..</p>

<pre><code>John 1/3/2012 1:00
Bony 1/3/2012 1:10
Ajay 1/3/2012 1:15
</code></pre>

<p>Sorted by date and time also...</p>
","<p>If you want the last 5 rows, ordered in ascending order, you need a subquery:</p>

<pre><code>SELECT *
FROM
    ( SELECT id, name, form_id, DATE(updated_at) AS updated_date, updated_at
      FROM wp_frm_items
      WHERE user_id = 11 
        AND form_id=9
      ORDER BY updated_at DESC
      LIMIT 5
    ) AS tmp
ORDER BY updated_at
</code></pre>

<hr>

<p>After reading the question for 10th time, this may be (just maybe) what you want. Order by Date descending and then order by time (on same date) ascending:</p>

<pre><code>SELECT id, name, form_id, DATE(updated_at) AS updated_date
FROM wp_frm_items
WHERE user_id = 11 
  AND form_id=9
ORDER BY DATE(updated_at) DESC
       , updated_at ASC
</code></pre>
","9511964"
"Convert INT to DATETIME (SQL)","195266","","<p>I am trying to convert a date to datetime but am getting errors. The datatype I'm converting from is (float,null) and I'd like to convert it to DATETIME.</p>

<p>The first line of this code works fine, but I get this error on the second line:</p>

<pre><code>Arithmetic overflow error converting expression to data type datetime.


CAST(CAST( rnwl_efctv_dt AS INT) AS char(8)),
CAST(CAST( rnwl_efctv_dt AS INT) AS DATETIME),
</code></pre>
","<p>you need to convert to char first because converting to int adds those days to 1900-01-01</p>

<pre><code>select CONVERT (datetime,convert(char(8),rnwl_efctv_dt ))
</code></pre>

<p>here are some examples</p>

<pre><code>select CONVERT (datetime,5)
</code></pre>

<p>1900-01-06 00:00:00.000</p>

<pre><code>select CONVERT (datetime,20100101)
</code></pre>

<p>blows up, because you can't add 20100101 days to 1900-01-01..you go above the limit</p>

<p>convert to char first  </p>

<pre><code>declare @i int
select @i = 20100101
select CONVERT (datetime,convert(char(8),@i))
</code></pre>
","3855936"
"ALTER table - adding AUTOINCREMENT in MySQL","194876","","<p>I created a table in MySQL with on column <code>itemID</code>. After creating the table, now I want to change this column to <code>AUTOINCREMENT</code>. How can this be done using ALTER statements? </p>

<p>Table definition: </p>

<p><code>ALLITEMS (itemid int(10) unsigned, itemname varchar(50))</code></p>

<p>I am using the following code but it is throwing <strong>error: syntax incorrect</strong>.</p>

<pre><code>ALTER TABLE allitems
MODIFY itemid INT(10) UNSIGNED AUTOINCREMENT; 
</code></pre>
","<pre class=""lang-sql prettyprint-override""><code>CREATE TABLE ALLITEMS(
    itemid INT(10)UNSIGNED,
    itemname VARCHAR(50)
);

ALTER TABLE ALLITEMS CHANGE itemid itemid INT(10)AUTO_INCREMENT PRIMARY KEY;

DESC ALLITEMS;

INSERT INTO ALLITEMS(itemname)
VALUES
    ('Apple'),
    ('Orange'),
    ('Banana');

SELECT
    *
FROM
    ALLITEMS;
</code></pre>

<p>I was confused with <code>CHANGE</code> and <code>MODIFY</code> keywords before too:</p>

<pre class=""lang-sql prettyprint-override""><code>ALTER TABLE ALLITEMS CHANGE itemid itemid INT(10)AUTO_INCREMENT PRIMARY KEY;

ALTER TABLE ALLITEMS MODIFY itemid INT(5);
</code></pre>

<p>While we are there, also note that <code>AUTO_INCREMENT</code> can also start with a predefined number:</p>

<pre class=""lang-sql prettyprint-override""><code>ALTER TABLE tbl AUTO_INCREMENT = 100;
</code></pre>
","6957705"
"Using bind variables with dynamic SELECT INTO clause in PL/SQL","194827","","<p>I have a question regarding where bind variables can be used in a dynamic SQL statement in PL/SQL.</p>

<p>For example, I know that this is valid:</p>

<pre><code>CREATE OR REPLACE FUNCTION get_num_of_employees (p_loc VARCHAR2, p_job VARCHAR2) 
RETURN NUMBER
IS
  v_query_str VARCHAR2(1000);
  v_num_of_employees NUMBER;
BEGIN
  v_query_str := 'SELECT COUNT(*) FROM emp_' 
                 || p_loc
                 || ' WHERE job = :bind_job';                           
  EXECUTE IMMEDIATE v_query_str
    INTO v_num_of_employees
    USING p_job;
  RETURN v_num_of_employees;
END;
/
</code></pre>

<p>I was wondering if you could use a bind variables in a select statement like this</p>

<pre><code>CREATE OR REPLACE FUNCTION get_num_of_employees (p_loc VARCHAR2, p_job VARCHAR2) 
RETURN NUMBER
IS
  v_query_str VARCHAR2(1000);
  v_num_of_employees NUMBER;
BEGIN
  v_query_str := 'SELECT COUNT(*) INTO :into_bind FROM emp_' 
                 || p_loc
                 || ' WHERE job = :bind_job';                           
  EXECUTE IMMEDIATE v_query_str
    USING out v_num_of_employees, p_job;
  RETURN v_num_of_employees;
END;
/
</code></pre>

<p>Note I used a SELECT INTO statement as my dyamic string and used a bind variable in the INTO clause.</p>

<p>I am currently travelling right now and won't have access to my computer back at home for a few days, but this has been nagging me for a bit. Tried reading the PL/SQL reference but they don't have an example of a select like this.</p>

<p>Thanks</p>
","<p>No you can't use bind variables that way. In your second example <code>:into_bind</code> in <code>v_query_str</code> is just a <em>placeholder</em> for value of variable <code>v_num_of_employees</code>. Your select into statement will turn into something like:</p>

<pre><code>SELECT COUNT(*) INTO  FROM emp_...
</code></pre>

<p>because the value of <code>v_num_of_employees</code> is <code>null</code> at <code>EXECUTE IMMEDIATE</code>.</p>

<p>Your first example presents the correct way to bind the return value to a variable.</p>

<p><strong>Edit</strong></p>

<p>The original poster has edited the second code block that I'm referring in my answer to use <code>OUT</code> parameter mode for <code>v_num_of_employees</code> instead of the default <code>IN</code> mode. This modification makes the both examples functionally equivalent.</p>
","7816584"
"How to randomly select rows in SQL?","194769","","<p>I am using MSSQL Server 2005. In my db, I have a table ""customerNames"" which has two columns ""Id"" and ""Name"" and approx. 1,000 results. </p>

<p>I am creating a functionality where I have to pick 5 customers randomly every time. Can anyone tell me how to create a query which will get random 5 rows (Id, and Name) every time  when query is executed?</p>
","<pre><code>SELECT TOP 5 Id, Name FROM customerNames
ORDER BY NEWID()
</code></pre>

<p>That said, everybody seems to come to this page for the more general answer to your question:</p>

<h2><a href=""http://www.petefreitag.com/item/466.cfm"" rel=""noreferrer"">Selecting a random row in SQL</a></h2>

<h3>Select a random row with MySQL:</h3>

<pre><code>SELECT column FROM table
ORDER BY RAND()
LIMIT 1
</code></pre>

<h3>Select a random row with PostgreSQL:</h3>

<pre><code>SELECT column FROM table
ORDER BY RANDOM()
LIMIT 1
</code></pre>

<h3>Select a random row with Microsoft SQL Server:</h3>

<pre><code>SELECT TOP 1 column FROM table
ORDER BY NEWID()
</code></pre>

<h3>Select a random row with IBM DB2</h3>

<pre><code>SELECT column, RAND() as IDX 
FROM table 
ORDER BY IDX FETCH FIRST 1 ROWS ONLY
</code></pre>

<h3>Select a random record with Oracle:</h3>

<pre><code>SELECT column FROM
( SELECT column FROM table
ORDER BY dbms_random.value )
WHERE rownum = 1
</code></pre>

<h3>Select a random row with sqlite:</h3>

<pre><code>SELECT column FROM table 
ORDER BY RANDOM() LIMIT 1
</code></pre>
","1209946"
"How to use a TRIM function in SQL Server","193970","","<p>I cannot get this TRIM code to work</p>

<pre><code>SELECT 
   dbo.COL_V_Cost_GEMS_Detail.TNG_SYS_NR AS [EHP Code], 
   dbo.COL_TBL_VCOURSE.TNG_NA AS [Course Title], 
   LTRIM(RTRIM(FCT_TYP_CD)&amp; ') AND (' &amp; LTRIM(RTRIM(DEP_TYP_ID) &amp; ')' AS [Course Owner]
</code></pre>
","<p>You are missing two closing parentheses...and I am not sure an ampersand works as a string concatenation operator.  Try '+'</p>

<pre><code>SELECT dbo.COL_V_Cost_GEMS_Detail.TNG_SYS_NR AS [EHP Code], 
dbo.COL_TBL_VCOURSE.TNG_NA AS [Course Title], 
LTRIM(RTRIM(FCT_TYP_CD)) + ') AND (' + LTRIM(RTRIM(DEP_TYP_ID)) + ')' AS [Course Owner]
</code></pre>
","14447382"
"How to use Oracle ORDER BY and ROWNUM correctly?","193900","","<p>I am having a hard time converting stored procedures from SQL Server to Oracle to have our product compatible with it.</p>

<p>I have queries which returns the most recent record of some tables, based on a timestamp :</p>

<p><strong>SQL Server:</strong></p>

<pre><code>SELECT TOP 1 *
FROM RACEWAY_INPUT_LABO
ORDER BY t_stamp DESC
</code></pre>

<p>=> That will returns me the most recent record</p>

<p>But <strong>Oracle:</strong></p>

<pre><code>SELECT *
FROM raceway_input_labo 
WHERE  rownum &lt;= 1
ORDER BY t_stamp DESC
</code></pre>

<p>=> That will returns me the oldest record (probably depending on the index), regardless the <code>ORDER BY</code> statement!</p>

<p>I encapsulated the Oracle query this way to match my requirements:</p>

<pre><code>SELECT * 
FROM 
    (SELECT *
     FROM raceway_input_labo 
     ORDER BY t_stamp DESC)
WHERE  rownum &lt;= 1
</code></pre>

<p>and it works. But it sounds like a horrible hack to me, especially if I have a lot of records in the involved tables.</p>

<p>What is the best way to achieve this ?</p>
","<p>The <code>where</code> statement gets executed <em>before</em> the <code>order by</code>.  So, your desired query is saying ""<em>take the first row and then order it by</em> <code>t_stamp</code> <em>desc</em>"".  And that is not what you intend.</p>

<p>The subquery method is the proper method for doing this in Oracle.</p>

<p>If you want a version that works in both servers, you can use:</p>

<pre><code>select ril.*
from (select ril.*, row_number() over (order by t_stamp desc) as seqnum
      from raceway_input_labo ril
     ) ril
where seqnum = 1
</code></pre>

<p>The outer <code>*</code> will return ""1"" in the last column.  You would need to list the columns individually to avoid this.</p>
","15091900"
"Row Offset in SQL Server","193177","","<p>Is there any way in SQL Server to get the results starting at a given offset? For example, in another type of SQL database, it's possible to do:</p>

<pre><code>SELECT * FROM MyTable OFFSET 50 LIMIT 25
</code></pre>

<p>to get results 51-75. This construct does not appear to exist in SQL Server.  </p>

<p>How can I accomplish this without loading all the rows I don't care about?  Thanks! </p>
","<p>I would avoid using <code>SELECT *</code>. Specify columns you actually want even though it may be all of them.</p>

<p><strong>SQL Server 2005+</strong></p>

<pre><code>SELECT col1, col2 
FROM (
    SELECT col1, col2, ROW_NUMBER() OVER (ORDER BY ID) AS RowNum
    FROM MyTable
) AS MyDerivedTable
WHERE MyDerivedTable.RowNum BETWEEN @startRow AND @endRow
</code></pre>

<p><strong>SQL Server 2000</strong></p>

<p><a href=""http://www.4guysfromrolla.com/webtech/041206-1.shtml"" rel=""noreferrer"">Efficiently Paging Through Large Result Sets in SQL Server 2000</a></p>

<p><a href=""http://www.4guysfromrolla.com/webtech/042606-1.shtml"" rel=""noreferrer"">A More Efficient Method for Paging Through Large Result Sets</a></p>
","188044"
"How to group time by hour or by 10 minutes ","193025","","<p>like when I do </p>

<pre><code>SELECT [Date]
  FROM [FRIIB].[dbo].[ArchiveAnalog]
  GROUP BY [Date]
</code></pre>

<p>how can I specify the group period ?</p>

<p>MS SQL 2008</p>

<p><strong>2nd Edit</strong></p>

<p>I'm trying </p>

<pre><code>SELECT MIN([Date]) AS RecT, AVG(Value)
  FROM [FRIIB].[dbo].[ArchiveAnalog]
  GROUP BY (DATEPART(MINUTE, [Date]) / 10)
  ORDER BY RecT
</code></pre>

<p>changed %10 to / 10. is it possible to make Date output without milliseconds ?</p>
","<p>finally done with</p>

<pre><code>GROUP BY
DATEPART(YEAR, DT.[Date]),
DATEPART(MONTH, DT.[Date]),
DATEPART(DAY, DT.[Date]),
DATEPART(HOUR, DT.[Date]),
(DATEPART(MINUTE, DT.[Date]) / 10)
</code></pre>
","5101424"
"Oracle Date datatype, transformed to 'YYYY-MM-DD HH24:MI:SS TMZ' through SQL","192480","","<p>I have an application that uploads to an Oracle Data datatype column via:</p>

<pre><code>TO_TIMESTAMP_TZ('2012-10-09 1:10:21 CST','YYYY-MM-DD HH24:MI:SS TZR')
</code></pre>

<p>I now need to pull the following format and timezone from this Data column:
'YYYY-MM-DD HH24:MI:SS CDT'</p>

<p>Note: that the date is uploaded in CST but needs to be returned in CDT.</p>

<p>I have Google'd but have only found following for Date datatypes:</p>

<pre><code>SELECT dateColumn From dateTable;
09-NOV-12

SELECT TO_CHAR(dateColumn,'YYYY-MM-DD HH24:MI:SS') From dateTable;
2012-10-09 1:10:21
</code></pre>

<p>I have tried the following also: </p>

<pre><code>TO_TIMESTAMP_TZ(dateColumn,'YYYY-MM-DD HH24:MI:SS CDT')
data format not recognized

TO_TIMESTAMP_TZ(CRTE_DT,'YYYY-MM-DD HH24:MI:SS TZH:TZM')
09-NOV-12 1:10:21 AM +01:00
don't understand why this does not come back as YYYY-MM-DD?
</code></pre>

<p>How can I solve this problem?</p>
","<p>There's a bit of confusion in your question:</p>

<ul>
<li>a <code>Date</code> datatype doesn't save the time zone component. This piece of information is truncated and lost forever when you insert a <code>TIMESTAMP WITH TIME ZONE</code> into a <code>Date</code>.</li>
<li>When you want to display a date, either on screen or to send it to another system via a character API (XML, file...), you use the <a href=""http://docs.oracle.com/cd/E11882_01/server.112/e26088/functions200.htm#i1009324""><code>TO_CHAR</code></a> function. In Oracle, <strong>a <code>Date</code> has no format</strong>: it is a point in time.</li>
<li>Reciprocally, you would use <a href=""http://docs.oracle.com/cd/E11882_01/server.112/e26088/functions214.htm#i999847""><code>TO_TIMESTAMP_TZ</code></a> to convert a <code>VARCHAR2</code> to a <code>TIMESTAMP</code>, but this won't convert a <code>Date</code> to a <code>TIMESTAMP</code>.</li>
<li>You use <code>FROM_TZ</code> to add the time zone information to a <code>TIMESTAMP</code> (or a <code>Date</code>).</li>
<li>In Oracle, <code>CST</code> is a time zone but <code>CDT</code> is not. <code>CDT</code> is a daylight saving information.</li>
<li>To complicate things further, <code>CST/CDT</code> (<code>-05:00</code>) and <code>CST/CST</code> (<code>-06:00</code>) will have different values obviously, but the time zone <code>CST</code> will inherit the daylight saving information depending upon the date by default.</li>
</ul>

<p>So your conversion may not be as simple as it looks.</p>

<p>Assuming that you want to convert a <code>Date</code> <code>d</code> that you know is valid at time zone <code>CST/CST</code> to the equivalent at time zone <code>CST/CDT</code>, you would use:</p>

<pre><code>SQL&gt; SELECT from_tz(d, '-06:00') initial_ts,
  2         from_tz(d, '-06:00') at time zone ('-05:00') converted_ts
  3    FROM (SELECT cast(to_date('2012-10-09 01:10:21',
  4                              'yyyy-mm-dd hh24:mi:ss') as timestamp) d
  5            FROM dual);

INITIAL_TS                      CONVERTED_TS
------------------------------- -------------------------------
09/10/12 01:10:21,000000 -06:00 09/10/12 02:10:21,000000 -05:00
</code></pre>

<p>My default timestamp format has been used here. I can specify a format explicitely:</p>

<pre><code>SQL&gt; SELECT to_char(from_tz(d, '-06:00'),'yyyy-mm-dd hh24:mi:ss TZR') initial_ts,
  2         to_char(from_tz(d, '-06:00') at time zone ('-05:00'),
  3                 'yyyy-mm-dd hh24:mi:ss TZR') converted_ts
  4    FROM (SELECT cast(to_date('2012-10-09 01:10:21',
  5                              'yyyy-mm-dd hh24:mi:ss') as timestamp) d
  6            FROM dual);

INITIAL_TS                      CONVERTED_TS
------------------------------- -------------------------------
2012-10-09 01:10:21 -06:00      2012-10-09 02:10:21 -05:00
</code></pre>
","15834821"
"SQL Server reports 'Invalid column name', but the column is present and the query works through management studio","192107","","<p>I've hit a bit of an impasse. I have a query that is generated by some C# code. The query works fine in Microsoft SQL Server Management Studio when run against the same database.</p>

<p>However when my code tries to run the same query I get the same error about an invalid column and an exception is thrown. All queries that reference this column are failing.</p>

<p>The column in question was recently added to the database. It is a date column called <code>Incident_Begin_Time_ts</code> .  </p>

<p>An example that fails is:</p>

<pre><code>select * from PerfDiag 
where Incident_Begin_Time_ts &gt; '2010-01-01 00:00:00';
</code></pre>

<p>Other queries like <code>Select MAX(Incident_Being_Time_ts);</code> also fail when run in code because it thinks the column is missing.  </p>

<p>Any ideas?</p>
","<p>I suspect that you have two tables with the same name. One is owned by the schema 'dbo' (<code>dbo.PerfDiag</code>), and the other is owned by the default schema of the account used to connect to SQL Server (something like <code>userid.PerfDiag</code>).</p>

<p>When you have an unqualified reference to a schema object (such as a table) &mdash; one not qualified by schema name &mdash; the object reference must be resolved. Name resolution occurs by searching in the following sequence for an object of the appropriate type (table) with the specified name. The name resolves to the first match:</p>

<ul>
<li>Under the default schema of the user.</li>
<li>Under the schema 'dbo'.</li>
</ul>

<p>The unqualified reference is bound to the first match in the above sequence.</p>

<p>As a general recommended practice, one should <strong>always</strong> qualify references to schema objects, for performance reasons:</p>

<ul>
<li><p>An unqualified reference may invalidate a cached execution plan for the stored procedure or query, since the schema to which the reference was bound may change depending on the credentials executing the stored procedure or query. This results in recompilation of the query/stored procedure, a performance hit. Recompilations cause compile locks to be taken out, blocking others from accessing the needed resource(s).</p></li>
<li><p>Name resolution slows down query execution as two probes must be made to resolve to the likely version of the object (that owned by 'dbo'). This is the usual case. The only time a single probe will resolve the name is if the current user owns an object of the specified name and type.</p></li>
</ul>

<p>[Edited to further note]</p>

<p>The other possibilities are (in no particular order):</p>

<ul>
<li>You aren't connected to the database you think you are.</li>
<li>You aren't connected to the SQL Server instance you think you are.</li>
</ul>

<p>Double check your connect strings and ensure that they explicitly specify the SQL Server instance name and the database name.</p>
","7260645"
"Add a column to existing table and uniquely number them","191735","","<p>I want to add a column to an existing legacy database and write a procedure by which I can assign each record a different value. Something like add a column and autogenerate the data for it.</p>

<p>Like, if I add a new column called ""ID"" (number) I want to then initialize a unique value to each of the records. So, my ID column will have records from say 1 to 1000. How do I do that?</p>
","<p>This will depend on the database but for SQL Server, this could be achieved as follows:</p>

<pre><code>alter table Example
add NewColumn int identity(1,1)
</code></pre>
","108227"
"Display an array in a readable/hierarchical format","191553","","<p>Here is the code for pulling the data for my array</p>

<pre><code>&lt;?php
    $link = mysqli_connect('localhost', 'root', '', 'mutli_page_form');

    $query = ""SELECT * FROM wills_children WHERE will=73"";

    $result = mysqli_query($link, $query) or die(mysqli_error($link));

    if ($result = mysqli_query($link, $query)) {

    /* fetch associative array */
    if($row = mysqli_fetch_assoc($result)) {
        $data = unserialize($row['children']);
    }

    /* free result set */
    mysqli_free_result($result);
    }
?&gt;
</code></pre>

<p>When I use print_r($data) it reads as:</p>

<pre><code>Array ( [0] =&gt; Array ( [0] =&gt; Natural Chlid 1 [1] =&gt; Natural Chlid 2 [2] =&gt; Natural Chlid 3 ) ) 
</code></pre>

<p>I would like it to read as:</p>

<p>Natural Child 1<br />
Natural Child 2<br />
Natural Child 3<br /></p>
","<p>Try this:</p>

<pre><code>foreach($data[0] as $child) {
   echo $child . ""\n"";
}
</code></pre>

<p>in place of <code>print_r($data)</code></p>
","5393128"
"How to assign an exec result to a sql variable?","191276","","<p>How do you assign the result of an exec call to a variable in SQL?  I have a stored proc called <code>up_GetBusinessDay</code>, which returns a single date.  </p>

<p>Can you do something like this:</p>

<pre><code>exec @PreviousBusinessDay = dbo.up_GetBusinessDay @Date, -1
</code></pre>
","<p>I always use the return value to pass back error status.  If you need to pass back one value I'd use an output parameter.</p>

<p>sample stored procedure, with an OUTPUT parameter:</p>

<pre><code>CREATE PROCEDURE YourStoredProcedure 
(
    @Param1    int
   ,@Param2    varchar(5)
   ,@Param3    datetime OUTPUT
)
AS
IF ISNULL(@Param1,0)&gt;5
BEGIN
    SET @Param3=GETDATE()
END
ELSE
BEGIN
    SET @Param3='1/1/2010'
END
RETURN 0
GO
</code></pre>

<p>call to the stored procedure, with an OUTPUT parameter:</p>

<pre><code>DECLARE @OutputParameter  datetime
       ,@ReturnValue      int

EXEC @ReturnValue=YourStoredProcedure 1,null, @OutputParameter OUTPUT
PRINT @ReturnValue
PRINT CONVERT(char(23),@OutputParameter ,121)
</code></pre>

<p>OUTPUT:</p>

<pre><code>0
2010-01-01 00:00:00.000
</code></pre>
","2245981"
"Oracle find a constraint","191232","","<p>I have a constraint called <code>users.SYS_C00381400</code>.  How do I find what that constraint is?  Is there a way to query all constraints?</p>
","<pre><code>select * from all_constraints
where owner = '&lt;NAME&gt;'
and constraint_name = 'SYS_C00381400'
/
</code></pre>

<p>Like all data dictionary views, this a USER_CONSTRAINTS view if you just want to check your current schema and a DBA_CONSTRAINTS view for administration users.</p>

<p>The construction of the constraint name indicates a system generated constraint name.  For instance, if we specify NOT NULL in a table declaration.  Or indeed a primary or unique key.  For example:</p>

<pre><code>SQL&gt; create table t23 (id number not null primary key)
  2  /

Table created.

SQL&gt; select constraint_name, constraint_type
  2  from user_constraints
  3  where table_name = 'T23'
  4  /

CONSTRAINT_NAME                C
------------------------------ -
SYS_C00935190                  C
SYS_C00935191                  P

SQL&gt;
</code></pre>

<p><code>'C'</code> for check, <code>'P'</code> for primary.  </p>

<p>Generally it's a good idea to give relational constraints an explicit name.   For instance, if the database creates an index for the primary key (which it will do if that column is not already indexed) it will use the constraint name o name the index.  You don't want a database full of indexes named like <code>SYS_C00935191</code>.  </p>

<p>Most people don't bother naming NOT NULL constraints. </p>
","2095447"
"How to execute an .SQL script file using c#","190917","","<p>I'm sure this question has been answered already, however I was unable to find an answer using the search tool.</p>

<p>Using c# I'd like to run a .sql file. The sql file contains multiple sql statements, some of which are broken over multiple lines. I tried reading in the file and tried executing the file using ODP.NET ... however I don't think ExecuteNonQuery is really designed to do this.</p>

<p>So I tried using sqlplus via spawning a process ... however unless I spawned the process with UseShellExecute set to true sqlplus would hang and never exit. Here's the code that DOESN'T WORK.</p>

<pre><code>Process p = new Process();
p.StartInfo.UseShellExecute = false;
p.StartInfo.RedirectStandardOutput = true;
p.StartInfo.FileName = ""sqlplus"";
p.StartInfo.Arguments = string.Format(""xx/xx@{0} @{1}"", in_database, s);
p.StartInfo.CreateNoWindow = true;

bool started = p.Start();
p.WaitForExit();
</code></pre>

<p>WaitForExit never returns .... Unless I set UseShellExecute to true. A side effect of UseShellExecute is that you can no capture the redirected output.</p>
","<pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using Microsoft.SqlServer.Management.Smo;
using Microsoft.SqlServer.Management.Common;
using System.IO;
using System.Data.SqlClient;

public partial class ExcuteScript : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
    string sqlConnectionString = @""Integrated Security=SSPI;Persist Security Info=False;Initial Catalog=ccwebgrity;Data Source=SURAJIT\SQLEXPRESS"";

    string script = File.ReadAllText(@""E:\Project Docs\MX462-PD\MX756_ModMappings1.sql"");

    SqlConnection conn = new SqlConnection(sqlConnectionString);

    Server server = new Server(new ServerConnection(conn));

    server.ConnectionContext.ExecuteNonQuery(script);
    }
}
</code></pre>
","1728859"
"How to convert Varchar to Int in sql server 2008?","190400","","<p>How to convert Varchar to Int in sql server 2008.</p>

<p>i have following code when i tried to run it wont allowed me to convert Varchar to Int.</p>

<pre><code>Select Cast([Column1] as INT) 
</code></pre>

<p>Column1 is of Varchar(21) NOT NULL type and i wanted to convert it into Int.
actually i am trying to insert Column1 into another table having Field as INT.
can someone please help me to convert this ?</p>
","<p>Spaces will not be a problem for <code>cast</code>, however characters like <code>TAB</code>, <code>CR</code> or <code>LF</code> will appear as spaces, will not be trimmed by <code>LTRIM</code> or <code>RTRIM</code>, and will be a problem.</p>

<p>For example try the following:</p>

<pre><code>declare @v1 varchar(21) = '66',
        @v2 varchar(21) = '   66   ',
        @v3 varchar(21) = '66' + char(13) + char(10),
        @v4 varchar(21) = char(9) + '66'

select cast(@v1 as int)   -- ok
select cast(@v2 as int)   -- ok
select cast(@v3 as int)   -- error
select cast(@v4 as int)   -- error
</code></pre>

<p>Check your input for these characters and if you find them, use <code>REPLACE</code> to clean up your data.</p>

<hr>

<p>Per your comment, you can use <a href=""http://msdn.microsoft.com/en-us/library/ms186862.aspx"" rel=""noreferrer""><code>REPLACE</code></a> as part of your <code>cast</code>:</p>

<pre><code>select cast(replace(replace(@v3, char(13), ''), char(10), '') as int)
</code></pre>

<p>If this is something that will be happening often, it would be better to clean up the data and modify the way the table is populated to remove the <code>CR</code> and <code>LF</code> before it is entered.</p>
","7973417"
"Escaping ampersand character in SQL string","190398","","<p>I am trying to query a certain row by name in my sql database and it has an ampersand. I tried to set an escape character and then escape the ampersand, but for some reason this isn't working and I'm uncertain as to what exactly my problem is.</p>

<pre><code>Set escape '\'
    select * from V1144engine.T_nodes where node_id in(
    select node2_id from V1144engine.T_edges where node1_id in(
    select node2_id from V1144engine.T_edges where node1_id in(
    select node2_id from V1144engine.T_edges where node1_id = 
      (select node_id from V1144engine.T_nodes where node_name = 'Geometric Vectors \&amp; Matrices')))
    and edge_type_id = 1)
    and node_type_id = 1
    and node_id in (
    select node2_id from V1144engine.T_edges where node1_id =
      (select node_id from V1144engine.T_nodes where node_name = 'Algebra II')
    and edge_type_id = 2);
</code></pre>

<p>Although this has a similar solution to <a href=""https://stackoverflow.com/questions/118190/how-do-i-ignore-ampersands-in-a-sql-script-running-from-sql-plus"">this question</a>, the problems are posed very differently. They may end up having the same solution, but that does not mean that the questions are the same.</p>
","<p>Instead of </p>

<pre><code>node_name = 'Geometric Vectors \&amp; Matrices'
</code></pre>

<p>use </p>

<pre><code>node_name = 'Geometric Vectors ' || chr(38) || ' Matrices' 
</code></pre>

<p>38 is the ascii code for ampersand, and in this form it will be interpreted as a string, nothing else. I tried it and it worked. </p>

<p>Another way could be using LIKE and an underline instead the '&amp;' character: </p>

<pre><code>node_name LIKE 'Geometric Vectors _ Matrices' 
</code></pre>

<p>The chance that you'll find some other record too, which is different in only this one character, is quite low. </p>
","12961550"
"List all tables in postgresql information_schema","189942","","<p>What is the best way to list all of the tables within PostgreSQL's information_schema? </p>

<p>To clarify: I am working with an empty DB (I have not added any of my own tables), but I want to see every table in the information_schema structure.</p>
","<p>You should be able to just run <code>select * from information_schema.tables</code> to get a listing of every table being managed by Postgres for a particular database.</p>

<p>You can also add a <code>where table_schema = 'information_schema'</code> to see just the tables in the information schema.</p>
","2276722"
"Differences between SQL and PL-SQL","189875","","<p>Can somebody highlight the main differences between PL-SQL and SQL? And which one do you recommend for a newbie who wants to dive into DBA?</p>
","<p>SQL is a query language that allows you to issue a single query or execute a single insert/update/delete.  PL-SQL is Oracle's ""Procedural Language"" SQL, which allows you to write a full program (loops, variables, etc.) to accomplish multiple selects/inserts/updates/deletes.  You should learn SQL first, then move on to PL-SQL. You will probably need both to be an Oracle DBA.</p>
","290852"
"How do I drop a foreign key constraint only if it exists in sql server?","189808","","<p>I can drop a table if it exists using the following code but do not know how to do the same with a constraint:</p>

<pre><code>IF EXISTS(SELECT 1 FROM sys.objects WHERE OBJECT_ID = OBJECT_ID(N'TableName') AND type = (N'U')) DROP TABLE TableName
go 
</code></pre>

<p>I also add the constraint using this code:</p>

<pre><code>ALTER TABLE [dbo].[TableName] 
  WITH CHECK ADD CONSTRAINT [FK_TableName_TableName2] FOREIGN KEY([FK_Name])
    REFERENCES [dbo].[TableName2] ([ID])
go
</code></pre>
","<pre><code>IF (OBJECT_ID('FK_TableName_TableName2', 'F') IS NOT NULL)
BEGIN
    ALTER TABLE dbo.TableName DROP CONSTRAINT FK_TableName_TableName2
END
</code></pre>
","482890"
"SQL Combine Two Columns in Select Statement","189695","","<p>If I have a column that is Address1 and Address2 in my database, how do I combine those columns so that I could perform operations on it only in my select statement,  I will still leave them separate in the database. I would like to be able to do this</p>

<pre><code>WHERE completeaddress LIKE '%searchstring%'
</code></pre>

<p>Where completedaddress is the combination of Address1 and Address2. searchstring would be like the data they searched for. So if they had '123 Center St' in Address1 and 'Apt 3B' in Address2, how would I have it select it if the searchstring was 'Center St 3B' Is this possible with SQL?</p>
","<p>I think this is what you are looking for -</p>

<pre><code>select Address1+Address2 as CompleteAddress from YourTable
where Address1+Address2 like '%YourSearchString%'
</code></pre>

<p>To prevent a compound word being created when we append address1 with address2, you can use this - </p>

<pre><code>select Address1 + ' ' + Address2 as CompleteAddress from YourTable 
where Address1 + ' ' + Address2 like '%YourSearchString%'
</code></pre>

<p>So, '123 Center St' and 'Apt 3B' will not be '123 Center StApt 3B' but will be '123 Center St Apt 3B'.</p>
","5247468"
"Update rows in one table with data from another table based on one column in each being equal","189686","","<p>Update <strong><em>many rows</em></strong> into one table from another table based on one column in each being equal (user_id).</p>

<p>both tables have a <code>user_id</code> column.  Need to insert data from <code>t2</code> into <code>t1</code> when the <code>user_id</code> column are equal.</p>

<p>Thank you in advance for any help offered.</p>
","<pre><code>update 
  table1 t1
set
  (
    t1.column1, 
    t1.column2
      ) = (
    select
      t2.column1, 
      t2.column2
    from
      table2  t2
    where
      t2.column1 = t1.column1
     )
    where exists (
      select 
        null
      from 
        table2 t2
      where 
        t2.column1 = t1.column1
      );
</code></pre>

<p>Or this (if t2.column1 &lt;=> t1.column1 are many to one and anyone of them is good):</p>

<pre><code>update 
  table1 t1
set
  (
    t1.column1, 
    t1.column2
      ) = (
    select
      t2.column1, 
      t2.column2
    from
      table2  t2
    where
      t2.column1 = t1.column1
    and
      rownum = 1    
     )
    where exists (
      select 
        null
      from 
        table2 t2
      where 
        t2.column1 = t1.column1
      ); 
</code></pre>
","7919676"
"Column name or number of supplied values does not match table definition","189623","","<p>In SQL server, I am trying to insert values from one table to another by using the below query :</p>

<pre><code>delete from tblTable1

insert into tblTable1 select * from tblTable1_Link
</code></pre>

<p>I am getting the following error :</p>

<pre><code>Column name or number of supplied values does not match table definition.
</code></pre>

<p>I am sure that both table having same structure,column names and same data type:</p>

<p>Please help!</p>
","<p>They don't have the same structure... I can guarantee they are different</p>

<p>I know you've already created it... <a href=""https://stackoverflow.com/questions/1152811/there-is-already-an-object-named-tbltable1-in-the-database"">There is already an object named ‘tbltable1’ in the database</a></p>

<p>What you may want is this (which also fixes your other issue):</p>

<pre><code>Drop table tblTable1

select * into tblTable1 from tblTable1_Link
</code></pre>
","1152941"
"How to write a SQL DELETE statement with a SELECT statement in the WHERE clause?","189188","","<p>Database: Sybase Advantage 11</p>

<p>On my quest to normalize data, I am trying to delete the results I get from this <code>SELECT</code> statement:</p>

<pre><code>SELECT tableA.entitynum
FROM tableA q
INNER JOIN tableB u on (u.qlabel = q.entityrole AND u.fieldnum = q.fieldnum) 
WHERE (LENGTH(q.memotext) NOT IN (8,9,10) 
OR q.memotext NOT LIKE '%/%/%')
AND (u.FldFormat = 'Date')
;
</code></pre>

<p>This is the <code>DELETE</code> statement I have come up with:</p>

<pre><code>DELETE FROM tableA
WHERE (SELECT q.entitynum
FROM tableA q
INNER JOIN tableB u on (u.qlabel = q.entityrole AND u.fieldnum = q.fieldnum) 
WHERE (LENGTH(q.memotext) NOT IN (8,9,10) 
OR q.memotext NOT LIKE '%/%/%')
AND (u.FldFormat = 'Date'))
;
</code></pre>

<p>I continuously get this error when I try to run this statement:</p>

<pre><code>ERROR IN SCRIPT: poQuery: Error 7200:  AQE Error:  State = S0000;   NativeError = 2124;
[iAnywhere Solutions][Advantage SQL Engine]Invalid operand for operator: = Boolean value
cannot be operated with non-Boolean value.
</code></pre>

<p>I have also tried this statement:</p>

<pre><code>DELETE FROM tableA 
INNER JOIN tableB u on (u.qlabel = tableA.entityrole AND u.fieldnum = tableA.fieldnum) 
WHERE (LENGTH(q.memotext) NOT IN (8,9,10) 
OR tableA.memotext NOT LIKE '%/%/%')
AND (u.FldFormat = 'Date')
;
</code></pre>

<p>Which results in:</p>

<pre><code>ERROR IN SCRIPT: poQuery: Error 7200:  AQE Error:  State = 42000;   NativeError = 2117;
[iAnywhere Solutions][Advantage SQL Engine] Unexpected token: INNER -- Expecting semicolon.
-- Location of error in the SQL statement is: 23 (line: 2 column: 1)
</code></pre>

<p>Could someone aid me in properly constructing a DELETE query that will result in the proper data being removed? </p>
","<p>You need to identify the primary key in TableA in order to delete the correct record. The primary key may be a single column or a combination of several columns that uniquely identifies a row in the table. If there is no primary key, then the ROWID pseudo column may be used as the primary key. </p>

<pre><code>DELETE FROM tableA
WHERE ROWID IN 
  ( SELECT q.ROWID
    FROM tableA q
      INNER JOIN tableB u on (u.qlabel = q.entityrole AND u.fieldnum = q.fieldnum) 
    WHERE (LENGTH(q.memotext) NOT IN (8,9,10) OR q.memotext NOT LIKE '%/%/%')
      AND (u.FldFormat = 'Date'));
</code></pre>
","17576164"
"Java - escape string to prevent SQL injection","188427","","<p>I'm trying to put some anti sql injection in place in java and am finding it very difficult to work with the the ""replaceAll"" string function. Ultimately I need a function that will convert any existing <code>\</code> to <code>\\</code>, any <code>""</code> to <code>\""</code>, any <code>'</code> to <code>\'</code>, and any <code>\n</code> to <code>\\n</code> so that when the string is evaluated by MySQL SQL injections will be blocked. </p>

<p>I've jacked up some code I was working with and all the <code>\\\\\\\\\\\</code> in the function are making my eyes go nuts. If anyone happens to have an example of this I would greatly appreciate it.</p>
","<p>PreparedStatements are the way to go, because they make SQL injection impossible.  Here's a simple example taking the user's input as the parameters:</p>

<pre><code>public insertUser(String name, String email) {
   Connection conn = null;
   PreparedStatement stmt = null;
   try {
      conn = setupTheDatabaseConnectionSomehow();
      stmt = conn.prepareStatement(""INSERT INTO person (name, email) values (?, ?)"");
      stmt.setString(1, name);
      stmt.setString(2, email);
      stmt.executeUpdate();
   }
   finally {
      try {
         if (stmt != null) { stmt.close(); }
      }
      catch (Exception e) {
         // log this error
      }
      try {
         if (conn != null) { conn.close(); }
      }
      catch (Exception e) {
         // log this error
      }
   }
}
</code></pre>

<p>No matter what characters are in name and email, those characters will be placed directly in the database.  They won't affect the INSERT statement in any way.</p>

<p>There are different set methods for different data types -- which one you use depends on what your database fields are.  For example, if you have an INTEGER column in the database, you should use a <code>setInt</code> method.  <a href=""http://java.sun.com/javase/6/docs/api/java/sql/PreparedStatement.html"" rel=""noreferrer"">The PreparedStatement documentation</a> lists all the different methods available for setting and getting data.</p>
","1812920"
"Cannot simply use PostgreSQL table name (""relation does not exist"")","188397","","<p>I'm trying to run the following PHP script to do a simple database query:</p>

<pre><code>$db_host = ""localhost"";
$db_name = ""showfinder"";
$username = ""user"";
$password = ""password"";
$dbconn = pg_connect(""host=$db_host dbname=$db_name user=$username password=$password"")
    or die('Could not connect: ' . pg_last_error());

$query = 'SELECT * FROM sf_bands LIMIT 10';
$result = pg_query($query) or die('Query failed: ' . pg_last_error());
</code></pre>

<p>This produces the following error:</p>

<blockquote>
  <p>Query failed: ERROR: relation ""sf_bands"" does not exist</p>
</blockquote>

<p>In all the examples I can find where someone gets an error stating the relation does not exist, it's because they use uppercase letters in their table name. My table name does not have uppercase letters. Is there a way to query my table without including the database name, i.e. <code>showfinder.sf_bands</code>?</p>
","<p>From what I've read, this error means that you're not referencing the table name correctly.  One common reason is that the table is defined with a mixed-case spelling, and you're trying to query it with all lower-case.</p>

<p>In other words, the following fails:</p>

<pre><code>CREATE TABLE ""SF_Bands"" ( ... );

SELECT * FROM sf_bands;  -- ERROR!
</code></pre>

<p>Use double-quotes to delimit identifiers so you can use the specific mixed-case spelling as the table is defined.</p>

<pre><code>SELECT * FROM ""SF_Bands"";
</code></pre>

<hr>

<p>Re your comment, you can add a schema to the ""search_path"" so that when you reference a table name without qualifying its schema, the query will match that table name by checked each schema in order.  Just like <code>PATH</code> in the shell or <code>include_path</code> in PHP, etc.  You can check your current schema search path:</p>

<pre><code>SHOW search_path
  ""$user"",public
</code></pre>

<p>You can change your schema search path:</p>

<pre><code>SET search_path TO showfinder,public;
</code></pre>

<p>See also <a href=""http://www.postgresql.org/docs/8.3/static/ddl-schemas.html"" rel=""noreferrer"">http://www.postgresql.org/docs/8.3/static/ddl-schemas.html</a></p>
","695312"
"Is there a way to access the ""previous row"" value in a SELECT statement?","187724","","<p>I need to calculate the difference of a column between two lines of a table, there is any way I can do this directly in SQL? I'm using Microsoft SQL Server 2008.</p>

<p>I'm looking for something like this:</p>

<pre><code>SELECT value - (previous.value) FROM table
</code></pre>

<p>Imagining that the ""previous"" variable reference the latest selected row. Of course that with a select like this I will end up with n-1 rows selected in a table with n rows, that's not a probably, actually is exactly what I need.</p>

<p>Is that possible in some way?</p>
","<p>SQL has no built in notion of order, so you need to order by some column for this to be meaningful. Something like this:</p>

<pre><code>select t1.value - t2.value from table t1, table t2 
where t1.primaryKey = t2.primaryKey - 1
</code></pre>

<p>If you know how to order things but not how to get the previous value given the current one (EG, you want to order alphabetically) then I don't know of a way to do that in standard SQL, but most SQL implementations will have extensions to do it.</p>

<p>Here is a way for SQL server that works if you can order rows such that each one is distinct:  </p>

<pre><code>select  rank() OVER (ORDER BY id) as 'Rank', value into temp1 from t

select t1.value - t2.value from temp1 t1, temp1 t2 
where t1.Rank = t2.Rank - 1

drop table temp1
</code></pre>

<p>If you need to break ties, you can add as many columns as necessary to the ORDER BY.</p>
","710222"
"COALESCE Function in TSQL","187714","","<p>Can someone explain how the COALESCE function in TSQL works?  The syntax is as follows</p>

<blockquote>
  <p>COALESCE(x, y)</p>
</blockquote>

<p>The MSDN document on this function is pretty vague</p>
","<p>I've been told that COALESCE is less costly than ISNULL, but research doesn't indicate that.  ISNULL takes only two parameters, the field being evaluated for NULL, and the result you want if it is evaluated as NULL.  COALESCE will take any number of parameters, and return the first value encountered that isn't NULL.  </p>

<p>There's a much more thorough description of the details here
<a href=""http://www.mssqltips.com/sqlservertip/2689/deciding-between-coalesce-and-isnull-in-sql-server/"" rel=""noreferrer"">http://www.mssqltips.com/sqlservertip/2689/deciding-between-coalesce-and-isnull-in-sql-server/</a></p>
","13366686"
"MySQL Multiple Joins in one query?","187626","","<p>I have the following query:</p>

<pre><code>SELECT
  dashboard_data.headline,
  dashboard_data.message,
  dashboard_messages.image_id 
FROM dashboard_data
INNER JOIN dashboard_messages
  ON dashboard_message_id = dashboard_messages.id
</code></pre>

<p>So I am using an <code>INNER JOIN</code> and grabbing the <code>image_id</code>.  So now, I want to take that image_id and turn it into <code>images.filename</code> from the images table. </p>

<p>How can I add that in to my query?</p>
","<p>You can simply add another join like this:</p>

<pre><code>SELECT dashboard_data.headline, dashboard_data.message, dashboard_messages.image_id, images.filename
FROM dashboard_data 
    INNER JOIN dashboard_messages 
        ON dashboard_message_id = dashboard_messages.id
    INNER JOIN images
        ON dashboard_messages.image_id = images.image_id 
</code></pre>

<p>However be aware that, because it is an <code>INNER JOIN</code>, if you have a message without an image, the entire row will be skipped. If this is a possibility, you may want to do a <code>LEFT OUTER JOIN</code> which will return all your dashboard messages and an image_filename only if one exists (otherwise you'll get a null)</p>

<pre><code>SELECT dashboard_data.headline, dashboard_data.message, dashboard_messages.image_id, images.filename
FROM dashboard_data 
    INNER JOIN dashboard_messages 
        ON dashboard_message_id = dashboard_messages.id
    LEFT OUTER JOIN images
        ON dashboard_messages.image_id = images.image_id 
</code></pre>
","8974371"
"could not extract ResultSet in hibernate","187374","","<p>I have a problem in <em>Hibernate</em>. I try to parse to List but It throw an exception: <code>HTTP Status 500 - could not extract ResultSet</code>. When I debug, It fault at line <code>query.list()</code>..  </p>

<p>My sample code here</p>

<pre><code>@Entity
@Table(name = ""catalog"")
public class Catalog implements Serializable {

@Id
@Column(name=""ID_CATALOG"")
@GeneratedValue 
private Integer idCatalog;

@Column(name=""Catalog_Name"")
private String catalogName;

@OneToMany(mappedBy=""catalog"", fetch = FetchType.LAZY)
private Set&lt;Product&gt; products = new HashSet&lt;Product&gt;(0);

//getter &amp; setter &amp; constructor
//...
}


@Entity
@Table(name = ""product"")
public class Product implements Serializable {

@Id
@Column(name=""id_product"")
@GeneratedValue 
private Integer idProduct;

@ManyToOne
@JoinColumn(name=""ID_CATALOG"")
private Catalog catalog;

@Column(name=""product_name"")
private String productName;

@Column(name=""date"")
private Date date;

@Column(name=""author"")
private String author;

@Column(name=""price"")
private Integer price;

@Column(name=""linkimage"")
private String linkimage;

//getter &amp; setter &amp; constructor
}



@Repository
@SuppressWarnings({""unchecked"", ""rawtypes""})
public class ProductDAOImpl implements ProductDAO {
    @Autowired
    private SessionFactory sessionFactory;
public List&lt;Product&gt; searchProductByCatalog(String catalogid, String keyword) {
    String sql = ""select p from Product p where 1 = 1"";
    Session session = sessionFactory.getCurrentSession();

    if (keyword.trim().equals("""") == false) {
        sql += "" and p.productName like '%"" + keyword + ""%'"";
    }
    if (catalogid.trim().equals(""-1"") == false
            &amp;&amp; catalogid.trim().equals("""") == false) {
        sql += "" and p.catalog.idCatalog = "" + Integer.parseInt(catalogid);
    }
    Query query = session.createQuery(sql);
    List listProduct = query.list();
    return listProduct;
}

}
</code></pre>

<p>My beans</p>

<pre class=""lang-xml prettyprint-override""><code>  &lt;!-- Scan classpath for annotations (eg: @Service, @Repository etc) --&gt;
  &lt;context:component-scan base-package=""com.shopmvc""/&gt;

  &lt;!-- JDBC Data Source. It is assumed you have MySQL running on localhost port 3306 with 
       username root and blank password. Change below if it's not the case --&gt;
  &lt;bean id=""myDataSource"" class=""org.apache.commons.dbcp.BasicDataSource"" destroy-method=""close""&gt;
    &lt;property name=""driverClassName"" value=""com.mysql.jdbc.Driver""/&gt;
    &lt;property name=""url"" value=""jdbc:mysql://localhost:3306/shoesshopdb?autoReconnect=true""/&gt;
    &lt;property name=""username"" value=""root""/&gt;
    &lt;property name=""password"" value=""12345""/&gt;
    &lt;property name=""validationQuery"" value=""SELECT 1""/&gt;
  &lt;/bean&gt;

  &lt;!-- Hibernate Session Factory --&gt;
  &lt;bean id=""mySessionFactory"" class=""org.springframework.orm.hibernate4.LocalSessionFactoryBean""&gt;
    &lt;property name=""dataSource"" ref=""myDataSource""/&gt;
    &lt;property name=""packagesToScan""&gt;
      &lt;array&gt;
        &lt;value&gt;com.shopmvc.pojo&lt;/value&gt;
      &lt;/array&gt;
    &lt;/property&gt;
    &lt;property name=""hibernateProperties""&gt;
      &lt;value&gt;
        hibernate.dialect=org.hibernate.dialect.MySQLDialect
      &lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;!-- Hibernate Transaction Manager --&gt;
  &lt;bean id=""transactionManager"" class=""org.springframework.orm.hibernate4.HibernateTransactionManager""&gt;
    &lt;property name=""sessionFactory"" ref=""mySessionFactory""/&gt;
  &lt;/bean&gt;

  &lt;!-- Activates annotation based transaction management --&gt;
  &lt;tx:annotation-driven transaction-manager=""transactionManager""/&gt;
</code></pre>

<p>Exception:</p>

<pre class=""lang-none prettyprint-override""><code>org.springframework.web.util.NestedServletException: Request processing failed; nested exception is org.hibernate.exception.SQLGrammarException: could not extract ResultSet
    org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:948)
    org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:827)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:621)
    org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:812)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:728)

root cause 

org.hibernate.exception.SQLGrammarException: could not extract ResultSet
    org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:82)
    org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:49)
    org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:125)
    org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:110)
    org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.extract(ResultSetReturnImpl.java:61)
    org.hibernate.loader.Loader.getResultSet(Loader.java:2036)

root cause 

com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Unknown column 'product0_.ID_CATALOG' in 'field list'
    sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
    sun.reflect.NativeConstructorAccessorImpl.newInstance(Unknown Source)
    sun.reflect.DelegatingConstructorAccessorImpl.newInstance(Unknown Source)
    java.lang.reflect.Constructor.newInstance(Unknown Source)
    com.mysql.jdbc.Util.handleNewInstance(Util.java:411)
    com.mysql.jdbc.Util.getInstance(Util.java:386)
    com.mysql.jdbc.SQLError.createSQLException(SQLError.java:1054)
    com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:4187)
    com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:4119)
    com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:2570)
    com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:2731)
    com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:2815)
    com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:2155)
    com.mysql.jdbc.PreparedStatement.executeQuery(PreparedStatement.java:2322)
    org.apache.commons.dbcp.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:96)
    org.apache.commons.dbcp.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:96)
    org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.extract(ResultSetReturnImpl.java:56)
    org.hibernate.loader.Loader.getResultSet(Loader.java:2036)
    org.hibernate.loader.Loader.executeQueryStatement(Loader.java:1836)
    org.hibernate.loader.Loader.executeQueryStatement(Loader.java:1815)
    org.hibernate.loader.Loader.doQuery(Loader.java:899)
    org.hibernate.loader.Loader.doQueryAndInitializeNonLazyCollections(Loader.java:341)
    org.hibernate.loader.Loader.doList(Loader.java:2522)
    org.hibernate.loader.Loader.doList(Loader.java:2508)
    org.hibernate.loader.Loader.listIgnoreQueryCache(Loader.java:2338)
    org.hibernate.loader.Loader.list(Loader.java:2333)
    org.hibernate.loader.hql.QueryLoader.list(QueryLoader.java:490)
</code></pre>

<p>My Database:</p>

<pre class=""lang-sql prettyprint-override""><code>CREATE TABLE `catalog` (
  `ID_CATALOG` int(11) NOT NULL AUTO_INCREMENT,
  `Catalog_Name` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`ID_CATALOG`)
)

CREATE TABLE `product` (
  `id_product` int(11) NOT NULL AUTO_INCREMENT,
  `product_name` varchar(45) DEFAULT NULL,
  `date` date DEFAULT NULL,
  `author` varchar(45) DEFAULT NULL,
  `price` int(11) DEFAULT NULL,
  `catalog_id` int(11) DEFAULT NULL,
  `linkimage` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`id_product`),
  KEY `FK_Product_idx` (`catalog_id`),
  CONSTRAINT `FK_Product` FOREIGN KEY (`catalog_id`) REFERENCES `catalog` (`ID_CATALOG`) ON DELETE NO ACTION ON UPDATE NO ACTION
)
</code></pre>
","<p>The <code>@JoinColumn</code> annotation specifies the name of the column being used as the foreign key on the targeted entity. </p>

<p>On the <code>Product</code> class above, the name of the join column is set to <code>ID_CATALOG</code>.</p>

<pre><code>@ManyToOne
@JoinColumn(name=""ID_CATALOG"")
private Catalog catalog;
</code></pre>

<p>However, the foreign key on the <code>Product</code> table is called <code>catalog_id</code></p>

<pre><code>`catalog_id` int(11) DEFAULT NULL,
</code></pre>

<p>You'll need to change either the column name on the table or the name you're using in the <code>@JoinColumn</code> so that they match. See <a href=""http://docs.jboss.org/hibernate/annotations/3.5/reference/en/html/entity.html#entity-mapping-association"">http://docs.jboss.org/hibernate/annotations/3.5/reference/en/html/entity.html#entity-mapping-association</a></p>
","20097822"
"How to use BOOLEAN type in SELECT statement","186781","","<p>I have a PL/SQL function with BOOLEAN in parameter:</p>

<pre><code>function get_something(name in varchar2, ignore_notfound in boolean);
</code></pre>

<p>This function is a part of 3rd party tool, I cannot change this.</p>

<p>I would like to use this function inside a SELECT statement like this:</p>

<pre><code> select get_something('NAME', TRUE) from dual;
</code></pre>

<p>This does not work, I get this exception:</p>

<blockquote>
  <p>ORA-00904: ""TRUE"": invalid identifier</p>
</blockquote>

<p>As I understand it, keyword <code>TRUE</code> is not recognized.</p>

<p>How can I make this work?</p>
","<p>You can build a wrapper function like this:</p>

<pre><code>function get_something(name in varchar2,
                   ignore_notfound in varchar2) return varchar2
is
begin
    return get_something (name, (upper(ignore_notfound) = 'TRUE') );
end;
</code></pre>

<p>then call:</p>

<pre><code>select get_something('NAME', 'TRUE') from dual;
</code></pre>

<p>It's up to you what the valid values of ignore_notfound are in your version, I have assumed 'TRUE' means TRUE and anything else means FALSE.</p>
","1465430"
"Changing the maximum length of a varchar column?","186183","","<p>I'm trying to update the length of a varchar column from 255 characters to 500 without losing the contents. I've dropped and re-created tables before but I've never been exposed to the alter statement which is what I believe I need to use to do this. I found the documentation here: <a href=""http://msdn.microsoft.com/en-us/library/ms190273.aspx"" rel=""noreferrer"">ALTER TABLE (Transfact-SQL)</a> however I can't make heads or tails of it.</p>

<p>I have the following so far (essentially nothing unfortunately):</p>

<pre><code>alter table [progennet_dev].PROGEN.LE
alter column UR_VALUE_3
</code></pre>

<p>How do I approach this? Is there better documentation for this statement out there (I did some searches for an example statement but came up empty)?</p>
","<p>You need </p>

<pre><code>ALTER TABLE YourTable ALTER COLUMN YourColumn &lt;&lt;new_datatype&gt;&gt; [NULL | NOT NULL]
</code></pre>

<p>But remember to specify <code>NOT NULL</code> explicitly if desired. </p>

<pre><code>ALTER TABLE YourTable ALTER COLUMN YourColumn VARCHAR (500) NOT NULL;
</code></pre>

<p>If you leave it unspecified as below...</p>

<pre><code>ALTER TABLE YourTable ALTER COLUMN YourColumn VARCHAR (500);
</code></pre>

<p>Then the column will default to allowing nulls even if it was originally defined as <code>NOT NULL</code>. i.e. omitting the specification in an <code>ALTER TABLE ... ALTER COLUMN</code> is always treated as.</p>

<pre><code>ALTER TABLE YourTable ALTER COLUMN YourColumn VARCHAR (500) NULL;
</code></pre>

<p>This behaviour is different from that used for new columns created with <code>ALTER TABLE</code> (or at <code>CREATE TABLE</code> time). There the default nullability depends on the <a href=""https://msdn.microsoft.com/en-us/library/ms187375.aspx"" rel=""noreferrer""><code>ANSI_NULL_DFLT</code></a> settings.</p>
","8829066"
"casting as decimal and rounding","186165","","<p>so it appears that if you</p>

<pre><code>CAST(field1 as decimal) field1
</code></pre>

<p>this will automatically add rounding. </p>

<p>the original is defined as:</p>

<p>field1  type:float  length:8    prec:53   </p>

<p>i need to cast it to decimal, because i need my Entity Framework layer to generate this field as decimal (instead of double)</p>

<p>is there a way to cast it as decimal, so that it preserves original precision, and doesn't round? </p>

<p>i would like to avoid having to declare the precision in the cast, because 1. there are 100's of fields involved with varying precision, and 1. if the underlying table changes in the future, it could cause unforeseen bugs to emerge, and 3. makes the management more difficult</p>
","<p>Have you tried:</p>

<pre><code>SELECT Cast( 2.555 as decimal(53,8))
</code></pre>

<p>This would return <code>2.55500000</code>.  Is that what you want?</p>

<p><strong>UPDATE:</strong></p>

<p>Apparently you can also use SQL_VARIANT_PROPERTY to find the precision and scale of a value.  Example:</p>

<pre><code>SELECT SQL_VARIANT_PROPERTY(Cast( 2.555 as decimal(8,7)),'Precision'),
SQL_VARIANT_PROPERTY(Cast( 2.555 as decimal(8,7)),'Scale')
</code></pre>

<p>returns <code>8|7</code></p>

<p>You may be able to use this in your conversion process...</p>
","4169568"
"SQL WHERE condition, not equal to?","185547","","<p>Is it possible to negate a where clause?</p>

<p>e.g.</p>

<pre><code>DELETE * FROM table WHERE id != 2;
</code></pre>
","<p>You can do like this</p>

<pre><code>DELETE FROM table WHERE id NOT IN ( 2 )
</code></pre>

<p>OR </p>

<pre><code>DELETE FROM table WHERE id &lt;&gt;  2 
</code></pre>

<p>As @Frank Schmitt noted, you might want to be careful about the NULL values too. If you want to delete everything which is not <code>2</code>(including the NULLs) then add <code>OR id IS NULL</code> to the WHERE clause.</p>
","6156997"
"SQL ""select where not in subquery"" returns no results","185262","","<p><em>Disclaimer: I have figured out the problem (I think), but I wanted to add this issue to Stack Overflow since I couldn't (easily) find it anywhere.  Also, someone might have a better answer than I do.</em></p>

<p>I have a database where one table ""Common"" is referenced by several other tables.  I wanted to see what records in the Common table were orphaned (i.e., had no references from any of the other tables).</p>

<p>I ran this query:</p>

<pre><code>select *
from Common
where common_id not in (select common_id from Table1)
and common_id not in (select common_id from Table2)
</code></pre>

<p>I know that there are orphaned records, but no records were returned.  Why not?</p>

<p>(This is SQL Server, if it matters.)</p>
","<p><strong>Update:</strong></p>

<p>These articles in my blog describe the differences between the methods in more detail:</p>

<ul>
<li><a href=""http://explainextended.com/2009/09/15/not-in-vs-not-exists-vs-left-join-is-null-sql-server/"" rel=""noreferrer""><strong><code>NOT IN</code> vs. <code>NOT EXISTS</code> vs. <code>LEFT JOIN / IS NULL</code>: <code>SQL Server</code></strong></a></li>
<li><a href=""http://explainextended.com/2009/09/16/not-in-vs-not-exists-vs-left-join-is-null-postgresql/"" rel=""noreferrer""><strong><code>NOT IN</code> vs. <code>NOT EXISTS</code> vs. <code>LEFT JOIN / IS NULL</code>: <code>PostgreSQL</code></strong></a></li>
<li><a href=""http://explainextended.com/2009/09/17/not-in-vs-not-exists-vs-left-join-is-null-oracle/"" rel=""noreferrer""><strong><code>NOT IN</code> vs. <code>NOT EXISTS</code> vs. <code>LEFT JOIN / IS NULL</code>: <code>Oracle</code></strong></a></li>
<li><a href=""http://explainextended.com/2009/09/18/not-in-vs-not-exists-vs-left-join-is-null-mysql/"" rel=""noreferrer""><strong><code>NOT IN</code> vs. <code>NOT EXISTS</code> vs. <code>LEFT JOIN / IS NULL</code>: <code>MySQL</code></strong></a></li>
</ul>

<hr>

<p>There are three ways to do such a query:</p>

<ul>
<li><p><code>LEFT JOIN / IS NULL</code>:</p>

<pre><code>SELECT  *
FROM    common
LEFT JOIN
        table1 t1
ON      t1.common_id = common.common_id
WHERE   t1.common_id IS NULL
</code></pre></li>
<li><p><code>NOT EXISTS</code>:</p>

<pre><code>SELECT  *
FROM    common
WHERE   NOT EXISTS
        (
        SELECT  NULL
        FROM    table1 t1
        WHERE   t1.common_id = common.common_id
        )
</code></pre></li>
<li><p><code>NOT IN</code>:</p>

<pre><code>SELECT  *
FROM    common
WHERE   common_id NOT IN
        (
        SELECT  common_id
        FROM    table1 t1
        )
</code></pre></li>
</ul>

<p>When <code>table1.common_id</code> is not nullable, all these queries are semantically the same.</p>

<p>When it is nullable, <code>NOT IN</code> is different, since <code>IN</code> (and, therefore, <code>NOT IN</code>) return <code>NULL</code> when a value does not match anything in a list containing a <code>NULL</code>.</p>

<p>This may be confusing but may become more obvious if we recall the alternate syntax for this:</p>

<pre><code>common_id = ANY
(
SELECT  common_id
FROM    table1 t1
)
</code></pre>

<p>The result of this condition is a boolean product of all comparisons within the list. Of course, a single <code>NULL</code> value yields the <code>NULL</code> result which renders the whole result <code>NULL</code> too.</p>

<p>We never cannot say definitely that <code>common_id</code> is not equal to anything from this list, since at least one of the values is <code>NULL</code>.</p>

<p>Suppose we have these data:</p>

<pre><code>common

--
1
3

table1

--
NULL
1
2
</code></pre>

<p><code>LEFT JOIN / IS NULL</code> and <code>NOT EXISTS</code> will return <code>3</code>, <code>NOT IN</code> will return <em>nothing</em> (since it will always evaluate to either <code>FALSE</code> or <code>NULL</code>).</p>

<p>In <code>MySQL</code>, in case on non-nullable column, <code>LEFT JOIN / IS NULL</code> and <code>NOT IN</code> are a little bit (several percent) more efficient than <code>NOT EXISTS</code>. If the column is nullable, <code>NOT EXISTS</code> is the most efficient (again, not much).</p>

<p>In <code>Oracle</code>, all three queries yield same plans (an <code>ANTI JOIN</code>).</p>

<p>In <code>SQL Server</code>, <code>NOT IN</code> / <code>NOT EXISTS</code> are more efficient, since <code>LEFT JOIN / IS NULL</code> cannot be optimized to an <code>ANTI JOIN</code> by its optimizer.</p>

<p>In <code>PostgreSQL</code>, <code>LEFT JOIN / IS NULL</code> and <code>NOT EXISTS</code> are more efficient than <code>NOT IN</code>, sine they are optimized to an <code>Anti Join</code>, while <code>NOT IN</code> uses <code>hashed subplan</code> (or even a plain <code>subplan</code> if the subquery is too large to hash)</p>
","1411353"
"Removing duplicates from a SQL query (not just ""use distinct"")","185067","","<p>It's probably simple, here is my query:</p>

<pre><code>SELECT DISTINCT U.NAME, P.PIC_ID
FROM USERS U, PICTURES P, POSTINGS P1
WHERE U.EMAIL_ID = P1.EMAIL_ID AND P1.PIC_ID = P.PIC_ID AND P.CAPTION LIKE '%car%';
</code></pre>

<p>but this will only remove duplicates where a row has both the same u.name and p.pic_id. I want it so if there is any duplicates of the names, it just leaves out the other rows. It's a weird query, but in general, how can I apply the distinct to a single column of the SELECT clause?</p>
","<p>Arbitrarily choosing to keep the minimum PIC_ID. Also, avoid using the implicit join syntax.</p>

<pre><code>SELECT U.NAME, MIN(P.PIC_ID)
    FROM USERS U
        INNER JOIN POSTINGS P1
            ON U.EMAIL_ID = P1.EMAIL_ID
        INNER JOIN PICTURES P
            ON P1.PIC_ID = P.PIC_ID
    WHERE P.CAPTION LIKE '%car%'
    GROUP BY U.NAME;
</code></pre>
","4891727"
"Modify table: How to change 'Allow Nulls' attribute from not null to allow null","184665","","<p>How to change one attribute in a table using T-SQL to allow nulls (not null --> null)? Alter table maybe?</p>
","<pre><code>-- replace NVARCHAR(42) with the actual type of your column
ALTER TABLE your_table
ALTER COLUMN your_column NVARCHAR(42) NULL
</code></pre>
","3889944"
"If statement in select (ORACLE)","184632","","<p>Hi I have simply select and works great:</p>

<pre><code>select 'CARAT Issue Open' issue_comment, i.issue_id, i.issue_status, i.issue_title, i.ISSUE_summary ,i.issue_description, i.severity,
gcrs.Area_name, gcrs.sector_name,

substr(gcrs.stream_name,1,case when instr(gcrs.stream_name,' (')=0 then 100 else instr(gcrs.stream_name,' (')-1 end) ISSUE_DIVISION,

case when gcrs.STREAM_NAME like 'NON-GT%' THEN 'NON-GT' ELSE gcrs.STREAM_NAME END as ISSUE_DIVISION_2


from table(f_carat_issues_as_of('31/MAR/2013')) i
inner join v_gcrs_with_stream gcrs on i.segment_id = gcrs.segment_id

where UPPER(ISSUE_STATUS) like '%OPEN%'
</code></pre>

<p>Now I want to call two columns:
ISSUE_DIVISION and ISSUE_DIVISION_2</p>

<p>if they are equal in new columns should be value 1 if are not equal should be 0,</p>

<p>how can I do it ? </p>

<hr>

<p>my full code:</p>

<pre><code>select 'CARAT Issue Open' issue_comment, i.issue_id, i.issue_status, i.issue_title, i.ISSUE_summary ,i.issue_description, i.severity,
gcrs.Area_name, gcrs.sector_name,

substr(gcrs.stream_name,1,case when instr(gcrs.stream_name,' (')=0 then 100 else instr(gcrs.stream_name,' (')-1 end) ISSUE_DIVISION,

case when gcrs.STREAM_NAME like 'NON-GT%' THEN 'NON-GT' ELSE gcrs.STREAM_NAME END as ISSUE_DIVISION_2


from table(f_carat_issues_as_of('31/MAR/2013')) i
inner join v_gcrs_with_stream gcrs on i.segment_id = gcrs.segment_id

where UPPER(ISSUE_STATUS) like '%OPEN%' and 

CASE WHEN ISSUE_DIVISION = ISSUE_DIVISION_2 THEN 
     CASE WHEN  ISSUE_DIVISION is null then ""Null Value found""
     Else 1 End
ELSE 0 END As Issue_Division_Result
</code></pre>

<p>but I get error on line:
    ELSE 0 END As Issue_Division_Result</p>

<p>ORA-00920: invalid relational operator :(</p>
","<pre><code>SELECT (CASE WHEN ISSUE_DIVISION = ISSUE_DIVISION_2 THEN 1 ELSE 0 END) AS ISSUES
    --  &lt;add any columns to outer select from inner query&gt; 
  FROM
 (  -- your query here --
   select 'CARAT Issue Open' issue_comment, ...., ..., 
          substr(gcrs.stream_name,1,case when instr(gcrs.stream_name,' (')=0 then 100 else  instr(gcrs.stream_name,' (')-1 end) ISSUE_DIVISION,
          case when gcrs.STREAM_NAME like 'NON-GT%' THEN 'NON-GT' ELSE gcrs.STREAM_NAME END as ISSUE_DIVISION_2
     from ....
    where UPPER(ISSUE_STATUS) like '%OPEN%'
 )
 WHERE... -- optional --
</code></pre>
","15617154"
"How to force a SQL Server 2008 database to go Offline","184562","","<p>How do I force my Database to go Offline, without regard to what or who is already using it?</p>

<p>I tried:</p>

<pre><code>ALTER DATABASE database-name SET OFFLINE;
</code></pre>

<p>But it's still hanging after 7 min.</p>

<p>I want this because I need to test the scenario.</p>

<p>If it's even possible?</p>
","<p>Go offline</p>

<pre><code>USE master
GO
ALTER DATABASE YourDatabaseName
SET OFFLINE WITH ROLLBACK IMMEDIATE
GO
</code></pre>

<p>Go online</p>

<pre><code>USE master
GO
ALTER DATABASE YourDatabaseName
SET ONLINE
GO
</code></pre>
","3005701"
"DB2 Query to retrieve all table names for a given schema","184408","","<p>I'm just looking for a simple query to select all the table names for a given schema.</p>

<p>For example, our DB has over 100 tables and I need to find any table that contains the sub-string “CUR”.  I can use the like command once I have all the tables.</p>
","<pre><code>select * from sysibm.systables
where owner = 'SCHEMA'
and name like '%CUR%'
and type = 'T';
</code></pre>

<p>This will give you all the tables with <code>CUR</code> in them in the <code>SCHEMA</code> schema.</p>

<p>See <a href=""http://publib.boulder.ibm.com/infocenter/dzichelp/v2r2/index.jsp?topic=/com.ibm.db29.doc.sqlref/db2z_sysibmsystablestable.htm"" rel=""noreferrer"">here</a> for more details on the <code>SYSIBM.SYSTABLES</code> table. If you have a look at the navigation pane on the left, you can get all sorts of wonderful DB2 metatdata.</p>

<p>Note that this link is for the mainframe DB2/z. DB2/LUW (the Linux/UNIX/Windows one) has slightly different columns. For that, I believe you want the <code>CREATOR</code> column.</p>

<p>In any case, you should examine the IBM docs for your specific variant. The table name almost certainly <em>won't</em> change however, so just look up <code>SYSIBM.SYSTABLES</code> for the details.</p>
","3584161"
"Transfer data from one database to another database","184225","","<p>how to fetch the data from one database and insert in to another database table....I can't to do this. Please help me to for transferring Data from on to another. thanks in advance...</p>
","<p><a href=""http://okayguru.blogspot.co.uk/2012/03/copy-one-database-to-another-database.html"" rel=""noreferrer"">http://okayguru.blogspot.co.uk/2012/03/copy-one-database-to-another-database.html</a></p>

<p>There are several ways to do this, below are two options:</p>

<p>Option 1
- Right click on the database you want to copy</p>

<ul>
<li><p>Choose 'Tasks' > 'Generate scripts'</p></li>
<li><p>'Select specific database objects'</p></li>
<li><p>Check 'Tables'</p></li>
<li><p>Mark 'Save to new query window'</p></li>
<li><p>Click 'Advanced'</p></li>
<li><p>Set 'Types of data to script' to 'Schema and data'</p></li>
<li><p>Next, Next</p></li>
</ul>

<p>You can now run the generated query on the new database.</p>

<p>Option 2</p>

<ul>
<li><p>Right click on the database you want to copy</p></li>
<li><p>'Tasks' > 'Export Data'</p></li>
<li><p>Next, Next </p></li>
<li><p>Choose the database to copy the tables to</p></li>
<li><p>Mark 'Copy data from one or more tables or views'</p></li>
<li><p>Choose the tables you want to copy</p></li>
<li><p>Finish</p></li>
</ul>
","10030385"
"How to implement LIMIT with Microsoft SQL Server?","184012","","<p>I have this query with mysql : </p>

<pre><code>select * from table1 LIMIT 10,20
</code></pre>

<p>How can I do this with Microsoft sql ?</p>
","<p>Starting SQL SERVER 2005, you can do this...</p>

<pre><code>USE AdventureWorks;
GO
WITH OrderedOrders AS
(
    SELECT SalesOrderID, OrderDate,
    ROW_NUMBER() OVER (ORDER BY OrderDate) AS 'RowNumber'
    FROM Sales.SalesOrderHeader 
) 
SELECT * 
FROM OrderedOrders 
WHERE RowNumber BETWEEN 10 AND 20;
</code></pre>

<p>or something like this for 2000 and below versions...</p>

<pre><code>SELECT TOP 10 * FROM (SELECT TOP 20 FROM Table ORDER BY Id) ORDER BY Id DESC
</code></pre>
","603746"
"MySQL Like multiple values","183786","","<p>I have this MySQL query.</p>

<p>I have database fields with this contents</p>

<pre><code>sports,shopping,pool,pc,games 
shopping,pool,pc,games 
sports,pub,swimming, pool, pc, games   
</code></pre>

<p>Why does this like query does not work?
I need the fields with either sports or pub or both?</p>

<pre><code>SELECT * FROM table WHERE interests LIKE ('%sports%', '%pub%')
</code></pre>
","<p>The <code>(a,b,c)</code> list only works with <code>in</code>. For <code>like</code>, you have to use <code>or</code>:</p>

<pre><code>WHERE interests LIKE '%sports%' OR interests LIKE '%pub%'
</code></pre>
","4172205"
"Return a value if no rows are found SQL","183668","","<p>Here's my simple query. If I query a record that doesn't exist then I will get nothing returned. I'd prefer that false (0) is returned in that scenario. Looking for the simplist method to account for no records.</p>

<pre><code>SELECT  CASE
            WHEN S.Id IS NOT NULL AND S.Status = 1 AND (S.WebUserId = @WebUserId OR S.AllowUploads = 1) THEN 1
            ELSE 0
        END AS [Value]

        FROM Sites S

        WHERE S.Id = @SiteId
</code></pre>
","<pre><code>SELECT CASE WHEN COUNT(1) &gt; 0 THEN 1 ELSE 0 END AS [Value]

FROM Sites S

WHERE S.Id = @SiteId and S.Status = 1 AND 
      (S.WebUserId = @WebUserId OR S.AllowUploads = 1)
</code></pre>
","2679890"
"How to alter a column and change the default value?","183256","","<p>I got the following error while trying to alter a column's data type and setting a new default value:</p>

<pre><code>ALTER TABLE foobar_data ALTER COLUMN col VARCHAR(255) NOT NULL SET DEFAULT '{}';
</code></pre>

<blockquote>
  <p>ERROR 1064 (42000): You have an error in your SQL syntax; check the
  manual that corresponds to your MySQL server version for the right
  syntax to use near 'VARCHAR(255) NOT NULL SET DEFAULT '{}'' at line 1</p>
</blockquote>
","<pre><code>ALTER TABLE foobar_data MODIFY COLUMN col VARCHAR(255) NOT NULL DEFAULT '{}';
</code></pre>

<p>A second possibility which does the same (thanks to juergen_d):</p>

<pre><code>ALTER TABLE foobar_data CHANGE COLUMN col col VARCHAR(255) NOT NULL DEFAULT '{}';
</code></pre>
","11312469"
"Find a string by searching all tables in SQL Server Management Studio 2008","183015","","<p>Is there any way to search for a string in all tables of a database in SQL Server Management Studio 2008?</p>

<p>I want to search for string say <code>john</code>. The result should show the tables and their respective row that contain <code>john</code>. </p>
","<p>Please try the procedure to search all columns of all tables for a given search string:</p>

<pre><code>CREATE PROC SearchAllTables
(
    @SearchStr nvarchar(100)
)
AS
BEGIN

    CREATE TABLE #Results (ColumnName nvarchar(370), ColumnValue nvarchar(3630))

    SET NOCOUNT ON

    DECLARE @TableName nvarchar(256), @ColumnName nvarchar(128), @SearchStr2 nvarchar(110)
    SET  @TableName = ''
    SET @SearchStr2 = QUOTENAME('%' + @SearchStr + '%','''')

    WHILE @TableName IS NOT NULL

    BEGIN
        SET @ColumnName = ''
        SET @TableName = 
        (
            SELECT MIN(QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME))
            FROM     INFORMATION_SCHEMA.TABLES
            WHERE         TABLE_TYPE = 'BASE TABLE'
                AND    QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME) &gt; @TableName
                AND    OBJECTPROPERTY(
                        OBJECT_ID(
                            QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME)
                             ), 'IsMSShipped'
                               ) = 0
        )

        WHILE (@TableName IS NOT NULL) AND (@ColumnName IS NOT NULL)

        BEGIN
            SET @ColumnName =
            (
                SELECT MIN(QUOTENAME(COLUMN_NAME))
                FROM     INFORMATION_SCHEMA.COLUMNS
                WHERE         TABLE_SCHEMA    = PARSENAME(@TableName, 2)
                    AND    TABLE_NAME    = PARSENAME(@TableName, 1)
                    AND    DATA_TYPE IN ('char', 'varchar', 'nchar', 'nvarchar', 'int', 'decimal')
                    AND    QUOTENAME(COLUMN_NAME) &gt; @ColumnName
            )

            IF @ColumnName IS NOT NULL

            BEGIN
                INSERT INTO #Results
                EXEC
                (
                    'SELECT ''' + @TableName + '.' + @ColumnName + ''', LEFT(' + @ColumnName + ', 3630) 
                    FROM ' + @TableName + ' (NOLOCK) ' +
                    ' WHERE ' + @ColumnName + ' LIKE ' + @SearchStr2
                )
            END
        END    
    END

    SELECT ColumnName, ColumnValue FROM #Results
END
</code></pre>
","15757319"
"SQL: capitalize first letter only","182880","","<p>I need an SQL statement to capitalize the first letter of each word. The other characters have to be lower case.</p>

<p>The words can be like this:</p>

<pre><code>wezembeek-oppem
roeselare
BRUGGE
louvain-la-neuve
</code></pre>

<p>Which would have to be:</p>

<pre><code>Wezembeek-Oppem
Roeselare
Brugge
Louvain-La-Neuve
</code></pre>

<p>This should be with an UPDATE statement, I want to update the data of a column.
Thank you very much for your answers in advance, I'm an SQL novice.</p>
","<p>Are you asking for renaming column itself or capitalise the data inside column? If its data you've to change, then use this:</p>

<pre><code>UPDATE [yourtable]
SET word=UPPER(LEFT(word,1))+LOWER(SUBSTRING(word,2,LEN(word)))
</code></pre>

<p>If you just wanted to change it only for displaying and do not need the actual data in table to change:</p>

<pre><code>SELECT UPPER(LEFT(word,1))+LOWER(SUBSTRING(word,2,LEN(word))) FROM [yourtable]
</code></pre>

<p>Hope this helps.</p>

<p><strong>EDIT: I realised about the '-' so here is my attempt to solve this problem in a function.</strong></p>

<pre><code>CREATE FUNCTION [dbo].[CapitalizeFirstLetter]
(
--string need to format
@string VARCHAR(200)--increase the variable size depending on your needs.
)
RETURNS VARCHAR(200)
AS

BEGIN
--Declare Variables
DECLARE @Index INT,
@ResultString VARCHAR(200)--result string size should equal to the @string variable size
--Initialize the variables
SET @Index = 1
SET @ResultString = ''
--Run the Loop until END of the string

WHILE (@Index &lt;LEN(@string)+1)
BEGIN
IF (@Index = 1)--first letter of the string
BEGIN
--make the first letter capital
SET @ResultString =
@ResultString + UPPER(SUBSTRING(@string, @Index, 1))
SET @Index = @Index+ 1--increase the index
END

-- IF the previous character is space or '-' or next character is '-'

ELSE IF ((SUBSTRING(@string, @Index-1, 1) =' 'or SUBSTRING(@string, @Index-1, 1) ='-' or SUBSTRING(@string, @Index+1, 1) ='-') and @Index+1 &lt;&gt; LEN(@string))
BEGIN
--make the letter capital
SET
@ResultString = @ResultString + UPPER(SUBSTRING(@string,@Index, 1))
SET
@Index = @Index +1--increase the index
END
ELSE-- all others
BEGIN
-- make the letter simple
SET
@ResultString = @ResultString + LOWER(SUBSTRING(@string,@Index, 1))
SET
@Index = @Index +1--incerase the index
END
END--END of the loop

IF (@@ERROR
&lt;&gt; 0)-- any error occur return the sEND string
BEGIN
SET
@ResultString = @string
END
-- IF no error found return the new string
RETURN @ResultString
END
</code></pre>

<p>So then the code would be:</p>

<pre><code>UPDATE [yourtable]
SET word=dbo.CapitalizeFirstLetter([STRING TO GO HERE])
</code></pre>
","15290820"
"How to count instances of character in SQL Column","182790","","<p>I have an sql column that is a string of 100 'Y' or 'N' characters. For example: </p>

<blockquote>
  <p>YYNYNYYNNNYYNY...</p>
</blockquote>

<p>What is the easiest way to get the count of all 'Y' symbols in each row.</p>
","<p>if ms sql</p>

<pre><code>SELECT LEN(REPLACE(myColumn, 'N', '')) FROM ...
</code></pre>
","1860469"
"How to deal with SQL column names that look like SQL keywords?","182348","","<p>One of my columns is called <code>from</code>. I can't change the name because I didn't make it.
Am I allowed to do something like <code>SELECT from FROM TableName</code> or is there a special syntax to avoid the SQL Server being confused?</p>
","<p>Wrap the column name in brackets like so, <code>from</code> becomes [from].</p>

<pre><code>select [from] from table;
</code></pre>

<p>It is also possible to use the following (useful when querying multiple tables):</p>

<pre><code>select table.[from] from table;
</code></pre>
","285777"
"Difference between two dates in MySQL","182225","","<p>How to calculate the difference between two dates, in the format <code>YYYY-MM-DD hh: mm: ss</code> and to get the result value in seconds or milliseconds?</p>
","<pre><code>SELECT TIMEDIFF('2007-12-31 10:02:00','2007-12-30 12:01:01');
-- result: 22:00:59.


SELECT TIMESTAMPDIFF(SECOND,'2007-12-30 12:01:01','2007-12-31 10:02:00'); 
-- result: 79259  the difference in seconds with the time.
</code></pre>
","4760637"
"How to copy a row from one SQL Server table to another","182197","","<p>I have two identical tables and need to copy rows from table to another. What is the best way to do that? (I need to programmatically copy just a few rows, I don't need to use the bulk copy utility).</p>
","<p>As long as there are no identity columns you can just</p>

<pre><code>INSERT Table2
SELECT * FROM Table1
WHERE [Conditions]
</code></pre>
","57188"
"WHERE Clause to find all records in a specific month","182053","","<p>I want to be able to give a stored procedure a Month and Year and have it return everything that happens in that month, how do I do this as I can't compare between as some months have different numbers of days etc?</p>

<p>What's the best way to do this? Can I just ask to compare based on the year and month?</p>

<p>Thanks.</p>
","<p>I think the function you're looking for is <a href=""http://msdn.microsoft.com/en-us/library/ms187813.aspx"" rel=""noreferrer""><code>MONTH(date)</code></a>. You'll probably want to use   <a href=""http://msdn.microsoft.com/en-us/library/ms187813.aspx"" rel=""noreferrer"">'YEAR'</a> too.</p>

<p>Let's assume you have a table named <code>things</code> that looks something like this:</p>

<pre><code>id happend_at
-- ----------------
1  2009-01-01 12:08
2  2009-02-01 12:00
3  2009-01-12 09:40
4  2009-01-29 17:55
</code></pre>

<p>And let's say you want to execute to find all the records that have a <code>happened_at</code> during the month 2009/01 (January 2009). The SQL query would be:</p>

<pre><code>SELECT id FROM things 
   WHERE MONTH(happened_at) = 1 AND YEAR(happened_at) = 2009
</code></pre>

<p>Which would return:</p>

<pre><code>id
---
1
3
4
</code></pre>
","851252"
"Get month name from date in Oracle","181781","","<p>How to fetch month name from a given date in Oracle?</p>

<p>If the given date is <code>'15-11-2010'</code> then I want <code>November</code> from this date.</p>
","<pre><code>select to_char(sysdate, 'Month') from dual
</code></pre>

<p>in your example will be:</p>

<pre><code>select to_char(to_date('15-11-2010', 'DD-MM-YYYY'), 'Month') from dual
</code></pre>
","4497476"
"Error Dropping Database (Can't rmdir '.test\', errno: 17)","181272","","<p>Basically, I was taught on how to create a root password using the ""mysqladmin -u root -p password"" command, this was done all through the windows command editor. Now, the next process was to display the default databases (info. schema, mysql and test) which was achieved by using ""SHOW DATABASES;""</p>

<p>But according to the book, we had to delete the redundant test file and the following error pops up: </p>

<blockquote>
  <p>Error Dropping Database (Can't rmdir '.test\', errno: 17)</p>
</blockquote>

<p>The command put to use was <code>DROP DATABASE test;</code></p>

<p>I am using MYSQL and PHPMYADMIN. Any help on how to drop the file with no errors? </p>
","<p>A database is represented by a directory under the data directory, and the directory is intended for storage of table data.</p>

<p>The <code>DROP DATABASE</code> statement will remove all table files and then remove the directory that represented the database. It will not, however, remove non-table files, whereby making it not possible to remove the directory. </p>

<p>MySQL displays an error message when it cannot remove the directory</p>

<p>you can really drop the database manually by removing any remaining files in the database directory and then the directory itself.</p>
","4584523"
"How SQL query result insert in temp table?","181081","","<p>I have a SQL query (SQL Server) and it generate reports, I want to store that exact report in temp table so I can play with it later. Now question is do I need to create temp table first and then store SQL query result into it, or is there any way to dynamically create table and store query result? </p>
","<p>Look at <a href=""http://msdn.microsoft.com/en-us/library/ms188029.aspx"">SELECT INTO</a>.  This will create a new table for you, which can be temporary if you want by prefixing the table name with a pound sign (#).</p>

<p>For example, you can do:</p>

<pre><code>SELECT * 
INTO #YourTempTable
FROM YourReportQuery
</code></pre>
","12323794"
"How to convert all tables from MyISAM into InnoDB?","180591","","<p>I know I can issue an alter table individually to change the table storage from MyISAM to InnoDB.</p>

<p>I am wondering if there is a way to quickly change all of them to InnoDB?</p>
","<pre><code>&lt;?php
    // connect your database here first 
    // 

    // Actual code starts here 

    $sql = ""SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
        WHERE TABLE_SCHEMA = 'your_database_name' 
        AND ENGINE = 'MyISAM'"";

    $rs = mysql_query($sql);

    while($row = mysql_fetch_array($rs))
    {
        $tbl = $row[0];
        $sql = ""ALTER TABLE `$tbl` ENGINE=INNODB"";
        mysql_query($sql);
    }
?&gt;
</code></pre>
","3857366"
"how to convert date to a format `mm/dd/yyyy`","180415","","<p>I'm having a <code>sql table</code> with date column named <code>CREATED_TS</code> which holds the dates in different format eg. as shown below</p>

<pre><code>Feb 20 2012 12:00AM
11/29/12  8:20:53 PM          
Feb 20 2012 12:00AM
11/29/12  8:20:53 PM          
Feb 20 2012 12:00AM
11/29/12  8:20:53 PM          
Nov 16 2011 12:00AM
Feb 20 2012 12:00AM
11/29/12  8:20:52 PM
</code></pre>

<p>Now I want to convert these to format <code>mm\dd\yyyy</code> before as i am comparing the dates in <code>WHERE</code> clause of my <code>SELECT</code> query. </p>

<p>I tried using</p>

<pre><code>CONVERT(VARCHAR(10),CREATED_TS,101)
</code></pre>

<p>but got the result as,</p>

<pre><code>Feb 20 201
11/29/12  
Feb 20 201
11/29/12  
Feb 20 201
11/29/12  
Nov 16 201
Feb 20 201
11/29/12  
</code></pre>

<p>I need the result as eg. <code>02/20/2012</code> in order to compare.</p>

<p>Any help will be appreciated.</p>
","<p>As your data already in varchar, you have to convert it into date first:</p>

<pre><code>select convert(varchar(10), cast(ts as date), 101) from &lt;your table&gt;
</code></pre>
","18568595"
"How to get first two characters of a string in oracle query?","180380","","<p>Suppose I have a column name <code>OrderNo</code> with value <code>AO025631</code> in a table <code>shipment</code>.</p>

<p>I am trying to query the table so that I can get only first two character of column value i.e. <code>AO</code>.</p>

<p>Can I do this in the SQL query itself?   </p>
","<p><strong><em>SUBSTR</em></strong> <a href=""http://download.oracle.com/docs/cd/B28359_01/olap.111/b28126/dml_functions_2101.htm"" rel=""noreferrer"">(documentation)</a>:</p>

<pre><code>SELECT SUBSTR(OrderNo, 1, 2) As NewColumnName from shipment
</code></pre>

<p>When selected, it's like any other column. You should give it a name (with <code>As</code> keyword), and you can selected other columns in the same statement:</p>

<pre><code>SELECT SUBSTR(OrderNo, 1, 2) As NewColumnName, column2, ... from shipment
</code></pre>
","6225414"
"Warning: Null value is eliminated by an aggregate or other SET operation in Aqua Data Studio","180130","","<p>I have a problem when data is null and the warning has appear when the result is display.
How to solve this problem?. How to change the null data to 0 when no data in the table?.</p>

<p>This is my code:-</p>

<pre><code>SELECT DISTINCT c.username             AS assigner_officer,
                d.description          AS ticketcategory,
                (SELECT Count(closed)
                 FROM   ticket
                 WHERE  assigned_to = c.user_id
                        AND closed IS NOT NULL
                 GROUP  BY assigned_to)closedcases,
                (SELECT Count(closed)
                 FROM   ticket
                 WHERE  assigned_to = c.user_id
                        AND closed IS NULL
                 GROUP  BY assigned_to)opencases
FROM   ticket a
       JOIN ticketlog b
         ON a.ticketid = b.ticketid
       JOIN access c
         ON a.assigned_to = c.user_id
       JOIN ticket_category d
         ON a.cat_code = d.id
       JOIN lookup_department e
         ON a.department_code = e.code 
</code></pre>

<p>The result appear like this:-</p>

<pre><code> Warnings: ---&gt; 
   W (1): Warning: Null value is eliminated by an aggregate or other SET operation.
          &lt;--- 
 assigner_officer     ticketcategory     closedcases     opencases    
 -------------------  -----------------  --------------  ------------ 
 abdulhafiz           Enquiry            (null)          0            
 affan                Enquiry            12              (null)       
 amirul               Enquiry            1               (null)       
 azrul_fahmi          Enquiry            45              0            
 Azwani               Enquiry            (null)          0            
 chai                 Enquiry            4               (null)       
 dalinawati           Enquiry            1               0            
 Emmy                 Complaints         (null)          0            
 Fadhlia              Enquiry            38              0            
 fairulhalif          Others             1               (null)       
 farikh               Enquiry            (null)          0            
 ismailh              Enquiry            28              0            
 izzahanna            Enquiry            (null)          0            
 Kamsuzilawati        Enquiry            1               (null)     
</code></pre>
","<p>You would mostly be using <code>COUNT</code> to summarize over a UID.  Therefore</p>

<p><code>COUNT([uid])</code> will produce the warning:</p>

<blockquote>
  <p>Warning: Null value is eliminated by an aggregate or other SET operation.</p>
</blockquote>

<p>whilst being used with a left join, where the counted object does not exist.</p>

<p>Using <code>COUNT(*)</code> in this case would also render incorrect results, as you would then be counting the total number of results (ie parents) that exist.</p>

<p>Using <code>COUNT([uid])</code> IS a valid way of counting, and the warning is nothing more than a warning.  However if you are concerned, and you want to get a true count of uids in this case then you could use:</p>

<pre><code>SUM(CASE WHEN [uid] IS NULL THEN 0 ELSE 1 END) AS [new_count]
</code></pre>

<p>This would not add a lot of overheads to your query.
(tested mssql 2008)</p>
","14216245"
"How can I get the SQL of a PreparedStatement?","179707","","<p>I have a general Java method with the following method signature:</p>

<pre><code>private static ResultSet runSQLResultSet(String sql, Object... queryParams)
</code></pre>

<p>It opens a connection, builds a <code>PreparedStatement</code> using the sql statement and the parameters in the <code>queryParams</code> variable length array, runs it, caches the <code>ResultSet</code> (in a <code>CachedRowSetImpl</code>), closes the connection, and returns the cached result set.</p>

<p>I have exception handling in the method that logs errors. I log the sql statement as part of the log since it's very helpful for debugging. My problem is that logging the String variable <code>sql</code> logs the template statement with ?'s instead of actual values. I want to log the <em>actual</em> statement that was executed (or tried to execute).</p>

<p>So... Is there any way to get the actual SQL statement that will be run by a <code>PreparedStatement</code>? (<em>Without</em> building it myself. If I can't find a way to access the <code>PreparedStatement's</code> SQL, I'll probably end up building it myself in my <code>catch</code>es.)</p>
","<p>Using prepared statements, there is no ""SQL query"" :</p>

<ul>
<li>You have a statement, containing placeholders

<ul>
<li>it is sent to the DB server</li>
<li>and prepared there</li>
<li>which means the SQL statement is ""analysed"", parsed, some data-structure representing it is prepared in memory</li>
</ul></li>
<li>And, then, you have bound variables

<ul>
<li>which are sent to the server</li>
<li>and the prepared statement is executed -- working on those data</li>
</ul></li>
</ul>

<p>But there is no re-construction of an actual real SQL query -- neither on the Java side, nor on the database side.</p>

<p>So, there is no way to get the prepared statement's SQL -- as there is no such SQL.</p>

<p><br>
For debugging purpose, the solutions are either to :</p>

<ul>
<li>Ouput the code of the statement, with the placeholders and the list of data</li>
<li>Or to ""build"" some SQL query ""by hand"".</li>
</ul>
","2382561"
"Get everything after and before certain character in SQL Server","179458","","<p>I got the following entry in my database:</p>

<pre><code>images/test.jpg
</code></pre>

<p>I want to trim the entry so I get: <code>test</code></p>

<p>So basically, I want everything after <code>/</code> and before <code>.</code></p>

<p>How can I solve it?</p>
","<p>If you want to get this out of your table using SQL, take a look at the following functions that will help you: <a href=""http://msdn.microsoft.com/en-us/library/ms187748.aspx"" rel=""noreferrer""><code>SUBSTRING</code></a> and <a href=""http://msdn.microsoft.com/en-us/library/ms186323.aspx"" rel=""noreferrer""><code>CHARINDEX</code></a>. You can use those to trim your entries.</p>

<p>A possible query will look like this (where <code>col</code> is the name of the column that contains your image directories:  </p>

<pre><code>SELECT SUBSTRING(col, LEN(SUBSTRING(col, 0, LEN(col) - CHARINDEX ('/', col))) + 1, LEN(col) - LEN(SUBSTRING(col, 0, LEN(col) - CHARINDEX ('/', col))) - LEN(SUBSTRING(col, CHARINDEX ('.', col), LEN(col))));
</code></pre>

<p>Bit of an ugly beast. It also depends on the standard format of 'dir/name.ext'.</p>

<p><strong>Edit:</strong><br>
This one (inspired by <a href=""https://stackoverflow.com/users/1134928"">praveen</a>) is more generic and deals with extensions of different length:</p>

<pre><code>SELECT SUBSTRING(col, LEN(LEFT(col, CHARINDEX ('/', col))) + 1, LEN(col) - LEN(LEFT(col, CHARINDEX ('/', col))) - LEN(RIGHT(col, LEN(col) - CHARINDEX ('.', col))) - 1);
</code></pre>
","11010539"
"Select something that has more/less than x character","179044","","<p>Was wondering if it's possible to select something that has more/less than x characters in SQL.</p>

<p>For example, I have an employee table and I want to show all employee names that has more than 4 characters in their name.</p>

<p>Here's an example table</p>

<pre><code>ID EmpName Dept
1  Johnny  ACC
2  Dan     IT
3  Amriel  PR
4  Amy     HR
</code></pre>
","<p>If you are using SQL Server, Use the <code>LEN</code> (Length) function:</p>

<pre><code>SELECT EmployeeName FROM EmployeeTable WHERE LEN(EmployeeName) &gt; 4
</code></pre>

<p>MSDN for it states:</p>

<blockquote>
  <p>Returns the number of characters of the specified string expression,<br>
  excluding trailing blanks.</p>
</blockquote>

<p><a href=""http://msdn.microsoft.com/en-us/library/ms190329.aspx"" rel=""nofollow noreferrer"">Here's the link to the MSDN</a></p>

<p>For oracle/plsql you can use <code>Length()</code>, mysql also uses Length.</p>

<p>Here is the Oracle documentation:</p>

<p><a href=""http://www.techonthenet.com/oracle/functions/length.php"" rel=""nofollow noreferrer"">http://www.techonthenet.com/oracle/functions/length.php</a></p>

<p>And here is the mySQL Documentation of <code>Length(string)</code>:</p>

<p><a href=""http://dev.mysql.com/doc/refman/5.1/en/string-functions.html#function_length"" rel=""nofollow noreferrer"">http://dev.mysql.com/doc/refman/5.1/en/string-functions.html#function_length</a></p>

<p>For PostgreSQL, you can use <code>length(string)</code> or <code>char_length(string)</code>. Here is the PostgreSQL documentation:</p>

<p><a href=""http://www.postgresql.org/docs/9.0/interactive/functions-string.html#FUNCTIONS-STRING-SQL"" rel=""nofollow noreferrer"">http://www.postgresql.org/docs/9.0/interactive/functions-string.html#FUNCTIONS-STRING-SQL</a></p>
","8509736"
"How can multiple rows be concatenated into one in Oracle without creating a stored procedure?","179020","","<p>How can I achieve the following in oracle without creating a stored procedure?</p>

<p>Data Set:</p>

<pre><code>question_id    element_id
1              7
1              8
2              9
3              10
3              11
3              12
</code></pre>

<p>Desired Result:</p>

<pre><code>question_id    element_id
1              7,8
2              9
3              10,11,12
</code></pre>
","<p>There are many way to do the string aggregation, but the easiest is a user defined function.  <a href=""http://www.oracle-base.com/articles/10g/StringAggregationTechniques.php"" rel=""noreferrer"">Try this for a way that does not require a function.</a>  As a note, there is no simple way without the function.</p>

<p>This is the shortest route without a custom function: (it uses the ROW_NUMBER() and SYS_CONNECT_BY_PATH functions )</p>

<pre><code>SELECT questionid,
       LTRIM(MAX(SYS_CONNECT_BY_PATH(elementid,','))
       KEEP (DENSE_RANK LAST ORDER BY curr),',') AS elements
FROM   (SELECT questionid,
               elementid,
               ROW_NUMBER() OVER (PARTITION BY questionid ORDER BY elementid) AS curr,
               ROW_NUMBER() OVER (PARTITION BY questionid ORDER BY elementid) -1 AS prev
        FROM   emp)
GROUP BY questionid
CONNECT BY prev = PRIOR curr AND questionid = PRIOR questionid
START WITH curr = 1;
</code></pre>
","1076075"
"SQL Query - Using Order By in UNION","178947","","<p>How can one programmatically sort a union query when pulling data from two tables? For example,</p>

<pre><code>SELECT table1.field1 FROM table1 ORDER BY table1.field1
UNION
SELECT table2.field1 FROM table2 ORDER BY table2.field1
</code></pre>

<p>Throws an exception</p>

<p>Note: this is being attempted on MS Access Jet database engine</p>
","<p>Sometimes you need to have the <code>ORDER BY</code> in each of the sections that need to be combined with <code>UNION</code>.</p>

<p>In this case</p>

<pre><code>SELECT * FROM 
(
  SELECT table1.field1 FROM table1 ORDER BY table1.field1
) DUMMY_ALIAS1

UNION ALL

SELECT * FROM
( 
  SELECT table2.field1 FROM table2 ORDER BY table2.field1
) DUMMY_ALIAS2
</code></pre>
","3394454"
"How do I change db schema to dbo","178935","","<p>I imported a bunch of tables from an old sql server (2000) to my 2008 database.  All the imported tables are prefixed with my username, for example: <code>jonathan.MovieData</code>.  In the table <code>properties</code> it lists <code>jonathan</code> as the db schema.  When I write stored procedures I now have to include <code>jonathan.</code> in front of all the table names which is confusing.</p>

<p>How do I change all my tables to be dbo instead of jonathan?</p>

<p>Current result: <code>jonathan.MovieData</code></p>

<p>Desired result: <code>dbo.MovieData</code></p>
","<pre><code>ALTER SCHEMA dbo TRANSFER jonathan.MovieData;
</code></pre>

<p>See <a href=""http://msdn.microsoft.com/en-us/library/ms173423.aspx"" rel=""noreferrer"">ALTER SCHEMA</a>.</p>

<p><strong>Generalized Syntax:</strong>  </p>

<pre><code>ALTER SCHEMA TargetSchema TRANSFER SourceSchema.TableName; 
</code></pre>
","1146635"
"Saving changes after table edit in SQL Server Management Studio","178894","","<p>If I want to save any changes in a table, previously saved in SQL Server Management Studio (no data in table present) I get an error message:</p>

<blockquote>
  <p>Saving changes is not permitted. The changes you have made require the
  following tables to be dropped and re-created. You have either made
  changes to a table that can't be re-created or enabled the option
  Prevent saving changes that require the table to be re-created.</p>
</blockquote>

<p>What can prevent the table to be easily edited? Or, is it the usual way for SQL Server Management Studio to require re-creating table for editing? What is it - this <strong>""option Prevent saving changes""</strong>?</p>
","<p>Go into Tools -> Options -> Designers-> Uncheck ""Prevent saving changes that require table re-creation"". Voila.</p>

<p>That happens because sometimes it is necessary to drop and recreate a table in order to change something. This can take a while, since all data must be copied to a temp table and then re-inserted in the new table. Since SQL Server by default doesn't trust you, you need to say ""OK, I know what I'm doing, now let me do my work.""</p>
","1969110"
"How to select the last record from MySQL table using SQL syntax","178775","","<p>I have a table with several records. There is an id field. I would like to select the record with the most recent id (i.e. the highest id).</p>

<p>Any ideas?</p>
","<pre><code>SELECT * 
FROM table_name
ORDER BY id DESC
LIMIT 1
</code></pre>
","2659261"
"SUM of grouped COUNT in SQL Query","178258","","<p>I have a table with 2 fields:</p>

<pre>
ID  Name
--  -------
1   Alpha
2   Beta
3   Beta
4   Beta
5   Charlie
6   Charlie
</pre>

<p>I want to group them by name, with 'count', and a row 'SUM'</p>

<pre>
Name     Count
-------  -----
Alpha     1
Beta      3
Charlie   2
<b>SUM       6</b>
</pre>

<p>How would I write a query to add SUM row below the table?
</p>
","<pre><code>SELECT name, COUNT(name) AS count
FROM table
GROUP BY name

UNION ALL

SELECT 'SUM' name, COUNT(name)
FROM table
</code></pre>

<p><strong>OUTPUT:</strong></p>

<pre><code>name                                               count
-------------------------------------------------- -----------
alpha                                              1
beta                                               3
Charlie                                            2
SUM                                                6
</code></pre>
","12927334"
"How to use DISTINCT and ORDER BY in same SELECT statement?","178253","","<p>After executing the following statement:</p>

<pre><code>SELECT  Category  FROM MonitoringJob ORDER BY CreationDate DESC
</code></pre>

<p>I am getting the following values from the database:</p>

<pre><code>test3
test3
bildung
test4
test3
test2
test1
</code></pre>

<p>but I want the duplicates removed, like this:</p>

<pre><code>bildung
test4
test3
test2
test1
</code></pre>

<p>I tried to use DISTINCT but it doesn't work with ORDER BY in one statement. Please help.</p>

<p>Important:</p>

<ol>
<li><p>I tried it with:</p>

<pre><code>SELECT DISTINCT Category FROM MonitoringJob ORDER BY CreationDate DESC
</code></pre>

<p>it doesn't work.</p></li>
<li><p>Order by CreationDate is very important.</p></li>
</ol>
","<p>The problem is that the columns used in the <code>ORDER BY</code> aren't specified in the <code>DISTINCT</code>. To do this, you need to use an <a href=""https://msdn.microsoft.com/nl-nl/library/ms173454(v=sql.110).aspx"" rel=""nofollow noreferrer"">aggregate function</a> to sort on, and use a <code>GROUP BY</code> to make the <code>DISTINCT</code> work.</p>

<p>Try something like this:</p>

<pre><code>SELECT DISTINCT Category, MAX(CreationDate) 
FROM MonitoringJob 
GROUP BY Category 
ORDER BY MAX(CreationDate) DESC, Category
</code></pre>
","5391642"
"SQL Server 2005 How Create a Unique Constraint?","178178","","<p>How do I create a unique constraint on an existing table in SQL Server 2005?</p>

<p>I am looking for both the TSQL and how to do it in the Database Diagram.</p>
","<p>The SQL command is:</p>

<pre><code>ALTER TABLE &lt;tablename&gt; ADD CONSTRAINT
            &lt;constraintname&gt; UNIQUE NONCLUSTERED
    (
                &lt;columnname&gt;
    )
</code></pre>

<p>See the full syntax <a href=""http://msdn.microsoft.com/en-us/library/ms190273.aspx"" rel=""noreferrer"">here</a>.</p>

<p>If you want to do it from a Database Diagram:</p>

<ul>
<li>right-click on the table and select 'Indexes/Keys'</li>
<li>click the Add button to add a new index</li>
<li>enter the necessary info in the Properties on the right hand side:

<ul>
<li>the columns you want (click the ellipsis button to select)</li>
<li>set Is Unique to Yes</li>
<li>give it an appropriate name</li>
</ul></li>
</ul>
","65123"
"'NOT LIKE' in an SQL query","178049","","<p>Why does this simple query return 'ORA-00936: missing expression' (the database is Oracle as you can tell):</p>

<pre><code>SELECT * FROM transactions WHERE id NOT LIKE '1%' AND NOT LIKE '2%'
</code></pre>

<p>I feel silly, but what am I doing wrong?</p>
","<p>You have missed out the field name <code>id</code> in the second <code>NOT LIKE</code>. Try:</p>

<pre><code>SELECT * FROM transactions WHERE id NOT LIKE '1%' AND id NOT LIKE '2%'
</code></pre>

<p>The <code>AND</code> in the where clause joins 2 full condition expressions such as <code>id NOT LIKE '1%'</code> and can't be used to list multiple values that the id is 'not like'.</p>
","1762716"
"How to Query Database Name in Oracle SQL Developer?","177476","","<p>How do I query the database name in Oracle SQL Developer? I have tried the following and they all fail:</p>

<p><code>SELECT DB_NAME();</code></p>

<p><code>SELECT DATABASE();</code></p>

<p>Why do these basic MySQL queries fail in SQL Developer? Even this one fails too:</p>

<p><code>show tables;</code></p>

<p><strong>EDIT:</strong> I can connect to the database and run queries such as:</p>

<p><code>select * from table_name_here;</code></p>

<p><strong>EDIT 2:</strong> The database type is <code>Oracle</code>, this is why <code>MySQL</code> queries are failing. I thought it was related to the database client not the database itself. I was wrong. I'll leave the question as is for other as lost as I was.</p>
","<p>Once I realized I was running an Oracle database, not MySQL, I found the answer</p>

<p><code>select * from v$database;</code></p>

<p>or</p>

<p><code>select ora_database_name from dual;</code></p>

<p>Try both. Credit and source goes to: <a href=""http://www.perlmonks.org/?node_id=520376"" rel=""noreferrer"">http://www.perlmonks.org/?node_id=520376</a>.</p>
","8988175"
"How do you get the ""week start date"" and ""week end date"" from week number in SQL Server?","177312","","<p>I have a query that counts member's wedding dates in the database...</p>

<pre><code>Select 
  Sum(NumberOfBrides) As [Wedding Count], 
  DATEPART( wk, WeddingDate) as [Week Number],
  DATEPART( year, WeddingDate) as [Year]
FROM  MemberWeddingDates
Group By DATEPART( year, WeddingDate), DATEPART( wk, WeddingDate)
Order By Sum(NumberOfBrides) Desc
</code></pre>

<p>How do I work out when the start and end of each week represented in the result set?</p>

<pre><code>Select 
      Sum(NumberOfBrides) As [Wedding Count], 
      DATEPART( wk, WeddingDate) as [Week Number],
      DATEPART( year, WeddingDate) as [Year],
      ??? as WeekStart,
      ??? as WeekEnd

    FROM  MemberWeddingDates
    Group By DATEPART( year, WeddingDate), DATEPART( wk, WeddingDate)
    Order By Sum(NumberOfBrides) Desc
</code></pre>
","<p>You can find the day of week and do a date add on days to get the start and end dates..</p>

<pre><code>DATEADD(dd, -(DATEPART(dw, WeddingDate)-1), WeddingDate) [WeekStart]

DATEADD(dd, 7-(DATEPART(dw, WeddingDate)), WeddingDate) [WeekEnd]
</code></pre>

<p>You probably also want to look at stripping off the time from the date as well though.</p>
","1267176"
"How can I define a composite primary key in SQL?","176765","","<p>How can I define a composite primary key consisting of two fields in SQL?</p>

<p>I am using PHP to create tables and everything. I want to make a table name <code>voting</code> with fields <code>QuestionID</code>, <code>MemeberID</code>, and <code>vote</code>. And the Composite primary key consists of the fields <code>QuestionID</code> and <code>MemberID</code>. </p>

<p>How should I do this?</p>
","<p>Just for clarification: a table can have at most one primary key. A primary key consists of one or more columns (from that table). If a primary key consists of two or more columns it is called a <strong>composite primary key</strong>. It is defined as follows:</p>

<pre><code>CREATE TABLE voting (
  QuestionID NUMERIC,
  MemberID NUMERIC,
  PRIMARY KEY (QuestionID, MemberID)
);
</code></pre>

<p>The pair (QuestionID,MemberID) must then be unique for the table and neither value can be NULL. If you do a query like this:</p>

<pre><code>SELECT * FROM voting WHERE QuestionID = 7
</code></pre>

<p>it will use the primary key's index. If however you do this:</p>

<pre><code>SELECT * FROM voting WHERE MemberID = 7
</code></pre>

<p>it won't because to use a composite index requires using all the keys from the ""left"". If an index is on fields (A,B,C) and your criteria is on B and C then that index is of no use to you for that query. So choose from (QuestionID,MemberID) and (MemberID,QuestionID) whichever is most appropriate for how you will use the table.</p>

<p>If necessary, add an index on the other:</p>

<pre><code>CREATE UNIQUE INDEX idx1 ON voting (MemberID, QuestionID);
</code></pre>
","1110364"
"How to declare a variable in a PostgreSQL query","176743","","<p>How do I declare a variable for use in a PostgreSQL 8.3 query?</p>

<p>In MS SQL Server I can do this:</p>

<pre><code>DECLARE @myvar INT
SET @myvar = 5

SELECT *
FROM somewhere
WHERE something = @myvar
</code></pre>

<p>How do I do the same in PostgreSQL? According to the documentation variables are declared simply as ""name type;"", but this gives me a syntax error:</p>

<pre><code>myvar INTEGER;
</code></pre>

<p>Could someone give me an example of the correct syntax?</p>
","<p>There is no such feature in PostgreSQL. You can do it only in pl/PgSQL (or other pl/*), but not in plain SQL.</p>
","1491329"
"How to create an Oracle sequence starting with max value from a table?","176735","","<p>Trying to create a sequence in Oracle that starts with the max value from a specific table. Why does this not work?</p>

<pre><code>CREATE SEQUENCE transaction_sequence
  MINVALUE 0
  START WITH (SELECT MAX(trans_seq_no)
     FROM TRANSACTION_LOG) 
  INCREMENT BY 1
  CACHE 20;
</code></pre>
","<p>you might want to start with <code>max(trans_seq_no) + 1.</code></p>

<p>watch:</p>

<pre><code>SQL&gt; create table my_numbers(my_number number not null primary key);

Table created.

SQL&gt; insert into my_numbers(select rownum from user_objects);

260 rows created.

SQL&gt; select max(my_number) from my_numbers;

MAX(MY_NUMBER)
--------------
           260

SQL&gt; create sequence my_number_sn start with 260;

Sequence created.

SQL&gt; insert into my_numbers(my_number) values (my_number_sn.NEXTVAL);
insert into my_numbers(my_number) values (my_number_sn.NEXTVAL)
*
ERROR at line 1:
ORA-00001: unique constraint (NEIL.SYS_C00102439) violated
</code></pre>

<p>When you create a sequence with a number, you have to remember that the first time you select against the sequence, Oracle will return the initial value that you assigned it.</p>

<pre><code>SQL&gt; drop sequence my_number_sn;

Sequence dropped.

SQL&gt; create sequence my_number_sn start with 261;

Sequence created.

SQL&gt;  insert into my_numbers(my_number) values (my_number_sn.NEXTVAL);

1 row created.
</code></pre>

<p>If you're trying to do the 'gapless' thing, I strongly advise you to </p>

<h1>1 not do it, and #2 not use a sequence for it.</h1>
","798932"
"How to enter special characters like ""&"" in oracle database?","176564","","<p>I want to insert special character <code>&amp;</code> in my insert statement. My insert is:</p>

<pre><code>INSERT INTO STUDENT(name, class_id) VALUES ('Samantha', 'Java_22 &amp; Oracle_14');
</code></pre>

<p>If I try to run this query I am getting a popup and it asks me to enter value for <code>Oracle_14</code>. </p>

<p>How can I enter special characters like <code>&amp;</code> in the insert statement for oracle db?</p>
","<p>If you are in SQL*Plus or SQL Developer, you want to run</p>

<pre><code>SQL&gt; set define off;
</code></pre>

<p>before executing the SQL statement.  That turns of the checking for substitution variables.</p>

<p>SET directives like this are instructions for the client tool (SQL*Plus or SQL Developer).  They have session scope, so you would have to issue the directive every time you connect (you can put the directive in your client machine's glogin.sql if you want to change the default to have DEFINE set to OFF).  There is no risk that you would impact any other user or session in the database.</p>
","4175452"
"Oracle SQL : timestamps in where clause","176054","","<p>I need to look up rows falling under the particular time frame.</p>

<pre><code>select * 
from TableA 
where startdate &gt;= '12-01-2012 21:24:00' 
  and startdate &lt;= '12-01-2012 21:25:33'
</code></pre>

<p>i.e. look up rows with timestamp precision of seconds, how do I achieve this?</p>
","<p>You need to use to_timestamp() to convert your string to a proper timestamp value:</p>

<pre><code>to_timestamp('12-01-2012 21:24:00', 'dd-mm-yyyy hh24:mi:ss')
</code></pre>

<p>If your column is of type <code>DATE</code> (which also supports seconds), you need to use to_date()</p>

<pre><code>to_date('12-01-2012 21:24:00', 'dd-mm-yyyy hh24:mi:ss')
</code></pre>

<p>To get this into a where condition use the following:</p>

<pre><code>select * 
from TableA 
where startdate &gt;= to_timestamp('12-01-2012 21:24:00', 'dd-mm-yyyy hh24:mi:ss')
  and startdate &lt;= to_timestamp('12-01-2012 21:25:33', 'dd-mm-yyyy hh24:mi:ss')
</code></pre>

<p>You never need to use <code>to_timestamp()</code> on a column that is of type `timestamp'</p>

<p><em>Edit corrected typo</em></p>
","8855484"
"How to convert DataSet to DataTable","175720","","<p>I am retrieving data from a SQL table so I can display the result on the page as a HTML table. Later I need to be able to save that table as a CSV file. </p>

<p>So far I have figured out how to retrieve the data and fill them in a dataset for display purpose (which is working perfectly)...</p>

<pre><code>        string selectQuery = ""SELECT Name, ProductNumber, ListPrice FROM Poduction.Product"";

        // Establish the connection to the SQL database 
        SqlConnection conn = ConnectionManager.GetConnection();
        conn.Open();

        // Connect to the SQL database using the above query to get all the data from table.
        SqlDataAdapter myCommand = new SqlDataAdapter(selectQuery, conn);

        // Create and fill a DataSet.
        DataSet ds = new DataSet();
        myCommand.Fill(ds);
</code></pre>

<p>and how to save them in a CSV file with the help of following code from: <a href=""http://www.evontech.com/login/topic/1983.html"" rel=""nofollow noreferrer"">http://www.evontech.com/login/topic/1983.html</a></p>

<pre><code>    private void exportDataTableToCsv(DataTable formattedDataTable, string filename)
    {
       DataTable toExcel = formattedDataTable.Copy();
       HttpContext context = HttpContext.Current;
       context.Response.Clear();

       foreach (DataColumn column in toExcel.Columns)
       {
          context.Response.Write(column.ColumnName + "","");
       }

       context.Response.Write(Environment.NewLine);
       foreach (DataRow row in toExcel.Rows)
       {
          for (int i = 0; i &lt; toExcel.Columns.Count; i++)
          {
             context.Response.Write(row.ToString().Replace("","", string.Empty) + "","");
          }

          context.Response.Write(Environment.NewLine);
       }

       context.Response.ContentType = ""text/csv"";
       context.Response.AppendHeader(""Content-Disposition"", ""attachment; filename="" + filename + "".csv"");
       context.Response.End();
    }
</code></pre>

<p>Now my problem is how do I convert this <code>DataSet</code> to <code>DataTable</code>? I have tried the way described here with <strong>NO</strong> luck: <a href=""http://www.ezineasp.net/post/ASP-Net-C-sharp-Convert-DataSet-to-DataTable.aspx"" rel=""nofollow noreferrer"">http://www.ezineasp.net/post/ASP-Net-C-sharp-Convert-DataSet-to-DataTable.aspx</a></p>

<p>Can anyone help me?</p>
","<p>A <code>DataSet</code> already <em>contains</em> <code>DataTables</code>. You can just use:</p>

<pre><code>DataTable firstTable = dataSet.Tables[0];
</code></pre>

<p>or by name:</p>

<pre><code>DataTable customerTable = dataSet.Tables[""Customer""];
</code></pre>

<p>Note that you should have <code>using</code> statements for your SQL code, to ensure the connection is disposed properly:</p>

<pre><code>using (SqlConnection conn = ...)
{
    // Code here...
}
</code></pre>
","8983284"
"SQL DELETE with JOIN another table for WHERE condition","175641","","<p>I have to delete rows from <code>guide_category</code> that have no relation with <code>guide</code> table (dead relations).</p>

<p>Here is what I want to do, but it of course does not work.</p>

<pre><code>DELETE FROM guide_category AS pgc 
 WHERE pgc.id_guide_category IN (SELECT id_guide_category 
                                   FROM guide_category AS gc
                              LEFT JOIN guide AS g ON g.id_guide = gc.id_guide
                                  WHERE g.title IS NULL)
</code></pre>

<p>Error:  </p>

<blockquote>
  <p>You can't specify target table 'guide_category' for update in FROM clause</p>
</blockquote>
","<p>Due to the locking implementation issues, <code>MySQL</code> does not allow referencing the affected table with <code>DELETE</code> or <code>UPDATE</code>.</p>

<p>You need to make a <code>JOIN</code> here instead:</p>

<pre><code>DELETE  gc.*
FROM    guide_category AS gc 
LEFT JOIN
        guide AS g 
ON      g.id_guide = gc.id_guide
WHERE   g.title IS NULL
</code></pre>

<p>or just use a <code>NOT IN</code>:</p>

<pre><code>DELETE  
FROM    guide_category AS gc 
WHERE   id_guide NOT IN
        (
        SELECT  id_guide
        FROM    guide
        )
</code></pre>
","1980762"
"SQL SERVER DATETIME FORMAT","175540","","<p>Studying SQL Server there is something I am not sure of:</p>

<p>A <code>datetime</code> field with the value:
<code>2012-02-26 09:34:00.000</code></p>

<p>If I select out of the table using:</p>

<pre><code>CAST(dob2 AS VARCHAR(12) ) AS d1
</code></pre>

<p>It formats it as:
<code>Feb 26 2012</code></p>

<p>What I am unsure of his how or why SQL Server formats DateTime like that. If you use <code>datetime2</code> it does not - anyone know why?</p>
","<p>The default date format depends on the language setting for the database server.  You can also <a href=""http://msdn.microsoft.com/en-us/library/ms174398.aspx"" rel=""noreferrer"">change it per session</a>, like:</p>

<pre><code>set language french
select cast(getdate() as varchar(50))
--&gt;
févr 8 2013 9:45AM
</code></pre>
","14769762"
"How do I delete from multiple tables using INNER JOIN in SQL server","175483","","<p>In MySQL you can use the syntax</p>

<pre><code>DELETE t1,t2 
FROM table1 AS t1 
INNER JOIN table2 t2 ...
INNER JOIN table3 t3 ...
</code></pre>

<p>How do I do the same thing in SQL Server?</p>
","<p>You can take advantage of the ""deleted"" pseudo table in this example. Something like:</p>

<pre><code>begin transaction;

   declare @deletedIds table ( id int );

   delete t1
   output deleted.id into @deletedIds
   from table1 t1
    join table2 t2
      on t2.id = t1.id
    join table3 t3
      on t3.id = t2.id;

   delete t2
   from table2 t2
    join @deletedIds d
      on d.id = t2.id;

   delete t3
   from table3 t3 ...

commit transaction;
</code></pre>

<p>Obviously you can do an 'output deleted.' on the second delete as well, if you needed something to join on for the third table.</p>

<p>As a side note, you can also do inserted.* on an insert statement, and both inserted.* and deleted.* on an update statement.</p>

<p><strong>EDIT:</strong>
Also, have you considered adding a trigger on table1 to delete from table2 + 3? You'll be inside of an implicit transaction, and will also have the ""inserted.<em>"" and ""deleted.</em>"" pseudo-tables available.</p>
","809892"
"Convert varchar to uniqueidentifier in SQL Server","175444","","<p>A table I have no control of the schema for, contains a column defined as varchar(50) which stores uniqueidentifiers in the format 'a89b1acd95016ae6b9c8aabb07da2010' (no hyphens)</p>

<p>I want to convert these to uniqueidentifiers in SQL for passing to a .Net Guid. However, the following query lines don't work for me:</p>

<pre><code>select cast('a89b1acd95016ae6b9c8aabb07da2010' as uniqueidentifier)
select convert(uniqueidentifier, 'a89b1acd95016ae6b9c8aabb07da2010')
</code></pre>

<p>and result in:</p>

<pre>Msg 8169, Level 16, State 2, Line 1
Conversion failed when converting from a character string to uniqueidentifier.</pre>

<p>The same queries using a hyphenated uniqueidentifier work fine but the data is not stored in that format.</p>

<p>Is there another (efficient) way to convert these strings to uniqueidentifiers in SQL. -- I don't want to do it in the .Net code.</p>
","<pre><code>DECLARE @uuid VARCHAR(50)
SET @uuid = 'a89b1acd95016ae6b9c8aabb07da2010'
SELECT  CAST(
        SUBSTRING(@uuid, 1, 8) + '-' + SUBSTRING(@uuid, 9, 4) + '-' + SUBSTRING(@uuid, 13, 4) + '-' +
        SUBSTRING(@uuid, 17, 4) + '-' + SUBSTRING(@uuid, 21, 12)
        AS UNIQUEIDENTIFIER)
</code></pre>
","1390129"
"mysql :: insert into table, data from another table?","175186","","<p>I was wondering if there is a way to do this purely in sql:</p>

<pre><code>q1 = SELECT campaign_id, from_number, received_msg, date_received 
     FROM `received_txts` WHERE `campaign_id` = '8';
INSERT INTO action_2_members (campaign_id, mobile, vote, vote_date)    
    VALUES(q1.campaign_id, q1.from_number, q1.received_msg, q1.date_received);
</code></pre>

<p><strong>Note: </strong>q1 would return about 30k rows.</p>

<p>Is there any way to do what I am attempting above in straight sql?
To just pull the data straight from one table (basically a raw data table) and insert into another table (basically a processed data table)?</p>
","<pre><code>INSERT INTO action_2_members (campaign_id, mobile, vote, vote_date)  
SELECT campaign_id, from_number, received_msg, date_received
  FROM `received_txts`
 WHERE `campaign_id` = '8'
</code></pre>
","4241646"
"Search an Oracle database for tables with specific column names?","174452","","<p>We have a large Oracle database with many tables.  Is there a way I can query or search to find if there are any tables with certain column names?</p>

<p>IE show me all tables that have the columns: <code>id, fname, lname, address</code></p>

<p>Detail I forgot to add: I need to be able to search through different schemas.  The one I must use to connect doesn't own the tables I need to search through.</p>
","<p>To find all tables with a particular column:</p>

<pre><code>select owner, table_name from all_tab_columns where column_name = 'ID';
</code></pre>

<p>To find tables that have any or all of the 4 columns:</p>

<pre><code>select owner, table_name, column_name
from all_tab_columns
where column_name in ('ID', 'FNAME', 'LNAME', 'ADDRESS');
</code></pre>

<p>To find tables that have all 4 columns (with none missing):</p>

<pre><code>select owner, table_name
from all_tab_columns
where column_name in ('ID', 'FNAME', 'LNAME', 'ADDRESS')
group by owner, table_name
having count(*) = 4;
</code></pre>
","1953311"
"Multi-statement Table Valued Function vs Inline Table Valued Function","174275","","<p>A few examples to show, just incase:</p>

<p><em>Inline Table Valued</em></p>

<pre><code>CREATE FUNCTION MyNS.GetUnshippedOrders()
RETURNS TABLE
AS 
RETURN SELECT a.SaleId, a.CustomerID, b.Qty
    FROM Sales.Sales a INNER JOIN Sales.SaleDetail b
        ON a.SaleId = b.SaleId
        INNER JOIN Production.Product c ON b.ProductID = c.ProductID
    WHERE a.ShipDate IS NULL
GO
</code></pre>

<p><em>Multi Statement Table Valued</em></p>

<pre><code>CREATE FUNCTION MyNS.GetLastShipped(@CustomerID INT)
RETURNS @CustomerOrder TABLE
(SaleOrderID    INT         NOT NULL,
CustomerID      INT         NOT NULL,
OrderDate       DATETIME    NOT NULL,
OrderQty        INT         NOT NULL)
AS
BEGIN
    DECLARE @MaxDate DATETIME

    SELECT @MaxDate = MAX(OrderDate)
    FROM Sales.SalesOrderHeader
    WHERE CustomerID = @CustomerID

    INSERT @CustomerOrder
    SELECT a.SalesOrderID, a.CustomerID, a.OrderDate, b.OrderQty
    FROM Sales.SalesOrderHeader a INNER JOIN Sales.SalesOrderHeader b
        ON a.SalesOrderID = b.SalesOrderID
        INNER JOIN Production.Product c ON b.ProductID = c.ProductID
    WHERE a.OrderDate = @MaxDate
        AND a.CustomerID = @CustomerID
    RETURN
END
GO
</code></pre>

<p>Is there an advantage to using one type (in-line or multi statement) over the other? Is there certain scenarios when one is better than the other or are the differences purely syntactical? I realise the two example queries are doing different things but is there a reason I would write them in that way?</p>

<p>Reading about them and the advantages/differences haven't really been explained.</p>
","<p>In researching Matt's comment, I have revised my original statement. He is correct, there will be a difference in performance between an inline table valued function (ITVF) and a multi-statement table valued function (MSTVF) even if they both simply execute a SELECT statement. SQL Server will treat an ITVF somewhat like a <code>VIEW</code> in that it will calculate an execution plan using the latest statistics on the tables in question. A MSTVF is equivalent to stuffing the entire contents of your SELECT statement into a table variable and then joining to that. Thus, the compiler cannot use any table statistics on the tables in the MSTVF. So, all things being equal, (which they rarely are), the ITVF will perform better than the MSTVF. In my tests, the performance difference in completion time was negligible however from a statistics standpoint, it was noticeable.</p>

<p>In your case, the two functions are not functionally equivalent. The MSTV function does an extra query each time it is called and, most importantly, filters on the customer id. In a large query, the optimizer would not be able to take advantage of other types of joins as it would need to call the function for each customerId passed. However, if you re-wrote your MSTV function like so:</p>

<pre><code>CREATE FUNCTION MyNS.GetLastShipped()
RETURNS @CustomerOrder TABLE
    (
    SaleOrderID    INT         NOT NULL,
    CustomerID      INT         NOT NULL,
    OrderDate       DATETIME    NOT NULL,
    OrderQty        INT         NOT NULL
    )
AS
BEGIN
    INSERT @CustomerOrder
    SELECT a.SalesOrderID, a.CustomerID, a.OrderDate, b.OrderQty
    FROM Sales.SalesOrderHeader a 
        INNER JOIN Sales.SalesOrderHeader b
            ON a.SalesOrderID = b.SalesOrderID
        INNER JOIN Production.Product c 
            ON b.ProductID = c.ProductID
    WHERE a.OrderDate = (
                        Select Max(SH1.OrderDate)
                        FROM Sales.SalesOrderHeader As SH1
                        WHERE SH1.CustomerID = A.CustomerId
                        )
    RETURN
END
GO
</code></pre>

<p>In a query, the optimizer would be able to call that function once and build a better execution plan but it still would not be better than an equivalent, non-parameterized ITVS or a <code>VIEW</code>.</p>

<p>ITVFs should be preferred over a MSTVFs when feasible because the datatypes, nullability and collation from the columns in the table whereas you declare those properties in a multi-statement table valued function and, importantly, you will get better execution plans from the ITVF. In my experience, I have not found many circumstances where an ITVF was a better option than a VIEW but mileage may vary.</p>

<p>Thanks to Matt.</p>

<p><strong>Addition</strong> </p>

<p>Since I saw this come up recently, here is an excellent analysis done by Wayne Sheffield comparing the performance difference between Inline Table Valued functions and Multi-Statement functions.</p>

<p><a href=""http://blog.waynesheffield.com/wayne/archive/2012/02/comparing-inline-and-multistatement-table-valued-functions/#comments"" rel=""noreferrer"">His original blog post.</a></p>

<p><a href=""http://www.sqlservercentral.com/blogs/discussionofsqlserver/2012/02/15/comparing-inline-and-multistatement-table-valued-functions/"" rel=""noreferrer"">Copy on SQL Server Central</a></p>
","2554544"
"SQL changing a value to upper or lower case","174268","","<p>How do you make a field in a sql select statement all upper or lower case?</p>

<p>Example:</p>

<p>select firstname from Person</p>

<p>How do I make firstname always return upper case and likewise always return lower case?</p>
","<pre><code>SELECT UPPER(firstname) FROM Person

SELECT LOWER(firstname) FROM Person
</code></pre>
","341356"
"SQL injection that gets around mysql_real_escape_string()","174049","","<p>Is there an SQL injection possibility even when using <code>mysql_real_escape_string()</code> function?</p>

<p>Consider this sample situation. SQL is constructed in PHP like this:</p>

<pre><code>$login = mysql_real_escape_string(GetFromPost('login'));
$password = mysql_real_escape_string(GetFromPost('password'));

$sql = ""SELECT * FROM table WHERE login='$login' AND password='$password'"";
</code></pre>

<p>I have heard numerous people say to me that a code like that is still dangerous and possible to hack even with <code>mysql_real_escape_string()</code> function used. But I cannot think of any possible exploit?</p>

<p>Classic injections like this:</p>

<pre><code>aaa' OR 1=1 --
</code></pre>

<p>do not work.</p>

<p>Do you know of any possible injection that would get through the PHP code above?</p>
","<p>Consider the following query:</p>

<pre><code>$iId = mysql_real_escape_string(""1 OR 1=1"");    
$sSql = ""SELECT * FROM table WHERE id = $iId"";
</code></pre>

<p><code>mysql_real_escape_string()</code> will not protect you against this.
<strong>The fact that you use single quotes (<code>' '</code>) around your variables inside your query is what protects you against this.</strong> The following is also an option:</p>

<pre><code>$iId = (int)""1 OR 1=1"";
$sSql = ""SELECT * FROM table WHERE id = $iId"";
</code></pre>
","5741264"
"Calculate a Running Total in SQL Server","173538","","<p>Imagine the following table (called <code>TestTable</code>):</p>

<pre><code>id     somedate    somevalue
--     --------    ---------
45     01/Jan/09   3
23     08/Jan/09   5
12     02/Feb/09   0
77     14/Feb/09   7
39     20/Feb/09   34
33     02/Mar/09   6
</code></pre>

<p>I would like a query that returns a running total in date order, like:</p>

<pre><code>id     somedate    somevalue  runningtotal
--     --------    ---------  ------------
45     01/Jan/09   3          3
23     08/Jan/09   5          8
12     02/Feb/09   0          8
77     14/Feb/09   7          15  
39     20/Feb/09   34         49
33     02/Mar/09   6          55
</code></pre>

<p>I know there are <a href=""http://geekswithblogs.net/Rhames/archive/2008/10/28/calculating-running-totals-in-sql-server-2005---the-optimal.aspx"" rel=""noreferrer"">various ways of doing this</a> in SQL Server 2000 / 2005 / 2008.</p>

<p>I am particularly interested in this sort of method that uses the aggregating-set-statement trick:</p>

<pre><code>INSERT INTO @AnotherTbl(id, somedate, somevalue, runningtotal) 
   SELECT id, somedate, somevalue, null
   FROM TestTable
   ORDER BY somedate

DECLARE @RunningTotal int
SET @RunningTotal = 0

UPDATE @AnotherTbl
SET @RunningTotal = runningtotal = @RunningTotal + somevalue
FROM @AnotherTbl
</code></pre>

<p>... this is very efficient but I have heard there are issues around this because you can't necessarily guarantee that the <code>UPDATE</code> statement will process the rows in the correct order. Maybe we can get some definitive answers about that issue.</p>

<p>But maybe there are other ways that people can suggest?</p>

<p>edit: Now with a <a href=""http://sqlfiddle.com/#!3/c8880/4"" rel=""noreferrer"">SqlFiddle</a> with the setup and the 'update trick' example above</p>
","<p><strong>Update</strong>, if you are running SQL Server 2012 see: <a href=""https://stackoverflow.com/a/10309947"">https://stackoverflow.com/a/10309947</a></p>

<p>The problem is that the SQL Server implementation of the Over clause is <a href=""http://wayback.archive.org/web/20090625062153/http://www.mydatabasesupport.com/forums/sqlserver-programming/189015-tsql-accmulations.html"" rel=""noreferrer"">somewhat limited</a>. </p>

<p>Oracle (and ANSI-SQL) allow you to do things like: </p>

<pre><code> SELECT somedate, somevalue,
  SUM(somevalue) OVER(ORDER BY somedate 
     ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) 
          AS RunningTotal
  FROM Table
</code></pre>

<p>SQL Server gives you no clean solution to this problem. My gut is telling me that this is one of those rare cases where a cursor is the fastest, though I will have to do some benchmarking on big results.</p>

<p>The update trick is handy but I feel its fairly fragile. It seems that if you are updating a full table then it will proceed in the order of the primary key. So if you set your date as a primary key ascending you will <code>probably</code> be safe. But you are relying on an undocumented SQL Server implementation detail (also if the query ends up being performed by two procs I wonder what will happen, see: MAXDOP): </p>

<p>Full working sample: </p>

<pre><code>drop table #t 
create table #t ( ord int primary key, total int, running_total int)

insert #t(ord,total)  values (2,20)
-- notice the malicious re-ordering 
insert #t(ord,total) values (1,10)
insert #t(ord,total)  values (3,10)
insert #t(ord,total)  values (4,1)

declare @total int 
set @total = 0
update #t set running_total = @total, @total = @total + total 

select * from #t
order by ord 

ord         total       running_total
----------- ----------- -------------
1           10          10
2           20          30
3           10          40
4           1           41
</code></pre>

<p>You asked for a benchmark this is the lowdown. </p>

<p>The fastest SAFE way of doing this would be the Cursor, it is an order of magnitude faster than the correlated sub-query of cross-join. </p>

<p>The absolute fastest way is the UPDATE trick. My only concern with it is that I am not certain that under all circumstances the update will proceed in a linear way. There is nothing in the query that explicitly says so. </p>

<p>Bottom line, for production code I would go with the cursor. </p>

<p>Test data: </p>

<pre><code>create table #t ( ord int primary key, total int, running_total int)

set nocount on 
declare @i int
set @i = 0 
begin tran
while @i &lt; 10000
begin
   insert #t (ord, total) values (@i,  rand() * 100) 
    set @i = @i +1
end
commit
</code></pre>

<p>Test 1:</p>

<pre><code>SELECT ord,total, 
    (SELECT SUM(total) 
        FROM #t b 
        WHERE b.ord &lt;= a.ord) AS b 
FROM #t a

-- CPU 11731, Reads 154934, Duration 11135 
</code></pre>

<p>Test 2: </p>

<pre><code>SELECT a.ord, a.total, SUM(b.total) AS RunningTotal 
FROM #t a CROSS JOIN #t b 
WHERE (b.ord &lt;= a.ord) 
GROUP BY a.ord,a.total 
ORDER BY a.ord

-- CPU 16053, Reads 154935, Duration 4647
</code></pre>

<p>Test 3:</p>

<pre><code>DECLARE @TotalTable table(ord int primary key, total int, running_total int)

DECLARE forward_cursor CURSOR FAST_FORWARD 
FOR 
SELECT ord, total
FROM #t 
ORDER BY ord


OPEN forward_cursor 

DECLARE @running_total int, 
    @ord int, 
    @total int
SET @running_total = 0

FETCH NEXT FROM forward_cursor INTO @ord, @total 
WHILE (@@FETCH_STATUS = 0)
BEGIN
     SET @running_total = @running_total + @total
     INSERT @TotalTable VALUES(@ord, @total, @running_total)
     FETCH NEXT FROM forward_cursor INTO @ord, @total 
END

CLOSE forward_cursor
DEALLOCATE forward_cursor

SELECT * FROM @TotalTable

-- CPU 359, Reads 30392, Duration 496
</code></pre>

<p>Test 4: </p>

<pre><code>declare @total int 
set @total = 0
update #t set running_total = @total, @total = @total + total 

select * from #t

-- CPU 0, Reads 58, Duration 139
</code></pre>
","861073"
"how do you insert null values into sql server","173498","","<p>In sql server enterprise manager, how do you write an insert statement and pass in <code>null</code> values?</p>
","<pre><code>INSERT INTO atable (x,y,z) VALUES ( NULL,NULL,NULL)
</code></pre>
","1149668"
"How do I use an INSERT statement's OUTPUT clause to get the identity value?","172982","","<p>If I have an insert statement such as:</p>

<pre><code>INSERT INTO MyTable
(  
  Name,
  Address,
  PhoneNo
)
VALUES
(
  'Yatrix',
   '1234 Address Stuff',
   '1112223333'
)
</code></pre>

<p>How do I set <code>@var INT</code> to the new row's identity value (called <code>Id</code>) using the OUTPUT clause? I've seen samples of putting INSERTED.Name into table variables, for example, but I can't get it into a non-table variable. </p>

<p>I've tried <code>OUPUT INSERTED.Id AS @var</code>, <code>SET @var = INSERTED.Id</code>, but neither have worked. </p>

<p>Thanks in advance.</p>
","<p>You can either have the newly inserted ID being output to the SSMS console like this:</p>

<pre><code>INSERT INTO MyTable(Name, Address, PhoneNo)
OUTPUT INSERTED.ID
VALUES ('Yatrix', '1234 Address Stuff', '1112223333')
</code></pre>

<p>You can use this also from e.g. C#, when you need to get the ID back to your calling app - just execute the SQL query with <code>.ExecuteScalar()</code> (instead of <code>.ExecuteNonQuery()</code>) to read the resulting <code>ID</code> back.</p>

<p>Or if you need to capture the newly inserted <code>ID</code> inside T-SQL (e.g. for later further processing), you need to create a table variable:</p>

<pre><code>DECLARE @OutputTbl TABLE (ID INT)

INSERT INTO MyTable(Name, Address, PhoneNo)
OUTPUT INSERTED.ID INTO @OutputTbl(ID)
VALUES ('Yatrix', '1234 Address Stuff', '1112223333')
</code></pre>

<p>This way, you can put multiple values into <code>@OutputTbl</code> and do further processing on those. You could also use a ""regular"" temporary table (<code>#temp</code>) or even a ""real"" persistent table as your ""output target"" here.</p>
","10999467"
"SQL Server 2008 - Case / If statements in SELECT Clause","172863","","<p>I have a Query that's supposed to run like this - </p>

<pre>

If(var = xyz) 
   SELECT col1, col2
ELSE IF(var = zyx)
   SELECT col2, col3
ELSE
   SELECT col7,col8

FROM 

.
.
.
</pre>

<p>How do I achieve this in T-SQL without writing separate queries for each clause? Currently I'm running it as</p>

<pre>

IF (var = xyz) {
  Query1
}
ELSE IF (var = zyx) {
  Query2
}
ELSE {
  Query3
}
</pre>

<p>That's just a lot of redundant code just to select different columns depending on a value. 
Any alternatives?</p>
","<p>Just a note here that you may actually be better off having 3 separate SELECTS for reasons of optimization. If you have one single SELECT then the generated plan will have to project all columns col1, col2, col3, col7, col8 etc, although, depending on the value of the runtime @var, only some are needed. This may result in plans that do unnecessary clustered index lookups because the non-clustered index Doesn't cover all columns projected by the SELECT.</p>

<p>On the other hand 3 separate SELECTS, each projecting the needed columns only may benefit from non-clustered indexes that cover just your projected column in each case. </p>

<p>Of course this depends on the actual schema of your data model and the exact queries, but this is just a heads up so you don't bring the imperative thinking mind frame of procedural programming to the declarative world of SQL.</p>
","1122767"
"SQL query for a carriage return in a string and ultimately removing carriage return","172682","","<p>SQL query for a carriage return in a string and ultimately removing carriage return</p>

<p>I have some data in a table and there are some carriage returns in places where I don't want them. I am trying to write a query to get all of the strings that contain carriage returns.</p>

<p>I tried this</p>

<pre><code>select * from Parameters
where Name LIKE '%""\n"" %'
</code></pre>

<p>Also</p>

<pre><code>select * from Parameters
where Name LIKE '\r'
</code></pre>

<p>'</p>

<p>Both are valid SQL but are not returning what I am looking for. Do I need to use the <em>Like</em> command or a different command? How do I get the carriage return into the query?</p>

<p>The carriage return is not necessarily at the end of the line either (may be in the middle).</p>
","<p>this will be slow, but if it is a one time thing, try...</p>

<pre><code>select * from parameters where name like '%'+char(13)+'%' or name like '%'+char(10)+'%'
</code></pre>

<p>Note that the ANSI SQL string concatenation operator is ""||"", so it may need to be:</p>

<pre><code>select * from parameters where name like '%' || char(13) || '%' or name like '%' || char(10) || '%'
</code></pre>
","1337212"
"Convert integer to hex and hex to integer","172470","","<p>So I have this query working (where <code>signal_data</code> is a column) in Sybase but it doesn't work in Microsoft SQL Server:</p>

<pre><code>HEXTOINT(SUBSTRING((INTTOHEX(signal_data)),5,2)) as Signal
</code></pre>

<p>I also have it in Excel (where <code>A1</code> contains the value):</p>

<pre><code>=HEX2DEC(LEFT(DEC2HEX(A1),LEN(DEC2HEX(A1))-2))
</code></pre>

<p>Does anyone know how I would do this in SQL Server?</p>
","<p>Convert INT to hex:</p>

<pre><code>SELECT CONVERT(VARBINARY(8), 16777215)
</code></pre>

<p>Convert hex to INT:</p>

<pre><code>SELECT CONVERT(INT, 0xFFFFFF)
</code></pre>

<p>See <a href=""http://classicasp.aspfaq.com/general/how-do-i-convert-from-hex-to-int-and-back.html"" rel=""noreferrer"">http://classicasp.aspfaq.com/general/how-do-i-convert-from-hex-to-int-and-back.html</a></p>

<h3>Update 2015-03-16 (by Oskar Berggren)</h3>

<p>The above example has the limitation that it only works when the HEX value is given as an integer literal. For completeness, if the value to convert is a hexadecimal string (such as found in a varchar column) use:</p>

<pre><code>-- If the '0x' marker is present:
SELECT CONVERT(INT, CONVERT(VARBINARY, '0x1FFFFF', 1))

-- If the '0x' marker is NOT present:
SELECT CONVERT(INT, CONVERT(VARBINARY, '1FFFFF', 2))
</code></pre>

<p><strong>Note:</strong> The string must contain an even number of hex digits. An odd number of digits will yield an error.</p>

<p>More details can be found in the ""Binary Styles"" section of <a href=""https://msdn.microsoft.com/en-us/library/ms187928.aspx"" rel=""noreferrer"">CAST and CONVERT (Transact-SQL)</a>. I believe SQL Server 2008 or later is required.</p>
","703212"
"ORA-01652: unable to extend temp segment by 128 in tablespace SYSTEM: How to extend?","172362","","<p>I have a large Oracle table, which contains 542512 rows. It has three columns and when I try to create an index for it with the following command:</p>

<pre><code>  CREATE INDEX FTS_INDEX ON FILTERED_TEKLI_IIS_TABLOSU (ilAdi,ilceAdi,caddeAdi)
</code></pre>

<p>Oracle gives the following error:</p>

<pre><code>SQL Error: ORA-01652: unable to extend temp segment by 128 in tablespace SYSTEM
01652. 00000 -  ""unable to extend temp segment by %s in tablespace %s""
*Cause:    Failed to allocate an extent of the required number of blocks for
       a temporary segment in the tablespace indicated.
*Action:   Use ALTER TABLESPACE ADD DATAFILE statement to add one or more
       files to the tablespace indicated.
</code></pre>

<p>I searched for this error and found that it is produced when Oracle hasn't enough space to store intermediate data when executing operations like joining tables, creating indices etc. on large tables. But I did not found a clear solution for this. These ALTER TABLESPACE and ADD DATAFILE commands seem to do the job, but I am not sure how to call these and with which parameters. Any help would be appreciated.</p>
","<p>Each tablespace has one or more datafiles that it uses to store data.</p>

<p>The max size of a datafile depends on the block size of the database. I believe that, by default, that leaves with you with a max of 32gb per datafile.</p>

<p>To find out if the actual limit is 32gb, run the following:</p>

<pre><code>select value from v$parameter where name = 'db_block_size';
</code></pre>

<p>Compare the result you get with the first column below, and that will indicate what your max datafile size is.</p>

<p>I have Oracle Personal Edition 11g r2 and in a default install it had an 8,192 block size (32gb per data file).</p>

<pre><code>Block Sz   Max Datafile Sz (Gb)   Max DB Sz (Tb)

--------   --------------------   --------------

   2,048                  8,192          524,264

   4,096                 16,384        1,048,528

   8,192                 32,768        2,097,056

  16,384                 65,536        4,194,112

  32,768                131,072        8,388,224
</code></pre>

<p>You can run this query to find what datafiles you have, what tablespaces they are associated with, and what you've currrently set the max file size to (which cannot exceed the aforementioned 32gb):</p>

<pre><code>select bytes/1024/1024 as mb_size,
       maxbytes/1024/1024 as maxsize_set,
       x.*
from   dba_data_files x
</code></pre>

<p>MAXSIZE_SET is the maximum size you've set the datafile to. Also relevant is whether you've set the AUTOEXTEND option to ON (its name does what it implies).</p>

<p>If your datafile has a low max size or autoextend is not on you could simply run:</p>

<pre><code>alter database datafile 'path_to_your_file\that_file.DBF' autoextend on maxsize unlimited;
</code></pre>

<p>However if its size is at/near 32gb an autoextend is on, then yes, you do need another datafile for the tablespace:</p>

<pre><code>alter tablespace system add datafile 'path_to_your_datafiles_folder\name_of_df_you_want.dbf' size 10m autoextend on maxsize unlimited;
</code></pre>
","25350967"
"SQL Server: Make all UPPER case to Proper Case/Title Case","172195","","<p>I have a table that was imported as all UPPER CASE and I would like to turn it into Proper Case. What script have any of you used to complete this?</p>
","<p>Here's a UDF that will do the trick...</p>

<pre><code>create function ProperCase(@Text as varchar(8000))
returns varchar(8000)
as
begin
   declare @Reset bit;
   declare @Ret varchar(8000);
   declare @i int;
   declare @c char(1);

   if @Text is null
   return null;

   select @Reset = 1, @i=1, @Ret = '';

   while (@i &lt;= len(@Text))
    select @c= substring(@Text,@i,1),
               @Ret = @Ret + case when @Reset=1 then UPPER(@c) else LOWER(@c) end,
               @Reset = case when @c like '[a-zA-Z]' then 0 else 1 end,
               @i = @i +1
   return @Ret
end
</code></pre>

<p>You will still have to use it to update your data though.</p>
","230177"
"How to identify all stored procedures referring a particular table","172066","","<p>I created a table on development environment for testing purpose and there are few sp's which are refreing this table. Now I have have to drop this table as well as identify all sp's which are referring this table. I am facing difficulty to find list of all sp's. Please suggest some query by assuming that the table name is 'x' and database is sql server 2005.</p>
","<pre><code>SELECT Name
FROM sys.procedures
WHERE OBJECT_DEFINITION(OBJECT_ID) LIKE '%TableNameOrWhatever%'
</code></pre>

<p>BTW -- here is a handy resource for this type of question: <a href=""http://msdn.microsoft.com/en-us/library/ms345522%28v=SQL.90%29.aspx"" rel=""noreferrer"">http://msdn.microsoft.com/en-us/library/ms345522%28v=SQL.90%29.aspx</a></p>
","7272337"
"Is there any difference between ""!="" and ""<>"" in Oracle Sql?","171717","","<p>I would like to know if there are any differences in between the two <code>not equal</code> operators <code>&lt;&gt;</code> and <code>!=</code> in Oracle.</p>

<p>Are there cases where they can give different results or different performance?</p>
","<p>No there is no difference at all in functionality. <br/>
(The same is true for all other DBMS - most of them support both styles):</p>

<p>Here is the current SQL reference: <a href=""https://docs.oracle.com/database/121/SQLRF/conditions002.htm#CJAGAABC"">https://docs.oracle.com/database/121/SQLRF/conditions002.htm#CJAGAABC</a></p>

<p>The SQL standard only defines a single operator for ""<em>not equals</em>"" and that is <code>&lt;&gt;</code></p>
","10650865"
"WHERE IS NULL, IS NOT NULL or NO WHERE clause depending on SQL Server parameter value","171656","","<p>I have a stored procedure in SQL Server 2000 that performs a search based on parameter values. For one of the parameters passed in, I need a different <code>WHERE</code> clause depending on its value - the problem is that the 3 values would be where <code>MyColumn</code> </p>

<ol>
<li><code>IS NULL</code> </li>
<li><code>IS NOT NULL</code></li>
<li><code>ANY VALUE (NULL AND NOT NULL)</code> (essentially no <code>WHERE</code> clause)</li>
</ol>

<p>I'm having some mental block in coming up with the correct syntax. Is this possible to do in one select statement without performing some <code>IF @parameter BEGIN ... END</code> branching?</p>
","<p>Here is how you can solve this using a single <code>WHERE</code> clause:</p>

<pre><code>WHERE (@myParm = value1 AND MyColumn IS NULL)
OR  (@myParm = value2 AND MyColumn IS NOT NULL)
OR  (@myParm = value3)
</code></pre>

<p>A naïve usage of the CASE statement <strong>does not work</strong>, by this I mean the following:</p>

<pre><code>SELECT Field1, Field2 FROM MyTable
WHERE CASE @myParam
    WHEN value1 THEN MyColumn IS NULL
    WHEN value2 THEN MyColumn IS NOT NULL
    WHEN value3 THEN TRUE
END
</code></pre>

<p>It is possible to solve this using a case statement, see onedaywhen's <a href=""https://stackoverflow.com/a/811579/61989"">answer</a></p>
","810728"
"How to use GROUP BY to concatenate strings in MySQL?","171371","","<p>Basically the question is how to get from this:</p>

<pre>
id    string
1          A
1          B
2          C
</pre>

<p>to this:</p>

<pre>
id    string
1          A B
2          C
</pre>
","<pre><code>SELECT id, GROUP_CONCAT(string SEPARATOR ' ') FROM table GROUP BY id;
</code></pre>

<p><a href=""http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat"" rel=""noreferrer"">http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat</a></p>

<p>From the link above, <code>GROUP_CONCAT</code>: This function returns a string result with the concatenated non-NULL values from a group. It returns NULL if there are no non-NULL values.</p>
","149799"
"including parameters in OPENQUERY","170878","","<p>How can I use a parameter inside sql openquery, such as: </p>

<pre><code>SELECT * FROM OPENQUERY([NameOfLinkedSERVER], 'SELECT * FROM TABLENAME
where field1=@someParameter') T1 INNER JOIN MYSQLSERVER.DATABASE.DBO.TABLENAME
T2 ON T1.PK = T2.PK
</code></pre>
","<p>From the <a href=""http://msdn.microsoft.com/en-us/library/ms188427.aspx"" rel=""noreferrer"">OPENQUERY</a> documentation it states that:</p>

<blockquote>
  <p>OPENQUERY does not accept variables
  for its arguments.</p>
</blockquote>

<p>See this <a href=""http://support.microsoft.com/kb/314520"" rel=""noreferrer"">article</a> for a workaround.</p>

<p><strong>UPDATE:</strong></p>

<p>As suggested, I'm including the recommendations from the article below.</p>

<p><strong>Pass Basic Values</strong></p>

<p>When the basic Transact-SQL statement is known, but you have to pass in one or more specific values, use code that is similar to the following sample: </p>

<pre><code>DECLARE @TSQL varchar(8000), @VAR char(2)
SELECT  @VAR = 'CA'
SELECT  @TSQL = 'SELECT * FROM OPENQUERY(MyLinkedServer,''SELECT * FROM pubs.dbo.authors WHERE state = ''''' + @VAR + ''''''')'
EXEC (@TSQL)
</code></pre>

<p><strong>Pass the Whole Query</strong></p>

<p>When you have to pass in the whole Transact-SQL query or the name of the linked server (or both), use code that is similar to the following sample:</p>

<pre><code>DECLARE @OPENQUERY nvarchar(4000), @TSQL nvarchar(4000), @LinkedServer nvarchar(4000)
SET @LinkedServer = 'MyLinkedServer'
SET @OPENQUERY = 'SELECT * FROM OPENQUERY('+ @LinkedServer + ','''
SET @TSQL = 'SELECT au_lname, au_id FROM pubs..authors'')' 
EXEC (@OPENQUERY+@TSQL) 
</code></pre>

<p><strong>Use the Sp_executesql Stored Procedure</strong></p>

<p>To avoid the multi-layered quotes, use code that is similar to the following sample:</p>

<pre><code>DECLARE @VAR char(2)
SELECT  @VAR = 'CA'
EXEC MyLinkedServer.master.dbo.sp_executesql
N'SELECT * FROM pubs.dbo.authors WHERE state = @state',
N'@state char(2)',
@VAR
</code></pre>
","3378592"
"Disable all table constraints in Oracle","170791","","<p>How can I disable all table constrains in Oracle with a single command?
This can be either for a single table, a list of tables, or for all tables.</p>
","<p>It is better to avoid writing out temporary spool files.  Use a PL/SQL block.  You can run this from SQL*Plus or put this thing into a package or procedure.  The join to USER_TABLES is there to avoid view constraints.</p>

<p>It's unlikely that you really want to disable all constraints (including NOT NULL, primary keys, etc).  You should think about putting constraint_type in the WHERE clause.</p>

<pre><code>BEGIN
  FOR c IN
  (SELECT c.owner, c.table_name, c.constraint_name
   FROM user_constraints c, user_tables t
   WHERE c.table_name = t.table_name
   AND c.status = 'ENABLED'
   AND NOT (t.iot_type IS NOT NULL AND c.constraint_type = 'P')
   ORDER BY c.constraint_type DESC)
  LOOP
    dbms_utility.exec_ddl_statement('alter table ""' || c.owner || '"".""' || c.table_name || '"" disable constraint ' || c.constraint_name);
  END LOOP;
END;
/
</code></pre>

<p>Enabling the constraints again is a bit tricker - you  need to enable primary key constraints before you can reference them in a foreign key constraint.  This can be done using an ORDER BY on constraint_type.  'P' = primary key, 'R' = foreign key.</p>

<pre><code>BEGIN
  FOR c IN
  (SELECT c.owner, c.table_name, c.constraint_name
   FROM user_constraints c, user_tables t
   WHERE c.table_name = t.table_name
   AND c.status = 'DISABLED'
   ORDER BY c.constraint_type)
  LOOP
    dbms_utility.exec_ddl_statement('alter table ""' || c.owner || '"".""' || c.table_name || '"" enable constraint ' || c.constraint_name);
  END LOOP;
END;
/
</code></pre>
","131595"
"SQL not a single-group group function","170525","","<p>When I run the following SQL statement:</p>

<pre><code>SELECT MAX(SUM(TIME))
FROM downloads
GROUP BY SSN
</code></pre>

<p>It returns the maximum sum value of downloads by a customer, however if I try to find the social security number that that max value belongs to by adding it to the select statement:</p>

<pre><code>SELECT SSN, MAX(SUM(TIME))
FROM downloads
GROUP BY SSN
</code></pre>

<p>I get the following error:</p>

<blockquote>
  <p>not a single-group group function</p>
</blockquote>

<p>I do not understand why it is throwing this error. A google search came up with the following action:</p>

<p>Drop either the group function or the individual column expression from the SELECT list or add a GROUP BY clause that includes all individual column expressions listed</p>

<p>From what I think this is saying
- dropping the group function makes the sum value invalid
- droping the individual column expression (SSN) will just give me the max sum
- not sure about that third part.</p>

<p>Could anyone guide in the right direction?</p>

<p>-Tomek</p>

<p>EDIT: TIME in this database refers to the number of times downloaded</p>
","<p>Well the problem simply-put is that the SUM(TIME) for a specific SSN on your query is a single value, so it's objecting to MAX as it makes no sense (The maximum of a single value is meaningless).</p>

<p>Not sure what SQL database server you're using but I suspect you want a query more like this (Written with a MSSQL background - may need some translating to the sql server you're using):</p>

<pre><code>SELECT TOP 1 SSN, SUM(TIME)
FROM downloads
GROUP BY SSN
ORDER BY 2 DESC
</code></pre>

<p>This will give you the SSN with the highest total time and the total time for it.</p>

<p>Edit - If you have multiple with an equal time and want them all you would use:</p>

<pre><code>SELECT
SSN, SUM(TIME)
FROM downloads
GROUP BY SSN
HAVING SUM(TIME)=(SELECT MAX(SUM(TIME)) FROM downloads GROUP BY SSN))
</code></pre>
","1795222"
"What are the options for storing hierarchical data in a relational database?","170135","","<p><strong>Good Overviews</strong></p>

<p>Generally speaking, you're making a decision between fast read times (for example, nested set) or fast write times (adjacency list). Usually, you end up with a combination of the options below that best fit your needs. The following provides some in-depth reading:</p>

<ul>
<li><a href=""http://vadimtropashko.wordpress.com/2008/08/09/one-more-nested-intervals-vs-adjacency-list-comparison/"" rel=""noreferrer"">One more Nested Intervals vs. Adjacency List comparison</a>: <em>the best comparison</em> of Adjacency List, Materialized Path, Nested Set and Nested Interval I've found.</li>
<li><a href=""http://www.slideshare.net/billkarwin/models-for-hierarchical-data"" rel=""noreferrer"">Models for hierarchical data</a>: slides with good explanations of tradeoffs and example usage</li>
<li><a href=""http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/"" rel=""noreferrer"">Representing hierarchies in MySQL</a>: very good overview of Nested Set in particular</li>
<li><a href=""http://troels.arvin.dk/db/rdbms/links/#hierarchical"" rel=""noreferrer"">Hierarchical data in RDBMSs</a>: most comprehensive and well-organized set of links I've seen, but not much in the way of explanation</li>
</ul>

<p><strong>Options</strong></p>

<p>Ones I am aware of and general features:</p>

<ol>
<li><a href=""http://en.wikipedia.org/wiki/Adjacency_list"" rel=""noreferrer"">Adjacency List</a>:

<ul>
<li>Columns: ID, ParentID</li>
<li>Easy to implement.</li>
<li>Cheap node moves, inserts, and deletes.</li>
<li>Expensive to find the level (can store as a computed column), ancestry &amp; descendants (Bridge Table combined with level column can solve), path (Lineage Column can solve).</li>
<li>Use <a href=""http://en.wikipedia.org/wiki/Common_table_expressions"" rel=""noreferrer"">Common Table Expressions</a> in those databases that support them to traverse.</li>
</ul></li>
<li><a href=""http://en.wikipedia.org/wiki/Nested_set_model"" rel=""noreferrer"">Nested Set</a> (a.k.a Modified Preorder Tree Traversal)

<ul>
<li>Popularized by Joe Celko in numerous articles and his book <a href=""https://rads.stackoverflow.com/amzn/click/0123877334"" rel=""noreferrer"">Trees and Hierarchies in SQL for Smarties</a></li>
<li>Columns: Left, Right</li>
<li>Cheap level, ancestry, descendants</li>
<li>Volatile encoding - moves, inserts, deletes more expensive.</li>
<li>Requires a specific sort order (e.g. created). So sorting all descendants in a different order requires additional work.</li>
</ul></li>
<li><a href=""http://communities.bmc.com/communities/docs/DOC-9902"" rel=""noreferrer"">Nested Intervals</a>

<ul>
<li>Like nested set, but with real/float/decimal so that the encoding isn't volatile (inexpensive move/insert/delete)</li>
<li>Have to deal with real/float/decimal representation issues</li>
<li>A more complex <a href=""http://vadimtropashko.files.wordpress.com/2011/07/ch5.pdf"" rel=""noreferrer"">matrix encoding variant</a> adds the benefit of ancestor encoding, like materialized path for ""free""</li>
</ul></li>
<li><a href=""http://intelligent-enterprise.informationweek.com/showArticle.jhtml;jsessionid=MRBJR2LLRV1ANQE1GHPSKH4ATMY32JVN?articleID=219400252"" rel=""noreferrer"">Bridge Table</a> (a.k.a. <a href=""http://dirtsimple.org/2010/11/simplest-way-to-do-tree-based-queries.html"" rel=""noreferrer"">Closure Table</a>: some good ideas about how to use triggers for maintaining this approach)

<ul>
<li>Columns: ancestor, descendant</li>
<li>Stands apart from the table it describes.</li>
<li>Can include some nodes in more than one hierarchy.</li>
<li>Cheap ancestry and descendants (albeit not in what order)</li>
<li>For complete knowledge of a hierarchy needs to be combined with another option.</li>
</ul></li>
<li><a href=""http://evolt.org/node/4047"" rel=""noreferrer"">Flat Table</a>

<ul>
<li>A modification of the Adjacency List that adds a Level and Rank (e.g. ordering) column to each record.</li>
<li>Expensive move and delete</li>
<li>Cheap ancestry and descendants</li>
<li>Good Use: threaded discussion - forums / blog comments</li>
</ul></li>
<li><a href=""http://www.ferdychristant.com/blog//articles/DOMM-7QJPM7"" rel=""noreferrer"">Lineage Column</a> (a.k.a. <a href=""http://communities.bmc.com/communities/docs/DOC-9902"" rel=""noreferrer"">Materialized Path</a>, Path Enumeration)

<ul>
<li>Column: lineage (e.g. /parent/child/grandchild/etc...)</li>
<li>Limit to how deep the hierarchy can be.</li>
<li>Descendants cheap (e.g. <code>LEFT(lineage, #) = '/enumerated/path'</code>)</li>
<li>Ancestry tricky (database specific queries)</li>
</ul></li>
<li><a href=""https://stackoverflow.com/a/6802687/684229"">Multiple lineage columns</a>

<ul>
<li>Columns: one for each lineage level, refers to all the parents up to the root, levels down from the item's level are set to NULL</li>
<li>Limit to how deep the hierarchy can be</li>
<li>Cheap ancestors, descendants, level</li>
<li>Cheap insert, delete, move of the leaves</li>
<li>Expensive insert, delete, move of the internal nodes</li>
</ul></li>
</ol>

<p><strong>Database Specific Notes</strong></p>

<p><em>MySQL</em></p>

<ul>
<li><a href=""http://explainextended.com/2009/09/29/adjacency-list-vs-nested-sets-mysql/"" rel=""noreferrer"">Use session variables for Adjacency List</a></li>
</ul>

<p><em>Oracle</em></p>

<ul>
<li>Use <a href=""http://www.ypl.com/oracle/sql/hierarchical_queries/html_deep/index.html"" rel=""noreferrer"">CONNECT BY</a> to traverse Adjacency Lists</li>
</ul>

<p><em>PostgreSQL</em></p>

<ul>
<li><a href=""http://www.postgresql.org/docs/current/static/ltree.html"" rel=""noreferrer"">ltree datatype</a> for Materialized Path</li>
</ul>

<p><em>SQL Server</em></p>

<ul>
<li><a href=""http://msdn.microsoft.com/en-us/magazine/cc794278.aspx"" rel=""noreferrer"">General summary</a></li>
<li>2008 offers <a href=""http://msdn.microsoft.com/en-us/library/bb677290.aspx"" rel=""noreferrer"">HierarchyId</a> data type appears to help with Lineage Column approach and expand the depth that can be represented.</li>
</ul>
","<p>This is kind of a question that is still interesting even after all big three vendors implemented a recursive <code>WITH</code> clause. I'd suggest that different readers would be pleased with different answers.</p>

<ol>
<li><a href=""http://troels.arvin.dk/db/rdbms/links/#hierarchical"">Comprehensive list of references</a> by Troels Arvin.</li>
<li>For the lack of competition, introductory textbook by Joe Celko ""Trees and Hierarchies in SQL for Smarties"" can indeed be considered a classic.</li>
<li>Review of various tree encodings with emphasis to <a href=""http://vadimtropashko.files.wordpress.com/2011/07/ch5.pdf"">nested intervals</a>. </li>
</ol>
","4054033"
"Correct use of transactions in SQL Server 2008","169283","","<p>I have 2 commands and need both of them executed correctly or none of them execute.
So I think I need a Transaction but I don't know how to use it correctly.</p>

<p>What's the problem with the following script?</p>

<pre><code>BEGIN TRANSACTION [Tran1]

INSERT INTO [Test].[dbo].[T1]
    ([Title], [AVG])
VALUES ('Tidd130', 130), ('Tidd230', 230)

UPDATE [Test].[dbo].[T1]
  SET [Title] = N'az2' ,[AVG] = 1
  WHERE [dbo].[T1].[Title] = N'az'

COMMIT TRANSACTION [Tran1]
GO
</code></pre>

<p>The <code>insert</code> command executed but the <code>update</code> command has a problem.  How can I implement this to rollback both commands if any of them have an error in execution?</p>
","<p>Add a try/catch block, if the transaction succeeds it will commit the changes, if the transaction fails the transaction is rolled back:</p>

<pre class=""lang-sql prettyprint-override""><code>BEGIN TRANSACTION [Tran1]

BEGIN TRY

INSERT INTO [Test].[dbo].[T1]
  ([Title], [AVG])
VALUES ('Tidd130', 130), ('Tidd230', 230)

UPDATE [Test].[dbo].[T1]
  SET [Title] = N'az2' ,[AVG] = 1
WHERE [dbo].[T1].[Title] = N'az'


COMMIT TRANSACTION [Tran1]

END TRY
BEGIN CATCH
  ROLLBACK TRANSACTION [Tran1]
END CATCH  

GO
</code></pre>
","10153706"
"How to store image in SQL Server database tables column","168747","","<p>I Have a table named <code>FEMALE</code> in my database. It has <code>ID</code> as <code>PK</code>, it has an <code>Image</code> column.</p>

<p>My Question is how do I store an image using a SQL Query?</p>
","<p>give this a try,</p>

<pre><code>insert into tableName (ImageColumn) 
SELECT BulkColumn 
FROM Openrowset( Bulk 'image..Path..here', Single_Blob) as img
</code></pre>

<hr>

<p><strong>INSERTING</strong></p>

<p><img src=""https://i.stack.imgur.com/csSCl.jpg"" alt=""enter image description here""></p>

<p><strong>REFRESHING THE TABLE</strong></p>

<p><img src=""https://i.stack.imgur.com/iTonm.jpg"" alt=""enter image description here""></p>
","15660012"
"Rank function in MySQL","168721","","<p>I am not an expert in MySQL . I need to find out rank of customers. Here I am adding the corresponding ANSI standard SQL query for my requirement. Please help me to convert it to MySQL .</p>

<pre><code> SELECT RANK() OVER (PARTITION BY Gender ORDER BY Age) AS [Partition by Gender], 
   FirstName, 
   Age,
   Gender 
 FROM Person
</code></pre>

<p>Is there any function to find out rank in MySQL?</p>
","<p>One option is to use a ranking variable, such as the following:</p>

<pre><code>SELECT    first_name,
          age,
          gender,
          @curRank := @curRank + 1 AS rank
FROM      person p, (SELECT @curRank := 0) r
ORDER BY  age;
</code></pre>

<p>The <code>(SELECT @curRank := 0)</code> part allows the variable initialization without requiring a separate <code>SET</code> command.</p>

<p>Test case:</p>

<pre><code>CREATE TABLE person (id int, first_name varchar(20), age int, gender char(1));

INSERT INTO person VALUES (1, 'Bob', 25, 'M');
INSERT INTO person VALUES (2, 'Jane', 20, 'F');
INSERT INTO person VALUES (3, 'Jack', 30, 'M');
INSERT INTO person VALUES (4, 'Bill', 32, 'M');
INSERT INTO person VALUES (5, 'Nick', 22, 'M');
INSERT INTO person VALUES (6, 'Kathy', 18, 'F');
INSERT INTO person VALUES (7, 'Steve', 36, 'M');
INSERT INTO person VALUES (8, 'Anne', 25, 'F');
</code></pre>

<p>Result:</p>

<pre><code>+------------+------+--------+------+
| first_name | age  | gender | rank |
+------------+------+--------+------+
| Kathy      |   18 | F      |    1 |
| Jane       |   20 | F      |    2 |
| Nick       |   22 | M      |    3 |
| Bob        |   25 | M      |    4 |
| Anne       |   25 | F      |    5 |
| Jack       |   30 | M      |    6 |
| Bill       |   32 | M      |    7 |
| Steve      |   36 | M      |    8 |
+------------+------+--------+------+
8 rows in set (0.02 sec)
</code></pre>
","3333697"
"Compare two DATETIME only by date not time in SQL Server 2008","168642","","<p>I have two tables where column <code>[date]</code> is type of <code>DATETIME2(0)</code>.</p>

<p>I have to compare two records only by theirs Date parts (day+month+year), discarding Time parts (hours+minutes+seconds).</p>

<p>How can I do that?</p>
","<p>Use the <code>CAST</code> to the new <code>DATE</code> data type in SQL Server 2008 to compare just the date portion:</p>

<pre><code>IF CAST(DateField1 AS DATE) = CAST(DateField2 AS DATE)
</code></pre>
","1843415"
"Difference between natural join and inner join","168593","","<p>What is the difference between a natural join and an inner join?</p>
","<p>One significant difference between INNER JOIN and NATURAL JOIN is the number of columns returned.</p>

<p>Consider:</p>

<pre><code>TableA                            TableB
Column1    Column2                Column1    Column3
1          2                      1          3
</code></pre>

<p>The INNER JOIN of TableA and TableB on Column1 will return</p>

<pre><code>a.column1  a.column2  b.column1  b.column3
1          2          1          3

SELECT * FROM TableA INNER JOIN TableB USING (Column1)
SELECT * FROM TableA INNER JOIN TableB ON TableA.Column1 = TableB.Column1
</code></pre>

<p>The NATURAL JOIN of TableA and TableB on Column1 will return:</p>

<pre><code>column1  column2  column3
1        2        3

SELECT * FROM TableA NATURAL JOIN TableB
</code></pre>

<p>The repeated column is avoided.</p>

<p>(AFAICT from the standard grammar, you can't specify the joining columns in a natural join; the join is strictly name-based.  See also <a href=""http://en.wikipedia.org/wiki/Join_%28SQL%29#Natural_join"">Wikipedia</a>.)</p>

<p>(<em>There's a cheat in the inner join output; the <code>a.</code> and <code>b.</code> parts would not be in the column names; you'd just have <code>column1</code>, <code>column2</code>, <code>column1</code>, <code>column3</code> as the headings.</em>)</p>
","8696402"
"How to get last inserted id?","168475","","<p>I have this code:</p>

<pre><code>string insertSql = 
    ""INSERT INTO aspnet_GameProfiles(UserId,GameId) VALUES(@UserId, @GameId)"";

using (SqlConnection myConnection = new SqlConnection(myConnectionString))
{
   myConnection.Open();

   SqlCommand myCommand = new SqlCommand(insertSql, myConnection);

   myCommand.Parameters.AddWithValue(""@UserId"", newUserId);
   myCommand.Parameters.AddWithValue(""@GameId"", newGameId);

   myCommand.ExecuteNonQuery();

   myConnection.Close();
}
</code></pre>

<p>When I insert into this table, I have an auto_increment int primary key column called <code>GamesProfileId</code>, how can i get the last inserted one after this so I can use that id to insert into another table?</p>
","<p>For SQL Server 2005+, if there is no insert trigger, then change the insert statement (all one line, split for clarity here) to this </p>

<pre><code>INSERT INTO aspnet_GameProfiles(UserId,GameId)
OUTPUT INSERTED.ID
VALUES(@UserId, @GameId)
</code></pre>

<p>For SQL Server 2000, or if there is an insert trigger:</p>

<pre><code>INSERT INTO aspnet_GameProfiles(UserId,GameId) 
VALUES(@UserId, @GameId);
SELECT SCOPE_IDENTITY()
</code></pre>

<p>And then</p>

<pre><code> Int32 newId = (Int32) myCommand.ExecuteScalar();
</code></pre>
","5228819"
"SQL Server: Get data for only the past year","168466","","<p>I am writing a query in which I have to get the data for only the last year. What is the best way to do this?</p>

<pre><code>SELECT ... FROM ... WHERE date &gt; '8/27/2007 12:00:00 AM'
</code></pre>
","<p>The following adds -1 years to the current date:</p>

<pre><code>SELECT ... From ... WHERE date &gt; DATEADD(year,-1,GETDATE())
</code></pre>
","30229"
"Increment value in mysql update query","168446","","<p>I have made this code for giving out +1 point, but it doesn't work properly.</p>

<pre><code>mysql_query(""
    UPDATE member_profile 
    SET points= ' "".$points."" ' + 1 
    WHERE user_id = '"".$userid.""'
"");
</code></pre>

<p>the $points variable is the user´s points right now.. I want it to plus one to it.. so example if he had like 5 points, it should be 5+1 = 6.. <strong>but it doesnt, it just changes to 1</strong></p>

<p>What have i done wrong? thank you</p>
","<p>You could also just do this:</p>

<pre><code>mysql_query(""
    UPDATE member_profile 
    SET points = points + 1
    WHERE user_id = '"".$userid.""'
"");
</code></pre>
","2259168"
"Is SQL syntax case sensitive?","168370","","<p>Is SQL case sensitive.  I've used MySQL and SQL Server which both seem to be case in-sensitive.  Is this always the case?  Does the standard define case-sensitivity? </p>
","<p>The SQL Keywords are case-insensitive (<code>SELECT</code>, <code>FROM</code>, <code>WHERE</code>, etc), but are often written in all caps. However in some setups table and column names are case-sensitive. MySQL has a configuration option to enable/disable it. Usually case-sensitive table and column names are the default on Linux MySQL and case-insensitive used to be the default on Windows, but now the installer asked about this during setup. For MSSQL it is a function of the database's collation setting.</p>

<p>Here is the <a href=""http://dev.mysql.com/doc/refman/5.0/en/identifier-case-sensitivity.html"" rel=""noreferrer"">MySQL page about name case-sensitivity</a></p>

<p>Here is the <a href=""http://msdn.microsoft.com/en-us/library/ms143503(SQL.90).aspx"" rel=""noreferrer"">article in MSDN about collations for MSSQL</a></p>
","153967"
"SQL Server : SUM() of multiple rows including where clauses","168061","","<p>I have a table that looks something like the following : </p>

<pre><code>  PropertyID     Amount     Type       EndDate
 --------------------------------------------
   1              100       RENT        null              
   1              50        WATER       null         
   1              60        ELEC        null        
   1              10        OTHER       null      
   2              70        RENT        null
   2              10        WATER       null
</code></pre>

<p>There will be multiple items billed to a property, also billed multiple times. For example RENT could be billed to property #1 12 times (over a year), however the only ones I'm interested for are those with ENDDATE of null (in otherwords, current)</p>

<p>I would like to achieve : </p>

<pre><code>    PropertyId       Amount
  --------------------------       
      1                220
      2                80
</code></pre>

<p>I have tried to do something like this : </p>

<pre><code>SELECT
   propertyId,
   SUM() as TOTAL_COSTS
FROM
   MyTable
</code></pre>

<p>However, in the SUM would I be forced to have multiple selects bringing back the current amount for each type of charge? I could see this becoming messy and I'm hoping for a much simpler solution</p>

<p>Any ideas?</p>
","<p>This will bring back totals per property and type</p>

<pre><code>SELECT  PropertyID,
        TYPE,
        SUM(Amount)
FROM    yourTable
GROUP BY    PropertyID,
            TYPE
</code></pre>

<p>This will bring back only active values</p>

<pre><code>SELECT  PropertyID,
        TYPE,
        SUM(Amount)
FROM    yourTable
WHERE   EndDate IS NULL
GROUP BY    PropertyID,
            TYPE
</code></pre>

<p>and this will bring back totals for properties</p>

<pre><code>SELECT  PropertyID,
        SUM(Amount)
FROM    yourTable
WHERE   EndDate IS NULL
GROUP BY    PropertyID
</code></pre>

<p>......</p>
","1607768"
"New line in Sql Query","167820","","<p>How you get new line or line feed in Sql Query ?</p>
","<p>Pinal Dave explains this well in his blog.</p>

<p><a href=""http://blog.sqlauthority.com/2009/07/01/sql-server-difference-between-line-feed-n-and-carriage-return-r-t-sql-new-line-char/"" rel=""noreferrer"">http://blog.sqlauthority.com/2009/07/01/sql-server-difference-between-line-feed-n-and-carriage-return-r-t-sql-new-line-char/</a></p>

<pre><code>DECLARE @NewLineChar AS CHAR(2) = CHAR(13) + CHAR(10)
PRINT ('SELECT FirstLine AS FL ' + @NewLineChar + 'SELECT SecondLine AS SL')
</code></pre>
","1085670"
"How to alter a column's data type in a PostgreSQL table?","167572","","<p>Entering the following command into a PostgreSQL interactive terminal results in an error:</p>

<pre><code>ALTER TABLE tbl_name ALTER COLUMN col_name varchar (11);
</code></pre>

<p>What is the correct command to alter the data type of a column?</p>
","<p>See documentation here: <a href=""http://www.postgresql.org/docs/current/interactive/sql-altertable.html"" rel=""noreferrer"">http://www.postgresql.org/docs/current/interactive/sql-altertable.html</a></p>

<pre><code>ALTER TABLE tbl_name ALTER COLUMN col_name TYPE varchar (11);
</code></pre>
","7162961"
"show all tables in DB2 using the LIST command","167532","","<p>This is embarrassing, but I can't seem to find a way to list the names of the tables in our DB2 database. Here is what I tried:</p>

<pre><code>root@VO11555:~# su - db2inst1
root@VO11555:~# . ~db2inst1/sqllib/db2profile
root@VO11555:~# LIST ACTIVE DATABASES</code></pre>

<p>We receive this error: <code>SQL1092N  ""ROOT"" does not have the authority to perform the requested command or operation.</code></p>

<p>The DB2 version number follows.</p>

<pre>root@VO11555:~# db2level
DB21085I  Instance ""db2inst1"" uses ""64"" bits and DB2 code release ""SQL09071""
with level identifier ""08020107"".
Informational tokens are ""DB2 v9.7.0.1"", ""s091114"", ""IP23034"", and Fix Pack
""1"".
Product is installed at ""/opt/db2V9.7"".</pre>
","<p>To get a list of tables for the current database in DB2 --></p>

<p>Connect to the database:</p>

<pre><code>db2 connect to DATABASENAME user USER using PASSWORD
</code></pre>

<p>Run this query:</p>

<pre><code>db2 LIST TABLES
</code></pre>

<p>This is the equivalent of SHOW TABLES in MySQL.</p>

<p>You may need to execute 'set schema myschema' to the correct schema before you run the list tables command. By default upon login your schema is the same as your username - which often won't contain any tables. You can use 'values current schema' to check what schema you're currently set to.</p>
","10679460"
"Insert multiple values using INSERT INTO (SQL Server 2005)","167529","","<p>In SQL Server 2005, I'm trying to figure out why I'm not able to insert multiple fields into a table.  The following query, which inserts one record, works fine:</p>

<pre><code>INSERT INTO [MyDB].[dbo].[MyTable]
           ([FieldID]
           ,[Description])
     VALUES
           (1000,N'test')
</code></pre>

<p>However, the following query, which specifies more than one value, fails:</p>

<pre><code>INSERT INTO [MyDB].[dbo].[MyTable]
           ([FieldID]
           ,[Description])
     VALUES
           (1000,N'test'),(1001,N'test2')
</code></pre>

<p>I get this message: </p>

<pre><code>Msg 102, Level 15, State 1, Line 5
Incorrect syntax near ','.
</code></pre>

<p>When I looked up the help for INSERT in SQL Sever Management Studio, one of their examples showed using the ""Values"" syntax that I used (with groups of values in parentheses and separated by commas).  The help documentation I found in SQL Server Management Studio looks like it's for SQL Server 2008, so perhaps that's the reason that the insert doesn't work.  Either way, I can't figure out why it won't work.</p>
","<p>The syntax you are using is new to SQL Server 2008:</p>

<pre><code>INSERT INTO [MyDB].[dbo].[MyTable]
       ([FieldID]
       ,[Description])
 VALUES
       (1000,N'test'),(1001,N'test2')
</code></pre>

<p>For SQL Server 2005, you will have to use multiple <code>INSERT</code> statements:</p>

<pre><code>INSERT INTO [MyDB].[dbo].[MyTable]
       ([FieldID]
       ,[Description])
 VALUES
       (1000,N'test')

INSERT INTO [MyDB].[dbo].[MyTable]
       ([FieldID]
       ,[Description])
 VALUES
       (1001,N'test2')
</code></pre>

<p>One other option is to use <code>UNION ALL</code>:</p>

<pre><code>INSERT INTO [MyDB].[dbo].[MyTable]
       ([FieldID]
       ,[Description])
SELECT 1000, N'test' UNION ALL
SELECT 1001, N'test2'
</code></pre>
","2462538"
"Dynamic SQL - EXEC(@SQL) versus EXEC SP_EXECUTESQL(@SQL)","167437","","<p>What are the real world pros and cons of executing a dynamic SQL command in a stored procedure in SQL Server using</p>

<pre><code>EXEC (@SQL)
</code></pre>

<p>versus</p>

<pre><code>EXEC SP_EXECUTESQL @SQL
</code></pre>

<p>?</p>
","<p><code>sp_executesql</code> is more likely to promote query plan reuse. When using <code>sp_executesql</code>, parameters are explicitly identified in the calling signature. This excellent article descibes this <a href=""http://technet.microsoft.com/en-au/library/cc966425.aspx"" rel=""noreferrer"">process</a>.</p>

<p>The oft cited reference for many aspects of dynamic sql is Erland Sommarskog's must read: ""<a href=""http://www.sommarskog.se/dynamic_sql.html"" rel=""noreferrer"">The Curse and Blessings of Dynamic SQL</a>"".</p>
","548103"
"Error importing SQL dump into MySQL: Unknown database / Can't create database","167341","","<p>I'm confused how to import a SQL dump file.  I can't seem to import the database without creating the database first in MySQL.</p>

<p>This is the error displayed when <code>database_name</code> has not yet been created: </p>

<p><code>username</code> = username of someone with access to the database on the original server.<br>
<code>database_name</code> = name of database from the original server </p>

<pre class=""lang-none prettyprint-override""><code>$ mysql -u username -p -h localhost database_name &lt; dumpfile.sql   
Enter password:  
ERROR 1049 (42000): Unknown database 'database_name' 
</code></pre>

<p>If I log into MySQL as root and create the database, <code>database_name</code> </p>

<pre><code>mysql -u root  
create database database_name;  
create user username;# same username as the user from the database I got the dump from.  
grant all privileges on database_name.* to username@""localhost"" identified by 'password';  
exit mysql
</code></pre>

<p>then attempt to import the sql dump again:  </p>

<pre><code>$ mysql -u username -p database_name &lt; dumpfile.sql  
Enter password:  
ERROR 1007 (HY000) at line 21: Can't create database 'database_name'; database exists
</code></pre>

<p>How am I supposed to import the SQL dumpfile?</p>
","<p>Open the sql file and comment out the line that tries to create the existing database.</p>
","859337"
"Backup a single table with its data from a database in sql server 2008","167318","","<p>I want to get a backup of a single table with its data from a database in SQL Server using a script.</p>

<p>How can I do that?</p>
","<p>There are many ways you can take back of  table.<br>
Look into this link :<a href=""http://www.sqlserver-training.com/how-to-backup-sql-table/-"" rel=""noreferrer"">http://www.sqlserver-training.com/how-to-backup-sql-table/-</a></p>

<ol>
<li>BCP (BULK COPY PROGRAM) </li>
<li>Generate Table Script with data  </li>
<li>Make a copy of table using SELECT INTO</li>
<li>SAVE Table Data Directly in a Flat file</li>
<li>Export Data using SSIS to any destination</li>
</ol>
","19698795"
"SQL: How to get the count of each distinct value in a column?","167244","","<p>I have a SQL table called ""posts"" that looks like this:</p>

<pre><code>id | category
-----------------------
1  | 3
2  | 1
3  | 4
4  | 2
5  | 1
6  | 1
7  | 2
</code></pre>

<p>Each category number corresponds to a category. How would I go about counting the number of times each category appears on a post all in <strong>one sql query</strong>?</p>

<p>As an example, such a query might return a symbolic array such as this: <code>(1:3, 2:2, 3:1, 4:1)</code></p>

<hr />

<p>My current method is to use queries for each possible category, such as: <code>SELECT COUNT(*) AS num FROM posts WHERE category=#</code>, and then combine the return values into a final array. However, I'm looking for a solution that uses only one query.</p>
","<pre><code>SELECT
  category,
  COUNT(*) AS `num`
FROM
  posts
GROUP BY
  category
</code></pre>
","7053908"
"Alter Table Add Column Syntax","167031","","<p>I'm trying to programmatically add an identity column to a table Employees. Not sure what I'm doing wrong with my syntax.</p>

<pre><code>ALTER TABLE Employees
  ADD COLUMN EmployeeID int NOT NULL IDENTITY (1, 1)

ALTER TABLE Employees ADD CONSTRAINT
    PK_Employees PRIMARY KEY CLUSTERED 
    (
      EmployeeID
    ) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, 
    ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
</code></pre>

<p>What am I doing wrong? I tried to export the script, but SQL Mgmt Studio does a whole Temp Table rename thing.</p>

<p><strong>UPDATE</strong>:
I think it is choking on the first statement with ""Incorrect syntax near the keyword 'COLUMN'.""</p>
","<p>Just remove <code>COLUMN</code> from <code>ADD COLUMN</code></p>

<pre><code>ALTER TABLE Employees
  ADD EmployeeID numeric NOT NULL IDENTITY (1, 1)

ALTER TABLE Employees ADD CONSTRAINT
        PK_Employees PRIMARY KEY CLUSTERED 
        (
          EmployeeID
        ) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, 
        ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
</code></pre>
","794391"
"How to print SQL statement in codeigniter model","166969","","<p>I have a sql statement in my model,</p>

<p>I then say</p>

<pre><code>$query = $this-&gt;db-&gt;query($sql, array(fields, fields1);

if ($query) {
    return true:
} else {
    echo ""failed"";
    return false;
}
</code></pre>

<p>My query always fails, how do I get php to print the exact sql statement being sent to my database? And display that on my php view, page</p>
","<pre><code>print_r($query);
</code></pre>

<p>You can also use (in view) and you will see the SQL statement:</p>

<pre><code>$this-&gt;output-&gt;enable_profiler(TRUE);
</code></pre>

<p>Profiling user guide:
<a href=""http://ellislab.com/codeigniter/user-guide/general/profiling.html"" rel=""noreferrer"">http://ellislab.com/codeigniter/user-guide/general/profiling.html</a></p>
","6142168"
"SQL GROUP BY CASE statement with aggregate function","166688","","<p>I have a column that looks something like this:</p>

<pre><code>CASE
    WHEN col1 &gt; col2 THEN SUM(col3*col4)
    ELSE 0
END AS some_product
</code></pre>

<p>And I would like to put it in my GROUP BY clause, but this seems to cause problems because there is an aggregate function in column.  Is there a way to GROUP BY a column alias such as <code>some_product</code> in this case, or do I need to put this in a subquery and group on that?</p>
","<p>My guess is that you don't really want to <code>GROUP BY</code> some_product. </p>

<p>The <strong>answer to:</strong> ""Is there a way to <code>GROUP BY</code> a column alias such as some_product in this case, or do I need to put this in a subquery and group on that?"" <strong>is:</strong> You can not <code>GROUP BY</code> a column alias. </p>

<p>The <code>SELECT</code> clause, where column aliases are assigned, is not processed until after the <code>GROUP BY</code> clause. An inline view or common table expression (CTE) could be used to make the results available for grouping.</p>

<p>Inline view:</p>

<pre><code>select ...
from (select ... , CASE WHEN col1 &gt; col2 THEN SUM(col3*col4) ELSE 0 END AS some_product
   from ...
   group by col1, col2 ... ) T
group by some_product ...
</code></pre>

<p>CTE:</p>

<pre><code>with T as (select ... , CASE WHEN col1 &gt; col2 THEN SUM(col3*col4) ELSE 0 END AS some_product
   from ...
   group by col1, col2 ... )
select ...
from T
group by some_product ... 
</code></pre>
","1209151"
"MySQL - Selecting data from multiple tables all with same structure but different data","166571","","<p>Ok, here is my dilemma I have a database set up with about 5 tables all with the exact same data structure. The data is separated in this manner for localization purposes and to split up a total of about 4.5 million records.</p>

<p>A majority of the time only one table is needed and all is well. However, sometimes data is needed from 2 or more of the tables and it needs to be sorted by a user defined column. This is where I am having problems.</p>

<p>data columns:</p>

<pre><code>id, band_name, song_name, album_name, genre
</code></pre>

<p>MySQL statment:</p>

<pre><code>SELECT * from us_music, de_music where `genre` = 'punk'
</code></pre>

<p>MySQL spits out this error:</p>

<pre><code>#1052 - Column 'genre' in where clause is ambiguous
</code></pre>

<p>Obviously, I am doing this wrong. Anyone care to shed some light on this for me?</p>
","<p>I think you're looking for the <a href=""http://dev.mysql.com/doc/refman/5.1/en/union.html"" rel=""noreferrer"">UNION</a> clause, a la</p>

<pre><code>(SELECT * from us_music where `genre` = 'punk')
UNION
(SELECT * from de_music where `genre` = 'punk')
</code></pre>
","409720"
"How to export data from Excel spreadsheet to Sql Server 2008 table","166563","","<p>I want to import data from an <strong>Excel</strong> file - assume Excel 2003 / .xls - to Sql Server <strong>2008.</strong></p>

<p>Have tried adding a linked server to the JET OLE DB Access driver, and of course it fails on the 64-bit machine.
But when I try to drop the linked server while experimenting, there's another error saying that the linked server already/still exists!</p>

<p>I have also tried changing the Excel driver to 32-bit (regedit tool) but am not sure if it's doing anything, same error is coming up!</p>

<p>Some more details: 
Say Table1 in Excel file has 5 columns.
I want to map to Database.dbo.Table1 with 5 columns again, but with different names in table. 
Is there a way to do even do such an import?</p>
","<p>From your SQL Server Management Studio, you open Object Explorer, go to your database where you want to load the data into, right click, then pick Tasks > Import Data.</p>

<p>This opens the Import Data Wizard, which typically works pretty well for importing from Excel. You can pick an Excel file, pick what worksheet to import data from, you can choose what table to store it into, and what the columns are going to be. Pretty flexible indeed.</p>

<p>You can run this as a one-off, or you can store it as a SQL Server Integration Services (SSIS) package into your file system, or into SQL Server itself, and execute it over and over again (even scheduled to run at a given time, using SQL Agent).</p>

<p><strong>Update:</strong> yes, yes, yes, you can do all those things you keep asking - have you even tried at least once to run that wizard??</p>

<p>OK, here it comes - step by step:</p>

<p><strong>Step 1:</strong> pick your Excel source</p>

<p><a href=""http://i33.tinypic.com/xnfexf.png"">alt text http://i33.tinypic.com/xnfexf.png</a></p>

<p><strong>Step 2:</strong> pick your SQL Server target database </p>

<p><a href=""http://i38.tinypic.com/2cofz1g.png"">alt text http://i38.tinypic.com/2cofz1g.png</a></p>

<p><strong>Step 3:</strong> pick your source worksheet (from Excel) and your target table in your SQL Server database; see the ""Edit Mappings"" button!</p>

<p><a href=""http://i35.tinypic.com/3522mw3.png"">alt text http://i35.tinypic.com/3522mw3.png</a></p>

<p><strong>Step 4:</strong> check (and change, if needed) your mappings of Excel columns to SQL Server columns in the table:</p>

<p><a href=""http://i36.tinypic.com/vwz5lw.png"">alt text http://i36.tinypic.com/vwz5lw.png</a></p>

<p><strong>Step 5:</strong> if you want to use it later on, save your SSIS package to SQL Server:</p>

<p><a href=""http://i37.tinypic.com/4v48wy.png"">alt text http://i37.tinypic.com/4v48wy.png</a></p>

<p><strong>Step 6:</strong> - success! This is on a 64-bit machine, works like a charm - just do it!!</p>

<p><a href=""http://i34.tinypic.com/qyz5m9.png"">alt text http://i34.tinypic.com/qyz5m9.png</a></p>
","3474783"
"From a Sybase Database, how I can get table description ( field names and types)?","166562","","<p>I have access to command line isql and I like to get Meta-Data of all the tables of a given database, possibly in a formatted file. How I can achieve that?</p>

<p>Thanks.</p>
","<p>Check <a href=""http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.infocenter.dc36274.1570/html/tables/X14933.htm"" rel=""noreferrer"">sysobjects</a> and <a href=""http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.help.ase_15.0.tables/html/tables/tables46.htm"" rel=""noreferrer"">syscolumns</a> tables.</p>

<p><a href=""http://download.sybase.com/pdfdocs/asg1250e/poster.pdf"" rel=""noreferrer"">Here</a> is a diagram of Sybase system tables.</p>

<p>List of all user tables:</p>

<pre><code>SELECT * FROM sysobjects WHERE type = 'U'
</code></pre>

<p>You can change 'U' to other objects:</p>

<ul>
<li>C – computed column</li>
<li>D – default</li>
<li>F – SQLJ function</li>
<li>L – log</li>
<li>N – partition condition</li>
<li>P – Transact-SQL or SQLJ procedure</li>
<li>PR – prepare objects (created by Dynamic SQL)</li>
<li>R – rule</li>
<li>RI – referential constraint</li>
<li>S – system table</li>
<li>TR – trigger</li>
<li>U – user table</li>
<li>V – view</li>
<li>XP – extended stored procedure</li>
</ul>

<p>List of columns in a table:</p>

<pre><code>SELECT sc.* 
FROM syscolumns sc
INNER JOIN sysobjects so ON sc.id = so.id
WHERE so.name = 'my_table_name'
</code></pre>
","1429917"
"Recover unsaved SQL query scripts","166429","","<p>How to recover the unsaved scripts if the SSMS crashes / unsaved tab gets accidentally closed?</p>
","<p>Posting this in case if somebody stumbles into same problem.</p>

<p>Googled for <a href=""http://www.sql-programmers.com/retrieve-unsaved-sql-query-scripts.aspx"">Retrieve unsaved Scripts</a> and found a solution.</p>

<p>Run the following <strong><code>select</code></strong> script. It provides a list of scripts and its time of execution in the last 24 hours. This will be helpful to retrieve the scripts, if we close our query window in SQL Server management studio without saving the script. It works for all executed scripts not only a view or procedure.</p>

<pre><code>Use &lt;database&gt;
SELECT execquery.last_execution_time AS [Date Time], execsql.text AS [Script] FROM sys.dm_exec_query_stats AS execquery
CROSS APPLY sys.dm_exec_sql_text(execquery.sql_handle) AS execsql
ORDER BY execquery.last_execution_time DESC
</code></pre>
","15035060"
"conversion of a varchar data type to a datetime data type resulted in an out-of-range value","166391","","<p>I have the following piece of inline SQL that I run from a C# windows service:</p>

<pre><code>UPDATE table_name SET 
    status_cd = '2', 
    sdate = CAST('03/28/2011 18:03:40' AS DATETIME), 
    bat_id = '33acff9b-e2b4-410e-baaf-417656e3c255', 
    cnt = 1, 
    attempt_date = CAST('03/28/2011 18:03:40' AS DATETIME) 
WHERE id = '1855'
</code></pre>

<p>When I run this against a SQL Server database from within the application, I get the following error:</p>

<blockquote>
  <p>System.Data.SqlClient.SqlException: The conversion of a varchar data type to a datetime data type resulted in an out-of-range value.
  The statement has been terminated.</p>
</blockquote>

<p>But if I take the piece of SQL and run it from SQL Management Studio, it will run without issue.</p>

<p>Any ideas what may be causing this issue? </p>
","<p>Ambiguous date formats are interpreted according to the language of the login. This works</p>

<pre><code>set dateformat mdy

select CAST('03/28/2011 18:03:40' AS DATETIME)
</code></pre>

<p>This doesn't</p>

<pre><code>set dateformat dmy

select CAST('03/28/2011 18:03:40' AS DATETIME)
</code></pre>

<p>If you use parameterised queries with the correct datatype you avoid these issues. You can also use the <a href=""http://www.karaszi.com/SQLServer/info_datetime.asp"" rel=""noreferrer"">unambiguous</a> ""unseparated"" format <code>yyyyMMdd hh:mm:ss</code></p>
","5466132"
"SQL Call Stored Procedure for each Row without using a cursor","166167","","<p>How can one call a stored procedure for each row in a table, where the columns of a row are input parameters to the sp <strong><em>without</em></strong> using a Cursor?</p>
","<p>Generally speaking I always look for a set based approach (sometimes at the expense of changing the schema).  </p>

<p>However, this snippet does have its place..</p>

<pre><code>-- Declare &amp; init (2008 syntax)
DECLARE @CustomerID INT = 0

-- Iterate over all customers
WHILE (1 = 1) 
BEGIN  

  -- Get next customerId
  SELECT TOP 1 @CustomerID = CustomerID
  FROM Sales.Customer
  WHERE CustomerID &gt; @CustomerId 
  ORDER BY CustomerID

  -- Exit loop if no more customers
  IF @@ROWCOUNT = 0 BREAK;

  -- call your sproc
  EXEC dbo.YOURSPROC @CustomerId

END
</code></pre>
","6167687"
"Equivalent of LIMIT and OFFSET for SQL Server?","166161","","<p>In PostgreSQL there is the <code>Limit</code> and <code>Offset</code> keywords which will allow very easy pagination of result sets. </p>

<p>What is the equivalent syntax for Sql Server? </p>
","<p>The equivalent of <code>LIMIT</code> is <code>SET ROWCOUNT</code>, but if you want generic pagination it's better to write a query like this:</p>

<pre><code>;WITH Results_CTE AS
(
    SELECT
        Col1, Col2, ...,
        ROW_NUMBER() OVER (ORDER BY SortCol1, SortCol2, ...) AS RowNum
    FROM Table
    WHERE &lt;whatever&gt;
)
SELECT *
FROM Results_CTE
WHERE RowNum &gt;= @Offset
AND RowNum &lt; @Offset + @Limit
</code></pre>

<p>The advantage here is the parameterization of the offset and limit in case you decide to change your paging options (or allow the user to do so).</p>

<p><strong>Note:</strong> the <code>@Offset</code> parameter should use one-based indexing for this rather than the normal zero-based indexing. </p>
","2135449"
"Remove Identity from a column in a table","165496","","<p>We have a 5GB table (nearly 500 million rows) and we want to remove the identity property on one of the column, but when we try to do this through SSMS - it times out.</p>

<p>Can this be done through T-SQL?</p>
","<p>You cannot remove an <code>IDENTITY</code> specification once set.</p>

<p>To remove the entire column:</p>

<pre><code>ALTER TABLE yourTable
DROP COLUMN yourCOlumn;
</code></pre>

<p>Information about <a href=""http://msdn.microsoft.com/en-us/library/ms190273.aspx"" rel=""noreferrer"">ALTER TABLE</a> here</p>

<p>If you need to keep the data, but remove the <code>IDENTITY</code> column, you will need to:</p>

<ul>
<li>Create a new column</li>
<li>Transfer the data from the existing <code>IDENTITY</code> column to the new column</li>
<li>Drop the existing <code>IDENTITY</code> column.</li>
<li>Rename the new column to the original column name</li>
</ul>
","8230300"
"How can I backup a remote SQL Server database to a local drive?","165355","","<p>I need to copy a database from a remote server to a local one. I tried to use SQL Server Management Studio, but it only backs up to a drive on the remote server.</p>

<p>Some points:</p>

<ul>
<li>I do not have access to the remote server in a way that I could copy files;</li>
<li>I do not have access to setup a UNC path to my server;</li>
</ul>

<p>Any ideas of how can I copy this database? Will I have to use 3rd party tools?</p>
","<p>In Microsoft SQL Server Management Studio you can right-click on the database you wish to backup and click Tasks -> Generate Scripts.</p>

<p>This pops open a wizard where you can set the following in order to perform a decent backup of your database, <strong>even on a remote server</strong>:</p>

<ul>
<li>Select the database you wish to backup and hit next,</li>
<li>In the options it presents to you:

<ol>
<li>In 2010: under the Table/View Options, change 'Script Data' and 'Script Indexes' to True and hit next,</li>
<li>In 2012: under 'General', change 'Types of data to script' from 'Schema only' to 'Schema and data'</li>
<li>In 2014: the option to script the data is now ""hidden"" in step ""Set Scripting Options"", you have to click the ""Advanced"" and set ""Types of data to script"" to ""Schema and data"" value</li>
</ol></li>
<li>In the next <em>four</em> windows, hit 'select all' and then next,</li>
<li>Choose to script to a new query window</li>
</ul>

<p>Once it's done its thing, you'll have a backup script ready in front of you.  Create a new local (or remote) database, and change the first 'USE' statement in the script to use your new database.  Save the script in a safe place, and go ahead and run it against your new empty database.  This should create you a (nearly) duplicate local database you can then backup as you like.</p>

<p>If you have <em>full</em> access to the remote database, you can choose to check 'script all objects' in the wizard's first window and then change the 'Script Database' option to True on the next window.  Watch out though, you'll need to perform a full search &amp; replace of the database name in the script to a new database which in this case you won't have to create before running the script.  This should create a more accurate duplicate but is sometimes not available due to permissions restrictions.</p>
","9141964"
"MySQL, update multiple tables with one query","165300","","<p>I have a function that updates three tables, but I use three queries to perform this. I wish to use a more convenient approach for good practice.</p>

<p>How can I update multiple tables in MySQL with a single query?</p>
","<p>You could do this with a stored procedure by combining the <code>UPDATE</code> statements in a single transaction.</p>
","4361810"
"Fastest way to remove non-numeric characters from a VARCHAR in SQL Server","165252","","<p>I'm writing an import utility that is using phone numbers as a unique key within the import.</p>

<p>I need to check that the phone number does not already exist in my DB. The problem is that   phone numbers in the DB could have things like dashes and parenthesis and possibly other things. I wrote a function to remove these things, the problem is that it is <strong>slow</strong> and with thousands of records in my DB and thousands of records to import at once, this process can be unacceptably slow. I've already made the phone number column an index.</p>

<p>I tried using the script from this post:<br>
<a href=""https://stackoverflow.com/questions/52315/t-sql-trim-nbsp-and-other-non-alphanumeric-characters"">T-SQL trim &amp;nbsp (and other non-alphanumeric characters)</a></p>

<p>But that didn't speed it up any.</p>

<p>Is there a faster way to remove non-numeric characters? Something that can perform well when 10,000 to 100,000 records have to be compared.</p>

<p>Whatever is done needs to perform <strong>fast</strong>.</p>

<p><strong>Update</strong><br>
Given what people responded with, I think I'm going to have to clean the fields before I run the import utility. </p>

<p>To answer the question of what I'm writing the import utility in, it is a C# app. I'm comparing BIGINT to BIGINT now, with no need to alter DB data and I'm still taking a performance hit with a very small set of data (about 2000 records). </p>

<p>Could comparing BIGINT to BIGINT be slowing things down?</p>

<p>I've optimized the code side of my app as much as I can (removed regexes, removed unneccessary DB calls). Although I can't isolate SQL as the source of the problem anymore, I still feel like it is.</p>
","<p>I may misunderstand, but you've got two sets of data to remove the strings from one for current data in the database and then a new set whenever you import.</p>

<p>For updating the existing records, I would just use SQL, that only has to happen once.</p>

<p>However, SQL isn't optimized for this sort of operation, since you said you are writing an import utility, I would do those updates in the context of the import utility itself, not in SQL.  This would be much better performance wise.  What are you writing the utility in?</p>

<p>Also, I may be completely misunderstanding the process, so I apologize if off-base.</p>

<p><b>Edit: </b><br>
For the initial update, if you are using SQL Server 2005, you could try a CLR function.  Here's a quick one using regex.  Not sure how the performance would compare, I've never used this myself except for a quick test right now.</p>

<pre><code>using System;  
using System.Data;  
using System.Text.RegularExpressions;  
using System.Data.SqlClient;  
using System.Data.SqlTypes;  
using Microsoft.SqlServer.Server;  

public partial class UserDefinedFunctions  
{  
    [Microsoft.SqlServer.Server.SqlFunction]  
    public static SqlString StripNonNumeric(SqlString input)  
    {  
        Regex regEx = new Regex(@""\D"");  
        return regEx.Replace(input.Value, """");  
    }  
};  
</code></pre>

<p>After this is deployed, to update you could just use:</p>

<pre><code>UPDATE table SET phoneNumber = dbo.StripNonNumeric(phoneNumber)
</code></pre>
","106226"
"Why do you create a View in a database?","164982","","<p>When and Why does some one decide that they need to create a View in their database?  Why not just run a normal stored procedure or select?</p>
","<p>A view provides several benefits.</p>

<p><strong>1. Views can hide complexity</strong></p>

<p>If you have a query that requires joining several tables, or has complex logic or calculations, you can code all that logic into a view, then select from the view just like you would a table.</p>

<p><strong>2. Views can be used as a security mechanism</strong></p>

<p>A view can select certain columns and/or rows from a table, and permissions set on the view instead of the underlying tables.  This allows surfacing only the data that a user needs to see.</p>

<p><strong>3. Views can simplify supporting legacy code</strong></p>

<p>If you need to refactor a table that would break a lot of code, you can replace the table with a view of the same name.  The view provides the exact same schema as the original table, while the actual schema has changed.  This keeps the legacy code that references the table from breaking, allowing you to change the legacy code at your leisure.</p>

<p>These are just some of the many examples of how views can be useful.</p>
","1278620"
"What is the meaning of the prefix N in T-SQL statements?","164876","","<p>I have seen prefix N in some insert T-SQL queries. Many people have used <code>N</code> before inserting the value in a table.</p>

<p>I searched, but I was not able to understand what is the purpose of including the <code>N</code> before inserting any strings into the table.</p>

<pre><code> INSERT INTO Personnel.Employees
 VALUES(N'29730', N'Philippe', N'Horsford', 20.05, 1),
</code></pre>
","<p>It's declaring the string as <code>nvarchar</code> data type, rather than <code>varchar</code></p>

<blockquote>
  <p>You may have seen Transact-SQL code that passes strings around using
  an N prefix. This denotes that the subsequent string is in Unicode
  (the N actually stands for National language character set). Which
  means that you are passing an NCHAR, NVARCHAR or NTEXT value, as
  opposed to CHAR, VARCHAR or TEXT.</p>
</blockquote>

<p>To quote <a href=""https://msdn.microsoft.com/en-IN/library/ms186939.aspx"" rel=""noreferrer"">from Microsoft</a>:</p>

<blockquote>
  <p>Prefix Unicode character string constants with the letter N. Without
  the N prefix, the string is converted to the default code page of the
  database. <strong>This default code page may not recognize certain characters</strong>.</p>
</blockquote>

<hr>

<p>If you want to know the difference between these two data types, see this SO post:</p>

<p><a href=""https://stackoverflow.com/questions/144283/what-is-the-difference-between-varchar-and-nvarchar"">What is the difference between varchar and nvarchar?</a></p>
","10025043"
"updating table rows in postgres using subquery","164457","","<p>Using postgres 8.4,  My goal is to update existing table:</p>

<pre><code>CREATE TABLE public.dummy
(
  address_id SERIAL,
  addr1 character(40),
  addr2 character(40),
  city character(25),
  state character(2),
  zip character(5),
  customer boolean,
  supplier boolean,
  partner boolean

)
WITH (
  OIDS=FALSE
);
</code></pre>

<p>Initially i tested my query using insert statement:</p>

<pre><code>insert into address customer,supplier,partner
SELECT  
    case when cust.addr1 is not null then TRUE else FALSE end customer, 
    case when suppl.addr1 is not null then TRUE else FALSE end supplier,
    case when partn.addr1 is not null then TRUE else FALSE end partner
from (
    SELECT *
        from address) pa
    left outer join cust_original cust
        on (pa.addr1=cust.addr1 and pa.addr2=cust.addr2 and pa.city=cust.city 
            and pa.state=cust.state and substring(cust.zip,1,5) = pa.zip  )
    left outer join supp_original suppl 
        on (pa.addr1=suppl.addr1 and pa.addr2=suppl.addr2 and pa.city=suppl.city 
                and pa.state=suppl.state and pa.zip = substring(suppl.zip,1,5))
    left outer join partner_original partn
        on (pa.addr1=partn.addr1 and pa.addr2=partn.addr2 and pa.city=partn.city
                  and pa.state=partn.state and pa.zip = substring(partn.zip,1,5) )
where pa.address_id = address_id
</code></pre>

<p>being Newbie I'm failing converting to update statement ie., updating existing rows with values returned by select statement.
Any help is highly appreciated.</p>
","<p>Postgres allows:</p>

<pre><code>UPDATE dummy
SET customer=subquery.customer,
    address=subquery.address,
    partn=subquery.partn
FROM (SELECT address_id, customer, address, partn
      FROM  /* big hairy SQL */ ...) AS subquery
WHERE dummy.address_id=subquery.address_id;
</code></pre>

<p>This syntax is not standard SQL, but it is much more convenient for this type of query than standard SQL. I believe Oracle (at least) accepts something similar.</p>
","6258586"
"SQL how to make null values come last when sorting ascending","163897","","<p>I have a SQL table with a datetime field. The field in question can be null. I have a query and I want the results sorted ascendingly by the datetime field, however I want rows where the datetime field is null at the end of the list, not at the beginning.</p>

<p>Is there a simple way to accomplish that?</p>
","<pre><code>select MyDate
from MyTable
order by case when MyDate is null then 1 else 0 end, MyDate
</code></pre>
","1498667"
"How Stuff and 'For Xml Path' work in Sql Server","163163","","<p>Table is:</p>

<pre><code>+----+------+
| Id | Name |
+----+------+    
| 1  | aaa  |
| 1  | bbb  |
| 1  | ccc  |
| 1  | ddd  |
| 1  | eee  |
+----+------+
</code></pre>

<p>Required output: </p>

<pre><code>+----+---------------------+
| Id |        abc          |
+----+---------------------+ 
|  1 | aaa,bbb,ccc,ddd,eee |
+----+---------------------+
</code></pre>

<p>Query:</p>

<pre><code>SELECT ID, 
    abc = STUFF(
                 (SELECT ',' + name FROM temp1 FOR XML PATH ('')), 1, 1, ''
               ) 
FROM temp1 GROUP BY id
</code></pre>

<p>This query is working properly. But I just need the explanation how it works or is there any other or short way to do this. </p>

<p>I am getting very confused to understand this. </p>
","<p>Here is how it works:</p>

<p><strong>1. Get XML element string with FOR XML</strong> </p>

<p>Adding FOR XML PATH to the end of a query allows you to output the results of the query as XML elements, with the element name contained in the PATH argument. For example, if we were to run the following statement:</p>

<pre><code>SELECT ',' + name 
              FROM temp1
              FOR XML PATH ('')
</code></pre>

<p>By passing in a blank string (FOR XML PATH('')), we get the following instead:</p>

<pre><code>,aaa,bbb,ccc,ddd,eee
</code></pre>

<p><strong>2.  Remove leading comma with STUFF</strong></p>

<p>The STUFF statement literally ""stuffs” one string into another, replacing characters within the first string. We, however, are using it simply to remove the first character of the resultant list of values. </p>

<pre><code>SELECT abc = STUFF((
            SELECT ',' + NAME
            FROM temp1
            FOR XML PATH('')
            ), 1, 1, '')
FROM temp1
</code></pre>

<p>The parameters of <code>STUFF</code> are:</p>

<ul>
<li>The string to be “stuffed” (in our case the full list of name with a
leading comma) </li>
<li>The location to start deleting and inserting characters (1, we’re stuffing into a blank string)</li>
<li>The number of characters to delete (1, being the leading comma)</li>
</ul>

<p>So we end up with:</p>

<pre><code>aaa,bbb,ccc,ddd,eee
</code></pre>

<p><strong>3. Join on id to get full list</strong></p>

<p>Next we just join this on the list of id in the temp table, to get a list of IDs with name:</p>

<pre><code>SELECT ID,  abc = STUFF(
             (SELECT ',' + name 
              FROM temp1 t1
              WHERE t1.id = t2.id
              FOR XML PATH (''))
             , 1, 1, '') from temp1 t2
group by id;
</code></pre>

<p>And we have our result:</p>

<pre><code>-----------------------------------
| Id        | Name                |
|---------------------------------|
| 1         | aaa,bbb,ccc,ddd,eee |
-----------------------------------
</code></pre>

<p>Hope this helps!</p>
","31212160"
"How to kill/stop a long SQL query immediately?","162379","","<p>I am using SQL server 2008 and its management studio. I executed a query that yields many rows. I tried to cancel it via the red cancel button, but it has not stopped for the past 10 minutes. It usually stops within 3 minutes. </p>

<p>What could the reason be and how do I stop it immediately ?</p>
","<blockquote>
  <p>What could the reason </p>
</blockquote>

<p>A query cancel is immediate, provided that your <a href=""http://msdn.microsoft.com/en-us/library/dd341449.aspx"" rel=""noreferrer"">attention</a> can reach the server and be processed. A query must be in a cancelable state, which is almost always true except if you do certain operations like call a web service from SQLCLR. If your attention cannot reach the server is usually due to <a href=""http://msdn.microsoft.com/en-us/library/ms177526.aspx"" rel=""noreferrer"">scheduler</a> overload.</p>

<p>But if your query is part of a transaction that must rollback then rollback cannot be interrupted. If it takes 10 minutes then it needs 10 minutes and there's nothing you can do about it. Even restarting the server will not help, will only make startup longer as recovery must finish the rollback.</p>

<p>To answer <em>which</em> specific reason applies to your case, you'll need to investigate yourself.</p>
","15921769"
"Calculating number of full months between two dates in SQL","162357","","<p>I need to calculate the number of <em>FULL</em> month in SQL, i.e.</p>

<ul>
<li>2009-04-16 to 2009-05-15 => 0 full month</li>
<li>2009-04-16 to 2009-05-16 => 1 full month</li>
<li>2009-04-16 to 2009-06-16 => 2 full months</li>
</ul>

<p>I tried to use DATEDIFF, i.e.</p>

<pre><code>SELECT DATEDIFF(MONTH, '2009-04-16', '2009-05-15')
</code></pre>

<p>but instead of giving me full months between the two date, it gives me the difference of the month part, i.e.</p>

<pre><code>1
</code></pre>

<p>anyone know how to calculate the number of full months in SQL Server?</p>
","<p>The original post had some bugs... so I re-wrote and packaged it as a UDF.</p>

<pre><code>CREATE FUNCTION FullMonthsSeparation 
(
    @DateA DATETIME,
    @DateB DATETIME
)
RETURNS INT
AS
BEGIN
    DECLARE @Result INT

    DECLARE @DateX DATETIME
    DECLARE @DateY DATETIME

    IF(@DateA &lt; @DateB)
    BEGIN
        SET @DateX = @DateA
        SET @DateY = @DateB
    END
    ELSE
    BEGIN
        SET @DateX = @DateB
        SET @DateY = @DateA
    END

    SET @Result = (
                    SELECT 
                    CASE 
                        WHEN DATEPART(DAY, @DateX) &gt; DATEPART(DAY, @DateY)
                        THEN DATEDIFF(MONTH, @DateX, @DateY) - 1
                        ELSE DATEDIFF(MONTH, @DateX, @DateY)
                    END
                    )

    RETURN @Result
END
GO

SELECT dbo.FullMonthsSeparation('2009-04-16', '2009-05-15') as MonthSep -- =0
SELECT dbo.FullMonthsSeparation('2009-04-16', '2009-05-16') as MonthSep -- =1
SELECT dbo.FullMonthsSeparation('2009-04-16', '2009-06-16') as MonthSep -- =2
</code></pre>
","1106987"
"SQL Query with NOT LIKE IN","162257","","<p>Please help me to write a sql query with the conditions as 'NOT LIKE IN'</p>

<pre><code>Select * from Table1 where EmpPU NOT Like IN ('%CSE%', '%ECE%', '%EEE%')
</code></pre>

<p>Getting error.</p>
","<p>You cannot combine like and in. The statement below would do the job though:</p>

<pre><code>Select * from Table1 
where EmpPU NOT Like '%CSE%' 
AND EmpPU NOT Like '%ECE%' 
AND EmpPU NOT Like '%EEE%'
</code></pre>
","9393472"
"Select info from table where row has max date","162106","","<p>My table looks something like this:</p>

<pre><code>group    date      cash  checks
  1    1/1/2013     0      0
  2    1/1/2013     0      800
  1    1/3/2013     0      700
  3    1/1/2013     0      600
  1    1/2/2013     0      400
  3    1/5/2013     0      200
</code></pre>

<p>-- Do not need cash just demonstrating that table has more information in it</p>

<p>I want to get the each unique group where date is max and checks is greater than 0. So the return would look something like:</p>

<pre><code>group    date     checks
  2    1/1/2013    800
  1    1/3/2013    700
  3    1/5/2013    200
</code></pre>

<p>attempted code:</p>

<pre><code>SELECT group,MAX(date),checks
    FROM table
    WHERE checks&gt;0
    GROUP BY group
    ORDER BY group DESC
</code></pre>

<p>problem with that though is it gives me all the dates and checks rather than just the max date row.</p>

<p>using ms sql server 2005</p>
","<pre><code>SELECT group,MAX(date) as max_date
FROM table
WHERE checks&gt;0
GROUP BY group
</code></pre>

<p>That works to get the max date..join it back to your data to get the other columns:</p>

<pre><code>Select group,max_date,checks
from table t
inner join 
(SELECT group,MAX(date) as max_date
FROM table
WHERE checks&gt;0
GROUP BY group)a
on a.group = t.group and a.max_date = date
</code></pre>

<p>Inner join functions as the filter to get the max record only.</p>

<p>FYI, your column names are horrid, don't use reserved words for columns (group, date, table).</p>
","19433107"
"How can I make SQL case sensitive string comparison on MySQL?","162031","","<p>I have a function that returns five characters with mixed case. If I do a query on this string it will return the value regardless of case.</p>

<p>How can I make MySQL string queries case sensitive?</p>
","<p><a href=""http://dev.mysql.com/doc/refman/5.0/en/case-sensitivity.html"" rel=""noreferrer"">http://dev.mysql.com/doc/refman/5.0/en/case-sensitivity.html</a></p>

<blockquote>
  <p>The default character set and collation are latin1 and latin1_swedish_ci, so nonbinary string comparisons are case insensitive by default. This means that if you search with col_name  LIKE 'a%', you get all column values that start with A or a. To make this search case sensitive, make sure that one of the operands has a case sensitive or binary collation. For example, if you are comparing a column and a string that both have the latin1 character set, you can use the COLLATE operator to cause either operand to have the latin1_general_cs or latin1_bin collation:</p>
</blockquote>

<pre><code>col_name COLLATE latin1_general_cs LIKE 'a%'
col_name LIKE 'a%' COLLATE latin1_general_cs
col_name COLLATE latin1_bin LIKE 'a%'
col_name LIKE 'a%' COLLATE latin1_bin
</code></pre>

<blockquote>
  <p>If you want a column always to be treated in case-sensitive fashion, declare it with a case sensitive or binary collation.</p>
</blockquote>
","5629129"
"How to get the next auto-increment id in mysql","161741","","<p>How to get the next id in mysql to insert it in the table</p>

<pre><code>INSERT INTO payments (date, item, method, payment_code)
VALUES (NOW(), '1 Month', 'paypal', CONCAT(""sahf4d2fdd45"", id))
</code></pre>
","<p>Use <a href=""http://dev.mysql.com/doc/refman/5.0/en/information-functions.html#function_last-insert-id""><code>LAST_INSERT_ID()</code></a> from your SQL query.</p>

<p>Or</p>

<p>You can also use <a href=""http://php.net/manual/en/function.mysql-insert-id.php""><code>mysql_insert_id()</code></a> to get it using PHP.</p>
","6761436"
"MySQL/SQL: Group by date only on a Datetime column","161318","","<p>Having a table with a column like: <code>mydate DATETIME</code> ...</p>

<p>I have a query such as:</p>

<pre><code>SELECT SUM(foo), mydate FROM a_table GROUP BY a_table.mydate;
</code></pre>

<p>This will group by the full <code>datetime</code>, including hours and minutes. I wish to make the group by, only by the date <code>YYYY/MM/DD</code> not by the <code>YYYY/MM/DD/HH/mm</code>.</p>

<p>Anyone know how to do this? I can still do it (as I am atm), dynamically in my code, but I'm cleaning trash code and this can be made through the SQL I just can't find out how :(.</p>
","<p>Cast the datetime to a date, then GROUP BY using this syntax:</p>

<pre><code>SELECT SUM(foo), DATE(mydate) FROM a_table GROUP BY DATE(a_table.mydate);
</code></pre>

<p>Or you can GROUP BY the alias as @orlandu63 suggested:</p>

<pre><code>SELECT SUM(foo), DATE(mydate) DateOnly FROM a_table GROUP BY DateOnly;
</code></pre>

<p>Though I don't think it'll make any difference to performance, it is a little clearer.</p>
","366610"
"Check if a parameter is null or empty in a stored procedure","161309","","<p>I know how to check if a parameter is null but i am not sure how to check if its empty ... I have these parameters and I want to check the previous parameters are empty or null and then set them like below</p>

<pre><code>ALTER PROCEDURE [dbo].[GetSummary]
    @PreviousStartDate NVARCHAR(50) ,
    @PreviousEndDate NVARCHAR(50) ,
    @CurrentStartDate NVARCHAR(50) ,
    @CurrentEndDate NVARCHAR(50)
AS
  BEGIN
    IF(@PreviousStartDate IS NULL OR EMPTY)
        SET @PreviousStartdate = '01/01/2010'  for example..
</code></pre>

<p>I would appreciate the help.</p>
","<p>I sometimes use <a href=""https://msdn.microsoft.com/en-us/library/ms177562.aspx"" rel=""noreferrer"">NULLIF</a> like so...</p>

<pre><code>IF NULLIF(@PreviousStartDate, '') IS NULL
</code></pre>

<p>There's probably no reason it's better than the way suggested by @Oded and @bluefeet, just stylistic preference.</p>

<p>@danihp's method is really cool but my tired old brain wouldn't go to COALESCE when I'm thinking is null or empty :-)</p>
","9855405"
"How to delete the top 1000 rows from a table using Sql Server 2008?","161234","","<p>I have a table in SQL Server.  I would like to delete the top 1000 rows from it.  However, I tried this, but I instead of just deleting the top 1000 rows it deleted all the rows in the table.</p>

<p>Here is the code:</p>

<pre><code>delete from [mytab] 
select top 1000 
a1,a2,a3
from [mytab]
</code></pre>
","<p>The code you tried is in fact two statements. A <code>DELETE</code> followed by a <code>SELECT</code>.</p>

<p>You don't define <code>TOP</code> as ordered by what.</p>

<p>For a specific ordering criteria deleting from a <a href=""https://technet.microsoft.com/en-us/library/ms190766(v=sql.105).aspx"" rel=""noreferrer"">CTE</a> or similar table expression is the most efficient way.</p>

<pre><code>;WITH CTE AS
(
SELECT TOP 1000 *
FROM [mytab]
ORDER BY a1
)
DELETE FROM CTE
</code></pre>
","8956164"
"Best database field type for a URL","160983","","<p>I need to store a url in a MySQL table. What's the best practice for defining a field that will hold a URL with an undetermined length?</p>
","<blockquote>
  <ol>
  <li><p><a href=""http://www.boutell.com/newfaq/misc/urllength.html"" rel=""noreferrer"">Lowest common denominator max URL length among popular web browsers: <strong>2,083</strong> (Internet Explorer)</a></p></li>
  <li><p><a href=""http://dev.mysql.com/doc/refman/5.0/en/char.html"" rel=""noreferrer"">http://dev.mysql.com/doc/refman/5.0/en/char.html</a><br>
  <em>Values in VARCHAR columns are variable-length strings. The length can be specified as a value from 0 to 255 before MySQL 5.0.3, and 0 to 65,535 in 5.0.3 and later versions. The effective maximum length of a VARCHAR in MySQL 5.0.3 and later is subject to the maximum row size (65,535 bytes, which is shared among all columns) and the character set used.</em></p></li>
  <li><p>So ...<br>
  &lt; MySQL 5.0.3 use <strong>TEXT</strong><br>
  or<br>
  &gt;= MySQL 5.0.3 use <strong>VARCHAR(2083)</strong></p></li>
  </ol>
</blockquote>
","219664"
"Change Schema Name Of Table In SQL","160616","","<p>I want to change schema name of table <code>Employees</code> in Database. In the current table <code>Employees</code> database schema name is <code>dbo</code> I want to change it to <code>exe</code>. How can I do it ? </p>

<p>Example:</p>

<p>FROM </p>

<pre><code>dbo.Employees
</code></pre>

<p>TO</p>

<pre><code>exe.Employees
</code></pre>

<p>I tried with this query:</p>

<pre><code>ALTER SCHEMA exe TRANSFER dbo.Employees
</code></pre>

<p>But this gives me an error:</p>

<blockquote>
  <p>Cannot alter the schema 'exe', because it does not exist or you do not
  have permission.</p>
</blockquote>

<p>What did I miss? </p>
","<p><strong>Create Schema :</strong></p>

<pre><code>IF (NOT EXISTS (SELECT * FROM sys.schemas WHERE name = 'exe')) 
BEGIN
    EXEC ('CREATE SCHEMA [exe] AUTHORIZATION [dbo]')
END
</code></pre>

<p><strong>ALTER Schema :</strong> </p>

<pre><code>ALTER SCHEMA exe 
    TRANSFER dbo.Employees
</code></pre>
","15483172"
"Simple way to calculate median with MySQL","160314","","<p>What's the simplest (and hopefully not too slow) way to calculate the median with MySQL? I've used <code>AVG(x)</code> for finding the mean, but I'm having a hard time finding a simple way of calculating the median. For now, I'm returning all the rows to PHP, doing a sort, and then picking the middle row, but surely there must be some simple way of doing it in a single MySQL query.</p>

<p>Example data:</p>

<pre><code>id | val
--------
 1    4
 2    7
 3    2
 4    2
 5    9
 6    8
 7    3
</code></pre>

<p>Sorting on <code>val</code> gives <code>2 2 3 4 7 8 9</code>, so the median should be <code>4</code>, versus <code>SELECT AVG(val)</code> which == <code>5</code>.</p>
","<p>The problem with the proposed solution (TheJacobTaylor) is runtime.  Joining the table to itself is slow as molasses for large datasets.  My proposed alternative runs in mysql, has awesome runtime, uses an explicit ORDER BY statement, so you don't have to hope your indexes ordered it properly to give a correct result, and is easy to unroll the query to debug.</p>

<pre><code>SELECT avg(t1.val) as median_val FROM (
SELECT @rownum:=@rownum+1 as `row_number`, d.val
  FROM data d,  (SELECT @rownum:=0) r
  WHERE 1
  -- put some where clause here
  ORDER BY d.val
) as t1, 
(
  SELECT count(*) as total_rows
  FROM data d
  WHERE 1
  -- put same where clause here
) as t2
WHERE 1
AND t1.row_number in ( floor((total_rows+1)/2), floor((total_rows+2)/2) );
</code></pre>

<p>[edit]
Added avg() around t1.val and row_number in(...) to correctly produce a median when there are an even number of records.  Reasoning:</p>

<pre><code>SELECT floor((3+1)/2),floor((3+2)/2);#total_rows is 3, so avg row_numbers 2 and 2
SELECT floor((4+1)/2),floor((4+2)/2);#total_rows is 4, so avg row_numbers 2 and 3
</code></pre>
","7263925"
"Creating a search form in PHP to search a database?","160305","","<p>I am currently trying to complete a project where the specifications are to use a search form to search through a packaging database. The database has lots of variables ranging from Sizes, names, types and meats. I need to create a search form where users can search using a number of different searches (such as searching for a lid tray that is 50 cm long). </p>

<p>I have spent all day trying to create some PHP code that can search for info within a test database I created. I have had numerous amounts of errors ranging from mysql_fetch_array errors, boolean errors and now currently my latest error is that my table doesn't seem to exist. Although i can enter data into it (html and php pages where I can enter data), I don't know what is causing this and I have started again a few times now. </p>

<p>Can anyone give me some idea or tips of what I am going to have to do currently? Here is just my small tests at the moment before I move onto the actual sites SQL database. </p>

<p><em>Creation of database:</em> </p>

<pre><code> &lt;body&gt;
  &lt;?php
     $con = mysql_connect(""localhost"", ""root"", """");
      if (!$con)
     {
      die('Could not connect: ' . mysql_error());
     }
      if (mysql_query(""CREATE DATABASE db_test"", $con))
     {
  echo ""Database created"";
     }
      else
    {
  echo ""Error creating database: "" . mysql_error();
    }


  mysql_select_db(""db_test"", $con);
  $sql = ""CREATE TABLE Liam
   ( 
  Code varchar (30),
  Description varchar (30),
  Category varchar (30),
  CutSize varchar (30),
   )"";

 mysql_query($sql, $con);
     mysql_close($con);
 ?&gt; 
   &lt;/body&gt;
</code></pre>

<p><em>HTML search form page:</em> </p>

<pre><code>&lt;body&gt;

      &lt;form action=""form.php"" method=""post""&gt;
        Search: &lt;input type=""text"" name=""term"" /&gt;&lt;br /&gt;
      &lt;input type=""submit"" name=""submit"" value=""Submit"" /&gt;
      &lt;/form&gt;

&lt;/body&gt;
</code></pre>

<p><em>The PHP code I am using to attempt to gather info from the database</em>
(I have rewritten this a few times, this code also displays the ""table.liam doesn't exist"")</p>

<pre><code>  &lt;body&gt;
   &lt;?php
 $con = mysql_connect (""localhost"", ""root"", """");
 mysql_select_db (""db_test"", $con);

  if (!$con)
    { 
    die (""Could not connect: "" . mysql_error());
    } 
    $sql = mysql_query(""SELECT * FROM Liam WHERE Description LIKE '%term%'"") or die
        (mysql_error());

       while ($row = mysql_fetch_array($sql)){
    echo 'Primary key: ' .$row['PRIMARYKEY'];
    echo '&lt;br /&gt; Code: ' .$row['Code'];
    echo '&lt;br /&gt; Description: '.$row['Description'];
    echo '&lt;br /&gt; Category: '.$row['Category'];
    echo '&lt;br /&gt; Cut Size: '.$row['CutSize']; 
  }

  mysql_close($con)
   ?&gt;
     &lt;/body&gt;
</code></pre>

<p>If anyone has any insight or can help me with this I would be very grateful! Thanks in advance.</p>
","<p>try this out let me know what happens.</p>

<p>Form:</p>

<pre><code>&lt;form action=""form.php"" method=""post""&gt; 
Search: &lt;input type=""text"" name=""term"" /&gt;&lt;br /&gt; 
&lt;input type=""submit"" value=""Submit"" /&gt; 
&lt;/form&gt; 
</code></pre>

<p>Form.php:</p>

<pre><code>$term = mysql_real_escape_string($_REQUEST['term']);    

$sql = ""SELECT * FROM liam WHERE Description LIKE '%"".$term.""%'"";
$r_query = mysql_query($sql);

while ($row = mysql_fetch_array($r_query)){ 
echo 'Primary key: ' .$row['PRIMARYKEY']; 
echo '&lt;br /&gt; Code: ' .$row['Code']; 
echo '&lt;br /&gt; Description: '.$row['Description']; 
echo '&lt;br /&gt; Category: '.$row['Category']; 
echo '&lt;br /&gt; Cut Size: '.$row['CutSize'];  
} 
</code></pre>

<p>Edit: Cleaned it up a little more.</p>

<p>Final Cut (my test file):</p>

<pre><code>&lt;?php
$db_hostname = 'localhost';
$db_username = 'demo';
$db_password = 'demo';
$db_database = 'demo';

// Database Connection String
$con = mysql_connect($db_hostname,$db_username,$db_password);
if (!$con)
  {
  die('Could not connect: ' . mysql_error());
  }

mysql_select_db($db_database, $con);
?&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang=""en""&gt;
    &lt;head&gt;
        &lt;meta charset=""utf-8"" /&gt;
        &lt;title&gt;&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
&lt;form action="""" method=""post""&gt;  
Search: &lt;input type=""text"" name=""term"" /&gt;&lt;br /&gt;  
&lt;input type=""submit"" value=""Submit"" /&gt;  
&lt;/form&gt;  
&lt;?php
if (!empty($_REQUEST['term'])) {

$term = mysql_real_escape_string($_REQUEST['term']);     

$sql = ""SELECT * FROM liam WHERE Description LIKE '%"".$term.""%'""; 
$r_query = mysql_query($sql); 

while ($row = mysql_fetch_array($r_query)){  
echo 'Primary key: ' .$row['PRIMARYKEY'];  
echo '&lt;br /&gt; Code: ' .$row['Code'];  
echo '&lt;br /&gt; Description: '.$row['Description'];  
echo '&lt;br /&gt; Category: '.$row['Category'];  
echo '&lt;br /&gt; Cut Size: '.$row['CutSize'];   
}  

}
?&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
","12747908"
"Getting list of tables, and fields in each, in a database","160027","","<p>I'm looking at creating a basic ORM (purely for fun), and was wondering, is there a way to return the list of tables in a database and also the fields for every table?</p>

<p>Using this, I want to be able to loop through the result set (in C#) and then say for each table in the result set, do this (e.g. use reflection to make a class that will do or contain xyz).</p>

<p>Further to this, what are some good online blogs for SQL Server? I know this question is really about using system SPs and databases in Sql Server, and I am ok with general queries, so I'm interested in some blogs which cover this sort of functionality.</p>

<p>Thanks</p>
","<p>Is this what you are looking for:</p>

<p><strong>Using OBJECT CATALOG VIEWS</strong></p>

<pre><code> SELECT T.name AS Table_Name ,
       C.name AS Column_Name ,
       P.name AS Data_Type ,
       P.max_length AS Size ,
       CAST(P.precision AS VARCHAR) + '/' + CAST(P.scale AS VARCHAR) AS Precision_Scale
FROM   sys.objects AS T
       JOIN sys.columns AS C ON T.object_id = C.object_id
       JOIN sys.types AS P ON C.system_type_id = P.system_type_id
WHERE  T.type_desc = 'USER_TABLE';
</code></pre>

<p><strong>Using INFORMATION SCHEMA VIEWS</strong></p>

<pre><code>  SELECT TABLE_SCHEMA ,
       TABLE_NAME ,
       COLUMN_NAME ,
       ORDINAL_POSITION ,
       COLUMN_DEFAULT ,
       DATA_TYPE ,
       CHARACTER_MAXIMUM_LENGTH ,
       NUMERIC_PRECISION ,
       NUMERIC_PRECISION_RADIX ,
       NUMERIC_SCALE ,
       DATETIME_PRECISION
FROM   INFORMATION_SCHEMA.COLUMNS;
</code></pre>

<p>Reference : My Blog - <a href=""http://dbalink.wordpress.com/2008/10/24/querying-the-object-catalog-and-information-schema-views/"" rel=""noreferrer"">http://dbalink.wordpress.com/2008/10/24/querying-the-object-catalog-and-information-schema-views/</a> </p>
","421229"
"SQL ON DELETE CASCADE, Which Way Does the Deletion Occur?","159895","","<p>If I have two relations in a database, like this:</p>

<pre><code>CREATE TABLE Courses (
  CourseID int NOT NULL PRIMARY KEY,
  Course VARCHAR(63) NOT NULL UNIQUE,
  Code CHAR(4) NOT NULL UNIQUE
);

CREATE TABLE BookCourses (
  EntryID int NOT NULL PRIMARY KEY,
  BookID int NOT NULL,
  Course CHAR(4) NOT NULL,
  CourseNum CHAR(3) NOT NULL,
  CourseSec CHAR(1) NOT NULL
);
</code></pre>

<p>and I establish a foreign key relationship between the two, like this:</p>

<pre><code>ALTER TABLE BookCourses
ADD FOREIGN KEY (Course)
REFERENCES Courses(Code)
ON DELETE CASCADE;
</code></pre>

<p>Then you can see that the <code>Course</code> attribute in the <code>BookCourses</code> relation references the <code>Code</code> attribute in the <code>Courses</code> relation.</p>

<p>My question is when a deletion occurs in either of the two relations, which way does the deletion cascade? If I delete a tuple in the <code>Courses</code> relation, will it delete all referencing tuples in the <code>BookCourses</code> relation, or is it the other way around?</p>

<p>Thank you for your time.</p>
","<p>Cascade will work when you delete something on table <code>Courses</code>. Any record on table <code>BookCourses</code> that has reference to table <code>Courses</code> will also be deleted.</p>

<p>But when you try to delete on table <code>BookCourses</code> only the table itself is affected and not on the <code>Courses</code></p>

<p><em>follow-up question: why do you have <code>CourseID</code> on table Category?</em></p>

<p>Maybe you should restructure your schema into this,</p>

<pre><code>CREATE TABLE Categories 
(
  Code CHAR(4) NOT NULL PRIMARY KEY,
  CategoryName VARCHAR(63) NOT NULL UNIQUE
);

CREATE TABLE Courses 
(
  CourseID INT NOT NULL PRIMARY KEY,
  BookID INT NOT NULL,
  CatCode CHAR(4) NOT NULL,
  CourseNum CHAR(3) NOT NULL,
  CourseSec CHAR(1) NOT NULL,
);

ALTER TABLE Courses
ADD FOREIGN KEY (CatCode)
REFERENCES Categories(Code)
ON DELETE CASCADE;
</code></pre>
","13444888"
"SQL Server converting varbinary to string","159808","","<p>I want to do conversion in T-SQL from a <code>varbinary</code> type to string type</p>

<p>Here is an example :</p>

<p>First I got this <code>varbinary</code></p>

<pre><code>0x21232F297A57A5A743894A0E4A801FC3
</code></pre>

<p>And then I want to convert it to </p>

<pre><code>21232f297a57a5a743894a0e4a801fc3
</code></pre>

<p>How to do this?</p>
","<p>Try:</p>

<pre><code>DECLARE @varbinaryField varbinary(max);
SET @varbinaryField = 0x21232F297A57A5A743894A0E4A801FC3;

SELECT CONVERT(varchar(max),@varbinaryField,2), 
@varbinaryField
</code></pre>

<p>UPDATED:
For SQL Server 2008</p>
","12139130"
"Return Boolean Value on SQL Select Statement","159536","","<p>How to return a boolean value on SQL Select Statement?</p>

<p>I tried this code:</p>

<pre><code>SELECT CAST(1 AS BIT) AS Expr1
FROM [User]
WHERE (UserID = 20070022)
</code></pre>

<p>and only return <code>TRUE</code> value if the <code>UserID</code> exist on the table. I want it to return <code>FALSE</code> value if the <code>UserID</code> doesn't exist on the table. Thank you very much.</p>
","<p>What you have there will return no row at all if the user doesn't exist. Here's what you need:</p>

<pre><code>SELECT CASE WHEN EXISTS (
    SELECT *
    FROM [User]
    WHERE UserID = 20070022
)
THEN CAST(1 AS BIT)
ELSE CAST(0 AS BIT) END
</code></pre>
","10377792"
"How to write subquery inside the OUTER JOIN Statement","159393","","<p>I want to join two table CUSTMR and DEPRMNT.</p>

<p>My needed is: LEFT OUTER JOIN OF two or more Tables with subquery inside the LEFT OUTER JOIN as shown below:</p>

<p>Table: CUSTMR , DEPRMNT</p>

<p>Query as:</p>

<pre><code>SELECT
    cs.CUSID
    ,dp.DEPID
FROM
    CUSTMR cs
        LEFT OUTER JOIN (
            SELECT
                    dp.DEPID
                    ,dp.DEPNAME
                FROM
                    DEPRMNT dp
                WHERE
                    dp.DEPADDRESS = 'TOKYO'
        )
            ON (
                dp.DEPID = cs.CUSID
                AND cs.CUSTNAME = dp.DEPNAME
            )
WHERE
    cs.CUSID != ''
</code></pre>

<p>Here the subquery is:</p>

<pre><code>SELECT
    dp.DEPID, dp.DEPNAME
FROM
    DEPRMNT dp
WHERE
    dp.DEPADDRESS = 'TOKYO'
</code></pre>

<p>Is it possible to write such subquery inside LEFT OUTER JOIN?</p>

<p>I am getting an error when running this query on my DB2 database.</p>
","<p>You need the ""correlation id"" (the ""AS SS"" thingy)  on the sub-select to reference the fields in the ""ON"" condition. The id's assigned inside the sub select are not usable in the join.</p>

<pre><code>SELECT
       cs.CUSID
       ,dp.DEPID
FROM
    CUSTMR cs
        LEFT OUTER JOIN (
            SELECT
                    DEPID
                    ,DEPNAME
                FROM
                    DEPRMNT 
                WHERE
                    dp.DEPADDRESS = 'TOKYO'
        ) ss
            ON (
                ss.DEPID = cs.CUSID
                AND ss.DEPNAME = cs.CUSTNAME
            )
WHERE
    cs.CUSID != '' 
</code></pre>
","10493606"
"Timestamp conversion in Oracle for YYYY-MM-DD HH:MM:SS format","159353","","<p>I'm trying to insert records with <code>YYYY-MM-DD HH:MM:SS</code> format into Oracle from Netezza, but I'm getting invalid date type. </p>

<p>How can I accomplish this one?</p>

<pre><code>CREATE TABLE AM_PROGRAM_TUNING_EVENT_TMP1
(
    ST TIMESTAMP,
    ET TIMESTAMP,
    MAS_DIV_KEY INTEGER NOT NULL,
    SBSC_GUID_KEY INTEGER NOT NULL,
    STN_KEY INTEGER NOT NULL
 );


INSERT INTO  AM_PROGRAM_TUNING_EVENT_TMP1 VALUES('2012-03-28 11:10:00','2012-03-28 11:30:00',1,3636815,151);
</code></pre>
","<pre><code>INSERT INTO AM_PROGRAM_TUNING_EVENT_TMP1 
VALUES(TO_DATE('2012-03-28 11:10:00','yyyy/mm/dd hh24:mi:ss'));
</code></pre>

<p><a href=""http://www.sqlfiddle.com/#!4/22115/1"" rel=""noreferrer"">http://www.sqlfiddle.com/#!4/22115/1</a></p>
","10320085"
"How to install MySQLi","159322","","<p>I cannot find instructions about installing MySQLi on a Mac. Just to be clear, MySQL is up to date and I am running PHP 5. How do I install it? Where do I even get it from? Thanks for your help. I'll be giving an up vote and a check mark to whoever answers this!</p>
","<p>MySQLi is part of PHP. There should be a php-mysqli type package available, or you can take the PHP source and recompile that mysqli enabled. You may already have it installed, but it's done as a module and is disabled. Check your php.ini for <code>extension=mysqli.so</code> or similar. it may be commented out, or the .so file is present in your extensions directory but not linked to PHP via that extension= directive.</p>
","7250437"
"WHERE vs HAVING","158706","","<p>Why do you need to place columns you create yourself (for example <code>select 1 as ""number""</code>) after <code>HAVING</code> and not <code>WHERE</code> in MySQL?</p>

<p>And are there any downsides instead of doing <code>WHERE 1</code> (writing the whole definition instead of a column name)?</p>
","<blockquote>
  <p>Why is it that you need to place columns you create yourself (for example ""select 1 as number"") after HAVING and not WHERE in MySQL?</p>
</blockquote>

<p><code>WHERE</code> is applied before <code>GROUP BY</code>, <code>HAVING</code> is applied after (and can filter on aggregates).</p>

<p>In general, you can reference aliases in neither of these clauses, but <code>MySQL</code> allows referencing <code>SELECT</code> level aliases in <code>GROUP BY</code>, <code>ORDER BY</code> and <code>HAVING</code>.</p>

<blockquote>
  <p>And are there any downsides instead of doing ""WHERE 1"" (writing the whole definition instead of a column name)</p>
</blockquote>

<p>If your calculated expression does not contain any aggregates, putting it into the <code>WHERE</code> clause will most probably be more efficient.</p>
","2905312"
"How to connect to SQL Server from another computer?","158700","","<p>I want to connect from home using SQL Server 2005 to another PC.</p>

<p>I had a look on the msd...but before connecting it says I should connect to another computer
using the computer management and it didn't work out....I can only connect to computers from my workgroup? </p>

<p>Thanks,
Luisa</p>
","<p>If you want to connect to SQL server remotly you need to use a software - like Sql Server Management studio.</p>

<p>The computers doesn't need to be on the same network - but they must be able to connect each other using a communication protocol like tcp/ip, and the server must be set up to support incoming connection of the type you choose.</p>

<p>if you want to connect to another computer (to browse files ?) you use other tools, and not sql server (you can map a drive and access it through there ect...)</p>

<p>To Enable SQL connection using tcp/ip read this article:</p>

<p>For Sql Express: <a href=""http://www.linglom.com/2009/03/28/enable-remote-connection-on-sql-server-2008-express/"" rel=""nofollow noreferrer"">express</a>
For Sql 2008: <a href=""http://msdn.microsoft.com/en-us/library/ms191294.aspx"" rel=""nofollow noreferrer"">2008</a></p>

<p>Make sure you enable access through the machine firewall as well.</p>

<p>You might need to install either SSMS or Toad on the machine your using to connect to the server. both you can download from their's company web site.</p>
","2486656"
"Simple PHP Pagination script","158596","","<p>I have rows of data coming from database, I would like to have a table with a simple pagination, what is the easiest way of doing it?<br>
I'd be glad if anyone could provide.</p>
","<p>This is a mix of HTML and code but it's pretty basic, easy to understand and should be fairly simple to decouple to suit your needs I think.</p>

<pre><code>try {

    // Find out how many items are in the table
    $total = $dbh-&gt;query('
        SELECT
            COUNT(*)
        FROM
            table
    ')-&gt;fetchColumn();

    // How many items to list per page
    $limit = 20;

    // How many pages will there be
    $pages = ceil($total / $limit);

    // What page are we currently on?
    $page = min($pages, filter_input(INPUT_GET, 'page', FILTER_VALIDATE_INT, array(
        'options' =&gt; array(
            'default'   =&gt; 1,
            'min_range' =&gt; 1,
        ),
    )));

    // Calculate the offset for the query
    $offset = ($page - 1)  * $limit;

    // Some information to display to the user
    $start = $offset + 1;
    $end = min(($offset + $limit), $total);

    // The ""back"" link
    $prevlink = ($page &gt; 1) ? '&lt;a href=""?page=1"" title=""First page""&gt;&amp;laquo;&lt;/a&gt; &lt;a href=""?page=' . ($page - 1) . '"" title=""Previous page""&gt;&amp;lsaquo;&lt;/a&gt;' : '&lt;span class=""disabled""&gt;&amp;laquo;&lt;/span&gt; &lt;span class=""disabled""&gt;&amp;lsaquo;&lt;/span&gt;';

    // The ""forward"" link
    $nextlink = ($page &lt; $pages) ? '&lt;a href=""?page=' . ($page + 1) . '"" title=""Next page""&gt;&amp;rsaquo;&lt;/a&gt; &lt;a href=""?page=' . $pages . '"" title=""Last page""&gt;&amp;raquo;&lt;/a&gt;' : '&lt;span class=""disabled""&gt;&amp;rsaquo;&lt;/span&gt; &lt;span class=""disabled""&gt;&amp;raquo;&lt;/span&gt;';

    // Display the paging information
    echo '&lt;div id=""paging""&gt;&lt;p&gt;', $prevlink, ' Page ', $page, ' of ', $pages, ' pages, displaying ', $start, '-', $end, ' of ', $total, ' results ', $nextlink, ' &lt;/p&gt;&lt;/div&gt;';

    // Prepare the paged query
    $stmt = $dbh-&gt;prepare('
        SELECT
            *
        FROM
            table
        ORDER BY
            name
        LIMIT
            :limit
        OFFSET
            :offset
    ');

    // Bind the query params
    $stmt-&gt;bindParam(':limit', $limit, PDO::PARAM_INT);
    $stmt-&gt;bindParam(':offset', $offset, PDO::PARAM_INT);
    $stmt-&gt;execute();

    // Do we have any results?
    if ($stmt-&gt;rowCount() &gt; 0) {
        // Define how we want to fetch the results
        $stmt-&gt;setFetchMode(PDO::FETCH_ASSOC);
        $iterator = new IteratorIterator($stmt);

        // Display the results
        foreach ($iterator as $row) {
            echo '&lt;p&gt;', $row['name'], '&lt;/p&gt;';
        }

    } else {
        echo '&lt;p&gt;No results could be displayed.&lt;/p&gt;';
    }

} catch (Exception $e) {
    echo '&lt;p&gt;', $e-&gt;getMessage(), '&lt;/p&gt;';
}
</code></pre>
","3707457"
"mysql delete under safe mode","158530","","<p>I have a table instructor and I want to delete the records that have salary in a range
An intuitive way is like this: </p>

<pre><code>delete from instructor where salary between 13000 and 15000;
</code></pre>

<p>However, under safe mode, I cannot delete a record without providing a primary key(ID).</p>

<p>So I write the following sql: </p>

<pre><code>delete from instructor where ID in (select ID from instructor where salary between 13000 and 15000);
</code></pre>

<p>However, there is an error:</p>

<pre><code>You can't specify target table 'instructor' for update in FROM clause
</code></pre>

<p>I am confused because when I write</p>

<pre><code>select * from instructor where ID in (select ID from instructor where salary between 13000 and 15000);
</code></pre>

<p>it does not produce an error.</p>

<p>My question is:</p>

<ol>
<li>what does this error message really mean and why my code is wrong?</li>
<li>how to rewrite this code to make it work under safe mode?</li>
</ol>

<p>Thanks!</p>
","<p>Googling around, the popular answer seems to be <a href=""https://stackoverflow.com/questions/11448068/mysql-error-code-1175-during-update-in-mysql-workbench"">""just turn off safe mode""</a>:</p>

<pre><code>SET SQL_SAFE_UPDATES = 0;
DELETE FROM instructor WHERE salary BETWEEN 13000 AND 15000;
SET SQL_SAFE_UPDATES = 1;
</code></pre>

<p>If I'm honest, I can't say I've ever made a habit of running in safe mode. Still, I'm not entirely comfortable with this answer since it just assumes you should go change your database config every time you run into a problem.</p>

<p>So, your second query is closer to the mark, but hits another problem: MySQL applies a few restrictions to subqueries, and one of them is that you can't modify a table while selecting from it in a subquery.</p>

<p>Quoting from the MySQL manual, <a href=""https://dev.mysql.com/doc/refman/4.1/en/subquery-restrictions.html"" rel=""noreferrer"">Restrictions on Subqueries</a>:</p>

<blockquote>
  <p>In general, you cannot modify a table and select from the same table
  in a subquery. For example, this limitation applies to statements of
  the following forms:</p>

<pre><code>DELETE FROM t WHERE ... (SELECT ... FROM t ...);
UPDATE t ... WHERE col = (SELECT ... FROM t ...);
{INSERT|REPLACE} INTO t (SELECT ... FROM t ...);
</code></pre>
  
  <p>Exception: The preceding prohibition does not apply if you are using a subquery for the modified table in the FROM clause. Example:</p>

<pre><code>UPDATE t ... WHERE col = (SELECT * FROM (SELECT ... FROM t...) AS _t ...);
</code></pre>
  
  <p>Here the result from the subquery in the FROM clause is stored as a temporary table, so the relevant rows in t have already been selected by the time the update to t takes place.</p>
</blockquote>

<p>That last bit is your answer. Select target IDs in a temporary table, then delete by referencing the IDs in that table:</p>

<pre><code>DELETE FROM instructor WHERE id IN (
  SELECT temp.id FROM (
    SELECT id FROM instructor WHERE salary BETWEEN 13000 AND 15000
  ) AS temp
);
</code></pre>

<p><a href=""http://sqlfiddle.com/#!2/47921/1"" rel=""noreferrer"">SQLFiddle demo</a>.</p>
","21841657"
"Using IF ELSE statement based on Count to execute different Insert statements","158205","","<p>While I am searching through my database, I run an INSERT statement if I find that a particular item does not exist, and I run a different INSERT statement if I find one or more of this item.</p>

<p>I am not entirely sure how to use the IF ELSE expressions.</p>

<p>What I have so far is a statement that will count the number of times the target data appears; it will print TRUE if it is greater than 0, if not, it will print FALSE. I can't find any examples to help me understand how I can use this to run two different INSERT statements.</p>

<p>Here is what I have so far:</p>

<pre><code>SELECT CASE WHEN COUNT(*)&gt;0 THEN 'TRUE' ELSE 'FALSE' END
(
  SELECT [Some Column], COUNT(*) TotalCount
  FROM INCIDENTS
  WHERE [Some Column] = 'Target Data'
  GROUP BY [Some Column]
)
</code></pre>
","<p>Depending on your needs, here are a couple of ways:</p>

<pre><code>IF EXISTS (SELECT * FROM TABLE WHERE COLUMN = 'SOME VALUE')
    --INSERT SOMETHING
ELSE
    --INSERT SOMETHING ELSE
</code></pre>

<p>Or a bit longer</p>

<pre><code>DECLARE @retVal int

SELECT @retVal = COUNT(*) 
FROM TABLE
WHERE COLUMN = 'Some Value'

IF (@retVal &gt; 0)
BEGIN
    --INSERT SOMETHING
END
ELSE
BEGIN
    --INSERT SOMETHING ELSE
END 
</code></pre>
","14072357"
"MySQL ""Group By"" and ""Order By""","158128","","<p>I want to be able to select a bunch of rows from a table of e-mails and group them by the from sender.  My query looks like this:</p>

<pre><code>SELECT 
    `timestamp`, `fromEmail`, `subject`
FROM `incomingEmails` 
GROUP BY LOWER(`fromEmail`) 
ORDER BY `timestamp` DESC
</code></pre>

<p>The query almost works as I want it — it selects records grouped by e-mail. The problem is that the subject and timestamp don't correspond to the most recent record for a particular e-mail address.</p>

<p>For example, it might return:</p>

<pre><code>fromEmail: john@example.com, subject: hello
fromEmail: mark@example.com, subject: welcome
</code></pre>

<p>When the records in the database are:</p>

<pre><code>fromEmail: john@example.com, subject: hello
fromEmail: john@example.com, subject: programming question
fromEmail: mark@example.com, subject: welcome
</code></pre>

<p>If the ""programming question"" subject is the most recent, how can I get MySQL to select that record when grouping the e-mails?</p>
","<p>A simple solution is to wrap the query into a subselect with the ORDER statement <em>first</em> and applying the GROUP BY <em>later</em>:</p>

<pre><code>SELECT * FROM ( 
    SELECT `timestamp`, `fromEmail`, `subject`
    FROM `incomingEmails` 
    ORDER BY `timestamp` DESC
) AS tmp_table GROUP BY LOWER(`fromEmail`)
</code></pre>

<p>This is similar to using the join but looks much nicer. </p>

<p>Using non-aggregate columns in a SELECT with a GROUP BY clause is non-standard. MySQL will generally return the values of the first row it finds and discard the rest. Any ORDER BY clauses will only apply to the returned column value, not to the discarded ones. </p>

<p><strong>IMPORTANT UPDATE</strong>
Selecting non-aggregate columns used to work in practice but should not be relied upon. Per the <a href=""https://dev.mysql.com/doc/refman/5.6/en/group-by-handling.html"" rel=""noreferrer"">MySQL documentation</a> ""this is useful primarily when all values in each nonaggregated column not named in the GROUP BY are the same for each group. The server is <strong>free to choose any value</strong> from each group, so <strong>unless they are the same, the values chosen are indeterminate</strong>.""  </p>

<p>As of 5.6.21 I have noticed issues with the GROUP BY on the temporary table reverting the ORDER BY sorting. </p>

<p>As of <a href=""https://dev.mysql.com/doc/refman/5.7/en/group-by-handling.html"" rel=""noreferrer"">5.7.5</a> ONLY_FULL_GROUP_BY is enabled by default, i.e. it's impossible to use non-aggregate columns.  </p>

<p>See
<a href=""http://www.cafewebmaster.com/mysql-order-sort-group"" rel=""noreferrer"">http://www.cafewebmaster.com/mysql-order-sort-group</a>
<a href=""https://dev.mysql.com/doc/refman/5.6/en/group-by-handling.html"" rel=""noreferrer"">https://dev.mysql.com/doc/refman/5.6/en/group-by-handling.html</a>
<a href=""https://dev.mysql.com/doc/refman/5.7/en/group-by-handling.html"" rel=""noreferrer"">https://dev.mysql.com/doc/refman/5.7/en/group-by-handling.html</a></p>
","9797138"
"How to replace blank (null ) values with 0 for all records?","158031","","<p>MS Access: How to replace blank (null ) values with 0 for all records?</p>

<p>I guess it has to be done using SQL. I can use Find and Replace to replace 0 with blank, but not the other way around (won't ""find"" a blank, even if I enter [Ctrl-Spacebar] which inserts a space.</p>

<p>So I guess I need to do SQL where I find null values for MyField, then replace all of them with 0.</p>
","<p>Go to the query designer window, switch to SQL mode, and try this:</p>

<pre><code>Update Table Set MyField = 0
Where MyField Is Null; 
</code></pre>
","1977144"
"Using DISTINCT and COUNT together in a MySQL Query","158028","","<p>Is something like this possible:</p>

<pre><code>SELECT DISTINCT COUNT(productId) WHERE keyword='$keyword'
</code></pre>

<p>What I want is to get the number of unique product Ids which are associated with a keyword. The same product may be associated twice with a keyword, or more, but i would like only 1 time to be counted per product ID</p>
","<p>use </p>

<pre><code>SELECT COUNT(DISTINCT productId) from  table_name WHERE keyword='$keyword'
</code></pre>
","1002363"
"Best data type for storing currency values in a MySQL database","157984","","<p>What is the best SQL data type for currency values?  I'm using MySQL but would prefer a database independent type.</p>
","<p>Something like <code>Decimal(19,4)</code> usually works pretty well in most cases. You can adjust the scale and precision to fit the needs of the numbers you need to store. Even in SQL Server, I tend not to use ""<code>money</code>"" as it's non-standard.</p>
","628639"
"You can't specify target table for update in FROM clause","157883","","<p>I have a simple mysql table:</p>

<pre><code>CREATE TABLE IF NOT EXISTS `pers` (
  `persID` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(35) NOT NULL,
  `gehalt` int(11) NOT NULL,
  `chefID` int(11) DEFAULT NULL,
  PRIMARY KEY (`persID`)
) ENGINE=MyISAM  DEFAULT CHARSET=latin1 AUTO_INCREMENT=4 ;

INSERT INTO `pers` (`persID`, `name`, `gehalt`, `chefID`) VALUES
(1, 'blb', 1000, 3),
(2, 'as', 1000, 3),
(3, 'chef', 1040, NULL);
</code></pre>

<p>I tried to run following update, but I get only the error 1093:  </p>

<pre><code>UPDATE pers P 
SET P.gehalt = P.gehalt * 1.05 
WHERE (P.chefID IS NOT NULL 
OR gehalt &lt; 
(SELECT (
    SELECT MAX(gehalt * 1.05) 
    FROM pers MA 
    WHERE MA.chefID = MA.chefID) 
    AS _pers
))
</code></pre>

<p>I searched for the error and found from mysql following page <a href=""http://dev.mysql.com/doc/refman/5.1/en/subquery-restrictions.html"" rel=""noreferrer"">http://dev.mysql.com/doc/refman/5.1/en/subquery-restrictions.html</a>, but it doesn't help me.</p>

<p>What shall I do to correct the sql query?</p>
","<p>The problem is that MySQL, for whatever inane reason, doesn't allow you to write queries like this:</p>

<pre><code>UPDATE myTable
SET myTable.A =
(
    SELECT B
    FROM myTable
    INNER JOIN ...
)
</code></pre>

<p>That is, if you're doing an <code>UPDATE</code>/<code>INSERT</code>/<code>DELETE</code> on a table, you can't reference that table in an inner query <em>(you <strong>can</strong> however reference a field from that outer table...)</em></p>

<hr>

<p>The solution is to replace the instance of <code>myTable</code> in the sub-query with <code>(SELECT * FROM myTable)</code>, like this</p>

<pre><code>UPDATE myTable
SET myTable.A =
(
    SELECT B
    FROM (SELECT * FROM myTable) AS something
    INNER JOIN ...
)
</code></pre>

<p>This apparently causes the necessary fields to be implicitly copied into a temporary table, so it's allowed.</p>

<p>I found this solution <a href=""http://www.xaprb.com/blog/2006/06/23/how-to-select-from-an-update-target-in-mysql/"" rel=""noreferrer"">here</a>.  A note from that article:</p>

<blockquote>
  <p>You don’t want to just <code>SELECT * FROM table</code> in the subquery in real life; I just wanted to keep the examples simple. In reality, you should only be selecting the columns you need in that innermost query, and adding a good <code>WHERE</code> clause to limit the results, too.</p>
</blockquote>
","14302701"
"Oracle ""(+)"" Operator","157857","","<p>I am checking some old SQL Statements for the purpose of documenting them and probably enhancing them.</p>

<p>The DBMS is Oracle</p>

<p>I did not understand a statement which read like this:</p>

<pre><code>select ...
from a,b
where a.id=b.id(+)
</code></pre>

<p>I am confused about the <code>(+)</code> operator, and could not get it at any forums... (searching for + within quotes didn't work either).</p>

<p>Anyway, I used 'Explain Plan' of SQLDeveloper and I got an output saying that <code>HASH JOIN, RIGHT OUTER</code>, etc.</p>

<p>Would there be any difference if I remove the <code>(+)</code> operator at the end of the query? Does the database have to satisfy some condition (like having some indexes, etc.) before <code>(+)</code> can be used?? It would be greatly helpful if you can provide me a simple understanding, or some good links where I can read about this.</p>

<p>Thanks!</p>
","<p>That's Oracle specific notation for an OUTER JOIN, because the ANSI-89 format (using a comma in the FROM clause to separate table references) didn't standardize OUTER joins.</p>

<p>The query would be re-written in ANSI-92 syntax as:</p>

<pre><code>   SELECT ...
     FROM a
LEFT JOIN b ON b.id = a.id
</code></pre>

<p><a href=""http://www.codinghorror.com/blog/2007/10/a-visual-explanation-of-sql-joins.html"" rel=""noreferrer"">This link is pretty good at explaining the difference between JOINs</a>.</p>

<hr>

<p>It should also be noted that even though the <code>(+)</code> works, <a href=""https://docs.oracle.com/database/121/SQLRF/queries006.htm#SQLRF52354"" rel=""noreferrer"">Oracle recommends <strong>not</strong> using it</a>:</p>

<blockquote>
  <p>Oracle recommends that you use the <code>FROM</code> clause <code>OUTER JOIN</code> syntax rather than the Oracle join operator. Outer join queries that use the Oracle join operator <code>(+)</code> are subject to the following rules and restrictions, which do not apply to the <code>FROM</code> clause <code>OUTER JOIN</code> syntax:</p>
</blockquote>
","4020794"
"How to determine the number of days in a month in SQL Server?","157206","","<p>I need to determine the number of days in a month for a given date in SQL Server.</p>

<p>Is there a built-in function? If not, what should I use as the user-defined function?</p>
","<p>You can use the following with the first day of the specified month:</p>

<pre><code>datediff(day, @date, dateadd(month, 1, @date))
</code></pre>

<p>To make it work for every date:</p>

<pre><code>datediff(day, dateadd(day, 1-day(@date), @date),
              dateadd(month, 1, dateadd(day, 1-day(@date), @date)))
</code></pre>
","691069"
"Insert Picture into SQL Server 2005 Image Field using only SQL","156676","","<p>Using SQL Server 2005 and Management Studio how do I insert a picture into an <code>Image</code> type column of a table?   </p>

<p>Most importantly how do I verify if it is there?</p>
","<pre><code>CREATE TABLE Employees
(
    Id int,
    Name varchar(50) not null,
    Photo varbinary(max) not null
)


INSERT INTO Employees (Id, Name, Photo) 
SELECT 10, 'John', BulkColumn 
FROM Openrowset( Bulk 'C:\photo.bmp', Single_Blob) as EmployeePicture
</code></pre>
","416918"
"A select query selecting a select statement","156622","","<p>I don't even know if I am doing this query the right way.
There is a <code>Sandwiches</code> table that has some 7 fields and 2 of them are comboboxes (<code>Type</code> and <code>Bread</code>).</p>

<p>So I made a query that combines all of the comboboxes values into one query, like this:</p>

<pre><code>SELECT TypesAndBreads.TBName, TypesAndBreads.Type
FROM (SELECT [Sandwiches Types].[Sandwich Type] As TBName, ""Sandwich Type"" As Type
    FROM [Sandwiches Types]
UNION ALL
    SELECT Breads.Bread As TBName, ""Bread"" As Type 
    FROM Breads)  AS TypesAndBreads;
</code></pre>

<p>I get the flat values of the tables now I want to count all the sandwiches under each <code>TypesAndBreads.TBName</code>. I have this, just to make sure it works with all the Sandwiches:</p>

<pre><code>SELECT TypesAndBread.Type, TypesAndBread.TBName,
       (SELECT Count(Sandwiches.[SandwichID]) As SandwichCount
        FROM Sandwiches) As SandwichCount
FROM TypesAndBread;
</code></pre>

<p>But I want to reference the current Type and TBName inside the subquery. Something like this:</p>

<pre><code>SELECT TypesAndBread.Type, TypesAndBread.TBName,
       (SELECT Count(Sandwiches.[SandwichID]) As SandwichCount
        FROM Sandwiches
        WHERE Sandwiches.[TypesAndBread.Type] = Sandwiches.[TypesAndBread.TBName]) As SandwichCount
FROM TypesAndBread;
</code></pre>

<p>But of course this doesn't work. I didn't think it will, just thought of giving it a try. I was thinking of maybe constructing the query with VBA when they open the Report that this query is going to be based of.</p>

<p><strong>So I guess my question is:</strong> Is there a way to reference the current selected fields in a subquery? Or is there a different way to approach this?</p>

<p>Thanks for the help</p>

<p><strong>EDIT:</strong>
My table structure is like this:</p>

<p><code>Sandwiches</code>'s fields</p>

<pre><code>| SandwichID | Name | Date Added | Chef | Sandwich Type | Bread | Reviewed By |
</code></pre>

<p>where <code>Sandwich Type</code> and <code>Bread</code> are Lookup fields for these tables:</p>

<p><code>Sandwiches Types</code>'s fields</p>

<pre><code>| Sandwich Type |
</code></pre>

<p><code>Breads</code>'s fields</p>

<pre><code>| Bread |
</code></pre>

<p>The TypesAndBreads query combined the Sandwiches Types and Breads tables, but the reason for that is so that I can get the count of all the sandwiches that have that Type or bread. A result like this:</p>

<pre><code>+=============================================+
|      Type     |    TBName   | SandwichCount |
+=============================================+
| Sandwich Type | Turkey Club |            10 |
| Bread         | Italian     |             5 |
| Bread         | Garlic      |             8 |
+---------------------------------------------+
</code></pre>

<p>the example result's first row basicly says there are 10 sandwiches in record with the Sandwich Type field equal to Turkey Club.</p>

<p>I hope that explains it better.</p>
","<p>Not sure if Access supports it, but in most engines (including <code>SQL Server</code>) this is called a correlated subquery and works fine:</p>

<pre><code>SELECT  TypesAndBread.Type, TypesAndBread.TBName,
        (
        SELECT  Count(Sandwiches.[SandwichID]) As SandwichCount
        FROM    Sandwiches
        WHERE   (Type = 'Sandwich Type' AND Sandwiches.Type = TypesAndBread.TBName)
                OR (Type = 'Bread' AND Sandwiches.Bread = TypesAndBread.TBName)
        ) As SandwichCount
FROM    TypesAndBread
</code></pre>

<p>This can be made more efficient by indexing <code>Type</code> and <code>Bread</code> and distributing the subqueries over the <code>UNION</code>:</p>

<pre><code>SELECT  [Sandwiches Types].[Sandwich Type] As TBName, ""Sandwich Type"" As Type,
        (
        SELECT  COUNT(*) As SandwichCount
        FROM    Sandwiches
        WHERE   Sandwiches.Type = [Sandwiches Types].[Sandwich Type]
        )
FROM    [Sandwiches Types]
UNION ALL
SELECT  [Breads].[Bread] As TBName, ""Bread"" As Type,
        (
        SELECT  COUNT(*) As SandwichCount
        FROM    Sandwiches
        WHERE   Sandwiches.Bread = [Breads].[Bread]
        )
FROM    [Breads]
</code></pre>
","2043892"
"Simple check for SELECT query empty result","156345","","<p>Can anyone point out how to check if a select query returns non empty result set?</p>

<p>For example I have next query:</p>

<pre><code>SELECT * FROM service s WHERE s.service_id = ?;
</code></pre>

<p>Should I do something like next:</p>

<pre><code>ISNULL(SELECT * FROM service s WHERE s.service_id = ?)
</code></pre>

<p>to test if result set is not empty?</p>
","<p>Use @@ROWCOUNT:</p>

<pre><code>SELECT * FROM service s WHERE s.service_id = ?;

IF @@ROWCOUNT &gt; 0 
   -- do stuff here.....
</code></pre>

<p>According to <a href=""http://technet.microsoft.com/en-us/library/ms187316.aspx"" rel=""noreferrer"">SQL Server Books Online</a>:</p>

<blockquote>
  <p>Returns the number of rows affected by
  the last statement. If the number of
  rows is more than 2 billion, use
  ROWCOUNT_BIG.</p>
</blockquote>
","2885050"
"DISTINCT for only one Column","156301","","<p>Let's say I have the following query.</p>

<pre><code>SELECT ID, Email, ProductName, ProductModel FROM Products
</code></pre>

<p>How can I modify it so that it returns no duplicate Emails?</p>

<p>In other words, when several rows contain the same email, I want the results to include only one of those rows (preferably the last one). Duplicates in other columns should be allowed.</p>

<p>Clauses like <code>DISTINCT</code> and <code>GROUP BY</code> appear to work on entire rows. So I'm not sure how to approach this.</p>
","<p>If you are using SQL Server 2005 or above use this:</p>

<pre><code>SELECT *
  FROM (
                SELECT  ID, 
                        Email, 
                        ProductName, 
                        ProductModel,
                        ROW_NUMBER() OVER(PARTITION BY Email ORDER BY ID DESC) rn
                    FROM Products
              ) a
WHERE rn = 1
</code></pre>

<p>EDIT:
Example using a where clause:</p>

<pre><code>SELECT *
  FROM (
                SELECT  ID, 
                        Email, 
                        ProductName, 
                        ProductModel,
                        ROW_NUMBER() OVER(PARTITION BY Email ORDER BY ID DESC) rn
                    FROM Products
                   WHERE ProductModel = 2
                     AND ProductName LIKE 'CYBER%'

              ) a
WHERE rn = 1
</code></pre>
","5021739"
"Excel function to make SQL-like queries on worksheet data?","156301","","<p>I have a largish table in an excel worksheet:</p>

<pre><code>Column_1 | Column_2 | Column_3

ValueA       ValueB     ValueC
....
</code></pre>

<p>What I need is a function that will take as input the range and an SQL-like query String and return a range of rows that match the query, e.g:</p>

<pre><code>=SQL_SELECT(A1:C1000, ""SELECT * WHERE Column_1 = ValueH AND Column_3 = blah"")
</code></pre>

<p>Does something like this exist? Or what would be the best way to implement myself?</p>

<p>Thanks</p>
","<p>You can use <code>Get External Data</code> (dispite its name), located in the 'Data' tab of Excel 2010, to set up a <code>connection</code> in a workbook to query data from itself.  Use <code>From Other Sources</code> <code>From Microsoft Query</code> to connect to Excel</p>

<p>Once set up you can use <code>VBA</code> to manipulate the <code>connection</code> to, among other thing, view and modify the SQL command that drives the query.  This query <em>does</em> reference the in memory workbook, so doen't require a save to refresh the latest data.</p>

<p>Here's a quick <code>Sub</code> to demonstrate accessing the connection objects</p>

<pre class=""lang-vb prettyprint-override""><code>Sub DemoConnection()
    Dim c As Connections
    Dim wb As Workbook
    Dim i As Long
    Dim strSQL As String

    Set wb = ActiveWorkbook
    Set c = wb.Connections
    For i = 1 To c.Count
        ' Reresh the data
        c(i).Refresh 
        ' view the SQL query
        strSQL = c(i).ODBCConnection.CommandText
        MsgBox strSQL
    Next
End Sub
</code></pre>
","8766541"
"How to execute a stored procedure inside a select query","156210","","<pre><code>SELECT col1,
       col2,
       col3,

EXEC GetAIntFromStoredProc(T.col1) AS col4
     FROM Tbl AS T
     WHERE (col2 = @parm) 
</code></pre>

<p>How to write this SQL query in SQL Server 2008?</p>
","<p>Thanks @twoleggedhorse. </p>

<p>Here is the solution. </p>

<ol>
<li><p>First we created a function</p>

<pre><code>CREATE FUNCTION GetAIntFromStoredProc(@parm Nvarchar(50)) RETURNS INTEGER

AS
BEGIN
   DECLARE @id INTEGER

   set @id= (select TOP(1) id From tbl where col=@parm)

   RETURN @id
END
</code></pre></li>
<li><p>then we do the select query</p>

<pre><code>Select col1, col2, col3,
GetAIntFromStoredProc(T.col1) As col4
From Tbl as T
Where col2=@parm
</code></pre></li>
</ol>
","14507763"
"How to replace a character from a String in SQL?","156129","","<p>I have 100's of cells in our database which contain <code>?</code> instead of <code>'</code>. It is possible that this might happen in all rows and columns and in more than one word per cell. Here is an example of just one cell. </p>

<pre><code>Parents? CUI assumed equal to the sum of the father?s/stepfather?s and mother?s/ stepmother?s income .
</code></pre>

<p>I want to write an SQL statement which finds all the cells that contain <code>?</code> (may be more than one per cell)  and replace them with <code>'</code>. I am sure that all <code>?</code> have to be replaced without exception.</p>

<p>I know there is a function replace but I couldn't know how to extract a character from a string in sql. </p>

<p>This is one example I got but it couldn't help me.</p>

<pre><code>UPDATE dbo.authors

SET    city = replace(city, 'Salt', 'Olympic')
WHERE  city LIKE 'Salt%';
</code></pre>

<p>Any ideas?</p>
","<p>Are you sure that the data stored in the database is actually a question mark?  I would tend to suspect from the sample data that the problem is one of character set conversion where <code>?</code> is being used as the replacement character when the character can't be represented in the client character set.  Possibly, the database is actually storing Microsoft ""smart quote"" characters rather than simple apostrophes.</p>

<p>What does the <code>DUMP</code> function show is actually stored in the database?</p>

<pre><code>SELECT column_name,
       dump(column_name,1016)
  FROM your_table
 WHERE &lt;&lt;predicate that returns just the sample data you posted&gt;&gt;
</code></pre>

<p>What application are you using to view the data?  What is the client's <code>NLS_LANG</code> set to?</p>

<p>What is the database and national character set?  Is the data stored in a <code>VARCHAR2</code> column?  Or <code>NVARCHAR2</code>?</p>

<pre><code>SELECT parameter, value
  FROM v$nls_parameters
 WHERE parameter LIKE '%CHARACTERSET';
</code></pre>

<p>If all the problem characters are stored in the database as 0x19 (decimal 25), your <code>REPLACE</code> would need to be something like</p>

<pre><code>UPDATE table_name
   SET column1 = REPLACE(column1, chr(25), q'[']'),
       column2 = REPLACE(column2, chr(25), q'[']'),
       ...
       columnN = REPLACE(columnN, chr(25), q'[']')
 WHERE INSTR(column1,chr(25)) &gt; 0
    OR INSTR(column2,chr(25)) &gt; 0 
    ...
    OR INSTR(columnN,chr(25)) &gt; 0
</code></pre>
","9621984"
"Export table data from one SQL Server to another","155786","","<p>I have two SQL Servers (both 2005 version).</p>

<p>I want to migrate several tables from one to another.</p>

<p>I have tried:</p>

<ul>
<li><p>On source server I have right clicked on the database, selected <code>Tasks/Generate scripts</code>.
The problem is that under <code>Table/View options</code> there is no <code>Script data</code> option.</p></li>
<li><p>Then I used <code>Script Table As/Create script</code> to generate SQL files in order to create the tables on my destination server. But I still need all the data.</p></li>
</ul>

<p>Then I tried using:</p>

<pre><code>SELECT * 
INTO [destination server].[destination database].[dbo].[destination table] 
FROM [source server].[source database].[dbo].[source table]
</code></pre>

<p>But I get error :</p>

<blockquote>
  <p>Object contains more than the maximum number of prefixes. Maximum is
  2.</p>
</blockquote>

<p>Can someone please point me to the right solution to my problem?</p>
","<p>Try this:</p>

<ol>
<li><p>create your table on the target server using your scripts from the <code>Script Table As / Create Script</code> step</p></li>
<li><p>on the target server, you can then issue a T-SQL statement:</p>

<pre><code>INSERT INTO dbo.YourTableNameHere
   SELECT *
   FROM [SourceServer].[SourceDatabase].dbo.YourTableNameHere
</code></pre></li>
</ol>

<p>This should work just fine.</p>
","11009289"
"datetime format to SQL format using C#","155613","","<p>I am trying to save the current date time format from C# and convert it to a SQL Server date format like so <code>yyyy-MM-dd HH:mm:ss</code> so I can use it for my <code>Update</code> query.</p>

<p>This was my first code:</p>

<pre><code>DateTime myDateTime = DateTime.Now;
string sqlFormattedDate = myDateTime.Date.ToString(""yyyy-MM-dd HH:mm:ss"");
</code></pre>

<p>The output on date is ok but time is always ""12:00:00"" so I changed my code to the following:</p>

<pre><code>string sqlFormattedDate = myDateTime.Date.ToString(""yyyy-MM-dd"") + "" "" + 
myDateTime.TimeOfDay.ToString(""HH:mm:ss"");
</code></pre>

<p>It gave me a compile error ""FormatException was unhandled"" and suggested I need to parse. So I tried doing this to my code as per my research here in staackoverflow:</p>

<pre><code>string sqlFormattedDate = myDateTime.Date.ToString(""yyyy-MM-dd"") + "" "" + 
myDateTime.Parse.TimeOfDay.ToString(""HH:mm:ss"");
</code></pre>

<p>or</p>

<pre><code>string sqlFormattedDate = myDateTime.Date.ToString(""yyyy-MM-dd"") + "" "" + 
myDateTime.tryParse.TimeOfDay.ToString(""HH:mm:ss"");
</code></pre>

<p>but it's giving me it's a method which is not valid for given context. I tried searching for solutions to my problem and currently stuck for two hours now. I'm still a bit new in C#, can you help please?</p>
","<p>try this below </p>

<pre><code>DateTime myDateTime = DateTime.Now;
string sqlFormattedDate = myDateTime.ToString(""yyyy-MM-dd HH:mm:ss.fff"");
</code></pre>
","17418301"
"How can I group by date time column without taking time into consideration","155454","","<p>I have a bunch of product orders and I'm trying to group by the date and sum the quantity for that date. How can I group by the month/day/year without taking the time part into consideration?</p>

<p><code>3/8/2010 7:42:00</code> should be grouped with <code>3/8/2010 4:15:00</code></p>
","<p><a href=""http://msdn.microsoft.com/en-us/library/ms187928.aspx"" rel=""noreferrer"">Cast/Convert</a> the values to a <a href=""http://msdn.microsoft.com/en-us/library/bb630352.aspx"" rel=""noreferrer""><code>Date</code></a> type for your group by.</p>

<pre><code>GROUP BY CAST(myDateTime AS DATE)
</code></pre>
","6054176"
"How to check for null/empty/whitespace values with a single test?","155379","","<p>I'd like to write a SELECT statement that uses just one test to return columns with no value (null, empty, or all spaces).</p>

<p>I thought this would work:</p>

<pre><code>SELECT column_name from table_name WHERE column_name NOT LIKE '%_%';
</code></pre>

<p>But this does not work for NULL values.</p>

<p>Of course I can add</p>

<pre><code>OR column_name IS NULL
</code></pre>

<p>and it will work, but I'd like a way that uses a single test.</p>
","<p>Functionally, you should be able to use</p>

<pre><code>SELECT column_name
  FROM table_name
 WHERE TRIM(column_name) IS NULL
</code></pre>

<p>The problem there is that an index on COLUMN_NAME would not be used.  You would need to have a function-based index on TRIM(column_name) if that is a selective condition.</p>
","4109522"
"MySQL - check if table exists without using ""select from""","155098","","<p>Is there a way to check if a table exists <em>without</em> selecting and checking values from it?</p>

<p>That is, I know I can go <code>SELECT testcol FROM testtable</code> and check the count of fields returned, but it seems there must be a more direct / elegant way to do it.</p>
","<p>You don't need to count anything.</p>

<pre><code>SELECT 1 FROM testtable LIMIT 1;
</code></pre>

<p>If there's no error, table exists.</p>

<p>Or, if you want to be correct, use <a href=""http://dev.mysql.com/doc/refman/5.0/en/tables-table.html"" rel=""noreferrer"">INFORMATION_SCHEMA</a>.</p>

<pre><code>SELECT * 
FROM information_schema.tables
WHERE table_schema = 'yourdb' 
    AND table_name = 'testtable'
LIMIT 1;
</code></pre>

<p>Alternatively, you can use <code>SHOW TABLES</code></p>

<pre><code>SHOW TABLES LIKE 'yourtable';
</code></pre>

<p>If there is a row in the resultset, table exists.</p>
","8829109"
"latitude/longitude find nearest latitude/longitude - complex sql or complex calculation","155073","","<p>I have latitude and longitude and I want to pull the record from the database, which has nearest latitude and longitude by the distance, if that distance gets longer than specified one, then don't retrieve it.</p>

<p><strong>Table structure:</strong></p>

<pre><code>id
latitude
longitude
place name
city
country
state
zip
sealevel
</code></pre>
","<p>What you need is to translate the distance into degrees of longitude and latitude, filter based on those to bound the entries that are roughly in the bounding box, then do a more precise distance filter. Here is great paper that explains how to do all this:</p>

<p><a href=""http://www.scribd.com/doc/2569355/Geo-Distance-Search-with-MySQL"" rel=""noreferrer"">http://www.scribd.com/doc/2569355/Geo-Distance-Search-with-MySQL</a></p>
","2234221"
"How to select only the first rows for each unique value of a column","154855","","<p>Let's say I have a table of customer addresses:</p>

<pre><code>CName           |   AddressLine
-------------------------------
John Smith      | 123 Nowheresville
Jane Doe        | 456 Evergreen Terrace
John Smith      | 999 Somewhereelse
Joe Bloggs      | 1 Second Ave
</code></pre>

<p>In the table, one customer like John Smith can have multiple addresses.
I need the select query for this table to return only first row found where there are duplicates in 'CName'. For this table it should return all rows except the 3rd (or 1st - any of those two addresses are okay but only one can be returned).
Is there a keyword I can add to the SELECT query to filter based on whether the server has already seen the column value before?</p>
","<p>A very simple answer if you say you don't care which address is used.</p>

<pre><code>SELECT
    CName, MIN(AddressLine)
FROM
    MyTable
GROUP BY
    CName
</code></pre>

<p>If you want the first according to, say, an ""inserted"" column then it's a different query</p>

<pre><code>SELECT
    M.CName, M.AddressLine,
FROM
    (
    SELECT
        CName, MIN(Inserted) AS First
    FROM
        MyTable
    GROUP BY
        CName
    ) foo
    JOIN
    MyTable M ON foo.CName = M.CName AND foo.First = M.Inserted
</code></pre>
","4662499"
"Accessing SQL Database in Excel-VBA","154837","","<p>I am copying an VBA code snippet from MSDN that shows me how to grab results from a SQL query into excel sheet (Excel 2007):</p>

<pre><code>Sub GetDataFromADO()

    'Declare variables'
        Set objMyConn = New ADODB.Connection
        Set objMyCmd = New ADODB.Command
        Set objMyRecordset = New ADODB.Recordset

    'Open Connection'
        objMyConn.ConnectionString = ""Provider=SQLOLEDB;Data Source=localhost;User ID=abc;Password=abc;""
        objMyConn.Open

    'Set and Excecute SQL Command'
        Set objMyCmd.ActiveConnection = objMyConn
        objMyCmd.CommandText = ""select * from myTable""
        objMyCmd.CommandType = adCmdText
        objMyCmd.Execute

    'Open Recordset'
        Set objMyRecordset.ActiveConnection = objMyConn
        objMyRecordset.Open objMyCmd

    'Copy Data to Excel'
        ActiveSheet.Range(""A1"").CopyFromRecordset (objMyRecordset)

End Sub
</code></pre>

<p>I have already added Microsoft ActiveX Data Objects 2.1 Library under as a reference. And this database is accessible.</p>

<p>Now, when I run this subroutine, it has an error:</p>

<p>Run-time error 3704: Operation is not allowed when object is closed.</p>

<p>On the statement:   </p>

<pre><code>ActiveSheet.Range(""A1"").CopyFromRecordset (objMyRecordset)
</code></pre>

<p>Any idea why?</p>

<p>Thanks.</p>
","<p>I've added the Initial Catalog to your connection string.  I've also abandonded the ADODB.Command syntax in favor of simply creating my own SQL statement and open the recordset on that variable.</p>

<p>Hope this helps.</p>

<pre><code>Sub GetDataFromADO()
    'Declare variables'
        Set objMyConn = New ADODB.Connection
        Set objMyRecordset = New ADODB.Recordset
        Dim strSQL As String

    'Open Connection'
        objMyConn.ConnectionString = ""Provider=SQLOLEDB;Data Source=localhost;Initial Catalog=MyDatabase;User ID=abc;Password=abc;""
        objMyConn.Open

    'Set and Excecute SQL Command'
        strSQL = ""select * from myTable""

    'Open Recordset'
        Set objMyRecordset.ActiveConnection = objMyConn
        objMyRecordset.Open strSQL            

    'Copy Data to Excel'
        ActiveSheet.Range(""A1"").CopyFromRecordset (objMyRecordset)

End Sub
</code></pre>
","1122214"
"What are the main performance differences between varchar and nvarchar SQL Server data types?","154644","","<p>I'm working on a database for a small web app at my school using <code>SQL Server 2005</code>.<br>
I see a couple of schools of thought on the issue of <code>varchar</code> vs <code>nvarchar</code>:</p>

<ol>
<li>Use <code>varchar</code> unless you deal with a lot of internationalized data, then use <code>nvarchar</code>.</li>
<li>Just use <code>nvarchar</code> for everything.</li>
</ol>

<p>I'm beginning to see the merits of view 2.  I know that nvarchar does take up twice as much space, but that isn't necessarily a huge deal since this is only going to store data for a few hundred students.  To me it seems like it would be easiest not to worry about it and just allow everything to use nvarchar.  Or is there something I'm missing?</p>
","<p>Always use nvarchar. </p>

<p>You may never need the double-byte characters for most applications.  However, if you need to support double-byte languages and you only have single-byte support in your database schema it's really expensive to go back and modify throughout your application.  </p>

<p>The cost of migrating one application from varchar to nvarchar will be much more than the little bit of extra disk space you'll use in most applications.</p>
","35369"
"Why would someone use WHERE 1=1 AND <conditions> in a SQL clause?","154629","","<p>Why would someone use <code>WHERE 1=1 AND &lt;conditions&gt;</code> in a SQL clause (Either SQL obtained through concatenated strings, either view definition)</p>

<p>I've seen somewhere that this would be used to protect against SQL Injection, but it seems very weird.</p>

<p>If there is injection <code>WHERE 1 = 1 AND injected OR 1=1</code> would have the same result as <code>injected OR 1=1</code>.</p>

<p>Later edit: What about the usage in a view definition?</p>

<hr>

<p>Thank you for your answers.</p>

<p>Still,
I don't understand why would someone use this construction for defining a view, or use it inside a stored procedure.</p>

<p>Take this for example:</p>

<pre><code>CREATE VIEW vTest AS
SELECT FROM Table WHERE 1=1 AND table.Field=Value
</code></pre>
","<p>If the list of conditions is not known at compile time and is instead built at run time, you don't have to worry about whether you have one or more than one condition. You can generate them all like:</p>

<pre><code>and &lt;condition&gt;
</code></pre>

<p>and concatenate them all together. With the <code>1=1</code> at the start, the initial <code>and</code> has something to associate with.</p>

<p>I've never seen this used for any kind of injection protection, as you say it doesn't seem like it would help much. I <em>have</em> seen it used as an implementation convenience. The SQL query engine will end up ignoring the <code>1=1</code> so it should have no performance impact.</p>
","242831"
"How to do a batch insert in MySQL","154526","","<p>I have 1-many number of records that need to be entered into a table.  What is the best way to do this in a query?  Should I just make a loop and insert one record per iteration?  Or is there a better way?</p>
","<p>From the <a href=""http://dev.mysql.com/doc/refman/5.7/en/insert.html"">MySQL manual</a></p>

<blockquote>
  <p>INSERT statements that use VALUES
  syntax can insert multiple rows. To do
  this, include multiple lists of column
  values, each enclosed within
  parentheses and separated by commas.
  Example:</p>
</blockquote>

<pre><code>INSERT INTO tbl_name (a,b,c) VALUES(1,2,3),(4,5,6),(7,8,9);
</code></pre>
","5526937"
"Get records with max value for each group of grouped SQL results","154361","","<p>How do you get the rows that contain the max value for each grouped set? </p>

<p>I've seen some overly-complicated variations on this question, and none with a good answer. I've tried to put together the simplest possible example:</p>

<p>Given a table like that below, with person, group, and age columns, how would you get the oldest person in each group? (A tie within a group should give the first alphabetical result)</p>

<pre><code>Person | Group | Age
---
Bob  | 1     | 32  
Jill | 1     | 34  
Shawn| 1     | 42  
Jake | 2     | 29  
Paul | 2     | 36  
Laura| 2     | 39  
</code></pre>

<p>Desired result set:  </p>

<pre><code>Shawn | 1     | 42    
Laura | 2     | 39  
</code></pre>
","<p>There's a super-simple way to do this in mysql:</p>

<pre><code>select * 
from (select * from mytable order by `Group`, age desc, Person) x
group by `Group`
</code></pre>

<p>This works because in mysql you're allowed to <em>not</em> aggregate non-group-by columns, in which case mysql just returns the <em>first</em> row. The solution is to first order the data such that for each group the row you want is first, then group by the columns you want the value for.</p>

<p>You avoid complicated subqueries that try to find the <code>max()</code> etc, and also the problems of returning multiple rows when there are more than one with the same maximum value (as the other answers would do)</p>

<p><br/>
<strong>Note:</strong> This is a <em>mysql-only</em> solution. All other databases I know will throw an SQL syntax error with the message ""non aggregated columns are not listed in the group by clause"" or similar. Some ""purists"" consider this syntax to be the work of the devil, but it's so damn handy!</p>

<h3>Version 5.7 update:</h3>

<p>Since version 5.7, the <a href=""https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html"" rel=""noreferrer""><code>sql-mode</code></a> setting includes <a href=""https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html#sqlmode_only_full_group_by"" rel=""noreferrer""><code>ONLY_FULL_GROUP_BY</code></a> by default, so to make this work you must <em>not</em> have this option (edit the option file for the server to remove this setting).</p>
","12102288"
"sqlplus statement from command line","154023","","<p>Is it possible to do something like this?</p>

<p><code>$ sqlplus -s user/pass ""select 1 from dual""</code>
or<br>
<code>$ echo ""select 1 from dual"" | sqlplus -s user/pass</code></p>

<p>I know I can put <code>select 1 from dual</code> in a file and do this:<br>
<code>$ sqlplus -s user/pass @myFile.sql</code></p>

<p>but I'm wondering if it's actually necessary to create a file just to satisfy sqlplus</p>
","<p>Just be aware that on Unix/Linux your username/password can be seen by anyone that can run ""ps -ef"" command if you place it directly on the command line . Could be a big security issue (or turn into a big security issue). </p>

<p>I usually recommend creating a file or using here document so you can protect the username/password from being viewed with ""ps -ef"" command in Unix/Linux. If the username/password is contained in a script file or sql file you can protect using appropriate user/group read permissions. Then you can keep the user/pass inside the file like this in a shell script: </p>

<pre><code>sqlplus -s /nolog &lt;&lt;EOF
connect user/pass
select blah;
quit
EOF
</code></pre>
","1639930"
"Removing leading zeroes from a field in a SQL statement","153956","","<p>I am working on a SQL query that reads from a SQLServer database to produce an extract file. One of the  requirements to remove the leading zeroes from a particular field, which is a simple VARCHAR(10) field. So, for example, if the field contains '00001A', the SELECT statement needs to return the data as '1A'.</p>

<p>Is there a way in SQL to easily remove the leading zeroes in this way? I know there is an RTRIM function, but this seems only to remove spaces. </p>
","<pre><code>select substring(ColumnName, patindex('%[^0]%',ColumnName), 10)
</code></pre>
","92363"
"MySQL Select Query - Get only first 10 characters of a value","153931","","<p>Ok, so here is the issue.</p>

<p>I have a table with some columns and 'subject' is one of the columns.
I need to get the first 10 letters from the 'subject' field no matter the 'subject' field contains a string with 100 letters.</p>

<p>For example,</p>

<p>Table - <strong><code>tbl</code></strong>.
Columns - <code>id</code>, <code>subject</code>, <code>value</code>.</p>

<p>SQL Query: </p>

<pre><code>SELECT subject FROM tbl WHERE id ='$id';
</code></pre>

<p>The result I am getting is, for example </p>

<blockquote>
  <p>Hello, this is my subject and how are you</p>
</blockquote>

<p>I only require the first 10 characters</p>

<blockquote>
  <p>Hello, thi</p>
</blockquote>

<p>I can understand that I can remove the rest of the characters using php substr() but that's not possible in my case. I need to get the excess characters removed by MySQL. How can this be done?</p>
","<p>Using the below line</p>

<pre><code>SELECT LEFT(subject , 10) FROM tbl 
</code></pre>

<p><a href=""http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_left"" rel=""noreferrer"">MySQL Doc.</a></p>
","14959216"
"Remove trailing zeros from decimal in SQL Server","153882","","<p>I have a column <code>DECIMAL(9,6)</code> i.e. it supports values like 999,123456.</p>

<p>But when I insert data like 123,4567 it becomes 123,456700</p>

<p>How to remove those zeros?</p>
","<p>Unless you want to convert it to a string you can't. You need to do this in the presentation layer.</p>
","2938323"
"count number of characters in nvarchar column","153713","","<p>Does anyone know a good way to count characters in a text (nvarchar) column in Sql Server?
The values there can be text, symbols and/or numbers.</p>

<p>So far I used <code>sum(datalength(column))/2</code> but this only works for text. (it's a method based on datalength and this can vary from a type to another).</p>
","<p>You can find the number of characters using system function <code>LEN</code>.
i.e.</p>

<pre><code>SELECT LEN(Column) FROM TABLE
</code></pre>
","14255266"
"SET NOCOUNT ON usage","153456","","<p>Inspired by <a href=""https://stackoverflow.com/questions/1483383/is-this-stored-procedure-thread-safe-or-whatever-the-equiv-is-on-sql-server"">this question</a> where there are differing views on SET NOCOUNT...</p>

<blockquote>
  <p>Should we use SET NOCOUNT ON for SQL Server? If not, why not?</p>
</blockquote>

<p><strong>What it does</strong> Edit 6, on 22 Jul 2011</p>

<p>It suppresses the ""xx rows affected"" message after any DML. This is a resultset and when sent, the client must process it. It's tiny, but measurable (see answers below)</p>

<p>For triggers etc, the client will receive multiple ""xx rows affected"" and this causes all manner of errors for some ORMs, MS Access, JPA etc (see edits below)</p>

<p><strong>Background:</strong></p>

<p>General accepted best practice (I thought until this question) is to use <code>SET NOCOUNT ON</code> in triggers and stored procedures in SQL Server. We use it everywhere and a quick google shows plenty of SQL Server MVPs agreeing too.</p>

<p>MSDN says this can break a <a href=""http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldataadapter.aspx"" rel=""noreferrer"">.net SQLDataAdapter</a>.</p>

<p>Now, this means to me that the SQLDataAdapter is limited to utterly simply CRUD processing because it expects the ""n rows affected"" message to match. So, I can't use:</p>

<ul>
<li>IF EXISTS to avoid duplicates (no rows affected message) <em>Note: use with caution</em></li>
<li>WHERE NOT EXISTS (less rows then expected</li>
<li>Filter out trivial updates (eg no data actually changes)</li>
<li>Do any table access before (such as logging)</li>
<li>Hide complexity or denormlisation</li>
<li>etc</li>
</ul>

<p>In the question marc_s (who knows his SQL stuff) says do not use it. This differs to what I think (and I regard myself as somewhat competent at SQL too).</p>

<p>It's possible I'm missing something (feel free to point out the obvious), but what do you folks out there think?</p>

<p>Note: it's been years since I saw this error because I don't use SQLDataAdapter nowadays.</p>

<p><strong>Edits after comments and questions:</strong></p>

<p>Edit: More thoughts...</p>

<p>We have multiple clients: one may use a C# SQLDataAdaptor, another may use nHibernate from Java. These can be affected in different ways with <code>SET NOCOUNT ON</code>.</p>

<p>If you regard stored procs as methods, then it's bad form (anti-pattern) to assume some internal processing works a certain way for your own purposes.</p>

<p>Edit 2: a <a href=""https://stackoverflow.com/questions/1354362"">trigger breaking nHibernate question</a>, where <code>SET NOCOUNT ON</code> can not be set</p>

<p>(and no, it's not a duplicate of <a href=""https://stackoverflow.com/questions/995589/set-nocount-off-or-return-rowcount"">this</a>)</p>

<p>Edit 3: Yet more info, thanks to my MVP colleague</p>

<ul>
<li><a href=""http://support.microsoft.com/?scid=kb%3Ben-us%3B240882&amp;x=4&amp;y=9"" rel=""noreferrer"">KB 240882</a>, issue causing disconnects on SQL 2000 and earlier</li>
<li><a href=""http://sqlmag.com/sql-server-2000/seeing-believing"" rel=""noreferrer"">Demo of performance gain</a> </li>
</ul>

<p>Edit 4: 13 May 2011</p>

<p><a href=""https://stackoverflow.com/q/5880413/27535"">Breaks Linq 2 SQL too when not specified?</a></p>

<p>Edit 5: 14 Jun 2011</p>

<p>Breaks JPA, stored proc with table variables: <a href=""https://stackoverflow.com/q/6344631/27535"">Does JPA 2.0 support SQL Server table variables?</a></p>

<p>Edit 6: 15 Aug 2011</p>

<p>The SSMS ""Edit rows"" data grid requires SET NOCOUNT ON: <a href=""https://stackoverflow.com/q/7067329/27535"">Update trigger with GROUP BY</a></p>

<p>Edit 7: 07 Mar 2013</p>

<p>More in depth details from @RemusRusanu:<br> <a href=""https://stackoverflow.com/questions/1915405/does-set-nocount-on-really-make-that-much-of-a-performance-difference/1918085#1918085"">Does SET NOCOUNT ON really make that much of a performance difference</a></p>
","<p>Ok now I've done my research, here is the deal:</p>

<ul>
<li><p>In TDS protocol <a href=""https://msdn.microsoft.com/en-us/library/dd340553.aspx"" rel=""noreferrer"">SET NOCOUNT ON only saves 9-bytes per query</a>, which doesn't seem that much. I used to think that <code>9 row(s) affected</code> was returned from server in plain text but it doesn't seem to be the case. It's in fact a small message packet called <code>DONE_IN_PROC</code>.</p></li>
<li><p>Microsoft actually encourages the use of <code>SET NOCOUNT ON</code> in Stored Procedures, as per the book ""<a href=""http://msdn.microsoft.com/en-us/library/ms998530.aspx"" rel=""noreferrer"">Improving .NET Application Performance and Scalability</a>"" (page 541). I would not base my design decisions upon SqlDataAdapter.</p></li>
</ul>

<p>So I think you can stick with <code>SET NOCOUNT ON</code>'s if the cost is less than switching to another technology. I would still consider abandoning SqlDataAdapter since you still don't know what kind of design quirk you'll encounter next.</p>

<p>EDIT: @racingsnail pointed out that the network roundtrip delay is a bigger performance killer than the packet size. He has a point but a second network packet wouldn't cause the same delay as the roundtrip latency because the packets would be sent in tandem and would not require acknowledgement. So it may cause far less delay than the actual network roundtrip latency.</p>

<p>EDIT 2: Here is a very detailed analysis about insignificant overhead of <code>SET NOCOUNT</code> setting: <a href=""http://daleburnett.com/2014/01/everything-ever-wanted-know-set-nocount/"" rel=""noreferrer"">http://daleburnett.com/2014/01/everything-ever-wanted-know-set-nocount/</a></p>
","1547539"
"Better techniques for trimming leading zeros in SQL Server?","153383","","<p>I've been using <a href=""https://stackoverflow.com/questions/92093/removing-leading-zeroes-from-a-field-in-a-sql-statement"">this</a> for some time:</p>

<pre><code>SUBSTRING(str_col, PATINDEX('%[^0]%', str_col), LEN(str_col))
</code></pre>

<p>However recently, I've found a problem with columns with all ""0"" characters like '00000000' because it never finds a non-""0"" character to match.</p>

<p>An alternative technique I've seen is to use <code>TRIM</code>:</p>

<pre><code>REPLACE(LTRIM(REPLACE(str_col, '0', ' ')), ' ', '0')
</code></pre>

<p>This has a problem if there are embedded spaces, because they will be turned into ""0""s when the spaces are turned back into ""0""s.</p>

<p>I'm trying to avoid a scalar UDF.  I've found a lot of performance problems with UDFs in SQL Server 2005.</p>
","<pre><code>SUBSTRING(str_col, PATINDEX('%[^0]%', str_col+'.'), LEN(str_col))
</code></pre>
","662437"
"Online SQL Query Syntax Checker","153014","","<p>I need an online sql query syntax validator. I searched online but didn't find anything good. </p>

<p>I saw the references in this question too:</p>

<p><a href=""https://stackoverflow.com/questions/3138022/syntax-checker-and-validator-for-sql"">Syntax Checker and Validator for SQL?</a></p>
","<p><a href=""http://sqlfiddle.com/"">http://sqlfiddle.com/</a> will let you test out your queries, while it doesn't explicitly correct syntax etc. per se it does let you play around with the script and will definitely let you know if things are working or not.</p>
","22977344"
"How to output oracle sql result into a file in windows?","152749","","<p>I tried</p>

<pre><code>select * from users 
save D:\test.sql create;
</code></pre>

<p>But SQL plus gives me ""no proper ended""
How to specify path in oracle sql in windows?</p>
","<p>Use the spool:</p>

<pre><code>spool myoutputfile.txt
select * from users;
spool off;
</code></pre>

<p>Note that this will create myoutputfile.txt in the directory from which you ran SQL*Plus.</p>

<p>If you need to run this from a SQL file (e.g., ""tmp.sql"") when SQLPlus starts up and output to a file named ""output.txt"":</p>

<p>tmp.sql:</p>

<pre><code>select * from users;
</code></pre>

<p>Command:</p>

<pre><code>sqlplus -s username/password@sid @tmp.sql &gt; output.txt
</code></pre>

<p>Mind you, I don't have an Oracle instance in front of me right now, so you might need to do some of your own work to debug what I've written from memory.</p>
","15253498"
"How can I find out what FOREIGN KEY constraint references a table in SQL Server?","152689","","<p>I am trying to drop a table but getting the following message:</p>

<blockquote>
  <p>Msg 3726, Level 16, State 1, Line 3<br>
  Could not drop object 'dbo.UserProfile' because it is referenced by a FOREIGN KEY constraint.<br>
  Msg 2714, Level 16, State 6, Line 2<br>
  There is already an object named 'UserProfile' in the database.</p>
</blockquote>

<p>I looked around with SQL Server Management Studio but I am unable to find the constraint. How can I find out the foreign key constraints?</p>
","<p>Here it is:</p>

<pre><code>SELECT 
   OBJECT_NAME(f.parent_object_id) TableName,
   COL_NAME(fc.parent_object_id,fc.parent_column_id) ColName
FROM 
   sys.foreign_keys AS f
INNER JOIN 
   sys.foreign_key_columns AS fc 
      ON f.OBJECT_ID = fc.constraint_object_id
INNER JOIN 
   sys.tables t 
      ON t.OBJECT_ID = fc.referenced_object_id
WHERE 
   OBJECT_NAME (f.referenced_object_id) = 'YourTableName'
</code></pre>

<p>This way, you'll get the referencing table and column name.</p>

<p>Edited to use sys.tables instead of generic sys.objects as per comment suggestion.
Thanks, marc_s</p>
","17501870"
"Case statement in MySQL","152657","","<p>There is a table '<strong>tbl_transaction</strong>' with </p>

<pre><code>id INT(11) Primary Key
action_type ENUM('Expense', 'Income')
action_heading VARCHAR (255)
action_amount FLOAT
</code></pre>

<p>Is it possible to get result using only SQL Query listing all expense amount in Expense Amt column and income amount in Income Amt column like :</p>

<pre><code>ID        Heading         Income Amt       Expense Amt
1         ABC             1000             -
2         XYZ             -                2000
</code></pre>

<p>I'm using MySQL as database. And I'm trying to use CASE statement.</p>

<p>Cheers!</p>
","<p>Yes, something like this:</p>

<pre><code>SELECT
    id,
    action_heading,
    CASE
        WHEN action_type = 'Income' THEN action_amount
        ELSE NULL
    END AS income_amt,
    CASE
        WHEN action_type = 'Expense' THEN action_amount
        ELSE NULL
    END AS expense_amt

FROM tbl_transaction;
</code></pre>

<hr>

<p>As other answers have pointed out, MySQL also has the <code>IF()</code> function to do this using less verbose syntax.  I generally try to avoid this because it is a MySQL-specific extension to SQL that isn't generally supported elsewhere.  <code>CASE</code> is standard SQL and is much more portable across different database engines, and I prefer to write portable queries as much as possible, only using engine-specific extensions when the portable alternative is <em>considerably</em> slower or less convenient.</p>
","15265922"
"how to call scalar function in sql server 2008","152629","","<p>I have created a Scalar Functions, it was created successfully, but when I call the function using select statement, it says  Invalid object name 'dbo.fun_functional_score'.</p>

<p>my function:</p>

<pre><code> ALTER function [dbo].[fun_functional_score] (@phy_id varchar(20))
 returns  varchar(50)

as
begin 

declare @level_initial int, @level_current int

-- initial functional score
set @level_initial=(SELECT pflag.fun_level
FROM tbl_phy_demographic_details as [phy] 
    inner join tbl_all_purple_flag_level as [pflag] on phy.Demographic_id=pflag.Id 
WHERE phy.Physicion_id=@phy_id
    and pflag.visited_count=(select MAX(visited_count)-1 from tbl_all_purple_flag_level ))


-- current functional score
set @level_current=(SELECT pflag.fun_level
FROM tbl_phy_demographic_details as [phy] 
    inner join tbl_all_purple_flag_level as [pflag] on phy.Demographic_id=pflag.Id 
WHERE phy.Physicion_id=@phy_id
    and pflag.visited_count=(select MAX(visited_count) from tbl_all_purple_flag_level ))


--to calculate functional score
declare @fun_level varchar(20),@result varchar(50)

set  @fun_level=@level_current-@level_initial;

 if @fun_level = 0   set @result='Maintained' 
if @fun_level = '-1'  set @result='Minor Improvement' 
if @fun_level = '-2'  set @result='Moderate Improvement' 
if @fun_level = '-3'  set @result='Significant Improvement' 
if @fun_level =  '-4'  set @result='Substantial Improvement' 
if @fun_level =  '1'  set @result='Minor Reduction' 
if @fun_level =  '2'  set @result='Moderate Reduction' 
if @fun_level =  '3'  set @result='Significant Reduction' 
if @fun_level =  '4'  set @result='Substantial Reduction' 




return @result

end
</code></pre>

<p>i used this select to call </p>

<pre><code> select * from dbo.fun_functional_score('01091400003') as [er]
</code></pre>

<p>or </p>

<pre><code> select * from dbo.fun_functional_score('01091400003') 
</code></pre>

<p>both showing error ""Invalid object name 'dbo.fun_functional_score'.
""</p>

<p>where i made error . can anyone help me...</p>
","<p>Your syntax is for table valued function which return a resultset and can be queried like a table. For scalar function do </p>

<pre><code> select  dbo.fun_functional_score('01091400003') as [er]
</code></pre>
","21041428"
"MySQL SELECT AS combine two columns into one","152322","","<p>Using <a href=""https://stackoverflow.com/questions/16062825/combine-two-columns-in-one-column"">this solution</a>, I tried to use COALESCE as part of a MySQL query that outputs to a csv file using SELECT As to name the column names when exporting the data.</p>

<pre><code>SELECT FirstName AS First_Name
     , LastName AS Last_Name
     , ContactPhoneAreaCode1
     , ContactPhoneNumber1
     , COALESCE(ContactPhoneAreaCode1, ContactPhoneNumber1) AS Contact_Phone 
  FROM TABLE1
</code></pre>

<p>I wanted 3 columns: First_Name, Last_Name and Contact_Phone</p>

<p>I am getting 5 columns: First_Name, Last_Name, ContactPhoneAreaCode1, ContactPhoneNumber1 and Contact_Phone</p>

<p>How do I hide the merging of ContactPhoneAreaCode1, ContactPhoneNumber1 into a single column for Contact_Phone from within the query?</p>
","<p>If both columns can contain <code>NULL</code>, but you still want to merge them to a single string, the easiest solution is to use <a href=""http://dev.mysql.com/doc/refman/5.5/en/string-functions.html#function_concat-ws"" rel=""noreferrer""><strong>CONCAT_WS()</strong></a>:</p>

<pre><code>SELECT FirstName AS First_Name
     , LastName AS Last_Name
     , CONCAT_WS('', ContactPhoneAreaCode1, ContactPhoneNumber1) AS Contact_Phone 
  FROM TABLE1
</code></pre>

<p>This way you won't have to check for <code>NULL</code>-ness of each column separately.</p>

<p>Alternatively, if both columns are actually defined as <code>NOT NULL</code>, <a href=""http://dev.mysql.com/doc/refman/5.5/en/string-functions.html#function_concat"" rel=""noreferrer""><strong>CONCAT()</strong></a> will be quite enough:</p>

<pre><code>SELECT FirstName AS First_Name
     , LastName AS Last_Name
     , CONCAT(ContactPhoneAreaCode1, ContactPhoneNumber1) AS Contact_Phone 
  FROM TABLE1
</code></pre>

<p>As for <code>COALESCE</code>, it's a bit different beast: given the list of arguments, it returns the first that's not <code>NULL</code>.</p>
","18860298"
"Best way to work with dates in Android SQLite","152018","","<p>I'm having some trouble working with dates on my Android application that uses SQLite.
I have a couple questions:</p>

<ol>
<li>What type should I use to store dates in SQLite (text, integer, ...)?</li>
<li>Given the best way to store dates how do I store It properly using ContentValues?</li>
<li>What's the best way to retrieve the date from the SQLite database?</li>
<li>How to make a sql select on SQLite, ordering the results by date?</li>
</ol>
","<p>You can use a text field to store dates within <code>SQLite</code>.</p>

<p>Storing dates in UTC format, the default if you use <code>datetime('now')</code> <code>(yyyy-MM-dd HH:mm:ss)</code> will then allow sorting by the date column.</p>

<p>Retrieving dates as strings from <code>SQLite</code> you can then format/convert them as required into local regionalised formats using the Calendar or the <code>android.text.format.DateUtils.formatDateTime</code> method.</p>

<p>Here's a regionalised formatter method I use;</p>

<pre><code>public static String formatDateTime(Context context, String timeToFormat) {

    String finalDateTime = """";          

    SimpleDateFormat iso8601Format = new SimpleDateFormat(
            ""yyyy-MM-dd HH:mm:ss"");

    Date date = null;
    if (timeToFormat != null) {
        try {
            date = iso8601Format.parse(timeToFormat);
        } catch (ParseException e) {
            date = null;
        }

        if (date != null) {
            long when = date.getTime();
            int flags = 0;
            flags |= android.text.format.DateUtils.FORMAT_SHOW_TIME;
            flags |= android.text.format.DateUtils.FORMAT_SHOW_DATE;
            flags |= android.text.format.DateUtils.FORMAT_ABBREV_MONTH;
            flags |= android.text.format.DateUtils.FORMAT_SHOW_YEAR;

            finalDateTime = android.text.format.DateUtils.formatDateTime(context,
            when + TimeZone.getDefault().getOffset(when), flags);               
        }
    }
    return finalDateTime;
}
</code></pre>
","7363557"
"How can I get the number of days between 2 dates in Oracle 11g?","151999","","<p>I'm trying to find an integer number of days between two dates in Oracle 11g.  </p>

<p>I can get close by doing </p>

<pre><code>select sysdate - to_date('2009-10-01', 'yyyy-mm-dd') from dual
</code></pre>

<p>but this returns an interval, and I haven't been successful casting this to an integer.</p>

<p>Edit: Apparently in 10g, this returns the number of days as an integer.</p>
","<p>I figured it out myself.  I need </p>

<pre><code>select extract(day from sysdate - to_date('2009-10-01', 'yyyy-mm-dd')) from dual
</code></pre>
","1646026"
"Questions every good Database/SQL developer should be able to answer","151735","","<p>I was going through <a href=""https://stackoverflow.com/questions/365489/questions-every-good-net-developer-should-be-able-to-answer"">Questions every good .Net developer should be able to answer</a> and was highly impressed with the content and approach of this question and so in the same spirit, I am asking this question for Database/SQL Developer.</p>

<p><strong>What questions</strong> do you think should a good <strong>Database/SQL programmer be able to respond to?</strong></p>
","<p>The different types of JOINs:</p>

<ul>
<li>INNER JOIN</li>
<li>LEFT and RIGHT OUTER JOIN</li>
<li>FULL JOIN</li>
<li>CROSS JOIN</li>
</ul>

<p>See Jeff Atwood's <a href=""http://www.codinghorror.com/blog/archives/000976.html"" rel=""nofollow noreferrer"">Visual Explanation of JOINs</a></p>

<ul>
<li>What is a key? A candidate key? A primary key? An alternate key? A foreign key?</li>
<li><p>What is an index and how does it help your database?</p></li>
<li><p>What are the data types available and when to use which ones?</p></li>
</ul>
","2119875"
"Import CSV into SQL Server (including automatic table creation)","151388","","<p>I have several <strong>CSV files</strong>, which I want to import into an <strong>SQL Server database</strong>. I know if this is possible with BULK insert, but I want a solution, so that also the <strong>import table is automatically created before</strong> on basis the first row of the CSV files,are the column names.</p>
","<p>SQL Server Management Studio provides an Import/Export wizard tool which have an option to automatically create tables.</p>

<p>You can access it by right clicking on the Database in Object Explorer and selecting <strong><em>Tasks->Import Data...</em></strong></p>

<p>From there wizard should be self-explanatory and easy to navigate. You choose your CSV as source, desired destination, configure columns and run the package. </p>

<p>If you need detailed guidance, there are plenty of guides online, here is a nice one:
<a href=""http://www.mssqltips.com/sqlservertutorial/203/simple-way-to-import-data-into-sql-server/"" rel=""nofollow noreferrer"">http://www.mssqltips.com/sqlservertutorial/203/simple-way-to-import-data-into-sql-server/</a></p>
","15655645"
"use current date as default value for a column","151211","","<p>Is there a way to set the default value of a column to <code>DateTime.Now</code> in Sql Server?</p>

<p>Example:</p>

<pre><code>table Event
Id int (auto-increment) not null
Description nvarchar(50) not null
Date datetime not null
</code></pre>

<p>The line:</p>

<pre><code>Insert into Event(Description) values('teste');
</code></pre>

<p>should insert a row and the Date value should be the current date.</p>
","<p>Add a default constraint with the GETDATE() function as value.</p>

<pre><code>ALTER TABLE myTable 
  ADD CONSTRAINT CONSTRAINT_NAME
    DEFAULT GETDATE() FOR myColumn
</code></pre>
","5718198"
"Force index use in Oracle","150933","","<p>I encountered this question in an interview and had no clue how to answer:</p>

<p>There is a table which has a index on a column, and you query:</p>

<pre><code>select * from table_name where column_having_index=""some value"";
</code></pre>

<p>The query takes too long, and you find out that the index is not being used.  If you think the performance of the query will be better using the index, how could you force the query to use the index?</p>
","<p>You can use optimizer hints</p>

<p><code>select /*+ INDEX(table_name index_name) */ from table</code> etc...</p>

<p>More on using optimizer hints:
<a href=""http://download.oracle.com/docs/cd/B19306_01/server.102/b14211/hintsref.htm"" rel=""noreferrer"">http://download.oracle.com/docs/cd/B19306_01/server.102/b14211/hintsref.htm</a></p>
","1838107"
"dbms_lob.getlength() vs. length() to find blob size in oracle","150828","","<p>I'm getting the same results from </p>

<pre><code>select length(column_name) from table
</code></pre>

<p>as</p>

<p><code>select dbms_lob.getlength(column_name) from table</code> </p>

<p>However, the answers to
<a href=""https://stackoverflow.com/questions/840966/what-is-an-elegant-way-to-return-a-readable-file-size-of-a-file-stored-in-an-or"">this question</a> seem to favor using <code>dbms_lob.getlength()</code>.  </p>

<p>Is there any benefit to using <code>dbms_lob.getlength()</code>? </p>

<p>If it changes the answer, I know all of the blobs are .bmp images (never worked with blobs before).</p>
","<p><a href=""http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/functions076.htm#i77725"" rel=""noreferrer"" title=""LENGTH 10gR2""><code>length</code></a> and <a href=""http://docs.oracle.com/cd/B19306_01/appdev.102/b14258/d_lob.htm#i998484"" rel=""noreferrer""><code>dbms_lob.getlength</code></a> return the number of characters when applied to a <strong>CLOB</strong> (Character LOB). When applied to a <strong>BLOB</strong> (Binary LOB), <code>dbms_lob.getlength</code> will return the number of bytes, which may differ from the number of characters in a multi-byte character set.</p>

<p>As the documentation doesn't specify what happens when you apply <code>length</code> on a BLOB, I would advise against using it in that case. If you want the number of bytes in a BLOB, use <code>dbms_lob.getlength</code>.</p>
","2373230"
"oracle SQL how to remove time from date","150796","","<p>I have a column named <code>StartDate</code> containing a date in this format: <code>03-03-2012 15:22</code></p>

<p>What I need is to convert it to date. It should be looking like this: <code>DD/MM/YYYY</code></p>

<p>What I have tried without success is:</p>

<pre><code>select 
p1.PA_VALUE as StartDate,
p2.PA_VALUE as EndDate
from WP_Work p 
LEFT JOIN PARAMETER p1 on p1.WP_ID=p.WP_ID AND p1.NAME = 'StartDate'
LEFT JOIN PARAMETER p2 on p2.WP_ID=p.WP_ID AND p2.NAME = 'Date_To'
WHERE p.TYPE = 'EventManagement2'
AND TO_DATE(p1.PA_VALUE, 'DD/MM/YYYY') &gt;= TO_DATE('25/10/2012', 'DD/MM/YYYY')
AND TO_DATE(p2.PA_VALUE, 'DD/MM/YYYY') &lt;= TO_DATE('26/10/2012', 'DD/MM/YYYY')
</code></pre>

<p>Is there a way to do this?</p>

<p>EDIT1: the <code>PA_VALUE</code> column is: <code>VARCHAR2</code></p>
","<p>When you convert your string to a date you need to match the date mask to the format in the string.  This includes a time element, which you need to remove with truncation:</p>

<pre><code>select 
p1.PA_VALUE as StartDate,
p2.PA_VALUE as EndDate
from WP_Work p 
LEFT JOIN PARAMETER p1 on p1.WP_ID=p.WP_ID AND p1.NAME = 'StartDate'
LEFT JOIN PARAMETER p2 on p2.WP_ID=p.WP_ID AND p2.NAME = 'Date_To'
WHERE p.TYPE = 'EventManagement2'
AND trunc(TO_DATE(p1.PA_VALUE, 'DD-MM-YYYY HH24:MI')) &gt;= TO_DATE('25/10/2012', 'DD/MM/YYYY')
AND trunc(TO_DATE(p2.PA_VALUE, 'DD-MM-YYYY HH24:MI')) &lt;= TO_DATE('26/10/2012', 'DD/MM/YYYY')
</code></pre>
","13136121"
"Which ""special"" characters are allowed in SQL Server varchar fields?","150725","","<p>Where can I see all the ""special"" characters permissible in a <code>varchar</code> or <code>char</code> field in SQL Server? </p>
","<p>You probably just need to see the <code>ASCII</code> and <code>EXTENDED ASCII</code> character sets.  As far as I know any of these are allowed in a <code>char</code>/<code>varchar</code> field.</p>

<p>If you use <code>nchar</code>/<code>nvarchar</code> then it's pretty much any character in any unicode set in the world.</p>

<p><img src=""https://i.stack.imgur.com/PGGtf.png"" alt=""enter image description here""></p>

<p><img src=""https://i.stack.imgur.com/geRkB.png"" alt=""enter image description here""></p>
","7039032"
"Failed to enable constraints. One or more rows contain values violating non-null, unique, or foreign-key constraints","150505","","<p>I make an outer join and executed successfully in the <code>informix</code> database but I get the following exception in my code:</p>

<pre><code>DataTable dt = TeachingLoadDAL.GetCoursesWithEvalState(i, bat);
</code></pre>

<blockquote>
  <p>Failed to enable constraints. One or more rows contain values
  violating non-null, unique, or foreign-key constraints.</p>
</blockquote>

<p>I know the problem, but I don't know how to fix it.</p>

<p>The second table I make the outer join on contains a composite primary key which are null in the previous outer join query.</p>

<p><strong>EDIT:</strong></p>

<pre><code>    SELECT UNIQUE a.crs_e,  a.crs_e  || '/ ' || a.crst crs_name, b.period,
           b.crscls, c.crsday, c.from_lect, c.to_lect,
           c.to_lect - c.from_lect + 1 Subtraction, c.lect_kind, e.eval, e.batch_no,
           e.crsnum, e.lect_code, e.prof_course
    FROM rlm1course a, rfc14crsgrp b, ckj1table c, mnltablelectev d,
         OUTER(cc1assiscrseval e)  
    WHERE a.crsnum = b.crsnum 
    AND b.crsnum = c.crsnum 
    AND b.crscls = c.crscls 
    AND b.batch_no = c.batch_no 
    AND c.serial_key = d.serial_key  
    AND c.crsnum = e.crsnum  
    AND c.batch_no = e.batch_no  
    AND d.lect_code= e.lect_code 
    AND d.lect_code = .... 
    AND b.batch_no = ....
</code></pre>

<p>The problem happens with the table <code>cc1assiscrseval</code>. The primary key is (batch_no, crsnum, lect_code).</p>

<p>How to fix this problem?</p>

<hr>

<p><strong>EDIT:</strong></p>

<p>According to <code>@PaulStock</code> advice:
I do what he said, and i get:</p>

<blockquote>
  <p>? dt.GetErrors()[0] {System.Data.DataRow} HasErrors: true ItemArray:
  {object[10]} RowError: ""Column 'eval' does not allow DBNull.Value.""</p>
</blockquote>

<p>So I solve my problem by replacing  <code>e.eval</code> to ,<code>NVL (e.eval,'') eval</code>.and this solves my problem.
Thanks a lot.</p>
","<p>This problem is usually caused by one of the following</p>

<ul>
<li>null values being returned for columns not set to AllowDBNull</li>
<li>duplicate rows being returned with the same primary key.</li>
<li>a mismatch in column definition (e.g. size of char fields) between the database and the dataset</li>
</ul>

<p>Try running your query natively and look at the results, if the resultset is not too large. If you've eliminated null values, then my guess is that the primary key columns is being duplicated.</p>

<p>Or, to see the exact error, you can manually add a Try/Catch block to the generated code like so and then breaking when the exception is raised:</p>

<p><img src=""https://i.stack.imgur.com/HQrHa.png"" alt=""enter image description here""></p>

<p>Then within the command window, call <code>GetErrors</code> method on the table getting the error.<br>
For C#, the command would be <code>? dataTable.GetErrors()</code><br>
For VB, the command is <code>? dataTable.GetErrors</code></p>

<p><img src=""https://i.stack.imgur.com/ekNb5.png"" alt=""enter image description here""></p>

<p>This will show you all datarows which have an error. You can get then look at the <code>RowError</code> for each of these, which should tell you the column that's invalid along with the problem. So, to see the error of the first datarow in error the command is:<br>
<code>? dataTable.GetErrors(0).RowError</code><br>
or in C# it would be <code>? dataTable.GetErrors()[0].RowError</code></p>

<p><img src=""https://i.stack.imgur.com/Ynmlf.png"" alt=""enter image description here""></p>
","7029713"
"Can I do a max(count(*)) in SQL?","150376","","<p>Here's my code:</p>

<pre><code>    select yr,count(*)  from movie
join casting on casting.movieid=movie.id
join actor on casting.actorid = actor.id
where actor.name = 'John Travolta'
group by yr
</code></pre>

<p>Here's the question</p>

<blockquote>
  <p>Which were the busiest years for 'John Travolta'. Show the number of movies he made for each year.</p>
</blockquote>

<p>Here's the table structure:</p>

<pre><code>movie(id, title, yr, score, votes, director)
actor(id, name)
casting(movieid, actorid, ord)
</code></pre>

<p>This is the output I am getting:</p>

<pre><code>yr  count(*)
1976    1
1977    1
1978    1
1981    1
1994    1
etcetc
</code></pre>

<p>I need to get the rows for which <code>count(*)</code> is max.</p>

<p>How do I do this?</p>
","<p>Use:</p>

<pre><code>  SELECT m.yr, 
         COUNT(*) AS num_movies
    FROM MOVIE m
    JOIN CASTING c ON c.movieid = m.id
    JOIN ACTOR a ON a.id = c.actorid
                AND a.name = 'John Travolta'
GROUP BY m.yr
ORDER BY num_movies DESC, m.yr DESC
</code></pre>

<p>Ordering by <code>num_movies DESC</code> will put the highest values at the top of the resultset.  If numerous years have the same count, the <code>m.yr</code> will place the most recent year at the top... until the next <code>num_movies</code> value changes.</p>

<h2>Can I use a MAX(COUNT(*)) ?</h2>

<hr>

<p>No, you can not layer aggregate functions on top of one another in the same SELECT clause.  The inner aggregate would have to be performed in a subquery.  IE:</p>

<pre><code>SELECT MAX(y.num)
  FROM (SELECT COUNT(*) AS num
          FROM TABLE x) y
</code></pre>
","2436957"
"How to change column order in a table using sql query in sql server 2005?","150317","","<p>How to change column order in a table using SQL query in SQL Server 2005?</p>

<p>I want to rearrange column order in a table using SQL query.</p>
","<p>You cannot. The column order is just a ""cosmetic"" thing we humans care about - to SQL Server, it's almost always absolutely irrelevant.</p>

<p>What SQL Server Management Studio does in the background when you change column order there is recreating the table from scratch with a new <code>CREATE TABLE</code> command, copying over the data from the old table, and then dropping it.</p>

<p>There is no SQL command to define the column ordering.</p>
","1605167"
"SQL Server : Columns to Rows","150151","","<p>Looking for elegant (or any) solution to convert columns to rows.</p>

<p>Here is an example: I have a table with the following schema:</p>

<pre><code>[ID] [EntityID] [Indicator1] [Indicator2] [Indicator3] ... [Indicator150]
</code></pre>

<p>Here is what I want to get as the result:</p>

<pre><code>[ID] [EntityId] [IndicatorName] [IndicatorValue]
</code></pre>

<p>And the result values will be:</p>

<pre><code>1 1 'Indicator1' 'Value of Indicator 1 for entity 1'
2 1 'Indicator2' 'Value of Indicator 2 for entity 1'
3 1 'Indicator3' 'Value of Indicator 3 for entity 1'
4 2 'Indicator1' 'Value of Indicator 1 for entity 2'
</code></pre>

<p>And so on..</p>

<p>Does this make sense? Do you have any suggestions on where to look and how to get it done in T-SQL? </p>
","<p>You can use the <a href=""http://msdn.microsoft.com/en-us/library/ms177410%28v=sql.105%29.aspx"" rel=""noreferrer"">UNPIVOT</a> function to convert the columns into rows:</p>

<pre><code>select id, entityId,
  indicatorname,
  indicatorvalue
from yourtable
unpivot
(
  indicatorvalue
  for indicatorname in (Indicator1, Indicator2, Indicator3)
) unpiv;
</code></pre>

<p>Note, the datatypes of the columns you are unpivoting must be the same so you might have to convert the datatypes prior to applying the unpivot. </p>

<p>You could also use <code>CROSS APPLY</code> with UNION ALL to convert the columns:</p>

<pre><code>select id, entityid,
  indicatorname,
  indicatorvalue
from yourtable
cross apply
(
  select 'Indicator1', Indicator1 union all
  select 'Indicator2', Indicator2 union all
  select 'Indicator3', Indicator3 union all
  select 'Indicator4', Indicator4 
) c (indicatorname, indicatorvalue);
</code></pre>

<p>Depending on your version of SQL Server you could even use CROSS APPLY with the VALUES clause:</p>

<pre><code>select id, entityid,
  indicatorname,
  indicatorvalue
from yourtable
cross apply
(
  values
  ('Indicator1', Indicator1),
  ('Indicator2', Indicator2),
  ('Indicator3', Indicator3),
  ('Indicator4', Indicator4)
) c (indicatorname, indicatorvalue);
</code></pre>

<p>Finally, if you have 150 columns to unpivot and you don't want to hard-code the entire query, then you could generate the sql statement using dynamic SQL:</p>

<pre><code>DECLARE @colsUnpivot AS NVARCHAR(MAX),
   @query  AS NVARCHAR(MAX)

select @colsUnpivot 
  = stuff((select ','+quotename(C.column_name)
           from information_schema.columns as C
           where C.table_name = 'yourtable' and
                 C.column_name like 'Indicator%'
           for xml path('')), 1, 1, '')

set @query 
  = 'select id, entityId,
        indicatorname,
        indicatorvalue
     from yourtable
     unpivot
     (
        indicatorvalue
        for indicatorname in ('+ @colsunpivot +')
     ) u'

exec sp_executesql @query;
</code></pre>
","18026337"
"Unpivot with column name","149798","","<p>I have a table <code>StudentMarks</code> with columns <code>Name, Maths, Science, English</code>.
Data is like    </p>

<pre><code>Name,  Maths, Science, English  
Tilak, 90,    40,      60  
Raj,   30,    20,      10
</code></pre>

<p>I want to get it arranged like the following:</p>

<pre><code>Name,  Subject,  Marks
Tilak, Maths,    90
Tilak, Science,  40
Tilak, English,  60
</code></pre>

<p>With <a href=""http://technet.microsoft.com/en-us/library/ms177410%28v=SQL.105%29.aspx"" rel=""noreferrer"">unpivot</a> I am able to get Name, Marks properly, but not able to get the column name in the source table to the <code>Subject</code> column in the desired result set.</p>

<p>How can I achieve this?</p>

<p>I have so far reached the following query (to get Name, Marks)</p>

<pre><code>select Name, Marks from studentmarks
Unpivot
(
  Marks for details in (Maths, Science, English)

) as UnPvt
</code></pre>
","<p>Your query is very close. You should be able to use the following which includes the <code>subject</code> in the final select list:</p>

<pre><code>select u.name, u.subject, u.marks
from student s
unpivot
(
  marks
  for subject in (Maths, Science, English)
) u;
</code></pre>

<p>See <a href=""http://sqlfiddle.com/#!3/48936/1"">SQL Fiddle with demo</a></p>
","19056083"
"ALTER DATABASE failed because a lock could not be placed on database","149519","","<p>I need to restart a database because some processes are not working. My plan is to take it offline and back online again.</p>

<p>I am trying to do this in Sql Server Management Studio 2008:</p>

<pre><code>use master;
go
alter database qcvalues
set single_user
with rollback immediate;
alter database qcvalues
set multi_user;
go
</code></pre>

<p>I am getting these errors:</p>

<pre><code>Msg 5061, Level 16, State 1, Line 1
ALTER DATABASE failed because a lock could not be placed on database 'qcvalues'. Try again later.
Msg 5069, Level 16, State 1, Line 1
ALTER DATABASE statement failed.
Msg 5061, Level 16, State 1, Line 4
ALTER DATABASE failed because a lock could not be placed on database 'qcvalues'. Try again later.
Msg 5069, Level 16, State 1, Line 4
ALTER DATABASE statement failed.
</code></pre>

<p>What am I doing wrong?</p>
","<p>After you get the error, run</p>

<pre><code>EXEC sp_who2
</code></pre>

<p>Look for the database in the list.  It's possible that a connection was not terminated. If you find any connections to the database, run</p>

<pre><code>KILL &lt;SPID&gt;
</code></pre>

<p>where <code>&lt;SPID&gt;</code> is the SPID for the sessions that are connected to the database.</p>

<p>Try your script after all connections to the database are removed.</p>

<p>Unfortunately, I don't have a reason why you're seeing the problem, but here is a link that shows that the problem has occurred elsewhere.</p>

<p><a href=""http://www.geakeit.co.uk/2010/12/11/sql-take-offline-fails-alter-database-failed-because-a-lock-could-not-error-5061/"" rel=""noreferrer"">http://www.geakeit.co.uk/2010/12/11/sql-take-offline-fails-alter-database-failed-because-a-lock-could-not-error-5061/</a></p>
","4673352"
"Search of table names","149085","","<p>I use the following to search for strings in my stored procedures:</p>

<pre><code>use DBname
SELECT Name
FROM sys.procedures
WHERE OBJECT_DEFINITION(OBJECT_ID) LIKE '%xxx%'
</code></pre>

<p>Is it easy to amend the above so that it searches Table names in a specific db ""DBname"" ?</p>
","<pre><code>select name
  from DBname.sys.tables
 where name like '%xxx%'
   and is_ms_shipped = 0; -- &lt;&lt; comment out if you really want to see them
</code></pre>
","13085727"
"How to convert Calendar to java.sql.Date in Java?","148998","","<pre><code>Calendar cal;
String sql = ""INSERT INTO ttable (dt) values (?);""
//dt is a dateTime field in ttable

PreparedStatement stmt = connection.prepareStatement(sql);

stmt = setDate(1,cal); //not working

stmt.execute();
stmt.close();
</code></pre>

<p>I would like to convert cal to a Date type to insert into table.</p>
","<p>There is a <a href=""http://docs.oracle.com/javase/6/docs/api/java/util/Calendar.html#getTime%28%29"" rel=""noreferrer"">getTime</a> method (unsure why it's not called getDate).</p>

<p>Edit: Just realised you need a java.sql.Date. One of the answers which use <code>cal.getTimeInMillis()</code> is what you need.</p>
","9112805"
"How to use SQL Select statement with IF EXISTS sub query?","148865","","<p>How to select Boolean value from sub query with IF EXISTS statement (SQL Server)?</p>

<p>It should be something like :</p>

<pre><code>SELECT 
  TABEL1.Id, 
  NewFiled = (IF EXISTS(SELECT Id FROM TABLE2 WHERE TABLE2.ID = TABEL1.ID) 
                 SELECT 'TRUE' 
              ELSE 
                 SELECT 'FALSE') 
FROM TABEL1
</code></pre>
","<p>Use <code>CASE</code>:</p>

<pre><code>SELECT 
  TABEL1.Id, 
  CASE WHEN EXISTS (SELECT Id FROM TABLE2 WHERE TABLE2.ID = TABLE1.ID)
       THEN 'TRUE' 
       ELSE 'FALSE'
  END AS NewFiled  
FROM TABLE1
</code></pre>

<hr>

<p>If <code>TABLE2.ID</code> is Unique or a Primary Key, you could also use this:</p>

<pre><code>SELECT 
  TABEL1.Id, 
  CASE WHEN TABLE2.ID IS NOT NULL
       THEN 'TRUE' 
       ELSE 'FALSE'
  END AS NewFiled  
FROM TABLE1
  LEFT JOIN Table2
    ON TABLE2.ID = TABLE1.ID
</code></pre>
","7805103"
"MySQL GROUP BY two columns","148777","","<p>I'm trying to group by multiple columns here - one on each table.<br>
It's a scenario where I want to find the top portfolio value for each client by adding their current portfolio and cash together but a client may have more than one portfolio, so I need the top portfolio for each client.</p>

<p>At the moment, with the code below I'm getting the same clients multiple times for each of their top portfolios (it's not grouping by client id).</p>

<pre><code>SELECT clients.id, clients.name, portfolios.id, SUM ( portfolios.portfolio +  portfolios.cash ) AS total
FROM clients, portfolios
WHERE clients.id = portfolios.client_id
GROUP BY portfolios.id, clients.id
ORDER BY total DESC
LIMIT 30 
</code></pre>
","<p>First, let's make some test data:</p>

<pre><code>create table client (client_id integer not null primary key auto_increment,
                     name varchar(64));
create table portfolio (portfolio_id integer not null primary key auto_increment,
                        client_id integer references client.id,
                        cash decimal(10,2),
                        stocks decimal(10,2));
insert into client (name) values ('John Doe'), ('Jane Doe');
insert into portfolio (client_id, cash, stocks) values (1, 11.11, 22.22),
                                                       (1, 10.11, 23.22),
                                                       (2, 30.30, 40.40),
                                                       (2, 40.40, 50.50);
</code></pre>

<p>If you didn't need the portfolio ID, it would be easy:</p>

<pre><code>select client_id, name, max(cash + stocks)
from client join portfolio using (client_id)
group by client_id

+-----------+----------+--------------------+
| client_id | name     | max(cash + stocks) |
+-----------+----------+--------------------+
|         1 | John Doe |              33.33 | 
|         2 | Jane Doe |              90.90 | 
+-----------+----------+--------------------+
</code></pre>

<p>Since you need the portfolio ID, things get more complicated.  Let's do it in steps.  First, we'll write a subquery that returns the maximal portfolio value for each client:</p>

<pre><code>select client_id, max(cash + stocks) as maxtotal
from portfolio
group by client_id

+-----------+----------+
| client_id | maxtotal |
+-----------+----------+
|         1 |    33.33 | 
|         2 |    90.90 | 
+-----------+----------+
</code></pre>

<p>Then we'll query the portfolio table, but use a join to the previous subquery in order to keep only those portfolios the total value of which is the maximal for the client:</p>

<pre><code> select portfolio_id, cash + stocks from portfolio 
 join (select client_id, max(cash + stocks) as maxtotal 
       from portfolio
       group by client_id) as maxima
 using (client_id)
 where cash + stocks = maxtotal

+--------------+---------------+
| portfolio_id | cash + stocks |
+--------------+---------------+
|            5 |         33.33 | 
|            6 |         33.33 | 
|            8 |         90.90 | 
+--------------+---------------+
</code></pre>

<p>Finally, we can join to the client table (as you did) in order to include the name of each client:</p>

<pre><code>select client_id, name, portfolio_id, cash + stocks
from client
join portfolio using (client_id)
join (select client_id, max(cash + stocks) as maxtotal
      from portfolio 
      group by client_id) as maxima
using (client_id)
where cash + stocks = maxtotal

+-----------+----------+--------------+---------------+
| client_id | name     | portfolio_id | cash + stocks |
+-----------+----------+--------------+---------------+
|         1 | John Doe |            5 |         33.33 | 
|         1 | John Doe |            6 |         33.33 | 
|         2 | Jane Doe |            8 |         90.90 | 
+-----------+----------+--------------+---------------+
</code></pre>

<p>Note that this returns two rows for John Doe because he has two portfolios with the exact same total value.  To avoid this and pick an arbitrary top portfolio, tag on a GROUP BY clause:</p>

<pre><code>select client_id, name, portfolio_id, cash + stocks
from client
join portfolio using (client_id)
join (select client_id, max(cash + stocks) as maxtotal
      from portfolio 
      group by client_id) as maxima
using (client_id)
where cash + stocks = maxtotal
group by client_id, cash + stocks

+-----------+----------+--------------+---------------+
| client_id | name     | portfolio_id | cash + stocks |
+-----------+----------+--------------+---------------+
|         1 | John Doe |            5 |         33.33 | 
|         2 | Jane Doe |            8 |         90.90 | 
+-----------+----------+--------------+---------------+
</code></pre>
","2183738"
"MySQL search and replace some text in a field","148677","","<p>What MySQL query will do a text search and replace in one particular field in a table?</p>

<p>I.e. search for <code>foo</code> and replace with <code>bar</code> so a record with a field with the value <code>hello foo</code> becomes <code>hello bar</code>.</p>
","<p>Change <code>table_name</code> and <code>field</code> to match your table name and field in question:</p>

<pre><code>UPDATE table_name SET field = REPLACE(field, 'foo', 'bar') WHERE INSTR(field, 'foo') &gt; 0;
</code></pre>

<ul>
<li><a href=""https://dev.mysql.com/doc/refman/5.7/en/string-functions.html#function_replace"" rel=""noreferrer"">REPLACE</a> (string functions)</li>
<li><a href=""https://dev.mysql.com/doc/refman/5.7/en/string-functions.html#function_instr"" rel=""noreferrer"">INSTR</a> (string functions)</li>
</ul>
","125249"
"How to split a single column values to multiple column values?","148213","","<p>I have a problem splitting single column values to multiple column values.</p>

<p>For Example:</p>

<pre><code>Name
------------
abcd efgh
ijk lmn opq
asd j. asdjja
asb (asdfas) asd
asd
</code></pre>

<p>and I need the output something like this:</p>

<pre><code>first_name             last_name
----------------------------------
abcd                     efgh
ijk                      opq
asd                      asdjja
asb                      asd
asd                      null
</code></pre>

<p>The middle name can be omitted (no need for a middle name)  The columns are already created and need to insert the data from that single <code>Name</code> column.</p>
","<p>Your approach won't deal with  lot of names correctly but...</p>

<pre><code>SELECT CASE
         WHEN name LIKE '% %' THEN LEFT(name, Charindex(' ', name) - 1)
         ELSE name
       END,
       CASE
         WHEN name LIKE '% %' THEN RIGHT(name, Charindex(' ', Reverse(name)) - 1)
       END
FROM   YourTable 
</code></pre>
","5123680"
"Saving results with headers in Sql Server Management Studio","148131","","<p>I am using SQL Server Management Studio. </p>

<p>I wish to save the results of a query to an excel file.  </p>

<p>I choose ""save as"" and then save to CSV file which I can open in excel. All good except I am missing column headers, any ideas how I get them exported?</p>
","<p>tools -> options -> query results -> SQl Server -> results to text (or grid if you want) -> Include columns headers in the result set</p>

<p>You might need to close and reopen SSMS after changing this option.</p>

<p><em>*</em>  On the SQL Editor Toolbar you can select save to file without having to restart SSMS</p>
","10677148"
"How to get script of SQL Server data?","147954","","<p>I'm looking for a way to do something analogous to the MySQL dump from SQL Server. I need to be able to pick the tables and export the schema and the data (or I can export the schema via SQL Server Management Studio and export the data separately somehow).</p>

<p>I need this data to be able to turn around and go back into SQL Server so it needs to maintain GUIDs/uniqueidentifiers and other column types.</p>

<p>Does anyone know of a good tool for this?</p>
","<p>Just for completeness, I also found this way to do it: <a href=""http://www.codeplex.com/sqlhost"" rel=""nofollow noreferrer"">Microsoft SqlServer Database Publishing Wizard</a></p>
","2343593"
"How to get First and Last record from a sql query?","147928","","<p>I have a table in <a href=""http://www.postgresql.org/"" rel=""noreferrer"">PostgreSQL</a>, I run a query on it with several conditions that returns multiple rows, ordered by one of the columns. In general it's:</p>

<pre><code>SELECT &lt;some columns&gt; 
FROM mytable
&lt;maybe some joins here&gt;
WHERE &lt;various conditions&gt;
ORDER BY date DESC
</code></pre>

<p>Now I'm only interested in getting the first and the last row from this query. I could get them outside of the db, inside my application (and this is what I actually do) but was wondering if for better performance I shouldn't get from the database only those 2 records I'm actually interested in. </p>

<p>And if so, how do I modify my query?</p>
","<p>[Caveat: Might not be the most efficient way to do it]:</p>

<pre><code>(SELECT &lt;some columns&gt;
FROM mytable
&lt;maybe some joins here&gt;
WHERE &lt;various conditions&gt;
ORDER BY date DESC
LIMIT 1)

UNION ALL

(SELECT &lt;some columns&gt;
FROM mytable
&lt;maybe some joins here&gt;
WHERE &lt;various conditions&gt;
ORDER BY date ASC    
LIMIT 1)
</code></pre>
","1485403"
"Mysql 1050 Error ""Table already exists"" when in fact, it does not","147924","","<p>I'm adding this table:</p>

<pre><code>CREATE TABLE contenttype (
        contenttypeid INT UNSIGNED NOT NULL AUTO_INCREMENT,
        class VARBINARY(50) NOT NULL,
        packageid INT UNSIGNED NOT NULL,
        canplace ENUM('0','1') NOT NULL DEFAULT '0',
        cansearch ENUM('0','1') NOT NULL DEFAULT '0',
        cantag ENUM('0','1') DEFAULT '0',
        canattach ENUM('0','1') DEFAULT '0',
        isaggregator ENUM('0', '1') NOT NULL DEFAULT '0',
        PRIMARY KEY (contenttypeid),
        UNIQUE KEY packageclass (packageid, class)
);
</code></pre>

<p>And I get a 1050 ""table already exists""</p>

<p>But the table does NOT exist. Any ideas?</p>

<p>EDIT: more details because everyone seems to not believe me :)</p>

<pre><code>DESCRIBE contenttype
</code></pre>

<p>yields:</p>

<blockquote>
  <p>1146 - Table 'gunzfact_vbforumdb.contenttype' doesn't exist</p>
</blockquote>

<p>and</p>

<pre><code>CREATE TABLE gunzfact_vbforumdb.contenttype(
contenttypeid INT UNSIGNED NOT NULL AUTO_INCREMENT ,
class VARBINARY( 50 ) NOT NULL ,
packageid INT UNSIGNED NOT NULL ,
canplace ENUM( '0', '1' ) NOT NULL DEFAULT '0',
cansearch ENUM( '0', '1' ) NOT NULL DEFAULT '0',
cantag ENUM( '0', '1' ) DEFAULT '0',
canattach ENUM( '0', '1' ) DEFAULT '0',
isaggregator ENUM( '0', '1' ) NOT NULL DEFAULT '0',
PRIMARY KEY ( contenttypeid ) ,
</code></pre>

<p>Yields:</p>

<blockquote>
  <p>1050 - Table 'contenttype' already exists</p>
</blockquote>
","<p>Sounds like you have <a href=""http://en.wikipedia.org/wiki/Schr%C3%B6dinger&#39;s_cat"" rel=""noreferrer"">Schroedinger's table</a>... </p>

<p>Seriously now, you probably have a broken table. Try:</p>

<ul>
<li><code>DROP TABLE IF EXISTS contenttype</code></li>
<li><code>REPAIR TABLE contenttype</code></li>
<li>If you have sufficient permissions, delete the data files (in /mysql/data/db_name)</li>
</ul>
","3302837"
"How to compare dates in datetime fields in Postgresql?","147735","","<p>I have been facing a strange scenario when comparing between dates in postgresql(version 9.2.4 in windows). I have a column in my table say update_date with type 'timestamp without timezone'. Client can search over this field with only date (i.e: 2013-05-03) or date with time (i.e: 2013-05-03 12:20:00). This column has the value as timestamp for all rows currently and have the same date part(2013-05-03) but difference in time part.</p>

<p>When I'm comparing over this column, I'm getting different results. Like the followings:</p>

<pre><code>select * from table where update_date &gt;= '2013-05-03' AND update_date &lt;= '2013-05-03' -&gt; No results

select * from table where update_date &gt;= '2013-05-03' AND update_date &lt; '2013-05-03' -&gt; No results

select * from table where update_date &gt;= '2013-05-03' AND update_date &lt;= '2013-05-04' -&gt; results found

select * from table where update_date &gt;= '2013-05-03' -&gt; results found
</code></pre>

<p>My question is how can I make the first query possible to get results, I mean why the 3rd query is working but not the first one?</p>

<p>Can anybody help me with this? Thanks in advance.</p>
","<p>@Nicolai is correct about casting and why the condition is false for any data.  i guess you prefer the first form because you want to avoid date manipulation on the input string, correct?  you don't need to be afraid:</p>

<pre><code>SELECT *
FROM table
WHERE update_date &gt;= '2013-05-03'::date
AND update_date &lt; ('2013-05-03'::date + '1 day'::interval);
</code></pre>
","19469689"
"How to create a MySQL hierarchical recursive query","147518","","<p>I have a MySQL table which is as follows:</p>

<pre><code>id | name        | parent_id
19 | category1   | 0
20 | category2   | 19
21 | category3   | 20
22 | category4   | 21
......
</code></pre>

<p>Now, I want to have a single MySQL query to which I simply supply the id [for instance say 'id = 19'] then I should get all its child ids [i.e. result should have ids '20,21,22']....
Also, the hierarchy of the children is not known it can vary....</p>

<p>Also, I already have the solution using the for loop..... Let me know how to achieve the same using a single MySQL query if possible.</p>
","<p>For MySql versions that do not support Common Table Expressions (up to version 5.7), you would achieve this with the following query:</p>

<pre><code>select  id,
        name,
        parent_id 
from    (select * from products
         order by parent_id, id) products_sorted,
        (select @pv := '19') initialisation
where   find_in_set(parent_id, @pv) &gt; 0
and     @pv := concat(@pv, ',', id)
</code></pre>

<p>Here is a <a href=""http://sqlfiddle.com/#!9/5de2a/1"" rel=""noreferrer"">fiddle</a>.</p>

<p>The value specified in <code>@pv := '19'</code> should be set to the <code>id</code> of the parent you want to select all the descendants of.</p>

<p>This will work also if a parent has <em>multiple</em> children. However, it is required that each record fulfills the condition <code>parent_id &lt; id</code>, otherwise the results will not be complete.</p>

<p>This query uses specific MySql syntax: variables are assigned and modified during its execution. Some assumptions are made about the order of execution:</p>

<ul>
<li>The <code>from</code> clause is evaluated first. So that is where <code>@pv</code> gets initialised.</li>
<li>The <code>where</code> clause is evaluated for each record in the order of retrieval from the <code>from</code> aliases. So this is where a condition is put to only include records for which the parent was already identified as being in the descendant tree (all descendants of the primary parent are progressively added to <code>@pv</code>).</li>
<li>The conditions in this <code>where</code> clause are evaluated in order, and the evaluation is interrupted once the total outcome is certain. Therefore the second condition must be in second place, as it adds the <code>id</code> to the parent list, and this should only happen if the <code>id</code> passes the first condition.</li>
</ul>

<p>All in all, one may find these assumptions too risky to rely on -- there is no documented guarantee for them, and even though it works consistently, the evaluation order may in theory still change when you use this query as a view or sub-query in a larger query.</p>

<p>Also note that for very large data sets this solution might get slow, as the <code>find_in_set</code> operation is not the most ideal way to find a number in a list, certainly not in a list that reaches a size in the same order of magnitude as the number of records returned.</p>

<p><strong>Alternative 1: <code>WITH RECURSIVE</code>, <code>CONNECT BY</code></strong></p>

<p>More and more databases implement the <a href=""https://en.wikipedia.org/wiki/SQL:1999#Common_table_expressions_and_recursive_queries"" rel=""noreferrer"">SQL:1999 ISO standard <code>WITH [RECURSIVE]</code> syntax</a> for recursive queries (e.g. <a href=""http://www.postgresql.org/docs/8.4/static/queries-with.html"" rel=""noreferrer"">Postgres 8.4+</a>, <a href=""https://technet.microsoft.com/en-us/library/ms186243%28v=sql.105%29.aspx"" rel=""noreferrer"">SQL Server 2005+</a>, <a href=""https://www.ibm.com/developerworks/ibmi/library/i-db2connectby/"" rel=""noreferrer"">DB2</a>, <a href=""https://docs.oracle.com/cloud/latest/db112/SQLRF/statements_10002.htm#sthref6733"" rel=""noreferrer"">Oracle 11gR2+</a>, <a href=""https://www.sqlite.org/lang_with.html"" rel=""noreferrer"">SQLite 3.8.4+</a>, <a href=""https://firebirdsql.org/refdocs/langrefupd21-select.html#langrefupd21-select-cte"" rel=""noreferrer"">Firebird 2.1+</a>, <a href=""http://www.h2database.com/html/advanced.html#recursive_queries"" rel=""noreferrer"">H2</a>, <a href=""http://www.hsqldb.org/doc/guide/dataaccess-chapt.html#dac_with_clause"" rel=""noreferrer"">HyperSQL 2.1.0+</a>, <a href=""http://www.info.teradata.com/htmlpubs/DB_TTU_14_00/index.html#page/SQL_Reference/B035_1146_111A/ch01.032.066.html"" rel=""noreferrer"">Teradata</a>, <a href=""https://mariadb.com/kb/en/mariadb/with/"" rel=""noreferrer"">MariaDB 10.2.2+</a>). And as of <a href=""https://dev.mysql.com/doc/refman/8.0/en/with.html"" rel=""noreferrer"">version 8.0, also MySql supports it</a>. With that syntax the query looks like this:</p>

<pre><code>with recursive cte (id, name, parent_id) as
(
 select     id,
            name,
            parent_id
 from       products
 where      parent_id = 19
 union all
 select     p.id,
            p.name,
            p.parent_id
 from       products p
 inner join cte
         on p.parent_id = cte.id
)
select * from cte;
</code></pre>

<p>Some databases have an alternative, non-standard syntax for hierarchical look-ups, such as the <a href=""https://docs.oracle.com/cd/B19306_01/server.102/b14200/queries003.htm"" rel=""noreferrer""><code>CONNECT BY</code></a> clause available on Oracle databases. <a href=""https://www.ibm.com/developerworks/ibmi/library/i-db2connectby/"" rel=""noreferrer"">DB2</a> also supports this alternative syntax.</p>

<p>MySql version 5.7 does not offer such a feature. When your database engine provides this syntax, then that is certainly the best option to go for. If not, then also consider the following alternatives.</p>

<p><strong>Alternative 2: Path-style Identifiers</strong></p>

<p>Things become a lot easier if you would assign <code>id</code> values that contain the hierarchical information: a path. For example, in your case this could look like this:</p>

<pre><code>ID       | NAME
19       | category1   
19/1     | category2  
19/1/1   | category3  
19/1/1/1 | category4  
</code></pre>

<p>Then your <code>select</code> would look like this:</p>

<pre><code>select  id,
        name 
from    products
where   id like '19/%'
</code></pre>

<p><strong>Alternative 3: Repeated Self-joins</strong></p>

<p>If you know an upper limit for how deep your hierarchy tree can become, you can use a standard <code>sql</code> like this:</p>

<pre><code>select      p6.parent_id as parent6_id,
            p5.parent_id as parent5_id,
            p4.parent_id as parent4_id,
            p3.parent_id as parent3_id,
            p2.parent_id as parent2_id,
            p1.parent_id as parent_id,
            p1.id as product_id,
            p1.name
from        products p1
left join   products p2 on p2.id = p1.parent_id 
left join   products p3 on p3.id = p2.parent_id 
left join   products p4 on p4.id = p3.parent_id  
left join   products p5 on p5.id = p4.parent_id  
left join   products p6 on p6.id = p5.parent_id
where       19 in (p1.parent_id, 
                   p2.parent_id, 
                   p3.parent_id, 
                   p4.parent_id, 
                   p5.parent_id, 
                   p6.parent_id) 
order       by 1, 2, 3, 4, 5, 6, 7;
</code></pre>

<p>See this <a href=""http://sqlfiddle.com/#!9/5de2a/46"" rel=""noreferrer"">fiddle</a></p>

<p>The <code>where</code> condition specifies which parent you want to retrieve the descendants of. You can extend this query with more levels as needed.</p>
","33737203"
"Drop all tables whose names begin with a certain string","147473","","<p>I'd like a script to drop all tables whose name begins with a given string. I'm sure this can be done with some dynamic sql and the <code>INFORMATION_SCHEMA</code> tables.</p>

<p>If anyone has a script, or can knock one up quickly, please post it.</p>

<p>If no-one posts an answer before I figure it out myself, I'll post my solution.</p>
","

<p>You may need to modify the query to include the owner if there's more than one in the database.</p>

<pre class=""lang-sql prettyprint-override""><code>DECLARE @cmd varchar(4000)
DECLARE cmds CURSOR FOR
SELECT 'drop table [' + Table_Name + ']'
FROM INFORMATION_SCHEMA.TABLES
WHERE Table_Name LIKE 'prefix%'

OPEN cmds
WHILE 1 = 1
BEGIN
    FETCH cmds INTO @cmd
    IF @@fetch_status != 0 BREAK
    EXEC(@cmd)
END
CLOSE cmds;
DEALLOCATE cmds
</code></pre>

<p>This is cleaner than using a two-step approach of generate script plus run.  But one advantage of the script generation is that it gives you the chance to review the entirety of what's going to be run before it's actually run.</p>

<p>I know that if I were going to do this against a production database, I'd be as careful as possible.</p>

<p><strong>Edit</strong> Code sample fixed.</p>
","4401"
"Oracle SQL query for Date format","147360","","<p>I always get confused with date format in ORACLE SQL query and spend minutes together to google, Can someone explain me the simplest way to tackle when we have different format of date in database table ?</p>

<p>for instance i have a date column as ES_DATE, holds data as 27-APR-12 11.52.48.294030000 AM of Data type TIMESTAMP(6) WITH LOCAL TIME ZONE. </p>

<p><img src=""https://i.stack.imgur.com/lND9V.jpg"" alt=""enter image description here""></p>

<p>I wrote simple select query to fetch data for that particular day and it returns me nothing. Can someone explain me ?</p>

<pre><code>select * from table
where es_date=TO_DATE('27-APR-12','dd-MON-yy')
</code></pre>

<p>or </p>

<pre><code>select * from table where es_date = '27-APR-12';
</code></pre>
","<p><code>to_date()</code> returns a date at 00:00:00, so you need to ""remove"" the minutes from the date you are comparing to:</p>

<pre><code>select * 
from table
where trunc(es_date) = TO_DATE('27-APR-12','dd-MON-yy')
</code></pre>

<p>You probably want to create an index on <code>trunc(es_date)</code> if that is something you are doing on a regular basis. </p>

<p>The literal <code>'27-APR-12'</code> can fail very easily if the default date format is changed to anything different. So make sure you you always use <code>to_date()</code> with a proper format mask (or an ANSI literal: <code>date '2012-04-27'</code>) </p>

<p>Although you did right in using <code>to_date()</code> and not relying on implict data type conversion, your usage of to_date() still has a subtle pitfall because of the format <code>'dd-MON-yy'</code>. </p>

<p>With a different language setting this might easily fail e.g. <code>TO_DATE('27-MAY-12','dd-MON-yy')</code> when NLS_LANG is set to german. Avoid anything in the format that might be different in a different language. Using a four digit year and only numbers e.g. <code>'dd-mm-yyyy'</code> or <code>'yyyy-mm-dd'</code></p>
","17478514"
"SELECT FOR UPDATE with SQL Server","147346","","<p>I'm using a Microsoft SQL Server 2005 database with isolation level <code>READ_COMMITTED</code> and <code>READ_COMMITTED_SNAPSHOT=ON</code>.</p>

<p>Now I want to use:</p>

<pre><code>SELECT * FROM &lt;tablename&gt; FOR UPDATE
</code></pre>

<p>...so that other database connections block when trying to access the same row ""FOR UPDATE"".</p>

<p>I tried: </p>

<pre><code>SELECT * FROM &lt;tablename&gt; WITH (updlock) WHERE id=1
</code></pre>

<p>...but this blocks all other connections even for selecting an id other than ""1"".</p>

<p>Which is the correct hint to do a <code>SELECT FOR UPDATE</code> as known for Oracle, DB2, MySql?</p>

<p><strong>EDIT 2009-10-03:</strong></p>

<p>These are the statements to create the table and the index:</p>

<pre><code>CREATE TABLE example ( Id BIGINT NOT NULL, TransactionId BIGINT, 
    Terminal BIGINT, Status SMALLINT );
ALTER TABLE example ADD CONSTRAINT index108 PRIMARY KEY ( Id )
CREATE INDEX I108_FkTerminal ON example ( Terminal )
CREATE INDEX I108_Key ON example ( TransactionId )
</code></pre>

<p>A lot of parallel processes do this <code>SELECT</code>:</p>

<pre><code>SELECT * FROM example o WITH (updlock) WHERE o.TransactionId = ?
</code></pre>

<p><strong>EDIT 2009-10-05:</strong></p>

<p>For a better overview I've written down all tried solutions in the following table:</p>

<pre>
mechanism              | SELECT on different row blocks | SELECT on same row blocks
-----------------------+--------------------------------+--------------------------
ROWLOCK                | no                             | no
updlock, rowlock       | yes                            | yes
xlock,rowlock          | yes                            | yes
repeatableread         | no                             | no
DBCC TRACEON (1211,-1) | yes                            | yes
rowlock,xlock,holdlock | yes                            | yes
updlock,holdlock       | yes                            | yes
UPDLOCK,READPAST       | no                             | no

I'm looking for        | no                             | yes
</pre>
","<p>Recently I had a <a href=""https://stackoverflow.com/questions/1437200/sqlserver-2005-deadlock-problem-with-no-shared-records"">deadlock problem</a> because Sql Server locks more then necessary (page). You can't really do anything against it. Now we are catching deadlock exceptions... and I wish I had Oracle instead.</p>

<p>Edit:
We are using snapshot isolation meanwhile, which solves many, but not all of the problems. Unfortunately, to be able to use snapshot isolation it must be allowed by the database server, which may cause unnecessary problems at customers site. Now we are not only catching deadlock exceptions (which still can occur, of course) but also snapshot concurrency problems to repeat transactions from background processes (which cannot be repeated by the user). But this still performs much better than before.</p>
","1496800"
"How to find top three highest salary in emp table in oracle?","147234","","<p>How to find top three highest salary in <code>emp</code> table in oracle?</p>
","<pre><code>SELECT  *FROM 
    (
    SELECT *FROM emp 
    ORDER BY Salary desc
    )
WHERE rownum &lt;= 3
ORDER BY Salary ;
</code></pre>
","2943521"
"Call a stored procedure with another in Oracle","147212","","<p>Does anyone know of a way, or even if its possible, to call a stored procedure from within another? If so, how would you do it?</p>

<p>Here is my test code:</p>

<pre><code>SET SERVEROUTPUT ON;

DROP PROCEDURE test_sp_1;
DROP PROCEDURE test_sp;

CREATE PROCEDURE test_sp
AS
BEGIN
    DBMS_OUTPUT.PUT_LINE('Test works');
END;
/

CREATE PROCEDURE test_sp_1
AS
BEGIN
    DBMS_OUTPUT.PUT_LINE('Testing');
    test_sp;
END;
/

CALL test_sp_1;
</code></pre>
","<p>Your stored procedures work as coded. The problem is with the last line, it is unable to invoke either of your stored procedures.</p>

<p>Three choices in SQL*Plus are: <code>call</code>, <code>exec</code>, and an anoymous PL/SQL block.</p>

<p><code>call</code> appears to be a SQL keyword, and is documented in the SQL Reference. <a href=""http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/statements_4008.htm#BABDEHHG"" rel=""noreferrer"">http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/statements_4008.htm#BABDEHHG</a> The syntax diagram indicates that parentesis are required, even when no arguments are passed to the call routine.</p>

<pre><code>CALL test_sp_1();
</code></pre>

<p>An anonymous PL/SQL block is PL/SQL that is not inside a named procedure, function, trigger, etc. It can be used to call your procedure.</p>

<pre><code>BEGIN
    test_sp_1;
END;
/
</code></pre>

<p><code>Exec</code> is a SQL*Plus command that is a shortcut for the above anonymous block. <code>EXEC &lt;procedure_name&gt;</code> will be passed to the DB server as <code>BEGIN &lt;procedure_name&gt;; END;</code></p>

<p>Full example:</p>

<pre><code>SQL&gt; SET SERVEROUTPUT ON
SQL&gt; CREATE OR REPLACE PROCEDURE test_sp 
  2  AS 
  3  BEGIN 
  4      DBMS_OUTPUT.PUT_LINE('Test works'); 
  5  END;
  6  /

Procedure created.

SQL&gt; CREATE OR REPLACE PROCEDURE test_sp_1 
  2  AS
  3  BEGIN
  4      DBMS_OUTPUT.PUT_LINE('Testing'); 
  5      test_sp; 
  6  END;
  7  /

Procedure created.

SQL&gt; CALL test_sp_1();
Testing
Test works

Call completed.

SQL&gt; exec test_sp_1
Testing
Test works

PL/SQL procedure successfully completed.

SQL&gt; begin
  2      test_sp_1;
  3  end;
  4  /
Testing
Test works

PL/SQL procedure successfully completed.

SQL&gt; 
</code></pre>
","3419018"
"What does it mean by select 1 from table?","146990","","<p>I have seen many queries with something like this..</p>

<pre><code>Select 1  
From table
</code></pre>

<p>What does this 1 mean and how will it be executed and what will it return?
Please also guide me in what type of cases this can be used???</p>

<p>Thanks in advance </p>
","<p><code>SELECT 1 FROM TABLE_NAME</code> means, ""Return 1 from the table"". It is pretty unremarkable on its own, so normally it will be used with <code>WHERE</code> and often <code>EXISTS</code> (as @gbn notes, this is not necessarily best practice, it is, however, common enough to be noted, even if it isn't really meaningful (that said, I will use it because others use it and it is ""more obvious"" immediately. Of course, that might be a viscous chicken vs. egg issue, but I don't generally dwell)).</p>

<pre><code> SELECT * FROM TABLE1 T1 WHERE EXISTS (
     SELECT 1 FROM TABLE2 T2 WHERE T1.ID= T2.ID
 );
</code></pre>

<p>Basically, the above will return everything from table 1 which has a corresponding ID from table 2. (This is a contrived example, obviously, but I believe it conveys the idea. Personally, I would probably do the above as <code>SELECT * FROM TABLE1 T1 WHERE ID IN (SELECT ID FROM TABLE2);</code> as I view that as <em>FAR</em> more explicit to the reader unless there were a circumstantially compelling reason not to).</p>

<h2>EDIT</h2>

<p>There actually is one case which I forgot about until just now. In the case where you are trying to determine existence of a value in the database from an outside language, sometimes <code>SELECT 1 FROM TABLE_NAME</code> will be used. This does not offer significant benefit over selecting an individual column, but, depending on implementation, it may offer substantial gains over doing a <code>SELECT *</code>, simply because it is often the case that the more columns that the DB returns to a language, the larger the data structure, which in turn mean that more time will be taken.</p>
","7171068"
"How can I merge two MySQL tables?","146944","","<p>How can I merge two MySQL tables that have the same structure?</p>

<p>The primary keys of the two tables will clash, so I have take that into account.</p>
","<p>You can also try:</p>

<pre><code>INSERT IGNORE
  INTO table_1 
SELECT *
  FROM table_2
     ;
</code></pre>

<p>which allows those rows in table_1 to supersede those in table_2 that have a matching primary key, while still inserting rows with new primary keys.</p>

<p>Alternatively, </p>

<pre><code>REPLACE
   INTO table_1
 SELECT *
   FROM table_2
      ;
</code></pre>

<p>will update those rows already in table_1 with the corresponding row from table_2, while inserting rows with new primary keys.</p>
","725595"
"Is a view faster than a simple query?","146819","","<p>Is a </p>

<pre><code>select *  from myView
</code></pre>

<p>faster than the query itself to create the view (in order to have the same resultSet):</p>

<pre><code>select * from ([query to create same resultSet as myView])
</code></pre>

<p>?</p>

<p>It's not totally clear to me if the view uses some sort of caching making it faster compared to a simple query. </p>
","<p><strong>Yes</strong>, views can have a clustered index assigned and, when they do, they'll store temporary results that can speed up resulting queries.   </p>

<p>Update: At least three people have voted me down on this one. With all due respect, I think that they are just wrong; Microsoft's own documentation makes it very clear that Views can improve performance.</p>

<p>First, simple views are expanded in place and so do not directly contribute to performance improvements - that much is true.  <strong>However,</strong> indexed views can <em>dramatically</em> improve performance.  </p>

<p>Let me go directly to the documentation: </p>

<blockquote>
  <p>After a unique clustered index is created on the view, the view's result set is materialized immediately and persisted in physical storage in the database, saving the overhead of performing this costly operation at execution time.</p>
</blockquote>

<p>Second, these indexed views can work <em>even when they are not directly referenced by another query</em> as the optimizer will use them in place of a table reference when appropriate.  </p>

<p>Again, the documentation: </p>

<blockquote>
  <p>The indexed view can be used in a query execution in two ways. The query can reference the indexed view directly, or, more importantly, the query optimizer can select the view if it determines that the view can be substituted for some or all of the query in the lowest-cost query plan. In the second case, the indexed view is used instead of the underlying tables and their ordinary indexes. The view does not need to be referenced in the query for the query optimizer to use it during query execution. This allows existing applications to benefit from the newly created indexed views without changing those applications.</p>
</blockquote>

<p>This documentation, as well as charts demonstrating performance improvements, can be found <a href=""http://www.microsoft.com/technet/prodtechnol/sql/2005/impprfiv.mspx"" rel=""noreferrer"">here</a>.</p>

<p><strong>Update 2:</strong> the answer has been criticized on the basis that it is the ""index"" that provides the performance advantage, not the ""View.""  However, this is easily refuted.  </p>

<p>Let us say that we are a software company in a small country; I'll use Lithuania as an example.  We sell software worldwide and keep our records in a SQL Server database.  We're very successful and so, in a few years, we have 1,000,000+ records.  However, we often need to report sales for tax purposes and we find that we've only sold 100 copies of our software in our home country. By creating an indexed view of just the Lithuanian records, we get to keep the records we need in an indexed cache as described in the MS documentation.  When we run our reports for Lithuanian sales in 2008, our query will search through an index with a depth of just 7 (Log2(100) with some unused leaves).  If we were to do the same without the VIEW and just relying on an index into the table, we'd have to traverse an index tree with a search depth of 21!  </p>

<p>Clearly, the View itself would provide us with a performance advantage (3x) over the simple use of the index alone.  I've tried to use a real-world example but you'll note that a simple list of Lithuanian sales would give us an even greater advantage.</p>

<p>Note that I'm just using a straight b-tree for my example. While I'm fairly certain that SQL Server uses some variant of a b-tree, I don't know the details.  Nonetheless, the point holds.</p>

<p><strong>Update 3:</strong> The question has come up about whether an Indexed View just uses an index placed on the underlying table.  That is, to paraphrase: ""an indexed view is just the equivalent of a standard index and it offers nothing new or unique to a view.""  If this was true, of course, then the above analysis would be incorrect!  Let me provide a quote from the Microsoft documentation that demonstrate why I think this criticism is not valid or true:</p>

<blockquote>
  <p>Using indexes to improve query performance is not a new concept; however, indexed views provide additional performance benefits that cannot be achieved using standard indexes.</p>
</blockquote>

<p>Together with the above quote regarding the persistence of data in physical storage and other information in the documentation about how indices are created on Views, I think it is safe to say that an Indexed View is <strong>not</strong> just a cached SQL Select that happens to use an index defined on the main table.  Thus, I continue to stand by this answer.</p>
","439061"
"ORA-00972 identifier is too long alias column name","146724","","<p>i have a query like :</p>

<p><code>SELECT column as averyveryveryverylongalias (more than 30 characters)
   FROM Table_name</code></p>

<p>it returns the error <strong>ORA-00972 identifier is too long</strong> , is there any tip to make it work without making the alias shorter?</p>

<p>Thanks</p>
","<p>No, prior to Oracle version 12.2, identifiers are not allowed to exceed 30 characters in length. See <a href=""http://download.oracle.com/docs/cd/B28359_01/server.111/b28286/sql_elements008.htm#sthref727"" rel=""noreferrer"">the Oracle SQL Language Reference</a>.</p>

<p>However, <a href=""https://docs.oracle.com/en/cloud/paas/exadata-express-cloud/csdbf/longer-identifier-names.html"" rel=""noreferrer"">from version 12.2 they can be up to 128 bytes long.</a> (Note: bytes, not characters).</p>
","3085571"
"SQL Query - SUM(CASE WHEN x THEN 1 ELSE 0) for multiple columns","146693","","<p>I'm looking to see if there is a better approach to the query below.  What I'm trying to do is create a summary report, compiling stats by date.</p>

<pre><code> SELECT CAST(Detail.ReceiptDate AS DATE) AS 'DATE'
, SUM(CASE WHEN Detail.Type = 'TotalMailed' THEN 1 ELSE 0 END) AS 'TOTALMAILED'
, SUM(CASE WHEN Detail.Type = 'TotalReturnMail' THEN 1 ELSE 0 END) AS 'TOTALUNDELINOTICESRECEIVED'
, SUM(CASE WHEN Detail.Type = 'TraceReturnedMail' THEN 1 ELSE 0 END) AS 'TRACEUNDELNOTICESRECEIVED'
FROM
(
select SentDate AS 'ReceiptDate', 'TotalMailed' AS 'Type'
from MailDataExtract
where sentdate is not null
UNION ALL
select MDE.ReturnMailDate AS 'ReceiptDate', 'TotalReturnMail' AS 'Type'
from MailDataExtract MDE
where MDE.ReturnMailDate is not null
UNION ALL
select MDE.ReturnMailDate AS 'ReceiptDate', 'TraceReturnedMail' AS 'Type'
from MailDataExtract MDE
    inner join DTSharedData.dbo.ScanData SD ON SD.ScanDataID = MDE.ReturnScanDataID
where MDE.ReturnMailDate is not null AND SD.ReturnMailTypeID = 1
) AS Detail
GROUP BY CAST(Detail.ReceiptDate AS DATE)
ORDER BY 1   
</code></pre>

<p>This is only a sample of the query (which is used in a report) as there are a number of other columns and the logic for the other stats are way more complicated.  Is there a more elegant approach to getting this kind of information/writing this kind of report?</p>
","<p>I would change the query in the following ways:</p>

<ol>
<li>Do the aggregation in subqueries.  This can take advantage of more information about the table for optimizing the <code>group by</code>.</li>
<li>Combine the second and third subqueries.  They are aggregating on the same column.  This requires using a <code>left outer join</code> to ensure that all data is available.</li>
<li>By using <code>count(&lt;fieldname&gt;)</code> you can eliminate the comparisons to <code>is null</code>.  This is important for the second and third calculated values.</li>
<li>To combine the second and third queries, it needs to count an id from the <code>mde</code> table.  These use <code>mde.mdeid</code>.</li>
</ol>

<p>The following version follows your example by using <code>union all</code>:</p>

<pre><code>SELECT CAST(Detail.ReceiptDate AS DATE) AS ""Date"",
       SUM(TOTALMAILED) as TotalMailed,
       SUM(TOTALUNDELINOTICESRECEIVED) as TOTALUNDELINOTICESRECEIVED,
       SUM(TRACEUNDELNOTICESRECEIVED) as TRACEUNDELNOTICESRECEIVED
FROM ((select SentDate AS ""ReceiptDate"", COUNT(*) as TotalMailed,
              NULL as TOTALUNDELINOTICESRECEIVED, NULL as TRACEUNDELNOTICESRECEIVED
       from MailDataExtract
       where SentDate is not null
       group by SentDate
      ) union all
      (select MDE.ReturnMailDate AS ReceiptDate, 0,
              COUNT(distinct mde.mdeid) as TOTALUNDELINOTICESRECEIVED,
              SUM(case when sd.ReturnMailTypeId = 1 then 1 else 0 end) as TRACEUNDELNOTICESRECEIVED
       from MailDataExtract MDE left outer join
            DTSharedData.dbo.ScanData SD
            ON SD.ScanDataID = MDE.ReturnScanDataID
       group by MDE.ReturnMailDate;
      )
     ) detail
GROUP BY CAST(Detail.ReceiptDate AS DATE)
ORDER BY 1;
</code></pre>

<p>The following does something similar using <code>full outer join</code>:</p>

<pre><code>SELECT coalesce(sd.ReceiptDate, mde.ReceiptDate) AS ""Date"",
       sd.TotalMailed, mde.TOTALUNDELINOTICESRECEIVED,
       mde.TRACEUNDELNOTICESRECEIVED
FROM (select cast(SentDate as date) AS ""ReceiptDate"", COUNT(*) as TotalMailed
      from MailDataExtract
      where SentDate is not null
      group by cast(SentDate as date)
     ) sd full outer join
    (select cast(MDE.ReturnMailDate as date) AS ReceiptDate,
            COUNT(distinct mde.mdeID) as TOTALUNDELINOTICESRECEIVED,
            SUM(case when sd.ReturnMailTypeId = 1 then 1 else 0 end) as TRACEUNDELNOTICESRECEIVED
     from MailDataExtract MDE left outer join
          DTSharedData.dbo.ScanData SD
          ON SD.ScanDataID = MDE.ReturnScanDataID
     group by cast(MDE.ReturnMailDate as date)
    ) mde
    on sd.ReceiptDate = mde.ReceiptDate
ORDER BY 1;
</code></pre>
","17812029"
"querying WHERE condition to character length?","146406","","<p>I have a database with a large number of words but i want to select only those records where the character length is equal to a given number (in example case 3):</p>

<pre><code>$query = (""SELECT * FROM $db WHERE conditions AND length = 3"");
</code></pre>

<p>But this does not work... can someone show me the correct query?</p>
","<p>Sorry, I wasn't sure which SQL platform you're talking about:</p>

<p>In MySQL:</p>

<pre><code>$query = (""SELECT * FROM $db WHERE conditions AND LENGTH(col_name) = 3"");
</code></pre>

<p>in MSSQL</p>

<pre><code>$query = (""SELECT * FROM $db WHERE conditions AND LEN(col_name) = 3"");
</code></pre>

<p>The LENGTH() (MySQL) or LEN() (MSSQL) function will return the length of a string in a column that you can use as a condition in your WHERE clause.</p>

<p><strong>Edit</strong></p>

<p>I know this is really old but thought I'd expand my answer because, as Paulo Bueno rightly pointed out, you're most likely wanting the number of characters as opposed to the number of bytes. Thanks Paulo.</p>

<p>So, for MySQL there's the <code>CHAR_LENGTH()</code>. The following example highlights the difference between <code>LENGTH()</code> an <code>CHAR_LENGTH()</code>:</p>

<pre><code>CREATE TABLE words (
    word VARCHAR(100)
) ENGINE INNODB DEFAULT CHARSET utf8mb4 COLLATE utf8mb4_unicode_ci;

INSERT INTO words(word) VALUES('快樂'), ('happy'), ('hayır');

SELECT word, LENGTH(word) as num_bytes, CHAR_LENGTH(word) AS num_characters FROM words;

+--------+-----------+----------------+
| word   | num_bytes | num_characters |
+--------+-----------+----------------+
| 快樂    |         6 |              2 |
| happy  |         5 |              5 |
| hayır  |         6 |              5 |
+--------+-----------+----------------+
</code></pre>

<p>Be careful if you're dealing with multi-byte characters.</p>
","6807249"
"How to delete from multiple tables in MySQL?","146297","","<p>I am trying to delete from a few tables at once. I've done a bit of research, and came up with this</p>

<pre><code>DELETE FROM `pets` p,
            `pets_activities` pa
      WHERE p.`order` &gt; :order
        AND p.`pet_id` = :pet_id
        AND pa.`id` = p.`pet_id`
</code></pre>

<p>However, I am getting this error</p>

<blockquote>
  <p>Uncaught Database_Exception [ 1064 ]: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'p, <code>pets_activities</code> pa...</p>
</blockquote>

<p>I've never done a cross table delete before, so I'm inexperienced and stuck for now!</p>

<p>What am I doing wrong?</p>
","<p><strong>Use a <code>JOIN</code> in the <code>DELETE</code> statement.</strong></p>

<pre><code>DELETE p, pa
      FROM pets p
      JOIN pets_activities pa ON pa.id = p.pet_id
     WHERE p.order &gt; :order
       AND p.pet_id = :pet_id
</code></pre>

<p>Alternatively you can use...</p>

<pre><code>DELETE pa
      FROM pets_activities pa
      JOIN pets p ON pa.id = p.pet_id
 WHERE p.order &gt; :order
   AND p.pet_id = :pet_id
</code></pre>

<p>...to delete only from pets_activities</p>

<p>See <a href=""http://dev.mysql.com/doc/refman/5.0/en/delete.html"" rel=""noreferrer"">http://dev.mysql.com/doc/refman/5.0/en/delete.html</a></p>

<p>For single table deletes, yet with referential integrity, there are other ways of doing with EXISTS, NOT EXISTS, IN, NOT IN, etc.  But the one above where you specify from which tables to delete with an alias before the FROM clause can get you out of a few pretty tight spots more easily.  I tend to reach out to an EXISTS in 99% of the cases and then there is the 1% where this MySQL syntax takes the day.</p>
","11442104"
"SQL WHERE ID IN (id1, id2, ..., idn)","146212","","<p>I need to write a query to retrieve a big list of ids.</p>

<p>We do support many backends (MySQL, Firebird, SQLServer, Oracle, PostgreSQL ...) so I need to write a standard SQL.</p>

<p>The size of the id set could be big, the query would be generated programmatically. So, what is the best approach?</p>

<h3>1) Writing a query using IN</h3>

<pre><code>SELECT * FROM TABLE WHERE ID IN (id1, id2, ..., idn)
</code></pre>

<p>My question here is. What happens if n is very big? Also, what about performance?</p>

<h3>2) Writing a query using OR</h3>

<pre><code>SELECT * FROM TABLE WHERE ID = id1 OR ID = id2 OR ... OR ID = idn
</code></pre>

<p>I think that this approach does not have n limit, but what about performance if n is very big?</p>

<h3>3) Writing a programmatic solution:</h3>

<pre><code>  foreach (id in myIdList)
  {
      item = GetItemByQuery(""SELECT * FROM TABLE WHERE ID = "" + id);
      myObjectList.Add(item);
  }
</code></pre>

<p>We experienced some problems with this approach when the database server is queried over the network. Normally is better to do one query that retrieve all results, better that lot of small queries. Maybe I'm wrong.</p>

<p>What would be a correct solution for this problem?</p>
","<p>Option 1 is the only good solution.</p>

<h3>Why?</h3>

<ul>
<li><p>Option 2 does the same but you repeat the column name lots of times; additionally the SQL engine doesn't immediately know that you want to check if the value is one of the values in a fixed list. However, a good SQL engine could optimize it to have equal performance like with <code>IN</code>. There's still the readability issue though...</p></li>
<li><p>Option 3 is simply horrible performance-wise. It sends a query every loop and hammers the database with small queries. It also prevents it from using any optimizations for ""value is one of those in a given list""</p></li>
</ul>
","5803519"
"How to enable Ad Hoc Distributed Queries","146165","","<p>When I run a query with <code>OPENROWSET</code> in SQL Server 2000 it works.</p>

<p>But the same query in SQL Server 2008 generates the following error:</p>

<blockquote>
  <p>SQL Server blocked access to STATEMENT 'OpenRowset/OpenDatasource' of component 'Ad Hoc Distributed Queries' because this component is turned off as part of the security configuration for this server. A system administrator can enable the use of <strong>'Ad Hoc Distributed Queries'</strong> by using <strong>sp_configure</strong></p>
</blockquote>
","<p>The following command may help you..</p>

<pre><code>EXEC sp_configure 'show advanced options', 1
RECONFIGURE
GO
EXEC sp_configure 'ad hoc distributed queries', 1
RECONFIGURE
GO
</code></pre>
","14544245"
"SQL How to Select the most recent date item","145887","","<p>Hello I have a table with columns:</p>

<p>*using oracle</p>

<pre><code>ID                  NUMBER
USER_ID            NUMBER
DATE_ADDED          DATE
DATE_VIEWED        DATE
DOCUMENT_ID        VARCHAR2
URL                VARCHAR2
DOCUMENT_TITLE      VARCHAR2
DOCUMENT_DATE        DATE
</code></pre>

<p>I want to know how i can get the most recently added document for a given user.</p>

<pre><code>Select * FROM test_table WHERE user_id = value AND (do something with date_added column)
</code></pre>

<p>Thanks</p>
","<pre><code>Select * 
FROM test_table 
WHERE user_id = value 
AND date_added = (select max(date_added) 
   from test_table 
   where user_id = value)</code></pre>
","4090991"
"how to display employee names starting with a and then b in sql","145767","","<p>i want to display the employee names which having names start with a and b ,it should be like list will display employees with  'a' as a first letter and then the  'b' as a first letter...</p>

<p>so any body tell me what is the command to display these...</p>
","<p>To get employee names starting with A or B listed in order...</p>

<pre><code>select employee_name 
from employees
where employee_name LIKE 'A%' OR employee_name LIKE 'B%'
order by employee_name
</code></pre>

<p>If you are using Microsoft SQL Server you could use</p>

<pre><code>....
where employee_name  LIKE '[A-B]%'
order by employee_name
</code></pre>

<p>This is not standard SQL though.</p>
","3739407"
"SQL query question: SELECT ... NOT IN ","145706","","<p>I am sure making a silly mistake but I can't figure what:</p>

<p>In SQL Server 2005 I am trying select all customers except those who have made a reservation before 2 AM.</p>

<p>When I run this query:</p>

<pre><code>SELECT idCustomer FROM reservations 
WHERE idCustomer NOT IN 
  (SELECT distinct idCustomer FROM reservations 
   WHERE DATEPART ( hour, insertDate) &lt; 2)
</code></pre>

<p>I get 0 results.</p>

<p>But </p>

<pre><code>SELECT idCustomer FROM reservations 
</code></pre>

<p>returns 152.000 results and the ""NOT IN"" part:</p>

<pre><code>SELECT distinct idCustomer FROM reservations 
WHERE DATEPART ( hour, insertDate) &lt; 2
</code></pre>

<p>returns only 284 rows</p>
","<pre><code>SELECT distinct idCustomer FROM reservations
WHERE DATEPART ( hour, insertDate) &lt; 2
  and idCustomer is not null
</code></pre>

<p>Make sure your list parameter does not contain null values.</p>

<p>Here's an explanation:</p>

<pre><code>WHERE field1 NOT IN (1, 2, 3, null)
</code></pre>

<p>is the same as:</p>

<pre><code>WHERE NOT (field1 = 1 OR field1 = 2 OR field1 = 3 OR field1 = null)
</code></pre>

<ul>
<li>That last comparision evaluates to null.</li>
<li>That null is OR'd with the rest of the boolean expression, yielding null. (*)</li>
<li>null is negated, yielding null.</li>
<li>null is not true - the where clause only keeps true rows, so all rows are filtered.</li>
</ul>

<p>(*) Edit:  this explanation is pretty good, but I wish to address one thing to stave off future nit-picking.  (TRUE OR NULL) would evaluate to TRUE.  This is relevant if field1 = 3, for example.  That TRUE value would be negated to FALSE and the row would be filtered.</p>
","296158"
"How do I count unique items in field in Access query?","145686","","<p>My Table: table1</p>

<pre>ID  Name  Family
1   A     AA
2   B     BB
3   A     AB
4   D     DD
5   E     EE
6   A     AC</pre>

<p>SQL command on Access:</p>

<pre><code>select count(*) from table1
</code></pre>

<p><em><strong>Output:</strong></em>  ------------> True<br>
6 row(s)</p>

<p>I tried to count unique names:</p>

<p><strong>Expected output:</strong> 4 row(s)</p>

<pre><code>select count(distinct Name) from table1
</code></pre>

<p><em><strong>Output on Access:</strong></em>  ------------> Error</p>

<p>What changes do I need to make to my query?</p>
","<p>Try this</p>

<pre><code>SELECT Count(*) AS N
FROM
(SELECT DISTINCT Name FROM table1) AS T;
</code></pre>

<p>Read <a href=""http://web.archive.org/web/20120805022223/http://blogs.office.com/b/microsoft-access/archive/2007/09/19/writing-a-count-distinct-query-in-access.aspx"">this</a> for more info.</p>
","11880300"
"How to get difference between two rows for a column field?","145632","","<p>I have a table like this:</p>

<pre><code>rowInt  Value
2       23
3       45
17      10
9       0
....
</code></pre>

<p>The column rowInt values are integer but not in a sequence with same increament. I can use the following sql to list values by rowInt:</p>

<pre><code>SELECT * FROM myTable ORDER BY rowInt;
</code></pre>

<p>This will list values by rowInt. How can get get the difference of Value between two rows with the result like this:</p>

<pre><code>rowInt   Value Diff
2        23    22    --45-23
3        45    -35   --10-45
9        0     -45   --0-45
17       10    10    -- 10-0
....
</code></pre>

<p>The table is in SQL 2005 (Miscrosoft)</p>
","<pre><code>SELECT
   [current].rowInt,
   [current].Value,
   ISNULL([next].Value, 0) - [current].Value
FROM
   sourceTable       AS [current]
LEFT JOIN
   sourceTable       AS [next]
      ON [next].rowInt = (SELECT MIN(rowInt) FROM sourceTable WHERE rowInt &gt; [current].rowInt)
</code></pre>

<p>EDIT:  Thinking about it, using a subquery in the select (ala Quassnoi's answer) may be more efficient.  I would trial different versions, and look at the execution plans to see which would perform best on the size of data set that you have...</p>
","634594"
"How do you import a large MS SQL .sql file?","145504","","<p>I use RedGate SQL data compare and generated a .sql file, so I could run it on my local machine. But the problem is that the file is over 300mb, which means I can't do copy and paste because the clipboard won't be able to handle it, and when I try to open the file in SQL Server Management Studio I get an error about the file being too large.</p>

<p>Is there a way to run a large .sql file? The file basically contains data for two new tables.</p>
","<p>From the command prompt, start up <code>sqlcmd</code>:</p>

<pre><code>sqlcmd -S &lt;server&gt; -i C:\&lt;your file here&gt;.sql 
</code></pre>

<p>Just replace <code>&lt;server&gt;</code> with the location of your SQL box and <code>&lt;your file here&gt;</code> with the name of your script.  Don't forget, if you're using a SQL instance the syntax is:</p>

<pre><code>sqlcmd -S &lt;server&gt;\instance.
</code></pre>

<p>Here is the list of all arguments you can pass sqlcmd:</p>

<pre><code>Sqlcmd            [-U login id]          [-P password]
  [-S server]            [-H hostname]          [-E trusted connection]
  [-d use database name] [-l login timeout]     [-t query timeout] 
  [-h headers]           [-s colseparator]      [-w screen width]
  [-a packetsize]        [-e echo input]        [-I Enable Quoted Identifiers]
  [-c cmdend]            [-L[c] list servers[clean output]]
  [-q ""cmdline query""]   [-Q ""cmdline query"" and exit] 
  [-m errorlevel]        [-V severitylevel]     [-W remove trailing spaces]
  [-u unicode output]    [-r[0|1] msgs to stderr]
  [-i inputfile]         [-o outputfile]        [-z new password]
  [-f  | i:[,o:]] [-Z new password and exit] 
  [-k[1|2] remove[replace] control characters]
  [-y variable length type display width]
  [-Y fixed length type display width]
  [-p[1] print statistics[colon format]]
  [-R use client regional setting]
  [-b On error batch abort]
  [-v var = ""value""...]  [-A dedicated admin connection]
  [-X[1] disable commands, startup script, environment variables [and exit]]
  [-x disable variable substitution]
  [-? show syntax summary] 
</code></pre>
","431915"
"sqlite database default time value 'now'","145429","","<p>Is it possible in a sqlite database to craete a table that has a timestamp column that default to <code>DATETIME('now')</code> ?</p>

<p>Like this:</p>

<pre><code>CREATE TABLE test (
    id INTEGER PRIMARY KEY AUTOINCREMENT, 
    t TIMESTAMP DEFAULT DATETIME('now')
);
</code></pre>

<p>This gives an error... How to resolve?</p>
","<p>i believe you can use</p>

<pre><code>CREATE TABLE test (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  t TIMESTAMP
  DEFAULT CURRENT_TIMESTAMP
);
</code></pre>

<p>as of version 3.1 (<a href=""http://www.sqlite.org/lang_createtable.html"" rel=""noreferrer"">source</a>)</p>
","200329"
"Aggregate function in SQL WHERE-Clause","145422","","<p>In a test at university there was a question; is it possible to use an aggregate function in the <code>SQL WHERE</code> clause. </p>

<p>I always thought this isn't possible and I also can't find any example how it would be possible. But my answer was marked false and now I want to know in which cases it is possible to use an aggregate function in the <code>WHERE</code>. Also if it isn't possible it would be nice to get a link to the specification where it is described.</p>
","<p>You haven't mentioned the DBMS. Assuming you are using MS SQL-Server, I've found a T-SQL Error message that is self-explanatory: </p>

<blockquote>
  <p>""An aggregate may not appear in the
  WHERE clause unless it is in a
  subquery contained in a HAVING clause
  or a select list, and the column being
  aggregated is an outer reference""</p>
</blockquote>

<p><a href=""http://www.sql-server-performance.com/2007/aggregate-may-not-appear-in-where-clause/"" rel=""noreferrer"">http://www.sql-server-performance.com/</a> </p>

<hr>

<p>And an example that it is possible in a subquery.</p>

<p>Show all customers and smallest order for those who have 5 or more orders (and NULL for others):</p>

<pre><code>SELECT a.lastname
     , a.firstname
     , ( SELECT MIN( o.amount )
         FROM orders o
         WHERE a.customerid = o.customerid
           AND COUNT( a.customerid ) &gt;= 5
        )
        AS smallestOrderAmount
FROM account a
GROUP BY a.customerid
       , a.lastname
       , a.firstname ;
</code></pre>

<hr>

<p>UPDATE.</p>

<p>The above runs in both SQL-Server and MySQL but it doesn't return the result I expected. The next one is more close. I guess it has to do with that the field <code>customerid</code>, GROUPed BY and used in the query-subquery join is in the first case PRIMARY KEY of the outer table and in the second case it's not.</p>

<p>Show all customer ids and number of orders for those who have 5 or more orders (and NULL for others):</p>

<pre><code>SELECT o.customerid
     , ( SELECT COUNT( o.customerid )
         FROM account a
         WHERE a.customerid = o.customerid
           AND COUNT( o.customerid ) &gt;= 5
        )
        AS cnt
FROM orders o
GROUP BY o.customerid ;
</code></pre>
","6319213"
"Oracle Insert via Select from multiple tables where one table may not have a row","145358","","<p>I have a number of code value tables that contain a code and a description with a Long id.</p>

<p>I now want to create an entry for an Account Type that references a number of codes, so I have something like this:</p>

<pre><code>insert into account_type_standard (account_type_Standard_id,
tax_status_id, recipient_id)
( select account_type_standard_seq.nextval,
ts.tax_status_id, r.recipient_id
from tax_status ts, recipient r
where ts.tax_status_code = ?
and r.recipient_code = ?)
</code></pre>

<p>This retrieves the appropriate values from the tax_status and recipient tables if a match is found for their respective codes. Unfortunately, recipient_code is nullable, and therefore the ? substitution value could be null. Of course, the implicit join doesn't return a row, so a row doesn't get inserted into my table.</p>

<p>I've tried using NVL on the ? and on the r.recipient_id. </p>

<p>I've tried to force an outer join on the r.recipient_code = ? by adding (+), but it's not an explicit join, so Oracle still didn't add another row.</p>

<p>Anyone know of a way of doing this?</p>

<p>I can obviously modify the statement so that I do the lookup of the recipient_id externally, and have a ? instead of r.recipient_id, and don't select from the recipient table at all, but I'd prefer to do all this in 1 SQL statement.</p>
","<p>Outter joins don't work ""as expected"" in that case because you have explicitly told Oracle you only want data if that criteria on that table matches. In that scenario, the outter join is rendered useless.</p>

<p>A work-around</p>

<pre><code>INSERT INTO account_type_standard 
  (account_type_Standard_id, tax_status_id, recipient_id) 
VALUES( 
  (SELECT account_type_standard_seq.nextval FROM DUAL),
  (SELECT tax_status_id FROM tax_status WHERE tax_status_code = ?), 
  (SELECT recipient_id FROM recipient WHERE recipient_code = ?)
)
</code></pre>

<p>[Edit]
If you expect multiple rows from a sub-select, you can add ROWNUM=1 to each where clause OR use an aggregate such as MAX or MIN.  This of course may not be the best solution for all cases.</p>

<p>[Edit] Per comment, </p>

<pre><code>  (SELECT account_type_standard_seq.nextval FROM DUAL),
</code></pre>

<p>can be just</p>

<pre><code>  account_type_standard_seq.nextval,
</code></pre>
","131183"
"Entity Framework VS LINQ to SQL VS ADO.NET with stored procedures?","145137","","<p>How would you rate each of them in terms of:</p>

<ol>
<li>Performance</li>
<li>Speed of development</li>
<li>Neat, intuitive, maintainable code</li>
<li>Flexibility</li>
<li>Overall</li>
</ol>

<p>I like my SQL and so have always been a die-hard fan of ADO.NET and stored procedures but I recently had a play with Linq to SQL and was blown away by how quickly I was writing out my DataAccess layer and have decided to spend some time really understanding either Linq to SQL or EF... or neither?</p>

<p>I just want to check, that there isn't a great flaw in any of these technologies that would render my research time useless. E.g. performance is terrible, it's cool for simple apps but can only take you so far.</p>

<p><strong>Update:</strong>
Can you concentrate on EF VS L2S VS SPs rather than ORM VS SPs. I'm mainly interested by EF VS L2S. But am keen to have them compared against stored procs too since plain SQl is something I know a lot about.</p>
","<p>First off, if you're starting a new project, go with Entity Framework (""EF"") - it now generates much better SQL (more like Linq to SQL does) and is easier to maintain and more powerful than Linq to SQL (""L2S"").  As of the release of .NET 4.0, I consider Linq to SQL to be an obsolete technology.  MS has been very open about not continuing L2S development further.</p>

<p><strong>1) Performance</strong></p>

<p>This is tricky to answer.  For most single-entity operations (<a href=""http://en.wikipedia.org/wiki/Create,_read,_update_and_delete"" rel=""noreferrer"">CRUD</a>) you will find just about equivalent performance with all three technologies.  You do have to know how EF and Linq to SQL work in order to use them to their fullest.  For high-volume operations like polling queries, you may want to have EF/L2S ""compile"" your entity query such that the framework doesn't have to constantly regenerate the SQL, or you can run into scalability issues.  (see edits)</p>

<p>For bulk updates where you're updating massive amounts of data, raw SQL or a stored procedure will always perform better than an ORM solution because you don't have to marshal the data over the wire to the ORM to perform updates.  </p>

<p><strong>2) Speed of Development</strong></p>

<p>In most scenarios, EF will blow away naked SQL/stored procs when it comes to speed of development.  The EF designer can update your model from your database as it changes (upon request), so you don't run into synchronization issues between your object code and your database code.  The only time I would not consider using an ORM is when you're doing a reporting/dashboard type application where you aren't doing any updating, or when you're creating an application just to do raw data maintenance operations on a database.  </p>

<p><strong>3) Neat/Maintainable code</strong></p>

<p>Hands down, EF beats SQL/sprocs.  Because your relationships are modeled, joins in your code are relatively infrequent.  The relationships of the entities are almost self-evident to the reader for most queries.  Nothing is worse than having to go from tier to tier debugging or through multiple SQL/middle tier in order to understand what's actually happening to your data.  EF brings your data model into your code in a very powerful way.   </p>

<p><strong>4) Flexibility</strong></p>

<p>Stored procs and raw SQL are more ""flexible"".  You can leverage sprocs and SQL to generate faster queries for the odd specific case, and you can leverage native DB functionality easier than you can with and ORM.  </p>

<p><strong>5) Overall</strong> </p>

<p><strong>Don't get caught up in the <a href=""http://www.nbc.com/saturday-night-live/video/shimmer-floor-wax/1056743/"" rel=""noreferrer"">false dichotomy</a> of choosing an ORM vs using stored procedures.</strong>  You can use both in the same application, and you probably should.  Big bulk operations should go in stored procedures or SQL (which can actually be called by the EF), and EF should be used for your CRUD operations and most of your middle-tier's needs.  Perhaps you'd choose to use SQL for writing your reports.  I guess the moral of the story is the same as it's always been.  Use the right tool for the job.  But the skinny of it is, EF is very good nowadays (as of .NET 4.0).  Spend some real time reading and understanding it in depth and you can create some amazing, high-performance apps with ease.</p>

<p><strong>EDIT</strong>: EF 5 simplifies this part a bit with <a href=""http://blogs.msdn.com/b/efdesign/archive/2011/06/30/auto-compiled-linq-queries-entity-framework-june-2011-ctp.aspx"" rel=""noreferrer"">auto-compiled LINQ Queries</a>, but for real high volume stuff, you'll definitely need to test and analyze what fits best for you in the real world.</p>
","2698306"
"Join two sql queries","145006","","<p>I have two SQL queries, where the first one is:</p>

<pre><code>select Activity, SUM(Amount) as ""Total Amount 2009""
from Activities, Incomes
where Activities.UnitName = ? AND
      Incomes.ActivityId = Activities.ActivityID
GROUP BY Activity
ORDER BY Activity;
</code></pre>

<p>and the second one is:</p>

<pre><code>select Activity, SUM(Amount) as ""Total Amount 2008""
from Activities, Incomes2008
where Activities.UnitName = ? AND
      Incomes2008.ActivityId = Activities.ActivityID
GROUP BY Activity
ORDER BY Activity;
</code></pre>

<p>(Dont mind the '?', they represent a parameter in birt).
What i want to achieve is the following:
I want an SQL query that returns the same as the first query, but with an additional (third) column which looks exactly like ""Total Amount 2008"" (from the 2nd query).</p>
","<p>Some DBMSs support the <code>FROM (SELECT ...) AS alias_name</code> syntax.</p>

<p>Think of your two original queries as temporary tables. You can query them like so:</p>

<pre><code>SELECT t1.Activity, t1.""Total Amount 2009"", t2.""Total Amount 2008""
FROM (query1) as t1, (query2) as t2
WHERE t1.Activity = t2.Activity
</code></pre>
","565093"
"How do I return the SQL data types from my query?","144964","","<p>I've a SQL query that queries an enormous (as in, hundreds of views/tables with hard-to-read names like CMM-CPP-FAP-ADD) database that I don't need nor want to understand.  The result of this query needs to be stored in a staging table to feed a report.</p>

<p>I need to create the staging table, but with hundreds of views/tables to dig through to find the data types that are being represented here, I have to wonder if there's a better way to construct this table.</p>

<p>Can anyone advise how I would use any of the SQL Server 2008 tools to divine the source data types in my SQL 2000 database?</p>

<p>As a general example, I want to know from a query like:</p>

<pre><code>SELECT Auth_First_Name, Auth_Last_Name, Auth_Favorite_Number 
FROM Authors
</code></pre>

<p>Instead of the actual results, I want to know that:</p>

<pre><code>Auth_First_Name is char(25)
Auth_Last_Name is char(50)
Auth_Favorite_Number is int
</code></pre>

<p>I'm not interested in constraints, I really just want to know the data types.</p>
","<pre><code>select * from information_schema.columns
</code></pre>

<p>could get you started.</p>
","1601755"
"Best practices for SQL varchar column length","144961","","<p>Every time is set up a new SQL table or add a new <code>varchar</code> column to an existing table, I am wondering one thing: what is the best value for the <code>length</code>. </p>

<p>So, lets say, you have a column called <code>name</code> of type <code>varchar</code>. So, you have to choose the length. I cannot think of a name > 20 chars, but you will never know. But instead of using 20, I always round up to the next 2^n number. In this case, I would choose 32 as the length. I do that, because from an computer scientist point of view, a number 2^n looks more <code>even</code> to me than other numbers and I'm just assuming that the architecture underneath can handle those numbers slightly better than others.</p>

<p>On the other hand, MSSQL server for example, sets the default length value to 50, when you choose to create a varchar column. That makes me thinking about it. Why 50? is it just a random number, or based on average column length, or what?</p>

<p>It could also be - or probably is - that different SQL servers implementations (like MySQL, MSSQL, Postgres, ...) have different best column length values.</p>
","<p>No DBMS I know of has any ""optimization"" that will make a <code>VARCHAR</code> with a <code>2^n</code> length perform better than one with a <code>max</code> length that is not a power of 2.</p>

<p>I think early SQL Server versions actually treated a <code>VARCHAR</code> with length 255 differently than one with a higher maximum length. I don't know if this is still the case. </p>

<p>For almost all DBMS, the actual storage that is required is only determined by the number of characters you put into it, not the <code>max</code> length you define. So from a storage point of view (and most probably a performance one as well), it does not make any difference whether you declare a column as <code>VARCHAR(100)</code> or <code>VARCHAR(500)</code>. </p>

<p>You should see the <code>max</code> length provided for a <code>VARCHAR</code> column as a kind of constraint (or business rule) rather than a technical/physical thing.</p>

<p>For PostgreSQL the best setup is to use <code>text</code> without a length restriction and a <code>CHECK CONSTRAINT</code> that limits the number of characters to whatever your business requires. </p>

<p>If that requirement changes, altering the check constraint is much faster than altering the table (because the table does not need to be re-written)</p>

<p>The same can be applied for Oracle and others - in Oracle it would be <code>VARCHAR(4000)</code> instead of <code>text</code> though. </p>

<p>I don't know if there is a physical storage difference between <code>VARCHAR(max)</code> and e.g. <code>VARCHAR(500)</code> in SQL Server. But apparently there is a performance impact when using <code>varchar(max)</code> as compared to <code>varchar(8000)</code>. </p>

<p>See <a href=""http://rusanu.com/2010/03/22/performance-comparison-of-varcharmax-vs-varcharn/"" rel=""noreferrer"">this link</a> (posted by Erwin Brandstetter as a comment)</p>

<p><strong>Edit 2013-09-22</strong></p>

<p>Regarding bigown's comment: </p>

<p>In Postgres versions before 9.2 (which was not available when I wrote the initial answer) a change to the column definition <em>did</em> rewrite the whole table, see e.g. <a href=""http://blog.endpoint.com/2012/11/postgres-alter-column-problems-and.html"" rel=""noreferrer"">here</a>. Since 9.2 this is no longer the case and a quick test confirmed that increasing the column size for a table with 1.2 million rows indeed only took 0.5 seconds. </p>

<p>For Oracle this seems to be true as well, judging by the time it takes to alter a big table's <code>varchar</code> column. But I could not find any reference for that.</p>

<p>For MySQL <a href=""http://dev.mysql.com/doc/refman/5.5/en/alter-table.html#idm47496385802240"" rel=""noreferrer"">the manual says</a> ""<em>In most cases, <code>ALTER TABLE</code> makes a temporary copy of the original table</em>"". And my own tests confirm that: running an <code>ALTER TABLE</code> on a table with 1.2 million rows (the same as in my test with Postgres) to increase the size of a column took 1.5 minutes. In MySQL however you can <em>not</em> use the ""workaround"" to use a check constraint to limit the number of characters in a column.</p>

<p>For SQL Server I could not find a clear statement on this but the execution time to increase the size of a <code>varchar</code> column (again the 1.2 million rows table from above) indicates that <strong>no</strong> rewrite takes place.</p>

<p><strong>Edit 2017-01-24</strong></p>

<p>Seems I was (at least partially) wrong about SQL Server. See <a href=""https://dba.stackexchange.com/a/162117/1822"">this answer from Aaron Bertrand</a> that shows that the declared length of a <code>nvarchar</code> or <code>varchar</code> columns makes a huge difference for the performance. </p>
","8295254"
"How to select a column name with space between in MySQL on Liunx/Ubuntu","144922","","<p>I am working on a project where another developer created a table with column names like <code>'Business Name'</code>. That is a space between two words. I am a Linux user now; If I run a <code>SELECT</code> statement with 'Business Name' it says there is no columns with name 'Business'.</p>

<p>How can I solve this problem?</p>
","<p>Generally the first step is to not do that in the first place, but if this is already done, then you need to resort to properly quoting your column names:</p>

<pre><code>SELECT `Business Name` FROM annoying_table
</code></pre>

<p>Usually these sorts of things are created by people who have used something like Microsoft Access and always use a GUI to do their thing.</p>
","14190833"
"Error message: (provider: Shared Memory Provider, error: 0 - No process is on the other end of the pipe.)","144768","","<p>I am trying to deploy my website on windows server 2003. 
Am i missing something or what is wrong from the following error message, how can I correct it? Thank</p>

<p>I am having the error message:</p>

<blockquote>
  <p>A connection was successfully established with the server, but then an error occurred during the login process. (provider: Shared Memory Provider, error: 0 - No process is on the other end of the pipe.) 
  Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </p>
  
  <p>Exception Details: System.Data.SqlClient.SqlException: A connection
  was successfully established with the server, but then an error
  occurred during the login process. (provider: Shared Memory Provider,
  error: 0 - No process is on the other end of the pipe.)</p>
  
  <p>Source Error: </p>
  
  <p>An unhandled exception was generated during the execution of the
  current web request. Information regarding the origin and location of
  the exception can be identified using the exception stack trace below.</p>
  
  <p>Stack Trace: </p>
  
  <p>[SqlException (0x80131904): A connection was successfully established
  with the server, but then an error occurred during the login process.
  (provider: Shared Memory Provider, error: 0 - No process is on the
  other end of the pipe.)]<br>
  System.Data.ProviderBase.DbConnectionPool.GetConnection(DbConnection
  owningObject) +1019<br>
  System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection
  owningConnection) +108<br>
  System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection
  outerConnection, DbConnectionFactory connectionFactory) +126<br>
  System.Data.SqlClient.SqlConnection.Open() +125<br>
  NHibernate.Connection.DriverConnectionProvider.GetConnection() +104<br>
  NHibernate.Tool.hbm2ddl.SuppliedConnectionProviderConnectionHelper.Prepare()
  +15    NHibernate.Tool.hbm2ddl.SchemaMetadataUpdater.GetReservedWords(Dialect
  dialect, IConnectionHelper connectionHelper) +89<br>
  NHibernate.Tool.hbm2ddl.SchemaMetadataUpdater.Update(ISessionFactory
  sessionFactory) +80<br>
  NHibernate.Impl.SessionFactoryImpl..ctor(Configuration cfg, IMapping
  mapping, Settings settings, EventListeners listeners) +599<br>
  NHibernate.Cfg.Configuration.BuildSessionFactory() +104<br>
  MyProject.API.Data.SessionManager..cctor() in
  C:\Dev\Code\API\Data\SessionManager.cs:27</p>
</blockquote>
","<p>Typically, to troubleshoot this, you go to SQL Server Configuration Manager (SSCM) and:</p>

<ol>
<li>ensure Shared Memory protocol is enabled</li>
<li>ensure Named Pipes protocol is enabled</li>
<li>ensure TCP/IP is enabled, and s ahead of the Named Pipes in the settings</li>
</ol>

<p>Maybe it can help: <a href=""http://blog.sqlauthority.com/2009/05/21/sql-server-fix-error-provider-named-pipes-provider-error-40-could-not-open-a-connection-to-sql-server-microsoft-sql-server-error/"" rel=""noreferrer"">Could not open a connection to SQL Server</a></p>
","8076038"
"SQL RANK() versus ROW_NUMBER()","144707","","<p>I'm confused about the differences between these.  Running the following SQL gets me two idential result sets.  Can someone please explain the differences?</p>

<pre><code>SELECT ID, [Description], RANK()       OVER(PARTITION BY StyleID ORDER BY ID) as 'Rank'      FROM SubStyle
SELECT ID, [Description], ROW_NUMBER() OVER(PARTITION BY StyleID ORDER BY ID) as 'RowNumber' FROM SubStyle
</code></pre>
","<p><strong>ROW_NUMBER :</strong> Returns a unique number for each row starting with 1. For rows that have duplicate values,numbers are arbitarily assigned.</p>

<p><strong>Rank :</strong> Assigns a unique number for each row starting with 1,except for rows that have duplicate values,in which case the same ranking is assigned and a gap appears in the sequence for each duplicate ranking.</p>
","7747406"
"Is there any difference between GROUP BY and DISTINCT","144471","","<p>I learned something simple about SQL the other day:</p>

<pre><code>SELECT c FROM myTbl GROUP BY C
</code></pre>

<p>Has the same result as:</p>

<pre><code>SELECT DISTINCT C FROM myTble
</code></pre>

<p>What I am curious of, is there anything different in the way an SQL engine processes the command, or are they truly the same thing?  </p>

<p>I personally prefer the distinct syntax, but I am sure it's more out of habit than anything else.</p>

<p>EDIT: This is not a question about aggregates. The use of <code>GROUP BY</code> with aggregate functions is understood.</p>
","<p><a href=""https://stackoverflow.com/questions/164319/is-there-any-difference-between-group-by-and-distinct#164485"">MusiGenesis</a>' response is functionally the correct one with regard to your question as stated; the SQL Server is smart enough to realize that if you are using ""Group By"" and not using any aggregate functions, then what you actually mean is ""Distinct"" - and therefore it generates an execution plan as if you'd simply used ""Distinct.""</p>

<p>However,I think it's important to note <a href=""https://stackoverflow.com/questions/164319/is-there-any-difference-between-group-by-and-distinct#164323"">Hank</a>'s response as well - cavalier treatment of ""Group By"" and ""Distinct"" could lead to some pernicious gotcha's down the line if you're not careful.  It's not entirely correct to say that this is ""not a question about aggregates"" because you're asking about the functional difference between two SQL query keywords, one of which is <strong>meant to be used with aggregates</strong> and one of which is not.</p>

<p>A hammer can work to drive in a screw sometimes , but if you've got a screwdriver handy, why bother?</p>
","164544"
"INSERT SELECT statement in Oracle 11G","144343","","<p>I'm trying to run a very simple sql statement in Oracle 11g.</p>

<pre><code> insert into table1 (col1, col2) values (select t1.col1, t2.col2 from oldtable1 t1, oldtable2 t2);
</code></pre>

<p>Very simple query. Cartesian join old table 1 to old table 2, put the resulting values into table 1.</p>

<p>I've run the subquery by itself, and it works perfectly.</p>

<pre><code> select t1.col1, t2.col2 from oldtable1 t1, oldtable2 t2
</code></pre>

<p>When I try to run the full statement, I get the following error:</p>

<pre><code> SQL Error: ORA-00936: missing expression
 00936. 00000 -  ""missing expression""
</code></pre>

<p>I can't get it to work in MySql either. Something is wrong with my statement, but I'm not sure what it is.</p>
","<p>Your query should be:</p>

<pre><code>insert into table1 (col1, col2) 
select t1.col1, t2.col2 
from oldtable1 t1, oldtable2 t2
</code></pre>

<p>I.e. without the <code>VALUES</code> part.</p>
","7323436"
"How do I query using fields inside the new PostgreSQL JSON datatype?","144306","","<p>I am looking for some docs and/or examples for the new JSON functions in PostgreSQL 9.2. </p>

<p>Specifically, given a series of JSON records:</p>

<pre><code>[
  {name: ""Toby"", occupation: ""Software Engineer""},
  {name: ""Zaphod"", occupation: ""Galactic President""}
]
</code></pre>

<p>How would I write the SQL to find a record by name?</p>

<p>In vanilla SQL:</p>

<pre><code>SELECT * from json_data WHERE ""name"" = ""Toby""
</code></pre>

<p>The official dev manual is quite sparse:</p>

<ul>
<li><a href=""http://www.postgresql.org/docs/devel/static/datatype-json.html"">http://www.postgresql.org/docs/devel/static/datatype-json.html</a></li>
<li><a href=""http://www.postgresql.org/docs/devel/static/functions-json.html"">http://www.postgresql.org/docs/devel/static/functions-json.html</a></li>
</ul>

<h3>Update I</h3>

<p>I've put together a <a href=""https://gist.github.com/2715918"">gist detailing what is currently possible with PostgreSQL 9.2</a>.
Using some custom functions, it is possible to do things like:</p>

<pre><code>SELECT id, json_string(data,'name') FROM things
WHERE json_string(data,'name') LIKE 'G%';
</code></pre>

<h3>Update II</h3>

<p>I've now moved my JSON functions into their own project:</p>

<p><a href=""https://github.com/tobyhede/postsql""><strong>PostSQL</strong></a> - a set of functions for transforming PostgreSQL and PL/v8 into a totally awesome JSON document store</p>
","<h3>Postgres 9.2</h3>

<p>I quote <a href=""http://archives.postgresql.org/pgsql-hackers/2012-01/msg01764.php"" rel=""noreferrer"">Andrew Dunstan on the pgsql-hackers list</a>:</p>

<blockquote>
  <p>At some stage there will possibly be some json-processing (as opposed
  to json-producing) functions, but not in 9.2.</p>
</blockquote>

<p>Doesn't prevent him from providing an <a href=""http://people.planetpostgresql.org/andrew/index.php?/archives/249-Using-PLV8-to-index-JSON.html"" rel=""noreferrer"">example implementation in PLV8</a> that should solve your problem.</p>

<h3>Postgres 9.3</h3>

<p>Offers an arsenal of new functions and operators to add ""json-processing"".</p>

<ul>
<li><a href=""http://www.postgresql.org/docs/9.3/static/functions-json.html"" rel=""noreferrer"">The manual on new JSON functionality.</a></li>
<li><a href=""https://wiki.postgresql.org/wiki/What%27s_new_in_PostgreSQL_9.3#JSON:_Additional_functionality"" rel=""noreferrer"">The Postgres Wiki on new features in pg 9.3</a>.</li>
<li>@Will posted a link to a <a href=""http://michael.otacoo.com/postgresql-2/postgres-9-3-feature-highlight-json-operators/"" rel=""noreferrer"">blog demonstrating the new operators</a> in <a href=""https://stackoverflow.com/questions/10560394/how-do-i-query-using-fields-inside-the-new-postgresql-json-datatype/10560761?noredirect=1#comment25333781_10560761"">a comments below</a>.</li>
</ul>

<p>The answer to the <strong>original question</strong> in Postgres 9.3:</p>

<pre><code>SELECT *
FROM   json_array_elements(
  '[{""name"": ""Toby"", ""occupation"": ""Software Engineer""},
    {""name"": ""Zaphod"", ""occupation"": ""Galactic President""} ]'
  ) AS elem
WHERE elem-&gt;&gt;'name' = 'Toby';
</code></pre>

<p>Advanced example:</p>

<ul>
<li><a href=""https://stackoverflow.com/questions/26877241/query-combinations-with-nested-array-of-records-in-json-datatype/26880705#26880705"">Query combinations with nested array of records in JSON datatype</a></li>
</ul>

<p>For bigger tables you may want to add an expression index to increase performance:</p>

<ul>
<li><a href=""https://stackoverflow.com/questions/18404055/index-for-finding-element-in-json-array"">Index for finding an element in a JSON array</a></li>
</ul>

<h3>Postgres 9.4</h3>

<p>Adds <strong><code>jsonb</code></strong> (b for ""binary"", values are stored as native Postgres types) and yet more functionality for <em>both</em> types. In addition to expression indexes mentioned above, <code>jsonb</code> also supports <a href=""http://www.postgresql.org/docs/9.4/interactive/datatype-json.html#JSON-INDEXING"" rel=""noreferrer"">GIN, btree and hash indexes</a>, GIN being the most potent of these.</p>

<ul>
<li>The manual on <a href=""http://www.postgresql.org/docs/9.4/interactive/datatype-json.html"" rel=""noreferrer""><code>json</code> and <code>jsonb</code> data types</a> and <a href=""http://www.postgresql.org/docs/current/interactive/functions-json.html"" rel=""noreferrer"">functions</a>.</li>
<li><a href=""https://wiki.postgresql.org/wiki/What%27s_new_in_PostgreSQL_9.4#JSONB_Binary_JSON_storage"" rel=""noreferrer"">The Postgres Wiki on JSONB in pg 9.4</a></li>
</ul>

<p>The manual goes as far as suggesting:</p>

<blockquote>
  <p>In general, <strong>most applications should prefer to store JSON data as
  <code>jsonb</code></strong>, unless there are quite specialized needs, such as legacy
  assumptions about ordering of object keys.</p>
</blockquote>

<p>Bold emphasis mine.</p>

<p><a href=""https://wiki.postgresql.org/wiki/What&#39;s_new_in_PostgreSQL_9.4#GIN_indexes_now_faster_and_smaller"" rel=""noreferrer"">Performance benefits from general improvements to GIN indexes.</a></p>

<h3>Postgres 9.5</h3>

<p>Complete <code>jsonb</code> functions and operators. Add more functions to manipulate <code>jsonb</code> in place and for display.</p>

<ul>
<li><a href=""http://www.postgresql.org/docs/9.5/interactive/release-9-5.html#AEN126466"" rel=""noreferrer"">Major good news in the release notes of Postgres 9.5.</a></li>
</ul>
","10560761"
"How to handle a single quote in Oracle SQL","144255","","<p>How do I insert a record in a column having varchar data type having single quote in it?</p>

<p><strong>Example</strong>: first name is <code>ROBERT</code> and last name is <strong><code>D'COSTA</code></strong></p>
","<p>Use two single-quotes</p>

<pre><code>SQL&gt; SELECT 'D''COSTA' name FROM DUAL;

NAME
-------
D'COSTA
</code></pre>

<p>Alternatively, use the <a href=""http://docs.oracle.com/database/121/SQLRF/sql_elements003.htm#SQLRF00218"" rel=""noreferrer"">new (10g+) quoting method</a>:</p>

<pre><code>SQL&gt; SELECT q'$D'COSTA$' NAME FROM DUAL;

NAME
-------
D'COSTA
</code></pre>
","2875295"
"TSQL - Cast string to integer or return default value","144249","","<p>Is there a way in T-SQL to cast an nvarchar to int and return a default value or NULL if the conversion fails?</p>
","<p>Yes :). Try this:</p>

<pre><code>DECLARE @text AS NVARCHAR(10)

SET @text = '100'
SELECT CASE WHEN ISNUMERIC(@text) = 1 THEN CAST(@text AS INT) ELSE NULL END
-- returns 100

SET @text = 'XXX'
SELECT CASE WHEN ISNUMERIC(@text) = 1 THEN CAST(@text AS INT) ELSE NULL END
-- returns NULL
</code></pre>

<p><a href=""http://msdn.microsoft.com/en-us/library/ms186272.aspx"" rel=""noreferrer""><code>ISNUMERIC()</code></a> has a few issues pointed by <a href=""https://stackoverflow.com/users/243153/fedor-hajdu"">Fedor Hajdu</a>. </p>

<p>It returns true for strings like <code>$</code> (is currency), <code>,</code> or <code>.</code> (both are separators), <code>+</code> and <code>-</code>.</p>
","2000061"
"Difference between datetime and timestamp in sqlserver?","144137","","<p>What is the difference between <code>Timestamp</code> and <code>Datetime</code> SQL Server?</p>

<p>I thought Both formats are capable of storing date + time. Then, Where the difference is lying between them?</p>

<p>But <code>Timestamp</code> is not capable of storing date, time information.</p>

<p>Still Whats the difference?</p>
","<p>According to <a href=""http://msdn.microsoft.com/en-us/library/ms182776.aspx"">the documentation</a>, <code>timestamp</code> is a synonym for <code>rowversion</code> - it's automatically generated and <em>guaranteed</em><sup>1</sup> to be unique. <code>datetime</code> isn't - it's just a data type which handles dates and times, and can be client-specified on insert etc.</p>

<hr>

<p><sup>1</sup> Assuming you use it properly, of course. See comments.</p>
","7105129"
"MySQL - Operand should contain 1 column(s)","143864","","<p>While working on a system I'm creating, I attempted to use the following query in my project:</p>

<pre class=""lang-sql prettyprint-override""><code>SELECT
topics.id,
topics.name,
topics.post_count,
topics.view_count,
COUNT( posts.solved_post ) AS solved_post,
(SELECT users.username AS posted_by,
    users.id AS posted_by_id
    FROM users
    WHERE users.id = posts.posted_by)
FROM topics
LEFT OUTER JOIN posts ON posts.topic_id = topics.id
WHERE topics.cat_id = :cat
GROUP BY topics.id
</code></pre>

<p>"":cat"" is bound by my PHP code as I'm using PDO. 2 is a valid value for "":cat"".</p>

<p>That query though gives me an error: ""#1241 - Operand should contain 1 column(s)""</p>

<p>What stumps me is that I would think that this query would work no problem. Selecting columns, then selecting two more from another table, and continuing on from there. I just can't figure out what the problem is.</p>

<p>Is there a simple fix to this, or another way to write my query?</p>
","<p>Your subquery is selecting two columns, while you are using it to project one column (as part of the outer <code>SELECT</code> clause).  You can only select one column from such a query in this context.</p>

<p>Consider joining to the <code>users</code> table instead; this will give you more flexibility when selecting what columns you want from <code>users</code>.</p>

<pre><code>SELECT
topics.id,
topics.name,
topics.post_count,
topics.view_count,
COUNT( posts.solved_post ) AS solved_post,
users.username AS posted_by,
users.id AS posted_by_id

FROM topics

LEFT OUTER JOIN posts ON posts.topic_id = topics.id
LEFT OUTER JOIN users ON users.id = posts.posted_by

WHERE topics.cat_id = :cat
GROUP BY topics.id
</code></pre>
","14046855"
"Difference between View and table in sql","143810","","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""https://stackoverflow.com/questions/4576589/difference-between-views-and-tables-in-performance"">Difference Between Views and Tables in Performance</a>  </p>
</blockquote>



<p>What is the main difference between view and table in SQL. Is there any advantage of using views instead of tables.</p>
","<p>A table contains data, a view is just a <code>SELECT</code> statement which has been saved in the database (more or less, depending on your database).</p>

<p>The advantage of a view is that it can join data from several tables thus creating a new view of it. Say you have a database with salaries and you need to do some complex statistical queries on it.</p>

<p>Instead of sending the complex query to the database all the time, you can save the query as a view and then <code>SELECT * FROM view</code></p>
","6015246"
"SQL NVARCHAR and VARCHAR Limits","143728","","<p>All, I have a large (unavoidable) dynamic SQL query. Due to the number of fields in the selection criteria the string containing the dynamic SQL is growing over 4000 chars. Now, I understand that there is a 4000 max set for <code>NVARCHAR(MAX)</code>, but looking at the executed SQL in Server Profiler for the statement </p>

<pre><code>DELARE @SQL NVARCHAR(MAX);
SET @SQL = 'SomeMassiveString &gt; 4000 chars...';
EXEC(@SQL);
GO
</code></pre>

<p>Seems to work(!?), for another query that is also large it throws an error which is associated with this 4000 limit(!?), it basically trims all of the SQL after this 4000 limit and leaves me with a syntax error. Despite this in the profiler, it is showing this dynamic SQL query in <strong>full</strong>(!?). </p>

<p>What exactly is happening here and should I just be converting this @SQL variable to VARCHAR and get on with it?</p>

<p>Thanks for your time.</p>

<p>Ps. It would also be nice to be able to print out more than 4000 chars to look at these big queries. The following are limited to 4000 </p>

<pre><code>SELECT CONVERT(XML, @SQL);
PRINT(@SQL);
</code></pre>

<p>is there any other cool way?</p>
","<blockquote>
  <p>I understand that there is a 4000 max set for <code>NVARCHAR(MAX)</code></p>
</blockquote>

<p>Your understanding is wrong. <code>nvarchar(max)</code> can store up to (and beyond sometimes) 2GB of data (1 billion double byte characters).</p>

<p>From <a href=""http://msdn.microsoft.com/en-us/library/ms186939.aspx"" rel=""noreferrer"">nchar and nvarchar</a> in Books online the grammar is </p>

<pre><code>nvarchar [ ( n | max ) ]
</code></pre>

<p>The <code>|</code> character means these are alternatives. i.e. you specify <em>either</em> <code>n</code> or the literal <code>max</code>.</p>

<p>If you choose to specify a specific <code>n</code> then this must be between 1 and 4,000 but using <code>max</code> defines it as a large object datatype (replacement for <a href=""http://msdn.microsoft.com/en-us/library/ms187993.aspx"" rel=""noreferrer""><code>ntext</code></a> which is deprecated).</p>

<p>In fact in SQL Server 2008 it seems that for a <em>variable</em> the 2GB limit can be exceeded indefinitely subject to sufficient space in <code>tempdb</code> (<a href=""https://stackoverflow.com/q/7611394/73226"">Shown here</a>)</p>

<p>Regarding the other parts of your question</p>

<h2>Truncation when concatenating depends on datatype.</h2>

<ol>
<li><code>varchar(n) + varchar(n)</code> will truncate at 8,000 characters. </li>
<li><code>nvarchar(n) + nvarchar(n)</code> will truncate at 4,000 characters. </li>
<li><code>varchar(n) + nvarchar(n)</code> will truncate at 4,000 characters. <code>nvarchar</code> has higher precedence so the result is <code>nvarchar(4,000)</code></li>
<li><code>[n]varchar(max)</code> + <code>[n]varchar(max)</code> won't truncate (for &lt; 2GB). </li>
<li><code>varchar(max)</code> + <code>varchar(n)</code> won't truncate (for &lt; 2GB) and the result will be typed as <code>varchar(max)</code>.</li>
<li><code>varchar(max)</code> + <code>nvarchar(n)</code> won't truncate (for &lt; 2GB) and the result will be typed as <code>nvarchar(max)</code>. </li>
<li><code>nvarchar(max)</code> + <code>varchar(n)</code> will first convert the <code>varchar(n)</code> input to <code>nvarchar(n)</code> and then do the concatenation. <strong>If the length of the  <code>varchar(n)</code> string is greater than 4,000 characters the cast will be to <code>nvarchar(4000)</code> and truncation will occur</strong>.</li>
</ol>

<h2>Datatypes of string literals</h2>

<p>If you use the <code>N</code> prefix and the string is &lt;= 4,000 characters long it will be typed as <code>nvarchar(n)</code> where <code>n</code> is the length of the string. So <code>N'Foo'</code> will be treated as <code>nvarchar(3)</code> for example. If the string is longer than 4,000 characters it will be treated as <code>nvarchar(max)</code></p>

<p>If you don't use the <code>N</code> prefix and the string is &lt;= 8,000 characters long it will be typed as <code>varchar(n)</code> where <code>n</code> is the length of the string. If longer as <code>varchar(max)</code></p>

<p>For both of the above if the length of the string is zero then <code>n</code> is set to 1.</p>

<h2>Newer syntax elements.</h2>

<p><strong>1.</strong> The <code>CONCAT</code> function doesn't help here</p>

<pre><code>DECLARE @A5000 VARCHAR(5000) = REPLICATE('A',5000);

SELECT DATALENGTH(@A5000 + @A5000), 
       DATALENGTH(CONCAT(@A5000,@A5000));
</code></pre>

<p>The above returns 8000 for both methods of concatenation.</p>

<p><strong>2.</strong> Be careful with <code>+=</code></p>

<pre><code>DECLARE @A VARCHAR(MAX) = '';

SET @A+= REPLICATE('A',5000) + REPLICATE('A',5000)

DECLARE @B VARCHAR(MAX) = '';

SET @B = @B + REPLICATE('A',5000) + REPLICATE('A',5000)


SELECT DATALENGTH(@A), 
       DATALENGTH(@B);`
</code></pre>

<p>Returns</p>

<pre><code>-------------------- --------------------
8000                 10000
</code></pre>

<p>Note that <code>@A</code> encountered truncation.</p>

<h2>How to resolve the problem you are experiencing.</h2>

<p>You are getting truncation either because you are concatenating two non <code>max</code> datatypes together or because you are concatenating a <code>varchar(4001 - 8000)</code> string to an <code>nvarchar</code> typed string (even <code>nvarchar(max)</code>).</p>

<p>To avoid the second issue simply make sure that all string literals (or at least those with lengths in the 4001 - 8000 range) are prefaced with <code>N</code>. </p>

<p>To avoid the first issue change the assignment from </p>

<pre><code>DECLARE @SQL NVARCHAR(MAX);
SET @SQL = 'Foo' + 'Bar' + ...;
</code></pre>

<p>To</p>

<pre><code>DECLARE @SQL NVARCHAR(MAX) = ''; 
SET @SQL = @SQL + N'Foo' + N'Bar'
</code></pre>

<p>so that an <code>NVARCHAR(MAX)</code> is involved in the concatenation from the beginning (as the result of each concatenation will also be <code>NVARCHAR(MAX)</code> this will propagate)</p>

<h2>Avoiding truncation when viewing</h2>

<p>Make sure you have ""results to grid"" mode selected then you can use</p>

<pre><code>select @SQL as [processing-instruction(x)] FOR XML PATH 
</code></pre>

<p>The SSMS options allow you to set unlimited length for <code>XML</code> results. The <code>processing-instruction</code> bit avoids issues with characters such as <code>&lt;</code> showing up as <code>&amp;lt;</code>.</p>
","12639972"
"Why would I ever pick CHAR over VARCHAR in SQL?","143452","","<p>I realize that CHAR is recommended if all my values are fixed-width. But, so what? Why not just pick VARCHAR for all text fields just to be safe.</p>
","<p>Generally pick <strong>CHAR</strong> if all rows will have close to the <em>same length</em>.  Pick <strong>VARCHAR</strong> when the <em>length varies</em> significantly.  CHAR may also be a bit faster because all the rows are of the same length. </p>

<p>It varies by DB implementation, but generally VARCHAR uses one or two more bytes of storage (for length or termination) in addition to the actual data.  So  (assuming you are using a one byte character set) storing the word ""FooBar"" </p>

<ul>
<li>CHAR(6) = 6 bytes (no overhead)</li>
<li>VARCHAR(10) = 8 bytes (2 bytes of overhead)</li>
<li>CHAR(10) = 10 bytes (4 bytes of overhead)</li>
</ul>

<p>Bottom line is <strong>CHAR</strong> can be <em>faster</em> and more <em>space efficient</em> for data of relatively the same length (within two characters length difference).</p>

<p><strong>Note</strong>: Microsoft SQL has 2 bytes of overhead for a VARCHAR. This may vary from DB to DB, but generally there is at least 1 byte of overhead needed to indicate length or EOL on a VARCHAR.</p>

<p>As was pointed out by Gaven in the comments, if you are using a multi-byte, variable length character set like UTF8 then CHAR stores the maximum number of bytes necessary to store the number of characters. So if UTF8 needs at most 3 bytes to store a character, then CHAR(6) will be fixed at 18 bytes, even if only storing latin1 characters. So in this case VARCHAR becomes a much better choice.</p>
","59686"
"Update query using Subquery in Sql Server","143366","","<p><strong>I have a simple table Structure like this:</strong></p>

<p>Table <strong>tempData</strong></p>

<pre><code>╔══════════╦═══════╗
║   NAME   ║ MARKS ║
╠══════════╬═══════╣
║ Narendra ║    80 ║
║ Ravi     ║    85 ║
║ Sanjay   ║    90 ║
╚══════════╩═══════╝
</code></pre>

<p>And I also have another table names as <strong>tempDataView</strong> like this</p>

<pre><code>╔══════════╦═══════╗
║   NAME   ║ MARKS ║
╠══════════╬═══════╣
║ Narendra ║       ║
║ Narendra ║       ║
║ Narendra ║       ║
║ Narendra ║       ║
║ Ravi     ║       ║
║ Ravi     ║       ║
║ Sanjay   ║       ║
╚══════════╩═══════╝
</code></pre>

<p>I want to update the table <strong>tempDataView</strong> , by setting the <strong>Marks</strong>  according to the <strong>tempDataView</strong> - <strong>Name</strong> compared with <strong>tempData</strong> - <strong>Name</strong></p>

<p>Yes let me show you what I tried, I tried to solve this using the Cursor and its solved perfectly, but I am finding the way to solve it using the <strong>Subquery</strong></p>

<p>Here it is:</p>

<pre><code>Declare @name varchar(50),@marks varchar(50)
Declare @cursorInsert CURSOR
set @cursorInsert = CURSOR FOR
Select name,marks from tempData
OPEN @cursorInsert
FETCH NEXT FROM @cursorInsert
into @name,@marks
WHILE @@FETCH_STATUS = 0
BEGIN
UPDATE tempDataView set marks = @marks where name = @name
FETCH NEXT FROM @cursorInsert
INTO @name,@marks
END
CLOSE @cursorInsert
DEALLOCATE @cursorInsert
</code></pre>

<p>Actually it's like the homework for me to solve it using the Subquery. </p>
","<p>you can join both tables even on <code>UPDATE</code> statements,</p>

<pre><code>UPDATE  a
SET     a.marks = b.marks
FROM    tempDataView a
        INNER JOIN tempData b
            ON a.Name = b.Name
</code></pre>

<ul>
<li><a href=""http://www.sqlfiddle.com/#!6/618f8/1"">SQLFiddle Demo</a></li>
</ul>

<p>for faster performance, define an <code>INDEX</code> on column <code>marks</code> on both tables.</p>

<p>using <code>SUBQUERY</code></p>

<pre><code>UPDATE  tempDataView 
SET     marks = 
        (
          SELECT marks 
          FROM tempData b 
          WHERE tempDataView.Name = b.Name
        )
</code></pre>

<ul>
<li><a href=""http://www.sqlfiddle.com/#!6/ae4b9/1"">SQLFiddle Demo</a></li>
</ul>
","14618713"
"LINQ to Entities does not recognize the method 'System.String ToString()' method, and this method cannot be translated into a store expression","143088","","<p>I'm migrating some stuff from one mysql server to a sql server but i can't figure out how to make this code work:</p>

<pre><code>using (var context = new Context())
{
    ...

    foreach (var item in collection)
    {
        IQueryable&lt;entity&gt; pages = from p in context.pages
                                   where  p.Serial == item.Key.ToString()
                                   select p;
        foreach (var page in pages)
        {
            DataManager.AddPageToDocument(page, item.Value);
        }
    }

    Console.WriteLine(""Done!"");
    Console.Read();
}
</code></pre>

<p>When it enters into the second <code>foreach (var page in pages)</code> it throws an exception saying:</p>

<blockquote>
  <p>LINQ to Entities does not recognize the method 'System.String
  ToString()' method, and this method cannot be translated into a store
  expression.</p>
</blockquote>

<p>Anyone know why this happens?</p>
","<p>Just save the string to a temp variable and then use that in your expression:</p>

<pre><code>var strItem = item.Key.ToString();

IQueryable&lt;entity&gt; pages = from p in context.pages
                           where  p.Serial == strItem
                           select p;
</code></pre>

<p>The problem arises because <code>ToString()</code> isn't really executed, it is turned into a <a href=""https://stackoverflow.com/questions/886822/what-is-a-method-group-in-c"">MethodGroup</a> and then parsed and translated to SQL. Since there is no <code>ToString()</code> equivalent, the expression fails.</p>

<h1>Note:</h1>

<p>Make sure you also check out <a href=""https://stackoverflow.com/questions/5899683/linq-to-entities-does-not-recognize-the-method-system-string-tostring-method/24124190#24124190"">Alex's answer</a> regarding the <code>SqlFunctions</code> helper class that was added later. In many cases it can eliminate the need for the temporary variable.</p>
","5899740"
"Maximum size for a SQL Server Query? IN clause? Is there a Better Approach","143063","","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""https://stackoverflow.com/questions/1069415/t-sql-where-col-in"">T-SQL WHERE col IN (&hellip;)</a>  </p>
</blockquote>

<p>What is the maximum size for a SQL Server query? (# of characters)</p>

<p>Max size for an IN clause? I think I saw something about Oracle having a 1000 item limit but you could get around this with ANDing 2 INs together. Similar issue in SQL Server?</p>

<p><strong>UPDATE</strong>
So what would be the best approach if I need to take say 1000 GUIDs from another system (Non Relational Database) and do a ""JOIN in code' against the SQL Server? Is it to submit the list of 1000 GUIDs to an IN clause?
Or is there another technique that works more efficiently?</p>

<p>I haven't tested this but I wonder if I could submit the GUIDs as an XML doc. For example </p>

<pre><code>&lt;guids&gt;
    &lt;guid&gt;809674df-1c22-46eb-bf9a-33dc78beb44a&lt;/guid&gt;
    &lt;guid&gt;257f537f-9c6b-4f14-a90c-ee613b4287f3&lt;/guid&gt;
&lt;/guids&gt;
</code></pre>

<p>and then do some kind of XQuery JOIN against the Doc and the Table. Less efficient than 1000 item IN clause?</p>
","<p>Every SQL batch has to fit in the <a href=""http://msdn.microsoft.com/en-us/library/ms143432.aspx"" rel=""noreferrer"">Batch Size Limit</a>: 65,536 * Network Packet Size.</p>

<p>Other than that, your query is limited by runtime conditions. It will usually run out of stack size because x IN (a,b,c) is nothing but x=a OR x=b OR x=c which creates an expression tree similar to x=a OR (x=b OR (x=c)), so it gets very deep with a large number of OR. SQL 7 would hit a SO <a href=""http://support.microsoft.com/kb/288095"" rel=""noreferrer"">at about 10k values in the IN</a>, but nowdays stacks are much deeper (because of x64), so it can go pretty deep.</p>

<p><strong>Update</strong></p>

<p>You already found Erland's article on the topic of passing lists/arrays to SQL Server. With SQL 2008 you also have <a href=""http://msdn.microsoft.com/en-us/library/bb675163.aspx"" rel=""noreferrer"">Table Valued Parameters</a> which allow you to pass an entire DataTable as a single table type parameter and join on it. </p>

<p>XML and XPath is another viable solution:</p>

<pre><code>SELECT ...
FROM Table
JOIN (
   SELECT x.value(N'.',N'uniqueidentifier') as guid
   FROM @values.nodes(N'/guids/guid') t(x)) as guids
 ON Table.guid = guids.guid;
</code></pre>
","1869810"
"What datatype to use when storing latitude and longitude data in SQL databases?","143063","","<p>When storing latitude or longitude data in an ANSI SQL compliant database, what datatype would be most appropriate? Should <code>float</code> be used, or <code>decimal</code>, or ...?</p>

<p>I'm aware that Oracle, MySql, and SQL Server have added some special datatypes specifically for handling geo data, but I'm interested in how you would store the information in a ""plain vanilla"" SQL database.</p>
","<p><code>Decimal(9,6)</code></p>

<p>If you're not used to precision and scale parameters, here's a format string visual:</p>

<p><code>###.######</code></p>
","1196429"
"ERROR 1115 (42000): Unknown character set: 'utf8mb4'","142906","","<p>I have a MySQL dump, which I tried to restore with:</p>

<pre><code>mysql -u""username"" -p""password"" --host=""127.0.0.1"" mysql_db &lt; mysql_db
</code></pre>

<p>However, this threw an error:</p>

<pre><code>ERROR 1115 (42000) at line 3231: Unknown character set: 'utf8mb4'
</code></pre>

<p>This is lines 3231-3233: </p>

<pre><code>/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
</code></pre>

<p>I am using MySQL 5.1.69. How can I solve this error?</p>
","<p>Your version does not support that character set, I believe it was <code>5.5.3</code> that introduced it. You should upgrade your mysql to the version you used to export this file.</p>

<p>The error is then quite clear: you set a certain character set in your code, but your mysql version does not support it, and therefore does not know about it.</p>

<p>According to <a href=""https://dev.mysql.com/doc/refman/5.5/en/charset-unicode-utf8mb4.html"" rel=""noreferrer"">https://dev.mysql.com/doc/refman/5.5/en/charset-unicode-utf8mb4.html</a> :</p>

<blockquote>
  <p>utf8mb4 is a superset of utf8</p>
</blockquote>

<p>so maybe there is a chance you can just make it utf8, close your eyes and hope, but that would depend on your data, and I'd not recommend it.</p>
","21929328"
"Using column alias in WHERE clause of MySQL query produces an error","142818","","<p>The query I'm running is as follows, however I'm getting this error:</p>

<blockquote>
  <p>#1054 - Unknown column 'guaranteed_postcode' in 'IN/ALL/ANY subquery'</p>
</blockquote>

<pre><code>SELECT `users`.`first_name`, `users`.`last_name`, `users`.`email`,
SUBSTRING(`locations`.`raw`,-6,4) AS `guaranteed_postcode`
FROM `users` LEFT OUTER JOIN `locations`
ON `users`.`id` = `locations`.`user_id`
WHERE `guaranteed_postcode` NOT IN #this is where the fake col is being used
(
 SELECT `postcode` FROM `postcodes` WHERE `region` IN
 (
  'australia'
 )
)
</code></pre>

<p>My question is: why am I unable to use a fake column in the where clause of the same DB query?</p>
","<p>You can only use column aliases in GROUP BY, ORDER BY, or HAVING clauses.</p>

<blockquote>
  <p>Standard SQL doesn't allow you to
  refer to a column alias in a WHERE
  clause. This restriction is imposed
  because when the WHERE code is
  executed, the column value may not yet
  be determined.</p>
</blockquote>

<p>Copied from <a href=""http://dev.mysql.com/doc/refman/5.0/en/problems-with-alias.html"" rel=""noreferrer"">MySQL documentation</a></p>

<p>As pointed in the comments, using HAVING instead may do the work. Make sure to give a read at this <a href=""https://stackoverflow.com/questions/2905292/where-vs-having/18710763#18710763"">WHERE vs HAVING</a> though.</p>
","942592"
"VARCHAR to DECIMAL","142640","","<p>I want to convert a <code>varchar(max)</code> column to <code>decimal(10,4)</code>. </p>

<p>When I try to use <code>cast</code> or <code>convert</code> I am getting an arithmetic overflow exception. The issue is that the data stored in the varchar column may contain different precisions and different scales. For example, 123456789.1234567', 1.12345678 or 123456.1234.</p>

<p>For values like 123456.1234 it is converting with out any issue but for other values I am having some problems.</p>

<p>Any help would be appreciated.</p>
","<p>Implemented using Custom Function. 
This will check whether the string value can be converted to Decimal safely</p>

<pre><code>CREATE FUNCTION [dbo].[TryParseAsDecimal]
(
    @Value      NVARCHAR(4000)
    ,@Precision INT
    ,@Scale     INT
)

RETURNS BIT
AS
BEGIN

    IF(ISNUMERIC(@Value) =0) BEGIN
        RETURN CAST(0 AS BIT)
    END
    SELECT @Value = REPLACE(@Value,',','') --Removes the comma

    --This function validates only the first part eg '1234567.8901111111'
    --It validates only the values before the '.' ie '1234567.'
    DECLARE @Index          INT
    DECLARE @Part1Length    INT 
    DECLARE @Part1          VARCHAR(4000)   

    SELECT @Index = CHARINDEX('.', @Value, 0)
    IF (@Index&gt;0) BEGIN
        --If decimal places, extract the left part only and cast it to avoid leading zeros (eg.'0000000001' =&gt; '1')
        SELECT @Part1 =LEFT(@Value, @Index-1);
        SELECT @Part1=SUBSTRING(@Part1, PATINDEX('%[^0]%', @Part1+'.'), LEN(@Part1));
        SELECT @Part1Length = LEN(@Part1);
    END
    ELSE BEGIN
        SELECT @Part1 =CAST(@Value AS DECIMAL);
        SELECT @Part1Length= LEN(@Part1)
    END 

    IF (@Part1Length &gt; (@Precision-@Scale)) BEGIN
        RETURN CAST(0 AS BIT)
    END

    RETURN CAST(1 AS BIT)

END
</code></pre>
","11774553"
"How can I insert multiple rows into oracle with a sequence value?","142490","","<p>I know that I can insert multiple rows using a single statement, if I use the syntax in <a href=""https://stackoverflow.com/questions/39576/best-way-to-do-multi-row-insert-in-oracle#39602"">this answer</a>. </p>

<p>However, one of the values I am inserting is taken from a sequence, i.e. </p>

<pre><code>insert into TABLE_NAME
(COL1,COL2)
select MY_SEQ.nextval,'some value' from dual
union all
select MY_SEQ.nextval,'another value' from dual
;
</code></pre>

<p>If I try to run it, I get an ORA-02287 error. Is there any way around this, or should I just use a lot of INSERT statements?</p>

<p>EDIT:<br>
If I have to specify column names for all other columns other than the sequence, I lose the original brevity, so it's just not worth it. In that case I'll just use multiple INSERT statements.</p>
","<p>This works:</p>

<pre><code>insert into TABLE_NAME (COL1,COL2)
select my_seq.nextval, a
from
(SELECT 'SOME VALUE' as a FROM DUAL
 UNION ALL
 SELECT 'ANOTHER VALUE' FROM DUAL)
</code></pre>
","228294"
"SQL join: selecting the last records in a one-to-many relationship","142490","","<p>Suppose I have a table of customers and a table of purchases. Each purchase belongs to one customer. I want to get a list of all customers along with their last purchase in one SELECT statement. What is the best practice? Any advice on building indexes?</p>

<p>Please use these table/column names in your answer:</p>

<ul>
<li>customer: id, name</li>
<li>purchase: id, customer_id, item_id, date</li>
</ul>

<p>And in more complicated situations, would it be (performance-wise) beneficial to denormalize the database by putting the last purchase into the customer table?</p>

<p>If the (purchase) id is guaranteed to be sorted by date, can the statements be simplified by using something like <code>LIMIT 1</code>?</p>
","<p>This is an example of the <code>greatest-n-per-group</code> problem that has appeared regularly on StackOverflow.</p>

<p>Here's how I usually recommend solving it:</p>

<pre><code>SELECT c.*, p1.*
FROM customer c
JOIN purchase p1 ON (c.id = p1.customer_id)
LEFT OUTER JOIN purchase p2 ON (c.id = p2.customer_id AND 
    (p1.date &lt; p2.date OR p1.date = p2.date AND p1.id &lt; p2.id))
WHERE p2.id IS NULL;
</code></pre>

<p>Explanation: given a row <code>p1</code>, there should be no row <code>p2</code> with the same customer and a later date (or in the case of ties, a later <code>id</code>).  When we find that to be true, then <code>p1</code> is the most recent purchase for that customer.</p>

<p>Regarding indexes, I'd create a compound index in <code>purchase</code> over the columns (<code>customer_id</code>, <code>date</code>, <code>id</code>).  That may allow the outer join to be done using a covering index.  Be sure to test on your platform, because optimization is implementation-dependent.  Use the features of your RDBMS to analyze the optimization plan.  E.g. <code>EXPLAIN</code> on MySQL.</p>

<hr>

<p>Some people use subqueries instead of the solution I show above, but I find my solution makes it easier to resolve ties.</p>
","2111420"
"SQL grouping by month and year","142439","","<p>I'm not sure what should I write in the following SQL query to show 'date' column like this: ""month-year"" - ""9-2011"". </p>

<pre><code>SELECT MONTH(date) + '.' + YEAR(date) AS Mjesec, SUM(marketingExpense) AS SumaMarketing, SUM(revenue) AS SumaZarada 
FROM [Order]
WHERE (idCustomer = 1) AND (date BETWEEN '2001-11-3' AND '2011-11-3')
GROUP BY MONTH(date), YEAR(date)
</code></pre>

<p>So, what I want to do is to change the data from the first column to show month and year instead of showing month only.</p>
","<pre><code>SELECT CAST(MONTH(date) AS VARCHAR(2)) + '-' + CAST(YEAR(date) AS VARCHAR(4)) AS Mjesec, SUM(marketingExpense) AS SumaMarketing, SUM(revenue) AS SumaZarada 
FROM [Order]
WHERE (idCustomer = 1) AND (date BETWEEN '2001-11-3' AND '2011-11-3')
GROUP BY CAST(MONTH(date) AS VARCHAR(2)) + '-' + CAST(YEAR(date) AS VARCHAR(4))
</code></pre>

<p>Or as @40-Love mentioned you can cast with leading zeroes:</p>

<pre><code>GROUP BY 
  CAST(YEAR(date) AS VARCHAR(4)) + '-' + right('00' + CAST(MONTH(date) AS VARCHAR(2)), 2) 
</code></pre>
","5406280"
"How to insert a string which contains an ""&""","142430","","<p>How can I write an insert statement which includes the &amp; character?  For example, if I wanted to insert ""J&amp;J Construction"" into a column in the database.</p>

<p>I'm not sure if it makes a difference, but I'm using Oracle 9i.</p>
","<p>I keep on forgetting this and coming back to it again! I think the best answer is a combination of the responses provided so far.</p>

<p>Firstly, &amp; is the variable prefix in sqlplus/sqldeveloper, hence the problem - when it appears, it is expected to be part of a variable name.</p>

<p>SET DEFINE OFF will stop sqlplus interpreting &amp; this way.</p>

<p>But what if you need to use sqlplus variables <em>and</em> literal &amp; characters? </p>

<ul>
<li>You need SET DEFINE ON to make variables work</li>
<li>And SET ESCAPE ON to escape uses of &amp;.</li>
</ul>

<p>e.g.</p>

<pre><code>set define on
set escape on

define myvar=/forth

select 'back\\ \&amp; &amp;myvar' as swing from dual;
</code></pre>

<p>Produces:</p>

<pre><code>old   1: select 'back\\ \&amp; &amp;myvar' from dual
new   1: select 'back\ &amp; /forth' from dual

SWING
--------------
back\ &amp; /forth
</code></pre>

<p>If you want to use a different escape character:</p>

<pre><code>set define on
set escape '#'

define myvar=/forth

select 'back\ #&amp; &amp;myvar' as swing from dual;
</code></pre>

<p>When you set a specific escape character, you may see 'SP2-0272: escape character cannot be alphanumeric or whitespace'. This probably means you already have the escape character defined, and things get horribly self-referential. The clean way of avoiding this problem is to set escape off first:</p>

<pre><code>set escape off
set escape '#'
</code></pre>
","410490"
"How to use SQL LIKE condition with multiple values in PostgreSQL?","142411","","<p>Is there any shorter way to look for multiple matches:</p>

<pre><code> SELECT * 
 from table 
 WHERE column LIKE ""AAA%"" 
    OR column LIKE ""BBB%"" 
    OR column LIKE ""CCC%""
</code></pre>

<p>This questions applies to PostgreSQL 9.1, but if there is a generic solution it would be even better.</p>
","<p>Perhaps using <code>SIMILAR TO</code> would work ?</p>

<pre><code>SELECT * from table WHERE column SIMILAR TO '(AAA|BBB|CCC)%';
</code></pre>
","12958053"
"What's the best way to select the minimum value from several columns?","142299","","<p>Given the following table in SQL Server 2005:</p>

<pre><code>ID   Col1   Col2   Col3
--   ----   ----   ----
1       3     34     76  
2      32    976     24
3       7    235      3
4     245      1    792
</code></pre>

<p>What is the best way to write the query that yields the following result (i.e. one that yields the final column - a column containing the minium values out of Col1, Col2, and Col 3 <strong>for each row</strong>)?</p>

<pre><code>ID   Col1   Col2   Col3  TheMin
--   ----   ----   ----  ------
1       3     34     76       3
2      32    976     24      24
3       7    235      3       3
4     245      1    792       1
</code></pre>

<p><strong><em>UPDATE:</em></strong></p>

<p>For clarification (as I have said in the coments) in the real scenario the database is <strong>properly normalized</strong>. These ""array"" columns are not in an actual table but are in a result set that is required in a report. And the new requirement is that the report also needs this MinValue column. I can't change the underlying result set and therefore I was looking to T-SQL for a handy ""get out of jail card"".</p>

<p>I tried the CASE approach mentioned below and it works, although it is a bit cumbersome. It is also more complicated than stated in the answers because you need to cater for the fact that there are two min values in the same row.</p>

<p>Anyway, I thought I'd post my current solution which, given my constraints, works pretty well. It uses the UNPIVOT operator:</p>

<pre><code>with cte (ID, Col1, Col2, Col3)
as
(
    select ID, Col1, Col2, Col3
    from TestTable
)
select cte.ID, Col1, Col2, Col3, TheMin from cte
join
(
    select
        ID, min(Amount) as TheMin
    from 
        cte 
        UNPIVOT (Amount for AmountCol in (Col1, Col2, Col3)) as unpvt
    group by ID
) as minValues
on cte.ID = minValues.ID
</code></pre>

<p>I'll say upfront that I don't expect this to offer the best performance, but given the circumstances (I can't redesign all the queries just for the new MinValue column requirement), it is a pretty elegant ""get out of jail card"".</p>
","<p>There are likely to be many ways to accomplish this.  My suggestion is to use Case/When to do it.  With 3 columns, it's not too bad. </p>

<pre><code>Select Id,
       Case When Col1 &lt; Col2 And Col1 &lt; Col3 Then Col1
            When Col2 &lt; Col1 And Col2 &lt; Col3 Then Col2 
            Else Col3
            End As TheMin
From   YourTableNameHere
</code></pre>
","368381"
"How do you use script variables in PostgreSQL?","142108","","<p>In MS SQL Server, I create my scripts to use customizable variables:</p>

<pre><code>DECLARE @somevariable int  
SELECT @somevariable = -1

INSERT INTO foo VALUES ( @somevariable )
</code></pre>

<p>I'll then change the value of <code>@somevariable</code> at runtime, depending on the value that I want in the particular situation. Since it's at the top of the script it's easy to see and remember.</p>

<p>How do I do the same with PostgreSQL?</p>

<p>Googling turned up <a href=""http://www.postgresql.org/docs/8.1/static/app-psql.html#APP-PSQL-VARIABLES"" rel=""noreferrer"">PSQL variables</a>, but it's implied that they can only be used <em>within other slash commands</em>, not in actual SQL.</p>

<p>EDIT: Found my own answers, and they're actually fairly complicated. Sort the posts older->newer to follow my discoveries.</p>

<hr>

<p>Found my own answer further down that linked page:</p>

<blockquote>
  <p>An additional useful feature of psql variables is that you can substitute (""interpolate"") them into regular SQL statements.</p>
</blockquote>

<p>I tried this already and got a problem, but this suggests that my problem isn't related to the variable after all. </p>
","<p>Postgres variables are created through the \set command, for example ...</p>

<pre><code>\set myvariable value
</code></pre>

<p>... and can then be substituted, for example, as ...</p>

<pre><code>SELECT * FROM :myvariable.table1;
</code></pre>

<p>... or ...</p>

<pre><code>SELECT * FROM table1 WHERE :myvariable IS NULL;
</code></pre>

<p>... but, if you want to use the variable as the value in a conditional string query, such as ...</p>

<pre><code>SELECT * FROM table1 WHERE column1 = ':myvariable';
</code></pre>

<p>... then you need to include the quotes in the variable itself as the above will not work.  Instead define your variable as such ...</p>

<pre><code>\set myvariable 'value'
</code></pre>

<p>However, if, like me, you ran into a situation in which you wanted to make a string from an existing variable, I found the trick to be this ...</p>

<pre><code>\set quoted_myvariable '\'' :myvariable '\''
</code></pre>

<p>Now you have both a quoted and unquoted variable of the same string!  And you can do something like this ....</p>

<pre><code>INSERT INTO :myvariable.table1 SELECT * FROM table2 WHERE column1 = :quoted_myvariable;
</code></pre>
","3588796"
"Rails raw SQL example","141921","","<p>How can I convert this code to raw sql and use in rails? Because When I deploy this code in heroku,there is a request timeout error.I think this will be faster if I use raw sql.</p>

<pre><code>@payments = PaymentDetail.joins(:project).order('payment_details.created_at desc')
@payment_errors = PaymentError.joins(:project).order('payment_errors.created_at desc')

@all_payments = (@payments + @payment_errors)
</code></pre>
","<p>You can do this:</p>

<pre><code>sql = ""Select * from ... your sql query here""
records_array = ActiveRecord::Base.connection.execute(sql)
</code></pre>

<p><code>records_array</code> would then be the result of your sql query in an array which you can iterate through.</p>
","14840547"
"MySQL SELECT x FROM a WHERE NOT IN ( SELECT x FROM b ) - Unexpected result","141754","","<p>I expect the result of the third query below to contain id=732. It doesn't. Why is that?</p>

<pre>
mysql> SELECT id FROM match ORDER BY id DESC LIMIT 5 ;
+------------+
|         id |
+------------+
|        732 | 
|        730 | 
|        655 | 
|        458 | 
|        456 | 
+------------+
5 rows in set (0.00 sec)

mysql> SELECT id FROM email ORDER BY id DESC LIMIT 5 ;
+------------+
|         id |
+------------+
|        731 | 
|        727 | 
|        725 | 
|        724 | 
|        723 | 
+------------+
5 rows in set (0.00 sec)

mysql> SELECT * FROM match WHERE id NOT IN ( SELECT id FROM email ) ;
Empty set (0.00 sec)
</pre>

<p>There are three NULL entries in table email.id, and no NULL entries in match.id.</p>

<p>The full table / queries can be seen at <a href=""http://pastebin.ca/1462094"" rel=""noreferrer""><a href=""http://pastebin.ca/1462094"" rel=""noreferrer"">http://pastebin.ca/1462094</a></a></p>
","<p>From <a href=""http://dev.mysql.com/doc/refman/5.0/en/comparison-operators.html"" rel=""noreferrer""><strong>documentation</strong></a>:</p>

<blockquote>
  <p>To comply with the <code>SQL</code> standard, <code>IN</code>  returns <code>NULL</code> not only if the expression on the left hand side is <code>NULL</code>, but also if no match is found in the list and one of the expressions in the list is <code>NULL</code>.</p>
</blockquote>

<p>This is exactly your case.</p>

<p>Both <code>IN</code> and <code>NOT IN</code> return <code>NULL</code> which is not an acceptable condition for <code>WHERE</code> clause.</p>

<p>Rewrite your query as follows:</p>

<pre><code>SELECT  *
FROM    match m
WHERE   NOT EXISTS
        (
        SELECT  1
        FROM    email e
        WHERE   e.id = m.id
        )
</code></pre>
","1001197"
"Creating new table with SELECT INTO in SQL","141689","","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""https://stackoverflow.com/questions/2250196/select-into-using-oracle"">SELECT INTO using Oracle</a>  </p>
</blockquote>



<p>I have came across <code>SQL SELECT INTO</code> statement for creating new table and also dumping old table records into new table in single SQL statement as</p>

<pre><code>  SELECT * INTO NEW_TABLE FROM OLD_TABLE;
</code></pre>

<p>But when i am trying the above query it is giving error as <code>ORA-00905: missing keyword</code></p>

<p>Is it possible to do that in ORACLE ?</p>

<p>Thanks.</p>
","<p>The syntax for creating a new table is</p>

<pre><code>CREATE TABLE new_table
AS
SELECT *
  FROM old_table
</code></pre>

<p>This will create a new table named <code>new_table</code> with whatever columns are in <code>old_table</code> and copy the data over.  It will not replicate the constraints on the table, it won't replicate the storage attributes, and it won't replicate any triggers defined on the table.</p>

<p><code>SELECT INTO</code> is used in PL/SQL when you want to fetch data from a table into a local variable in your PL/SQL block.</p>
","11892168"
"TSQL CASE with if comparison in SELECT statement","141623","","<p>I would like to use CASE statement in SELECT.</p>

<p>I select from user table, and (as one attribute) I also use nested SQL:</p>

<pre><code>SELECT 
   registrationDate, 
   (SELECT COUNT(*) FROM Articles WHERE userId = Users.userId) as articleNumber, 
   hobbies, ...
FROM USERS
</code></pre>

<p>and then I would like to do a CASE statement to get rank of user (rank is dependent on articleNumber).</p>

<p>I tried like this:</p>

<pre><code>SELECT 
   registrationDate, 
   (SELECT COUNT(*) FROM Articles WHERE Articles.userId = Users.userId) as articleNumber, 
   ranking =
      CASE
         WHEN articleNumber &lt; 2 THEN 'Ama'
         WHEN articleNumber &lt; 5 THEN 'SemiAma' 
         WHEN articleNumber &lt; 7 THEN 'Good'  
         WHEN articleNumber &lt; 9 THEN 'Better' 
         WHEN articleNumber &lt; 12 THEN 'Best'
         ELSE 'Outstanding'
      END,
   hobbies, etc...
FROM USERS
</code></pre>

<p>Parsing displays no error, but when I try to run it I get error:</p>

<blockquote>
  <p><em>Msg 207, Level 16, State 1, Procedure GetUserList, Line XY<br>
  Invalid column name 'articleNumber'.</em></p>
</blockquote>

<p>CASE doesn't ""recognize"" my nested SELECT, I guess.</p>

<p>I helped myself with some other solutions like
<a href=""https://stackoverflow.com/questions/1122557/sql-server-2008-case-if-statements-in-select-clause"">SQL Server 2008 - Case / If statements in SELECT Clause</a>
but nothing seems to work.</p>

<p>I also didn't find any similar problem with '&lt;' and '>' comparison.</p>

<p>Any help would be greatly appreciated ;)</p>
","<p>Please select the same in the outer select. You can't access the alias name in the same query.</p>

<pre><code>SELECT *, (CASE
        WHEN articleNumber &lt; 2 THEN 'Ama'
        WHEN articleNumber &lt; 5 THEN 'SemiAma' 
        WHEN articleNumber &lt; 7 THEN 'Good'  
        WHEN articleNumber &lt; 9 THEN 'Better' 
        WHEN articleNumber &lt; 12 THEN 'Best'
        ELSE 'Outstanding'
        END) AS ranking 
FROM(
    SELECT registrationDate, (SELECT COUNT(*) FROM Articles WHERE Articles.userId = Users.userId) as articleNumber, 
    hobbies, etc...
    FROM USERS
)x
</code></pre>
","14231408"
"how to get the 30 days before date from Todays Date","141443","","<p>How do you get the 30 days before today in SQL.</p>
","<p><strong>T-SQL</strong></p>

<pre><code>declare @thirtydaysago datetime
declare @now datetime
set @now = getdate()
set @thirtydaysago = dateadd(day,-30,@now)

select @now, @thirtydaysago
</code></pre>

<p>or more simply</p>

<pre><code>select dateadd(day, -30, getdate())
</code></pre>

<p>(<a href=""http://msdn.microsoft.com/en-us/library/ms186819.aspx"" rel=""noreferrer"">DATEADD on BOL/MSDN</a>)</p>

<p><strong>MYSQL</strong></p>

<pre><code>SELECT DATE_ADD(NOW(), INTERVAL -30 DAY)
</code></pre>

<p>(<a href=""http://www.electrictoolbox.com/date-add-mysql-intervals-dates/"" rel=""noreferrer""> more DATE_ADD examples on ElectricToolbox.com</a>)</p>
","2833251"
"Best way to strip html tags from a string in sql server?","141441","","<p>I've got data in SQL Server 2005 that contains html tags and I'd like to strip all that out, leaving just the text between the tags. Ideally also replacing things like &amp;lt; with &lt;, etc.</p>

<p>Is there an easy way to do this or has someone already got some sample sql code?</p>

<p>I don't have the ability to add extended stored procs and the like, so would prefer a pure sql approach (preferably one backwards compatible with sql 2000). I want to retrieve the data with stripped out html, not update it, so ideally it would be written as a function to make for easy reuse.</p>

<p>So for example converting this: </p>

<pre><code>&lt;B&gt;Some useful text&lt;/B&gt;&amp;nbsp;
&lt;A onclick=""return openInfo(this)"" href=""http://there.com/3ce984e88d0531bac5349"" target=globalhelp&gt;
   &lt;IMG title=""Source Description"" height=15 alt=""Source Description"" src=""/ri/new_info.gif"" width=15 align=top border=0&gt;
&lt;/A&gt;&amp;gt;&amp;nbsp;&lt;b&gt;more text&lt;/b&gt;&lt;/TD&gt;&lt;/TR&gt;
</code></pre>

<p>to this: </p>

<pre><code>Some useful text &gt; more text
</code></pre>
","<p>There is a UDF that will do that described here: </p>

<p><a href=""http://blog.sqlauthority.com/2007/06/16/sql-server-udf-user-defined-function-to-strip-html-parse-html-no-regular-expression/"" rel=""noreferrer"">User Defined Function to Strip HTML</a></p>

<pre><code>CREATE FUNCTION [dbo].[udf_StripHTML] (@HTMLText VARCHAR(MAX))
RETURNS VARCHAR(MAX) AS
BEGIN
    DECLARE @Start INT
    DECLARE @End INT
    DECLARE @Length INT
    SET @Start = CHARINDEX('&lt;',@HTMLText)
    SET @End = CHARINDEX('&gt;',@HTMLText,CHARINDEX('&lt;',@HTMLText))
    SET @Length = (@End - @Start) + 1
    WHILE @Start &gt; 0 AND @End &gt; 0 AND @Length &gt; 0
    BEGIN
        SET @HTMLText = STUFF(@HTMLText,@Start,@Length,'')
        SET @Start = CHARINDEX('&lt;',@HTMLText)
        SET @End = CHARINDEX('&gt;',@HTMLText,CHARINDEX('&lt;',@HTMLText))
        SET @Length = (@End - @Start) + 1
    END
    RETURN LTRIM(RTRIM(@HTMLText))
END
GO
</code></pre>

<p>Edit: note this is for SQL Server 2005, but if you change the keyword MAX to something like 4000, it will work in SQL Server 2000 as well.</p>
","457725"
"SQL keys, MUL vs PRI vs UNI","141391","","<p>What is the difference between MUL, PRI and UNI in MySQL?</p>

<p>I'm working on a MySQL query, using the command:</p>

<pre><code>desc mytable; 
</code></pre>

<p>One of the fields is shown as being a <code>MUL</code> key, others show up as UNI or PRI.</p>

<p>I know that if a key is PRI, only one record per table can be associated with that key. If a key is MUL, does that mean that there could be more than one associated record?</p>

<p>Here's the response of mytable.</p>

<pre><code>+-----------+---------+------+-----+---------+-------+
| Field     | Type    | Null | Key | Default | Extra |
+-----------+---------+------+-----+---------+-------+
| courseid  | int(11) | YES  | MUL | NULL    |       | 
| dept      | char(3) | YES  |     | NULL    |       | 
| coursenum | char(4) | YES  |     | NULL    |       | 
+-----------+---------+------+-----+---------+-------+
</code></pre>
","<p>It means that the field is (part of) a non-unique index. You can issue </p>

<pre><code>show create table &lt;table&gt;;
</code></pre>

<p>To see more information about the table structure.</p>
","5318278"
"How can I determine the status of a job?","141235","","<p>I have a Stored procedure which schedules a job. This Job takes a lot of time to get completed (approx 30 to 40 min). I need to get to know the status of this Job.
Below details would help me</p>

<p>1) How to see the list of all jobs that have got scheduled for a future time and are yet to start</p>

<p>2) How to see the the list of jobs running and the time span from when they are running</p>

<p>3) How to see if the job has completed successfully or has stoped in between because of any error.</p>
","<p>You could try using the system stored procedure sp_help_job. This returns information on the job, its steps, schedules and servers. For example</p>

<pre><code>EXEC msdb.dbo.sp_help_job @Job_name = 'Your Job Name'
</code></pre>

<p><a href=""http://msdn.microsoft.com/en-us/library/ms186722(SQL.90).aspx"" rel=""noreferrer"">SQL Books Online</a> should contain lots of information about the records it returns.</p>

<p>For returning information on multiple jobs, you could try querying the following system tables which hold the various bits of information on the job</p>

<ul>
<li>msdb.dbo.SysJobs</li>
<li>msdb.dbo.SysJobSteps</li>
<li>msdb.dbo.SysJobSchedules </li>
<li>msdb.dbo.SysJobServers </li>
<li>msdb.dbo.SysJobHistory</li>
</ul>

<p>Their names are fairly self-explanatory (apart from SysJobServers which hold information on when the job last run and the outcome).</p>

<p>Again, information on the fields can be found at MSDN. For example, check out the page for <a href=""http://msdn.microsoft.com/en-us/library/ms189817.aspx"" rel=""noreferrer"">SysJobs</a></p>
","200280"
"Best way to work with transactions in MS SQL Server Management Studio","140982","","<p>Let's say I have an SQL statement that's syntactically and semantically correct so it executes. </p>

<p>In Management Studio (or any other query tool) how can I test SQL statements, and if I notice that they broke something, rollback (in a separate query?)</p>
","<p>The easisest thing to do is to wrap your code in a transaction, and then execute each batch of T-SQL code line by line.</p>

<p>For example,</p>

<pre><code>Begin Transaction

         -Do some T-SQL queries here.

Rollback transaction -- OR commit transaction
</code></pre>

<p>If you want to incorporate error handling you can do so by using a TRY...CATCH BLOCK. Should an error occur you can then rollback the tranasction within the catch block.</p>

<p>For example:</p>

<pre><code>USE AdventureWorks;
GO
BEGIN TRANSACTION;

BEGIN TRY
    -- Generate a constraint violation error.
    DELETE FROM Production.Product
    WHERE ProductID = 980;
END TRY
BEGIN CATCH
    SELECT 
        ERROR_NUMBER() AS ErrorNumber
        ,ERROR_SEVERITY() AS ErrorSeverity
        ,ERROR_STATE() AS ErrorState
        ,ERROR_PROCEDURE() AS ErrorProcedure
        ,ERROR_LINE() AS ErrorLine
        ,ERROR_MESSAGE() AS ErrorMessage;

    IF @@TRANCOUNT &gt; 0
        ROLLBACK TRANSACTION;
END CATCH;

IF @@TRANCOUNT &gt; 0
    COMMIT TRANSACTION;
GO
</code></pre>

<p>See the following link for more details.</p>

<p><a href=""http://msdn.microsoft.com/en-us/library/ms175976.aspx"" rel=""noreferrer"">http://msdn.microsoft.com/en-us/library/ms175976.aspx</a></p>

<p>Hope this helps but please let me know if you need more details. </p>
","506638"
"Oracle Differences between NVL and Coalesce","140820","","<p>Are there non obvious differences between NVL and Coalesce in Oracle?</p>

<p>The obvious differences are that coalesce will return the first non null item in its parameter list whereas nvl only takes two parameters and returns the first if it is not null, otherwise it returns the second.</p>

<p>It seems that NVL may just be a 'Base Case"" version of coalesce.</p>

<p>Am I missing something?</p>
","<p><code>COALESCE</code> is more modern function that is a part of <code>ANSI-92</code> standard.</p>

<p><code>NVL</code> is <code>Oracle</code> specific, it was introduced in <code>80</code>'s before there were any standards.</p>

<p>In case of two values, they are synonyms.</p>

<p>However, they are implemented differently.</p>

<p><code>NVL</code> always evaluates both arguments, while <code>COALESCE</code> stops evaluation whenever it finds first non-<code>NULL</code>:</p>

<pre><code>SELECT  SUM(val)
FROM    (
        SELECT  NVL(1, LENGTH(RAWTOHEX(SYS_GUID()))) AS val
        FROM    dual
        CONNECT BY
                level &lt;= 10000
        )
</code></pre>

<p>This runs for almost <code>0.5</code> seconds, since it generates <code>SYS_GUID()</code>'s, despite <code>1</code> being not a <code>NULL</code>.</p>

<pre><code>SELECT  SUM(val)
FROM    (
        SELECT  COALESCE(1, LENGTH(RAWTOHEX(SYS_GUID()))) AS val
        FROM    dual
        CONNECT BY
                level &lt;= 10000
        )
</code></pre>

<p>This understands that <code>1</code> is not a <code>NULL</code> and does not evaluate the second argument.</p>

<p><code>SYS_GUID</code>'s are not generated and the query is instant.</p>
","950103"
"update one table with data from another","140786","","<p>Table 1:</p>

<pre><code>id    name    desc
-----------------------
1     a       abc
2     b       def
3     c       adf
</code></pre>

<p>Table 2:</p>

<pre><code>id    name    desc
-----------------------
1     x       123
2     y       345
</code></pre>

<p>How do I run an <strong>sql update</strong> query that can update Table 1 with Table 2's name and desc using the same id? So the end result I would get is</p>

<p>Table 1:</p>

<pre><code>id    name    desc
-----------------------
1     x       123
2     y       345
3     c       adf
</code></pre>

<p>How can this be done for:</p>

<ul>
<li>SQL Server</li>
<li>MySQL</li>
<li>PostgreSQL</li>
<li>Oracle</li>
</ul>
","<p>For MySql:</p>

<pre><code>UPDATE table1 JOIN table2 
    ON table1.id = table2.id
SET table1.name = table2.name,
    table1.`desc` = table2.`desc`
</code></pre>

<p>For Sql Server:</p>

<pre><code>UPDATE   table1
SET table1.name = table2.name,
    table1.[desc] = table2.[desc]
FROM table1 JOIN table2 
   ON table1.id = table2.id
</code></pre>
","5036926"
"Is it possible to use the SELECT INTO clause with UNION [ALL]?","140735","","<p>In SQL Server this inserts 100 records, from the Customers table into tmpFerdeen  :-</p>

<pre><code>SELECT top(100)*
INTO tmpFerdeen
FROM Customers
</code></pre>

<p>Is it possible to do a SELECT INTO across a UNION ALL SELECT :-</p>

<pre><code>SELECT top(100)* 
FROM Customers
UNION All
SELECT top(100)* 
FROM CustomerEurope
UNION All
SELECT top(100)* 
FROM CustomerAsia
UNION All
SELECT top(100)* 
FROM CustomerAmericas
</code></pre>

<p>Not too sure where to add the INTO clause.</p>
","<p>This works in SQL Server:</p>

<pre><code>SELECT * INTO tmpFerdeen FROM (
  SELECT top 100 * 
  FROM Customers
  UNION All
  SELECT top 100 * 
  FROM CustomerEurope
  UNION All
  SELECT top 100 * 
  FROM CustomerAsia
  UNION All
  SELECT top 100 * 
  FROM CustomerAmericas
) as tmp
</code></pre>
","591426"
"Select row with most recent date per user","140548","","<p>I have a table (""lms_attendance"") of users' check-in and out times that looks like this:</p>

<pre><code>id  user    time    io (enum)
1   9   1370931202  out
2   9   1370931664  out
3   6   1370932128  out
4   12  1370932128  out
5   12  1370933037  in
</code></pre>

<p>I'm trying to create a view of this table that would output only the most recent record per user id, while giving me the ""in"" or ""out"" value, so something like:</p>

<pre><code>id  user    time    io
2   9   1370931664  out
3   6   1370932128  out
5   12  1370933037  in
</code></pre>

<p>I'm pretty close so far, but I realized that views won't accept subquerys, which is making it a lot harder. The closest query I got was :</p>

<pre><code>select 
    `lms_attendance`.`id` AS `id`,
    `lms_attendance`.`user` AS `user`,
    max(`lms_attendance`.`time`) AS `time`,
    `lms_attendance`.`io` AS `io` 
from `lms_attendance` 
group by 
    `lms_attendance`.`user`, 
    `lms_attendance`.`io`
</code></pre>

<p>But what I get is :</p>

<pre><code>id  user    time    io
3   6   1370932128  out
1   9   1370931664  out
5   12  1370933037  in
4   12  1370932128  out
</code></pre>

<p>Which is close, but not perfect. I know that last group by shouldn't be there, but without it, it returns the most recent time, but not with it's relative IO value.</p>

<p>Any ideas?
Thanks!</p>
","<p>Query:</p>

<p><strong><a href=""http://sqlfiddle.com/#!2/e353d/1"">SQLFIDDLEExample</a></strong></p>

<pre><code>SELECT t1.*
FROM lms_attendance t1
WHERE t1.time = (SELECT MAX(t2.time)
                 FROM lms_attendance t2
                 WHERE t2.user = t1.user)
</code></pre>

<p>Result:</p>

<pre><code>| ID | USER |       TIME |  IO |
--------------------------------
|  2 |    9 | 1370931664 | out |
|  3 |    6 | 1370932128 | out |
|  5 |   12 | 1370933037 |  in |
</code></pre>

<p>Solution which gonna work everytime:</p>

<p><strong><a href=""http://sqlfiddle.com/#!2/dbb2d/7"">SQLFIDDLEExample</a></strong></p>

<pre><code>SELECT t1.*
FROM lms_attendance t1
WHERE t1.id = (SELECT t2.id
                 FROM lms_attendance t2
                 WHERE t2.user = t1.user            
                 ORDER BY t2.id DESC
                 LIMIT 1)
</code></pre>
","17038582"
"SQL select max(date) and corresponding value","140481","","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""https://stackoverflow.com/questions/376518/how-to-get-the-record-of-a-table-who-contains-the-maximum-value"">How to get the record of a table who contains the maximum value?</a>  </p>
</blockquote>



<p>I've got an aggregate query like the following:</p>

<pre><code>SELECT TrainingID, Max(CompletedDate) as CompletedDate, Max(Notes) as Notes     --This will only return the longest notes entry
FROM HR_EmployeeTrainings ET
WHERE (ET.AvantiRecID IS NULL OR ET.AvantiRecID = @avantiRecID)
GROUP BY AvantiRecID, TrainingID            
</code></pre>

<p>Which is working, and returns correct data most of the time, but I noticed a problem.  The Notes field which gets returned will not necessarily match the record that the max(completedDate) is from.  Instead it will be the one with the longest string?  Or the one with the highest ASCII value?  What does SQL Server do in the event of a tie between two records?  I'm not even sure.  What I want to get is the notes field from the max(completedDate) record.  How should I got about doing this?</p>
","<p>You can use a subquery.  The subquery will get the <code>Max(CompletedDate)</code>. You then take this value and join on your table again to retrieve the note associate with that date:</p>

<pre><code>select ET1.TrainingID,
  ET1.CompletedDate,
  ET1.Notes
from HR_EmployeeTrainings ET1
inner join
(
  select Max(CompletedDate) CompletedDate, TrainingID
  from HR_EmployeeTrainings
  --where AvantiRecID IS NULL OR AvantiRecID = @avantiRecID
  group by TrainingID
) ET2
  on ET1.TrainingID = ET2.TrainingID
  and ET1.CompletedDate = ET2.CompletedDate
where ET1.AvantiRecID IS NULL OR ET1.AvantiRecID = @avantiRecID
</code></pre>
","12942388"
"Search and replace part of string in database","140388","","<p>I need to replace all iframe tags, stored as nvarchar in my database. I can find the entries using the following sql-question:</p>

<pre><code>SELECT * FROM databasename..VersionedFields WHERE Value LIKE '%&lt;iframe%'
</code></pre>

<p>Say I want to replace the following code segment:</p>

<pre><code>code before iframe &lt;iframe src=""yadayada""&gt; &lt;/iframe&gt; code after iframe
</code></pre>

<p>With this:</p>

<pre><code>code before iframe &lt;a&gt;iframe src=""yadayada""&lt;/a&gt; code after iframe
</code></pre>
","<p>I think 2 update calls should do</p>

<pre><code>update VersionedFields
set Value = replace(value,'&lt;iframe','&lt;a&gt;&lt;iframe')

update VersionedFields
set Value = replace(value,'&gt; &lt;/iframe&gt;','&lt;/a&gt;')
</code></pre>
","605816"
"SQL Server: Extract Table Meta-Data (description, fields and their data types)","140159","","<p>I am trying to find a way to extract information about my tables in SQL Server (2008).<br>
The data I need needs to include the <strong>description of the table</strong> (filled from the Description property in the Properties Window), a <strong>list of fields</strong> of that table and their respective <strong>data types</strong>.</p>

<p>Is there any way I can extract such meta-data?  I presume I have to use some <code>sys</code> sp but I'n not sure which one. </p>
","<p>To get the description data, you unfortunately have to use sysobjects/syscolumns to get the ids:</p>

<pre><code>SELECT      u.name + '.' + t.name AS [table],
            td.value AS [table_desc],
            c.name AS [column],
            cd.value AS [column_desc]
FROM        sysobjects t
INNER JOIN  sysusers u
    ON      u.uid = t.uid
LEFT OUTER JOIN sys.extended_properties td
    ON      td.major_id = t.id
    AND     td.minor_id = 0
    AND     td.name = 'MS_Description'
INNER JOIN  syscolumns c
    ON      c.id = t.id
LEFT OUTER JOIN sys.extended_properties cd
    ON      cd.major_id = c.id
    AND     cd.minor_id = c.colid
    AND     cd.name = 'MS_Description'
WHERE t.type = 'u'
ORDER BY    t.name, c.colorder
</code></pre>

<p>You can do it with info-schema, but you'd have to concatenate etc to call OBJECT_ID() - so what would be the point?</p>
","887414"
"SQL get the last date time record","139835","","<p>I'm trying to get the last datetime record from a table that happens to store multiple status.
My table looks like so:</p>

<pre><code>+---------+------------------------+-------+
|filename |Dates                   |Status |
+---------+------------------------+-------+
|abc.txt  |2012-02-14 12:04:45.397 |Open   |
|abc.txt  |2012-02-14 12:14:20.997 |Closed |
|abc.txt  |2013-02-14 12:20:59.407 |Open   |
|dfg.txt  |2012-02-14 12:14:20.997 |Closed |
|dfg.txt  |2013-02-14 12:20:59.407 |Open   |
+---------+------------------------+-------+
</code></pre>

<p>The results should be </p>

<pre><code>+---------+------------------------+-------+
|filename |Dates                   |Status |
+---------+------------------------+-------+
|abc.txt  |2013-02-14 12:20:59.407 |Open   |
|dfg.txt  |2013-02-14 12:20:59.407 |Open   |
+---------+------------------------+-------+
</code></pre>
","<p>If you want one row for each filename, reflecting a specific states and listing the most recent date then this is your friend:</p>

<pre><code>select filename ,
       status   ,
       max_date = max( dates )
from some_table t
group by filename , status
having status = '&lt;your-desired-status-here&gt;'
</code></pre>

<p>Easy!</p>
","16551939"
"Difference between drop table and truncate table?","139614","","<p>I have some tables that I build as a part of my report rollup. I don't need them afterwards at all. Someone mentioned to truncate them as it would be faster. </p>
","<p>Deleting records from a table logs every deletion and executes delete triggers for the records deleted. Truncate is a more powerful command that empties a table without logging each row. SQL Server prevents you from truncating a table with foreign keys referencing it, because of the need to check the foreign keys on each row.</p>

<p>Truncate is normally ultra-fast, ideal for cleaning out data from a temporary table. It does preserve the structure of the table for future use.</p>

<p>If you actually want to remove the table <em>definitions</em> as well as the data, simply drop the tables.</p>

<p>See <a href=""http://msdn.microsoft.com/en-us/library/aa260621(SQL.80).aspx"" rel=""noreferrer"">this MSDN article</a> for more info</p>
","135692"
"SQL Case Statement Syntax?","139560","","<p>What is the <strong>complete</strong> and correct syntax for the SQL Case statement?</p>
","<p>The <strong>complete</strong> syntax depends on the database engine you're working with:</p>

<p>For SQL Server:</p>

<pre><code>CASE case-expression
    WHEN when-expression-1 THEN value-1
  [ WHEN when-expression-n THEN value-n ... ]
  [ ELSE else-value ]
END
</code></pre>

<p>or:</p>

<pre><code>CASE
    WHEN boolean-when-expression-1 THEN value-1
  [ WHEN boolean-when-expression-n THEN value-n ... ]
  [ ELSE else-value ]
END
</code></pre>

<p>expressions, etc:</p>

<pre><code>case-expression    - something that produces a value
when-expression-x  - something that is compared against the case-expression
value-1            - the result of the CASE statement if:
                         the when-expression == case-expression
                      OR the boolean-when-expression == TRUE
boolean-when-exp.. - something that produces a TRUE/FALSE answer
</code></pre>

<p>Link: <a href=""http://msdn.microsoft.com/en-us/library/ms181765.aspx"" rel=""noreferrer"">CASE (Transact-SQL)</a></p>

<p>Also note that the ordering of the WHEN statements is important. You can easily write multiple WHEN clauses that overlap, and <strong>the first one that matches is used</strong>.</p>

<p><strong>Note</strong>: If no ELSE clause is specified, and no matching WHEN-condition is found, the value of the CASE expression will be <em>NULL</em>.</p>
","4626"
"MySQL Query to select data from last week?","139344","","<p>Hi I have a table with a date field and some other information.
I want to select all entries from the past week, (week start from Sunday).</p>

<p>table values:</p>

<pre><code>id  date
2   2011-05-14 09:17:25
5   2011-05-16 09:17:25
6   2011-05-17 09:17:25
8   2011-05-20 09:17:25
15  2011-05-22 09:17:25
</code></pre>

<p>I want to select all ids from last week, expected output is 5, 6, 8.
<em>(id 2 not in last week, and id 15 is in current week.)</em></p>

<p>How to write and SQL Query for the same.</p>
","<pre><code>SELECT id FROM tbl
WHERE date &gt;= curdate() - INTERVAL DAYOFWEEK(curdate())+6 DAY
AND date &lt; curdate() - INTERVAL DAYOFWEEK(curdate())-1 DAY
</code></pre>
","6090065"
"List columns with indexes in PostgreSQL","139324","","<p>I would like to get the columns that an index is on in PostgreSQL. </p>

<p>In MySQL you can use <code>SHOW INDEXES FOR table</code> and look at the <code>Column_name</code> column. </p>

<pre><code>mysql&gt; show indexes from foos;

+-------+------------+---------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+
| Table | Non_unique | Key_name            | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment |
+-------+------------+---------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+
| foos  |          0 | PRIMARY             |            1 | id          | A         |       19710 |     NULL | NULL   |      | BTREE      |         | 
| foos  |          0 | index_foos_on_email |            1 | email       | A         |       19710 |     NULL | NULL   | YES  | BTREE      |         | 
| foos  |          1 | index_foos_on_name  |            1 | name        | A         |       19710 |     NULL | NULL   |      | BTREE      |         | 
+-------+------------+---------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+
</code></pre>

<p>Does anything like this exist for PostgreSQL?</p>

<p>I've tried <code>\d</code> at the <code>psql</code> command prompt (with the <code>-E</code> option to show SQL) but it doesn't show the information I'm looking for.</p>

<p><strong>Update:</strong> Thanks to everyone who added their answers. <a href=""https://stackoverflow.com/users/48044/cope360"">cope360</a> gave me exactly what I was looking for, but several people chimed in with very useful links. For future reference, check out the documentation for <a href=""http://www.postgresql.org/docs/current/static/catalog-pg-index.html"" rel=""noreferrer"">pg_index</a> (via <a href=""https://stackoverflow.com/users/15785/milen-a-radev"">Milen A. Radev</a>) and the very useful article <a href=""http://www.alberton.info/postgresql_meta_info.html"" rel=""noreferrer"">Extracting META information from PostgreSQL</a> (via <a href=""https://stackoverflow.com/users/22595/michal-niklas"">Michał Niklas</a>).</p>
","<p>Create some test data...</p>

<pre><code>create table test (a int, b int, c int, constraint pk_test primary key(a, b));
create table test2 (a int, b int, c int, constraint uk_test2 unique (b, c));
create table test3 (a int, b int, c int, constraint uk_test3b unique (b), constraint uk_test3c unique (c),constraint uk_test3ab unique (a, b));
</code></pre>

<p>List indexes and columns indexed:</p>

<pre><code>select
    t.relname as table_name,
    i.relname as index_name,
    a.attname as column_name
from
    pg_class t,
    pg_class i,
    pg_index ix,
    pg_attribute a
where
    t.oid = ix.indrelid
    and i.oid = ix.indexrelid
    and a.attrelid = t.oid
    and a.attnum = ANY(ix.indkey)
    and t.relkind = 'r'
    and t.relname like 'test%'
order by
    t.relname,
    i.relname;

 table_name | index_name | column_name
------------+------------+-------------
 test       | pk_test    | a
 test       | pk_test    | b
 test2      | uk_test2   | b
 test2      | uk_test2   | c
 test3      | uk_test3ab | a
 test3      | uk_test3ab | b
 test3      | uk_test3b  | b
 test3      | uk_test3c  | c
</code></pre>

<p>Roll up the column names:</p>

<pre><code>select
    t.relname as table_name,
    i.relname as index_name,
    array_to_string(array_agg(a.attname), ', ') as column_names
from
    pg_class t,
    pg_class i,
    pg_index ix,
    pg_attribute a
where
    t.oid = ix.indrelid
    and i.oid = ix.indexrelid
    and a.attrelid = t.oid
    and a.attnum = ANY(ix.indkey)
    and t.relkind = 'r'
    and t.relname like 'test%'
group by
    t.relname,
    i.relname
order by
    t.relname,
    i.relname;

 table_name | index_name | column_names
------------+------------+--------------
 test       | pk_test    | a, b
 test2      | uk_test2   | b, c
 test3      | uk_test3ab | a, b
 test3      | uk_test3b  | b
 test3      | uk_test3c  | c
</code></pre>
","2213199"
"varbinary to string on SQL Server","139292","","<p>How to convert a column value from <code>varbinary(max)</code> to <code>varchar</code> in human-readable form?</p>
","<p>Can you just cast it? This works for me.</p>

<pre><code>declare @b varbinary(max)
set @b = 0x5468697320697320612074657374

select cast(@b as varchar(max)) /*Returns ""This is a test""*/
</code></pre>
","3290170"
"#1062 - Duplicate entry for key 'PRIMARY'","139282","","<p>So my MySQL database is behaving a little bit wierd. This is my table:</p>

<pre><code>Name shares id  price   indvprc
cat   2     4   81      0
goog  4     4   20      20
fb    4     9   20      20
</code></pre>

<p>I'm getting this #1062 error when I try to insert into the table. So I looked into it further and realized that when I try to insert values into the table, in which the name and shares values are the same, it will return the #1062 error. For example, If i inserted: </p>

<pre><code>fb    4      6     20   20 
</code></pre>

<p>It would return an error. But if i changed the shares number to 6, it would run fine. Is it because of one of my columns that could be unique, or is it just something with mysql?</p>
","<p>You need to remove <code>shares</code> as your <code>PRIMARY KEY</code> OR <code>UNIQUE_KEY</code></p>
","11638600"
"How to use table variable in a dynamic sql statement?","139102","","<p>In my stored procedure I declared two table variables on top of my procedure. Now I am trying to use that table variable within a dynamic sql statement but I get this error at the time of execution of that procedure. I am using Sql Server 2008.</p>

<p>This is how my query looks like, </p>

<pre><code>set @col_name =  'Assoc_Item_' 
              + Convert(nvarchar(2), @curr_row1);

set @sqlstat = 'update @RelPro set ' 
             + @col_name 
             + ' = (Select relsku From @TSku Where tid = ' 
             + Convert(nvarchar(2), @curr_row1) + ') Where RowID = ' 
             + Convert(nvarchar(2), @curr_row);

Exec(@sqlstat);
</code></pre>

<p>And I get the following errors, </p>

<p>Must declare the table variable ""@RelPro"".
Must declare the table variable ""@TSku"".</p>

<p>I have tried to take the table outside of the string block of dynamic query but to no avail.</p>
","<p>Your EXEC executes in a different context, therefore it is not aware of any variables that have been declared in your original context. You should be able to use a temp table instead of a table variable as shown in the simple demo below.</p>

<pre><code>create table #t (id int)

declare @value nchar(1)
set @value = N'1'

declare @sql nvarchar(max)
set @sql = N'insert into #t (id) values (' + @value + N')'

exec (@sql)

select * from #t

drop table #t
</code></pre>
","4626369"
"Detect if value is number in MySQL","138986","","<p>Is there a way to detect if a value is a number in a MySQL query?</p>

<p>e.g., <code>SELECT * FROM myTable WHERE isANumber(col1)=true</code></p>
","<p>This should work in most cases.</p>

<pre><code>SELECT * FROM myTable WHERE concat('',col1 * 1) = col1
</code></pre>

<p>It doesn't work for non-standard numbers like</p>

<ul>
<li><code>1e4</code></li>
<li><code>1.2e5</code></li>
<li><code>123.</code>  (trailing decimal)</li>
</ul>
","5065007"
"SQL INSERT INTO from multiple tables","138961","","<p>this is my table 1:</p>

<pre><code>NAME       AGE        SEX        CITY             ID

Clara      22         f          New York         1
Bob        33         m          Washington       2
Sam        25         m          Boston           3
</code></pre>

<p>this is my table 2:</p>

<pre><code>NUMBER       ID
555-1111     1
555-2222     2
555-3333     3
</code></pre>

<p>and now I want a table 3 which shows me all information:</p>

<pre><code>NAME       AGE        SEX        CITY             ID        NUMBER

Clara      22         f          New York         1         555-1111
Bob        33         m          Washington       2         555-2222
Sam        25         m          Boston           3         555-3333
</code></pre>

<p>I tried first to insert into table 3 only the values from table 1 and then I inserted into table 3 the values from table 2 with an inner join where Id = Id is.</p>

<pre><code>INSERT INTO table3 { name, age, sex, city, id}
SELECT name, age, sex, city, id
FROM table 1



INSERT INTO table3 { name, age, sex, city, id, number}
SELECT name, age, sex, city, id, number
FROM table 2 p
INNER JOIN table 3 c ON c.Id = p.Id
</code></pre>

<p>But all I get is a duplication of my values. instead of having 3 entries, I have like 9 entries, which some have number null, some have only the number and the rest null, and some are correct.</p>

<p>I hope someone can help me</p>

<p><strong>EDIT</strong></p>

<p>If I am having now a third Table like this one:</p>

<pre><code>NATIONALITY       ID

Canadian          1
American          2
French            3
</code></pre>

<p>How could I merge all 3 tables into one Table?</p>
","<p>You only need one INSERT:</p>

<pre><code>INSERT INTO table3 ( name, age, sex, city, id, number, nationality)
SELECT name, age, sex, city, p.id, number, n.nationality
FROM table1 p
INNER JOIN table2 c ON c.Id = p.Id
</code></pre>
","20404789"
"How to detect if a string contains special characters?","138632","","<p>How to detect if a string contains special characters like #,$,^,&amp;,*,@,! etc in SQL server 2005?</p>
","<p>Assuming SQL Server:</p>

<p>e.g. if you class special characters as anything NOT alphanumeric:</p>

<pre><code>DECLARE @MyString VARCHAR(100)
SET @MyString = 'adgkjb$'

IF (@MyString LIKE '%[^a-zA-Z0-9]%')
    PRINT 'Contains ""special"" characters'
ELSE
    PRINT 'Does not contain ""special"" characters'
</code></pre>

<p>Just add to other characters you don't class as special, inside the square brackets</p>
","2558794"
"SQL Server replace, remove all after certain character","138551","","<p>My data looks like</p>

<pre><code>ID    MyText
1     some text; some more text
2     text again; even more text
</code></pre>

<p>How can I update MyText to drop everything after the semi-colon and including the semi colon, so I'm left with the following:</p>

<pre><code>ID    MyText
1     some text
2     text again
</code></pre>

<p>I've looked at <a href=""http://msdn.microsoft.com/en-us/library/ms186862.aspx"" rel=""noreferrer"">SQL Server Replace</a>, but can't think of a viable way of checking for the "";""</p>
","<p>Use LEFT combined with CHARINDEX:</p>

<pre><code>UPDATE MyTable
SET MyText = LEFT(MyText, CHARINDEX(';', MyText) - 1)
WHERE CHARINDEX(';', MyText) &gt; 0
</code></pre>

<p>Note that the WHERE clause skips updating rows in which there is no semicolon.</p>

<p>Here is some code to verify the SQL above works:</p>

<pre><code>declare @MyTable table ([id] int primary key clustered, MyText varchar(100))
insert into @MyTable ([id], MyText)
select 1, 'some text; some more text'
union all select 2, 'text again; even more text'
union all select 3, 'text without a semicolon'
union all select 4, null -- test NULLs
union all select 5, '' -- test empty string
union all select 6, 'test 3 semicolons; second part; third part;'
union all select 7, ';' -- test semicolon by itself    

UPDATE @MyTable
SET MyText = LEFT(MyText, CHARINDEX(';', MyText) - 1)
WHERE CHARINDEX(';', MyText) &gt; 0

select * from @MyTable
</code></pre>

<p>I get the following results:</p>

<pre><code>id MyText
-- -------------------------
1  some text
2  text again
3  text without a semicolon
4  NULL
5        (empty string)
6  test 3 semicolons
7        (empty string)
</code></pre>
","1668059"
"Get 2 Digit Number For The Month","138546","","<p>I have an integer column ""Month""
I would like to get 2 digit number for month.</p>

<p>This is what I have tried: DATEPART(mm, @Date)</p>

<p>It returns one digit for months January to September
I am using SQL Server 2008</p>

<p>Anyone has suggestion?</p>
","<p>there are different ways of doing it </p>

<ul>
<li>Using <strong>RTRIM</strong> and specifing the <strong>range</strong>:</li>
</ul>

<p>like </p>

<pre><code>SELECT RIGHT('0' + RTRIM(MONTH('12-31-2012')), 2); 
</code></pre>

<ul>
<li>Using <strong>Substring</strong> to just extract the <strong>month part</strong> after converting the date into text</li>
</ul>

<p>like</p>

<pre><code>SELECT SUBSTRING(CONVERT(nvarchar(6),getdate(), 112),5,2)
</code></pre>

<p>see <a href=""http://sqlfiddle.com/#!3/d41d8/9158"" rel=""noreferrer"">Fiddle</a></p>

<p>There may be other ways to get this.</p>
","14976342"
"SQL LEFT JOIN Subquery Alias","138528","","<p>I'm running this SQL query:</p>

<pre><code>SELECT wp_woocommerce_order_items.order_id As No_Commande
FROM  wp_woocommerce_order_items
LEFT JOIN 
    (
        SELECT meta_value As Prenom
        FROM wp_postmeta
        WHERE meta_key = '_shipping_first_name'
    ) AS a
ON wp_woocommerce_order_items.order_id = a.post_id
WHERE  wp_woocommerce_order_items.order_id =2198
</code></pre>

<p>And I get this error:</p>

<blockquote>
  <p>#1054 - Unknown column 'a.post_id' in 'on clause'.</p>
</blockquote>

<p>I think my code is pretty simple, but I can't make it right. What am I doing wrong? </p>
","<p>You didn't select <code>post_id</code> in the subquery. You have to select it in the subquery like this:</p>

<pre><code>SELECT wp_woocommerce_order_items.order_id As No_Commande
FROM  wp_woocommerce_order_items
LEFT JOIN 
    (
        SELECT meta_value As Prenom, post_id  -- &lt;----- this
        FROM wp_postmeta
        WHERE meta_key = '_shipping_first_name'
    ) AS a
ON wp_woocommerce_order_items.order_id = a.post_id
WHERE  wp_woocommerce_order_items.order_id =2198 
</code></pre>
","16776190"
"How to get next/previous record in MySQL?","138486","","<p>Say I have records with IDs 3,4,7,9 and I want to be able to go from one to another by navigation via next/previous links. The problem is, that I don't know how to fetch record with nearest higher ID.</p>

<p>So when I have a record with ID 4, I need to be able to fetch next existing record, which would be 7. The query would probably look something like</p>

<pre><code>SELECT * FROM foo WHERE id = 4 OFFSET 1
</code></pre>

<p><strong>How can I fetch next/previous record without fetching the whole result set and manually iterating?</strong></p>

<p>I'm using MySQL 5.</p>
","<p>next:</p>

<pre><code>select * from foo where id = (select min(id) from foo where id &gt; 4)
</code></pre>

<p>previous:</p>

<pre><code>select * from foo where id = (select max(id) from foo where id &lt; 4)
</code></pre>
","1446831"
"Time part of a DateTime Field in SQL","138471","","<p>How would I be able to extract the time part of a DateTime field in SQL? For my  project I have to return data that has a timestamp of 5pm of a DateTime field no matter what the date is</p>
","<p>In SQL Server if you need only the <code>hh:mi</code>, you can use:</p>

<pre><code>DECLARE @datetime datetime

SELECT @datetime = GETDATE()

SELECT RIGHT('0'+CAST(DATEPART(hour, @datetime) as varchar(2)),2) + ':' +
       RIGHT('0'+CAST(DATEPART(minute, @datetime)as varchar(2)),2)
</code></pre>
","12354784"
"How can i rollback my last delete command in mysql?","138369","","<p>I accidentally deleted some huge no. of rows from a table..</p>

<p>How can I roll it back ?</p>

<p>I executed the query using the putty ...</p>

<p>I'll be grateful if any of you can guide me safely out of this..</p>
","<p>if you haven't made a backup, you are pretty much fudged.</p>
","2356579"
"How to do a case sensitive search in WHERE clause (I'm using SQL Server)?","138122","","<p>I want to do a case sensitive search in my SQL query. But by default, SQL Server does not consider the case of the strings.</p>

<p>Any idea on how to do a case sensitive search in SQL query?</p>
","<p>Can be done via <a href=""http://vyaskn.tripod.com/case_sensitive_search_in_sql_server.htm"" rel=""noreferrer"">changing the Collation</a>. By default it is case insensitive.</p>

<p>Excerpt from the link:</p>

<pre><code>SELECT 1
FROM dbo.Customers
WHERE   CustID = @CustID COLLATE SQL_Latin1_General_CP1_CS_AS
    AND CustPassword = @CustPassword COLLATE SQL_Latin1_General_CP1_CS_AS
</code></pre>
","1831120"
"How to use the ConfigurationManager.AppSettings","137893","","<p>I've never used the ""appSettings"" before. How do you configure this in C# to use with a SqlConnection, this is what I use for the ""ConnectionStrings""</p>

<pre><code>        SqlConnection con = new SqlConnection();
        con.ConnectionString = ConfigurationManager.ConnectionStrings[""ConnectionString""].ConnectionString;
</code></pre>

<p>And this is what I have for the ""appSettings""</p>

<pre><code>        SqlConnection con = new SqlConnection();
        con = ConfigurationManager.AppSettings(""ConnectionString"");
</code></pre>

<p>but it is not working.</p>
","<p>ConfigurationManager.AppSettings is actually a property, so you need to use square brackets.</p>

<p>Overall, here's what you need to do:</p>

<pre><code>    SqlConnection con = new SqlConnection(ConfigurationManager.AppSettings[""ConnectionString""]);
</code></pre>

<p>The problem is that you tried to set con to a string, which is not correct.
You have to either pass it to the constructor or set con.ConnectionString property.</p>
","7069964"
"Is it necessary to use # for creating temp tables in SQL server?","137499","","<p>Is it necessary to use <code>#</code> before creating a temporary table in SQL server?</p>

<p>Example:</p>

<pre><code>SELECT column1, column2, someInt, someVarChar 
INTO ItemBack1 
FROM table2
WHERE table2.ID = 7
</code></pre>

<p>For ItemBack1 is it necessary to use the <code>#</code> symbol? </p>

<p>If not, then what is the use of <code>#</code> in creating temp tables?</p>
","<p>Yes. You need to prefix the table name with ""#"" (hash) to create temporary tables.</p>

<p>If you do NOT need the table later, go ahead &amp; create it.
     Temporary Tables are very much like normal tables. However, it gets created in tempdb.
Also, it is only accessible via the current session i.e. For EG: if another user tries to access the temp table created by you, he'll not be able to do so.</p>

<p>""##"" (double-hash creates ""Global"" temp table that can be accessed by other sessions as well.</p>

<p>Refer the below link for the Basics of Temporary Tables:
<a href=""http://www.codeproject.com/Articles/42553/Quick-Overview-Temporary-Tables-in-SQL-Server-2005"" rel=""noreferrer"">http://www.codeproject.com/Articles/42553/Quick-Overview-Temporary-Tables-in-SQL-Server-2005</a></p>

<p>If the content of your table is less than 5000 rows &amp; does NOT contain data types such as nvarchar(MAX), varbinary(MAX), consider using Table Variables.</p>

<p><s>They are the fastest as they are just like any other variables which are stored in the RAM.</s> <a href=""https://dba.stackexchange.com/questions/16385/whats-the-difference-between-a-temp-table-and-table-variable-in-sql-server/16386#16386"">They are stored in tempdb as well, not in RAM</a>.</p>

<pre><code>DECLARE @ItemBack1 TABLE
(
 column1 int,
 column2 int,
 someInt int,
 someVarChar nvarchar(50)
);

INSERT INTO @ItemBack1
SELECT column1, 
       column2, 
       someInt, 
       someVarChar 
  FROM table2
 WHERE table2.ID = 7;
</code></pre>

<p>More Info on Table Variables:
<a href=""http://odetocode.com/articles/365.aspx"" rel=""noreferrer"">http://odetocode.com/articles/365.aspx</a></p>
","16750130"
"What's faster, SELECT DISTINCT or GROUP BY in MySQL?","137254","","<p>If I have a table</p>

<pre><code>CREATE TABLE users (
  id int(10) unsigned NOT NULL auto_increment,
  name varchar(255) NOT NULL,
  profession varchar(255) NOT NULL,
  employer varchar(255) NOT NULL,
  PRIMARY KEY  (id)
)
</code></pre>

<p>and I want to get all unique values of <code>profession</code> field, what would be faster (or recommended):</p>

<pre><code>SELECT DISTINCT u.profession FROM users u
</code></pre>

<p>or</p>

<pre><code>SELECT u.profession FROM users u GROUP BY u.profession
</code></pre>

<p>?</p>
","<p>They are essentially equivalent to each other (in fact this is how some databases implement <code>DISTINCT</code> under the hood).</p>

<p>If one of them is faster, it's going to be <code>DISTINCT</code>.  This is because, although the two are the same, a query optimizer would have to catch the fact that your <code>GROUP BY</code> is not taking advantage of any group members, just their keys. <code>DISTINCT</code> makes this explicit, so you can get away with a slightly dumber optimizer.</p>

<p>When in doubt, test!</p>
","581530"
"Retrieve the maximum length of a VARCHAR column in SQL Server","137221","","<p>I want to find the longest <code>VARCHAR</code> in a specific column of a SQL Server table.</p>

<p>Here's an example:</p>

<pre><code>ID = INT IDENTITY
DESC = VARCHAR(5000)

ID | Desc
---|-----
1  | a
2  | aaa
3  | aa
</code></pre>

<p>What's the SQL to return 3? Since the longest value is 3 characters?</p>
","<p>use the build-in functions for length and max on the description column:</p>

<pre><code>select max(len(Desc)) from table_name
</code></pre>

<p>Note that if youre table is very big, then there can be some performance issues :)</p>
","9592297"
"How do you list the primary key of a SQL Server table?","137196","","<p>Simple question, how do you list the primary key of a table with T-SQL? I know how to get indexes on a table, but can't remember how to get the PK.</p>
","<pre><code>SELECT Col.Column_Name from 
    INFORMATION_SCHEMA.TABLE_CONSTRAINTS Tab, 
    INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE Col 
WHERE 
    Col.Constraint_Name = Tab.Constraint_Name
    AND Col.Table_Name = Tab.Table_Name
    AND Constraint_Type = 'PRIMARY KEY'
    AND Col.Table_Name = '&lt;your table name&gt;'
</code></pre>
","96049"
"Return number of rows affected by UPDATE statements","137092","","<p>How can I get the number of rows affected by an UPDATE query in a Stored Procedure (SQL Server 2005), as a resultset. e.g.</p>

<pre><code>CREATE PROCEDURE UpdateTables
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON;

    UPDATE Table1 Set Column = 0 WHERE Column IS NULL
    UPDATE Table2 Set Column = 0 WHERE Column IS NULL
    UPDATE Table3 Set Column = 0 WHERE Column IS NULL
    UPDATE Table4 Set Column = 0 WHERE Column IS NULL
END
</code></pre>

<p>Then return:</p>

<pre><code>Table1    Table2    Table3    Table4
32        45        0         3
</code></pre>
","<pre><code>CREATE PROCEDURE UpdateTables
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON;
    DECLARE @RowCount1 INTEGER
    DECLARE @RowCount2 INTEGER
    DECLARE @RowCount3 INTEGER
    DECLARE @RowCount4 INTEGER

    UPDATE Table1 Set Column = 0 WHERE Column IS NULL
    SELECT @RowCount1 = @@ROWCOUNT
    UPDATE Table2 Set Column = 0 WHERE Column IS NULL
    SELECT @RowCount2 = @@ROWCOUNT
    UPDATE Table3 Set Column = 0 WHERE Column IS NULL
    SELECT @RowCount3 = @@ROWCOUNT
    UPDATE Table4 Set Column = 0 WHERE Column IS NULL
    SELECT @RowCount4 = @@ROWCOUNT

    SELECT @RowCount1 AS Table1, @RowCount2 AS Table2, @RowCount3 AS Table3, @RowCount4 AS Table4
END
</code></pre>
","1103272"
"Restore DB — Error RESTORE HEADERONLY is terminating abnormally. ","137062","","<p>I have taken backup of SQL Server 2008 DB on server, and download them to local environment.</p>

<p>I am trying to restore that database and it is keep on giving me following error.</p>

<blockquote>
  <hr>
  
  <p>An exception occurred while executing
  a Transact-SQL statement or batch.
  (Microsoft.SqlServer.ConnectionInfo)</p>
  
  <p>------------------------------ ADDITIONAL INFORMATION:</p>
  
  <p>The media family on device
  'C:\go4sharepoint_1384_8481.bak' is
  incorrectly formed. SQL Server cannot
  process this media family. RESTORE
  HEADERONLY is terminating abnormally.
  (Microsoft SQL Server, Error: 3241)</p>
  
  <p>For help, click:
  <a href=""http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;ProdVer=09.00.4053&amp;EvtSrc=MSSQLServer&amp;EvtID=3241&amp;LinkId=20476"">http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;ProdVer=09.00.4053&amp;EvtSrc=MSSQLServer&amp;EvtID=3241&amp;LinkId=20476</a></p>
</blockquote>

<p>I have tried to create a temp DB on server and tried to restore the same backup file and that works.  I have also tried no. of times downloading file from server to local pc using different options on Filezila (Auto, Binary)</p>

<p>But its not working.  After that I tried to execute following command on server.</p>

<pre><code>BACKUP DATABASE go4sharepoint_1384_8481 
TO DISK=' C:\HostingSpaces\dbname_jun14_2010_new.bak' with FORMAT
</code></pre>

<p>It is giving me following error:</p>

<blockquote>
  <p>Msg 3201, Level 16, State 1, Line 1 Cannot open backup device
  'c:\Program Files\Microsoft SQL
  Server\MSSQL10.SQLEXPRESS\MSSQL\Backup\
  C:\HostingSpaces\dbname_jun14_2010_new.bak'. Operating system error
  123(The filename, directory name, or volume label syntax is
  incorrect.). Msg 3013, Level 16, State 1, Line 1 BACKUP DATABASE is
  terminating abnormally.</p>
</blockquote>

<p>After researching I found the following 2 useful links: </p>

<ol>
<li><a href=""http://support.microsoft.com/kb/290787"">http://support.microsoft.com/kb/290787</a></li>
<li><a href=""http://social.msdn.microsoft.com/Forums/en-US/sqlsetupandupgrade/thread/4d5836f6-be65-47a1-ad5d-c81caaf1044f"">http://social.msdn.microsoft.com/Forums/en-US/sqlsetupandupgrade/thread/4d5836f6-be65-47a1-ad5d-c81caaf1044f</a></li>
</ol>

<p>But I am still not able to restore Database correctly.</p>

<p>Any help would be much appreciated.  Thanks.</p>
","<p>You can check out this blog post. It had solved my problem.</p>

<p><a href=""http://dotnetguts.blogspot.com/2010/06/restore-failed-for-server-restore.html"" rel=""noreferrer"">http://dotnetguts.blogspot.com/2010/06/restore-failed-for-server-restore.html</a></p>

<blockquote>
  <p><strong>Select @@Version</strong> <br />
  It had given me following output Microsoft SQL Server
  2005 - 9.00.4053.00 (Intel X86) May 26 2009 14:24:20 Copyright (c)
  1988-2005 Microsoft Corporation Express Edition on Windows NT 6.0
  (Build 6002: Service Pack 2)</p>
</blockquote>

<p>You will need to re-install to a new named instance to ensure that you are using the new SQL Server version.</p>
","3172066"
"Sql Server : How to use an aggregate function like MAX in a WHERE clause","136977","","<p>I want get the maximum value for this record. Please help me:</p>

<pre><code>SELECT rest.field1 
    FROM mastertable AS m
    INNER JOIN  (
        SELECT t1.field1 field1, 
               t2.field2
            FROM table1 AS T1 
            INNER JOIN table2 AS t2 ON t2.field = t1.field 
            WHERE t1.field3=MAX(t1.field3)
        --                  ^^^^^^^^^^^^^^  Help me here.
    ) AS rest ON rest.field1 = m.field
</code></pre>
","<p>You could use a sub query...</p>

<pre><code>WHERE t1.field3 = (SELECT MAX(st1.field3) FROM table1 AS st1)
</code></pre>

<p>But I would actually move this out of the where clause and into the join statement, as an AND for the ON clause.</p>
","1475606"
"Passing a varchar full of comma delimited values to a SQL Server IN function","136681","","<blockquote>
  <p><strong>Duplicate of</strong><br>
  <a href=""https://stackoverflow.com/questions/517028/dynamic-sql-comma-delimited-value-query"">Dynamic SQL Comma Delimited Value Query</a><br>
  <a href=""https://stackoverflow.com/questions/303149/parameterized-queries-with-like-and-in-conditions"">Parameterized Queries with Like and In</a> </p>
</blockquote>

<p>I have a SQL Server Stored Procedure where I would like to pass a <code>varchar</code> full of comma delimited values to an <code>IN</code> function. For example:</p>

<pre><code>DECLARE @Ids varchar(50);
SET @Ids = '1,2,3,5,4,6,7,98,234';

SELECT * 
FROM sometable 
WHERE tableid IN (@Ids);
</code></pre>

<p>This does not work of course. I get the error:</p>

<blockquote>
  <p>Conversion failed when converting the varchar value '1,2,3,5,4,6,7,98,234' to data type int.</p>
</blockquote>

<p>How can I accomplish this (or something relatively similar) without resorting to building dynamic SQL?</p>
","<p><strong>Don't use a function that loops to split a string!</strong>, my function below will split a string very fast, with no looping!</p>

<p>Before you use my function, you need to set up a ""helper"" table, you only need to do this one time per database:</p>

<pre><code>CREATE TABLE Numbers
(Number int  NOT NULL,
    CONSTRAINT PK_Numbers PRIMARY KEY CLUSTERED (Number ASC)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
DECLARE @x int
SET @x=0
WHILE @x&lt;8000
BEGIN
    SET @x=@x+1
    INSERT INTO Numbers VALUES (@x)
END
</code></pre>

<p>use this function to split your string, which does not loop and is very fast:</p>

<pre><code>CREATE FUNCTION [dbo].[FN_ListToTable]
(
     @SplitOn              char(1)              --REQUIRED, the character to split the @List string on
    ,@List                 varchar(8000)        --REQUIRED, the list to split apart
)
RETURNS
@ParsedList table
(
    ListValue varchar(500)
)
AS
BEGIN

/**
Takes the given @List string and splits it apart based on the given @SplitOn character.
A table is returned, one row per split item, with a column name ""ListValue"".
This function workes for fixed or variable lenght items.
Empty and null items will not be included in the results set.


Returns a table, one row per item in the list, with a column name ""ListValue""

EXAMPLE:
----------
SELECT * FROM dbo.FN_ListToTable(',','1,12,123,1234,54321,6,A,*,|||,,,,B')

    returns:
        ListValue  
        -----------
        1
        12
        123
        1234
        54321
        6
        A
        *
        |||
        B

        (10 row(s) affected)

**/



----------------
--SINGLE QUERY-- --this will not return empty rows
----------------
INSERT INTO @ParsedList
        (ListValue)
    SELECT
        ListValue
        FROM (SELECT
                  LTRIM(RTRIM(SUBSTRING(List2, number+1, CHARINDEX(@SplitOn, List2, number+1)-number - 1))) AS ListValue
                  FROM (
                           SELECT @SplitOn + @List + @SplitOn AS List2
                       ) AS dt
                      INNER JOIN Numbers n ON n.Number &lt; LEN(dt.List2)
                  WHERE SUBSTRING(List2, number, 1) = @SplitOn
             ) dt2
        WHERE ListValue IS NOT NULL AND ListValue!=''



RETURN

END --Function FN_ListToTable
</code></pre>

<p>you can use this function as a table in a join:</p>

<pre><code>SELECT
    Col1, COl2, Col3...
    FROM  YourTable
        INNER JOIN FN_ListToTable(',',@YourString) s ON  YourTable.ID = s.ListValue
</code></pre>

<p>Here is your example:</p>

<pre><code>Select * from sometable where tableid in(SELECT ListValue FROM dbo.FN_ListToTable(',',@Ids) s)
</code></pre>
","878964"
"How to do a Postgresql subquery in select clause with join in from clause like SQL Server?","136407","","<p>I am trying to write the following query on postgresql:</p>

<pre><code>select name, author_id, count(1), 
    (select count(1)
    from names as n2
    where n2.id = n1.id
        and t2.author_id = t1.author_id
    )               
from names as n1
group by name, author_id
</code></pre>

<p>This would certainly work on Microsoft SQL Server but it does not at all on postegresql. I read its documentation a bit and it seems I could rewrite it as:</p>

<pre><code>select name, author_id, count(1), total                     
from names as n1, (select count(1) as total
    from names as n2
    where n2.id = n1.id
        and n2.author_id = t1.author_id
    ) as total
group by name, author_id
</code></pre>

<p>But that returns the following error on postegresql: ""subquery in FROM cannot refer to other relations of same query level"". So I'm stuck. Does anyone know how I can achieve that?</p>

<p>Thanks</p>
","<p>I'm not sure I understand your intent perfectly, but perhaps the following would be close to what you want:</p>

<pre><code>select n1.name, n1.author_id, count_1, total_count
  from (select id, name, author_id, count(1) as count_1
          from names
          group by id, name, author_id) n1
inner join (select id, author_id, count(1) as total_count
              from names
              group by id, author_id) n2
  on (n2.id = n1.id and n2.author_id = n1.author_id)
</code></pre>

<p>Unfortunately this adds the requirement of grouping the first subquery by id as well as name and author_id, which I don't think was wanted.  I'm not sure how to work around that, though, as you need to have id available to join in the second subquery.  Perhaps someone else will come up with a better solution.</p>

<p>Share and enjoy.</p>
","3005314"
"SQL: Alias Column Name for Use in CASE Statement","136178","","<p>Is it possible to alias a column name and then use that in a CASE statement? For example,</p>

<pre><code>SELECT col1 as a, CASE WHEN a = 'test' THEN 'yes' END as value FROM table;
</code></pre>

<p>I am trying to alias the column because actually my CASE statement would be generated programmatically, and I want the column that the case statement uses to be specified in the SQL instead of having to pass another parameter to the program.</p>
","<p>I think that MySql and MsSql won't allow this because they will try to find all columns in the CASE clause as columns of the tables in the WHERE clause.</p>

<p>I don't know what DBMS you are talking about, but I guess you could do something like this in any DBMS:</p>

<pre><code>SELECT *, CASE WHEN a = 'test' THEN 'yes' END as value FROM (
   SELECT col1 as a FROM table
) q
</code></pre>
","1583625"
"How to export all data from table to an insertable sql format?","136151","","<p>I have a Table (call it <code>A_table</code>) in a database (call it <code>A_db</code>) in Microsoft SQL Server Management Studio, and there are 10 rows.</p>

<p>I have another database (call it <code>B_db</code>), and it has a Table (call it <code>B_table</code>), which has the same column settings as <code>A_table</code> has. But the <code>B_table</code> is empty.</p>

<p>What I want:</p>

<ul>
<li><strong>Copy</strong> every rows from <code>A_table</code> to <code>B_table</code>.</li>
</ul>

<p>Is there any option in <strong>Microsoft SQL Server Management Studio 2012</strong>, to create an insert SQL from a table? Or is there any other option to do that?</p>
","<p>Quick and Easy way:</p>

<ol>
<li>Right click database</li>
<li>Point to <code>tasks</code></li>
<li>Select <code>generate scripts</code></li>
<li>Click next</li>
<li>Choose tables</li>
<li>Click next</li>
<li>Click advanced</li>
<li>Scroll to <code>data to script</code> - Called <code>types of data to script</code> in SMSS 2014 Thanks to <a href=""https://stackoverflow.com/users/1861513/ellesedil"">Ellesedil</a> for commenting</li>
<li>Select <code>data only</code></li>
<li>Click on 'Ok' to close the advanced script options window</li>
<li>Click next and generate your script</li>
</ol>

<p>I usually in cases like this generate to a new query editor window and then just do any modifications where needed.</p>
","20543132"
"Inner Joining three tables","136125","","<p>I have three tables I wish to inner join by a common column between them.</p>

<p>Say my tables are;</p>

<pre><code>TableA TableB TableC
</code></pre>

<p>I wish to join <code>A-B</code>, but then also <code>B-C</code> all by this common field I will call common.</p>

<p>I have joined two tables like this;</p>

<pre><code>dbo.tableA AS A INNER JOIN dbo.TableB AS B
ON A.common = B.common
</code></pre>

<p>How do I add the third one?</p>
","<pre><code>select *
from
    tableA a
        inner join
    tableB b
        on a.common = b.common
        inner join 
    TableC c
        on b.common = c.common
</code></pre>
","11824531"
"How to fill DataTable with SQL Table","136041","","<p>I am currently creating and reading a DataTable with the following code in my Page_Load</p>

<pre><code>protected void Page_Load(object sender, EventArgs e)
{
    if (Session[""AllFeatures1""] == null)
    {
        Session[""AllFeatures1""] = GetData();
    }
    table = (DataTable)Session[""AllFeatures1""];
    DayPilotCalendar1.DataSource = Session[""AllFeatures1""];
    DayPilotNavigator1.DataSource = Session[""AllFeatures1""];

    if (!IsPostBack)
    {
        DataBind();
        DayPilotCalendar1.UpdateWithMessage(""Welcome!"");
    }

    if (User.Identity.Name != """")
    {
        Panel1.Visible = true;
    }
}
</code></pre>

<p>I would like to know how to convert this code so that it reads from a SQL query? I am experimenting with the code below but I'm not sure how to connect them so that datatable in my page load fills with the SQL command below.</p>

<pre><code>SqlConnection conn = new SqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings[""BarManConnectionString""].ConnectionString);
conn.Open();
string query = ""SELECT * FROM [EventOne]"";

SqlCommand cmd = new SqlCommand(query, conn);

DataTable t1 = new DataTable();
using (SqlDataAdapter a = new SqlDataAdapter(cmd))
{
    a.Fill(t1);
}
</code></pre>
","<p>You need to modify the method <code>GetData()</code> and add your ""experimental"" code there.. and return <code>t1</code>..</p>

<p>Done.</p>
","11993309"
"Inserting values into tables Oracle SQL","135809","","<p>I'm trying to insert values into an 'Employee' table in Oracle SQL. I have a question regarding inputting values determined by a foreign key:</p>

<p>My employees have 3 attributes that are determined by foreign keys: State, Position, &amp; Manager. I am using an <code>INSERT INTO</code> statement to insert the values and manually typing in the data. Do I need to physically look up each reference to input the data or is there a command that I can use? E.g. </p>

<pre><code>INSERT INTO Employee 
(emp_id, emp_name, emp_address, emp_state, emp_position, emp_manager)
VALUES 
(001, ""John Doe"", ""1 River Walk, Green Street"", 3, 5, 1000)
</code></pre>

<p>This should populate the employee table with <code>(John Doe, 1 River Walk, Green Street, New York, Sales Executive, Barry Green)</code>. New York is <code>state_id=3</code> in the <code>State</code> table; Sales executive is <code>position_id=5</code> in the <code>positions</code> table; and Barry Green is <code>manager_id=1000</code> in the <code>manager</code> table.</p>

<p>Is there a way in which I can input the text values of the referenced tables, so that Oracle will recognise the text and match it with the relevant ID? I hope this question makes sense will be happy to clarify anything.</p>

<p>Thanks!</p>
","<p>You can expend the following function in order to pull out more parameters from the DB before the insert:</p>

<pre><code>--
-- insert_employee  (Function) 
--
CREATE OR REPLACE FUNCTION insert_employee(p_emp_id in number, p_emp_name in varchar2, p_emp_address in varchar2, p_emp_state in varchar2, p_emp_position in varchar2, p_emp_manager in varchar2) 
RETURN VARCHAR2 AS

   p_state_id varchar2(30) := '';
 BEGIN    
      select state_id 
      into   p_state_id
      from states where lower(emp_state) = state_name;

      INSERT INTO Employee (emp_id, emp_name, emp_address, emp_state, emp_position, emp_manager) VALUES 
                (p_emp_id, p_emp_name, p_emp_address, p_state_id, p_emp_position, p_emp_manager);

    return 'SUCCESS';

 EXCEPTION 
   WHEN others THEN
    RETURN 'FAIL';
 END;
/
</code></pre>
","10422169"
"How to generate the whole database script in MySQL Workbench?","135695","","<p>I want to take the whole database. Where do I find the database file?</p>

<p>And is there a way to write the whole database with all data to a text file (like the one in SQL Server)?</p>
","<p>Q#1: I would guess that it's somewhere on your MySQL server?
Q#2: Yes, this is possible. You have to establish a connection via Server Administration. There you can clone any table or the entire database.</p>

<p><a href=""https://web.archive.org/web/20101119071045/http://database.blogs.webucator.com/2010/11/05/creating-database-backups-in-mysql-workbench/"" rel=""nofollow noreferrer"">This tutorial</a> might be useful.</p>

<p><strong>EDIT</strong></p>

<p>Since the provided link is no longer active, here's a <a href=""https://stackoverflow.com/questions/17190083/how-to-take-mysql-database-backup-using-mysql-workbench"">SO answer</a> outlining the process of creating a DB backup in Workbench.</p>
","4930830"
"Generating a random & unique 8 character string using MySQL","135627","","<p>I'm working on a game which involves vehicles at some point. I have a MySQL table named ""vehicles"" containing the data about the vehicles, including the column ""plate"" which stores the License Plates for the vehicles.</p>

<p>Now here comes the part I'm having problems with. I need to find an unused license plate before creating a new vehicle - it should be an alphanumeric 8-char random string. How I achieved this was using a while loop in Lua, which is the language I'm programming in, to generate strings and query the DB to see if it is used. However, as the number of vehicles increases, I expect this to become even more inefficient it is right now. Therefore, I decided to try and solve this issue using a MySQL query.</p>

<p>The query I need should simply generate a 8-character alphanumeric string which is not already in the table. I thought of the generate&amp;check loop approach again, but I'm not limiting this question to that just in case there's a more efficient one. I've been able to generate strings by defining a string containing all the allowed chars and randomly substringing it, and nothing more. </p>

<p>Any help is appreciated.</p>
","<p>This problem consists of two very different sub-problems:</p>

<ul>
<li>the string must be seemingly random</li>
<li>the string must be unique</li>
</ul>

<p>While randomness is quite easily achieved, the uniqueness without a retry loop is not. This brings us to concentrate on the uniqueness first. Non-random uniqueness can trivially be achieved with <code>AUTO_INCREMENT</code>. So using a uniqueness-preserving, pseudo-random transformation would be fine:</p>

<ul>
<li>Hash has been suggested by @paul</li>
<li>AES-encrypt fits also</li>
<li>But there is a nice one: <code>RAND(N)</code> itself!</li>
</ul>

<p>A sequence of random numbers created by the same seed is guaranteed to be </p>

<ul>
<li>reproducible </li>
<li>different for the first 8 iterations</li>
<li>if the seed is an INT32</li>
</ul>

<p>So we use @AndreyVolk's or @GordonLinoff's approach, but with a <strong>seeded</strong> <code>RAND</code>:</p>

<p>e.g. Assumin <code>id</code> is an AUTO_INCREMENT col: </p>

<pre><code>INSERT INTO vehicles VALUES (blah); -- leaving out the number plate
SELECT @lid:=LAST_INSERT_ID();
UPDATE vehicles SET numberplate=concat(
              substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand(@seed:=round(rand(@lid)*4294967296))*36+1, 1),
              substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand(@seed:=round(rand(@seed)*4294967296))*36+1, 1),
              substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand(@seed:=round(rand(@seed)*4294967296))*36+1, 1),
              substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand(@seed:=round(rand(@seed)*4294967296))*36+1, 1),
              substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand(@seed:=round(rand(@seed)*4294967296))*36+1, 1),
              substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand(@seed:=round(rand(@seed)*4294967296))*36+1, 1),
              substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand(@seed:=round(rand(@seed)*4294967296))*36+1, 1),
              substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand(@seed)*36+1, 1)
             )
     WHERE id=@lid;
</code></pre>
","16738409"
"How to delete from select in MySQL?","135561","","<p>This code doesn't work for MySQL 5.0, how to re-write it to make it work</p>

<pre><code>DELETE FROM posts where id=(SELECT id FROM posts GROUP BY id  HAVING ( COUNT(id) &gt; 1 ))
</code></pre>

<p>I want to delete columns that dont have unique id. I will add that most of the time its only one id(I tried the in syntax and it doesnt work as well).</p>
","<p><code>SELECT</code> (sub)queries return result <em>sets</em>. So you need to use <code>IN</code>, not <code>=</code> in your <code>WHERE</code> clause.</p>

<p>Additionally, as shown in <a href=""https://stackoverflow.com/questions/45494/sql-delete-cant-specify-target-table-for-update-in-from-clause/45498#45498"">this answer</a> you cannot modify the same table from a subquery within the same query. However, you can either <code>SELECT</code> then <code>DELETE</code> in separate queries, or nest another subquery and alias the inner subquery result (looks rather hacky, though):</p>

<pre><code>DELETE FROM posts WHERE id IN (
    SELECT * FROM (
        SELECT id FROM posts GROUP BY id HAVING ( COUNT(id) &gt; 1 )
    ) AS p
)
</code></pre>

<p>Or use joins <a href=""https://stackoverflow.com/questions/4562787/how-to-delete-from-select-in-mysql/4562863#4562863"">as suggested by Mchl</a>.</p>
","4562797"
"Select rows which are not present in other table","135428","","<p>I've got two postgresql tables:  </p>

<pre class=""lang-none prettyprint-override""><code>table name     column names
-----------    ------------------------
login_log      ip | etc.
ip_location    ip | location | hostname | etc.
</code></pre>

<p>I want to get every IP address from <code>login_log</code> which doesn't have a row in <code>ip_location</code>.<br>
I tried this query but it throws a syntax error.</p>

<pre><code>SELECT login_log.ip 
FROM login_log 
WHERE NOT EXIST (SELECT ip_location.ip
                 FROM ip_location
                 WHERE login_log.ip = ip_location.ip)
</code></pre>

<blockquote>
<pre><code>ERROR: syntax error at or near ""SELECT""
LINE 3: WHERE NOT EXIST (SELECT ip_location.ip`
</code></pre>
</blockquote>

<p>I'm also wondering if this query (with adjustments to make it work) is the best performing query for this purpose.</p>
","<p>There are basically 4 techniques for this task, all of them standard SQL.</p>

<h3><a href=""http://www.postgresql.org/docs/current/interactive/functions-subquery.html#FUNCTIONS-SUBQUERY-EXISTS"" rel=""nofollow noreferrer""><code>NOT EXISTS</code></a></h3>

<p>Often, this is fastest in Postgres.  </p>

<pre><code>SELECT ip 
FROM   login_log l 
WHERE  NOT EXISTS (
   SELECT 1              -- it's mostly irrelevant what you put here
   FROM   ip_location i
   WHERE  l.ip = i.ip
   );
</code></pre>

<p>Also consider:</p>

<ul>
<li><a href=""https://stackoverflow.com/questions/7710153/what-is-easier-to-read-in-exists-subqueries"">What is easier to read in EXISTS subqueries?</a></li>
</ul>

<h3><a href=""http://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-FROM"" rel=""nofollow noreferrer""><code>LEFT JOIN / IS NULL</code></a></h3>

<p>Sometimes this is fastest. Often shortest.</p>

<pre><code>SELECT l.ip 
FROM   login_log l 
LEFT   JOIN ip_location i USING (ip)  -- short for: ON i.ip = l.ip
WHERE  i.ip IS NULL;
</code></pre>

<h3><a href=""http://www.postgresql.org/docs/current/interactive/queries-union.html"" rel=""nofollow noreferrer""><code>EXCEPT</code></a></h3>

<p>Short. Not as easily integrated in more complex queries.</p>

<pre><code>SELECT ip 
FROM   login_log

EXCEPT ALL               -- ALL, to keep duplicate rows and make it faster
SELECT ip
FROM   ip_location;
</code></pre>

<p>Note that (<a href=""http://www.postgresql.org/docs/current/interactive/queries-union.html"" rel=""nofollow noreferrer"">per documentation</a>):</p>

<blockquote>
  <p>duplicates are eliminated unless <code>EXCEPT ALL</code> is used.</p>
</blockquote>

<p>Typically, you'll want the <code>ALL</code> keyword. If you don't care, still use it because it makes the query <em>faster</em>.</p>

<h3><a href=""http://www.postgresql.org/docs/current/interactive/functions-subquery.html#FUNCTIONS-SUBQUERY-NOTIN"" rel=""nofollow noreferrer""><code>NOT IN</code></a></h3>

<p>Only good without NULL values or if you know to handle NULL properly! I would <em>not</em> use it for this purpose. Performance can deteriorate with bigger tables.</p>

<pre><code>SELECT ip 
FROM   login_log
WHERE  ip NOT IN (
   SELECT DISTINCT ip  -- DISTINCT is optional
   FROM   ip_location
   );
</code></pre>

<p><code>NOT IN</code> carries a ""trap"" for <code>NULL</code> values on either side:</p>

<ul>
<li><a href=""https://stackoverflow.com/questions/14251180/postgresql-records-where-join-doesnt-exist/14260510#14260510"">Find records where join doesn&#39;t exist</a></li>
</ul>

<p>Similar question on dba.SE targeted at MySQL:</p>

<ul>
<li><a href=""https://dba.stackexchange.com/q/16650/3684"">Select rows where value of second column is not present in first column</a></li>
</ul>
","19364694"
"Convert Xml to Table SQL Server","135365","","<p>I wonder how can i read a xml data and transform it to a table in TSQL?</p>

<p>For example:</p>

<pre><code>&lt;row&gt;
    &lt;IdInvernadero&gt;8&lt;/IdInvernadero&gt;
    &lt;IdProducto&gt;3&lt;/IdProducto&gt;
    &lt;IdCaracteristica1&gt;8&lt;/IdCaracteristica1&gt;
    &lt;IdCaracteristica2&gt;8&lt;/IdCaracteristica2&gt;
    &lt;Cantidad&gt;25&lt;/Cantidad&gt;
    &lt;Folio&gt;4568457&lt;/Folio&gt;
&lt;/row&gt;
&lt;row&gt;
    &lt;IdInvernadero&gt;3&lt;/IdInvernadero&gt;
    &lt;IdProducto&gt;3&lt;/IdProducto&gt;
    &lt;IdCaracteristica1&gt;1&lt;/IdCaracteristica1&gt;
    &lt;IdCaracteristica2&gt;2&lt;/IdCaracteristica2&gt;
    &lt;Cantidad&gt;72&lt;/Cantidad&gt;
    &lt;Folio&gt;4568457&lt;/Folio&gt;
&lt;/row&gt;      
</code></pre>

<p>To</p>

<pre><code>8   3   8   8   25  4568457
3   3   1   2   72  4568457
</code></pre>

<p>Thank you.</p>
","<p>This is the answer, hope it helps someone :)</p>

<p>First they are two variations on how the xml can be wrote:</p>

<h1>1</h1>

<pre><code>&lt;row&gt;
    &lt;IdInvernadero&gt;8&lt;/IdInvernadero&gt;
    &lt;IdProducto&gt;3&lt;/IdProducto&gt;
    &lt;IdCaracteristica1&gt;8&lt;/IdCaracteristica1&gt;
    &lt;IdCaracteristica2&gt;8&lt;/IdCaracteristica2&gt;
    &lt;Cantidad&gt;25&lt;/Cantidad&gt;
    &lt;Folio&gt;4568457&lt;/Folio&gt;
&lt;/row&gt;
&lt;row&gt;
    &lt;IdInvernadero&gt;3&lt;/IdInvernadero&gt;
    &lt;IdProducto&gt;3&lt;/IdProducto&gt;
    &lt;IdCaracteristica1&gt;1&lt;/IdCaracteristica1&gt;
    &lt;IdCaracteristica2&gt;2&lt;/IdCaracteristica2&gt;
    &lt;Cantidad&gt;72&lt;/Cantidad&gt;
    &lt;Folio&gt;4568457&lt;/Folio&gt;
&lt;/row&gt;
</code></pre>

<p>Answer:</p>

<pre><code>SELECT  
       Tbl.Col.value('IdInvernadero[1]', 'smallint'),  
       Tbl.Col.value('IdProducto[1]', 'smallint'),  
       Tbl.Col.value('IdCaracteristica1[1]', 'smallint'),
       Tbl.Col.value('IdCaracteristica2[1]', 'smallint'),
       Tbl.Col.value('Cantidad[1]', 'int'),
       Tbl.Col.value('Folio[1]', 'varchar(7)')
FROM   @xml.nodes('//row') Tbl(Col)  
</code></pre>

<h1>2.</h1>

<pre><code>&lt;row IdInvernadero=""8"" IdProducto=""3"" IdCaracteristica1=""8"" IdCaracteristica2=""8"" Cantidad =""25"" Folio=""4568457"" /&gt;                         
&lt;row IdInvernadero=""3"" IdProducto=""3"" IdCaracteristica1=""1"" IdCaracteristica2=""2"" Cantidad =""72"" Folio=""4568457"" /&gt;
</code></pre>

<p>Answer:</p>

<pre><code>SELECT  
       Tbl.Col.value('@IdInvernadero', 'smallint'),  
       Tbl.Col.value('@IdProducto', 'smallint'),  
       Tbl.Col.value('@IdCaracteristica1', 'smallint'),
       Tbl.Col.value('@IdCaracteristica2', 'smallint'),
       Tbl.Col.value('@Cantidad', 'int'),
       Tbl.Col.value('@Folio', 'varchar(7)')

FROM   @xml.nodes('//row') Tbl(Col)
</code></pre>

<p>Taken from:</p>

<ol>
<li><p><a href=""http://kennyshu.blogspot.com/2007/12/convert-xml-file-to-table-in-sql-2005.html"" rel=""noreferrer"">http://kennyshu.blogspot.com/2007/12/convert-xml-file-to-table-in-sql-2005.html</a> </p></li>
<li><p><a href=""http://msdn.microsoft.com/en-us/library/ms345117(SQL.90).aspx"" rel=""noreferrer"">http://msdn.microsoft.com/en-us/library/ms345117(SQL.90).aspx</a></p></li>
</ol>
","3989477"
"INNER JOIN vs INNER JOIN (SELECT . FROM)","134804","","<p>Is there any difference in terms of performance between these two versions of the same query?</p>

<pre><code>--Version 1
SELECT p.Name, s.OrderQty
FROM Product p
INNER JOIN SalesOrderDetail s on p.ProductID = s.ProductID

--Version 2
SELECT p.Name, s.OrderQty
FROM Product p
INNER JOIN (SELECT ProductID, OrderQty FROM SalesOrderDetail) s on p.ProductID = s.ProductID
</code></pre>

<p>I've heard it said (by a DBA) that Version 2 is faster because it fetches, within the inner SELECT statement, only the columns that are required for the query. But that doesn't seem to make sense, since query performance (as I know) is based on number of rows affected and final list of columns returned.</p>

<p>The query plans for both are identical, so I'm guessing there isn't any difference between the two. </p>

<p>Am I correct?</p>
","<p>You are correct. You did exactly the right thing, checking the query plan rather than trying to second-guess the optimiser. :-)</p>
","11574501"
"UPDATE with CASE and IN - Oracle","134707","","<p>I wrote a query that works like a charm in SQL Server. Unfortunately it needs to be run on an Oracle db. I have been searching the web inside out for a solution on how to convert it, without any success :/</p>

<p>The query looks like this i SQL:</p>

<pre><code>UPDATE tab1   SET budgpost_gr1=     
CASE  WHEN (budgpost in (1001,1012,50055))  THEN 'BP_GR_A'   
      WHEN (budgpost in (5,10,98,0))  THEN 'BP_GR_B'  
      WHEN (budgpost in (11,876,7976,67465))     
      ELSE 'Missing' END`
</code></pre>

<p>My problem is also that the columns <code>budgetpost_gr1</code> and budgetpost is alphanumeric and Oracle seems to want to see the list as numbers. The list are variables/parameters that  is pre-defined as  comma separated lists, which is just dumped into the query.</p>
","<p>Got a solution that runs. Don't know if it is optimal though. What I do is to split the string according to <a href=""http://blogs.oracle.com/aramamoo/2010/05/how_to_split_comma_separated_string_and_pass_to_in_clause_of_select_statement.html"" rel=""nofollow"">http://blogs.oracle.com/aramamoo/2010/05/how_to_split_comma_separated_string_and_pass_to_in_clause_of_select_statement.html</a></p>

<p>Using:<br>
<code>select regexp_substr(' 1, 2 , 3 ','[^,]+', 1, level) from dual<br>
connect by regexp_substr('1 , 2 , 3 ', '[^,]+', 1, level) is not null;</code> </p>

<p>So my final code looks like this (<code>$bp_gr1'</code> are strings like <code>1,2,3</code>): </p>

<pre><code>UPDATE TAB1
SET    BUDGPOST_GR1 =
          CASE
             WHEN ( BUDGPOST IN (SELECT     REGEXP_SUBSTR ( '$BP_GR1',
                                                            '[^,]+',
                                                            1,
                                                            LEVEL )
                                 FROM       DUAL
                                 CONNECT BY REGEXP_SUBSTR ( '$BP_GR1',
                                                            '[^,]+',
                                                            1,
                                                            LEVEL )
                                               IS NOT NULL) )
             THEN
                'BP_GR1'
             WHEN ( BUDGPOST IN (SELECT     REGEXP_SUBSTR ( ' $BP_GR2',
                                                            '[^,]+',
                                                            1,
                                                            LEVEL )
                                 FROM       DUAL
                                 CONNECT BY REGEXP_SUBSTR ( '$BP_GR2',
                                                            '[^,]+',
                                                            1,
                                                            LEVEL )
                                               IS NOT NULL) )
             THEN
                'BP_GR2'
             WHEN ( BUDGPOST IN (SELECT     REGEXP_SUBSTR ( ' $BP_GR3',
                                                            '[^,]+',
                                                            1,
                                                            LEVEL )
                                 FROM       DUAL
                                 CONNECT BY REGEXP_SUBSTR ( '$BP_GR3',
                                                            '[^,]+',
                                                            1,
                                                            LEVEL )
                                               IS NOT NULL) )
             THEN
                'BP_GR3'
             WHEN ( BUDGPOST IN (SELECT     REGEXP_SUBSTR ( '$BP_GR4',
                                                            '[^,]+',
                                                            1,
                                                            LEVEL )
                                 FROM       DUAL
                                 CONNECT BY REGEXP_SUBSTR ( '$BP_GR4',
                                                            '[^,]+',
                                                            1,
                                                            LEVEL )
                                               IS NOT NULL) )
             THEN
                'BP_GR4'
             ELSE
                'SAKNAR BUDGETGRUPP'
          END;
</code></pre>

<p>Is there a way to make it run faster?</p>
","5178001"
"SQL- Ignore case while searching for a string","134615","","<p><br/>I have the following data in a Table
<br/>PriceOrderShipped
<br/>PriceOrderShippedInbound
<br/>PriceOrderShippedOutbound
<br/><br/>In SQL I need to write a query which searches for a string in a table. While searching for  a string it should ignore case. For the below mentioned SQL query</p>

<pre><code>SELECT DISTINCT COL_NAME FROM myTable WHERE COL_NAME LIKE '%PriceOrder%' 
</code></pre>

<p>gives all the above data, whereas</p>

<pre><code>SELECT DISTINCT COL_NAME FROM myTable WHERE COL_NAME LIKE '%Priceorder%' 
</code></pre>

<p>doesn't give.</p>

<p>Eg. when I search for 'PriceOrder' or 'priceOrder' it works but 'priceorder' or 'Priceorder' doesn't work.
I have tried with the below query using COLLATE, but its not working. Do let me know where im going wrong.</p>

<pre><code>SELECT DISTINCT COL_NAME FROM myTable WHERE 
COL_NAME COLLATE latin1_general_cs LIKE '%Priceorder%'
</code></pre>
","<p>Use something like this - </p>

<pre><code>SELECT DISTINCT COL_NAME FROM myTable WHERE UPPER(COL_NAME) LIKE UPPER('%PriceOrder%')
</code></pre>

<p>or </p>

<pre><code>SELECT DISTINCT COL_NAME FROM myTable WHERE LOWER(COL_NAME) LIKE LOWER('%PriceOrder%')
</code></pre>
","16082874"
"Select a random sample of results from a query result","134558","","<p><a href=""https://stackoverflow.com/questions/652064/select-random-sampling-from-sqlserver-quickly"">This question</a> asks about getting a random(ish) sample of records on SQL Server and the answer was to use <code>TABLESAMPLE</code>. Is there an equivalent in Oracle 10?</p>

<p>If there isn't, is there a standard way to get a random sample of results from a query set? For example how can one get 1,000 random rows from a query that will return millions normally?</p>
","<pre><code>SELECT  *
FROM    (
        SELECT  *
        FROM    mytable
        ORDER BY
                dbms_random.value
        )
WHERE rownum &lt;= 1000
</code></pre>
","733659"
"SQL Insert Query Using C#","134355","","<p>I'm having an issue at the moment which I am trying to fix. I just tried to access a database and insert some values with the help of C#</p>

<p>The things I tried (worked)</p>

<pre><code>String query = ""INSERT INTO dbo.SMS_PW (id,username,password,email) VALUES ('abc',      'abc', 'abc', 'abc')"";
</code></pre>

<p>A new line was inserted and everything worked fine, now I tried to insert a row using variables:</p>

<pre><code>String query = ""INSERT INTO dbo.SMS_PW (id,username,password,email) VALUES (@id, @username, @password, @email)"";

command.Parameters.AddWithValue(""@id"",""abc"")
command.Parameters.AddWithValue(""@username"",""abc"")
command.Parameters.AddWithValue(""@password"",""abc"")
command.Parameters.AddWithValue(""@email"",""abc"")

command.ExecuteNonQuery();
</code></pre>

<p>Didn't work, no values were inserted. I tried one more thing</p>

<pre><code>command.Parameters.AddWithValue(""@id"", SqlDbType.NChar);
command.Parameters[""@id""].Value = ""abc"";

command.Parameters.AddWithValue(""@username"", SqlDbType.NChar);
command.Parameters[""@username""].Value = ""abc"";

command.Parameters.AddWithValue(""@password"", SqlDbType.NChar);
command.Parameters[""@password""].Value = ""abc"";

command.Parameters.AddWithValue(""@email"", SqlDbType.NChar);
command.Parameters[""@email""].Value = ""abc"";

command.ExecuteNonQuery();
</code></pre>

<p>May anyone tell me what I am doing wrong?</p>

<p>Kind regards</p>

<p><strong>EDIT:</strong></p>

<p>in one other line I was creating a new SQL-Command</p>

<pre><code>var cmd = new SqlCommand(query, connection);
</code></pre>

<p>Still not working and I can't find anything wrong in the code above.</p>
","<p>I assume you have a connection to your database and you can not do the insert parameters using c #.</p>

<p>You are not adding the parameters in your query. It should look like:</p>

<pre><code>String query = ""INSERT INTO dbo.SMS_PW (id,username,password,email) VALUES (@id,@username,@password, @email)"";

SqlCommand command = new SqlCommand(query, db.Connection);
command.Parameters.Add(""@id"",""abc"");
command.Parameters.Add(""@username"",""abc"");
command.Parameters.Add(""@password"",""abc"");
command.Parameters.Add(""@email"",""abc"");

command.ExecuteNonQuery();
</code></pre>

<p>Updated:</p>

<pre><code>using(SqlConnection connection = new SqlConnection(_connectionString))
{
    String query = ""INSERT INTO dbo.SMS_PW (id,username,password,email) VALUES (@id,@username,@password, @email)"";

    using(SqlCommand command = new SqlCommand(query, connection))
    {
        command.Parameters.AddWithValue(""@id"", ""abc"");
        command.Parameters.AddWithValue(""@username"", ""abc"");
        command.Parameters.AddWithValue(""@password"", ""abc"");
        command.Parameters.AddWithValue(""@email"", ""abc"");

        connection.Open();
        int result = command.ExecuteNonQuery();

        // Check Error
        if(result &lt; 0)
            Console.WriteLine(""Error inserting data into Database!"");
    }
}
</code></pre>
","19956944"
"Highest Salary in each department","134276","","<p>I've got a table like this one</p>

<p>Table Name EmpDetails</p>

<pre><code>DeptID      EmpName   Salary
Engg        Sam       1000
Engg        Smith     2000
HR          Denis     1500
HR          Danny     3000
IT          David     2000
IT          John      3000
</code></pre>

<p>Could you please help me to find a sql query that obtains the highest salary for each department.</p>

<p>Thank you very much.</p>
","<p>As short as the question:</p>

<pre><code>SELECT DeptID, MAX(Salary) FROM EmpDetails GROUP BY DeptID
</code></pre>
","8477093"
"Execute Insert command and return inserted Id in Sql","134226","","<p>Hi i am inserting some values into sql table using C# in MVC4. Actually i want to insert values and return the 'ID' of last inserted record. I use the following code.</p>

<pre><code>public class MemberBasicData
{
    public int Id { get; set; }
    public string Mem_NA { get; set; }
    public string Mem_Occ { get; set; }     
}
</code></pre>

<p>ID is automatically increment in database when inserted.</p>

<pre><code>public int CreateNewMember(string Mem_NA, string Mem_Occ )
{
    using (SqlConnection con=new SqlConnection(Config.ConnectionString))
    {
        using(SqlCommand cmd=new SqlCommand(""INSERT INTO Mem_Basic(Mem_Na,Mem_Occ) VALUES(@na,@occ)"",con))
        {
            cmd.Parameters.AddWithValue(""@na"", Mem_NA);
            cmd.Parameters.AddWithValue(""@occ"", Mem_Occ);
            con.Open();

            int modified = cmd.ExecuteNonQuery();

            if (con.State == System.Data.ConnectionState.Open) con.Close();
                return modified;
        }
    }
}
</code></pre>

<p>I know <code>ExecuteNonQuery</code> denotes the numbers affecting the row. Instead of that I use</p>

<pre><code>int modified = (int)cmd.ExecuteScalar();
</code></pre>

<p>But not working. Please help me for solving this. And is there any code like cmd.ExecuteInsertAndGetID() (not working with my code).</p>
","<p>The following solution will work with sql server 2005 and above. You can use <a href=""http://msdn.microsoft.com/en-us/library/ms177564.aspx"">output</a> to get the required field. inplace of id you can  write your key that you want to return. do it like this</p>

<p><strong>FOR SQL SERVER 2005 and above</strong></p>

<pre><code>    using(SqlCommand cmd=new SqlCommand(""INSERT INTO Mem_Basic(Mem_Na,Mem_Occ) output INSERTED.ID VALUES(@na,@occ)"",con))
    {
        cmd.Parameters.AddWithValue(""@na"", Mem_NA);
        cmd.Parameters.AddWithValue(""@occ"", Mem_Occ);
        con.Open();

        int modified =(int)cmd.ExecuteScalar();

        if (con.State == System.Data.ConnectionState.Open) 
            con.Close();

        return modified;
    }
}
</code></pre>

<p><strong>FOR previous versions</strong></p>

<pre><code>    using(SqlCommand cmd=new SqlCommand(""INSERT INTO Mem_Basic(Mem_Na,Mem_Occ)  VALUES(@na,@occ);SELECT SCOPE_IDENTITY();"",con))
    {
        cmd.Parameters.AddWithValue(""@na"", Mem_NA);
        cmd.Parameters.AddWithValue(""@occ"", Mem_Occ);
        con.Open();

        int modified = cmd.ExecuteScalar();

        if (con.State == System.Data.ConnectionState.Open) con.Close();
            return modified;
    }
}
</code></pre>
","18373524"
"How to concatenate columns in a Postgres SELECT?","134065","","<p>I have two string columns <code>a</code> and <code>b</code>.</p>

<p>So <code>select a,b from foo</code>  returns values <code>a</code> and <code>b</code>.  However, concatenation of <code>a</code> and <code>b</code> does not work. I tried :</p>

<pre><code>select a || b from foo
</code></pre>

<p>and</p>

<pre><code>select  a||', '||b from foo
</code></pre>

<p><strong>OP's error message (from comments):</strong></p>

<blockquote>
  <p>No operator matches the given name and argument type(s). You might
  need to add explicit type casts.</p>
</blockquote>

<p>He also stated that both fields are <code>character(2)</code>.</p>
","<p>The problem was in nulls in the values; then the concatenation does not work with nulls.  The solution is as follows:</p>

<pre><code>SELECT coalesce(a, '') || coalesce(b, '') FROM foo;
</code></pre>
","19958775"
"Oracle SQL - REGEXP_LIKE contains characters other than a-z or A-Z","134032","","<p>I would like to create a query where I select all records which contain characters that are not a-z or A-Z</p>

<p>so something like this</p>

<p><code>SELECT * FROM mytable WHERE REGEXP_LIKE(column_1, '![A-Z] [a-z]')</code></p>
","<p>The <code>^</code> negates a character class:</p>

<pre><code>SELECT * FROM mytable WHERE REGEXP_LIKE(column_1, '[^A-Za-z]')
</code></pre>
","9604751"
"C# SQL Server - Passing a list to a stored procedure","133990","","<p>I am calling a SQL Server stored procedure from my C# code:</p>

<pre><code>using (SqlConnection conn = new SqlConnection(connstring))
{
   conn.Open();
   using (SqlCommand cmd = new SqlCommand(""InsertQuerySPROC"", conn))
   {
      cmd.CommandType = CommandType.StoredProcedure;

      var STableParameter = cmd.Parameters.AddWithValue(""@QueryTable"", QueryTable);
      var NDistanceParameter = cmd.Parameters.AddWithValue(""@NDistanceThreshold"", NDistanceThreshold);
      var RDistanceParameter = cmd.Parameters.AddWithValue(@""RDistanceThreshold"", RDistanceThreshold);

      STableParameter .SqlDbType = SqlDbType.Structured;
      NDistanceParameter.SqlDbType = SqlDbType.Int;
      RDistanceParameter.SqlDbType = SqlDbType.Int;

      // Execute the query
      SqlDataReader QueryReader = cmd.ExecuteReader();
</code></pre>

<p>My stored proc is fairly standard but does a join with <code>QueryTable</code> (hence the need for for using a stored proc).</p>

<p>Now: I want to add a list of strings, <code>List&lt;string&gt;</code>, to the parameter set. For example, my stored proc query goes like this:</p>

<pre><code>SELECT feature 
FROM table1 t1 
INNER JOIN @QueryTable t2 ON t1.fid = t2.fid 
WHERE title IN &lt;LIST_OF_STRINGS_GOES_HERE&gt;
</code></pre>

<p>However, the list of strings is dynamic and a few hundred long.</p>

<p><strong>Is there a way to pass a list of strings <code>List&lt;string&gt;</code> to the stored proc???</strong> Or is there a better way to do this?</p>

<p>Many thanks,
Brett</p>
","<p>If you're using SQL Server 2008, there's a new featured called a User Defined Table Type.  Here is an example of how to use it:</p>

<p>Create your User Defined Table Type:</p>

<pre><code>CREATE TYPE [dbo].[StringList] AS TABLE(
    [Item] [NVARCHAR](MAX) NULL
);
</code></pre>

<p>Next you need to use it properly in your stored procedure:</p>

<pre><code>CREATE PROCEDURE [dbo].[sp_UseStringList]
    @list StringList READONLY
AS
BEGIN
    -- Just return the items we passed in
    SELECT l.Item FROM @list l;
END
</code></pre>

<p>Finally here's some sql to use it in c#: </p>

<pre><code>using (var con = new SqlConnection(connstring))
{
    con.Open();

    using (SqlCommand cmd = new SqlCommand(""exec sp_UseStringList @list"", con))
    {
        using (var table = new DataTable()) {
          table.Columns.Add(""Item"", typeof(string));

          for (int i = 0; i &lt; 10; i++)
            table.Rows.Add(""Item "" + i.ToString());

          var pList = new SqlParameter(""@list"", SqlDbType.Structured);
          pList.TypeName = ""dbo.StringList"";
          pList.Value = table;

          cmd.Parameters.Add(pList);

          using (var dr = cmd.ExecuteReader())
          {
            while (dr.Read())
                Console.WriteLine(dr[""Item""].ToString());
          }
         }
    }
}
</code></pre>
","7097217"
"Cannot create SSPI context","133925","","<p>I am working on a .NET application where I am trying to build the database scripts. While building the project, I am getting an error ""Cannot create SSPI context."". This error is shown in the output window (inside VS2008 screen) and the building process failed. Please help on this. SQL Server is configured to work on Windows authentication &amp; running as network service (these two things are must for my project).</p>

<p>Please help on this. This error is not seems to be consistent. It was fixed in the past by restarting the machine, changing the system time to match the domain time and some suggestions in the net. Please help on this. </p>
","<p>It's quite a common error with a variety of causes: start here with <a href=""http://support.microsoft.com/kb/811889"" rel=""noreferrer"">KB 811889</a></p>

<ul>
<li>What version of SQL Server?</li>
<li>And Windows on client and server?</li>
<li>Local or network SQL instance?  </li>
<li>Domain or workgroup? Provider?</li>
<li>Changing password</li>
<li>Local windows log errors?</li>
<li>Any other apps affected?</li>
</ul>
","1812557"
"How to change the default collation of a table?","133918","","<pre><code>create table check2(f1 varchar(20),f2 varchar(20));
</code></pre>

<p>creates a table with the default collation <code>latin1_general_ci</code>;</p>

<pre><code>alter table check2 collate latin1_general_cs;
show full columns from check2;
</code></pre>

<p>shows the individual collation of the columns as 'latin1_general_ci'.</p>

<p>Then what is the effect of the alter table command?</p>
","<p>To change the default character set and collation of a table <em>including those of existing columns</em> (note the <strong>convert to</strong> clause):</p>

<pre><code>alter table &lt;some_table&gt; convert to character set utf8 collate utf8_unicode_ci;
</code></pre>
","5468980"
"How can I get around MySQL Errcode 13 with SELECT INTO OUTFILE?","133896","","<p>I am trying to dump the contents of a table to a csv file using a MySQL SELECT INTO OUTFILE statement.  If I do:</p>

<pre><code>SELECT column1, column2
INTO OUTFILE 'outfile.csv'
FIELDS TERMINATED BY ','
FROM table_name;
</code></pre>

<p>outfile.csv will be created on the server in the same directory this database's files are stored in.  </p>

<p>However, when I change my query to:</p>

<pre><code>SELECT column1, column2
INTO OUTFILE '/data/outfile.csv'
FIELDS TERMINATED BY ','
FROM table_name;
</code></pre>

<p>I get:</p>

<pre><code>ERROR 1 (HY000): Can't create/write to file '/data/outfile.csv' (Errcode: 13)
</code></pre>

<p>Errcode 13 is a permissions error, but I get it even if I change ownership of /data to mysql:mysql and give it 777 permissions.  MySQL is running as user ""mysql"".</p>

<p>Strangely I can create the file in /tmp, just not in any other directory I've tried, even with permissions set such that user mysql should be able to write to the directory.</p>

<p>This is MySQL 5.0.75 running on Ubuntu.  </p>
","

<p>Which particular version of Ubuntu is this and is this Ubuntu Server Edition?</p>

<p>Recent Ubuntu Server Editions (such as 10.04) ship with AppArmor and MySQL's profile might be in enforcing mode by default. You can check this by executing <code>sudo aa-status</code> like so:</p>

<pre class=""lang-none prettyprint-override""><code># sudo aa-status
5 profiles are loaded.
5 profiles are in enforce mode.
   /usr/lib/connman/scripts/dhclient-script
   /sbin/dhclient3
   /usr/sbin/tcpdump
   /usr/lib/NetworkManager/nm-dhcp-client.action
   /usr/sbin/mysqld
0 profiles are in complain mode.
1 processes have profiles defined.
1 processes are in enforce mode :
   /usr/sbin/mysqld (1089)
0 processes are in complain mode.
</code></pre>

<p>If mysqld is included in enforce mode, then it is the one probably denying the write. Entries would also be written in <code>/var/log/messages</code> when AppArmor blocks the writes/accesses. What you can do is edit <code>/etc/apparmor.d/usr.sbin.mysqld</code> and add <code>/data/</code> and <code>/data/*</code> near the bottom like so:</p>

<pre class=""lang-none prettyprint-override""><code>...  
/usr/sbin/mysqld  {  
    ...  
    /var/log/mysql/ r,  
    /var/log/mysql/* rw,  
    /var/run/mysqld/mysqld.pid w,  
    /var/run/mysqld/mysqld.sock w,  
    **/data/ r,  
    /data/* rw,**  
}
</code></pre>

<p>And then make AppArmor reload the profiles.</p>

<pre class=""lang-none prettyprint-override""><code># sudo /etc/init.d/apparmor reload
</code></pre>

<p>WARNING: the change above will allow MySQL to read and write to the /data directory. We hope you've already considered the security implications of this.</p>
","2986764"
"SQL - IF EXISTS UPDATE ELSE INSERT INTO","133785","","<p>What I'm trying to do is <code>INSERT</code> subscribers in my database, but <code>IF EXISTS</code> it should <code>UPDATE</code> the row, <code>ELSE INSERT INTO</code> a new row.</p>

<p>Ofcourse I connect to the database first and <code>GET</code> the <code>$name</code>, <code>$email</code> and <code>$birthday</code> from the url string.</p>

<pre><code>$con=mysqli_connect(""localhost"",""---"",""---"",""---"");
// Check connection
if (mysqli_connect_errno())
  {
  echo ""Failed to connect to MySQL: "" . mysqli_connect_error();
  }

$name=$_GET['name']; 
$email=$_GET['email'];
$birthday=$_GET['birthday'];
</code></pre>

<p>This works, but just adds the new row;</p>

<pre><code>mysqli_query($con,""INSERT INTO subs (subs_name, subs_email, subs_birthday)
VALUES ('$name', '$email', '$birthday')"");

mysqli_close($con);
</code></pre>

<p>Here's what I tried;</p>

<pre><code>mysqli_query($con,""INSERT INTO subs (subs_name, subs_email, subs_birthday)
VALUES '$name', '$email', '$birthday'
ON DUPLICATE KEY UPDATE subs_name = VALUES($name), subs_birthday = VALUES($birthday)"");
mysqli_close($con);
</code></pre>

<p>and</p>

<pre><code>mysqli_query($con,""IF EXISTS (SELECT * FROM subs WHERE subs_email='$email')
    UPDATE subs SET subs_name='$name', subs_birthday='$birthday' WHERE subs_email='$email'
ELSE
    INSERT INTO subs (subs_name, subs_email, subs_birthday) VALUES ('$name', '$email', '$birthday')"");
mysqli_close($con);
</code></pre>

<p>and</p>

<pre><code>mysqli_query($con,""IF NOT EXISTS(SELECT * FROM subs WHERE subs_email='$email')
Begin
INSERT INTO subs (subs_name, subs_email, subs_birthday)
VALUES ('$name', '$email', '$birthday')
End"");
mysqli_close($con);
</code></pre>

<p>But none of them work, what am I doing wrong?</p>

<p>Any help is greatly appreciated!</p>
","<ol>
<li><p>Create a <a href=""http://dev.mysql.com/doc/en/constraint-primary-key.html"" rel=""noreferrer""><code>UNIQUE</code> constraint</a> on your <code>subs_email</code> column, if one does not already exist:</p>

<pre><code>ALTER TABLE subs ADD UNIQUE (subs_email)
</code></pre></li>
<li><p>Use <a href=""http://dev.mysql.com/doc/en/insert-on-duplicate.html"" rel=""noreferrer""><code>INSERT ... ON DUPLICATE KEY UPDATE</code></a>:</p>

<pre><code>INSERT INTO subs
  (subs_name, subs_email, subs_birthday)
VALUES
  (?, ?, ?)
ON DUPLICATE KEY UPDATE
  subs_name     = VALUES(subs_name),
  subs_birthday = VALUES(subs_birthday)
</code></pre></li>
</ol>

<blockquote>
  <p>You can use the VALUES(col_name) function in the UPDATE clause to
  refer to column values from the INSERT portion of the INSERT ... ON
  DUPLICATE KEY UPDATE - <a href=""http://dev.mysql.com/doc/en/constraint-primary-key.html"" rel=""noreferrer"">dev.mysql.com</a></p>
</blockquote>

<ol start=""3"">
<li>Note that I have used parameter placeholders in the place of string literals, as one <em>really</em> should be using parameterised statements to <a href=""https://stackoverflow.com/a/60496"">defend against SQL injection attacks</a>.</li>
</ol>
","15383973"
"MySQL SELECT DISTINCT multiple columns","133772","","<p>Let's say I have columns <code>a, b c, d</code> in a table in a MySQL database. What I'm trying to do is to select the distinct values of ALL of these 4 columns in my table (only the distinct values). I tried stuff like:</p>

<pre><code>SELECT DISTINCT a,b,c,d FROM my_table;
SELECT DISTINCT a,b,c,d FROM my_table GROUP BY a,b,c,d;
</code></pre>

<p>None of those worked. Can anybody help out here?</p>

<p>Thank you</p>

<p><strong>NOTE</strong> I want the distinct values of the columns <code>a, b, c d</code> separately. Not the distinct combination of values</p>
","<p>can this help?</p>

<pre><code>select 
(SELECT group_concat(DISTINCT a) FROM my_table) as a,
(SELECT group_concat(DISTINCT b) FROM my_table) as b,
(SELECT group_concat(DISTINCT c) FROM my_table) as c,
(SELECT group_concat(DISTINCT d) FROM my_table) as d
</code></pre>
","12188117"
"select from one table, insert into another table oracle sql query","133714","","<p>I am trying to select data from one table <br>
and insert the data into another table</p>

<pre><code>    SELECT ticker FROM tickerdb;
</code></pre>

<p>Using OracleSql I am trying to <br>
get the ticker symbol ""GOOG"" from the tickerdb table, <br>
and insert the t.ticker into the stockdb table.<br></p>

<p>select from tickerdb table --> insert into quotedb table</p>

<pre><code>    INSERT INTO quotedb
    (t.ticker, q.prevclose, q.opn, q.rnge,
    q.volume, q.marketcap, q.dividend, q.scrapedate)
    VALUES (?,?,?,?,?,?,?,?,SYSDATE)
    tickerdb t inner JOIN quotedb q
    ON t.ticker = q.ticker
</code></pre>
","<p>From the oracle documentation, the below query explains it better   </p>

<pre><code>INSERT INTO tbl_temp2 (fld_id)
SELECT tbl_temp1.fld_order_id
FROM tbl_temp1 WHERE tbl_temp1.fld_order_id &gt; 100;
</code></pre>

<p>You can read this <a href=""http://docs.oracle.com/cd/E17952_01/refman-5.1-en/insert-select.html"">link</a></p>

<p>Your query would be as follows  </p>

<pre><code>//just the concept    
    INSERT INTO quotedb
    (COLUMN_NAMES) //seperated by comma
    SELECT COLUMN_NAMES FROM tickerdb,quotedb WHERE quotedb.ticker = tickerdb.ticker
</code></pre>

<p>Note: Make sure the columns in insert and select are in right position as per your requirement</p>

<p>Hope this helps!</p>
","20261494"
"How to group by month from Date field using sql","133490","","<p>How can I group only by month from a date field (and not group by day)?</p>

<p>Here is what my date field looks like:</p>

<pre><code>2012-05-01
</code></pre>

<p>Here is my current SQL:</p>

<pre><code>select  Closing_Date, Category,  COUNT(Status)TotalCount from  MyTable
where Closing_Date &gt;= '2012-02-01' and Closing_Date &lt;= '2012-12-31'
and Defect_Status1 is not null
group by  Closing_Date, Category
</code></pre>
","<p>I would use this:</p>

<pre><code>SELECT  Closing_Date = DATEADD(MONTH, DATEDIFF(MONTH, 0, Closing_Date), 0), 
        Category,  
        COUNT(Status) TotalCount 
FROM    MyTable
WHERE   Closing_Date &gt;= '2012-02-01' 
AND     Closing_Date &lt;= '2012-12-31'
AND     Defect_Status1 IS NOT NULL
GROUP BY DATEADD(MONTH, DATEDIFF(MONTH, 0, Closing_Date), 0), Category;
</code></pre>

<p>This will group by the first of every month, so </p>

<pre><code>`DATEADD(MONTH, DATEDIFF(MONTH, 0, '20130128'), 0)` 
</code></pre>

<p>will give <code>'20130101'</code>. I generally prefer this method as it keeps dates as dates.</p>

<p>Alternatively you could use something like this:</p>

<pre><code>SELECT  Closing_Year = DATEPART(YEAR, Closing_Date),
        Closing_Month = DATEPART(MONTH, Closing_Date),
        Category,  
        COUNT(Status) TotalCount 
FROM    MyTable
WHERE   Closing_Date &gt;= '2012-02-01' 
AND     Closing_Date &lt;= '2012-12-31'
AND     Defect_Status1 IS NOT NULL
GROUP BY DATEPART(YEAR, Closing_Date), DATEPART(MONTH, Closing_Date), Category;
</code></pre>

<p>It really depends what your desired output is. (Closing Year is not necessary in your example, but if the date range crosses a year boundary it may be).</p>
","14566013"
"How do I ignore ampersands in a SQL script running from SQL Plus?","133470","","<p>I have a SQL script that creates a package with a comment containing an ampersand (&amp;). When I run the script from SQL Plus, I am prompted to enter a substitute value for the string starting with &amp;. How do I disable this feature so that SQL Plus ignores the ampersand?</p>
","<p>This may work for you:</p>

<pre><code>set define off
</code></pre>

<p>Otherwise the ampersand needs to be at the end of a string, </p>

<pre><code>'StackOverflow &amp;' || ' you'
</code></pre>

<p>EDIT:  I was click-happy when saving...  This was referenced from a <a href=""http://blog.andrewbeacock.com/2008/09/using-ampersands-without-variable_15.html"" rel=""noreferrer"">blog</a>.</p>
","118210"
"Index (zero based) must be greater than or equal to zero","133430","","<p>Hey I keep getting an error:</p>

<blockquote>
  <p>Index (zero based) must be greater than or equal to zero and less than the size of the argument list.</p>
</blockquote>

<p>My code:</p>

<pre><code>OdbcCommand cmd = new OdbcCommand(""SELECT FirstName, SecondName, Aboutme FROM User WHERE UserID=1"", cn);

OdbcDataReader reader = cmd.ExecuteReader();
while (reader.Read())
{
    Name.Text = String.Format(""{0} {1}"", reader.GetString(0), reader.GetString(1));
    Aboutme.Text = String.Format(""{2}"", reader.GetString(0));
}
</code></pre>
","<p>Your second <code>String.Format</code> uses <code>{2}</code> as a placeholder but you're only passing in one argument, so you should use <code>{0}</code> instead.</p>

<p>Change this:</p>

<pre><code>String.Format(""{2}"", reader.GetString(0));
</code></pre>

<p>To this:</p>

<pre><code>String.Format(""{0}"", reader.GetString(2));
</code></pre>
","5316428"
"Multiple left joins on multiple tables in one query","133230","","<p>I've got one <code>master</code> table, which has items stored in multiple levels, parents and childs, and there is a second table which may or may not have additional data. I need to query two levels from my master table and have a left join on my second table, but because of the ordering within my query this will not work.</p>

<pre><code>SELECT something FROM master as parent, master as child
  LEFT JOIN second as parentdata ON parent.secondary_id = parentdata.id
  LEFT JOIN second as childdata ON child.secondary_id = childdata.id
WHERE parent.id = child.parent_id AND parent.parent_id = 'rootID'
</code></pre>

<p>The left join only works with the last table in the from clause, so I am only able to make it work for one of the left joins. In the example above none of the left joins will work because the first left join points towards the first table in the from clause, the second one will never work like this.</p>

<p>How can I make this work?</p>
","<p>This kind of query should work - after rewriting with explicit ANSI <code>JOIN</code> syntax:</p>

<pre><code>SELECT something
FROM   master      parent
JOIN   master      child ON child.parent_id = parent.id
LEFT   JOIN second parentdata ON parentdata.id = parent.secondary_id
LEFT   JOIN second childdata ON childdata.id = child.secondary_id
WHERE  parent.parent_id = 'rootID'
</code></pre>

<p>The tripping wire here is that an explicit <code>JOIN</code> binds before ""old style"" <code>CROSS JOIN</code> with comma (<strong><code>,</code></strong>). <a href=""http://www.postgresql.org/docs/current/interactive/sql-select.html#SQL-FROM"" rel=""nofollow noreferrer"">I quote the manual here:</a></p>

<blockquote>
  <p>In any case <code>JOIN</code> binds more tightly than the commas separating
  <code>FROM</code>-list items.</p>
</blockquote>

<p>After rewriting the first, all joins are applied left-to-right (logically - Postgres is free to rearrange tables in the query plan otherwise) and it works.</p>

<p>Just to make my point, this would work, too:</p>

<pre><code>SELECT something
FROM   master parent
LEFT   JOIN second parentdata ON parentdata.id = parent.secondary_id
,      master child
LEFT   JOIN second childdata ON childdata.id = child.secondary_id
WHERE  child.parent_id = parent.id
AND    parent.parent_id = 'rootID'
</code></pre>

<p>But explicit <code>JOIN</code> syntax is generally preferable, as your case illustrates once again.</p>

<p>And be aware that multiple (LEFT) JOINs can multiply rows:</p>

<ul>
<li><a href=""https://stackoverflow.com/questions/12464037/two-sql-left-joins-produce-incorrect-result/12464135#12464135"">Two SQL LEFT JOINS produce incorrect result</a></li>
</ul>
","14261094"
"Query error with ambiguous column name in SQL","133200","","<p>I get an Ambiguous column name error with this query (InvoiceID). I can't figure out why. They all seem to be joined correctly so why doesn't the management studio know to display VendorID? Any help would be greatly appreciated.</p>

<p>Query:</p>

<pre><code>SELECT 
    VendorName, InvoiceID, InvoiceSequence, InvoiceLineItemAmount
FROM Vendors 
JOIN Invoices ON (Vendors.VendorID = Invoices.VendorID)
JOIN InvoiceLineItems ON (Invoices.InvoiceID = InvoiceLineItems.InvoiceID)
WHERE  
    Invoices.InvoiceID IN
        (SELECT InvoiceSequence 
         FROM InvoiceLineItems
         WHERE InvoiceSequence &gt; 1)
ORDER BY 
    VendorName, InvoiceID, InvoiceSequence, InvoiceLineItemAmount
</code></pre>
","<p>I think you have ambiguity only in InvoiceID. Other fields seem distinct. So try This</p>

<p>I just replace InvoiceID with Invoices.InvoiceID</p>

<pre><code>   SELECT 
        VendorName, Invoices.InvoiceID, InvoiceSequence, InvoiceLineItemAmount
    FROM Vendors 
    JOIN Invoices ON (Vendors.VendorID = Invoices.VendorID)
    JOIN InvoiceLineItems ON (Invoices.InvoiceID = InvoiceLineItems.InvoiceID)
    WHERE  
        Invoices.InvoiceID IN
            (SELECT InvoiceSequence 
             FROM InvoiceLineItems
             WHERE InvoiceSequence &gt; 1)
    ORDER BY 
        VendorName, Invoices.InvoiceID, InvoiceSequence, InvoiceLineItemAmount
</code></pre>

<p>You can use tablename.columnnae for all columns (in selection,where,group by and order by) without using any alias. However you can use an alias as guided by other answers</p>
","12663048"
"must appear in the GROUP BY clause or be used in an aggregate function","133181","","<p>I have a table that looks like this caller 'makerar'</p>

<pre><code> cname  | wmname |          avg           
--------+-------------+------------------------
 canada | zoro   |     2.0000000000000000
 spain  | luffy  | 1.00000000000000000000
 spain  | usopp  |     5.0000000000000000
</code></pre>

<p>And I want to select the maximum avg for each cname. </p>

<pre><code>SELECT cname, wmname, MAX(avg)  FROM makerar GROUP BY cname;
</code></pre>

<p>but I will get an error, </p>

<pre><code>ERROR:  column ""makerar.wmname"" must appear in the GROUP BY clause or be used in an   aggregate function 
LINE 1: SELECT cname, wmname, MAX(avg)  FROM makerar GROUP BY cname;
</code></pre>

<p>so i do this</p>

<pre><code>SELECT cname, wmname, MAX(avg)  FROM makerar GROUP BY cname, wmname;
</code></pre>

<p>however this will not give the intented results, and the incorrect output below is shown.</p>

<pre><code> cname  | wmname |          max           
--------+--------+------------------------
 canada | zoro   |     2.0000000000000000
 spain  | luffy  | 1.00000000000000000000
 spain  | usopp  |     5.0000000000000000
</code></pre>

<p>Actual Results should be</p>

<pre><code> cname  | wmname |          max           
--------+--------+------------------------
 canada | zoro   |     2.0000000000000000
 spain  | usopp  |     5.0000000000000000
</code></pre>

<p>How can I go about fixing this issue?</p>

<p>Note: This table is a VIEW created from  a previous operation.</p>
","<p>Yes, this is a common aggregation problem. Before <a href=""http://web.cecs.pdx.edu/~len/sql1999.pdf"">SQL3 (1999)</a>, the selected fields must appear in the <code>GROUP BY</code> clause[*]. </p>

<p>To workaround this issue, you must calculate the aggregate in a sub-query and then join it with itself to get the additional columns you'd need to show:</p>

<pre><code>SELECT m.cname, m.wmname, t.mx
FROM (
    SELECT cname, MAX(avg) AS mx
    FROM makerar
    GROUP BY cname
    ) t JOIN makerar m ON m.cname = t.cname AND t.mx = m.avg
;

 cname  | wmname |          mx           
--------+--------+------------------------
 canada | zoro   |     2.0000000000000000
 spain  | usopp  |     5.0000000000000000
</code></pre>

<hr>

<p>But you may also use window functions, which looks simpler:</p>

<pre><code>SELECT cname, wmname, MAX(avg) OVER (PARTITION BY cname) AS mx
FROM makerar
;
</code></pre>

<p>The only thing with this method is that it will show all records (window functions do not group). But it will show the correct (i.e. maxed at <code>cname</code> level) <code>MAX</code> for the country in each row, so it's up to you:</p>

<pre><code> cname  | wmname |          mx           
--------+--------+------------------------
 canada | zoro   |     2.0000000000000000
 spain  | luffy  |     5.0000000000000000
 spain  | usopp  |     5.0000000000000000
</code></pre>

<p>The solution, arguably less elegant, to show the only <code>(cname, wmname)</code> tuples matching the max value, is:</p>

<pre><code>SELECT DISTINCT /* distinct here matters, because maybe there are various tuples for the same max value */
    m.cname, m.wmname, t.avg AS mx
FROM (
    SELECT cname, wmname, avg, ROW_NUMBER() OVER (PARTITION BY avg DESC) AS rn 
    FROM makerar
) t JOIN makerar m ON m.cname = t.cname AND m.wmname = t.wmname AND t.rn = 1
;


 cname  | wmname |          mx           
--------+--------+------------------------
 canada | zoro   |     2.0000000000000000
 spain  | usopp  |     5.0000000000000000
</code></pre>

<hr>

<p>[*]: Interestingly enough, even though the spec sort of allows to select non-grouped fields, major engines seem to not really like it. Oracle and SQLServer just don't allow this at all. Mysql used to allow it by default, but now since 5.7 the administrator needs to enable this option (<code>ONLY_FULL_GROUP_BY</code>) manually in the server configuration for this feature to be supported...</p>
","19602031"
"What is the best free SQL GUI for Linux for various DBMS systems","133113","","<p>As I make the full switch from Windows to Linux (CentOS 5) I'm in search of the best free GUI SQL Client tool for MSSQL, MySQL, Oracle, etc... any suggestions?</p>

<p>I've tried DBVisualizer (The best bet so far but still limited by the free version, not all functionality is there), MySQL GUI Tools (Good but only for MySQL, need other DB's as well) and Aqua Data Studio (Same as DBVis, it's good but a lot of the functionality is missing in the free version).</p>
","<p>I'm sticking with DbVisualizer Free until something better comes along.</p>
","1154817"
"How to find column names for all tables in all databases in SQL Server","133044","","<p>I want to find all column names in all tables <strong>in all databases</strong>. Is there a query that can do that for me? The database is Microsoft SQL Server 2000.</p>
","<p>try this:</p>

<pre><code>select 
    o.name,c.name 
    from sys.columns            c
        inner join sys.objects  o on c.object_id=o.object_id
    order by o.name,c.column_id
</code></pre>

<p>or for more detail:</p>

<pre><code>SELECT
    s.name as ColumnName
        ,sh.name+'.'+o.name AS ObjectName
        ,o.type_desc AS ObjectType
        ,CASE
             WHEN t.name IN ('char','varchar') THEN t.name+'('+CASE WHEN s.max_length&lt;0 then 'MAX' ELSE CONVERT(varchar(10),s.max_length) END+')'
             WHEN t.name IN ('nvarchar','nchar') THEN t.name+'('+CASE WHEN s.max_length&lt;0 then 'MAX' ELSE CONVERT(varchar(10),s.max_length/2) END+')'
            WHEN t.name IN ('numeric') THEN t.name+'('+CONVERT(varchar(10),s.precision)+','+CONVERT(varchar(10),s.scale)+')'
             ELSE t.name
         END AS DataType

        ,CASE
             WHEN s.is_nullable=1 THEN 'NULL'
            ELSE 'NOT NULL'
        END AS Nullable
        ,CASE
             WHEN ic.column_id IS NULL THEN ''
             ELSE ' identity('+ISNULL(CONVERT(varchar(10),ic.seed_value),'')+','+ISNULL(CONVERT(varchar(10),ic.increment_value),'')+')='+ISNULL(CONVERT(varchar(10),ic.last_value),'null')
         END
        +CASE
             WHEN sc.column_id IS NULL THEN ''
             ELSE ' computed('+ISNULL(sc.definition,'')+')'
         END
        +CASE
             WHEN cc.object_id IS NULL THEN ''
             ELSE ' check('+ISNULL(cc.definition,'')+')'
         END
            AS MiscInfo
    FROM sys.columns                           s
        INNER JOIN sys.types                   t ON s.system_type_id=t.user_type_id and t.is_user_defined=0
        INNER JOIN sys.objects                 o ON s.object_id=o.object_id
        INNER JOIN sys.schemas                sh on o.schema_id=sh.schema_id
        LEFT OUTER JOIN sys.identity_columns  ic ON s.object_id=ic.object_id AND s.column_id=ic.column_id
        LEFT OUTER JOIN sys.computed_columns  sc ON s.object_id=sc.object_id AND s.column_id=sc.column_id
        LEFT OUTER JOIN sys.check_constraints cc ON s.object_id=cc.parent_object_id AND s.column_id=cc.parent_column_id
    ORDER BY sh.name+'.'+o.name,s.column_id
</code></pre>

<p><strong>EDIT</strong><br>
here is a basic example to get all columns in all databases:</p>

<pre><code>DECLARE @SQL varchar(max)
SET @SQL=''
SELECT @SQL=@SQL+'UNION
select 
'''+d.name+'.''+sh.name+''.''+o.name,c.name,c.column_id
from '+d.name+'.sys.columns            c
    inner join '+d.name+'.sys.objects  o on c.object_id=o.object_id
    INNER JOIN '+d.name+'.sys.schemas  sh on o.schema_id=sh.schema_id
'
FROM sys.databases d
SELECT @SQL=RIGHT(@SQL,LEN(@SQL)-5)+'order by 1,3'
--print @SQL
EXEC (@SQL)
</code></pre>

<p><strong>EDIT</strong> SQL Server 2000 version</p>

<pre><code>DECLARE @SQL varchar(8000)
SET @SQL=''
SELECT @SQL=@SQL+'UNION
select 
'''+d.name+'.''+sh.name+''.''+o.name,c.name,c.colid
from '+d.name+'..syscolumns            c
    inner join sysobjects  o on c.id=o.id
    INNER JOIN sysusers  sh on o.uid=sh.uid
'
FROM master.dbo.sysdatabases d
SELECT @SQL=RIGHT(@SQL,LEN(@SQL)-5)+'order by 1,3'
--print @SQL
EXEC (@SQL)
</code></pre>

<p><strong>EDIT</strong><br>
based on some comments, here is a version using <code>sp_MSforeachdb</code>:</p>

<pre><code>sp_MSforeachdb 'select 
    ''?'' AS DatabaseName, o.name AS TableName,c.name AS ColumnName
    from sys.columns            c
        inner join ?.sys.objects  o on c.object_id=o.object_id
    --WHERE ''?'' NOT IN (''master'',''msdb'',''tempdb'',''model'')
    order by o.name,c.column_id'
</code></pre>
","2729160"
"Recover sa password","132688","","<p>I have a computer which was used by another employee.</p>

<p>SQL Server 2008 R2 was installed but I don't know the 'sa' password.</p>

<p>When I try to alter the login, it gives below error.</p>

<blockquote>
  <p>Cannot alter the login 'sa', because it does not exist or you do not have permission.</p>
</blockquote>

<p>When I try to restore a database, it gives a different permission error.</p>

<p>(When I enter the Security --> Logins --> sa --> Properties 
windows authentication is disabled.)</p>

<p>Can I change it?</p>

<p>P.S: Password is not ""password"" :)</p>
","<p>The best way is to simply reset the password by connecting with a domain/local admin (so you may need help from your system administrators), but this only works if SQL Server was set up to allow local admins (these are now left off the default admin group during setup).</p>

<p>If you can't use this or other existing methods to recover / reset the SA password, some of which are explained here:</p>

<ul>
<li><a href=""http://blogs.msdn.com/b/raulga/archive/2007/07/12/disaster-recovery-what-to-do-when-the-sa-account-password-is-lost-in-sql-server-2005.aspx"" rel=""noreferrer"">http://blogs.msdn.com/b/raulga/archive/2007/07/12/disaster-recovery-what-to-do-when-the-sa-account-password-is-lost-in-sql-server-2005.aspx</a></li>
<li><a href=""https://stackoverflow.com/questions/196150/is-there-a-way-i-can-retrieve-sa-password-in-sql-server-2005"">Is there a way I can retrieve sa password in sql server 2005</a></li>
<li><a href=""http://v-consult.be/2011/05/26/recover-sa-password-microsoft-sql-server-2008-r2/"" rel=""noreferrer"">http://v-consult.be/2011/05/26/recover-sa-password-microsoft-sql-server-2008-r2/</a></li>
</ul>

<p>Then you could always backup your important databases, uninstall SQL Server, and install a fresh instance.</p>

<p>You can also search for less scrupulous ways to do it (e.g. there are password crackers that I am not enthusiastic about sharing).</p>

<p>As an aside, the login properties for <code>sa</code> would never say Windows Authentication. This is by design as this is a SQL Authentication account. This does not mean that Windows Authentication is disabled at the instance level (in fact it is not possible to do so), it just doesn't apply for a SQL auth account.</p>

<p><strong>EDIT</strong> 2013-02-05</p>

<p>I also wrote a tip on using <a href=""http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx"" rel=""noreferrer"">PSExec</a> to connect to an instance using the <code>NT AUTHORITY\SYSTEM</code> account:</p>

<p><a href=""http://www.mssqltips.com/sqlservertip/2682/recover-access-to-a-sql-server-instance/"" rel=""noreferrer"">http://www.mssqltips.com/sqlservertip/2682/recover-access-to-a-sql-server-instance/</a></p>

<p>Also see these two resources:</p>

<p><a href=""http://technet.microsoft.com/en-us/library/dd207004.aspx"" rel=""noreferrer"">http://technet.microsoft.com/en-us/library/dd207004.aspx</a></p>

<p><a href=""http://sqlblog.com/blogs/argenis_fernandez/archive/2012/01/12/leveraging-service-sids-to-logon-to-sql-server-2012-instances-with-sysadmin-privileges.aspx"" rel=""noreferrer"">http://sqlblog.com/blogs/argenis_fernandez/archive/2012/01/12/leveraging-service-sids-to-logon-to-sql-server-2012-instances-with-sysadmin-privileges.aspx</a></p>
","11476059"
"How do I Create a Comma-Separated List using a SQL Query?","132645","","<p>I have 3 tables called:</p>

<ul>
<li>Applications (id, name)</li>
<li>Resources  (id, name)</li>
<li>ApplicationsResources (id, app_id, resource_id)</li>
</ul>

<p>I want to show on a GUI a table of all resource names. In one cell in each row I would like to list out all of the applications (comma separated) of that resource.</p>

<p>So the question is, what is the best way to do this in SQL as I need to get all resources and I also need to get all applications for each resource?</p>

<p>Do I run a select * from resources first and then loop through each resource and do a separate query per resource to get the list of applications for that resource?</p>

<p>Is there a way I can do this in one query?</p>
","<p>There is no way to do it in a DB-agnostic way.
So you need to get the whole data-set like this:</p>

<pre><code>select 
  r.name as ResName, 
  a.name as AppName
from 
  Resouces as r, 
  Applications as a, 
  ApplicationsResources as ar
where
  ar.app_id = a.id 
  and ar.resource_id = r.id
</code></pre>

<p>And then concat the <em>AppName</em> <strong>programmatically</strong> while grouping by <em>ResName</em>.  </p>
","1818073"
"SQL SELECT from multiple tables","132583","","<p>How can I get all products from customers1 and customers2 include their customer names?</p>

<pre><code>customer1 table
cid name1
1   john
2   joe

customer2 table
cid name2
p1  sandy
p2  linda

product table
pid cid pname
1   1   phone
2   2   pencil
3   p1  pen
4   p2  paper
</code></pre>

<p>Result should be like this</p>

<pre><code>pid  cid  pname  name1 name2
1    1    phone  john  NULL
2    2    pencil joe   NULL
3    p1   pen    NULL  sandy
4    p2   paper  NULL  linda
</code></pre>
","<pre><code>SELECT p.pid, p.cid, p.pname, c1.name1, c2.name2
FROM product p
LEFT JOIN customer1 c1 ON p.cid = c1.cid
LEFT JOIN customer2 c2 ON p.cid = c2.cid
</code></pre>
","1416023"
"GROUP BY to combine/concat a column","132564","","<p>I have a table as follow:</p>

<pre><code>ID  User  Activity  PageURL  
 1  Me    act1      ab     
 2  Me    act1      cd     
 3  You   act2      xy     
 4  You   act2      st
</code></pre>

<p>I want to group by User and Activity such that I end up with something like:</p>

<pre><code>User  Activity  PageURL  
Me    act1      ab, cd     
You   act2      xy, st
</code></pre>

<p>As you can see, the column PageURL is combined together separated by a comma based on the group by.</p>

<p>Would really appreciate any pointers and advice.</p>
","<pre><code>SELECT
     [User], Activity,
     STUFF(
         (SELECT DISTINCT ',' + PageURL
          FROM TableName
          WHERE [User] = a.[User] AND Activity = a.Activity
          FOR XML PATH (''))
          , 1, 1, '')  AS URLList
FROM TableName AS a
GROUP BY [User], Activity
</code></pre>

<ul>
<li><a href=""http://sqlfiddle.com/#!3/467bd/4"">SQLFiddle Demo</a></li>
</ul>
","15154723"
"Cannot connect to local SQL Server with Management Studio","131949","","<p>I'm having an issue with SQL Server, I have 2005 installed on my desktop as well as having SQL Server Management Studio installed..</p>

<p>I've checked and can see ""SQL Server (SQLEXPRESS)"" started in services.</p>

<p>I've tried to connect to ""Local"" and ""SQLEXPRESS"" but both fail to connect.</p>

<blockquote>
  <p>A network-related or instance-specific
  error occurred while establishing a
  connection to     SQL Server. The
  server was not found or was not
  accessible. Verify that the instance
  name is correct and that SQL Server is
  configured to allow remote
  connections. (provider: Named Pipes
  Provider, error: 40 - Could not open a
  connection to SQL Server) (.Net
  SqlClient Data Provider)</p>
</blockquote>

<p>Anything else I need to do to connect to it??</p>

<hr>

<h2>UPDATE</h2>

<p>I seem to be getting a little further along now. Ive managed to connect to my server with SQL Server Management (FYI .\SQLEXPRESS did the trick)  but now im having a issue with my connection string in my web.config</p>

<p>Ive im going to connect to this local sql server using windows authentication how do i need to structure it??</p>

<p>Something like this?</p>

<pre><code>&lt;add name=""BensBoxing"" connectionString=""Data Source=.\SQLEXPRESS;Initial Catalog=BritBoxing_Alpha;Integrated Security=False;User Instance=True"" providerName=""System.Data.SqlClient""/&gt;
</code></pre>

<p>This produces a error about </p>

<p>Login failed for user ''.</p>
","<p>Check the sql log in the LOG directory of your instance - see if anything is going on there.  You'll need to stop the service to open the log - or restart and you can read the old one - named with .1 on the end.</p>

<p>With the error you're getting, you need to enable TCP/IP or Named pipes for named connections.  Shared memory connection should work, but you seem to not be using that.  Are you trying to connect through SSMS?</p>

<p>In my log I see entries like this...</p>

<pre><code>Server local connection provider is ready to accept connection on [\\.\pipe\mssql$sqlexpress\sql\query ]
</code></pre>

<p>As the comments said, .\SQLEXPRESS should work.  Also worstationName\SQLEXPRESS will work.</p>
","4811649"
"Delete all data in SQL Server database","131804","","<p>How I can delete all records from all tables of my database? Can I do it with one SQL command or I need for one SQL command per one table?</p>
","<p>SQLMenace's solution worked for me with a slight tweak to how data is deleted - <code>DELETE FROM</code> instead of <code>TRUNCATE</code>.</p>

<pre><code>-- disable referential integrity
EXEC sp_MSForEachTable 'ALTER TABLE ? NOCHECK CONSTRAINT ALL' 
GO 

EXEC sp_MSForEachTable 'DELETE FROM ?' 
GO 

-- enable referential integrity again 
EXEC sp_MSForEachTable 'ALTER TABLE ? WITH CHECK CHECK CONSTRAINT ALL' 
GO
</code></pre>
","11770482"
"How to use variables in SQL statement in Python?","131718","","<p>Ok so I'm not that experienced in Python.</p>

<p>I have the following Python code: </p>

<pre><code>cursor.execute(""INSERT INTO table VALUES var1, var2, var3,"")
</code></pre>

<p>where <code>var1</code> is an integer, <code>var2</code> &amp; <code>var3</code> are strings.</p>

<p>How can I write the variable names without python including them as part of the query text?</p>
","<pre><code>cursor.execute(""INSERT INTO table VALUES (%s, %s, %s)"", (var1, var2, var3))
</code></pre>

<p>Note that the parameters are passed as a tuple.</p>

<p>The database API does proper escaping and quoting of variables. Be careful not to use the string formatting operator (<code>%</code>), because</p>

<ol>
<li>it does not do any escaping or quoting.</li>
<li>it is prone to Uncontrolled string format attacks e.g. <a href=""http://en.wikipedia.org/wiki/SQL_injection"" rel=""noreferrer"">SQL injection</a>.</li>
</ol>
","902417"
"SQL query to get most recent row for each instance of a given key","131710","","<p>I'm trying to get the ip, user, and most recent timestamp from a table which may contain both the current ip for a user and one or more prior ips. I'd like one row for each user containing the most recent ip and the associated timestamp. So if a table looks like this:</p>

<pre><code>username      |  ip      |  time_stamp  
--------------|----------|--------------  
ted           | 1.2.3.4  | 10  
jerry         | 5.6.6.7  | 12  
ted           | 8.8.8.8  | 30  
</code></pre>

<p>I'd expect the output of the query to be:</p>

<pre><code>jerry    |  5.6.6.7   |  12
ted      |  8.8.8.8   |  30  
</code></pre>

<p>Can I do this in a single sql query? In case it matters, the DBMS is Postgresql.</p>
","<p>Try this:</p>

<pre><code>Select u.[username]
      ,u.[ip]
      ,q.[time_stamp]
From [users] As u
Inner Join (
    Select [username]
          ,max(time_stamp) as [time_stamp]
    From [users]
    Group By [username]) As [q]
On u.username = q.username
And u.time_stamp = q.time_stamp
</code></pre>
","1140091"
"How do I cast a string to integer and have 0 in case of error in the cast with PostgreSQL?","131619","","<p>In PostgreSQL I have a table with a varchar column. The data is supposed to be integers and I need it in integer type in a query. Some values are empty strings.
The following:</p>

<pre><code>SELECT myfield::integer FROM mytable
</code></pre>

<p>yields <code>ERROR:  invalid input syntax for integer: """"</code></p>

<p>How can I query a cast and have 0 in case of error during the cast in postgres?</p>
","<p>I was just wrestling with a similar problem myself, but didn't want the overhead of a function. I came up with the following query:</p>

<pre><code>SELECT myfield::integer FROM mytable WHERE myfield ~ E'^\\d+$';
</code></pre>

<p>Postgres shortcuts its conditionals, so you shouldn't get any non-integers hitting your ::integer cast. It also handles NULL values (they won't match the regexp).</p>

<p>If you want zeros instead of not selecting, then a CASE statement should work:</p>

<pre><code>SELECT CASE WHEN myfield~E'^\\d+$' THEN myfield::integer ELSE 0 END FROM mytable;
</code></pre>
","2894527"
"Commands out of sync; you can't run this command now","131476","","<p>I am trying to execute my PHP code, which calls two MySQL queries via mysqli, and get the error ""Commands out of sync; you can't run this command now"".</p>

<p>Here is the code I am using</p>

<pre><code>&lt;?php
$con = mysqli_connect(""localhost"", ""user"", ""password"", ""db"");
if (!$con) {
    echo ""Can't connect to MySQL Server. Errorcode: %s\n"". Mysqli_connect_error();
    exit;
}
$con-&gt;query(""SET NAMES 'utf8'"");
$brand =""o"";
$countQuery = ""SELECT ARTICLE_NO FROM AUCTIONS WHERE upper(ARTICLE_NAME) LIKE % ? %"";
if ($numRecords = $con-&gt;prepare($countQuery)) {
    $numRecords-&gt;bind_param(""s"", $brand);
    $numRecords-&gt;execute();
    $data = $con-&gt;query($countQuery) or die(print_r($con-&gt;error));
    $rowcount = $data-&gt;num_rows;
    $rows = getRowsByArticleSearch(""test"", ""Auctions"", "" "");
    $last = ceil($rowcount/$page_rows);
}  else {

print_r($con-&gt;error);
}
foreach ($rows as $row) {
    $pk = $row['ARTICLE_NO'];
    echo '&lt;tr&gt;' . ""\n"";
    echo '&lt;td&gt;&lt;a href=""#"" onclick=""updateByPk(\'Layer2\', \'' . $pk . '\')""&gt;'.$row['USERNAME'].'&lt;/a&gt;&lt;/td&gt;' . ""\n"";
    echo '&lt;td&gt;&lt;a href=""#"" onclick=""updateByPk(\'Layer2\', \'' . $pk . '\')""&gt;'.$row['shortDate'].'&lt;/a&gt;&lt;/td&gt;' . ""\n"";
    echo '&lt;td&gt;&lt;a href=""#"" onclick=""deleterec(\'Layer2\', \'' . $pk . '\')""&gt;DELETE RECORD&lt;/a&gt;&lt;/td&gt;' . ""\n"";
    echo '&lt;/tr&gt;' . ""\n"";
}
function getRowsByArticleSearch($searchString, $table, $max) {
    $con = mysqli_connect(""localhost"", ""user"", ""password"", ""db"");
    $recordsQuery = ""SELECT ARTICLE_NO, USERNAME, ACCESSSTARTS, ARTICLE_NAME, date_format(str_to_date(ACCESSSTARTS, '%d/%m/%Y %k:%i:%s'), '%d %m %Y' ) AS shortDate FROM AUCTIONS WHERE upper(ARTICLE_NAME) LIKE '%?%' ORDER BY str_to_date(ACCESSSTARTS, '%d/%m/%Y %k:%i:%s')"" . $max;
    if ($getRecords = $con-&gt;prepare($recordsQuery)) {
        $getRecords-&gt;bind_param(""s"", $searchString);
        $getRecords-&gt;execute();
        $getRecords-&gt;bind_result($ARTICLE_NO, $USERNAME, $ACCESSSTARTS, $ARTICLE_NAME, $shortDate);
        while ($getRecords-&gt;fetch()) {
            $result = $con-&gt;query($recordsQuery);
            $rows = array();
            while($row = $result-&gt;fetch_assoc()) {
                $rows[] = $row;
            }
            return $rows;
        }
    }
}
</code></pre>

<p>I have tried reading up on this, but I am unsure of what to do. I have read about store result and free result, however these have made no difference when using them. I am unsure at exactly which point this error is being caused, and would like to know why it is being caused, and how to fix it.</p>

<p>Going by my debug statements, the first if loop for countQuery is not even being entered, because of an error in my sql syntax near near <code>'% ? %'</code>. However if I just select <code>*</code> instead of trying to limit based on a LIKE clause, I still get the command out of sync error.</p>
","<p>You can't have two simultaneous queries because mysqli uses unbuffered queries by default (for prepared statements; it's the opposite for vanilla <code>mysql_query</code>). You can either fetch the first one into an array and loop through that, or tell mysqli to buffer the queries (using <a href=""http://php.net/manual/en/mysqli-stmt.store-result.php"" rel=""noreferrer""><code>$stmt-&gt;store_result()</code></a>).</p>

<p>See <a href=""http://php.net/mysqli_query"" rel=""noreferrer"">here</a> for details.</p>
","614741"
"SQL Not Like Statement not working","131464","","<p>I have the following code within a stored procedure.</p>

<pre><code>WHERE
    WPP.ACCEPTED = 1 AND
    WPI.EMAIL LIKE '%@MATH.UCLA.EDU%' AND
    (WPP.SPEAKER = 0 OR
    WPP.SPEAKER IS NULL) AND
    WPP.COMMENT NOT LIKE '%CORE%' AND
    WPP.PROGRAMCODE = 'cmaws3'
</code></pre>

<p>The NOT LIKE statement is not working, and yes before anyone says anything there are items with the COMMENT column that does not include CORE and all the other columns are ok.</p>

<p>Does anyone know what is wrong with this?</p>
","<p>If <code>WPP.COMMENT</code> contains <code>NULL</code>, the condition will not match.</p>

<p>This query:</p>

<pre><code>SELECT  1
WHERE   NULL NOT LIKE '%test%'
</code></pre>

<p>will return nothing.</p>

<p>On a <code>NULL</code> column, both <code>LIKE</code> and <code>NOT LIKE</code> against any search string will return <code>NULL</code>.</p>

<p>Could you please post relevant values of a row which in your opinion should be returned but it isn't?</p>
","1638588"
"In SQL Server, how to create while loop in select","131257","","<p>data will be like this:</p>

<pre><code>    id  |  data
    ----|---------
    1   |  AABBCC
    2   |  FFDD
    3   |  TTHHJJKKLL
</code></pre>

<p>what the result I want is</p>

<pre><code>    id  |  data
    ----|---------
    1   |  AA
    1   |  BB
    1   |  CC
    2   |  FF
    2   |  DD
    3   |  TT
    3   |  HH
    3   |  JJ
    3   |  KK
    3   |  LL 
</code></pre>

<p>I have a sql code using cursor</p>

<pre><code>DECLARE @table2 table ( id INTEGER, data VARCHAR(500))

DECLARE Cur CURSOR FOR
SELECT id FROM table1

OPEN Cur 

WHILE ( @@FETCH_STATUS = 0 )
    BEGIN
        DECLARE @LoopNum INTEGER
        DECLARE @tempID INTEGER
        DECLARE @tempDATA VARCHAR(255)
        FETCH NEXT FROM Cur INTO @tempID
        SET @tempDATA = SELECT data from table1 where id = @teampID
        SET @LoopNUM = 0
        WHILE @LoopNum&lt; len(@tempDATA) / 2
            BEGIN
            INSERT INTO table2 (id, data)
            VALUES( @tempID, SUBSTRING(@tempDATA, @LoopNum * 2 +1, 2))
            SET @LoopNum = @LoopNum + 1
        END
    END

CLOSE Cur 
DEALLOCATE Cur 

SELECT * FROM table2
</code></pre>

<p>I don't want to use CURSOR because it's too slow, I have many data.
Does anyone has good idea for it? Is it possible?</p>
","<ol>
<li>Create function that parses incoming string (say ""AABBCC"") as a table of strings (in particular ""AA"", ""BB"", ""CC"").  </li>
<li>Select IDs from your table and use <a href=""http://technet.microsoft.com/en-us/library/ms175156%28v=sql.105%29.aspx"" rel=""nofollow"">CROSS APPLY</a> the function with <em>data</em> as argument so you'll have as many rows as values contained in the current row's <em>data</em>. No need of cursors or stored procs.</li>
</ol>
","19891679"
"How to check if field is null or empty mysql?","131206","","<p>I am trying to figure out how to check if a field is null or empty. I have this  </p>

<pre><code>SELECT IFNULL(field1, 'empty') as field1 from tablename. 
</code></pre>

<p>I need to add an additional check field1 != """" something like </p>

<pre><code>SELECT IFNULL(field1, 'empty') OR field1 != """"  as field1 from tablename. 
</code></pre>

<p>Any idea how to accomplish this?</p>
","<p>Either use</p>

<pre><code>SELECT IF(field1 IS NULL or field1 = '', 'empty', field1) as field1 
from tablename
</code></pre>

<p>or</p>

<pre><code>SELECT case when field1 IS NULL or field1 = ''
            then 'empty'
            else field1
       end as field1 
from tablename
</code></pre>

<p>If you only want to check for <code>null</code> and not for empty strings then you can also use <code>ifnull</code> as you tried. But that is not suitable for empty strings too.</p>
","17832946"
"MySQL Error: ""an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax""","131153","","<p>I am getting this error from MySQL:</p>

<pre><code>You have an error in your SQL syntax; check the manual that corresponds to 
your MySQL server version for the right syntax to use near 'Details 
(title, first, last, NRIC, po' at line 1
</code></pre>

<p>Here is the code:</p>

<pre><code>&lt;?php
  $link = mysql_connect(""localhost"", ""root"", """");
  if (!$link) { die('Could not connect: ' . mysql_error()); }

  $db_selected = mysql_select_db(Membership, $link);
  if (!$db_selected) { die('Can\'t use' . Membership . ':' . mysql_error()); }

  $value1 = $_POST[""title""];
  $value2 = $_POST[""first""];
  $value3 = $_POST[""last""];
  $value4 = $_POST[""NRIC""];
  $value5 = $_POST[""birthdate""];
  $value6 = $_POST[""birthmonth""];
  $value7 = $_POST[""birthyear""];
  $value8 = $_POST[""address""];
  $value9 = $_POST[""postal""];
  $value10 = $_POST[""genderSelect""];
  $value11 = $_POST[""contact""];
  $value12 = $_POST[""email""];
  $value13 = $_POST[""enter""];
  $value14 = $_POST[""password""];
  $value15 = $_POST[""Updates""];
  $value16 = $_POST[""Terms""];
  $value17 = $_POST[""submit_but""];
  $value18 = $_POST[""status""];

  $sql = ""INSERT INTO Member Details (title, first, last, NRIC, birthdate, birthmonth, birthyear, address, postal, genderSelect, contact, email, enter, password, Updates, Terms, submit_but, status) VALUES ('$value', '$value2', '$value3', '$value4', '$value5', '$value6', '$value7', '$value8', '$value9', '$value10', '$value11', '$value12', '$value13', '$value14', '$value15', '$value16', '$value17', '$value18')"";

  if (!mysql_query($sql)){     //The error is thrown here
   die('Error: ' . mysql_error());
  }
  mysql_close();
?&gt;
</code></pre>
","<p>Your problem lies here:</p>

<pre><code>INSERT INTO Member Details ...
</code></pre>

<p>Because you have a space there, it thinks <code>Member</code> is the table name and <code>Details</code> is extraneous, hence the error.</p>

<p>If your table is <code>Member Details</code>, you need to enclose it within back ticks:</p>

<pre><code>INSERT INTO `Member Details` ...
</code></pre>

<hr>

<p>I'm actually not that big a fan of spaces in SQL table names (or filesystem file names for that matter). In this particular case, I believe <code>MemberDetails</code> (or <code>Member_Details</code>, <code>member_details</code> and probably others) is just as readable, <em>without</em> requiring the use of backticks scattered throughout your code.</p>
","7884552"
"How to select bottom most rows?","131145","","<p>I can do SELECT TOP (200) ... but why not BOTTOM (200)?</p>

<p>Well not to get into philosophy what I mean is, how can I do the equivalent of TOP (200) but in reverse (from the bottom, like you'd expect BOTTOM to do...)?</p>
","<pre><code>SELECT
    columns
FROM
(
     SELECT TOP 200
          columns
     FROM
          My_Table
     ORDER BY
          a_column DESC
) SQ
ORDER BY
     a_column ASC
</code></pre>
","1876620"
"A beginner's guide to SQL database design","131092","","<p>Do you know a good source to learn how to design SQL solutions?</p>

<p>Beyond the basic language syntax, I'm looking for something to help me understand:</p>

<ol>
<li>What tables to build and how to link them</li>
<li>How to design for different scales (small client APP to a huge distributed website)</li>
<li>How to write effective / efficient  / elegant SQL queries</li>
</ol>
","<p>I started with this book: <a href=""http://www.amazon.co.uk/Relational-Database-Explained-Kaufmann-Management/dp/1558608206/ref=sr_1_3?ie=UTF8&amp;s=books&amp;qid=1229597641&amp;sr=8-3"" rel=""noreferrer"">Relational Database Design Clearly Explained (The Morgan Kaufmann Series in Data Management Systems) (Paperback)</a> by Jan L. Harrington  and found it very clear and helpful</p>

<p>and as you get up to speed this one was good too <a href=""http://www.amazon.co.uk/Database-Systems-Implementation-Management-International/dp/0321210255/ref=cm_lmf_tit_5_rsrrsi0"" rel=""noreferrer"">Database Systems: A Practical Approach to Design, Implementation and Management (International Computer Science Series)</a> (Paperback)</p>

<p>I think SQL and database design are <strong>different</strong> (but complementary) skills.</p>
","377512"
"How do I do a simple 'Find and Replace"" in MsSQL?","131032","","<p>Question is pretty self explanitory. I want to do a simple find and replace, like you would in a text editor on the data in a column of my database (which is MsSQL on MS Windows server 2003)</p>
","<p>The following query replace each and every <code>a</code> character with a <code>b</code> character.</p>

<pre><code>UPDATE 
    YourTable
SET 
    Column1 = REPLACE(Column1,'a','b')
WHERE 
    Column1 LIKE '%a%'
</code></pre>

<p>This will not work on SQL server 2003.</p>
","59055"
"Incorrect syntax near ''","131025","","<p>I'm trying to run the following fairly simple query in SQL Server Management Studio:</p>

<pre><code>SELECT TOP 1000 * 
FROM 
    master.sys.procedures as procs
left join 
    master.sys.parameters as params on procs.object_id = params.object_id
</code></pre>

<p>This seems totally correct, but I keep getting the following error:</p>

<blockquote>
  <p>Msg 102, Level 15, State 1, Line 6<br>
  Incorrect syntax near ''.</p>
</blockquote>

<p>It works if I take out the join and only do a simple select:</p>

<pre><code>SELECT TOP 1000 *
FROM 
    master.sys.procedures as procs
</code></pre>

<p>But I need the join to work. I don't even <strong>have</strong> the string '' in this query, so I can't figure out what it doesn't like.  </p>
","<p>Such unexpected problems can appear when you copy the code from a web page or email and the text contains unprintable characters like individual CR or LF and non-braking spaces.</p>
","19763826"
"SQL Server - transactions roll back on error?","130929","","<p>We have client app that is running some SQL on a SQL Server 2005 such as the following:</p>

<pre><code>BEGIN TRAN;
INSERT INTO myTable (myColumns ...) VALUES (myValues ...);
INSERT INTO myTable (myColumns ...) VALUES (myValues ...);
INSERT INTO myTable (myColumns ...) VALUES (myValues ...);
COMMIT TRAN;
</code></pre>

<p>It is sent by one long string command.</p>

<p>If one of the inserts fail, or any part of the command fails, does SQL Server roll back the transaction?  If it does not rollback, do I have to send a second command to roll it back?</p>

<p>I can give specifics about the api and language I'm using, but I would think SQL Server should respond the same for any language.</p>
","<p>You can put <code>set xact_abort on</code> before your transaction to make sure sql rolls back automatically in case of error.</p>
","1749788"
"Operand type clash: int is incompatible with date + The INSERT statement conflicted with the FOREIGN KEY constraint","130746","","<pre><code>create table pilot (
emp_num int,
pl_license varchar (3),
pl_ratings varchar (30),
pl_med_type int,
pl_med_date date,
pl_pt135_date date,
constraint PK_pilot primary key (emp_num)
)

insert into pilot(emp_num,pl_license,pl_ratings,pl_med_type,pl_med_date,pl_pt135_date)
values (101,'ATP','SEL/MEL/instr/CFII',1,12-4-2005,15-6-2005)
insert into pilot(emp_num,pl_license,pl_ratings,pl_med_type,pl_med_date,pl_pt135_date)
values (104,'ATP','SEL/MEL/instr',1,10-5-2005,23-3-2006)
insert into pilot(emp_num,pl_license,pl_ratings,pl_med_type,pl_med_date,pl_pt135_date)
values (105,'COM','SEL/MEL/instr/CFI',2,25-2-2006,12-2-2005)
insert into pilot(emp_num,pl_license,pl_ratings,pl_med_type,pl_med_date,pl_pt135_date)
values (106,'COM','SEL/MEL/instr',2,02-4-2006,24-12-2005)
insert into pilot(emp_num,pl_license,pl_ratings,pl_med_type,pl_med_date,pl_pt135_date)
      values (109,'COM','SEL/MEL/instr/CFII',1,14-4-2006,21-4-2006)
</code></pre>

<p>My question is there is an error in every insert </p>

<blockquote>
  <p>Operand type clash: int is incompatible with date</p>
</blockquote>

<p>How to fix this?    </p>

<hr>

<p>Also here ... </p>

<pre><code>create table employee (
emp_num int,
constraint PK_employee primary key (emp_num),
foreign key(emp_num) references pilot(emp_num),
emp_title varchar (4),
emp_lname varchar (20),
emp_fname varchar (30),
emp_initial varchar (2),
emp_dob date,
emp_hire_date date, 
)
insert into employee(emp_num,emp_title,emp_lname,emp_fname,emp_initial,emp_dob,emp_hire_date)
values (100,'Mr.','Kolmycz','George','D',15-5-1942,15-3-1987)
insert into employee(emp_num,emp_title,emp_lname,emp_fname,emp_initial,emp_dob,emp_hire_date)
values (101,'Ms.','Lewis','Rhonda','G',19-3-1965,25-4-1988)
insert into employee(emp_num,emp_title,emp_lname,emp_fname,emp_initial,emp_dob,emp_hire_date)
values (102,'Mr.','Vandam','Rhett',' ',14-11-1958,20-12-1992)
insert into employee(emp_num,emp_title,emp_lname,emp_fname,emp_initial,emp_dob,emp_hire_date)
values (103,'Ms.','Jones','Anne','M',16-10-1974,28-8-2005)
insert into employee(emp_num,emp_title,emp_lname,emp_fname,emp_initial,emp_dob,emp_hire_date)
values (104,'Mr.','Lange','John','P',08-11-1971,20-10-1996)
insert into employee(emp_num,emp_title,emp_lname,emp_fname,emp_initial,emp_dob,emp_hire_date)
values (105,'Mr.','williams','Robert','D',14-3-1975,08-1-2006)
insert into employee(emp_num,emp_title,emp_lname,emp_fname,emp_initial,emp_dob,emp_hire_date)
values (106,'Mrs.','Duzak','Jeanine','K',12-2-1968,05-1-1991)
insert into employee(emp_num,emp_title,emp_lname,emp_fname,emp_initial,emp_dob,emp_hire_date)
values (107,'Mr.','Diante','Jorge','D',21-8-1974,05-1-1991)
insert into employee(emp_num,emp_title,emp_lname,emp_fname,emp_initial,emp_dob,emp_hire_date)
values (108,'Mr.','Wlesenbach','Paul','R',14-2-1966,18-11-1994)
insert into employee(emp_num,emp_title,emp_lname,emp_fname,emp_initial,emp_dob,emp_hire_date)
values (109,'Ms.','Travis','Elizabeth','K',18-6-1961,14-4-1991)
insert into employee(emp_num,emp_title,emp_lname,emp_fname,emp_initial,emp_dob,emp_hire_date)
values (110,'Mrs.','Genkazi','Leighla','W',19-5-1970,01-12-1992)        
</code></pre>

<blockquote>
  <p>Msg 547, Level 16, State 0, Line 1
  The INSERT statement conflicted with the FOREIGN KEY constraint ""FK__crew__emp_num__0F975522"". The conflict occurred in database ""melisa"", table ""dbo.employee"", column 'emp_num'. error on
  this table</p>
</blockquote>

<pre><code>create table earndrating(
emp_num int,
constraint PK_earndarating primary key(emp_num, rtg_code),
rtg_code varchar(6),
foreign key (emp_num) references pilot(emp_num),
foreign key(rtg_code) references rating(rtg_code),
earningth_date varchar(20),
)
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(101,'CFI','18-Feb-98' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(101,'CFII','14-Dec-05' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(101,'INSTR','08-Nov-93' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(101,'MEL','23-Jun-94' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(101,'SEL','21-Apr-93' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(104,'INSTR','14-Jul-96' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(104,'MEL','29-Jan-97' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(104,'SEL','12-Mar-95' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(105,'CFI','18-Nov-97' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(105,'INSTR','17-Apr-95' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(105,'MEL','12-Aug-95' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(105,'SEL','23-Sep-94' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(106,'INSTR','20-Dec-95' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(106,'MEL','02-Apr-95' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(105,'SEL','10-Mar-94' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(109,'CFI','05-Nov-98' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(109,'CFII','21-Jun-03' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(109,'INSTR','23-Jul-96' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(109,'MEL','15-Marc-97' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(109,'SEL','05-Feb-96' )
    insert into earndrating(emp_num,rtg_code,earningth_date)
    values(109,'SES','12-May-96' )
</code></pre>
","<p>This expression <code>12-4-2005</code> is a calculated int and the value is <code>-1997</code>. You should do like this instead <code>'2005-04-12'</code> with the <code>'</code> before and after.</p>
","7176687"
"SQL query to make all data in a column UPPER CASE?","130739","","<p>I need a SQL query to make all data in a column UPPER CASE?</p>

<p>Any ideas?</p>
","<p>Permanent:</p>

<pre><code>UPDATE
  MyTable
SET
  MyColumn = UPPER(MyColumn)
</code></pre>

<p>Temporary:</p>

<pre><code>SELECT
  UPPER(MyColumn) AS MyColumn
FROM
  MyTable
</code></pre>
","858542"
"Return 0 if field is null in MySQL","130683","","<p>In MySQL, is there a way to set the ""total"" fields to zero if they are NULL?</p>

<p>Here is what I have:</p>

<pre><code>SELECT uo.order_id, uo.order_total, uo.order_status,
            (SELECT SUM(uop.price * uop.qty) 
             FROM uc_order_products uop 
             WHERE uo.order_id = uop.order_id
            ) AS products_subtotal,
            (SELECT SUM(upr.amount) 
             FROM uc_payment_receipts upr 
             WHERE uo.order_id = upr.order_id
            ) AS payment_received,
            (SELECT SUM(uoli.amount) 
             FROM uc_order_line_items uoli 
             WHERE uo.order_id = uoli.order_id
            ) AS line_item_subtotal
            FROM uc_orders uo
            WHERE uo.order_status NOT IN (""future"", ""canceled"")
            AND uo.uid = 4172;
</code></pre>

<p>The data comes out fine, except the NULL fields should be <code>0</code>.</p>

<p>How can I return 0 for NULL in MySQL?</p>
","<p>Use <a href=""http://dev.mysql.com/doc/refman/5.0/en/control-flow-functions.html#function_ifnull"" rel=""noreferrer"">IFNULL</a>:</p>

<pre><code>IFNULL(expr1, 0)
</code></pre>

<p>From the documentation:</p>

<blockquote>
  <p>If expr1 is not NULL, IFNULL() returns expr1; otherwise it returns expr2. IFNULL() returns a numeric or string value, depending on the context in which it is used. </p>
</blockquote>
","3997340"
"How to drop SQL default constraint without knowing its name?","130521","","<p>In Microsoft SQL Server, I know the query to check if a default constraint exists for a column and drop a default constraint is:</p>

<pre><code>IF EXISTS(SELECT * FROM sysconstraints
  WHERE id=OBJECT_ID('SomeTable')
  AND COL_NAME(id,colid)='ColName'
  AND OBJECTPROPERTY(constid, 'IsDefaultCnst')=1)    
ALTER TABLE SomeTable DROP CONSTRAINT DF_SomeTable_ColName
</code></pre>

<p>But due to typo in previous versions of the database, the name of the constraint could be <code>DF_SomeTable_ColName</code> or <code>DF_SmoeTable_ColName</code>.</p>

<p>How can I delete the default constraint without any SQL errors? Default constraint names don't show up in INFORMATION_SCHEMA table, which makes things a bit trickier.</p>

<p>So, something like 'delete the default constraint in this table/column', or 'delete <code>DF_SmoeTable_ColName</code>', but don't give any errors if it can't find it.</p>
","<p>Expanding on Mitch Wheat's code, the following script will generate the command to drop the constraint and dynamically execute it.</p>

<pre><code>declare @schema_name nvarchar(256)
declare @table_name nvarchar(256)
declare @col_name nvarchar(256)
declare @Command  nvarchar(1000)

set @schema_name = N'MySchema'
set @table_name = N'Department'
set @col_name = N'ModifiedDate'

select @Command = 'ALTER TABLE ' + @schema_name + '.' + @table_name + ' drop constraint ' + d.name
 from sys.tables t
  join    sys.default_constraints d
   on d.parent_object_id = t.object_id
  join    sys.columns c
   on c.object_id = t.object_id
    and c.column_id = d.parent_column_id
 where t.name = @table_name
  and t.schema_id = schema_id(@schema_name)
  and c.name = @col_name

--print @Command

execute (@Command)
</code></pre>
","1433384"
"tSQL - Conversion from varchar to numeric works for all but integer","130518","","<p>I have a table with numbers in a <code>varchar(255)</code> field. They're all greater than one and have multiple decimal places. I'd like to convert them to integers. According to every web site I've consulted, including <a href=""https://stackoverflow.com/questions/728833/convert-a-string-to-int-using-sql-query""> this one on StackOverflow</a>, either of these should work:</p>

<pre><code>SELECT CAST(VarcharCol AS INT) FROM MyTable

SELECT CONVERT(INT, VarcharCol) FROM MyTable
</code></pre>

<p>These both work for me for every kind of numeric value but <code>integer</code> - I can convert to <code>float</code>, <code>decimal</code>, etc. just fine, but trying to convert to <code>integer</code> gives me the following error:</p>

<pre><code>Conversion failed when converting the varchar value '7082.7758172' 
to data type int.
</code></pre>

<p>I've worked around the problem by converting to data type <code>Decimal(6,0)</code>, which works fine. But just for my education, can anyone tell me why converting to data type <code>int</code> (or <code>integer</code>) gives me an error? Thanks.</p>
","<p>Converting a VARCHAR value into an INT fails when there are digits to the right of the decimal to prevent loss of data.</p>

<p>If you convert to FLOAT first, then convert to INT, the conversion works.</p>

<pre><code>SELECT CAST(CAST('7082.7758172' as float) as int)
</code></pre>

<p>returns</p>

<pre><code>7082
</code></pre>
","18877185"
"MySQL Trigger after update only if row has changed","130505","","<p>Is there any possibility to use an ""after update"" trigger only in the case the data has been REALLY changed.
I know of ""NEW and OLD"". But when using them I'm only able to compare columns.
For example ""NEW.count &lt;> OLD.count"".</p>

<p>But I want something like: run trigger if ""NEW &lt;> OLD""</p>

<p>An Example:</p>

<pre><code>create table foo (a INT, b INT);
create table bar (a INT, b INT);

INSERT INTO foo VALUES(1,1);
INSERT INTO foo VALUES(2,2);
INSERT INTO foo VALUES(3,3);

CREATE TRIGGER ins_sum
    AFTER UPDATE ON foo
    FOR EACH ROW
    INSERT INTO bar VALUES(NEW.a, NEW.b);

UPDATE foo SET b = 3 WHERE a=3;
Query OK, 0 rows affected (0.00 sec)
Rows matched: 1  Changed: 0  Warnings: 0


select * from bar;
+------+------+
| a    | b    |
+------+------+
|    3 |    3 |
+------+------+
</code></pre>

<p>The point is, there was an update, but <strong>nothing has changed</strong>.
But the trigger ran anyway. IMHO there should be a way it doesn't.</p>

<p>I know that I could have used </p>

<blockquote>
  <p>IF NOW.b &lt;> OLD.b</p>
</blockquote>

<p>for this example.</p>

<p>BUT imagine a large table with changing columns.
You have to compare every column and if the database changes you have to adjust the trigger.
AND it doesn't ""feel"" good to compare every column of the row hardcoded :)</p>

<p><strong>Addition</strong></p>

<p>As you can see on the line </p>

<blockquote>
  <p>Rows matched: 1  Changed: 0  Warnings: 0</p>
</blockquote>

<p>MySQL knows that the line didn't change. But it doesn't share this knowledge with the trigger.
A trigger like ""AFTER REAL UPDATE"" or something like this would be cool.</p>
","<p>As a workaround, you could use the timestamp (old and new) for checking though, that one is <em>not</em> updated when there are no changes to the row. (Possibly that is the source for confusion? Because that one is also called 'on update' but is not executed when no change occurs)
Changes within one second will then not execute that part of the trigger, but in some cases that could be fine (like when you have an application that rejects fast changes anyway.)</p>

<p>For example, rather than</p>

<pre><code>IF NEW.a &lt;&gt; OLD.a or NEW.b &lt;&gt; OLD.b /* etc, all the way to NEW.z &lt;&gt; OLD.z */ 
THEN  
  INSERT INTO bar (a, b) VALUES(NEW.a, NEW.b) ;
END IF
</code></pre>

<p>you could use</p>

<pre><code>IF NEW.ts &lt;&gt; OLD.ts 
THEN  
  INSERT INTO bar (a, b) VALUES(NEW.a, NEW.b) ;
END IF
</code></pre>

<p>Then you don't have to change your trigger every time you update the scheme (the issue you mentioned in the question.)</p>

<p><strong>EDIT: Added full example</strong></p>

<pre><code>create table foo (a INT, b INT, ts TIMESTAMP);
create table bar (a INT, b INT);

INSERT INTO foo (a,b) VALUES(1,1);
INSERT INTO foo (a,b) VALUES(2,2);
INSERT INTO foo (a,b) VALUES(3,3);

DELIMITER ///

CREATE TRIGGER ins_sum AFTER UPDATE ON foo
    FOR EACH ROW
    BEGIN
        IF NEW.ts &lt;&gt; OLD.ts THEN  
            INSERT INTO bar (a, b) VALUES(NEW.a, NEW.b);
        END IF;
    END;
///

DELIMITER ;

select * from foo;
+------+------+---------------------+
| a    | b    | ts                  |
+------+------+---------------------+
|    1 |    1 | 2011-06-14 09:29:46 |
|    2 |    2 | 2011-06-14 09:29:46 |
|    3 |    3 | 2011-06-14 09:29:46 |
+------+------+---------------------+
3 rows in set (0.00 sec)

-- UPDATE without change
UPDATE foo SET b = 3 WHERE a = 3;
Query OK, 0 rows affected (0.00 sec)
Rows matched: 1  Changed: 0  Warnings: 0

-- the timestamo didnt change
select * from foo WHERE a = 3;
+------+------+---------------------+
| a    | b    | ts                  |
+------+------+---------------------+
|    3 |    3 | 2011-06-14 09:29:46 |
+------+------+---------------------+
1 rows in set (0.00 sec)

-- the trigger didn't run
select * from bar;
Empty set (0.00 sec)

-- UPDATE with change
UPDATE foo SET b = 4 WHERE a=3;
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

-- the timestamp changed
select * from foo;
+------+------+---------------------+
| a    | b    | ts                  |
+------+------+---------------------+
|    1 |    1 | 2011-06-14 09:29:46 |
|    2 |    2 | 2011-06-14 09:29:46 |
|    3 |    4 | 2011-06-14 09:34:59 |
+------+------+---------------------+
3 rows in set (0.00 sec)

-- and the trigger ran
select * from bar;
+------+------+---------------------+
| a    | b    | ts                  |
+------+------+---------------------+
|    3 |    4 | 2011-06-14 09:34:59 |
+------+------+---------------------+
1 row in set (0.00 sec)
</code></pre>

<p>It is working because of mysql's behavior on handling timestamps.
The time stamp is only updated if a change occured in the updates.</p>

<p>Documentation is here:<br>
<a href=""https://dev.mysql.com/doc/refman/5.7/en/timestamp-initialization.html"" rel=""noreferrer"">https://dev.mysql.com/doc/refman/5.7/en/timestamp-initialization.html</a></p>

<pre><code>desc foo;
+-------+-----------+------+-----+-------------------+-----------------------------+
| Field | Type      | Null | Key | Default           | Extra                       |
+-------+-----------+------+-----+-------------------+-----------------------------+
| a     | int(11)   | YES  |     | NULL              |                             |
| b     | int(11)   | YES  |     | NULL              |                             |
| ts    | timestamp | NO   |     | CURRENT_TIMESTAMP | on update CURRENT_TIMESTAMP |
+-------+-----------+------+-----+-------------------+-----------------------------+
</code></pre>
","6298881"
"Can table columns with a foreign key be null?","130420","","<p>For example, I have a table which has several ID columns to other tables. I want a foreign key to force integrity only if I do put data in there. If I do an update at a later time to populate that column then it will still check the constraint (this is likely database server dependant, i'm using MySQL &amp; InnoDB table type). I believe this is a reasonable expectation, but correct me if I am wrong.</p>
","<p>Yes, you can enforce the constraint only when the value is not NULL. This can be easily tested with the following example:</p>

<pre><code>CREATE DATABASE t;
USE t;

CREATE TABLE parent (id INT NOT NULL,
                     PRIMARY KEY (id)
) ENGINE=INNODB;

CREATE TABLE child (id INT NULL, 
                    parent_id INT NULL,
                    FOREIGN KEY (parent_id) REFERENCES parent(id)
) ENGINE=INNODB;


INSERT INTO child (id, parent_id) VALUES (1, NULL);
-- Query OK, 1 row affected (0.01 sec)


INSERT INTO child (id, parent_id) VALUES (2, 1);

-- ERROR 1452 (23000): Cannot add or update a child row: a foreign key 
-- constraint fails (`t/child`, CONSTRAINT `child_ibfk_1` FOREIGN KEY
-- (`parent_id`) REFERENCES `parent` (`id`))
</code></pre>

<p>The first insert will pass because we insert a NULL in the <code>parent_id</code>. The second insert fails because of the foreign key constraint, since we tried to insert a value that does not exist in the <code>parent</code> table.</p>
","2366979"
"How to do select from where x is equal to multiple values?","130285","","<p>So I', debugging some code and there is the following SQL query (simplified from what it really is).</p>

<pre><code>SELECT ads.*, location.county 
FROM ads
LEFT JOIN location ON location.county = ads.county_id
WHERE ads.published = 1 
AND ads.type = 13
AND ads.county_id = 2
OR ads.county_id = 5
OR ads.county_id = 7
OR ads.county_id = 9
</code></pre>

<p>I'm getting very strange results from the query and I think its because the first OR is negating the AND 's that are before it. So I am getting results back for ads of all types and not just of type 13. Each time the query is called there may be many county's that need looking up or just a few.</p>

<p>Any help on the correct way to go about this would be appreciated.  </p>
","<p>Put parentheses around the ""OR""s:</p>

<pre><code>SELECT ads.*, location.county 
FROM ads
LEFT JOIN location ON location.county = ads.county_id
WHERE ads.published = 1 
AND ads.type = 13
AND
(
    ads.county_id = 2
    OR ads.county_id = 5
    OR ads.county_id = 7
    OR ads.county_id = 9
)
</code></pre>

<p>Or even better, use IN:</p>

<pre><code>SELECT ads.*, location.county 
FROM ads
LEFT JOIN location ON location.county = ads.county_id
WHERE ads.published = 1 
AND ads.type = 13
AND ads.county_id IN (2, 5, 7, 9)
</code></pre>
","261788"
"Why is SQL server throwing this error: Cannot insert the value NULL into column 'id'?","130178","","<p>I'm using the following query:</p>

<pre><code>INSERT INTO role (name, created) VALUES ('Content Coordinator', GETDATE()), ('Content Viewer', GETDATE())
</code></pre>

<p>However, I'm not specifying the primary key (which is <code>id</code>).  So my questions is, why is sql server coming back with this error: </p>

<pre><code>Msg 515, Level 16, State 2, Line 1
Cannot insert the value NULL into column 'id', table 'CMT_DEV.dbo.role'; column does not allow nulls. INSERT fails.
The statement has been terminated.
</code></pre>
","<p>I'm assuming that <code>id</code> is supposed to be an incrementing value.</p>

<p>You need to set this, or else if you have a non-nullable column, with no default value, if you provide no value it will error.</p>

<p>To set up auto-increment in SQL Server Management Studio:</p>

<ul>
<li>Open your table in <code>Design</code></li>
<li>Select your column and go to <code>Column Properties</code></li>
<li>Under <code>Indentity Specification</code>, set <code>(Is Identity)=Yes</code> and <code>Indentity Increment=1</code></li>
</ul>
","10013372"
"Using SELECT result in another SELECT","129893","","<p>So here is my query</p>

<pre><code>SELECT 
    * 
FROM 
    Score  AS NewScores 
WHERE 
    InsertedDate &gt;= DATEADD(mm, -3, GETDATE());


SELECT 
    ROW_NUMBER() OVER( ORDER BY NETT) AS Rank, 
    Name, 
    FlagImg, 
    Nett, 
    Rounds 
FROM (
    SELECT 
        Members.FirstName + ' ' + Members.LastName AS Name, 
        CASE 
            WHEN MenuCountry.ImgURL IS NULL THEN 
                '~/images/flags/ismygolf.png' 
            ELSE 
                MenuCountry.ImgURL 
        END AS FlagImg, 
        AVG(CAST(NewScores.NetScore AS DECIMAL(18, 4))) AS Nett, 
        COUNT(Score.ScoreID) AS Rounds 
    FROM 
        Members 
        INNER JOIN 
        Score 
            ON Members.MemberID = Score.MemberID 
        LEFT OUTER JOIN MenuCountry 
            ON Members.Country = MenuCountry.ID 
    WHERE 
        Members.Status = 1 
    GROUP BY 
        Members.FirstName + ' ' + Members.LastName, 
        MenuCountry.ImgURL
    ) AS Dertbl 
ORDER BY;
</code></pre>

<p>The query is to give a result set for a GridView based leaderboard and what I want is to only get the average of Scores that are less than 3 months old. I have this in 2 parts as you can see and obviously it gives an error like this.</p>

<blockquote>
  <p>Msg 4104, Level 16, State 1, Line 2</p>
  
  <p>The multi-part identifier ""<code>NewScores.NetScore</code>"" could not be bound.</p>
</blockquote>

<p>Which is because of this <code>AVG(CAST(NewScores.NetScore AS DECIMAL(18, 4))) AS Nett</code></p>

<p>How do I make it so that I can use <code>NewScores</code> there so I'm only getting the average of the scores less than 3 months old?</p>

<p>EDIT: Using the answers people provided I've solved it by using a join in the correct place and here is the correct query:</p>

<pre><code>SELECT ROW_NUMBER() OVER(ORDER BY NETT) AS Rank, Name, FlagImg, Nett, Rounds FROM (SELECT Members.FirstName + ' ' + Members.LastName AS Name, CASE WHEN MenuCountry.ImgURL IS NULL THEN '~/images/flags/ismygolf.png' ELSE MenuCountry.ImgURL END AS FlagImg, AVG(CAST(NewScores.NetScore AS DECIMAL(18, 4))) AS Nett, COUNT(NewScores.ScoreID) AS Rounds FROM Members INNER JOIN (SELECT * FROM Score WHERE InsertedDate &gt;= DATEADD(mm, -5, GETDATE())) NewScores ON Members.MemberID = NewScores.MemberID LEFT OUTER JOIN MenuCountry ON Members.Country = MenuCountry.ID WHERE Members.Status = 1 GROUP BY Members.FirstName + ' ' + Members.LastName, MenuCountry.ImgURL) AS Dertbl ORDER BY Nett ASC
</code></pre>
","<p>NewScores is an alias to Scores table - it looks like you can combine the queries as follows:</p>

<pre><code>SELECT 
    ROW_NUMBER() OVER( ORDER BY NETT) AS Rank, 
    Name, 
    FlagImg, 
    Nett, 
    Rounds 
FROM (
    SELECT 
        Members.FirstName + ' ' + Members.LastName AS Name, 
        CASE 
            WHEN MenuCountry.ImgURL IS NULL THEN 
                '~/images/flags/ismygolf.png' 
            ELSE 
                MenuCountry.ImgURL 
        END AS FlagImg, 
        AVG(CAST(NewScores.NetScore AS DECIMAL(18, 4))) AS Nett, 
        COUNT(Score.ScoreID) AS Rounds 
    FROM 
        Members 
        INNER JOIN 
        Score NewScores
            ON Members.MemberID = NewScores.MemberID 
        LEFT OUTER JOIN MenuCountry 
            ON Members.Country = MenuCountry.ID 
    WHERE 
        Members.Status = 1 
        AND NewScores.InsertedDate &gt;= DATEADD(mm, -3, GETDATE())
    GROUP BY 
        Members.FirstName + ' ' + Members.LastName, 
        MenuCountry.ImgURL
    ) AS Dertbl 
ORDER BY;
</code></pre>
","15961462"
"SQL Error: ORA-00933: SQL command not properly ended","129825","","<p>I am trying to update a record in oracle SQL developer by using Joins.
Following is my query-</p>

<pre><code>UPDATE system_info set field_value = 'NewValue' 
FROM system_users users 
JOIN system_info info ON users.role_type = info.field_desc 
where users.user_name = 'uname'
</code></pre>

<p>However, when I tried to execute it, I got following error-</p>

<pre><code>Error report: SQL Error: ORA-00933: SQL command not properly ended 
              00933. 00000 - ""SQL command not properly ended""
</code></pre>

<p>I tried removing JOINS</p>

<pre><code>UPDATE system_info info 
SET info.field_value = 'NewValue' 
FROM system_users users 
where users.user_name = 'uname' AND users.role_type = info.field_desc
</code></pre>

<p>but still having same error
can anybody tell me the error reason and solution</p>
","<p>Oracle does not allow joining tables in an UPDATE statement. You need to rewrite your statement with a co-related sub-select</p>

<p>Something like this: </p>

<pre><code>UPDATE system_info
SET field_value = 'NewValue' 
WHERE field_desc IN (SELECT role_type 
                     FROM system_users 
                     WHERE user_name = 'uname')
</code></pre>

<p>For a complete description on the (valid) syntax of the UPDATE statement, please read the manual:</p>

<p><a href=""http://docs.oracle.com/cd/E11882_01/server.112/e26088/statements_10008.htm#i2067715"" rel=""noreferrer"">http://docs.oracle.com/cd/E11882_01/server.112/e26088/statements_10008.htm#i2067715</a></p>
","8941826"
"How can I do SELECT UNIQUE with LINQ?","129804","","<p>I have a list like this:</p>

<pre><code>Red
Red
Brown
Yellow
Green
Green
Brown
Red
Orange
</code></pre>

<p>I am trying to do a SELECT UNIQUE with LINQ, i.e. I want</p>

<pre><code>Red
Brown
Yellow
Green
Orange

var uniqueColors = from dbo in database.MainTable
                   where dbo.Property == true
                   select dbo.Color.Name;
</code></pre>

<p>I then changed this to</p>

<pre><code>var uniqueColors = from dbo in database.MainTable
                   where dbo.Property == true
                   select dbo.Color.Name.Distinct();
</code></pre>

<p>with no success. The first <code>select</code> gets ALL the colors, so how do I modify it to only get the unique values?</p>

<p>If there is a better way of structuring this query, more than happy to go that route.</p>

<p>How do I go about editing it so I can have .OrderBy( ""column name"" ) i.e. alphabetically by color name, so name property?</p>

<p>I keep getting a message:</p>

<blockquote>
  <p>The type arguments cannot be inferred from the usage. Try specificying the type arguments explicitly.</p>
</blockquote>
","<p>The Distinct() is going to mess up the ordering, so you'll have to the sorting after that.</p>

<pre><code>var uniqueColors = 
               (from dbo in database.MainTable 
                 where dbo.Property == true 
                 select dbo.Color.Name).Distinct().OrderBy(name=&gt;name);
</code></pre>
","3521137"
"Testing if a site is vulnerable to Sql Injection","129726","","<p>I was reading about sql injection and i understand how it works if there is a form where the user can enter his username and login. What i dont get is how websites without a login page can be vulnerable to sql injection.</p>

<p><a href=""http://thecybersaviours.com/how-to-find-out-if-a-website-is-vulnerable-to-sql-injection"" rel=""noreferrer"">http://thecybersaviours.com/how-to-find-out-if-a-website-is-vulnerable-to-sql-injection</a></p>

<p>It says just append a ' or ''=' to test it. I dont understand how this helps to determine whether an error exists. Where is the query being constructed at all.</p>
","<p>SQL injection is the attempt to issue SQL commands to a database through a website interface, to gain other information. Namely, this information is stored database information such as usernames and passwords. </p>

<p>First rule of securing any script or page that attaches to a database instance is <strong>Do not trust user input</strong>. </p>

<p>Your example is attempting to end a misquoted string in an SQL statement. To understand this, you first need to <a href=""http://en.wikipedia.org/wiki/SQL"" rel=""nofollow noreferrer"">understand SQL statements</a>. In your example of adding a <code>'</code> to a paramater, your 'injection' is hoping for the following type of statement:</p>

<blockquote>
  <p>SELECT username,password FROM users WHERE username='$username'</p>
</blockquote>

<p>By appending a <code>'</code> to that statement, you could then add additional SQL paramaters or queries.: <code>' OR username --</code></p>

<blockquote>
  <p>SELECT username,password FROM users WHERE username='' OR username -- '$username</p>
</blockquote>

<p><em>That</em> is an injection (one type of; Query Reshaping). The user input becomes an <em>injected</em> statement into the pre-written SQL statement. </p>

<p>Generally there are three types of SQL injection methods:</p>

<ul>
<li>Query Reshaping or redirection (above)</li>
<li>Error message based (No such user/password)</li>
<li>Blind Injections</li>
</ul>

<p>Read up on <a href=""http://en.wikipedia.org/wiki/SQL_injection"" rel=""nofollow noreferrer"">SQL Injection</a>, <a href=""http://www.testingsecurity.com/how-to-test/injection-vulnerabilities/SQL-Injection"" rel=""nofollow noreferrer"">How to test for vulnerabilities</a>, <a href=""http://www.lassosoft.com/Understanding-and-Overcoming-SQL-Injection"" rel=""nofollow noreferrer"">understanding and overcoming SQL injection</a>, and this question (and related ones) on StackOverflow <a href=""https://stackoverflow.com/questions/1973/what-is-the-best-way-to-avoid-sql-injection-attacks"">about avoiding injections</a>.</p>

<p>Edit:</p>

<p>As far as TESTING your site for SQL injection, understand it gets A LOT more complex than just 'append a symbol'. If your site is critical, and you (or your company) can afford it, hire a professional pen tester. Failing that, <a href=""http://www.unixwiz.net/techtips/sql-injection.html"" rel=""nofollow noreferrer"">this great exaxmple/proof</a> can show you some common techniques one might use to perform an injection test. There is also <a href=""http://sqlmap.sourceforge.net/"" rel=""nofollow noreferrer"">SQLMap</a> which can automate some tests for SQL Injection and database take over scenarios.  </p>
","10281623"
"Insert multiple rows into single column","129599","","<p>I'm new to SQL, (using SQL 2008 R2) and I am having trouble inserting multiple rows into a single column.</p>

<p>I have a table named <code>Data</code> and this is what I am trying</p>

<pre><code>INSERT INTO Data ( Col1 ) VALUES
('Hello', 'World')
</code></pre>

<p>That code was taken from <a href=""https://stackoverflow.com/questions/452859/inserting-multiple-rows-in-a-single-sql-query"">this</a> question, but it, like many other examples I have found on the web uses 2 columns, I just want to use 1. What am I doing wrong?</p>

<p>Thanks</p>
","<p>Another way to do this is with union:</p>

<pre><code>INSERT INTO Data ( Col1 ) 
select 'hello'
union 
select 'world'
</code></pre>
","11802078"
"How to add 'ON DELETE CASCADE' in ALTER TABLE statement","129517","","<p>I have a foreign key constraint in my table, I want to add ON DELETE CASCADE to it.</p>

<p>I have tried this:</p>

<pre>
alter table child_table_name
  modify constraint fk_name
  foreign key (child_column_name)
  references parent_table_name (parent_column_name) on delete cascade;
</pre>

<p>Doesn't work.</p>

<p>EDIT:<br>
Foreign key already exists, there are data in foreign key column.</p>

<p>The error message I get after executing the statement:</p>

<pre>
ORA-02275: such a referential constraint already exists in the table
</pre>
","<p>You can not add <code>ON DELETE CASCADE</code> to an already existing constraint. You will have to <code>drop</code> and re-<code>create</code> the constraint. The <a href=""http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/statements_3001.htm#i2103997"" rel=""noreferrer"" title=""ALTER TABLE 10gR2"">documentation</a> shows that the <code>MODIFY CONSTRAINT</code> clause can only modify the <a href=""http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/clauses002.htm#i1002273"" rel=""noreferrer"" title=""Constraint states 10gR2"">state of a constraint</a> (i-e: <code>ENABLED/DISABLED</code>...).</p>
","1572051"
"SQLite DateTime comparison","129486","","<p>I can't seem to get reliable results from the query against a sqlite database using a datetime string as a comparison as so:</p>

<pre><code>select * 
  from table_1 
 where mydate &gt;= '1/1/2009' and mydate &lt;= '5/5/2009'
</code></pre>

<p>how should I handle datetime comparisons to sqlite?</p>

<p>update:
field mydate is a DateTime datatype</p>

<p>Solution:</p>

<p>following the datetime function and having a string format as YYYY-MM-DD HH:mm:ss i achieved good results as follows</p>

<pre><code>select * 
  from table_1 
  where mydate &gt;= Datetime('2009-11-13 00:00:00') 
  and mydate &lt;= Datetime('2009-11-15 00:00:00')
</code></pre>
","<p>SQLite doesn't have dedicated datetime <a href=""http://sqlite.org/datatype3.html"" rel=""noreferrer"">types</a>, but does have a <a href=""http://sqlite.org/lang_datefunc.html"" rel=""noreferrer"">few datetime functions</a>.  Follow the string representation formats (actually only formats 1-10) understood by those functions (storing the value as a string) and then you can use them, plus lexicographical comparison on the strings will match datetime comparison (as long as you don't try to compare dates to times or datetimes to times, which doesn't make a whole lot of sense anyway).</p>

<p>Depending on which language you use, you can even get <a href=""http://docs.python.org/library/sqlite3.html#default-adapters-and-converters"" rel=""noreferrer"">automatic conversion</a>.  (Which doesn't apply to comparisons in SQL statements like the example, but will make your life easier.)</p>
","1975829"
"Convert a string date into datetime in Oracle","129368","","<p>How can I convert this string date to datetime in oracle.</p>

<pre><code>2011-07-28T23:54:14Z
</code></pre>

<p>Using this code throws an error:</p>

<pre><code>TO_DATE('2011-07-28T23:54:14Z',  'YYYY-MM-DD HH24:MI:SS')
</code></pre>

<p>How can this be done?</p>

<pre><code>Error report:
SQL Error: ORA-01861: literal does not match format string
01861. 00000 -  ""literal does not match format string""
*Cause:    Literals in the input must be the same length as literals in
           the format string (with the exception of leading whitespace).  If the
           ""FX"" modifier has been toggled on, the literal must match exactly,
           with no extra whitespace.
*Action:   Correct the format string to match the literal.
</code></pre>

<p><strong>Update:-</strong></p>

<p>TO_DATE('2011-07-28T23:54:14Z', 'YYYY-MM-DD""T""HH24:MI:SS""Z""')</p>

<p>I only see the date not time in the column</p>

<pre><code>28-JUL-11
</code></pre>
","<p>Try this:
<code>TO_DATE('2011-07-28T23:54:14Z',  'YYYY-MM-DD""T""HH24:MI:SS""Z""')</code></p>
","7920746"
"What does the term ""Tuple"" Mean in Relational Databases?","129265","","<p>Please explain what is meant by tuples in sql?Thanks..</p>
","<p>Most of the answers here are on the right track.  However, a <strong>row is not a tuple</strong>.  <strong>Tuples</strong><code>*</code> are <em>unordered</em> sets of known values with names.  Thus, the following tuples are the same thing (I'm using an imaginary tuple syntax since a relational tuple is largely a theoretical construct):</p>

<pre><code>(x=1, y=2, z=3)
(z=3, y=2, x=1)
(y=2, z=3, x=1)
</code></pre>

<p>...assuming of course that x, y, and z are all integers.  Also note that there is no such thing as a ""duplicate"" tuple.  Thus, not only are the above equal, they're the <em>same thing</em>.  Lastly, tuples can only contain known values (thus, no nulls).</p>

<p>A <strong>row</strong><code>**</code> is an ordered set of known or unknown values with names (although they may be omitted).  Therefore, the following comparisons return false in SQL:</p>

<pre><code>(1, 2, 3) = (3, 2, 1)
(3, 1, 2) = (2, 1, 3)
</code></pre>

<p>Note that there are ways to ""fake it"" though.  For example, consider this <code>INSERT</code> statement:</p>

<pre><code>INSERT INTO point VALUES (1, 2, 3)
</code></pre>

<p>Assuming that x is first, y is second, and z is third, this query may be rewritten like this:</p>

<pre><code>INSERT INTO point (x, y, z) VALUES (1, 2, 3)
</code></pre>

<p>Or this:</p>

<pre><code>INSERT INTO point (y, z, x) VALUES (2, 3, 1)
</code></pre>

<p>...but all we're really doing is changing the ordering rather than removing it.</p>

<p>And also note that there may be unknown values as well.  Thus, you may have rows with unknown values:</p>

<pre><code>(1, 2, NULL) = (1, 2, NULL)
</code></pre>

<p>...but note that this comparison will always yield <code>UNKNOWN</code>.  After all, how can you know whether two unknown values are equal?</p>

<p>And lastly, rows may be duplicated.  In other words, <code>(1, 2)</code> and <code>(1, 2)</code> may compare to be equal, but that doesn't necessarily mean that they're the same thing.</p>

<p>If this is a subject that interests you, I'd highly recommend reading <a href=""http://rads.stackoverflow.com/amzn/click/0596523068"" rel=""noreferrer"">SQL and Relational Theory: How to Write Accurate SQL Code</a> by CJ Date.</p>

<p><code>*</code> Note that I'm talking about tuples as they exist in the relational model, which is a bit different from mathematics in general.</p>

<p><code>**</code>And just in case you're wondering, just about everything in SQL is a row or table.  Therefore, <code>(1, 2)</code> is a row, while <code>VALUES (1, 2)</code> is a table (with one row).</p>

<p><strong>UPDATE</strong>:  I've expanded a little bit on this answer in a blog post <a href=""http://jasonmbaker.wordpress.com/2009/07/05/the-relational-model-of-tuples-relations-rows-and-tables/"" rel=""noreferrer"">here</a>.</p>
","1083266"
"Sqlite: CURRENT_TIMESTAMP is in GMT, not the timezone of the machine","129116","","<p>I have a sqlite (v3) table with this column definition:</p>

<pre><code>""timestamp"" DATETIME DEFAULT CURRENT_TIMESTAMP
</code></pre>

<p>The server that this database lives on is in the CST time zone.  When I insert into my table without including the timestamp column, sqlite automatically populates that field with the current timestamp in GMT, not CST.</p>

<p>Is there a way to modify my insert statement to force the stored timestamp to be in CST?  On the other hand, it is probably better to store it in GMT (in case the database gets moved to a different timezone, for example), so is there a way I can modify my select SQL to convert the stored timestamp to CST when I extract it from the table?</p>
","<p>I found on the sqlite documentation (<a href=""https://www.sqlite.org/lang_datefunc.html"" rel=""noreferrer"">https://www.sqlite.org/lang_datefunc.html</a>) this text:</p>

<blockquote>
  <p>Compute the date and time given a unix
  timestamp 1092941466, and compensate
  for your local timezone.</p>
</blockquote>

<pre><code>SELECT datetime(1092941466, 'unixepoch', 'localtime');
</code></pre>

<p>That didn't look like it fit my needs, so I tried changing the ""datetime"" function around a bit, and wound up with this:</p>

<pre><code>select datetime(timestamp, 'localtime')
</code></pre>

<p>That seems to work - is that the correct way to convert for your timezone, or is there a better way to do this?</p>
","381394"
"Create a one to many relationship using SQL Server","128826","","<p>How do you create a one to many relationship using SQL Server?</p>
","<ol>
<li>Define two tables (example A and B), with their own primary key</li>
<li>Define a column in Table A as having a Foreign key relationship based on the primary key of Table B</li>
</ol>

<p>This means that Table A can have one or more records relating to a single record in Table B.</p>

<p>If you already have the tables in place, use the ALTER TABLE statement to create the foreign key constraint:</p>

<pre><code>ALTER TABLE A ADD CONSTRAINT fk_b FOREIGN KEY (b_id) references b(id) 
</code></pre>

<ul>
<li><code>fk_b</code>: Name of the foreign key constraint, must be unique to the database</li>
<li><code>b_id</code>: Name of column in Table A you are creating the foreign key relationship on</li>
<li><code>b</code>: Name of table, in this case b</li>
<li><code>id</code>: Name of column in Table B</li>
</ul>
","1308349"
"How to insert data into SQL Server","128758","","<p>What the problem on my coding? I cannot insert data to ms sql.. I'm using C# as front end and MS SQL as databases...</p>

<pre><code>name = tbName.Text;
userId = tbStaffId.Text;
idDepart = int.Parse(cbDepart.SelectedValue.ToString());

string saveStaff = ""INSERT into tbl_staff (staffName,userID,idDepartment) "" +
                   "" VALUES ('"" + name + ""', '"" + userId +""', '"" + idDepart + ""');"";

SqlCommand querySaveStaff = new SqlCommand(saveStaff);

try
{
querySaveStaff.ExecuteNonQuery();
}
catch
{
//Error when save data

MessageBox.Show(""Error to save on database"");
openCon.Close();
Cursor = Cursors.Arrow;
}
</code></pre>
","<p>You have to set Connection property of Command object and use parametersized query instead of hardcoded SQL to avoid <a href=""http://msdn.microsoft.com/en-us/library/ms161953%28v=sql.105%29.aspx"" rel=""noreferrer"">SQL Injection</a>.</p>

<pre><code> using(SqlConnection openCon=new SqlConnection(""your_connection_String""))
    {
      string saveStaff = ""INSERT into tbl_staff (staffName,userID,idDepartment) VALUES (@staffName,@userID,@idDepartment)"";

      using(SqlCommand querySaveStaff = new SqlCommand(saveStaff))
       {
         querySaveStaff.Connection=openCon;
         querySaveStaff.Parameters.Add(""@staffName"",SqlDbType.VarChar,30).Value=name;
         .....
         openCon.Open();


       }
     }
</code></pre>
","12241114"
"How to implement one-to-one, one-to-many and many-to-many relationships while designing tables?","128620","","<p>Can anyone explain how to implement one-to-one, one-to-many and many-to-many relationships while designing tables with some examples?</p>
","<p><strong>One-to-one:</strong> Use a foreign key to the referenced table:</p>

<pre class=""lang-none prettyprint-override""><code>student: student_id, first_name, last_name, address_id
address: address_id, address, city, zipcode, student_id # you can have a
                                                        # ""link back"" if you need
</code></pre>

<p><strong>One-to-many</strong>: Use a foreign key on the many side of the relationship linking back to the ""one"" side:</p>

<pre class=""lang-none prettyprint-override""><code>teachers: teacher_id, first_name, last_name # the ""one"" side
classes:  class_id, class_name, teacher_id  # the ""many"" side
</code></pre>

<p><strong>Many-to-many</strong>: Use a junction table (<a href=""https://gist.github.com/anonymous/79c2eed2a634777b16ff"">example</a>):</p>

<pre class=""lang-none prettyprint-override""><code>student: student_id, first_name, last_name
classes: class_id, name, teacher_id
student_classes: class_id, student_id     # the junction table
</code></pre>

<p>Example queries:</p>

<pre><code> -- Getting all students for a class:

    SELECT s.student_id, last_name
      FROM student_classes sc 
INNER JOIN students s ON s.student_id = sc.student_id
     WHERE sc.class_id = X

 -- Getting all classes for a student: 

    SELECT c.class_id, name
      FROM student_classes sc 
INNER JOIN classes c ON c.class_id = sc.class_id
     WHERE sc.student_id = Y
</code></pre>

<p></p>
","7296873"
"How to SELECT by MAX(date)?","128487","","<p>This is the table structure</p>

<pre><code>CREATE TABLE `reports` (
  `report_id` int(11) NOT NULL auto_increment,
  `computer_id` int(11) NOT NULL default '0',
  `date_entered` datetime NOT NULL default '1970-01-01 00:00:00',
  `total_seconds` int(11) NOT NULL default '0',
  `iphone_id` int(11) default '0',
  PRIMARY KEY  (`report_id`),
  KEY `computer_id` (`computer_id`),
  KEY `iphone_id` (`iphone_id`)
) ENGINE=MyISAM AUTO_INCREMENT=120990 DEFAULT CHARSET=latin1
</code></pre>

<p>I need a <code>SELECT</code> statement that will list the <code>report_id</code> per <code>computer_id</code> from latest entered <code>date_entered</code>, and i have no clue how to do that. Can anyone point me into the right direction? Thx in advance.</p>
","<p>This should do it:</p>

<pre><code>SELECT report_id, computer_id, date_entered
FROM reports AS a
WHERE date_entered = (
    SELECT MAX(date_entered)
    FROM reports AS b
    WHERE a.report_id = b.report_id
      AND a.computer_id = b.computer_id
)
</code></pre>
","7836444"
"OPTION (RECOMPILE) is Always Faster; Why?","128450","","<p>I encountered an odd situation where appending <code>OPTION (RECOMPILE)</code> to my query causes it to run in half a second, while omitting it causes the query to take well over five minutes.</p>

<p>This is the case when the query is executed from Query Analyzer or from my C# program via <code>SqlCommand.ExecuteReader()</code>. Calling (or not calling) <code>DBCC FREEPROCCACHE</code> or <code>DBCC dropcleanbuffers</code> makes no difference; Query results are always returned instantaneously with <code>OPTION (RECOMPILE)</code> and greater than five minutes without it. The query is always called with the same parameters [for the sake of this test].</p>

<p>I'm using SQL Server 2008.</p>

<p>I'm fairly comfortable with writing SQL but have never used an <code>OPTION</code> command in a query before and was unfamiliar with the whole concept of plan caches until scanning the posts on this forum. My understanding from the posts is that <code>OPTION (RECOMPILE)</code> is an expensive operation. It apparently creates a new lookup strategy for the query. So why is it then, that subsequent queries that omit the <code>OPTION (RECOMPILE)</code> are so slow? Shouldn't the subsequent queries be making use of the lookup strategy that was computed on the previous call which included the recompilation hint?</p>

<p>Is it highly unusual to have a query that requires a recompilation hint on every single call?</p>

<p>Sorry for the entry-level question but I can't really make heads or tails of this.</p>

<p><strong>UPDATE: I've been asked to post the query...</strong></p>

<pre><code>select acctNo,min(date) earliestDate 
from( 
    select acctNo,tradeDate as date 
    from datafeed_trans 
    where feedid=@feedID and feedDate=@feedDate 

    union 

    select acctNo,feedDate as date 
    from datafeed_money 
    where feedid=@feedID and feedDate=@feedDate 

    union 

    select acctNo,feedDate as date 
    from datafeed_jnl 
    where feedid=@feedID and feedDate=@feedDate 
)t1 
group by t1.acctNo
OPTION(RECOMPILE)
</code></pre>

<p>When running the test from Query Analyzer, I prepend the following lines:</p>

<pre><code>declare @feedID int
select @feedID=20

declare @feedDate datetime
select @feedDate='1/2/2009'
</code></pre>

<p>When calling it from my C# program, the parameters are passed in via the <code>SqlCommand.Parameters</code> property.</p>

<p>For the purposes of this discussion, you can assume that the parameters never change so we can rule out sub-optimal parameter smelling as the cause.</p>
","<p>There are times that using <code>OPTION(RECOMPILE)</code> makes sense.  In my experience the only time this is a viable option is when you are using dynamic SQL.  Before you explore whether this makes sense in your situation I would recommend rebuilding your statistics.  This can be done by running the following:</p>

<pre><code>EXEC sp_updatestats
</code></pre>

<p>And then recreating your execution plan.  This will ensure that when your execution plan is created it will be using the latest information.</p>

<p>Adding <code>OPTION(RECOMPILE)</code> rebuilds the execution plan every time that your query executes.  I have never heard that described as <code>creates a new lookup strategy</code> but maybe we are just using different terms for the same thing.</p>

<p>When a stored procedure is created (I suspect you are calling ad-hoc sql from .NET but <a href=""https://dba.stackexchange.com/questions/123978/can-sp-executesql-be-configured-used-by-default"">if you are using a parameterized query then this ends up being a stored proc call</a>) SQL Server attempts to determine the most effective execution plan for this query based on the data in your database and the parameters passed in (<a href=""http://blogs.technet.com/b/mdegre/archive/2012/03/19/what-is-parameter-sniffing.aspx"" rel=""noreferrer"">parameter sniffing</a>), and then caches this plan. This means that if you create the query where there are 10 records in your database and then execute it when there are 100,000,000 records the cached execution plan may no longer be the most effective.</p>

<p>In summary - I don't see any reason that <code>OPTION(RECOMPILE)</code> would be a benefit here.  I suspect you just need to update your statistics and your execution plan.  Rebuilding statistics can be an essential part of DBA work depending on your situation.  If you are still having problems after updating your stats, I would suggest posting both execution plans.</p>

<p>And to answer your question - yes, I would say it is highly unusual for your best option to be recompiling the execution plan every time you execute the query.</p>
","20865349"
"MySQL 1062 - Duplicate entry '0' for key 'PRIMARY'","128153","","<p>I have the following table in MySQL version 5.5.24</p>

<pre><code>DROP TABLE IF EXISTS `momento_distribution`;

CREATE TABLE IF NOT EXISTS `momento_distribution`
  (
     `momento_id`       INT(11) NOT NULL,
     `momento_idmember` INT(11) NOT NULL,
     `created_at`       DATETIME DEFAULT NULL,
     `updated_at`       DATETIME DEFAULT NULL,
     `unread`           TINYINT(1) DEFAULT '1',
     `accepted`         VARCHAR(10) NOT NULL DEFAULT 'pending',
     `ext_member`       VARCHAR(255) DEFAULT NULL,
     PRIMARY KEY (`momento_id`, `momento_idmember`),
     KEY `momento_distribution_FI_2` (`momento_idmember`),
     KEY `accepted` (`accepted`, `ext_member`)
  )
ENGINE=InnoDB
DEFAULT CHARSET=latin1;
</code></pre>

<p>It has lots of data with many-to-one relations with two other tables with <code>ondelete=restrict</code> and <code>onupdate=restrict</code>.</p>

<p>Now, I need to change the structure and introduce separate primary key in the table, while still keeping existing relations and data. For that, I executed the following query:</p>

<pre><code>ALTER TABLE  `momento_distribution` ADD  `id` INT( 11 ) NOT NULL FIRST;
ALTER TABLE  `momento_distribution` DROP PRIMARY KEY , ADD PRIMARY KEY (  `id` );
</code></pre>

<p>Unfortunately, my second query failed with the following error:</p>

<blockquote>
  <p>1062 - Duplicate entry '0' for key 'PRIMARY'</p>
</blockquote>

<p>Can someone please point out the issue? I guess that the issue is the existing relation, but I don't want to lose the existing relation or data, that has several thousand rows. Is there any way to do this without losing data?</p>

<p><strong>EDIT:</strong>
By viewing data, I got that the newly created column has the  value '0' in it. Probably this is not allowing to change the Primary Key due to duplicate records (in new Primary Key)</p>

<p>I have more than 8,000 rows, so I can't change it manually. Is there any way to assign <code>rowid</code> to a new Primary Key?</p>
","<p>Run the following query in the mysql console:</p>

<pre><code>SHOW CREATE TABLE momento_distribution
</code></pre>

<p>Check for the line that looks something like</p>

<pre><code>CONSTRAINT `momento_distribution_FK_1` FOREIGN KEY (`momento_id`) REFERENCES `momento` (`id`)
</code></pre>

<p>It may be different, I just put a guess as to what it could be. If you have a <a href=""https://dev.mysql.com/doc/refman/5.6/en/glossary.html#glos_foreign_key_constraint"" rel=""nofollow noreferrer"">foreign key</a> on both 'momento_id' &amp; 'momento_idmember', you will get two foreign key names. The next step is to delete the foreign keys. Run the following queries:</p>

<pre><code>ALTER TABLE momento_distribution DROP FOREIGN KEY momento_distribution_FK_1
ALTER TABLE momento_distribution DROP FOREIGN KEY momento_distribution_FK_2
</code></pre>

<p>Be sure to change the foreign key name to what you got from the <code>CREATE TABLE</code> query. Now you don't have any foreign keys so you can easily remove the <a href=""https://dev.mysql.com/doc/refman/5.7/en/constraint-primary-key.html"" rel=""nofollow noreferrer"">primary key</a>. Try the following:</p>

<pre><code>ALTER TABLE  `momento_distribution` DROP PRIMARY KEY
</code></pre>

<p>Add the required column as follows:</p>

<pre><code>ALTER TABLE  `momento_distribution` ADD  `id` INT( 11 ) NOT NULL  PRIMARY KEY AUTO_INCREMENT FIRST
</code></pre>

<p>This query also adds numbers so you won't need to depend on @rowid. Now you need to add the foreign key back to the earlier columns. For that, first make these indexes:</p>

<pre><code>ALTER TABLE  `momento_distribution` ADD INDEX (  `momento_id` )
ALTER TABLE  `momento_distribution` ADD INDEX (  `momento_idmember` )
</code></pre>

<p>Now add the foreign keys. Change the Reference Table/column as you need:</p>

<pre><code>ALTER TABLE  `momento_distribution` ADD FOREIGN KEY ( `momento_id`) REFERENCES  `momento` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT 
ALTER TABLE  `momento_distribution` ADD FOREIGN KEY ( `momento_idmember`) REFERENCES  `member` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT 
</code></pre>

<p>Hope that helps. If you get any errors, please edit the question with the structure of the reference tables &amp; the error code(s) that you are getting.</p>
","12189846"
"How to send email from SQL Server?","127911","","<p>How can I send an email using T-SQL but email address is stored in a table? I want to loop through the table and be able to send email. I cannot find a good example of doing this so far.. </p>

<p>Thanks for your help</p>
","<p><strong>Step 1) Create Profile and Account</strong></p>

<p>You need to create a profile and account using the Configure Database Mail Wizard which can be accessed from the Configure Database Mail context menu of the Database Mail node in Management Node. This wizard is used to manage accounts, profiles, and Database Mail global settings.</p>

<p><strong>Step 2)</strong> </p>

<p>RUN:</p>

<pre><code>sp_CONFIGURE 'show advanced', 1
GO
RECONFIGURE
GO
sp_CONFIGURE 'Database Mail XPs', 1
GO
RECONFIGURE
GO
</code></pre>

<p><strong>Step 3)</strong></p>

<pre><code>USE msdb
GO
EXEC sp_send_dbmail @profile_name='yourprofilename',
@recipients='test@Example.com',
@subject='Test message',
@body='This is the body of the test message.
Congrates Database Mail Received By you Successfully.'
</code></pre>

<p>To loop through the table </p>

<pre><code>DECLARE @email_id NVARCHAR(450), @id BIGINT, @max_id BIGINT, @query NVARCHAR(1000)

SELECT @id=MIN(id), @max_id=MAX(id) FROM [email_adresses]

WHILE @id&lt;=@max_id
BEGIN
    SELECT @email_id=email_id 
    FROM [email_adresses]

    set @query='sp_send_dbmail @profile_name=''yourprofilename'',
                        @recipients='''+@email_id+''',
                        @subject=''Test message'',
                        @body=''This is the body of the test message.
                        Congrates Database Mail Received By you Successfully.'''

    EXEC @query
    SELECT @id=MIN(id) FROM [email_adresses] where id&gt;@id

END
</code></pre>

<p><strong>Posted this on the following link <a href=""http://ms-sql-queries.blogspot.in/2012/12/how-to-send-email-from-sql-server.html"" rel=""noreferrer"">http://ms-sql-queries.blogspot.in/2012/12/how-to-send-email-from-sql-server.html</a></strong></p>
","13305615"
"Using setDate in PreparedStatement","127745","","<p>In order to make our code more standard, we were asked to change all the places where we hardcoded our SQL variables to prepared statements and bind the variables instead. </p>

<p>I am however facing a problem with the <code>setDate()</code>. </p>

<p>Here is the code:</p>

<pre><code>        DateFormat dateFormatYMD = new SimpleDateFormat(""yyyy/MM/dd HH:mm:ss"");
        DateFormat dateFormatMDY = new SimpleDateFormat(""MM/dd/yyyy HH:mm:ss"");
        Date now = new Date();
        String vDateYMD = dateFormatYMD.format(now);
        String vDateMDY = dateFormatMDY.format(now);
        String vDateMDYSQL =  vDateMDY ;
        java.sql.Date date = new java.sql.Date(0000-00-00);

   requestSQL = ""INSERT INTO CREDIT_REQ_TITLE_ORDER (REQUEST_ID,"" + 
                "" ORDER_DT, FOLLOWUP_DT) "" +  ""values(?,?,?,)"";


                prs = conn.prepareStatement(requestSQL);

                prs.setInt(1,new Integer(requestID));

                prs.setDate(2,date.valueOf(vDateMDYSQL));
                prs.setDate(3,date.valueOf(sqlFollowupDT));
</code></pre>

<p>I get this error when the SQL gets executed:</p>

<pre><code>    java.lang.IllegalArgumentException
    at java.sql.Date.valueOf(Date.java:138)
    at com.cmsi.eValuate.TAF.TAFModuleMain.CallTAF(TAFModuleMain.java:1211)
</code></pre>

<p>Should I use <code>setString()</code> instead with a <code>to_date()</code>?</p>
","<h2>&#x2750; Using <code>java.sql.Date</code></h2>

<p>If your table has a column of type <code>DATE</code>:</p>

<ul>
<li><p><strong><code>java.lang.String</code></strong></p>

<p>The method <a href=""http://docs.oracle.com/javase/8/docs/api/java/sql/Date.html#valueOf%28java.lang.String%29"" rel=""noreferrer""><code>java.sql.Date.valueOf(java.lang.String)</code></a> received a string representing a date in the format <code>yyyy-[m]m-[d]d</code>. e.g.:</p>

<pre><code>ps.setDate(2, java.sql.Date.valueOf(""2013-09-04""));
</code></pre></li>
<li><p><strong><code>java.util.Date</code></strong></p>

<p>Suppose you have a variable <code>endDate</code> of type <code>java.util.Date</code>, you make the conversion thus:</p>

<pre><code>ps.setDate(2, new java.sql.Date(endDate.getTime());
</code></pre></li>
<li><p><strong>Current</strong></p>

<p>If you want to insert the current date:</p>

<pre><code>ps.setDate(2, new java.sql.Date(System.currentTimeMillis()));

// Since Java 8
ps.setDate(2, java.sql.Date.valueOf(java.time.LocalDate.now()));
</code></pre></li>
</ul>

<h2>&#x2750; Using <code>java.sql.Timestamp</code></h2>

<p>If your table has a column of type <code>TIMESTAMP</code> or <code>DATETIME</code>:</p>

<ul>
<li><p><strong><code>java.lang.String</code></strong></p>

<p>The method <a href=""http://docs.oracle.com/javase/8/docs/api/java/sql/Timestamp.html#valueOf%28java.lang.String%29"" rel=""noreferrer""><code>java.sql.Timestamp.valueOf(java.lang.String)</code></a> received a string representing a date in the format <code>yyyy-[m]m-[d]d hh:mm:ss[.f...]</code>. e.g.:</p>

<pre><code>ps.setTimestamp(2, java.sql.Timestamp.valueOf(""2013-09-04 13:30:00"");
</code></pre></li>
<li><p><strong><code>java.util.Date</code></strong></p>

<p>Suppose you have a variable <code>endDate</code> of type <code>java.util.Date</code>, you make the conversion thus:</p>

<pre><code>ps.setTimestamp(2, new java.sql.Timestamp(endDate.getTime()));
</code></pre></li>
<li><p><strong>Current</strong></p>

<p>If you require the current timestamp:</p>

<pre><code>ps.setTimestamp(2, new java.sql.Timestamp(System.currentTimeMillis()));

// Since Java 8
ps.setTimestamp(2, java.sql.Timestamp.from(java.time.Instant.now()));
ps.setTimestamp(2, java.sql.Timestamp.valueOf(java.time.LocalDateTime.now()));
</code></pre></li>
</ul>
","18615191"
"How to return the output of stored procedure into a variable in sql server","127653","","<p>I want to execute a stored procedure in SQL Server and assign the output to a variable (it returns a single value) ?</p>
","<p>That depends on the nature of the information you want to return.</p>

<p>If it is a single integer value, you can use the <code>return</code> statement</p>

<pre><code> create proc myproc
 as 
 begin
     return 1
 end
 go
 declare @i int
 exec @i = myproc
</code></pre>

<p>If you have a non integer value, or a number of scalar values, you can use output parameters</p>

<pre><code>create proc myproc
  @a int output,
  @b varchar(50) output
as
begin
  select @a = 1, @b='hello'
end
go
declare @i int, @j varchar(50)
exec myproc @i output, @j output
</code></pre>

<p>If you want to return a dataset, you can use <code>insert exec</code></p>

<pre><code>create proc myproc
as 
begin
     select name from sysobjects
end
go

declare @t table (name varchar(100))
insert @t (name)
exec myproc
</code></pre>

<p>You can even return a cursor but that's just horrid so I shan't give an example :)</p>
","11965764"
"SQL Server Creating a temp table for this query","127553","","<p>I have this query:</p>

<pre><code>DECLARE 
@ProjectID int = 3,
@Year int = 2010,
@MeterTypeID int = 1,
@StartDate datetime,
@EndDate datetime

SET @StartDate = '07/01/' + CAST(@Year as VARCHAR)
SET @EndDate = '06/30/' + CAST(@Year+1 as VARCHAR)

SELECT  tblMEP_Sites.Name AS SiteName, convert(varchar(10),BillingMonth ,101) AS BillingMonth, SUM(Consumption) AS Consumption
FROM tblMEP_Projects

JOIN tblMEP_Sites
ON tblMEP_Projects.ID = tblMEP_Sites.ProjectID

JOIN tblMEP_Meters
ON tblMEP_Meters.SiteID = tblMEP_Sites.ID

JOIN tblMEP_MonthlyData
ON tblMEP_MonthlyData.MeterID = tblMEP_Meters.ID

JOIN tblMEP_CustomerAccounts
ON tblMEP_CustomerAccounts.ID = tblMEP_Meters.CustomerAccountID

JOIN tblMEP_UtilityCompanies
ON tblMEP_UtilityCompanies.ID = tblMEP_CustomerAccounts.UtilityCompanyID

JOIN tblMEP_MeterTypes
ON tblMEP_UtilityCompanies.UtilityTypeID = tblMEP_MeterTypes.ID

WHERE tblMEP_Projects.ID = @ProjectID
AND tblMEP_MonthlyData.BillingMonth Between @StartDate AND @EndDate
AND tbLMEP_MeterTypes.ID = @MeterTypeID
GROUP BY BillingMonth, tblMEP_Sites.Name
ORDER BY month(BillingMonth)
</code></pre>

<p>I just want store it in a temp table so that I can do something with it. It would be great if anybody can just include the syntax for creating a temp table in SQL Server. </p>

<p>I tried different ways but I was lost and did not get the result I want.</p>
","<p>If you want to just create a temp table inside the query that will allow you to do something with the results that you deposit into it you can do something like the following:</p>

<pre><code>DECLARE @T1 TABLE (
Item 1 VARCHAR(200)
, Item 2 VARCHAR(200)
, ...
, Item n VARCHAR(500)
)
</code></pre>

<p>On the top of your query and then do an</p>

<pre><code>INSERT INTO @T1
SELECT
FROM
(...)
</code></pre>
","17600432"
"Condition within JOIN or WHERE","127516","","<p>Is there any difference (performance, best-practice, etc...) between putting a condition in the JOIN clause vs. the WHERE clause?</p>

<p>For example...</p>

<pre><code>-- Condition in JOIN
SELECT *
FROM dbo.Customers AS CUS
INNER JOIN dbo.Orders AS ORD 
ON CUS.CustomerID = ORD.CustomerID
AND CUS.FirstName = 'John'

-- Condition in WHERE
SELECT *
FROM dbo.Customers AS CUS
INNER JOIN dbo.Orders AS ORD 
ON CUS.CustomerID = ORD.CustomerID
WHERE CUS.FirstName = 'John'
</code></pre>

<p>Which do you prefer (and perhaps why)?</p>
","<p>The relational algebra allows interchangeability of the predicates in the <code>WHERE</code> clause and the <code>INNER JOIN</code>, so even <code>INNER JOIN</code> queries with <code>WHERE</code> clauses can have the predicates rearrranged by the optimizer so that they <strong>may already be excluded</strong> during the <code>JOIN</code> process.</p>

<p>I recommend you write the queries in the most readble way possible.</p>

<p>Sometimes this includes making the <code>INNER JOIN</code> relatively ""incomplete"" and putting some of the criteria in the <code>WHERE</code> simply to make the lists of filtering criteria more easily maintainable.</p>

<p>For example, instead of:</p>

<pre><code>SELECT *
FROM Customers c
INNER JOIN CustomerAccounts ca
    ON ca.CustomerID = c.CustomerID
    AND c.State = 'NY'
INNER JOIN Accounts a
    ON ca.AccountID = a.AccountID
    AND a.Status = 1
</code></pre>

<p>Write:</p>

<pre><code>SELECT *
FROM Customers c
INNER JOIN CustomerAccounts ca
    ON ca.CustomerID = c.CustomerID
INNER JOIN Accounts a
    ON ca.AccountID = a.AccountID
WHERE c.State = 'NY'
    AND a.Status = 1
</code></pre>

<p>But it depends, of course.</p>
","1019006"
"Select from where field not equal to Mysql Php","127473","","<p>I'm just wondering what kind of mysql command i could execute in php that would select all items from a certain table where columna is not equal to x and columnb is not equal to x</p>

<p>Something like: <code>select something from table where columna does not equal x and columnb does not equal x</code></p>

<p>Any ideas?</p>
","<p>The key is the sql query, which you will set up as a string:</p>

<pre><code>$sqlquery = ""SELECT field1, field2 FROM table WHERE NOT columnA = 'x' AND NOT columbB = 'y'"";
</code></pre>

<p>Note that there are a lot of ways to specify NOT. Another one that works just as well is:</p>

<pre><code>$sqlquery = ""SELECT field1, field2 FROM table WHERE columnA != 'x' AND columbB != 'y'"";
</code></pre>

<p>Here is a full example of how to use it:</p>

<pre><code>$link = mysql_connect($dbHost,$dbUser,$dbPass) or die(""Unable to connect to database"");
mysql_select_db(""$dbName"") or die(""Unable to select database $dbName"");
$sqlquery = ""SELECT field1, field2 FROM table WHERE NOT columnA = 'x' AND NOT columbB = 'y'"";
$result=mysql_query($sqlquery);

while ($row = mysql_fetch_assoc($result) {
//do stuff
}
</code></pre>

<p>You can do whatever you would like within the above while loop. Access each field of the table as an element of the <code>$row array</code> which means that <code>$row['field1']</code> will give you the value for <code>field1</code> on the current row, and <code>$row['field2']</code> will give you the value for <code>field2</code>.</p>

<p>Note that if the column(s) could have <code>NULL</code> values, those will not be found using either of the above syntaxes. You will need to add clauses to include <code>NULL</code> values:</p>

<pre><code>$sqlquery = ""SELECT field1, field2 FROM table WHERE (NOT columnA = 'x' OR columnA IS NULL) AND (NOT columbB = 'y' OR columnB IS NULL)"";
</code></pre>
","3286678"
"How can I check if a View exists in a Database?","127416","","<p>I have some SQL code that needs to be executed if a certain View exists in a database. How would I go about checking if the View exists?</p>

<p>EDIT: The DBMS being used is Microsoft SQL Server</p>
","<p>FOR SQL SERVER</p>

<pre><code>IF EXISTS(select * FROM sys.views where name = '')
</code></pre>
","1306028"
"How to take last four characters from a varchar?","127206","","<p>I'm trying to take the last four characters only from a varchar field. All the rows are different lengths. What function should I be using to accomplish this?</p>

<p>edit: Well that was embarrassingly easy.. Seems I have a way to go with my knowledge!</p>
","<p>Right should do: </p>

<pre><code>select RIGHT('abcdeffff',4)
</code></pre>
","12504993"
"Query to get only numbers from a string","127200","","<p>suppose I have data like this:</p>

<pre><code>string 1: 003Preliminary Examination Plan   
string 2: Coordination005  
string 3: Balance1000sheet
</code></pre>

<p>The output I expect is </p>

<pre><code>string 1: 003
string 2: 005
string 3: 1000
</code></pre>

<p>And I want to implement it in sql.
Please help.
Thanks in advance :)</p>
","<p>First create this <strong><code>UDF</code></strong></p>

<pre><code>CREATE FUNCTION dbo.udf_GetNumeric
(@strAlphaNumeric VARCHAR(256))
RETURNS VARCHAR(256)
AS
BEGIN
DECLARE @intAlpha INT
SET @intAlpha = PATINDEX('%[^0-9]%', @strAlphaNumeric)
BEGIN
WHILE @intAlpha &gt; 0
BEGIN
SET @strAlphaNumeric = STUFF(@strAlphaNumeric, @intAlpha, 1, '' )
SET @intAlpha = PATINDEX('%[^0-9]%', @strAlphaNumeric )
END
END
RETURN ISNULL(@strAlphaNumeric,0)
END
GO
</code></pre>

<p>Now use the <strong><code>function</code></strong> as</p>

<pre><code>SELECT dbo.udf_GetNumeric(column_name) 
from table_name
</code></pre>

<p><strong><a href=""http://www.sqlfiddle.com/#!3/45f11/2"" rel=""noreferrer"">SQL FIDDLE</a></strong></p>

<p>I hope this solved your problem.</p>

<p><strong><a href=""http://blog.sqlauthority.com/2008/10/14/sql-server-get-numeric-value-from-alpha-numeric-string-udf-for-get-numeric-numbers-only/"" rel=""noreferrer"">Reference</a></strong></p>
","16667431"
"Insert Data Into Tables Linked by Foreign Key","127081","","<p>I am using PostgreSQL.</p>

<pre><code>Customer
==================
Customer_ID | Name

Order
==============================
Order_ID | Customer_ID | Price
</code></pre>

<p>To insert an order, here is what I need to do usually,</p>

<p>For example, ""John"" place ""1.34"" priced order.</p>

<pre><code>(1) Get Customer_ID from Customer table, where name is ""John""
(2) If there are no Customer_ID returned (There is no John), insert ""John""
(3) Get Customer_ID from Customer table, where name is ""John""
(4) Insert ""Customer_ID"" and ""1.34"" into Order table.
</code></pre>

<p>There are 4 SQL communication with database involved for this simple operation!!!</p>

<p>Is there any better way, which can be achievable using 1 SQL statement?</p>
","<p>You can do it in one sql statement for existing customers, 3 statements for new ones.  All you have to do is be an optimist and act as though the customer already exists:</p>

<pre><code>insert into ""order"" (customer_id, price) values \
((select customer_id from customer where name = 'John'), 12.34);
</code></pre>

<p>If the customer does not exist, you'll get an sql exception which text will be something like:</p>

<pre><code>null value in column ""customer_id"" violates not-null constraint
</code></pre>

<p>(providing you made customer_id non-nullable, which I'm sure you did).  When that exception occurs, insert the customer into the customer table and redo the insert into the order table:</p>

<pre><code>insert into customer(name) values ('John');
insert into ""order"" (customer_id, price) values \
((select customer_id from customer where name = 'John'), 12.34);
</code></pre>

<p>Unless your business is growing at a rate that will make ""where to put all the money"" your only real problem, most of your inserts will be for existing customers.  So, most of the time, the exception won't occur and you'll be done in one statement.</p>
","2004477"
"Return value using String result=Command.ExecuteScalar() error occurs when result returns null","126989","","<p>I want to fetch 1st row 1st cell value from database it works well with below code . But when there is no result found it throws Exception.</p>

<p>How to handle with <code>DBNull</code> .<br>
Should i change my query ? which return some value if theirs no record ?</p>

<p><em>System.NullReferenceException: Object reference not set to an instance of an object.</em></p>

<p><strong>Code:</strong></p>

<pre><code>    public string absentDayNo(DateTime sdate, DateTime edate, string idemp)
    { 
       string result=""0"";
       string myQuery=""select COUNT(idemp_atd) absentDayNo from td_atd where "";
       myQuery +="" absentdate_atd between '""+sdate+""' and '""+edate+"" "";
       myQuery +="" and idemp_atd='""+idemp+""' group by idemp_atd "";

       SqlCommand cmd = new SqlCommand(myQuery, conn);
       conn.Open();
//System.NullReferenceException occurs when their is no data/result
       string getValue = cmd.ExecuteScalar().ToString();
         if (getValue != null)
         {
            result = getValue.ToString();
         }
         conn.Close();
        return result;
    }
</code></pre>
","<p>There is no need to keep calling <code>.ToString()</code> as <code>getValue</code> is already a string.</p>

<p>Aside that, this line could possibly be your problem:</p>

<pre><code> string getValue = cmd.ExecuteScalar().ToString();  
</code></pre>

<p>If there are no rows <code>.ExecuteScalar</code> will return <code>null</code> so you need to do some checking.</p>

<p>For instance:</p>

<pre><code>var firstColumn = cmd.ExecuteScalar();

if (firstColumn != null) {
    result = firstColumn.ToString();
}
</code></pre>
","16647283"
"case statement in where clause - SQL Server","126571","","<p>I'm trying to add a case or if statement in the where clause of my SQL query.<br>
I have a table of journey times with a start and end date, and a boolean field for each day to signify where the journey happens on that day. Here is what I have so far, but I'm getting incorrect syntax errors:</p>

<pre><code>declare @date datetime
set @Date = '05/04/2012' 
declare @day nvarchar(50)
set @day = 'Monday'

Select * From Times
WHERE (StartDate &lt;= @Date) AND (EndDate &gt;= @Date)
CASE WHEN @day = 'Monday' THEN
 AND (Monday = 1)
WHEN @day = 'Tuesday' THEN
AND (Tuesday = 1)
ELSE
AND (Wednesday = 1) 
END 
</code></pre>
","<p>You don't need <code>case</code> in the <code>where</code> statement, just use parentheses and <code>or</code>:</p>

<pre><code>Select * From Times
WHERE StartDate &lt;= @Date AND EndDate &gt;= @Date
AND (
    (@day = 'Monday' AND Monday = 1)
    OR (@day = 'Tuesday' AND Tuesday = 1)
    OR Wednesday = 1
)
</code></pre>

<p>Additionally, your syntax is wrong for a case. It doesn't append things to the string--it returns a single value. You'd want something like this, if you were actually going to use a <code>case</code> statement (which you shouldn't):</p>

<pre><code>Select * From Times
WHERE (StartDate &lt;= @Date) AND (EndDate &gt;= @Date)
AND 1 = CASE WHEN @day = 'Monday' THEN Monday
             WHEN @day = 'Tuesday' THEN Tuesday
             ELSE Wednesday
        END 
</code></pre>

<p>And just for an extra umph, you can use the <code>between</code> operator for your date:</p>

<pre><code>where @Date between StartDate and EndDate
</code></pre>

<p>Making your final query:</p>

<pre><code>select
    * 
from 
    Times
where
    @Date between StartDate and EndDate
    and (
        (@day = 'Monday' and Monday = 1)
        or (@day = 'Tuesday' and Tuesday = 1)
        or Wednesday = 1
    )
</code></pre>
","8730986"
"SQL Current month/ year question","126563","","<p>So I have a table that has the month and year broken down, for example field called Month has the number 7 in it (this month) and the Year field has 2011. Theres also additional months years, etc. How can I query this to show just the current year, month? </p>
","<p>In SQL Server you can use <code>YEAR</code>, <code>MONTH</code> and <code>DAY</code>  instead of <code>DATEPART</code>.<br>
<em>(at least in SQL Server 2005/2008, I'm not sure about SQL Server 2000 and older)</em></p>

<p>I prefer using these ""short forms"" because to me, <code>YEAR(getdate())</code> is shorter to type and better to read than <code>DATEPART(yyyy, getdate())</code>.</p>

<p>So you could also query your table like this:</p>

<pre><code>select *
from your_table
where month_column = MONTH(getdate())
and year_column = YEAR(getdate())
</code></pre>
","6687049"
"Use LIKE %..% with field values in MySQL","126561","","<p>I stumbled into a delicate SQL problem when I needed to use a value from a field inside a LIKE %..% statement.</p>

<p>Example:</p>

<pre><code>SELECT t1.Notes, t2.Name
FROM Table1 t1, Table2 t2
WHERE t1.Notes LIKE '%t2.Name%'
</code></pre>

<p>This is only an example from the top of my head to show what I need to do (I know this will not work). I need to use the value of t2.Name inside the LIKE %..%</p>

<p>I guess this is trivial when you know it ;)</p>
","<p>Use:</p>

<pre><code>SELECT t1.Notes, 
       t2.Name
  FROM Table1 t1
  JOIN Table2 t2 ON t1.Notes LIKE CONCAT('%', t2.Name ,'%')
</code></pre>
","4420559"
"SQL to LINQ Tool","126490","","<p>Is there a tool out there which can convert SQL syntax to LINQ syntax? </p>

<p>I just want to rewrite basic queries with join, etc., to <a href=""http://en.wikipedia.org/wiki/Language_Integrated_Query"" rel=""noreferrer"">LINQ</a>. It would save me a lot of time.</p>
","<p><a href=""http://www.sqltolinq.com/"" rel=""noreferrer""><strong>Linqer</strong></a> is a SQL to LINQ converter tool. It helps you to learn LINQ and convert your existing SQL statements.</p>

<p>Not every SQL statement can be converted to LINQ, but Linqer covers many different types of SQL expressions. Linqer supports both .NET languages - C# and Visual Basic.</p>
","297108"
"How to Select Every Row Where Column Value is NOT Distinct","126364","","<p>I need to run a select statement that returns all rows where the value of a column is not distinct (e.g. EmailAddress).</p>

<p>For example, if the table looks like below:</p>

<pre><code>CustomerName     EmailAddress
Aaron            aaron@gmail.com
Christy          aaron@gmail.com
Jason            jason@gmail.com
Eric             eric@gmail.com
John             aaron@gmail.com
</code></pre>

<p>I need the query to return:</p>

<pre><code>Aaron            aaron@gmail.com
Christy          aaron@gmail.com
John             aaron@gmail.com (peer edited from john@gmail.com)
</code></pre>

<p>I have read many posts and tried different queries to no avail.  The query that I believe should work is below.  Can someone suggest an alternative or tell me what may be wrong with my query?</p>

<pre><code>select EmailAddress, CustomerName from Customers
group by EmailAddress, CustomerName
having COUNT(distinct(EmailAddress)) &gt; 1
</code></pre>
","<p>This is significantly faster than the <code>EXISTS</code> way:</p>

<pre><code>SELECT [EmailAddress], [CustomerName] FROM [Customers] WHERE [EmailAddress] IN
  (SELECT [EmailAddress] FROM [Customers] GROUP BY [EmailAddress] HAVING COUNT(*) &gt; 1)
</code></pre>
","19326703"
"How to execute raw SQL in SQLAlchemy-flask app","126255","","<p>How do you execute raw SQL in SQLAlchemy?</p>

<p>I have a python web app that runs on flask and interfaces to the database through SQLAlchemy. </p>

<p>I need a way to run the raw SQL. The query involves multiple table joins along with Inline views. </p>

<p>I've tried:</p>

<pre><code>connection = db.session.connection()
connection.execute( &lt;sql here&gt; )
</code></pre>

<p>But I keep getting gateway errors.</p>
","<p>Have you tried:</p>

<pre><code>result = db.engine.execute(""&lt;sql here&gt;"")
</code></pre>

<p>or:</p>

<pre><code>from sqlalchemy import text

sql = text('select name from penguins')
result = db.engine.execute(sql)
names = []
for row in result:
    names.append(row[0])

print names
</code></pre>
","17987782"
"How can a LEFT OUTER JOIN return more records than exist in the left table?","126222","","<p>I have a very basic LEFT OUTER JOIN to return all results from the left table and some additional information from a much bigger table. The left table contains 4935 records yet when I LEFT OUTER JOIN it to an additional table the record count is significatnly larger.</p>

<p>As far as I'm aware it is absolute gospel that a LEFT OUTER JOIN will return all records from the left table with matched records from the right table and null values for any rows which cannot be matched, as such it's my understanding that it should be impossible to return more rows than exist in the left table, but it's happening all the same!</p>

<p>SQL Query follows:</p>

<pre><code>SELECT     SUSP.Susp_Visits.SuspReason, SUSP.Susp_Visits.SiteID
FROM         SUSP.Susp_Visits LEFT OUTER JOIN
                      DATA.Dim_Member ON SUSP.Susp_Visits.MemID = DATA.Dim_Member.MembershipNum
</code></pre>

<p>Perhaps I have made a mistake in the syntax or my understanding of LEFT OUTER JOIN is incomplete, whatever the reason I'm going mad here, hopefully someone can explain how this could be occuring?</p>

<p>Postscript</p>

<p>Thanks for the grea answers, my understanding of LEFT OUTER JOINS is now much better, could anyone however suggest a way this query could be modified so that I only get as many records returned as exist in the left table? </p>

<p>This query is purely to generate a report and the duplicate matches simply confuse matters.</p>

<p>/Postscript</p>
","<p>The LEFT OUTER JOIN will return all records from the LEFT table joined with the RIGHT table where possible.</p>

<p>If there are matches though, it will still return all rows that match, therefore, one row in LEFT that matches two rows in RIGHT will return as two ROWS, just like an INNER JOIN.</p>

<p>EDIT:
In response to your edit, I've just had a further look at your query and it looks like you are only returning data from the LEFT table. Therefore, if you only want data from the LEFT table, and you only want one row returned for each row in the LEFT table, then you have no need to perform a JOIN at all and can just do a SELECT directly from the LEFT table.</p>
","916426"
"SQL Case Sensitive String Compare","126044","","<p>How do you compare strings so that the comparison is true only if the cases of each of the strings are equal as well.  For example:</p>

<pre><code>Select * from a_table where attribute = 'k'
</code></pre>

<p>...will return a row with an attribute of 'K'. I do not want this behaviour.</p>
","<pre><code>Select * from a_table where attribute = 'k' COLLATE Latin1_General_CS_AS 
</code></pre>

<p>Did the trick.</p>
","3969095"
"SQL Server 2008: TOP 10 and distinct together","125944","","<p>As the title says, I'm using SQL Server 2008. Apologies if this question is very basic. I've only been using SQL for a few days. Right now I have the following query:</p>

<pre><code>SELECT TOP 10 p.id, pl.nm, pl.val, pl.txt_val

from dm.labs pl
join mas_data.patients p    
  on pl.id = p.id
  where pl.nm like '%LDL%'
  and val is not null
</code></pre>

<p>What I want to do is use select top n together with distinct values in the id column. Searching through some forums says to use</p>

<pre><code>SELECT DISTINCT TOP 10 ...
</code></pre>

<p>but when I replace the first line with</p>

<pre><code>SELECT DISTINCT TOP 10 p.id, pl.nm, pl.val, pl.txt_val
</code></pre>

<p>I get the same results as without the word distinct. What should I be doing to only get to filter out duplicate id entries?</p>

<p>Thank you.</p>
","<p>The easy option is to use group by and select min/max for all other fields</p>

<pre><code>SELECT TOP 10 
    p.id, 
    max(pl.nm),
    max(pl.val),
    max(pl.txt_val)
from 
    dm.labs pl
join 
    mas_data.patients p    
on 
    pl.id = p.id
  where 
    pl.nm like '%LDL%'
and 
    val is not null
group by 
    p.id
</code></pre>

<p>This can get quite tedious for wide table so the other option is to use rank over and partiion</p>

<pre><code>SELECT TOP 10 
    p.id, 
     pl.nm, 
     pl.val, 
   pl.txt_val, 
    rank() over(partition by p.id order by p.id) as Rank
from 
    dm.labs pl
join 
    mas_data.patients p    
on 
    pl.id = p.id
  where 
    pl.nm like '%LDL%'
and 
    val is not null
and
    Rank = 1
</code></pre>
","1925238"
"How do you copy a record in a SQL table but swap out the unique id of the new row?","125874","","<p><a href=""https://stackoverflow.com/questions/57168/how-to-copy-a-row-from-one-sql-server-table-to-another"">This question</a> comes close to what I need, but my scenario is slightly different. The source table and destination table are the same and the primary key is a uniqueidentifier (guid). When I try this:</p>

<pre><code>insert into MyTable
    select * from MyTable where uniqueId = @Id;
</code></pre>

<p>I obviously get a primary key constraint violation, since I'm attempting to copy over the primary key. Actually, I don't want to copy over the primary key at all. Rather, I want to create a new one. Additionally, I would like to selectively copy over certain fields, and leave the others null. To make matters more complex, I need to take the primary key of the original record, and insert it into another field in the copy (PreviousId field).</p>

<p>I'm sure there is an easy solution to this, I just don't know enough TSQL to know what it is.</p>
","<p>Try this:
<pre><code>
insert into MyTable(field1, field2, id_backup)
    select field1, field2, uniqueId from MyTable where uniqueId = @Id;
</pre></code></p>

<p>Any fields not specified should receive their default value (which is usually NULL when not defined).</p>
","149792"
"Real life example, when to use OUTER / CROSS APPLY in SQL","125668","","<p>I have been looking at <code>CROSS / OUTER APPLY</code> with a colleague and we're struggling to find real life examples of where to use them.</p>

<p>I've spent quite a lot of time looking at <a href=""https://stackoverflow.com/questions/1139160/when-should-i-use-cross-apply-over-inner-join"">When should I use Cross Apply over Inner Join?</a> and googling but the main (only) example seems pretty bizarre (using the rowcount from a table to determine how many rows to select from another table).</p>

<p>I thought this scenario may benefit from <code>OUTER APPLY</code>:</p>

<p>Contacts Table (contains 1 record for each contact)
Communication Entries Table (can contain n phone, fax, email fro each contact)</p>

<p>But using subqueries, common table expressions, <code>OUTER JOIN</code> with <code>RANK()</code> and <code>OUTER APPLY</code> all seem to perform equally. I'm guessing this means the scenario isn't applicable to <code>APPLY</code>.</p>

<p>Please share some real life examples and help explain the feature!</p>
","<p>Some uses for <code>APPLY</code> are...</p>

<p><strong>1)</strong> <a href=""http://www.sqlmag.com/article/departments/optimizing-top-n-per-group-queries"">Top N per group queries</a> (can be more efficient for some cardinalities)</p>

<pre><code>SELECT pr.name,
       pa.name
FROM   sys.procedures pr
       OUTER APPLY (SELECT TOP 2 *
                    FROM   sys.parameters pa
                    WHERE  pa.object_id = pr.object_id
                    ORDER  BY pr.name) pa
ORDER  BY pr.name,
          pa.name 
</code></pre>

<p><strong>2)</strong> Calling a Table Valued Function for each row in the outer query</p>

<pre><code>SELECT *
FROM sys.dm_exec_query_stats AS qs
CROSS APPLY sys.dm_exec_query_plan(qs.plan_handle)
</code></pre>

<p><strong>3)</strong> <a href=""http://www.sqlmag.com/blog/puzzled-by-t-sql-blog-15/tsql/tip-apply-and-reuse-of-column-aliases-136842"">Reusing a column alias</a> </p>

<pre><code>SELECT number,
       doubled_number,
       doubled_number_plus_one
FROM master..spt_values
CROSS APPLY (SELECT 2 * CAST(number AS BIGINT)) CA1(doubled_number)  
CROSS APPLY (SELECT doubled_number + 1) CA2(doubled_number_plus_one)  
</code></pre>

<p><strong>4)</strong> <a href=""http://bradsruminations.blogspot.com/2010/02/spotlight-on-unpivot-part-1.html"">Unpivoting more than one group of columns</a></p>

<p>Assumes 1NF violating table structure....</p>

<pre><code>CREATE TABLE T
  (
     Id   INT PRIMARY KEY,

     Foo1 INT, Foo2 INT, Foo3 INT,
     Bar1 INT, Bar2 INT, Bar3 INT
  ); 
</code></pre>

<p>Example using 2008+ <code>VALUES</code> syntax.</p>

<pre><code>SELECT Id,
       Foo,
       Bar
FROM   T
       CROSS APPLY (VALUES(Foo1, Bar1),
                          (Foo2, Bar2),
                          (Foo3, Bar3)) V(Foo, Bar); 
</code></pre>

<p>In 2005 <code>UNION ALL</code> can be used instead.</p>

<pre><code>SELECT Id,
       Foo,
       Bar
FROM   T
       CROSS APPLY (SELECT Foo1, Bar1 
                    UNION ALL
                    SELECT Foo2, Bar2 
                    UNION ALL
                    SELECT Foo3, Bar3) V(Foo, Bar);
</code></pre>
","9275865"
"Oracle - How to create a materialized view with FAST REFRESH and JOINS","125664","","<p>So I'm pretty sure Oracle supports this, so I have no idea what I'm doing wrong.  This code works:</p>

<pre><code>CREATE MATERIALIZED VIEW MV_Test
  NOLOGGING
  CACHE
  BUILD IMMEDIATE 
  REFRESH FAST ON COMMIT 
  AS
    SELECT V.* FROM TPM_PROJECTVERSION V;
</code></pre>

<p>If I add in a JOIN, it breaks:</p>

<pre><code>CREATE MATERIALIZED VIEW MV_Test
  NOLOGGING
  CACHE
  BUILD IMMEDIATE 
  REFRESH FAST ON COMMIT 
  AS
    SELECT V.*, P.* FROM TPM_PROJECTVERSION V
    INNER JOIN TPM_PROJECT P ON P.PROJECTID = V.PROJECTID
</code></pre>

<p>Now I get the error:</p>

<p><em>ORA-12054: cannot set the ON COMMIT refresh attribute for the materialized view</em></p>

<p>I've created materialized view logs on both TPM_PROJECT and TPM_PROJECTVERSION.  TPM_PROJECT has a primary key of PROJECTID and TPM_PROJECTVERSION has a compound primary key of (PROJECTID,VERSIONID).  What's the trick to this?  I've been digging through Oracle manuals to no avail.  Thanks!</p>
","<p>To start with, from the <a href=""http://download.oracle.com/docs/cd/B19306_01/server.102/b14223/basicmv.htm#sthref537"" rel=""noreferrer"">Oracle Database Data Warehousing Guide</a>:</p>

<blockquote>
  <p><strong>Restrictions on Fast Refresh on Materialized Views with Joins Only</strong></p>
  
  <p>...</p>
  
  <ul>
  <li>Rowids of all the tables in the FROM list must appear in the SELECT
  list of the query.</li>
  </ul>
</blockquote>

<p>This means that your statement will need to look something like this:</p>

<pre><code>CREATE MATERIALIZED VIEW MV_Test
  NOLOGGING
  CACHE
  BUILD IMMEDIATE 
  REFRESH FAST ON COMMIT 
  AS
    SELECT V.*, P.*, V.ROWID as V_ROWID, P.ROWID as P_ROWID 
    FROM TPM_PROJECTVERSION V,
         TPM_PROJECT P 
    WHERE P.PROJECTID = V.PROJECTID
</code></pre>

<p>Another key aspect to note is that your materialized view logs must be created as <code>with rowid</code>.</p>

<p>Below is a functional test scenario:</p>

<pre><code>CREATE TABLE foo(foo NUMBER, CONSTRAINT foo_pk PRIMARY KEY(foo));

CREATE MATERIALIZED VIEW LOG ON foo WITH ROWID;

CREATE TABLE bar(foo NUMBER, bar NUMBER, CONSTRAINT bar_pk PRIMARY KEY(foo, bar));

CREATE MATERIALIZED VIEW LOG ON bar WITH ROWID;

CREATE MATERIALIZED VIEW foo_bar
  NOLOGGING
  CACHE
  BUILD IMMEDIATE
  REFRESH FAST ON COMMIT  AS SELECT foo.foo, 
                                    bar.bar, 
                                    foo.ROWID AS foo_rowid, 
                                    bar.ROWID AS bar_rowid 
                               FROM foo, bar
                              WHERE foo.foo = bar.foo;
</code></pre>
","7505817"
"How to return multiple values in one column (T-SQL)?","125422","","<p>I have a table <code>UserAliases</code> (<code>UserId, Alias</code>) with multiple aliases per user. I need to query it and return all aliases for a given user, the trick is to return them all in one column.</p>

<p>Example:</p>

<pre><code>UserId/Alias  
1/MrX  
1/MrY  
1/MrA  
2/Abc  
2/Xyz
</code></pre>

<p>I want the query result in the following format:</p>

<pre><code>UserId/Alias  
1/ MrX, MrY, MrA  
2/ Abc, Xyz
</code></pre>

<p>Thank you.</p>

<p>I'm using SQL Server 2005.</p>

<p>p.s. actual T-SQL query would be appreciated :)</p>
","<p>You can use a function with COALESCE.</p>

<pre><code>CREATE FUNCTION [dbo].[GetAliasesById]
(
    @userID int
)
RETURNS varchar(max)
AS
BEGIN
    declare @output varchar(max)
    select @output = COALESCE(@output + ', ', '') + alias
    from UserAliases
    where userid = @userID

    return @output
END

GO

SELECT UserID, dbo.GetAliasesByID(UserID)
FROM UserAliases
GROUP BY UserID

GO
</code></pre>
","123025"
"How to populate HTML dropdown list with values from database","125413","","<p>as part of a HTML form I am creating I would like to have a dropdown list which will list all the usernames in my database.</p>

<p>I thought the following code would do the trick but the dropdown list is empty - could someone assist me in what i'm doing wrong? Thanks.</p>

<pre><code>&lt;tr&gt;
&lt;td&gt;Owner&lt;/td&gt;
&lt;td&gt;
&lt;select name=""owner""&gt;
&lt;?php 

$sql = mysqli_query($connection, ""SELECT username FROM users"");

while ($row = $sql-&gt;fetch_assoc()){

?&gt;
&lt;option value=""owner1""&gt;&lt;?php echo $row['username']; ?&gt;&lt;/option&gt;

&lt;?php
// close while loop 
}
?&gt;
&lt;/td&gt;
&lt;/tr&gt;
</code></pre>
","<p>My guess is that you have a problem since you don't close your select-tag after the loop. Could that do the trick?</p>

<pre><code>&lt;select name=""owner""&gt;
&lt;?php 
$sql = mysqli_query($connection, ""SELECT username FROM users"");
while ($row = $sql-&gt;fetch_assoc()){
echo ""&lt;option value=\""owner1\""&gt;"" . $row['username'] . ""&lt;/option&gt;"";
}
?&gt;
&lt;/select&gt;
</code></pre>
","8022373"
"LINQ to SQL - Left Outer Join with multiple join conditions","125197","","<p>I have the following SQL, which I am trying to translate to LINQ:</p>

<pre><code>SELECT f.value
FROM period as p 
LEFT OUTER JOIN facts AS f ON p.id = f.periodid AND f.otherid = 17
WHERE p.companyid = 100
</code></pre>

<p>I have seen the typical implementation of the left outer join (ie. <code>into x from y in x.DefaultIfEmpty()</code> etc.) but am unsure how to introduce the other join condition (<code>AND f.otherid = 17</code>)</p>

<p><strong>EDIT</strong></p>

<p>Why is the <code>AND f.otherid = 17</code> condition part of the JOIN instead of in the WHERE clause?
Because <code>f</code> may not exist for some rows and I still want these rows to be included. If the condition is applied in the WHERE clause, after the JOIN - then I don't get the behaviour I want.</p>

<p>Unfortunately this:</p>

<pre><code>from p in context.Periods
join f in context.Facts on p.id equals f.periodid into fg
from fgi in fg.DefaultIfEmpty()
where p.companyid == 100 &amp;&amp; fgi.otherid == 17
select f.value
</code></pre>

<p>seems to be equivalent to this:</p>

<pre><code>SELECT f.value
FROM period as p 
LEFT OUTER JOIN facts AS f ON p.id = f.periodid 
WHERE p.companyid = 100 AND f.otherid = 17
</code></pre>

<p>which is not quite what I'm after.</p>
","<p>You need to introduce your join condition before calling <a href=""http://msdn.microsoft.com/en-us/library/bb360179.aspx"" rel=""noreferrer""><code>DefaultIfEmpty()</code></a>. I would just use extension method syntax:</p>

<pre><code>from p in context.Periods
join f in context.Facts on p.id equals f.periodid into fg
from fgi in fg.Where(f =&gt; f.otherid == 17).DefaultIfEmpty()
where p.companyid == 100
select f.value
</code></pre>

<p>Or you could use a subquery:</p>

<pre><code>from p in context.Periods
join f in context.Facts on p.id equals f.periodid into fg
from fgi in (from f in fg
             where f.otherid == 17
             select f).DefaultIfEmpty()
where p.companyid == 100
select f.value
</code></pre>
","1123051"
"Possible to perform cross-database queries with postgres?","125195","","<p>I'm going to guess that the answer is no based on the below error message (and <a href=""http://archives.postgresql.org/pgsql-sql/2004-08/msg00076.php"" rel=""noreferrer"">this Google result</a>), but is there anyway to perform a cross-database query using Postgres?</p>

<pre><code>databaseA=# select * from databaseB.public.someTableName;
ERROR:  cross-database references are not implemented:
 ""databaseB.public.someTableName""
</code></pre>

<p>I'm working with some data that is partitioned across two databases although data is really shared between the two (userid columns in one database come from the <code>users</code> table in the other database). I have no idea why these are two separate databases instead of schema, but c'est la vie...</p>
","<p><em>Note: As the original asker implied, if you are setting up two databases on the same machine you probably want to make two <a href=""https://www.postgresql.org/docs/current/static/ddl-schemas.html"" rel=""noreferrer"">schemas</a> instead - in that case you don't need anything special to query across them.</em></p>

<h3>Update as of 9.3</h3>

<p>You can now use the new <a href=""http://www.postgresql.org/docs/9.3/static/postgres-fdw.html"" rel=""noreferrer""><code>postgres_fdw</code></a> (foreign data wrapper) to connect to tables in any Postgres database - local or remote.</p>

<p>Note that there are <a href=""http://wiki.postgresql.org/wiki/Foreign_data_wrappers"" rel=""noreferrer"">foreign data wrappers for other popular data sources</a>. At this time, only <code>postgres_fdw</code> and <code>file_fdw</code> are part of the official Postgres distribution.</p>

<h3>Original answer for pre-9.3</h3>

<p>This functionality isn't part of the default PostgreSQL install, but you can add it in. It's called <a href=""http://www.postgresql.org/docs/9.3/static/dblink.html"" rel=""noreferrer""><code>dblink</code></a>.</p>

<p>I've never used it, but it is maintained and distributed with the rest of PostgreSQL. If you're using the version of PostgreSQL that came with your Linux distro, you might need to install a package called postgresql-contrib.</p>
","46448"
"Update multiple tables in SQL Server using INNER JOIN","125082","","<p>I'm using SQL Server and trying to use SQL to update multiple tables at once with one query:</p>

<p>The following query:</p>

<pre><code>update table1
set A.ORG_NAME =  @ORG_NAME, B.REF_NAME = @REF_NAME
from table1 A, table2 B
where B.ORG_ID = A.ORG_ID
and A.ORG_ID = @ORG_ID
</code></pre>

<p>Gives the error message:</p>

<blockquote>
  <p><em>The multi-part identifier ""A.ORG_NAME"" could not be bound.</em></p>
</blockquote>

<p>What does the error message mean?</p>
","<p>You can't update more that one table in a single statement, however the error message you get is because of the aliases, you could try this : </p>

<pre><code>BEGIN TRANSACTION

update A
set A.ORG_NAME =  @ORG_NAME
from table1 A inner join table2 B
on B.ORG_ID = A.ORG_ID
and A.ORG_ID = @ORG_ID

update B
set B.REF_NAME = @REF_NAME
from table2 B inner join table1 A
    on B.ORG_ID = A.ORG_ID
    and A.ORG_ID = @ORG_ID

COMMIT
</code></pre>
","15116036"
"PHP and MySQL Select a Single Value","124958","","<p>Sorry for such a basic question, but I haven't found a simple answer anywhere. I'd like to know how to select a single value from my mysql table. The table includes columns 'username' and 'id' amongst others ('id' is auto-increment and 'username' is unique). Given the username, I want to set a session variable <code>$_SESSION['myid']</code> equal to the value in the 'id' column that corresponds to the given username. Here's the code that I've already tried: </p>

<pre><code>session_start();
$name = $_GET[""username""];
$sql = ""SELECT 'id' FROM Users WHERE username='$name'"";
$result = mysql_query($sql);
$value = mysql_fetch_object($result);
$_SESSION['myid'] = $value;
</code></pre>

<p>So far I'm getting ""Catchable fatal error: Object of class stdClass could not be converted to string."" Casting <code>$value</code> to type string does not fix the problem.</p>
","<p>1) Don't use quotation in a field name or table name inside query.</p>

<p>2) After fetching object you need to access object attributes/properties (in your case  id ) by attributes/properties name. </p>

<p><strong>It should work</strong><br>
<em>Bonus tips: Use limit 1 for this type of question will save execution time :)</em></p>

<pre><code>session_start();
$name = $_GET[""username""];
$sql = ""SELECT id FROM Users WHERE username='$name' limit 1"";
$result = mysql_query($sql);
$value = mysql_fetch_object($result);
$_SESSION['myid'] = $value-&gt;id;
</code></pre>

<p>One note: <strong>please use mysqli_* or PDO since mysql_* deprecated.</strong></p>
","20878134"
"SQL Server : check if variable is Empty or NULL for WHERE clause","124717","","<p>When searching for a list of products, the <code>@SearchType</code> parameter is optional. If <code>@SearchType</code> is empty or <code>NULL</code> then it should return all products and not use the <code>WHERE</code> clause. Otherwise, if it passed <code>Equipment</code> it would then use that instead.</p>

<pre><code>ALTER PROCEDURE [dbo].[psProducts] 
    (@SearchType varchar(50))
AS
BEGIN
    SET NOCOUNT ON;

    SELECT 
        P.[ProductId],
        P.[ProductName],
        P.[ProductPrice],
        P.[Type]
    FROM [Product] P
    -- if @Searchtype is not null then use the where clause
    WHERE p.[Type] = @SearchType
END
</code></pre>
","<p>Just use</p>

<p>If @searchType is null means 'return the whole table' then use</p>

<pre><code>WHERE p.[Type] = @SearchType OR @SearchType is NULL
</code></pre>

<p>If @searchType is an empty string means 'return the whole table' then use</p>

<pre><code>WHERE p.[Type] = @SearchType OR @SearchType = ''
</code></pre>

<p>If @searchType is null or an empty string means 'return the whole table' then use</p>

<pre><code>WHERE p.[Type] = @SearchType OR Coalesce(@SearchType,'') = ''
</code></pre>
","10284180"
"MYSQL order by both Ascending and Descending sorting","124467","","<p>I have a mysql table with products.</p>

<p>The products have a category ID and a name.</p>

<p>What I'd like to do is order by category id first descending order and then order by product name ascending order.</p>

<pre><code>SELECT * FROM `products` ORDER BY `products`.`product_category_id`,`naam` DESC
</code></pre>

<p>What i'd like is </p>

<pre><code>SELECT * FROM `products` ORDER BY `products`.`product_category_id`,`naam` DESC,ASC
</code></pre>

<p>but that unfortunately doesn't work.</p>

<p>Is this even possible in mysql to define the sorting order of the second sorting column?</p>
","<p>You can do that in this way:</p>

<pre><code>ORDER BY `products`.`product_category_id` DESC ,`naam` ASC
</code></pre>

<p>Have a look at <a href=""http://dev.mysql.com/doc/refman/5.0/en/order-by-optimization.html""><code>ORDER BY</code> Optimization</a></p>
","13468805"
"How do I convert a number to a numeric, comma-separated formatted string?","124247","","<p>Is there an easy way to convert a number (in my case an integer) to a comma separated <code>nvarchar</code> string?</p>

<p>For instance, if I had an <code>int</code> value of <code>1000000</code> stored in a field, how can I convert it to an <code>nvarchar</code> string with the outputted result of ""1,000,000""?</p>

<p>I could easily write a function to do this but I wanted to be sure there wasn't an easier way involving a call to either <code>CAST</code> or <code>CONVERT</code>.</p>
","<p>For <em>SQL Server 2012</em>, or later, an easier solution is to use <a href=""https://msdn.microsoft.com/en-us/library/hh213505%28v=sql.110%29.aspx""><code>FORMAT ()</code><sup>Documentation</sup></a>.<br>
EG:</p>

<pre><code>SELECT Format(1234567.8, '##,##0') 
</code></pre>

<p>Results in: <code>1,234,568</code></p>
","27638248"
"Show MySQL host via SQL Command","124020","","<pre><code>Show Database
Use database
show tables
Describe &lt;table&gt;
</code></pre>

<p>All good and well, but is it possible to show the current connections host.
Not connection_id, but the IP Address or Name of the host.</p>
","<p>To get current host name :-</p>

<pre><code>select @@hostname;
show variables where Variable_name like '%host%';
</code></pre>

<p>To get hosts for all incoming requests :-</p>

<pre><code>select host from information_schema.processlist;
</code></pre>

<p>Based on your last comment,<br>
I don't think you can resolve IP for the hostname using pure mysql function,<br>
as it require a network lookup, which could be taking long time. </p>

<p>However, mysql document mention this :-</p>

<pre><code>resolveip google.com.sg
</code></pre>

<p>docs :- <a href=""http://dev.mysql.com/doc/refman/5.0/en/resolveip.html"" rel=""noreferrer"">http://dev.mysql.com/doc/refman/5.0/en/resolveip.html</a></p>
","8283266"
"Get a list of dates between two dates","123919","","<p>Using standard mysql functions is there a way to write a query that will return a list of days between two dates.</p>

<p>eg given 2009-01-01 and 2009-01-13 it would return a one column table with the values:</p>

<pre><code> 2009-01-01 
 2009-01-02 
 2009-01-03
 2009-01-04 
 2009-01-05
 2009-01-06
 2009-01-07
 2009-01-08 
 2009-01-09
 2009-01-10
 2009-01-11
 2009-01-12
 2009-01-13
</code></pre>

<p>Edit: It appears I have not been clear. I want to GENERATE this list. I have values stored in the database (by datetime) but want them to be aggregated on a left outer join to a list of dates as above (I am expecting null from the right side of some of this join for some days and will handle this).</p>
","<p>I would use this stored procedure to generate the intervals you need into the temp table named <strong>time_intervals</strong>, then JOIN and aggregate your data table with the temp <strong>time_intervals</strong> table.</p>

<p>The procedure can generate intervals of all the different types you see specified in it:  </p>

<pre><code>call make_intervals('2009-01-01 00:00:00','2009-01-10 00:00:00',1,'DAY')
.
select * from time_intervals  
.
interval_start      interval_end        
------------------- ------------------- 
2009-01-01 00:00:00 2009-01-01 23:59:59 
2009-01-02 00:00:00 2009-01-02 23:59:59 
2009-01-03 00:00:00 2009-01-03 23:59:59 
2009-01-04 00:00:00 2009-01-04 23:59:59 
2009-01-05 00:00:00 2009-01-05 23:59:59 
2009-01-06 00:00:00 2009-01-06 23:59:59 
2009-01-07 00:00:00 2009-01-07 23:59:59 
2009-01-08 00:00:00 2009-01-08 23:59:59 
2009-01-09 00:00:00 2009-01-09 23:59:59 
.
call make_intervals('2009-01-01 00:00:00','2009-01-01 02:00:00',10,'MINUTE')
. 
select * from time_intervals
.  
interval_start      interval_end        
------------------- ------------------- 
2009-01-01 00:00:00 2009-01-01 00:09:59 
2009-01-01 00:10:00 2009-01-01 00:19:59 
2009-01-01 00:20:00 2009-01-01 00:29:59 
2009-01-01 00:30:00 2009-01-01 00:39:59 
2009-01-01 00:40:00 2009-01-01 00:49:59 
2009-01-01 00:50:00 2009-01-01 00:59:59 
2009-01-01 01:00:00 2009-01-01 01:09:59 
2009-01-01 01:10:00 2009-01-01 01:19:59 
2009-01-01 01:20:00 2009-01-01 01:29:59 
2009-01-01 01:30:00 2009-01-01 01:39:59 
2009-01-01 01:40:00 2009-01-01 01:49:59 
2009-01-01 01:50:00 2009-01-01 01:59:59 
.
I specified an interval_start and interval_end so you can aggregate the 
data timestamps with a ""between interval_start and interval_end"" type of JOIN.
.
Code for the proc:
.
-- drop procedure make_intervals
.
CREATE PROCEDURE make_intervals(startdate timestamp, enddate timestamp, intval integer, unitval varchar(10))
BEGIN
-- *************************************************************************
-- Procedure: make_intervals()
--    Author: Ron Savage
--      Date: 02/03/2009
--
-- Description:
-- This procedure creates a temporary table named time_intervals with the
-- interval_start and interval_end fields specifed from the startdate and
-- enddate arguments, at intervals of intval (unitval) size.
-- *************************************************************************
   declare thisDate timestamp;
   declare nextDate timestamp;
   set thisDate = startdate;

   -- *************************************************************************
   -- Drop / create the temp table
   -- *************************************************************************
   drop temporary table if exists time_intervals;
   create temporary table if not exists time_intervals
      (
      interval_start timestamp,
      interval_end timestamp
      );

   -- *************************************************************************
   -- Loop through the startdate adding each intval interval until enddate
   -- *************************************************************************
   repeat
      select
         case unitval
            when 'MICROSECOND' then timestampadd(MICROSECOND, intval, thisDate)
            when 'SECOND'      then timestampadd(SECOND, intval, thisDate)
            when 'MINUTE'      then timestampadd(MINUTE, intval, thisDate)
            when 'HOUR'        then timestampadd(HOUR, intval, thisDate)
            when 'DAY'         then timestampadd(DAY, intval, thisDate)
            when 'WEEK'        then timestampadd(WEEK, intval, thisDate)
            when 'MONTH'       then timestampadd(MONTH, intval, thisDate)
            when 'QUARTER'     then timestampadd(QUARTER, intval, thisDate)
            when 'YEAR'        then timestampadd(YEAR, intval, thisDate)
         end into nextDate;

      insert into time_intervals select thisDate, timestampadd(MICROSECOND, -1, nextDate);
      set thisDate = nextDate;
   until thisDate &gt;= enddate
   end repeat;

 END;
</code></pre>

<p>Similar example data scenario at the bottom of <a href=""https://stackoverflow.com/questions/373490/insert-dates-in-the-return-from-a-query-where-there-is-none/373734#373734"">this post</a>, where I built a similar function for SQL Server.</p>
","510239"
"Use string contains function in oracle SQL query","123838","","<p>I'm using an Oracle database and I want to know how can I find rows in a varchar type column where the values of that column has a string which contains some character.</p>

<p>I'm trying something like this (that's a simple example of what I want), but it doesn't work:</p>

<pre><code>select p.name
from   person p
where  p.name contains the character 'A';
</code></pre>

<p>I also want to know if I can use a function like <code>chr(1234)</code> where 1234 is an ASCII code instead of the <code>'A'</code> character in my example query, because in my case I want to search in my database values where the name of a person contains the character with 8211 as ASCII code.</p>

<p>With the query <code>select CHR(8211) from dual;</code> I get the special character that I want.</p>

<p><em>Example:</em></p>

<pre><code>select p.name
from   person p
where  p.name contains the character chr(8211);
</code></pre>
","<p>By <em>lines</em> I assume you mean rows in the table <code>person</code>. What you're looking for is:</p>

<pre><code>select p.name
from   person p
where  p.name LIKE '%A%'; --contains the character 'A'
</code></pre>

<p>The above is case sensitive. For a case insensitive search, you can do:</p>

<pre><code>select p.name
from   person p
where  UPPER(p.name) LIKE '%A%'; --contains the character 'A' or 'a'
</code></pre>

<p>For the special character, you can do:</p>

<pre><code>select p.name
from   person p
where  p.name LIKE '%'||chr(8211)||'%'; --contains the character chr(8211)
</code></pre>

<p>The <code>LIKE</code> operator matches a pattern. The syntax of this command is described in detail in the <a href=""http://docs.oracle.com/cd/B19306_01/server.102/b14200/conditions007.htm"">Oracle documentation</a>. You will mostly use the <code>%</code> sign as it means <em>match zero or more characters</em>.</p>
","20346741"
"trim left characters in sql server?","123761","","<p>I want to write a sql statement to trim a string 'Hello' from the string ""Hello World'.
Please suggest.</p>
","<pre><code>select substring( field, 1, 5 ) from sometable
</code></pre>
","4662544"
"How to return a table from a Stored Procedure?","123686","","<p>It is very simple question.</p>

<p>I am trying to return a table from a stored procedure, like</p>

<pre><code>select * from emp where id=@id
</code></pre>

<p>I want to return this query result as a table. I have to do this through a stored procedure.</p>
","<p>Where is your problem?? </p>

<p>For the stored procedure, just create:</p>

<pre><code>CREATE PROCEDURE dbo.ReadEmployees @EmpID INT
AS
   SELECT *  -- I would *strongly* recommend specifying the columns EXPLICITLY
   FROM dbo.Emp
   WHERE ID = @EmpID
</code></pre>

<p>That's all there is.</p>

<p>From your ASP.NET application, just create a <code>SqlConnection</code> and a <code>SqlCommand</code> (don't forget to set the <code>CommandType = CommandType.StoredProcedure</code>) </p>

<pre><code>DataTable tblEmployees = new DataTable();

using(SqlConnection _con = new SqlConnection(""your-connection-string-here""))
using(SqlCommand _cmd = new SqlCommand(""ReadEmployees"", _con))
{
    _cmd.CommandType = CommandType.StoredProcedure;

    _cmd.Parameters.Add(new SqlParameter(""@EmpID"", SqlDbType.Int));
    _cmd.Parameters[""@EmpID""].Value = 42;

    SqlDataAdapter _dap = new SqlDataAdapter(_cmd);

    _dap.Fill(tblEmployees);
}

YourGridView.DataSource = tblEmployees;
YourGridView.DataBind();
</code></pre>

<p>and then fill e.g. a <code>DataTable</code> with that data and bind it to e.g. a GridView.</p>
","5604998"
"In MS-SQL, how do I INSERT INTO a temp table, and have an IDENTITY field created, without first declaring the temp table?","123531","","<p>I need to select a bunch of data into a temp table to then do some secondary calculations; To help make it work more efficiently, I would like to have an IDENTITY column on that table.  I know I could declare the table first with an identity, then insert the rest of the data into it, but is there a way to do it in 1 step?</p>
","<p>Oh ye of little faith:</p>

<pre><code>SELECT *, IDENTITY( int ) AS idcol
  INTO #newtable
  FROM oldtable
</code></pre>

<p><a href=""http://msdn.microsoft.com/en-us/library/aa933208(SQL.80).aspx"" rel=""noreferrer"">http://msdn.microsoft.com/en-us/library/aa933208(SQL.80).aspx</a></p>
","123644"
"How to round an average to 2 decimal places in PostgreSQL?","123437","","<p>I am using PostgreSQL via the Ruby gem 'sequel'.</p>

<p>I'm trying to round to two decimal places.</p>

<p>Here's my code:</p>

<pre><code>SELECT ROUND(AVG(some_column),2)    
FROM table
</code></pre>

<p>I get the following error: </p>

<pre><code>PG::Error: ERROR:  function round(double precision, integer) does 
not exist (Sequel::DatabaseError)
</code></pre>

<p>I get no error when I run the following code:</p>

<pre><code>SELECT ROUND(AVG(some_column))
FROM table
</code></pre>

<p>Does anyone know what I am doing wrong?</p>
","<p>PostgreSQL does not define <code>round(double precision, integer)</code>. For reasons @Catcall explains in the comments, the version of round that takes a precision is only available for <code>numeric</code>.</p>

<pre><code>regress=&gt; SELECT round( float8 '3.1415927', 2 );
ERROR:  function round(double precision, integer) does not exist

regress=&gt; \df *round*
                           List of functions
   Schema   |  Name  | Result data type | Argument data types |  Type  
------------+--------+------------------+---------------------+--------
 pg_catalog | dround | double precision | double precision    | normal
 pg_catalog | round  | double precision | double precision    | normal
 pg_catalog | round  | numeric          | numeric             | normal
 pg_catalog | round  | numeric          | numeric, integer    | normal
(4 rows)

regress=&gt; SELECT round( CAST(float8 '3.1415927' as numeric), 2);
 round 
-------
  3.14
(1 row)
</code></pre>

<p>(In the above, note that <code>float8</code> is just a shorthand alias for <code>double precision</code>. You can see that PostgreSQL is expanding it in the output).</p>

<p>You must cast the value to be rounded to <code>numeric</code> to use the two-argument form of <code>round</code>. Just append <code>::numeric</code> for the shorthand cast, like <code>round(val::numeric,2)</code>.</p>

<hr>

<p>If you're formatting for display to the user, don't use <code>round</code>. Use <code>to_char</code> (see: <a href=""http://www.postgresql.org/docs/current/static/functions-formatting.html"" rel=""noreferrer"">data type formatting functions</a> in the manual), which lets you specify a format and gives you a <code>text</code> result that isn't affected by whatever weirdness your client language might do with <code>numeric</code> values. For example:</p>

<pre><code>regress=&gt; SELECT to_char(float8 '3.1415927', 'FM999999999.00');
    to_char    
---------------
 3.14
(1 row)
</code></pre>

<p><code>to_char</code> will round numbers for you as part of formatting. The <code>FM</code> prefix tells <code>to_char</code> that you don't want any padding with leading spaces.</p>
","13113623"
"PHP & MYSQL: How to resolve ambiguous column names in JOIN operation?","123363","","<p>I have two tables in my database:</p>

<p>NEWS ('id' - the news id, 'user' - the user id of the author)</p>

<p>USERS ('id' - the user id)</p>

<p>I want to make a <code>SELECT * FROM news JOIN users ON news.user = user.id</code>, now when I get the results in PHP it's something like:</p>

<p><code>$row = mysql_fetch_array($result)</code>, and get column names by <code>$row['column-name']</code>... how do I get the news ID and the user ID, having the same column name?</p>

<p>UPDATE: Thanks everybody for the quick answers. Aliases seem the best solution.</p>
","<p>You can set aliases for the columns that you are selecting:</p>

<pre><code>$query = 'SELECT news.id AS newsId, user.id AS userId, [OTHER FIELDS HERE] FROM news JOIN users ON news.user = user.id'
</code></pre>
","431397"
"Copy Data from a table in one Database to another separate database","123248","","<p>Basically I have a two databases on SQL Server 2005.</p>

<p>I want to take the table data from one database and copy it to another database's table.</p>

<p>I tried this:</p>

<pre><code>SELECT * INTO dbo.DB1.TempTable FROM dbo.DB2.TempTable
</code></pre>

<p>This didn't work.</p>

<p>I don't want to use a restore to avoid data loss...</p>

<p>Any ideas?</p>
","<p>SELECT ... INTO creates a new table. You'll need to use INSERT. Also, you have the database and owner names reversed.</p>

<pre><code>INSERT INTO DB1.dbo.TempTable
SELECT * FROM DB2.dbo.TempTable
</code></pre>
","940962"
"Insert null/empty value in sql datetime column by default","123221","","<p>I have a question please:
How can i create a table in SQL server with the default datetime as empty, not <code>1900-01-01 00:00:00.000</code> that i get.</p>

<p>I mean, if there is no value inserted, the default value should be null,empty...</p>

<p>Thanks</p>
","<blockquote>
  <p>if there is no value inserted, the default value should be null,empty</p>
</blockquote>

<p>In the table definition, make this <code>datetime</code> column allows null, be not defining <code>NOT NULL</code>:</p>

<pre><code>...
DateTimeColumn DateTime,
...
</code></pre>

<blockquote>
  <p>I HAVE ALLOWED NULL VARIABLES THOUGH.</p>
</blockquote>

<p>Then , just insert <code>NULL</code> in this column:</p>

<pre><code>INSERT INTO Table(name, datetimeColumn, ...)
VALUES('foo bar', NULL, ..);
</code></pre>

<p>Or, you can make use of the <a href=""http://msdn.microsoft.com/en-us/library/aa175912%28v=sql.80%29.aspx"" rel=""noreferrer"">DEFAULT</a> constaints:</p>

<pre><code>...
DateTimeColumn DateTime DEFAULT NULL,
...
</code></pre>

<p>Then you can ignore it completely in the <code>INSERT</code> statement and it will be inserted withe the <code>NULL</code> value:</p>

<pre><code>INSERT INTO Table(name, ...)
VALUES('foo bar', ..);
</code></pre>
","13934665"
"SQL Query - Concatenating Results into One String","123159","","<p>I have a sql function that includes this code:</p>

<pre><code>DECLARE @CodeNameString varchar(100)

SELECT CodeName FROM AccountCodes ORDER BY Sort
</code></pre>

<p>I need to concatenate all results from the select query into CodeNameString.</p>

<p>Obviously a FOREACH loop in C# code would do this, but how do I do it in SQL?</p>
","<p>If you're on SQL Server 2005 or up, you can use this <code>FOR XML PATH &amp; STUFF</code> trick:</p>

<pre><code>DECLARE @CodeNameString varchar(100)

SELECT 
   @CodeNameString = STUFF( (SELECT ',' + CodeName 
                             FROM dbo.AccountCodes 
                             ORDER BY Sort
                             FOR XML PATH('')), 
                            1, 1, '')
</code></pre>

<p>The <code>FOR XML PATH('')</code> basically concatenates your strings together into one, long XML result (something like <code>,code1,code2,code3</code> etc.) and the <code>STUFF</code> puts a ""nothing"" character at the first character, e.g. wipes out the ""superfluous"" first comma, to give you the result you're probably looking for.</p>

<p><strong>UPDATE:</strong> OK - I understand the comments - if your text in the database table already contains characters like <code>&lt;</code>, <code>&gt;</code> or <code>&amp;</code>, then <em>my current solution</em> will in fact encode those into <code>&amp;lt;</code>, <code>&amp;gt;</code>, and <code>&amp;amp;</code>.</p>

<p>If you have a problem with that XML encoding - then yes, you must look at the solution proposed by @KM which works for those characters, too. One word of <strong>warning</strong> from me: this approach is <strong>a lot more</strong> resource and processing intensive - just so you know. </p>
","5196474"
"Explicit vs implicit SQL joins","123101","","<p>Is there any efficiency difference in an explicit vs implicit inner join?
For example:</p>

<pre><code>SELECT * FROM
table a INNER JOIN table b
ON a.id = b.id;
</code></pre>

<p>vs.</p>

<pre><code>SELECT a.*, b.*
FROM table a, table b
WHERE a.id = b.id;
</code></pre>
","<p>Performance wise, they are exactly the same (at least in SQL Server).</p>

<p>PS: Be aware that the <code>IMPLICIT OUTER JOIN</code> syntax is deprecated since SQL Server 2005. (The <code>IMPLICIT INNER JOIN</code> syntax as used in the question is still supported)</p>

<p><a href=""http://blogs.technet.com/b/wardpond/archive/2008/09/13/deprecation-of-old-style-join-syntax-only-a-partial-thing.aspx?Redirected=true"" rel=""nofollow noreferrer"">Deprecation of ""Old Style"" JOIN Syntax: Only A Partial Thing</a></p>
","44932"
"Sample database for exercise","123050","","<p>I would like to play with a larger database to test my knowledge on SQL.</p>

<p>Is there a huge .sql out there that I can use to play with SQL queries?</p>
","<p>You could try the classic <a href=""http://downloads.mysql.com/docs/world.sql.gz"" rel=""noreferrer"">MySQL world database</a>.</p>

<p>The world.sql file is available for download here:</p>

<p><a href=""http://dev.mysql.com/doc/index-other.html"" rel=""noreferrer"">http://dev.mysql.com/doc/index-other.html</a></p>

<p>Just scroll down to <strong>Example Databases</strong> and you will find it.</p>
","719264"
"How can I get the number of records affected by a stored procedure?","122905","","<p>For <code>INSERT</code>, <code>UPDATE</code> and <code>DELETE</code> SQL statements executed directly against the database, most database providers return the count of rows affected. For stored procedures, the number of records affected is always <code>-1</code>.</p>

<p>How do we get the number of records affected by a stored procedure?</p>
","<p>Register an out parameter for the stored procedure, and set the value based on @@ROWCOUNT if using SQL Server.  Use SQL%ROWCOUNT if you are using Oracle.</p>

<p>Mind that if you have multiple INSERT/UPDATE/DELETEs, you'll need a variable to store the result from @@ROWCOUNT for each operation.</p>
","1201382"
"Set an empty DateTime variable","122894","","<p>I would declare an empty String variable like this:</p>

<pre><code>    string myString = string.Empty;
</code></pre>

<p>Is there an equivalent for a 'DateTime' variable ?</p>

<p>Update :</p>

<p>The problem is I use this 'DateTime' as a parameter for a 'StoredProcedure' in SQL.
E.g:</p>

<pre><code>    DateTime? someDate = null;
    myCommand.Parameters.AddWithValue(""@SurgeryDate"", someDate);
</code></pre>

<p>When I run this code an exception is catched telling me the 'StoredProcedure' expected a '@SurgeryDate' parameter.
But i provided it.
Any idea why?</p>
","<p>Since <code>DateTime</code> is a value type you cannot assign <code>null</code> to it, but exactly for these cases (absence of a value) <a href=""http://msdn.microsoft.com/en-us/library/b3h38hb0.aspx"" rel=""noreferrer""><code>Nullable&lt;T&gt;</code></a> was introduced - use a nullable <code>DateTime</code> instead:</p>

<pre><code>DateTime? myTime = null;
</code></pre>
","9982848"
"How do I add multiple ""NOT LIKE '%?%' in the WHERE clause of sqlite3 in python code?","122771","","<p>I have a sqlite3 query that is executed inside python code. An example would be </p>

<pre><code>SELECT word FROM table WHERE word NOT LIKE '%a%';
</code></pre>

<p>This would select all of the words where 'a' does not occur in the word. This I can get to work perfectly. The problem is if I want to further restrict the results to not include 'b' anywhere in the word. I am picturing something like this.</p>

<pre><code>SELECT word FROM table WHERE word NOT IN ('%a%', '%b%', '%z%');
</code></pre>

<p>which this obviously does not work, but this is kinda the idea. 
And just adding an AND clause is not really an option unless that is the only way to perform this. So this code is not an option.</p>

<pre><code>SELECT word FROM table WHERE word NOT LIKE '%a%' AND NOT LIKE '%b%';
</code></pre>

<p>If this is the only option then I will have to work with that, but I was hoping for something else. Thanks in advance for the help!</p>
","<p>If you use Sqlite's REGEXP support ( see the answer at <a href=""https://stackoverflow.com/questions/5365451/problem-with-regexp-python-and-sqlite"">Problem with regexp python and sqlite</a> for how to do that ) , then you can do it easily in one clause:</p>

<pre><code>SELECT word FROM table WHERE word NOT REGEXP '[abc]';
</code></pre>
","8089198"
"Concatenate string with field value in MySQL","122734","","<p>I have the need to concatenate a string with a field value in a MySQL query in order to LEFT JOIN two tables.</p>

<p>Table one has a column called ""category_id"" with numeric values, such as 61, 78, 94 and such.</p>

<p>Table two has a column called ""query"" which refers to a request route mechanism, and it has values such as ""product_id=68"", ""category_id=74"", ""manufacturer_id=99"" and so on.</p>

<p>So in my query I require to join the tables when ever a concatenated string derived from a set string and the value of the ""category_id"" column matches the query field.</p>

<p>My SQL statement is currently:</p>

<pre><code>SELECT * FROM tableOne 
LEFT JOIN tableTwo
ON tableTwo.query = 'category_id=' + tableOne.category_id
</code></pre>

<p>I have tried using the || operator instead of the + operator, but still no luck. Is it possible to do this in MySQL, or have I jumped the gun here?</p>
","<p>Have you tried using the <a href=""http://dev.mysql.com/doc/refman/5.1/en/string-functions.html#function_concat"" rel=""noreferrer"">concat()</a> function?</p>

<pre><code>ON tableTwo.query = concat('category_id=',tableOne.category_id)
</code></pre>
","19261781"
"How to use a SQL SELECT statement with Access VBA","122649","","<p>I have a combobox whose value I want to use with a SQL WHERE clause. How do you <strong>run</strong> a SELECT statement inside VBA based on the combobox value?</p>
","<p>If you wish to use the bound column value, you can simply refer to the combo:</p>

<pre><code>sSQL = ""SELECT * FROM MyTable WHERE ID = "" &amp; Me.MyCombo
</code></pre>

<p>You can also refer to the column property:</p>

<pre><code>sSQL = ""SELECT * FROM MyTable WHERE AText = '"" &amp; Me.MyCombo.Column(1) &amp; ""'""

Dim rs As DAO Recordset
Set rs = CurrentDB.OpenRecordset(sSQL)

strText = rs!AText
strText = rs.Fields(1)
</code></pre>

<p>In a textbox:</p>

<pre><code>= DlookUp(""AText"",""MyTable"",""ID="" &amp; MyCombo)
</code></pre>
","11017337"
"What are database constraints?","122366","","<p>What is a clear definition of database constraint?  Why are constraints important for a database?  What are the types of constraints?</p>
","<p>Constraints are part of a database schema definition. </p>

<p>A constraint is usually associated with a table and is created with a <code>CREATE CONSTRAINT</code> or <code>CREATE ASSERTION</code> SQL statement.</p>

<p>They define certain properties that data in a database must comply with. They can apply to a column, a whole table, more than one table or an entire schema. A reliable database system ensures that constraints hold at all times (except possibly inside a transaction, for so called deferred constraints).</p>

<p>Common kinds of constraints are:</p>

<ul>
<li><strong>not null</strong> - each value in a column must not be <em>NULL</em></li>
<li><strong>unique</strong>   - value(s) in specified column(s) must be unique for each row in a table</li>
<li><strong>primary key</strong> - value(s) in specified column(s) must be unique for each row in a table and not be <em>NULL</em>; normally each table in a database should have a primary key - it is used to identify individual records</li>
<li><strong>foreign key</strong> - value(s) in specified column(s) must reference an existing record in another table (via it's <em>primary key</em> or some other <em>unique constraint</em>)</li>
<li><strong>check</strong>    - an expression is specified, which must evaluate to true for constraint to be satisfied</li>
</ul>
","2570810"
"MySQL INNER JOIN select only one row from second table","122323","","<p>I have a <code>users</code> table and a <code>payments</code> table, for each user, those of which have payments, may have multiple associated payments in the <code>payments</code> table. I would like to select all users who have payments, but only select their latest payment. I'm trying this SQL but i've never tried nested SQL statements before so I want to know what i'm doing wrong. Appreciate the help</p>

<pre><code>        SELECT u.* 
            FROM users AS u
            INNER JOIN (
                SELECT p.*
                FROM payments AS p
                ORDER BY date DESC
                LIMIT 1 )
            ON p.user_id = u.id
            WHERE u.package = 1
</code></pre>
","<p>You need to have a subquery to get their latest date per <code>user ID</code>.</p>

<pre><code>SELECT  a.*, c.*
FROM users a 
    INNER JOIN payments c
        ON a.id = c.user_ID
    INNER JOIN
    (
        SELECT user_ID, MAX(date) maxDate
        FROM payments
        GROUP BY user_ID
    ) b ON c.user_ID = b.user_ID AND
            c.date = b.maxDate
WHERE a.package = 1
</code></pre>
","12526264"
"using sql count in a case statement","122306","","<p>I have a table and i need to present the output in the following fashion.</p>

<pre><code>tb_a:

col1  |  reg_id | rsp_ind 
</code></pre>

<p>Count of rows with rsp_ind = 0 as 'New' and 1 as 'Accepted'</p>

<p>The output should be </p>

<pre><code>NEW | Accepted
9   | 10
</code></pre>

<p>I tried using the following query.</p>

<pre><code>select 
  case when rsp_ind = 0 then count(reg_id)end as 'New',
  case when rsp_ind = 1 then count(reg_id)end as 'Accepted'
from tb_a
</code></pre>

<p>and i m getting output as </p>

<pre><code>NEW | Accepted
NULL| 10
9   | NULL
</code></pre>

<p>Could someone help to me tweak the query to achieve the output.
Note : I cannot add a sum surrounding this. Its part of a bigger program and so i cannot add a super-query to this.</p>
","<pre><code>SELECT 
    COUNT(CASE WHEN rsp_ind = 0 then 1 ELSE NULL END) as ""New"",
    COUNT(CASE WHEN rsp_ind = 1 then 1 ELSE NULL END) as ""Accepted""
from tb_a
</code></pre>

<p>You can see the output for this request <a href=""http://sqlfiddle.com/#!2/84442/1"">HERE</a></p>
","17975288"
"SQL multiple columns in IN clause","122273","","<p>If we need to query a table based on some set of values for a given column, we can simply use the IN clause. </p>

<p>But if query need to be performed based on multiple columns, we could not use IN clause(grepped in SO threads.) </p>

<p>From other SO threads, we can circumvent this problem using joins or exists clause etc. But they all work if both main table and search data are in the database. </p>

<pre><code>E.g
User table:
firstName, lastName, City
</code></pre>

<p>Given a list of (firstname, lastName) tuples, I need to get the cities. </p>

<p>I can think of following solutions. </p>

<h1>1</h1>

<p>Construct a select query like, </p>

<pre><code>SELECT city from user where (firstName=x and lastName=y) or (firstName=a and lastName=b) or .....
</code></pre>

<h1>2</h1>

<p>Upload all firstName, lastName values into a staging table and perform a join between 'user' table and the new staging table. </p>

<p>Are there any options for solving this problem and what is the preferred of solving this problem in general?</p>
","<p>You could do like this:</p>

<pre><code>SELECT city FROM user WHERE (firstName, lastName) IN (('a', 'b'), ('c', 'd'));
</code></pre>

<p><em><strong><a href=""http://sqlfiddle.com/#!2/72132/4/0"">The sqlfiddle</a></em></strong>.</p>
","13027780"
"Cursor inside cursor","121906","","<p>Main problem is about changing the index of rows to 1,2,3.. where contact-id and type is the same. but all columns can contain exactly the same data because of some ex-employee messed up and update all rows by contact-id and type. somehow there are rows that aren't messed but index rows are same. It is total chaos. </p>

<p>I tried to use an inner cursor with the variables coming from the outer cursor. 
But It seems that its stuck in the inner cursor.</p>

<p>A part of the query looks like this:</p>

<pre><code>Fetch NEXT FROM OUTER_CURSOR INTO @CONTACT_ID,  @TYPE
While (@@FETCH_STATUS &lt;&gt; -1)
BEGIN
IF (@@FETCH_STATUS &lt;&gt; -2)

    DECLARE INNER_CURSOR Cursor 
    FOR 
    SELECT * FROM CONTACTS
    where CONTACT_ID = @CONTACT_ID
    and TYPE = @TYPE 

    Open INNER_CURSOR 

    Fetch NEXT FROM INNER_CURSOR 
    While (@@FETCH_STATUS &lt;&gt; -1)
    BEGIN
    IF (@@FETCH_STATUS &lt;&gt; -2)
</code></pre>

<p>What can be the problem? Is @@FETCH_STATUS ambiguous or something?</p>

<p>EDIT: everything looks fine if i don't use this code inside inner cursor:</p>

<pre><code>UPDATE CONTACTS
SET INDEX_NO = @COUNTER
where current of INNER_CURSOR
</code></pre>

<p>EDIT: here is the big picture:</p>

<pre><code>BEGIN TRAN

DECLARE @CONTACT_ID VARCHAR(15)
DECLARE @TYPE VARCHAR(15)
DECLARE @INDEX_NO  SMALLINT
DECLARE @COUNTER SMALLINT
DECLARE @FETCH_STATUS INT 

DECLARE OUTER_CURSOR CURSOR 

FOR 

SELECT CONTACT_ID, TYPE, INDEX_NO FROM CONTACTS
WHERE  
CONTACT_ID IN (SELECT CONTACT_ID FROM dbo.CONTACTS
WHERE CONTACT_ID IN(...)
GROUP BY CONTACT_ID, TYPE, INDEX_NO
HAVING COUNT(*) &gt; 1

OPEN OUTER_CURSOR 

FETCH NEXT FROM OUTER_CURSOR INTO @CONTACT_ID,  @TYPE, @INDEX_NO
WHILE (@@FETCH_STATUS &lt;&gt; -1)
BEGIN
IF (@@FETCH_STATUS &lt;&gt; -2)

SET @COUNTER = 1

        DECLARE INNER_CURSOR CURSOR 
        FOR 
        SELECT * FROM CONTACTS
        WHERE CONTACT_ID = @CONTACT_ID
        AND TYPE = @TYPE 
        FOR UPDATE 

        OPEN INNER_CURSOR 

        FETCH NEXT FROM INNER_CURSOR 

        WHILE (@@FETCH_STATUS &lt;&gt; -1)
        BEGIN
        IF (@@FETCH_STATUS &lt;&gt; -2)

        UPDATE CONTACTS
        SET INDEX_NO = @COUNTER
        WHERE CURRENT OF INNER_CURSOR

        SET @COUNTER = @COUNTER + 1

        FETCH NEXT FROM INNER_CURSOR 
        END
        CLOSE INNER_CURSOR
        DEALLOCATE INNER_CURSOR

FETCH NEXT FROM OUTER_CURSOR INTO @CONTACT_ID,  @TYPE, @INDEX_NO
END
CLOSE OUTER_CURSOR
DEALLOCATE OUTER_CURSOR

COMMIT TRAN
</code></pre>
","<p>I don't fully understand what was the problem with the <em>""update current of cursor""</em> but it is solved by using the fetch statement twice for the inner cursor:</p>

<pre><code>FETCH NEXT FROM INNER_CURSOR

WHILE (@@FETCH_STATUS &lt;&gt; -1)
BEGIN

UPDATE CONTACTS
SET INDEX_NO = @COUNTER
WHERE CURRENT OF INNER_CURSOR

SET @COUNTER = @COUNTER + 1

FETCH NEXT FROM INNER_CURSOR
FETCH NEXT FROM INNER_CURSOR
END
</code></pre>
","472215"
"Best way to select random rows PostgreSQL","121863","","<p>I want a random selection of rows in PostgreSQL, I tried this:</p>

<pre><code>select * from table where random() &lt; 0.01;
</code></pre>

<p>But some other recommend this:</p>

<pre><code>select * from table order by random() limit 1000;
</code></pre>

<p>I have a very large table with 500 Million rows, I want it to be fast.</p>

<p>Which approach is better?  What are the differences?  What is the best way to select random rows?</p>
","<p>Given your specifications (plus additional info in the comments),</p>

<ul>
<li>You have a numeric ID column (integer numbers) with only few (or moderately few) gaps.</li>
<li>Obviously no or few write operations.</li>
<li>Your ID column has to be indexed! A primary key serves nicely.</li>
</ul>

<p>The query below does not need a sequential scan of the big table, only an index scan.</p>

<p>First, get estimates for the main query:</p>

<pre><code>SELECT count(*) AS ct              -- optional
     , min(id)  AS min_id
     , max(id)  AS max_id
     , max(id) - min(id) AS id_span
FROM   big;
</code></pre>

<p>The only possibly expensive part is the <code>count(*)</code> (for huge tables). Given above specifications, you don't need it. An estimate will do just fine, available at almost no cost (<a href=""https://stackoverflow.com/questions/7943233/fast-way-to-discover-the-row-count-of-a-table/7945274#7945274"">detailed explanation here</a>):</p>

<pre><code>SELECT reltuples AS ct FROM pg_class WHERE oid = 'schema_name.big'::regclass;
</code></pre>

<p>As long as <code>ct</code> isn't <em>much</em> smaller than <code>id_span</code>, the query will outperform other approaches.    </p>

<pre><code>WITH params AS (
    SELECT 1       AS min_id           -- minimum id &lt;= current min id
         , 5100000 AS id_span          -- rounded up. (max_id - min_id + buffer)
    )
SELECT *
FROM  (
    SELECT p.min_id + trunc(random() * p.id_span)::integer AS id
    FROM   params p
          ,generate_series(1, 1100) g  -- 1000 + buffer
    GROUP  BY 1                        -- trim duplicates
    ) r
JOIN   big USING (id)
LIMIT  1000;                           -- trim surplus
</code></pre>

<ul>
<li><p>Generate random numbers in the <code>id</code> space. You have ""few gaps"", so add 10 % (enough to easily cover the blanks) to the number of rows to retrieve.</p></li>
<li><p>Each <code>id</code> can be picked multiple times by chance (though very unlikely with a big id space), so group the generated numbers (or use <code>DISTINCT</code>).</p></li>
<li><p>Join the <code>id</code>s to the big table. This should be very fast with the index in place.</p></li>
<li><p>Finally trim surplus <code>id</code>s that have not been eaten by dupes and gaps. Every row has a <strong>completely equal chance</strong> to be picked.</p></li>
</ul>

<h3>Short version</h3>

<p>You can <strong>simplify</strong> this query. The CTE in the query above is just for educational purposes:</p>

<pre><code>SELECT *
FROM  (
    SELECT DISTINCT 1 + trunc(random() * 5100000)::integer AS id
    FROM   generate_series(1, 1100) g
    ) r
JOIN   big USING (id)
LIMIT  1000;
</code></pre>

<h2>Refine with rCTE</h2>

<p>Especially if you are not so sure about gaps and estimates.</p>

<pre><code>WITH RECURSIVE random_pick AS (
   SELECT *
   FROM  (
      SELECT 1 + trunc(random() * 5100000)::int AS id
      FROM   generate_series(1, 1030)  -- 1000 + few percent - adapt to your needs
      LIMIT  1030                      -- hint for query planner
      ) r
   JOIN   big b USING (id)             -- eliminate miss

   UNION                               -- eliminate dupe
   SELECT b.*
   FROM  (
      SELECT 1 + trunc(random() * 5100000)::int AS id
      FROM   random_pick r             -- plus 3 percent - adapt to your needs
      LIMIT  999                       -- less than 1000, hint for query planner
      ) r
   JOIN   big b USING (id)             -- eliminate miss
   )
SELECT *
FROM   random_pick
LIMIT  1000;  -- actual limit
</code></pre>

<p>We can work with a <strong><em>smaller surplus</em></strong> in the base query. If there are too many gaps so we don't find enough rows in the first iteration, the rCTE continues to iterate with the recursive term. We still need relatively <em>few</em> gaps in the ID space or the recursion may run dry before the limit is reached - or we have to start with a large enough buffer which defies the purpose of optimizing performance.</p>

<p>Duplicates are eliminated by the <code>UNION</code> in the rCTE.</p>

<p>The outer <code>LIMIT</code> makes the CTE stop as soon as we have enough rows.</p>

<p>This query is carefully drafted to use the available index, generate actually random rows and not stop until we fulfill the limit (unless the recursion runs dry). There are a number of pitfalls here if you are going to rewrite it.</p>

<h2>Wrap into function</h2>

<p>For repeated use with varying parameters:</p>

<pre><code>CREATE OR REPLACE FUNCTION f_random_sample(_limit int = 1000, _gaps real = 1.03)
  RETURNS SETOF big AS
$func$
DECLARE
   _surplus  int := _limit * _gaps;
   _estimate int := (           -- get current estimate from system
      SELECT c.reltuples * _gaps
      FROM   pg_class c
      WHERE  c.oid = 'big'::regclass);
BEGIN

   RETURN QUERY
   WITH RECURSIVE random_pick AS (
      SELECT *
      FROM  (
         SELECT 1 + trunc(random() * _estimate)::int
         FROM   generate_series(1, _surplus) g
         LIMIT  _surplus           -- hint for query planner
         ) r (id)
      JOIN   big USING (id)        -- eliminate misses

      UNION                        -- eliminate dupes
      SELECT *
      FROM  (
         SELECT 1 + trunc(random() * _estimate)::int
         FROM   random_pick        -- just to make it recursive
         LIMIT  _limit             -- hint for query planner
         ) r (id)
      JOIN   big USING (id)        -- eliminate misses
   )
   SELECT *
   FROM   random_pick
   LIMIT  _limit;
END
$func$  LANGUAGE plpgsql VOLATILE ROWS 1000;
</code></pre>

<p>Call:</p>

<pre><code>SELECT * FROM f_random_sample();
SELECT * FROM f_random_sample(500, 1.05);
</code></pre>

<p>You could even make this generic to work for any table: Take the name of the PK column and the table as polymorphic type and use <code>EXECUTE</code> ... But that's beyond the scope of this question. See:</p>

<ul>
<li><a href=""https://stackoverflow.com/questions/11740256/refactor-a-pl-pgsql-function-to-return-the-output-of-various-select-queries/11751557#11751557"">Refactor a PL/pgSQL function to return the output of various SELECT queries</a></li>
</ul>

<h3>Possible alternative</h3>

<p>IF your requirements allow <strong>identical sets for repeated</strong> calls (and we are talking about repeated calls) I would consider a <strong>materialized view</strong>. Execute above query once and write the result to a table. Users get a quasi random selection at lightening speed. Refresh your random pick at intervals or events of your choosing.</p>

<h2>Postgres 9.5 introduces <a href=""http://www.postgresql.org/docs/devel/static/sql-select.html#SQL-FROM"" rel=""noreferrer""><code>TABLESAMPLE SYSTEM (n)</code></a></h2>

<p>It's <em>very fast</em>, but the result is <em>not exactly random</em>. <a href=""http://www.postgresql.org/docs/devel/static/sql-select.html#SQL-FROM"" rel=""noreferrer"">The manual:</a></p>

<blockquote>
  <p>The <code>SYSTEM</code> method is significantly faster than the <code>BERNOULLI</code> method
  when small sampling percentages are specified, but it may return a
  less-random sample of the table as a result of clustering effects.</p>
</blockquote>

<p>And the number of rows returned can vary wildly. For our example, to get <em>roughly</em> 1000 rows, try:</p>

<pre><code>SELECT * FROM big TABLESAMPLE SYSTEM ((1000 * 100) / 5100000.0);
</code></pre>

<p>Where <em>n</em> is a percentage. The manual:</p>

<blockquote>
  <p>The <code>BERNOULLI</code> and <code>SYSTEM</code> sampling methods each accept a single
  argument which is the fraction of the table to sample, expressed as a
  <strong>percentage between 0 and 100</strong>. This argument can be any <code>real</code>-valued expression.</p>
</blockquote>

<p>Bold emphasis mine.</p>

<p>Related:</p>

<ul>
<li><a href=""https://stackoverflow.com/questions/7943233/fast-way-to-discover-the-row-count-of-a-table/7945274#7945274"">Fast way to discover the row count of a table in PostgreSQL</a></li>
</ul>

<p><strong>Or</strong> install the additional module <a href=""https://www.postgresql.org/docs/current/static/tsm-system-rows.html"" rel=""noreferrer""><strong>tsm_system_rows</strong></a> to get the number of requested rows exactly (if there are enough) and allow for the more convenient syntax:</p>

<pre><code>SELECT * FROM big TABLESAMPLE SYSTEM_ROWS(1000);
</code></pre>

<p>See <a href=""https://stackoverflow.com/a/41337788/939860"">Evan's answer</a> for details.</p>

<p>But that's still not exactly random.</p>
","8675160"
"Using ORDER BY and GROUP BY together","121827","","<p>My table looks like this (and I'm using MySQL):</p>

<pre><code>m_id | v_id | timestamp
------------------------
6    |   1  | 1333635317
34   |   1  | 1333635323
34   |   1  | 1333635336
6    |   1  | 1333635343
6    |   1  | 1333635349
</code></pre>

<p>My target is to take each m_id one time, and order by the highest timestamp.</p>

<p>The result should be:</p>

<pre><code>m_id | v_id | timestamp
------------------------
6    |   1  | 1333635343
34   |   1  | 1333635336
</code></pre>

<p>And i wrote this query:</p>

<pre><code>SELECT * FROM table GROUP BY m_id ORDER BY timestamp DESC
</code></pre>

<p>But, the results are:</p>

<pre><code>m_id | v_id | timestamp
------------------------
34   |   1  | 1333635323
6    |   1  | 1333635317
</code></pre>

<p>I think it causes because it first does GROUP_BY and then ORDER the results.</p>

<p>Any ideas? Thank you.</p>
","<p>One way to do this that correctly uses <code>group by</code>: </p>

<pre><code>select l.* 
from table l
inner join (
  select 
    m_id, max(timestamp) as latest 
  from table 
  group by m_id
) r
  on l.timestamp = r.latest and l.m_id = r.m_id
order by timestamp desc
</code></pre>

<p>How this works:</p>

<ul>
<li>selects the latest timestamp for each distinct <code>m_id</code> in the subquery</li>
<li>only selects rows from <code>table</code> that match a row from the subquery (this operation -- where a join is performed, but no columns are selected from the second table, it's just used as a filter -- is known as a <a href=""http://en.wikipedia.org/wiki/Relational_algebra#Semijoin_.28.E2.8B.89.29.28.E2.8B.8A.29"" rel=""noreferrer"">""semijoin""</a> in case you were curious)</li>
<li>orders the rows</li>
</ul>
","10030851"
"ORA-00918: column ambiguously defined in SELECT *","121741","","<p>Getting ORA-00918: column ambiguously defined: running this SQL:</p>

<pre><code>SELECT *
FROM
  (SELECT DISTINCT(coaches.id),
    people.*,
    users.*,
    coaches.*
  FROM ""COACHES""
  INNER JOIN people ON people.id = coaches.person_id
  INNER JOIN users ON coaches.person_id = users.person_id
  LEFT OUTER JOIN organizations_users ON organizations_users.user_id = users.id
) WHERE rownum &lt;= 25
</code></pre>

<p>Any suggestions please?</p>
","<p>A query's projection can only have one instance of a given name.  As your WHERE clause shows, you have several tables with a column called ID.  Because you are selecting <code>*</code> your projection will have several columns called ID.  Or it would have were it not for the compiler hurling ORA-00918.</p>

<p>The solution is quite simple: you will have to expand the projection to explicitly select named columns.  Then you can either leave out the duplicate columns, retaining just (say) COACHES.ID or use column aliases: <code>coaches.id as COACHES_ID</code>.</p>

<p>Perhaps that strikes you as a lot of typing, but it is the only way.  If it is any comfort, <code>SELECT *</code> is regarded as bad practice in production code: explicitly named columns are much safer.   </p>
","6233244"
"How to Replace Multiple Characters in SQL?","121629","","<p>This is based on a similar question <a href=""https://stackoverflow.com/questions/748674/how-to-replace-multiple-characters-in-access-sql"">How to Replace Multiple Characters in Access SQL?</a> </p>

<p>I wrote this since sql server 2005 seems to have a limit on replace() function to 19 replacements inside a where clause.</p>

<p>I have the following task: Need to perform a match on a column, and to improve the chances of a match stripping multiple un-needed chars using replace() function</p>

<pre><code>DECLARE @es NVarChar(1) SET @es = ''
DECLARE @p0 NVarChar(1) SET @p0 = '!'
DECLARE @p1 NVarChar(1) SET @p1 = '@'
---etc...

SELECT *
FROM t1,t2 
WHERE  REPLACE(REPLACE(t1.stringkey,@p0, @es), @p1, @es) 
     = REPLACE(REPLACE(t2.stringkey,@p0, @es), @p1, @es)    
---etc 
</code></pre>

<p>If there are >19 REPLACE() in that where clause, it doesn't work. So the solution I came up with is to create a sql function called <strong>trimChars</strong> in this example (excuse them starting at @22</p>

<pre><code>CREATE FUNCTION [trimChars] (
   @string varchar(max)
) 

RETURNS varchar(max) 
AS
BEGIN

DECLARE @es NVarChar(1) SET @es = ''
DECLARE @p22 NVarChar(1) SET @p22 = '^'
DECLARE @p23 NVarChar(1) SET @p23 = '&amp;'
DECLARE @p24 NVarChar(1) SET @p24 = '*'
DECLARE @p25 NVarChar(1) SET @p25 = '('
DECLARE @p26 NVarChar(1) SET @p26 = '_'
DECLARE @p27 NVarChar(1) SET @p27 = ')'
DECLARE @p28 NVarChar(1) SET @p28 = '`'
DECLARE @p29 NVarChar(1) SET @p29 = '~'
DECLARE @p30 NVarChar(1) SET @p30 = '{'

DECLARE @p31 NVarChar(1) SET @p31 = '}'
DECLARE @p32 NVarChar(1) SET @p32 = ' '
DECLARE @p33 NVarChar(1) SET @p33 = '['
DECLARE @p34 NVarChar(1) SET @p34 = '?'
DECLARE @p35 NVarChar(1) SET @p35 = ']'
DECLARE @p36 NVarChar(1) SET @p36 = '\'
DECLARE @p37 NVarChar(1) SET @p37 = '|'
DECLARE @p38 NVarChar(1) SET @p38 = '&lt;'
DECLARE @p39 NVarChar(1) SET @p39 = '&gt;'
DECLARE @p40 NVarChar(1) SET @p40 = '@'
DECLARE @p41 NVarChar(1) SET @p41 = '-'

return   REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(
       @string, @p22, @es), @p23, @es), @p24, @es), @p25, @es), @p26, @es), @p27, @es), @p28, @es), @p29, @es), @p30, @es), @p31, @es), @p32, @es), @p33, @es), @p34, @es), @p35, @es), @p36, @es), @p37, @es), @p38, @es), @p39, @es), @p40, @es), @p41, @es)
END 
</code></pre>

<p>This can then be used in addition to the other replace strings</p>

<pre><code>SELECT *
FROM t1,t2 
WHERE  trimChars(REPLACE(REPLACE(t1.stringkey,@p0, @es), @p1, @es) 
         = REPLACE(REPLACE(t2.stringkey,@p0, @es), @p1, @es))   
</code></pre>

<p>I created a few more functions to do similar replacing like so <strong>trimChars(trimMoreChars(</strong></p>

<pre><code>SELECT *
FROM t1,t2 
WHERE  trimChars(trimMoreChars(REPLACE(REPLACE(t1.stringkey,@p0, @es), @p1, @es) 
         = REPLACE(REPLACE(t2.stringkey,@p0, @es), @p1, @es)))
</code></pre>

<p>Can someone give me a better solution to this problem in terms of performance and maybe a cleaner implementation?</p>
","<p>I would seriously consider <a href=""https://web.archive.org/web/20140208202630/http://msdn.microsoft.com/en-us/magazine/cc163473.aspx"" rel=""nofollow noreferrer"">making a CLR UDF</a> <a href=""https://web.archive.org/web/20140724183639/http://www.ideaexcursion.com/2009/08/18/sql-server-regular-expression-clr-udf/"" rel=""nofollow noreferrer"">instead</a> and using regular expressions (both the string and the pattern can be passed in as parameters) to do a complete search and replace for a range of characters.  It should easily outperform this SQL UDF.</p>
","1580051"
"How to get the last row of an Oracle a table","121488","","<p>I want to get the last row, which I inserted into a table in an Oracle 11g Express database. 
How can I do this?</p>
","<p>There is no such thing as the ""last"" row in a table, as an Oracle table has no concept of order.</p>

<p>However, assuming that you wanted to find the last inserted primary key <em>and</em> that this primary key is an incrementing number, you could do something like this:</p>

<pre><code>select *
  from ( select a.*, max(pk) over () as max_pk
           from my_table a
                )
 where pk = max_pk
</code></pre>

<p>If you have the date that each row was created this would become, if the column is named <code>created</code>:</p>

<pre><code>select *
  from ( select a.*, max(created) over () as max_created
           from my_table a
                )
 where created = max_created
</code></pre>

<p>Alternatively, you can use an aggregate query, for example:</p>

<pre><code>select *
  from my_table
 where pk = ( select max(pk) from my_table )
</code></pre>

<p>Here's a little <a href=""http://www.sqlfiddle.com/#!4/18fd6/1"" rel=""noreferrer"">SQL Fiddle</a> to demonstrate.</p>
","12378571"
"How to kill a running SELECT statement","121423","","<p>How can I stop a running SELECT statement by killing the session?</p>

<p>The command is continuously giving me output based on the SELECT statement, I want to stop it in between.</p>
","<p>As you keep getting pages of results I'm assuming you started the session in SQL*Plus. If so, the easy thing to do is to bash <kbd>ctrl</kbd> + <kbd>break</kbd> many, many times until it stops.</p>

<p>The more complicated and the more generic way(s) I detail below in order of increasing ferocity / evil. The first one will probably work for you but if it doesn't you can keep moving down the list. </p>

<p><strong>Most of these are not recommended and can have unintended consequences.</strong></p>

<p><br></p>

<h2>1. <em>Oracle level</em> - Kill the process in the database</h2>

<p>As per <a href=""https://stackoverflow.com/a/9545671/458741"">ObiWanKenobi's answer</a> and the <a href=""http://docs.oracle.com/cd/E11882_01/server.112/e41084/statements_2014.htm#sthref3285"" rel=""nofollow noreferrer"">ALTER SESSION</a> documentation</p>

<pre><code>alter system kill session 'sid,serial#';
</code></pre>

<p>To find the <code>sid</code>, session id, and the <code>serial#</code>, serial number, run the following query - summarised from <a href=""http://www.oracle-base.com/articles/misc/KillingOracleSessions.php"" rel=""nofollow noreferrer"">OracleBase</a> - and find your session:</p>

<pre><code>select s.sid, s.serial#, p.spid, s.username, s.schemaname
     , s.program, s.terminal, s.osuser
  from v$session s
  join v$process p
    on s.paddr = p.addr
 where s.type != 'BACKGROUND'
</code></pre>

<p>If you're running a <a href=""http://www.sysdba.de/oracle-dokumentation/11.1/rac.111/b28254/toc.htm"" rel=""nofollow noreferrer"">RAC</a> then you need to change this slightly to take into account the multiple instances, <code>inst_id</code> is what identifies them:</p>

<pre><code>select s.inst_id, s.sid, s.serial#, p.spid, s.username
     , s.schemaname, s.program, s.terminal, s.osuser
  from Gv$session s
  join Gv$process p
    on s.paddr = p.addr
   and s.inst_id = p.inst_id
 where s.type != 'BACKGROUND'
</code></pre>

<p>This query would also work if you're not running a RAC.</p>

<p>If you're using a tool like PL/SQL Developer then the sessions window will also help you find it.</p>

<p>For a slightly stronger ""kill"" you can specify the IMMEDIATE keyword, which instructs the database to not wait for the transaction to complete:</p>

<pre><code>alter system kill session 'sid,serial#' immediate;
</code></pre>

<h2>2. <em>OS level</em> - Issue a <a href=""http://en.wikipedia.org/wiki/SIGTERM"" rel=""nofollow noreferrer""><em>SIGTERM</em></a></h2>

<pre class=""lang-none prettyprint-override""><code>kill pid
</code></pre>

<p>This assumes you're using Linux or another *nix variant. A <em>SIGTERM</em> is a terminate signal from the operating system to the specific process asking it to stop running. It tries to let the process terminate gracefully.</p>

<p><strong>Getting this wrong could result in you terminating essential OS processes so be careful when typing.</strong></p>

<p>You can find the <code>pid</code>, process id, by running the following query, which'll also tell you useful information like the terminal the process is running from and the username that's running it so you can ensure you pick the correct one.</p>

<pre><code>select p.*
  from v$process p
  left outer join v$session s
    on p.addr = s.paddr
 where s.sid = ?
   and s.serial# = ?
</code></pre>

<p>Once again, if you're running a RAC you need to change this slightly to:</p>

<pre><code>select p.*
  from Gv$process p
  left outer join Gv$session s
    on p.addr = s.paddr
 where s.sid = ?
   and s.serial# = ?
</code></pre>

<p>Changing the <code>where</code> clause to <code>where s.status = 'KILLED'</code> will help you find already killed process that are still ""running"".</p>

<h2>3. <em>OS</em> - Issue a <a href=""http://en.wikipedia.org/wiki/SIGKILL"" rel=""nofollow noreferrer""><em>SIGKILL</em></a></h2>

<pre class=""lang-none prettyprint-override""><code>kill -9 pid
</code></pre>

<p>Using the same <code>pid</code> you picked up in 2, a <em>SIGKILL</em> is a signal from the operating system to a specific process that causes the process to terminate immediately. Once again be careful when typing. </p>

<p><strong>This should rarely be necessary. If you were doing <a href=""http://en.wikipedia.org/wiki/Data_Manipulation_Language"" rel=""nofollow noreferrer"">DML</a> or <a href=""http://en.wikipedia.org/wiki/Data_Definition_Language"" rel=""nofollow noreferrer"">DDL</a> it will stop any rollback being processed and <em>may</em> make it difficult to recover the database to a consistent state in the event of failure.</strong></p>

<blockquote>
  <p>All the remaining options will kill all sessions and result in your database - and in the case of 6 and 7 server as well - becoming unavailable. They should only be used if absolutely necessary...</p>
</blockquote>

<h2>4. <em>Oracle</em> - <a href=""http://dba-oracle.com/t_oracle_shutdown_immediate_abort.htm"" rel=""nofollow noreferrer"">Shutdown</a> the database</h2>

<pre><code>shutdown immediate
</code></pre>

<p>This is actually politer than a <em>SIGKILL</em>, though obviously it acts on all processes in the database rather than your specific process. It's <em>always</em> good to be polite to your database. </p>

<p>Shutting down the database should only be done with the consent of your DBA, if you have one. It's nice to tell the people who use the database as well.</p>

<p>It closes the database, terminating all sessions and does a <a href=""http://ss64.com/ora/syntax-redo.html"" rel=""nofollow noreferrer""><code>rollback</code></a> on all uncommitted transactions. It can take a while if you have large uncommitted transactions that need to be rolled back. </p>

<h2>5. <em>Oracle</em> - Shutdown the database ( the less nice way )</h2>

<pre><code>shutdown abort
</code></pre>

<p>This is approximately the same as a <em>SIGKILL</em>, though once again on all processes in the database. It's a signal to the database to stop everything immediately and die - a hard crash.  It terminates all sessions and does no rollback; because of this it can mean that the database takes longer to <a href=""http://psoug.org/reference/start_stop.html"" rel=""nofollow noreferrer""><code>startup</code></a> again. Despite the incendiary language a <code>shutdown abort</code> isn't pure evil and can normally be used safely.</p>

<p>As before inform people the relevant people first.</p>

<h2>6. <em>OS</em> - Reboot the server</h2>

<pre class=""lang-none prettyprint-override""><code>reboot
</code></pre>

<p>Obviously, this not only stops the database but the server as well so use with caution and with the consent of your sysadmins in addition to the DBAs, developers, clients and users.</p>

<h2>7. <em>OS</em> - The last stage</h2>

<p>I've had reboot not work... Once you've reached this stage you better hope you're using a VM. We ended up deleting it...</p>
","9546094"
"What's the best practice for primary keys in tables?","121337","","<p>When designing tables, I've developed a habit of having one column that is unique and that I make the primary key.  This is achieved in three ways depending on requirements:</p>

<ol>
<li>Identity integer column that auto increments.</li>
<li>Unique identifier (GUID)</li>
<li>A short character(x) or integer (or other relatively small numeric type) column that can serve as a row identifier column</li>
</ol>

<p>Number 3 would be used for fairly small lookup, mostly read tables that might have a unique static length string code, or a numeric value such as a year or other number.</p>

<p>For the most part, all other tables will either have an auto-incrementing integer or unique identifier primary key.</p>

<h1>The Question :-)</h1>

<p>I have recently started working with databases that have no consistent row identifier and primary keys are currently clustered across various columns.  Some examples:</p>

<ul>
<li>datetime/character</li>
<li>datetime/integer</li>
<li>datetime/varchar</li>
<li>char/nvarchar/nvarchar</li>
</ul>

<p>Is there a valid case for this?  I would have always defined an identity or unique identifier column for these cases.</p>

<p>In addition there are many tables without primary keys at all.  What are the valid reasons, if any, for this?</p>

<p>I'm trying to understand why tables were designed as they were, and it appears to be a big mess to me, but maybe there were good reasons for it.</p>

<p>A third question to sort of help me decipher the answers: In cases where multiple columns are used to comprise the compound primary key, is there a specific advantage to this method vs. a surrogate/artificial key?  I'm thinking mostly in regards to performance, maintenance, administration, etc.?</p>
","<p>I follow a few rules:</p>

<ol>
<li>Primary keys should be as small as necessary. Prefer a numeric type because numeric types are stored in a much more compact format than character formats. This is because most primary keys will be foreign keys in another table as well as used in multiple indexes. The smaller your key, the smaller the index, the less pages in the cache you will use.</li>
<li>Primary keys should never change. Updating a primary key should always be out of the question. This is because it is most likely to be used in multiple indexes and used as a foreign key. Updating a single primary key could cause of ripple effect of changes.</li>
<li>Do NOT use ""your problem primary key"" as your logic model primary key. For example passport number, social security number, or employee contract number as these ""primary key"" can change for real world situations.   </li>
</ol>

<p>On surrogate vs natural key, I refer to the rules above. If the natural key is small and will never change it can be used as a primary key. If the natural key is large or likely to change I use surrogate keys. If there is no primary key I still make a surrogate key because experience shows you will always add tables to your schema and wish you'd put a primary key in place.</p>
","338424"
"How can I compare time in SQL Server?","121232","","<p>I'm trying to compare time in a <strong>datetime field</strong> in a SQL query, but I don't know it it's right. I don't want to compare the date part, just the time part.</p>

<p>I'm doing this:</p>

<pre><code>SELECT timeEvent 
FROM tbEvents 
WHERE convert(datetime, startHour, 8) &gt;= convert(datetime, @startHour, 8)
</code></pre>

<p>Is it correct? </p>

<p>I'm asking this because I need to know if '08:00:00' is less or greater than '07:30:00' and I don't want to compare the date, just the time part.</p>

<p>Thanks!</p>
","<p>Your compare will work, but it will be slow because the dates are converted to a string for each row.  To efficiently compare two time parts, try:</p>

<pre><code>declare @first datetime
set @first = '2009-04-30 19:47:16.123'
declare @second datetime
set @second = '2009-04-10 19:47:16.123'

select (cast(@first as float) - floor(cast(@first as float))) -
       (cast(@second as float) - floor(cast(@second as float)))
       as Difference
</code></pre>

<p>Long explanation: a date in SQL server is stored as a floating point number. The digits before the decimal point represent the date. The digits after the decimal point represent the time.</p>

<p>So here's an example date:</p>

<pre><code>declare @mydate datetime
set @mydate = '2009-04-30 19:47:16.123'
</code></pre>

<p>Let's convert it to a float:</p>

<pre><code>declare @myfloat float
set @myfloat = cast(@mydate as float)
select @myfloat
-- Shows 39931,8244921682
</code></pre>

<p>Now take the part after the digit, i.e. the time:</p>

<pre><code>set @myfloat = @myfloat - floor(@myfloat) 
select @myfloat
-- Shows 0,824492168212601
</code></pre>

<p>Convert it back to a datetime:</p>

<pre><code>declare @mytime datetime
set @mytime = convert(datetime,@myfloat)
select @mytime
-- Shows 1900-01-01 19:47:16.123
</code></pre>

<p>The 1900-01-01 is just the ""zero"" date; you can display the time part with convert, specifying for example format 108, which is just the time:</p>

<pre><code>select convert(varchar(32),@mytime,108)
-- Shows 19:47:16
</code></pre>

<p>Conversions between datetime and float are pretty fast, because they're basically stored in the same way.</p>
","808507"
"In SQL, how can you ""group by"" in ranges?","121152","","<p>Suppose I have a table with a numeric column (lets call it ""score"").</p>

<p>I'd like to generate a table of counts, that shows how many times scores appeared in each range.</p>

<p>For example:</p>

<pre>
score range  | number of occurrences
-------------------------------------
   0-9       |        11
  10-19      |        14
  20-29      |         3
   ...       |       ...
</pre>

<p>In this example there were 11 rows with scores in the range of 0 to 9, 14 rows with scores in the range of 10 to 19, and 3 rows with scores in the range 20-29.</p>

<p>Is there an easy way to set this up?  What do you recommend?</p>
","<p>Neither of the highest voted answers are correct on SQLServer 2000. Perhaps they were using a different version.</p>

<p>Here are the correct versions of both of them on SQLServer 2000.</p>

<pre><code>select t.range as [score range], count(*) as [number of occurences]
from (
  select case  
    when score between 0 and 9 then ' 0- 9'
    when score between 10 and 19 then '10-19'
    else '20-99' end as range
  from scores) t
group by t.range
</code></pre>

<p>or</p>

<pre><code>select t.range as [score range], count(*) as [number of occurences]
from (
      select user_id,
         case when score &gt;= 0 and score&lt; 10 then '0-9'
         when score &gt;= 10 and score&lt; 20 then '10-19'
         else '20-99' end as range
     from scores) t
group by t.range
</code></pre>
","233223"
"Oracle SQL: Use sequence in insert with Select Statement","121084","","<p>Basically I want to run the following query:</p>

<pre><code>INSERT INTO historical_car_stats (historical_car_stats_id, year, month, make, model, region, avg_msrp, count)
  SELECT
    my_seq.nextval,
    '2010',
    '12',
    'ALL',
    'ALL',
    region,
    sum(avg_msrp * count) / sum(count),
    sum(count)
  FROM historical_car_stats
  WHERE year = '2010'
        AND month = '12'
        AND make != 'ALL'
  GROUP BY region;
</code></pre>

<p>It doesn't work because ""sequence number not allowed here"" SQL error.  How can I write this so Oracle will let me do what I want to do?</p>
","<p>Assuming that you want to group the data before you generate the key with the sequence, it sounds like you want something like</p>

<pre><code>INSERT INTO HISTORICAL_CAR_STATS (
    HISTORICAL_CAR_STATS_ID, 
    YEAR,
    MONTH, 
    MAKE,
    MODEL,
    REGION,
    AVG_MSRP,
    CNT) 
SELECT MY_SEQ.nextval,
       year,
       month,
       make,
       model,
       region,
       avg_msrp,
       cnt
  FROM (SELECT '2010' year,
               '12' month,
               'ALL' make,
               'ALL' model,
               REGION,
               sum(AVG_MSRP*COUNT)/sum(COUNT) avg_msrp,
               sum(cnt) cnt
          FROM HISTORICAL_CAR_STATS
         WHERE YEAR = '2010' 
           AND MONTH = '12'
           AND MAKE != 'ALL' 
         GROUP BY REGION)
</code></pre>
","7126117"
"TSQL Pivot without aggregate function","121044","","<p>I have a table like this...</p>

<pre><code>CustomerID   DBColumnName   Data
--------------------------------------
1            FirstName      Joe
1            MiddleName     S
1            LastName       Smith
1            Date           12/12/2009
2            FirstName      Sam
2            MiddleName     S
2            LastName       Freddrick
2            Date           1/12/2009
3            FirstName      Jaime
3            MiddleName     S
3            LastName       Carol
3            Date           12/1/2009
</code></pre>

<p>And I want this...</p>

<p>Is this possible using PIVOT?</p>

<pre><code>CustomerID  FirstName   MiddleName          LastName        Date
----------------------------------------------------------------------
1           Joe             S               Smith           12/12/2009
2           Sam             S               Freddrick       1/12/2009
3           Jaime           S               Carol           12/1/2009
</code></pre>
","<p>You can use the MAX aggregate, it would still work. MAX of one value = that value..</p>

<p>In this case, you could also self join 5 times on customerid, filter by dbColumnName per table reference. It may work out better.</p>
","1343164"
"Round up value to nearest whole number in SQL UPDATE","121009","","<p>I'm running SQL that needs rounding up the value to the nearest whole number.</p>

<p>What I need is 45.01 rounds up to 46. Also 45.49 rounds to 46. And 45.99 rounds up to 46, too. I want everything up one whole digit.</p>

<p>How do I achieve this in an UPDATE statement like the following?</p>

<pre><code>Update product SET price=Round
</code></pre>
","<p>You could use the <a href=""http://dev.mysql.com/doc/refman/5.0/en/mathematical-functions.html#function_ceil"" rel=""noreferrer""><code>ceil</code></a> function, at least on MySQL ; this portion of SQL code :</p>

<pre><code>select ceil(45.01), ceil(45.49), ceil(45.99);
</code></pre>

<p>will get you ""46"" each time.</p>

<p>For your update, so, I'd say :</p>

<pre><code>Update product SET price = ceil(45.01)
</code></pre>

<p><br>
BTW : On MySQL, <a href=""http://dev.mysql.com/doc/refman/5.0/en/mathematical-functions.html#function_ceil"" rel=""noreferrer""><code>ceil</code></a> is an alias to <a href=""http://dev.mysql.com/doc/refman/5.0/en/mathematical-functions.html#function_ceiling"" rel=""noreferrer""><code>ceiling</code></a> ; not sure about other DB systems, so you might have to use one or the other, depending on the DB you are using...</p>

<p><br>
Quoting the documentation :</p>

<blockquote>
  <p><code>CEILING(X)</code></p>
  
  <p>Returns the smallest integer value not
  less than X.</p>
</blockquote>

<p>And the given example :</p>

<pre><code>mysql&gt; SELECT CEILING(1.23);
        -&gt; 2
mysql&gt; SELECT CEILING(-1.23);
        -&gt; -1
</code></pre>
","1388851"
"How to update only one field using Entity Framework?","120592","","<p>Here's the table</p>

<p><strong>Users</strong></p>

<pre><code>UserId
UserName
Password
EmailAddress
</code></pre>

<p>and the code..</p>

<pre class=""lang-csharp prettyprint-override""><code>public void ChangePassword(int userId, string password){
//code to update the password..
}
</code></pre>
","<p>Ladislav's answer updated to use DbContext (introduced in EF 4.1):</p>

<pre><code>public void ChangePassword(int userId, string password)
{
  var user = new User() { Id = userId, Password = password };
  using (var db = new MyEfContextName())
  {
    db.Users.Attach(user);
    db.Entry(user).Property(x =&gt; x.Password).IsModified = true;
    db.SaveChanges();
  }
}
</code></pre>
","5567616"
"SQL Server NOLOCK and joins","120516","","<p>Background: I have a performance-critical query I'd like to run and I don't care about dirty reads.</p>

<p>My question is; If I'm using joins, do I have to specify the NOLOCK hint on those as well?</p>

<p>For instance; is:</p>

<pre><code>SELECT * FROM table1 a WITH (NOLOCK)
INNER JOIN table2 b WITH (NOLOCK) ON a.ID = b.ID
</code></pre>

<p>Equivalent to:</p>

<pre><code>SELECT * FROM table1 a WITH (NOLOCK)
INNER JOIN table2 b ON a.ID = b.ID
</code></pre>

<p>Or will I need to specify the <code>(NOLOCK)</code> hint on the join to ensure I'm not locking the joined table?</p>
","<p>I won't address the <code>READ UNCOMMITTED</code> argument, just your original question.</p>

<p>Yes, you need <code>WITH(NOLOCK)</code> on each table of the join.  No, your queries are not the same.</p>

<p>Try this exercise.  Begin a transaction and insert a row into table1 and table2.  Don't commit or rollback the transaction yet.  At this point your first query will return successfully and include the uncommitted rows;  your second query won't return because table2 doesn't have the <code>WITH(NOLOCK)</code> hint on it.</p>
","3788406"
"SQL Server Script to create a new user","120500","","<p>I want to write a script to create a admin user ( with abcd password )in SQL Server Express.
Also I want to assign this user (admin) full rights</p>
","<p>Based on your question, I think that you may be a bit confused about the difference between a <em>User</em> and a <em>Login</em>.  A <em>Login</em> is an account on the SQL Server as a whole - someone who is able to log in to the server and who has a password.  A <em>User</em> is a <em>Login</em> with access to a specific database.</p>

<p>Creating a <em>Login</em> is easy and must (obviously) be done before creating a <em>User</em> account for the login in a specific database:</p>

<pre><code>CREATE LOGIN NewAdminName WITH PASSWORD = 'ABCD'
GO
</code></pre>

<p>Here is how you create a <em>User</em> with db_owner privileges using the <em>Login</em> you just declared:</p>

<pre><code>Use YourDatabase;
GO

IF NOT EXISTS (SELECT * FROM sys.database_principals WHERE name = N'NewAdminName')
BEGIN
    CREATE USER [NewAdminName] FOR LOGIN [NewAdminName]
    EXEC sp_addrolemember N'db_owner', N'NewAdminName'
END;
GO
</code></pre>

<p>Now, <em>Logins</em> are a bit more fluid than I make it seem above.  For example, a Login account is automatically created (in most SQL Server installations) for the Windows Administrator account when the database is installed.  In most situations, I just use that when I am administering a database (it has all privileges).  </p>

<p>However, if you are going to be accessing the SQL Server from an application, then you will want to set the server up for ""Mixed Mode"" (both Windows and SQL logins) and create a Login as shown above.  You'll then ""GRANT"" priviliges to that SQL Login based on what is needed for your app.  See <a href=""http://technet.microsoft.com/en-us/library/aa337562.aspx"" rel=""noreferrer"">here</a> for more information.</p>

<p>UPDATE: Aaron points out the use of the sp_addsrvrolemember to assign a prepared role to your login account.  This is a good idea - faster and easier than manually granting privileges.  If you google it you'll see plenty of links.  However, you must still understand the distinction between a login and a user.</p>
","1601275"
"Select from table by knowing only date without time (ORACLE)","120371","","<p>I'm trying to retrieve records from table by knowing the date in column contains date and time.</p>

<p>Suppose I have table called <code>t1</code> which contains only two column <code>name</code> and <code>date</code> respectively.</p>

<p>The data stored in column date like this <code>8/3/2010 12:34:20 PM</code>.</p>

<p>I want to retrieve this record by this query for example (note I don't put the time):</p>

<pre><code>Select * From t1 Where date=""8/3/2010""
</code></pre>

<p>This query give me nothing ! </p>

<p>How can I retrieve <code>date</code> by knowing only <code>date</code> without the time?</p>
","<p><code>DATE</code> is a reserved keyword in Oracle, so I'm using column-name <code>your_date</code> instead.</p>

<p>If you have an index on <code>your_date</code>, I would use</p>

<pre><code>WHERE your_date &gt;= TO_DATE('2010-08-03', 'YYYY-MM-DD')
  AND your_date &lt;  TO_DATE('2010-08-04', 'YYYY-MM-DD')
</code></pre>

<p>or <code>BETWEEN</code>:</p>

<pre><code>WHERE your_date BETWEEN TO_DATE('2010-08-03', 'YYYY-MM-DD')
                    AND TO_DATE('2010-08-03 23:59:59', 'YYYY-MM-DD HH24:MI:SS')
</code></pre>

<p>If there is no index or if there are not too many records</p>

<pre><code>WHERE TRUNC(your_date) = TO_DATE('2010-08-03', 'YYYY-MM-DD')
</code></pre>

<p>should be sufficient. <a href=""http://download.oracle.com/docs/cd/B28359_01/olap.111/b28126/dml_functions_2127.htm"" rel=""noreferrer""><code>TRUNC</code></a> without parameter removes hours, minutes and seconds from a <code>DATE</code>.</p>

<hr>

<p>If performance really matters, consider putting a <a href=""http://www.akadia.com/services/ora_function_based_index_2.html"" rel=""noreferrer""><code>Function Based Index</code></a> on that column:</p>

<pre><code>CREATE INDEX trunc_date_idx ON t1(TRUNC(your_date));
</code></pre>
","2399800"
"The most sophisticated way for creating comma-separated Strings from a Collection/Array/List?","120287","","<p>During my work with databases I noticed that I write query strings and in this strings I have to put several restrictions in the where-clause from a list/array/collection. Should look like this:</p>

<pre><code>select * from customer 
where customer.id in (34, 26, ..., 2);
</code></pre>

<p>You can simplify this by reducing this to the question that you have collection of strings and want to create a comma-separated list of this strings in just one string.</p>

<p>My approach I have used so far is something like that:</p>

<pre><code>String result = """";
boolean first = true;
for(String string : collectionOfStrings) {
    if(first) {
        result+=string;
        first=false;
    } else {
        result+="",""+string;
    }
}
</code></pre>

<p>But this is as you can see very ugly. You cannot see what happens there on the first look, especially when the constructed strings (like every SQL query) is getting complicated.</p>

<p>What is your (more) elegant way?</p>
","<p>Since strings are immutable, you may want to use the StringBuilder class if you're going to alter the String in the code.</p>

<p>The StringBuilder class can be seen as a mutable String object which allocates more memory when its content is altered.</p>

<p>The original suggestion in the question can be written even more clearly and efficiently, by taking care of the <em>redundant trailing comma</em>:</p>

<pre><code>    StringBuilder result = new StringBuilder();
    for(String string : collectionOfStrings) {
        result.append(string);
        result.append("","");
    }
    return result.length() &gt; 0 ? result.substring(0, result.length() - 1): """";
</code></pre>
","205712"
"SELECT with a Replace()","120268","","<p>I have a table of names and addresses, which includes a postcode column. I want to strip the spaces from the postcodes and select any that match a particular pattern. I'm trying this (simplified a bit) in T-SQL on SQL Server 2005:</p>

<pre><code>SELECT Replace(Postcode, ' ', '') AS P
FROM Contacts
WHERE P LIKE 'NW101%'
</code></pre>

<p>But I get the following error;</p>

<pre><code>Msg 207, Level 16, State 1, Line 3
Invalid column name 'P'.
</code></pre>

<p>If I remove the WHERE clause I get a list of postcodes without spaces, which is what I want to search. How should I approach this? What am I doing wrong?</p>
","<p>Don't use the alias (<code>P</code>) in your <code>WHERE</code> clause directly. </p>

<p>You can either use the same <code>REPLACE</code> logic again in the <code>WHERE</code> clause:</p>

<pre><code>SELECT Replace(Postcode, ' ', '') AS P
FROM Contacts
WHERE Replace(Postcode, ' ', '') LIKE 'NW101%'
</code></pre>

<p>Or use an aliased sub query as described in Nick's answers.</p>
","2652102"
"What does the following Oracle error mean: invalid column index","120044","","<p>I got the following error while testing some code: </p>

<blockquote>
  <p>SQLException: Invalid column index</p>
</blockquote>

<p>What exactly does that mean? </p>

<p>Is there an online document explaining what all the Oracle error codes and statements?</p>
","<p>If that's a SQLException thrown by Java, it's most likely because you are trying to get or set a value from a ResultSet, but the index you are using isn't within the range. </p>

<p>For example, you might be trying to get the column at index 3 from the result set, but you only have two columns being returned from the SQL query.</p>
","5970259"
"Calculate execution time of a SQL query?","119933","","<p>I am providing search functionality in my website, when user searches a record then I want to display the time the query taken to get the results same as google does. When we search anything then google displays how much time it takes to get results?</p>

<p>For this I have declared a @start variable in my SP and finding the difference in the end, as below;</p>

<pre><code>DECLARE @start_time DATETIME

SET @start_time = GETDATE()

-- my query
SELECT * FROM @search_temp_table

SELECT RTRIM(CAST(DATEDIFF(MS, @start_time, GETDATE()) AS CHAR(10))) AS 'TimeTaken'
</code></pre>

<p>Is there any other easy and fast way, or a single line of query with which we can find out the time a query taken to execute?</p>

<p>I'm using SQL Server 2005.</p>
","<p>We monitor this from the application code, just to include the time required to establish/close the connection and transmit data across the network.  It's pretty straight-forward...</p>

<pre>Dim Duration as TimeSpan
Dim StartTime as DateTime = DateTime.Now

'Call the database here and execute your SQL statement

Duration = DateTime.Now.Subtract(StartTime)
Console.WriteLine(String.Format(""Query took {0} seconds"", Duration.TotalSeconds.ToString()))
Console.ReadLine()</pre>
","595795"
"How do I import a sql data file into SQL Server?","119887","","<p>I have a .sql file and I am trying to import it into SQL Server 2008. What is the proper way to do this?</p>
","<p>If you are talking about an actual database (an mdf file) you would <code>Attach</code> it</p>

<p><code>.sql</code> files are typically run using SQL Server Management Studio. They are basically saved SQL statements, so could be anything. You don't ""import"" them, more precisely, you ""execute"" them. Even though the script may indeed insert data.</p>

<p>Also, to expand on Jamie F's answer, don't run a SQL file against your database unless you know what it is doing. SQL scripts can be as dangerous as unchecked exe's</p>
","7828099"
"How can I merge the columns from two tables into one output?","119874","","<p>I have two tables with similar information. Let's call them <code>items_a</code> and <code>items_b</code>. They should be one, but they are coming from different sources, so they aren't. When I full-join the two table, some rows end up with data from either one or both tables. One of the columns in both tables is <code>category_id</code>. I would like to cross the combined table with the categories table using <code>category_id</code>. However, I have two <code>category_id</code> columns now (one from <code>items_a</code> and one from <code>items_b</code>). Is there a way to merge the two columns into one?</p>

<p>I hope this isn't too confusing of a question.</p>
","<p>Specifying the columns on your query should do the trick:</p>

<pre><code>select a.col1, b.col2, a.col3, b.col4, a.category_id 
from items_a a, items_b b 
where a.category_id = b.category_id
</code></pre>

<p>should do the trick with regards to picking the columns you want.</p>

<p>To get around the fact that some data is only in items_a and some data is only in items_b, you would be able to do:</p>

<pre><code>select 
  coalesce(a.col1, b.col1) as col1, 
  coalesce(a.col2, b.col2) as col2,
  coalesce(a.col3, b.col3) as col3,
  a.category_id
from items_a a, items_b b
where a.category_id = b.category_id
</code></pre>

<p>The coalesce function will return the first non-null value, so for each row if col1 is non null, it'll use that, otherwise it'll get the value from col2, etc.</p>
","2360435"
"Null or empty check for a string variable","119837","","<pre><code>if((isnull(@value,''))='')
</code></pre>

<p>I want to know whether the above piece of code works in checking if the variable is null or empty. </p>
","<p>Yes, that code does exactly that.</p>

<p>You can also use:</p>

<pre><code>if (@value is null or @value = '')
</code></pre>

<h3>Edit:</h3>

<p>With the added information that <code>@value</code> is an <code>int</code> value, you need instead:</p>

<pre><code>if (@value is null)
</code></pre>

<p>An <code>int</code> value can never contain the value <code>''</code>.</p>
","16080220"
"Changing the CommandTimeout in SQL Management studio","119744","","<p>How can I change the CommandTimeout in SQL Management Studio?</p>
","<p>Changing Command Execute Timeout in <strong>Management Studio</strong>:</p>

<p>Click on Tools -> Options</p>

<p>Select <strong>Query Execution</strong> from tree on left side and enter command timeout in ""<em>Execute Timeout</em>"" control.</p>

<p>Changing Command Timeout in <strong>Server</strong>:</p>

<p>In the object browser tree right click on the server which give you timeout and select ""<em>Properties</em>"" from context menu.</p>

<p>Now in ""<em>Server Properties -.....</em>"" dialog click on ""<strong>Connections</strong>"" page in ""Select a Page"" list (on left side). On the right side you will get property </p>

<pre><code>Remote query timeout (in seconds, 0 = no timeout):
[up/down control]
</code></pre>

<p>you can set the value in up/down control.</p>
","1137309"
"Oracle: SQL select date with timestamp","119627","","<p>I have the following data:</p>

<pre><code>SQL&gt; select * from booking_session;

BK_ID|BK_DATE
-----|-------------------------
    1|18-MAR-12 10.00.00.000000
    2|18-MAR-12 10.25.00.000000
    3|18-MAR-12 10.30.00.000000
    4|18-MAR-12 10.35.00.000000
    5|18-MAR-12 10.40.00.000000
</code></pre>

<p>I am trying to write a <code>sql</code> query that selects all records that matches a certain date, however I am using timestamp for the <code>BK_DATE</code> field and no matter what I try it my query yields no results.</p>

<p><strong>SQL</strong>: I have tried the following queries but they yield no results</p>

<p>1.</p>

<pre><code>select * 
from booking_session
where bk_date = to_date('18-03-2012', 'dd-mm-yyyy');
</code></pre>

<p>2.</p>

<pre><code>select * 
from booking_session
where bk_date = to_timestamp('18-03-2012', 'dd-mm-yyyy');
</code></pre>

<p>3.</p>

<pre><code>select * 
from booking_session
where bk_date = to_date('18-MAR-2012', 'dd-mm-yyyy');
</code></pre>

<p>It only works when I set the whole date value like;</p>

<pre><code>select * 
from booking_session
WHERE bk_date = '18-MAR-12 11.00.00.000000';


CREATE TABLE BOOKING_SESSION(
  BK_ID NUMBER NOT NULL,
  BK_DATE TIMESTAMP,
  BK_BOOKER NUMBER,
  BK_CUSTOMER NUMBER,
  BK_TREATMENT NUMBER,
  T_SESSION_DATETIME TIMESTAMP,
  STAFFAPPOINTED NUMBER,
  BK_ROOM NUMBER
);

INSERT INTO BOOKING_SESSION VALUES (
  1,
  TO_TIMESTAMP('18/03/2012 10:00', 'DD/MM/YYYY HH24:MI'),
  1,
  1,
  1,
  TO_TIMESTAMP('20/03/2012 11:00', 'DD/MM/YYYY HH24:MI'),2,1
);
</code></pre>
","<p>Answer provided by  Nicholas Krasnov</p>

<pre><code>SELECT *
FROM BOOKING_SESSION
WHERE TO_CHAR(T_SESSION_DATETIME, 'DD-MM-YYYY') ='20-03-2012';
</code></pre>
","13338714"
"How to remove white space characters from a string in SQL Server","119470","","<p>I'm trying to remove white spaces from a string in SQL but <code>LTRIM</code> and <code>RTRIM</code> functions don't seem to work?</p>

<p>Column:</p>

<pre><code>[ProductAlternateKey] [nvarchar](25) COLLATE Latin1_General_CS_AS NULL
</code></pre>

<p>Query:</p>

<pre><code>select REPLACE(ProductAlternateKey, ' ', '@'),
       LEN(ProductAlternateKey),
       LTRIM(RTRIM(ProductAlternateKey))      AS LRTrim,
       LEN(LTRIM(RTRIM(ProductAlternateKey))) AS LRLen,
       ASCII(RIGHT(ProductAlternateKey, 1))   AS ASCIIR,
       ASCII(LEFT(ProductAlternateKey, 1))    AS ASCIIL,
       ProductAlternateKey
from DimProducts
where ProductAlternateKey  like '46783815%'
</code></pre>

<p>Result:</p>

<pre><code>|  COLUMN_0 | COLUMN_1 | LRTrim | LRLen | ASCIIR | ASCIIL | PRODUCTALTERNATEKEY |
---------------------------------------------------------------------------------
|  46783815 |        8 | 46783815|     8|   53   |   52   |            46783815 |
| 46783815  |        10|46783815  |   10|   10   |   52   |           46783815  |
</code></pre>

<p>Can it be other symbols if <code>LTRIM</code> and <code>RTRIM</code> are not working, like ""Enter""?</p>
","<p>Using <code>ASCII(RIGHT(ProductAlternateKey, 1))</code> you can see that the right most character in row 2 is a Line Feed or Ascii Character 10.</p>

<p>This <strong>can not</strong> be removed using the standard <code>LTrim</code> <code>RTrim</code> functions.</p>

<p>You could however use <code>(REPLACE(ProductAlternateKey, CHAR(10), '')</code></p>

<p>You may also want to account for carriage returns and tabs. These three (Line feeds, carriage returns and tabs) are the usual culprits and can be removed with the following :</p>

<pre><code>LTRIM(RTRIM(REPLACE(REPLACE(REPLACE(ProductAlternateKey, CHAR(10), ''), CHAR(13), ''), CHAR(9), '')))
</code></pre>

<p>If you encounter any more ""white space"" characters that can't be removed with the above then try one or all of the below:</p>

<pre><code>--NULL
Replace([YourString],CHAR(0),'');
--Horizontal Tab
Replace([YourString],CHAR(9),'');
--Line Feed
Replace([YourString],CHAR(10),'');
--Vertical Tab
Replace([YourString],CHAR(11),'');
--Form Feed
Replace([YourString],CHAR(12),'');
--Carriage Return
Replace([YourString],CHAR(13),'');
--Column Break
Replace([YourString],CHAR(14),'');
--Non-breaking space
Replace([YourString],CHAR(160),'');
</code></pre>

<p>This list of potential white space characters could be used to create a function such as :</p>

<pre><code>Create Function [dbo].[CleanAndTrimString] 
(@MyString as varchar(Max))
Returns varchar(Max)
As
Begin
    --NULL
    Set @MyString = Replace(@MyString,CHAR(0),'');
    --Horizontal Tab
    Set @MyString = Replace(@MyString,CHAR(9),'');
    --Line Feed
    Set @MyString = Replace(@MyString,CHAR(10),'');
    --Vertical Tab
    Set @MyString = Replace(@MyString,CHAR(11),'');
    --Form Feed
    Set @MyString = Replace(@MyString,CHAR(12),'');
    --Carriage Return
    Set @MyString = Replace(@MyString,CHAR(13),'');
    --Column Break
    Set @MyString = Replace(@MyString,CHAR(14),'');
    --Non-breaking space
    Set @MyString = Replace(@MyString,CHAR(160),'');

    Set @MyString = LTRIM(RTRIM(@MyString));
    Return @MyString
End
Go
</code></pre>

<p>Which you could then use as follows:</p>

<pre><code>Select 
    dbo.CleanAndTrimString(ProductAlternateKey) As ProductAlternateKey
from DimProducts
</code></pre>
","14211957"
"SQL Query for Logins","119364","","<p>What is the SQL query to select all of the MSSQL Server's logins?</p>

<p>Thank you.  More than one of you had the answer I was looking for:</p>

<pre><code>SELECT * FROM syslogins 
</code></pre>
","<p>Is this what you're after?</p>

<pre><code>select * from master..syslogins
</code></pre>
","37290"
"What's the best way to join on the same table twice?","119171","","<p>This is a little complicated, but I have 2 tables. Let's say the structure is something like this:</p>

<pre><code>*Table1*
ID
PhoneNumber1
PhoneNumber2

*Table2*
PhoneNumber
SomeOtherField
</code></pre>

<p>The tables can be joined based on Table1.PhoneNumber1 -> Table2.PhoneNumber, or Table1.PhoneNumber2 -> Table2.PhoneNumber.</p>

<p>Now, I want to get a resultset that contains PhoneNumber1, SomeOtherField that corresponds to PhoneNumber1, PhoneNumber2, and SomeOtherField that corresponds to PhoneNumber2.</p>

<p>I thought of 2 ways to do this - either by joining on the table twice, or by joining once with an OR in the ON clause.</p>

<p><strong>Method 1</strong>:</p>

<pre><code>SELECT t1.PhoneNumber1, t1.PhoneNumber2, 
   t2.SomeOtherFieldForPhone1, t3.someOtherFieldForPhone2
FROM Table1 t1
INNER JOIN Table2 t2
   ON t2.PhoneNumber = t1.PhoneNumber1
INNER JOIN Table2 t3
   ON t3.PhoneNumber = t1.PhoneNumber2
</code></pre>

<p>This seems to work.</p>

<p><strong>Method 2</strong>:</p>

<p>To somehow have a query that looks a bit like this -</p>

<pre><code>SELECT ...
FROM Table1
INNER JOIN Table2 
   ON Table1.PhoneNumber1 = Table2.PhoneNumber OR
      Table1.PhoneNumber2 = Table2.PhoneNumber
</code></pre>

<p>I haven't gotten this to work yet and I'm not sure if there's a way to do it.</p>

<p>What's the best way to accomplish this? Neither way seems simple or intuitive... Is there a more straightforward way to do this? How is this requirement generally implemented?</p>
","<p>First, I would try and refactor these tables to get away from using phone numbers as natural keys. I am not a fan of natural keys and this is a great example why. Natural keys, especially things like phone numbers, can change and frequently so. Updating your database when that change happens will be a HUGE, error-prone headache. *</p>

<p><strong>Method 1</strong> as you describe it is your best bet though. It looks a bit terse due to the naming scheme and the short aliases but... aliasing is your friend when it comes to joining the same table multiple times or using subqueries etc.</p>

<p>I would just clean things up a bit:</p>

<pre><code>SELECT t.PhoneNumber1, t.PhoneNumber2, 
   t1.SomeOtherFieldForPhone1, t2.someOtherFieldForPhone2
FROM Table1 t
JOIN Table2 t1 ON t1.PhoneNumber = t.PhoneNumber1
JOIN Table2 t2 ON t2.PhoneNumber = t.PhoneNumber2
</code></pre>

<p>What i did:</p>

<ul>
<li>No need to specify INNER - it's implied by the fact that you don't specify LEFT or RIGHT</li>
<li>Don't n-suffix your primary lookup table</li>
<li>N-Suffix the table aliases that you will use multiple times to make it obvious</li>
</ul>

<p>*One way DBAs avoid the headaches of updating natural keys is to not specify primary keys and foreign key constraints which further compounds the issues with poor db design. I've actually seen this more often than not.</p>
","4267979"
"How to execute IN() SQL queries with Spring's JDBCTemplate effectivly?","119022","","<p>I was wondering if there is a more elegant way to do IN() queries with Spring's JDBCTemplate. Currently I do something like that:</p>

<pre><code>StringBuilder jobTypeInClauseBuilder = new StringBuilder();
for(int i = 0; i &lt; jobTypes.length; i++) {
    Type jobType = jobTypes[i];

    if(i != 0) {
        jobTypeInClauseBuilder.append(',');
    }

    jobTypeInClauseBuilder.append(jobType.convert());
}
</code></pre>

<p>Which is quite painful since if I have nine lines just for building the clause for the IN() query. I would like to have something like the parameter substitution of prepared statements</p>
","<p>You want a parameter source:</p>

<pre><code>Set&lt;Integer&gt; ids = ...;

MapSqlParameterSource parameters = new MapSqlParameterSource();
parameters.addValue(""ids"", ids);

List&lt;Foo&gt; foo = getJdbcTemplate().query(""SELECT * FROM foo WHERE a IN (:ids)"",
     parameters, getRowMapper());
</code></pre>

<p>This only works if <code>getJdbcTemplate()</code> returns an instance of type <a href=""http://docs.spring.io/spring-framework/docs/4.1.x/javadoc-api/org/springframework/jdbc/core/namedparam/NamedParameterJdbcTemplate.html"" rel=""noreferrer""><code>NamedParameterJdbcTemplate</code></a></p>
","1327222"
"Check if current date is between two dates Oracle SQL","119003","","<p>I would like to select <code>1</code> if current date falls between 2 dates through oracle sql.</p>

<p>I wrote an sql after reading through other questions</p>

<p><a href=""https://stackoverflow.com/questions/2369222/oracle-date-between-query"" title=""Oracle date “Between” Query"">https://stackoverflow.com/questions/2369222/oracle-date-between-query</a></p>

<p><a href=""https://stackoverflow.com/questions/2399753/select-from-table-by-knowing-only-date-without-time-oracle"" title=""Select from table by knowing only date without time &#40;ORACLE&#41;"">https://stackoverflow.com/questions/2399753/select-from-table-by-knowing-only-date-without-time-oracle</a></p>

<p>but it returned only null. sysdate is the current date that is <code>01/05/2014</code> in date format <code>DD/MM/YYYY</code>.</p>

<p>The sqls i wrote is below:</p>

<pre><code>select 1 from dual 
WHERE to_date(sysdate,'DD/MM/YYYY') 
BETWEEN TO_DATE('28/02/2014', 'DD/MM/YYYY')
AND TO_DATE('20/06/2014', 'DD/MM/YYYY');
</code></pre>

<p>and </p>

<pre><code>select 1 from dual 
WHERE to_date(sysdate,'DD/MM/YYYY') &gt;= TO_DATE('28/02/2014', 'DD/MM/YYYY') 
AND to_date(sysdate,'DD/MM/YYYY') &lt; TO_DATE('20/06/2014', 'DD/MM/YYYY'); 
</code></pre>

<p>Thanks in advance for your help.</p>
","<p>You don't need to apply <code>to_date()</code> to <code>sysdate</code>.  It is already there:</p>

<pre><code>select 1
from dual 
WHERE sysdate BETWEEN TO_DATE('28/02/2014', 'DD/MM/YYYY') AND TO_DATE('20/06/2014', 'DD/MM/YYYY');
</code></pre>

<p>If you are concerned about the time component on the date, then use <code>trunc()</code>:</p>

<pre><code>select 1
from dual 
WHERE trunc(sysdate) BETWEEN TO_DATE('28/02/2014', 'DD/MM/YYYY') AND
                             TO_DATE('20/06/2014', 'DD/MM/YYYY');
</code></pre>
","23398759"
"SQL - select distinct only on one column","118960","","<p>I have searched far and wide for an answer to this problem. I'm using a Microsoft SQL Server, suppose I have a table that looks like this:</p>

<pre><code>+--------+---------+-------------+-------------+
| ID     | NUMBER  | COUNTRY     | LANG        |
+--------+---------+-------------+-------------+
| 1      | 3968    | UK          | English     |
| 2      | 3968    | Spain       | Spanish     |
| 3      | 3968    | USA         | English     |
| 4      | 1234    | Greece      | Greek       |
| 5      | 1234    | Italy       | Italian     |
</code></pre>

<p>I want to perform one query which only selects the unique 'NUMBER' column (whether is be the first or last row doesn't bother me). So this would give me:</p>

<pre><code>+--------+---------+-------------+-------------+
| ID     | NUMBER  | COUNTRY     | LANG        |
+--------+---------+-------------+-------------+
| 1      | 3968    | UK          | English     |
| 4      | 1234    | Greece      | Greek       |
</code></pre>

<p>How is this achievable?</p>
","<p>Since you don't care, I chose the max ID for each number.</p>

<pre><code>select tbl.* from tbl
inner join (
select max(id) as maxID, number from tbl group by number) maxID
on maxID.maxID = tbl.id
</code></pre>

<hr>

<p><strong>Query Explanation</strong></p>

<pre><code> select 
    tbl.*  -- give me all the data from the base table (tbl) 
 from 
    tbl    
    inner join (  -- only return rows in tbl which match this subquery
        select 
            max(id) as maxID -- MAX (ie distinct) ID per GROUP BY below
        from 
            tbl 
        group by 
            NUMBER            -- how to group rows for the MAX aggregation
    ) maxID
        on maxID.maxID = tbl.id -- join condition ie only return rows in tbl 
                                -- whose ID is also a MAX ID for a given NUMBER
</code></pre>
","20406129"
"Oracle: How can I select records ONLY from yesterday?","118874","","<p>I've spent hours searching the web for an answer to this question...</p>

<p>Here's what I currently have:</p>

<pre><code>select  *
from    order_header oh
where   tran_date = sysdate-1
</code></pre>

<p>Thanks in advance.</p>
","<p>Use:</p>

<pre><code>AND oh.tran_date BETWEEN TRUNC(SYSDATE - 1) AND TRUNC(SYSDATE) - 1/86400
</code></pre>

<p>Reference: <a href=""http://techonthenet.com/oracle/functions/trunc_date.php"" rel=""noreferrer"">TRUNC</a></p>

<p>Calling a function on the <code>tran_date</code> means the optimizer won't be able to use an index (assuming one exists) associated with it.  Some databases, such as Oracle, support function based indexes which allow for performing functions on the data to minimize impact in such situations, but IME DBAs won't allow these.  And I agree - they aren't really necessary in this instance.</p>
","1574613"
"Move SQL Server 2008 database files to a new folder location","118853","","<p>Logical Name</p>

<ul>
<li><code>my_Data</code></li>
<li><code>my_Log</code></li>
</ul>

<p>Path:</p>

<ul>
<li><code>C:\Program Files\Microsoft SQL Server\MSSQL10.MSSQLSERVER\MSSQL\DATA</code></li>
<li><code>C:\Program Files\Microsoft SQL Server\MSSQL10.MSSQLSERVER\MSSQL\DATA</code></li>
</ul>

<p>FileName:</p>

<ul>
<li><code>my.MDF</code></li>
<li><code>my_1.LDF</code></li>
</ul>

<p>What would be the sql script to move these files to a new location: <code>D:\DATA</code></p>

<p>Database is live so I would need to close existing connections.</p>
","<p>You forgot to mention the name of your database (is it ""my""?).</p>

<pre><code>ALTER DATABASE my SET SINGLE_USER WITH ROLLBACK IMMEDIATE;

ALTER DATABASE my SET OFFLINE;

ALTER DATABASE my MODIFY FILE 
(
   Name = my_Data,
   Filename = 'D:\DATA\my.MDF'
);

ALTER DATABASE my MODIFY FILE 
(
   Name = my_Log, 
   Filename = 'D:\DATA\my_1.LDF'
);
</code></pre>

<p>Now here you must manually move the files from their current location to D:\Data\ (and remember to rename them manually if you changed them in the MODIFY FILE command) ... then you can bring the database back online:</p>

<pre><code>ALTER DATABASE my SET ONLINE;

ALTER DATABASE my SET MULTI_USER;
</code></pre>

<p>This assumes that the SQL Server service account has sufficient privileges on the D:\Data\ folder. If not you will receive errors at the SET ONLINE command.</p>
","6585195"
"Select * from subquery","118656","","<p>I'd like to get sum of column1, sum of column2 and total sum. In Postgres I can do it this way: <strong>(notice the star)</strong></p>

<pre><code>SELECT *, a+b AS total_sum FROM
(
   SELECT SUM(column1) AS a, SUM(column2) AS b
   FROM table
)
</code></pre>

<p>But in Oracle I get an syntax error and have to use this:</p>

<pre><code>SELECT a,b, a+b AS total_sum FROM
(
   SELECT SUM(column1) AS a, SUM(column2) AS b
   FROM table
)
</code></pre>

<p>I have really lot of columns to return so I do not want to write the column names again in the main query. Is there any easy solution?</p>

<p>I cannot use a+b in the inner query because there are not known at this place.
I do not want to use <code>SELECT SELECT SUM(column1) AS a, SUM(column2) AS b, SUM(column1)+SUM(column2) AS total_sum</code>.</p>
","<p>You can select every column from that sub-query by aliasing it and adding the alias before the <code>*</code>:</p>

<pre><code>SELECT t.*, a+b AS total_sum
FROM
(
   SELECT SUM(column1) AS a, SUM(column2) AS b
   FROM table
) t
</code></pre>
","8911674"
"SQL distinct for 2 fields in a database","118430","","<p>Can you get the distinct combination of 2 different fields in a database table?  if so, can you provide the SQL example.</p>
","<p>How about simply:</p>

<pre><code>select distinct c1, c2 from t
</code></pre>

<p>or</p>

<pre><code>select c1, c2, count(*)
from t
group by c1, c2
</code></pre>
","192933"
"How to extract week number in sql","118343","","<p>I have a transdate column of varchar2 type which has the following entrees </p>

<pre><code>01/02/2012
01/03/2012
</code></pre>

<p>etc.</p>

<p>I converted it in to date format in another column using to_date function. This is the format i got.</p>

<pre><code>01-JAN-2012
03-APR-2012
</code></pre>

<p>When I'm trying to extract the weekno, i'm getting all null values. </p>

<p>select to_char(to_date(TRANSDATE), 'w') as weekno from tablename.</p>

<pre><code>null
null
</code></pre>

<p>How to get weekno from date in the above format? </p>
","<p>After converting your <code>varchar2</code> date to a true <code>date</code> datatype, then convert back to <code>varchar2</code> with the desired mask:</p>

<pre><code>to_char(to_date('01/02/2012','MM/DD/YYYY'),'WW')
</code></pre>

<p>If you want the week number in a <code>number</code> datatype, you can wrap the statement in <code>to_number()</code>:</p>

<pre><code>to_number(to_char(to_date('01/02/2012','MM/DD/YYYY'),'WW'))
</code></pre>

<p>However, you have several week number options to consider:</p>

<pre><code>WW  Week of year (1-53) where week 1 starts on the first day of the year and continues to the seventh day of the year.
W   Week of month (1-5) where week 1 starts on the first day of the month and ends on the seventh.
IW  Week of year (1-52 or 1-53) based on the ISO standard.
</code></pre>
","16530174"
"How to write UPDATE SQL with Table alias in SQL Server 2008?","118265","","<p>I have a very basic UPDATE SQL -</p>

<pre><code>UPDATE HOLD_TABLE Q SET Q.TITLE = 'TEST' WHERE Q.ID = 101;
</code></pre>

<p>This query runs fine in Oracle, Derby, My-Sql - but it <b>fails in SQL server 2008</b> 
with following error: 
         <b>""Msg 102, Level 15, State 1, Line 1 
         Incorrect syntax near 'Q'.""</b></p>

<p>If I remove all occurrences of the alias, ""Q"" from SQL then it works.</p>

<p>But I need to use the alias. </p>
","<p>The syntax for using an alias in an update statement on SQL Server is as follows:</p>

<pre><code>UPDATE Q
SET Q.TITLE = 'TEST'
FROM HOLD_TABLE Q
WHERE Q.ID = 101;
</code></pre>

<p>The alias should not be necessary here though.</p>
","4981525"
"How to do IF NOT EXISTS in SQLite","118189","","<p>I am trying to port this line from MS SQL Server to SQLite</p>

<pre><code>IF NOT EXISTS(SELECT 1 FROM EVENTTYPE WHERE EventTypeName = 'ANI Received') 
    INSERT INTO EVENTTYPE (EventTypeName) VALUES ('ANI Received');
</code></pre>

<p>It seems that SQLite does not support IF NOT EXISTS or at least I can't make it work.
Am I missing something simple?  Is there a workaround?</p>
","<p>How about this?</p>

<pre><code>INSERT OR IGNORE INTO EVENTTYPE (EventTypeName) VALUES 'ANI Received'
</code></pre>

<p>(Untested as I don't have SQLite... however <a href=""http://www.sqlite.org/lang_insert.html"" rel=""noreferrer"">this link</a> is quite descriptive.)</p>

<p>Additionally, this should also work:</p>

<pre><code>INSERT INTO EVENTTYPE (EventTypeName)
SELECT 'ANI Received'
WHERE NOT EXISTS (SELECT 1 FROM EVENTTYPE WHERE EventTypeName = 'ANI Received');
</code></pre>
","531147"
"Performing SQL queries on an Excel Table within a Workbook with VBA Macro","118107","","<p>I am trying to make an excel macro that will give me the following function in Excel:</p>

<pre><code>=SQL(""SELECT heading_1 FROM Table1 WHERE heading_2='foo'"")
</code></pre>

<p>Allowing me to search (and maybe even insert) data in my Workbook's Tables using SQL queries.</p>

<p>This is what I have done so far:</p>

<pre><code>Sub SQL()

Dim cn As ADODB.Connection
Dim rs As ADODB.Recordset

strFile = ThisWorkbook.FullName
strCon = ""Provider=Microsoft.ACE.OLEDB.12.0;Data Source="" &amp; strFile _
&amp; "";Extended Properties=""""Excel 12.0;HDR=Yes;IMEX=1"""";""

Set cn = CreateObject(""ADODB.Connection"")
Set rs = CreateObject(""ADODB.Recordset"")

cn.Open strCon

strSQL = ""SELECT * FROM [Sheet1$A1:G3]""

rs.Open strSQL, cn

Debug.Print rs.GetString

End Sub
</code></pre>

<p>My script works like a charm with hardcoded ranges such as the one in the snippet above. It also works very well with static named ranges.</p>

<p>However, it won't work with either dynamic named ranges or TABLE NAMES which is the most important to me.</p>

<p>The closest I have found of an answer is this guy suffering from the same affliction:
<a href=""http://www.ozgrid.com/forum/showthread.php?t=72973"" rel=""noreferrer"">http://www.ozgrid.com/forum/showthread.php?t=72973</a></p>

<p>Help anyone?</p>

<p><strong>Edit</strong></p>

<p>I have cooked this so far, I can then use the resulting name in my SQL queries. The limitation is that I need to know on which sheet the tables are. Can we do something about that?</p>

<pre><code>Function getAddress()

    myAddress = Replace(Sheets(""Sheet1"").Range(""Table1"").address, ""$"", """")
    myAddress = ""[Sheet1$"" &amp; myAddress &amp; ""]""

    getAddress = myAddress

End Function
</code></pre>

<p>Thanks!</p>
","<p>One thing you may be able to do is get the address of the dynamic named range, and use that as the input in your SQL string. Something like:</p>

<pre><code>Sheets(""shtName"").range(""namedRangeName"").Address
</code></pre>

<p>Which will spit out an address string, something like <code>$A$1:$A$8</code></p>

<p><em>Edit:</em></p>

<p>As I said in my comment below, you can dynamically get the full address (including sheet name) and either use it directly or parse the sheet name for later use:</p>

<pre><code>ActiveWorkbook.Names.Item(""namedRangeName"").RefersToLocal
</code></pre>

<p>Which results in a string like <code>=Sheet1!$C$1:$C$4</code>. So for your code example above, your SQL statement could be</p>

<pre><code>strRangeAddress = Mid(ActiveWorkbook.Names.Item(""namedRangeName"").RefersToLocal,2)

strSQL = ""SELECT * FROM [strRangeAddress]""
</code></pre>
","19755989"
"How to move columns in a MySQL table?","117957","","<p>Currently I am having the following MySQL table: <code>Employees (empID, empName, department);</code></p>

<p>I want to change the table to the following: <code>Employees (empID, department, empName);</code></p>

<p>How can this be done using <code>ALTER</code> statements?</p>

<p>Note: I want to change only column positions. </p>
","<p>If empName is a VARCHAR(50) column:</p>

<pre><code>ALTER TABLE Employees MODIFY COLUMN empName VARCHAR(50) AFTER department;
</code></pre>

<p><strong>EDIT</strong></p>

<p>Per the comments, you can also do this:</p>

<pre><code>ALTER TABLE Employees CHANGE COLUMN empName empName VARCHAR(50) AFTER department;
</code></pre>

<p>Note that the repetition of <code>empName</code> is deliberate. You have to tell MySQL that you want to keep the same column name.</p>

<p>You should be aware that both syntax versions are specific to MySQL. They won't work, for example, in PostgreSQL or many other DBMSs.</p>

<p>Another edit: As pointed out by @Luis Rossi in a comment, you need to completely specify the altered column definition just before the <code>AFTER</code> modifier. The above examples just have <code>VARCHAR(50)</code>, but if you need other characteristics (such as <code>NOT NULL</code> or a default value) you need to include those as well. Consult <a href=""http://dev.mysql.com/doc/refman/5.7/en/alter-table.html"">the docs on <code>ALTER TABLE</code></a> for more info.</p>
","6805436"
"SQL Server 2008 - Help writing simple INSERT Trigger","117947","","<p>This is with Microsoft SQL Server 2008.</p>

<p>I've got 2 tables, Employee and EmployeeResult and I'm trying to write a simple INSERT trigger on EmployeeResult that does this - each time an INSERT is done into EmployeeResult such as:</p>

<p>(Jack, 200, Sales)
(Jane, 300, Marketing)
(John, 400, Engineering)</p>

<p>It should look up for the Name, Department entry pairs, such as </p>

<p>(Jack, Sales),
(Jane, Marketing),
(John, Engineering)</p>

<p>within the Employee table, and if such an employee does not exist, should insert that into the Employee table.</p>

<p>What I have is this with unknowns on how to fix the ""???""s:</p>

<pre><code>CREATE TRIGGER trig_Update_Employee
ON [EmployeeResult]
FOR INSERT
AS
IF EXISTS (SELECT COUNT(*) FROM Employee WHERE ???)
  BEGIN
   INSERT INTO [Employee] (Name, Department) VALUES (???, ???)
  END
</code></pre>

<p>Please help, thanks in advance</p>

<p>Schema:</p>

<pre><code>Employee
--------
Name, varchar(50)
Department, varchar (50)

EmployeeResult
--------------
Name, varchar(50)
Salary, int
Department, varchar (50)
</code></pre>
","<p>You want to take advantage of the <strong>inserted</strong> logical table that is available in the context of a trigger. It matches the schema for the table that is being inserted to and includes the row(s) that will be inserted (in an update trigger you have access to the <strong>inserted</strong> and <strong>deleted</strong> logical tables which represent the the new and original data respectively.)</p>

<p>So to insert Employee / Department pairs that do not currently exist you might try something like the following.</p>

<pre><code>CREATE TRIGGER trig_Update_Employee
ON [EmployeeResult]
FOR INSERT
AS
Begin
    Insert into Employee (Name, Department) 
    Select Distinct i.Name, i.Department 
    from Inserted i
    Left Join Employee e
    on i.Name = e.Name and i.Department = e.Department
    where e.Name is null
End
</code></pre>
","1355953"
"How to select rows for a specific date, ignoring time in SQL Server","117875","","<p>Given a table with a datetime column, how do I query for rows where the date matches the value I specify but ignores the time portion?</p>

<p>For example, <code>select * from sales where salesDate = '11/11/2010'</code></p>

<p>For this query we don't care about the time. Other queries require the time component so we can't store only the date component.</p>

<p>Thanks!</p>
","<p>You can remove the time component when comparing:</p>

<pre><code>SELECT * 
FROM sales 
WHERE CONVERT(DATETIME, FLOOR(CONVERT(FLOAT, salesDate))) = '11/11/2010'
</code></pre>

<p>Another approach is to change the select to cover all the time between the start and end of the date:</p>

<pre><code>SELECT * 
FROM sales 
WHERE salesDate BETWEEN '11/11/2010 00:00:00.00' AND '11/11/2010 23:59:59.999'
</code></pre>
","4156090"
"Declaring & Setting Variables in a Select Statement","117844","","<p>I'm attempting to write a simple query where I declare some variables and then use them in a select statement in Oracle.  I've been able to do this before in SQL Server with the following:</p>

<pre><code>DECLARE @date1   DATETIME
SET @date1 = '03-AUG-2010'

SELECT U.VisualID
FROM Usage u WITH(NOLOCK)
WHERE U.UseTime &gt; @Date1
</code></pre>

<p>From the searching I've done it appears you can not declare and set variables like this in Select statements.  Is this right or am I mssing something?</p>
","<p><em>From the searching I've done it appears you can not declare and set variables like this in Select statements. Is this right or am I missing something?</em></p>

<p>Within Oracle PL/SQL and SQL are two separate languages with two separate engines. You can embed SQL DML within PL/SQL, and that will get you variables. Such as the following anonymous PL/SQL block. Note the <code>/</code> at the end is not part of PL/SQL, but tells SQL*Plus to send the preceding block.</p>

<pre><code>declare 
    v_Date1 date := to_date('03-AUG-2010', 'DD-Mon-YYYY');
    v_Count number;
begin
    select count(*) into v_Count
    from Usage
    where UseTime &gt; v_Date1;
    dbms_output.put_line(v_Count);
end;
/
</code></pre>

<p>The problem is that a block that is equivalent to your T-SQL code will not work:</p>

<pre><code>SQL&gt; declare 
  2      v_Date1 date := to_date('03-AUG-2010', 'DD-Mon-YYYY');
  3  begin
  4      select VisualId
  5      from Usage
  6      where UseTime &gt; v_Date1;
  7  end;
  8  /
    select VisualId
    *
ERROR at line 4:
ORA-06550: line 4, column 5:
PLS-00428: an INTO clause is expected in this SELECT statement
</code></pre>

<p>To pass the results of a query out of an PL/SQL, either an anonymous block, stored procedure or stored function, a cursor must be declared, opened and then returned to the calling program. (Beyond the scope of answering this question. <strong>EDIT:</strong> see <a href=""https://stackoverflow.com/questions/1170548/get-resultset-from-oracle-stored-procedure"">Get resultset from oracle stored procedure</a>)</p>

<p>The client tool that connects to the database may have it's own bind variables. In SQL*Plus:</p>

<pre><code>SQL&gt; -- SQL*Plus does not all date type in this context
SQL&gt; -- So using varchar2 to hold text
SQL&gt; variable v_Date1 varchar2(20)
SQL&gt;
SQL&gt; -- use PL/SQL to set the value of the bind variable
SQL&gt; exec :v_Date1 := '02-Aug-2010';

PL/SQL procedure successfully completed.

SQL&gt; -- Converting to a date, since the variable is not yet a date.
SQL&gt; -- Note the use of colon, this tells SQL*Plus that v_Date1
SQL&gt; -- is a bind variable.
SQL&gt; select VisualId
  2  from Usage
  3  where UseTime &gt; to_char(:v_Date1, 'DD-Mon-YYYY');

no rows selected
</code></pre>

<p>Note the above is in SQL<em>Plus, may not (probably won't) work in Toad PL/SQL developer, etc. The lines starting with variable and exec are SQL</em>Plus commands. They are not SQL or PL/SQL commands. No rows selected because the table is empty.</p>
","3400602"
"SQL datetime format to date only","117502","","<p>I am trying to select the DeliveryDate from sql database as just date. In the database, i am saving it as datetime format. How is it possible to get just date??</p>

<pre><code>SELECT Subject, DeliveryDate 
from Email_Administration 
where MerchantId =@ MerchantID
</code></pre>

<p>03/06/2011 12:00:00 Am just be selected as 03/06/2011..</p>

<p>Thanks  alot in advance! :)</p>
","<p>After perusing your previous questions I eventually determined you are probably on SQL Server 2005. <a href=""http://www.blackwasp.co.uk/SQLDateTimeFormats.aspx"" rel=""noreferrer"">For US format you would use style 101</a></p>

<pre><code>select Subject, 
       CONVERT(varchar,DeliveryDate,101) as DeliveryDate
from Email_Administration 
where MerchantId =@MerchantID 
</code></pre>
","5222176"
"SQL Server - boolean literal?","117438","","<p>How to write literal boolean value in SQL Server? See sample use:</p>

<pre><code>select * from SomeTable where PSEUDO_TRUE
</code></pre>

<p>another sample:</p>

<pre><code>if PSEUDO_TRUE
begin
  select 'Hello, SQL!'
end 
</code></pre>

<p>Note: The query above has nothing to do with how I'm going to use it. It is just to test the literal boolean.</p>

<p>Thanks in advance!</p>
","<p>SQL Server doesn't have a boolean <a href=""http://msdn.microsoft.com/en-us/library/ms187752.aspx"">data type</a>. As @Mikael has indicated, the closest approximation is the bit. But that is a numeric type, not a boolean type. In addition, it only supports 2 values - <code>0</code> or <code>1</code> (and one non-value, <code>NULL</code>).</p>

<p>SQL (standard SQL, as well as T-SQL dialect) describes a <a href=""http://en.wikipedia.org/wiki/Three-valued_logic"">Three valued logic</a>. The boolean type for SQL should support 3 values - <code>TRUE</code>, <code>FALSE</code> and <code>UNKNOWN</code> (and also, the non-value <code>NULL</code>). So <code>bit</code> isn't actually a good match here.</p>

<p>Given that SQL Server has no support for the <em>data type</em>, we should not expect to be able to write literals of that ""type"".</p>
","7171264"
"SQL Server table creation date query","117417","","<p>How can I get the table creation date of a MS SQL table using a SQL query?<br>
I could not see any table physically but I can query that particular table.</p>
","<p>For 2005 up, you can use </p>

<pre><code>SELECT
        [name]
       ,create_date
       ,modify_date
FROM
        sys.tables
</code></pre>

<p>I think for 2000, you need to have enabled auditing.</p>
","1171031"
"Passing an array of parameters to a stored procedure","117300","","<p>I need to pass an array of ""id's"" to a stored procedure, to delete all rows from the table EXCEPT the rows that match id's in the array.</p>

<p>How can I do it in a most simple way?</p>
","<p>Use a stored procedure:</p>

<p><strong>EDIT:</strong>
A complement for serialize List (or anything else):</p>

<pre><code>List&lt;string&gt; testList = new List&lt;int&gt;();

testList.Add(1);
testList.Add(2);
testList.Add(3);

XmlSerializer xs = new XmlSerializer(typeof(List&lt;int&gt;));
MemoryStream ms = new MemoryStream();
xs.Serialize(ms, testList);

string resultXML = UTF8Encoding.UTF8.GetString(ms.ToArray());
</code></pre>

<p>The result (ready to use with XML parameter):</p>

<pre><code>&lt;?xml version=""1.0""?&gt;
&lt;ArrayOfInt xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xmlns:xsd=""http://www.w3.org/2001/XMLSchema""&gt;
  &lt;int&gt;1&lt;/int&gt;
  &lt;int&gt;2&lt;/int&gt;
  &lt;int&gt;3&lt;/int&gt;
&lt;/ArrayOfInt&gt;
</code></pre>

<hr>

<p><strong>ORIGINAL POST:</strong></p>

<p>Passing XML as parameter:</p>

<pre><code>&lt;ids&gt;
    &lt;id&gt;1&lt;/id&gt;
    &lt;id&gt;2&lt;/id&gt;
&lt;/ids&gt;
</code></pre>

<hr>

<pre><code>CREATE PROCEDURE [dbo].[DeleteAllData]
(
    @XMLDoc XML
)
AS
BEGIN

DECLARE @handle INT

EXEC sp_xml_preparedocument @handle OUTPUT, @XMLDoc

DELETE FROM
    YOURTABLE
WHERE
    YOUR_ID_COLUMN NOT IN (
        SELECT * FROM OPENXML (@handle, '/ids/id') WITH (id INT '.') 
    )
EXEC sp_xml_removedocument @handle
</code></pre>

<hr>
","1069388"
"Trim Whitespaces (New Line and Tab space) in a String in Oracle","117162","","<p>I need to trim New Line (Chr(13) and Chr(10) and Tab space from the beginning and end of a String) in an Oracle query. I learnt that there is no easy way to trim multiple characters in Oracle. ""trim"" function trims only single character. It would be a performance degradation if i call trim function recursivelly in a loop using a function. I heard regexp_replace can match the whitespaces and remove them. 
Can you guide of a reliable way to use regexp_replace to trim multiple tabspaces or new lines or combinations of them in beginning and end of a String. If there is any other way, Please guide me. </p>
","<p>How about the quick and dirty translate function? </p>

<p>This will remove all occurrences of each character in string1: </p>

<pre><code>SELECT translate(
           translate(
               translate(string1, CHR(10), '')
           , CHR(13), '')
       , CHR(09), '') as massaged
FROM BLAH;
</code></pre>

<p>Regexp_replace is an option, but you may see a performance hit depending on how complex your expression is. </p>
","2269103"
"Delete the 'first' record from a table in SQL Server, without a WHERE condition","117154","","<p>Is it possible to delete the 'first' record from a table in <code>SQL Server</code>, without using any <code>WHERE</code> condition and without using a cursor?</p>
","<pre><code>WITH  q AS
        (
        SELECT TOP 1 *
        FROM    mytable
        /* You may want to add ORDER BY here */
        )
DELETE
FROM    q
</code></pre>

<p>Note that</p>

<pre><code>DELETE TOP (1)
FROM   mytable
</code></pre>

<p>will also work, but, as stated in the <a href=""http://msdn.microsoft.com/en-us/library/ms189835.aspx"" rel=""noreferrer""><strong>documentation</strong></a>:</p>

<blockquote>
  <p>The rows referenced in the <code>TOP</code> expression used with <code>INSERT</code>, <code>UPDATE</code>, or <code>DELETE</code> are not arranged in any order.</p>
</blockquote>

<p>Therefore, it's better to use <code>WITH</code> and an <code>ORDER BY</code> clause, which will let you specify more exactly which row you consider to be the first.</p>
","733677"
"What's the purpose of SQL keyword ""AS""?","117085","","<p>You can set table aliases in SQL typing the identifier right after the table name.</p>

<pre><code>SELECT * FROM table t1;
</code></pre>

<p>You can even use the keyword <code>AS</code> to indicate the alias.</p>

<pre><code>SELECT * FROM table AS t1;
</code></pre>

<p>What's the difference between them if any?</p>

<p>I see old DBA people tend to write statements without <code>AS</code>, but most of the new tutorials use it.</p>

<p><em>Update:</em> I know what's the purpose of table and column aliases. I'm curious, what's the reason of having a separate keyword for setting aliases while it works without it as well.</p>
","<p>There is no difference between both statements above. AS is just a more explicit way of mentioning the alias</p>
","4164675"
"Select multiple rows with the same value(s)","116873","","<p>I have a table, sort of like this:</p>

<pre><code>ID  |  Chromosome | Locus | Symbol | Dominance |
===============================================
1   |      10     |   2   |   A    |   Full    |
2   |      10     |   2   |   a    |   Rec.    |
3   |      10     |   3   |   B    |   Full    |
4   |      10     |   3   |   b    |   Rec.    |
</code></pre>

<p>I'd like to select all rows with the same locus and chromosome.  For example, rows 3 and 4.  There may be more than 2 at a time and they may not be in order.</p>

<p>I tried this: </p>

<pre><code>SELECT *
FROM Genes
GROUP BY Locus
HAVING Locus='3' AND Chromosome='10'
</code></pre>

<p>But it always returns row 3, never row 4, even when repeated.  I think I'm missing something obvious and simple, but I'm at a loss.  </p>

<p>Can someone help?</p>
","<p>You need to understand that when you include <code>GROUP BY</code> in your query you are telling SQL to combine rows.  you will get one row per unique <code>Locus</code> value.  The <code>Having</code> then filters those groups.  Usually you specify an aggergate function in the select list like:</p>

<pre><code>--show how many of each Locus there is
SELECT COUNT(*),Locus FROM Genes GROUP BY Locus

--only show the groups that have more than one row in them
SELECT COUNT(*),Locus FROM Genes GROUP BY Locus HAVING COUNT(*)&gt;1

--to just display all the rows for your condition, don't use GROUP BY or HAVING
SELECT * FROM Genes WHERE Locus = '3' AND Chromosome = '10'
</code></pre>
","9233382"
"FULL OUTER JOIN vs. FULL JOIN","116826","","<p>Just playing around with queries and examples to get a better understanding of joins.  I'm noticing that in SQL Server 2008, the following two queries give the same results:</p>

<pre><code>SELECT * FROM TableA
FULL OUTER JOIN TableB
ON TableA.name = TableB.name
</code></pre>

<hr>

<pre><code>SELECT * FROM TableA
FULL JOIN TableB
ON TableA.name = TableB.name
</code></pre>

<p>Are these performing exactly the same action to produce the same results, or would I run into different results in a more complicated example?  Is this just interchangeable terminology?</p>
","<p>Actually they are the same. <code>LEFT OUTER JOIN</code> is same as <code>LEFT JOIN</code> and <code>RIGHT OUTER JOIN</code> is same as <code>RIGHT JOIN</code>. It is more informative way to compare from <code>INNER Join</code>.</p>

<p>See this <a href=""http://en.wikipedia.org/wiki/Join_%28SQL%29#Full_outer_join"">Wikipedia article</a> for details.</p>
","11714972"
"How to get current instance name from T-SQL","116818","","<p>How can I get the SQL Server server and instance name of the current connection, using a T-SQL script?</p>
","<p>Just found the answer, in <a href=""https://stackoverflow.com/questions/129861/how-can-i-query-the-name-of-the-current-sql-server-database-instance"">this SO question</a> (literally, inside the question, not any answer):</p>

<pre><code>SELECT @@servername
</code></pre>

<p>returns servername\instance as far as this is not the default instance</p>

<pre><code>SELECT @@servicename
</code></pre>

<p>returns instance name, even if this is the default (MSSQLSERVER)</p>
","18070284"